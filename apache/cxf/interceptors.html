
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<html>
  <head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - Interceptors">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>
Apache CXF -- Interceptors
    </title>
  </head>
<body onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tr>
    <td id="cell-0-0" colspan="2">&nbsp;</td>
    <td id="cell-0-1">&nbsp;</td>
    <td id="cell-0-2" colspan="2">&nbsp;</td>
  </tr>
  <tr>
    <td id="cell-1-0">&nbsp;</td>
    <td id="cell-1-1">&nbsp;</td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight: bold; font-size: 170%; color: white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="The Apache Sofware Foundation"><img border="0" alt="ASF Logo" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs -->
<a href="index.html">Index</a>&nbsp;&gt;&nbsp;<a href="advanced-integration.html">Advanced Integration</a>&nbsp;&gt;&nbsp;<a href="interceptors.html">Interceptors</a>
                <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">Download</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">Documentation</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </table>
      </div>
    </td>
    <td id="cell-1-3">&nbsp;</td>
    <td id="cell-1-4">&nbsp;</td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2">&nbsp;</td>
    <td id="cell-2-1">
      <table>
        <tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">Overview</a></li><li><a shape="rect" href="how-tos.html">How-Tos</a></li><li><a shape="rect" href="frontends.html">Frontends</a></li><li><a shape="rect" href="databindings.html">DataBindings</a></li><li><a shape="rect" href="transports.html">Transports</a></li><li><a shape="rect" href="configuration.html">Configuration</a></li><li><a shape="rect" href="debugging-and-logging.html">Debugging and Logging</a></li><li><a shape="rect" href="tools.html">Tools</a></li><li><a shape="rect" href="restful-services.html">RESTful Services</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL Bindings</a></li><li><a shape="rect" href="service-routing.html">Service Routing</a></li><li><a shape="rect" href="dynamic-languages.html">Dynamic Languages</a></li><li><a shape="rect" href="ws-support.html">WS-* Support</a></li><li><a shape="rect" href="advanced-integration.html">Advanced Integration</a></li><li><a shape="rect" href="deployment.html">Deployment</a></li><li><a shape="rect" href="schemas-and-namespaces.html">Use of Schemas and Namespaces</a></li></ul><hr><ul class="alternate"><li><p>Search</p></li></ul><form enctype="application/x-www-form-urlencoded" method="get" id="cse-search-box" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="Search">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x (Javadoc)</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x (Javadoc)</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF Website</a></li></ul><p>&#160;</p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="Interceptors-InterceptorsandPhases">Interceptors and Phases</h1><p>Interceptors are the fundamental processing unit inside CXF. When a service is invoked, an InterceptorChain is created and invoked. Each interceptor gets a chance to do what they want with the message. This can include reading it, transforming it, processing headers, validating the message, etc.</p><p>Interceptors are used with both CXF clients and CXF servers. When a CXF client invokes a CXF server, there is an outgoing interceptor chain for the client and an incoming chain for the server. When the server sends the response back to the client, there is an outgoing chain for the server and an incoming one for the client. Additionally, in the case of <a shape="rect" class="external-link" href="https://docs.oracle.com/javase/7/docs/api/javax/xml/soap/SOAPFault.html" rel="nofollow">SOAPFaults</a>, a CXF web service will create a separate outbound error handling chain and the client will create an inbound error handling chain.</p><p>Some examples of interceptors inside CXF include:</p><ul><li>SoapActionInterceptor - Processes the SOAPAction header and selects an operation if it's set.</li><li>StaxInInterceptor - Creates a Stax XMLStreamReader from the transport input stream.</li><li>Attachment(In/Out)Interceptor - Turns a multipart/related message into a series of attachments.</li></ul><p>InterceptorChains are divided up into Phases. The phase that each interceptor runs in is declared in the interceptor's constructor. Each phase may contain many interceptors. On the incoming chains, you'll have the following phases:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Phase</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Functions</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>RECEIVE</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Transport level processing</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>(PRE/USER/POST)_STREAM</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Stream level processing/transformations</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>READ</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This is where header reading typically occurs.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>(PRE/USER/POST)_PROTOCOL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Protocol processing, such as JAX-WS SOAP handlers</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>UNMARSHAL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Unmarshalling of the request</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>(PRE/USER/POST)_LOGICAL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Processing of the umarshalled request</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PRE_INVOKE</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Pre invocation actions</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>INVOKE</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Invocation of the service</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>POST_INVOKE</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Invocation of the outgoing chain if there is one</p></td></tr></tbody></table></div><p>On the outgoing chain there are the following phases:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Phase</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Functions</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>SETUP</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Any set up for the following phases</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>(PRE/USER/POST)_LOGICAL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Processing of objects about to marshalled</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PREPARE_SEND</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Opening of the connection</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PRE_STREAM</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PRE_PROTOCOL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Misc protocol actions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WRITE</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Writing of the protocol message, such as the SOAP Envelope.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>MARSHAL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Marshalling of the objects</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>(USER/POST)_PROTOCOL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Processing of the protocol message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>(USER/POST)_STREAM</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Processing of the byte level message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>SEND</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr></tbody></table></div><p>After the SEND phase, there are a bunch of "*_ENDING" phases that are symmetrical to the above phases to allow the interceptors to cleanup and close anything that they had opened or started in the above phases:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Phase</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Functions</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>SEND_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>POST_STREAM_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>USER_STREAM_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>POST_PROTOCOL_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>USER_PROTOCOL_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>MARSHAL_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WRITE_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PRE_PROTOCOL_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PRE_STREAM_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PREPARE_SEND_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>POST_LOGICAL_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>USER_LOGICAL_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PRE_LOGICAL_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>SETUP_ENDING</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Usually results in all the streams being closed and the final data being sent on the wire.</p></td></tr></tbody></table></div><h1 id="Interceptors-InterceptorProviders">InterceptorProviders</h1><p>Several different components inside CXF may provide interceptors to an InterceptorChain. These implement the InterceptorProvider interface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public interface InterceptorProvider {

    List&lt;Interceptor&gt; getInInterceptors();

    List&lt;Interceptor&gt; getOutInterceptors();

    List&lt;Interceptor&gt; getOutFaultInterceptors();

    List&lt;Interceptor&gt; getInFaultInterceptors();
}
</pre>
</div></div><p>To add an interceptor to an interceptor chain, you'll want to add it to one of the Interceptor Providers.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">MyInterceptor interceptor = new MyInterceptor();
provider.getInInterceptors().add(interceptor);
</pre>
</div></div><p>Some InterceptorProviders inside CXF are:</p><ul><li>Client</li><li>Endpoint</li><li>Service</li><li>Bus</li><li>Binding</li></ul><h1 id="Interceptors-WritingandconfiguringanInterceptor">Writing and configuring an Interceptor</h1><p>The CXF distribution is shipped with a demo called <a shape="rect" class="external-link" href="https://github.com/apache/cxf/tree/master/distribution/src/main/release/samples/configuration_interceptor" rel="nofollow">configuration_interceptor </a> which shows how to develop a user interceptor and configure the interceptor into its interceptor chain.</p><h2 id="Interceptors-WritinganInterceptor">Writing an Interceptor</h2><p>Writing an interceptor is relatively simple. Your interceptor needs to extend from either the AbstractPhaseInterceptor or one of its <a shape="rect" class="external-link" href="http://tinyurl.com/3bkho8" rel="nofollow">many subclasses</a> such as AbstractSoapInterceptor. Extending from AbstractPhaseInterceptor allows your interceptor to access the methods of the <a shape="rect" class="external-link" href="http://tinyurl.com/24gj28" rel="nofollow">Message</a> interface. For example, AttachmentInInterceptor is used in CXF to turn a multipart/related message into a series of attachments. It looks like below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import java.io.IOException;

import org.apache.cxf.attachment.AttachmentDeserializer;
import org.apache.cxf.message.Message;
import org.apache.cxf.phase.AbstractPhaseInterceptor;
import org.apache.cxf.phase.Phase;

public class AttachmentInInterceptor extends AbstractPhaseInterceptor&lt;Message&gt; {
    public AttachmentInInterceptor() {
        super(Phase.RECEIVE);
    }

    public void handleMessage(Message message) {
        String contentType = (String) message.get(Message.CONTENT_TYPE);
        if (contentType != null &amp;&amp; contentType.toLowerCase().indexOf("multipart/related") != -1) {
            AttachmentDeserializer ad = new AttachmentDeserializer(message);
            try {
                ad.initializeAttachments();
            } catch (IOException e) {
                throw new Fault(e);
            }
        }
    }

    public void handleFault(Message messageParam) {
    }
}
</pre>
</div></div><p>Extending from sub-classes of AbstractPhaseInterceptor allows your interceptor to access more specific information than those in the Message interface. One of the sub-classes of AbstractPhaseInterceptor is <a shape="rect" class="external-link" href="http://tinyurl.com/2xqyg6" rel="nofollow">AbstractSoapInterceptor</a>. Extending from this class allows your interceptor to access the SOAP header and version information of the <a shape="rect" class="external-link" href="http://tinyurl.com/2gxj2c" rel="nofollow">SoapMessage class</a>. For example, SoapActionInInterceptor is used in CXF to parse the SOAP action, as a simplified version of it shows below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import java.util.Collection;
import java.util.List;
import java.util.Map;

import org.apache.cxf.binding.soap.Soap11;
import org.apache.cxf.binding.soap.Soap12;
import org.apache.cxf.binding.soap.SoapMessage;
import org.apache.cxf.binding.soap.model.SoapOperationInfo;
import org.apache.cxf.endpoint.Endpoint;
import org.apache.cxf.helpers.CastUtils;
import org.apache.cxf.interceptor.Fault;
import org.apache.cxf.message.Exchange;
import org.apache.cxf.message.Message;
import org.apache.cxf.phase.Phase;
import org.apache.cxf.service.model.BindingOperationInfo;
import org.apache.cxf.service.model.OperationInfo;

public class SoapActionInInterceptor extends AbstractSoapInterceptor {

    public SoapActionInInterceptor() {
        super(Phase.READ);
        addAfter(ReadHeadersInterceptor.class.getName());
        addAfter(EndpointSelectionInterceptor.class.getName());
    }

    public void handleMessage(SoapMessage message) throws Fault {
        if (message.getVersion() instanceof Soap11) {
            Map&lt;String, List&lt;String&gt;&gt; headers = CastUtils.cast((Map)message.get(Message.PROTOCOL_HEADERS));
            if (headers != null) {
                List&lt;String&gt; sa = headers.get("SOAPAction");
                if (sa != null &amp;&amp; sa.size() &gt; 0) {
                    String action = sa.get(0);
                    if (action.startsWith("\"")) {
                        action = action.substring(1, action.length() - 1);
                    }
                    getAndSetOperation(message, action);
                }
            }
        } else if (message.getVersion() instanceof Soap12) {
          ...........
        }
    }

    private void getAndSetOperation(SoapMessage message, String action) {
        if ("".equals(action)) {
            return;
        }

        Exchange ex = message.getExchange();
        Endpoint ep = ex.get(Endpoint.class);

        BindingOperationInfo bindingOp = null;

        Collection&lt;BindingOperationInfo&gt; bops = ep.getBinding().getBindingInfo().getOperations();
        for (BindingOperationInfo boi : bops) {
            SoapOperationInfo soi = (SoapOperationInfo) boi.getExtensor(SoapOperationInfo.class);
            if (soi != null &amp;&amp; soi.getAction().equals(action)) {
                if (bindingOp != null) {
                    //more than one op with the same action, will need to parse normally
                    return;
                }
                bindingOp = boi;
            }
        }
        if (bindingOp != null) {
            ex.put(BindingOperationInfo.class, bindingOp);
            ex.put(OperationInfo.class, bindingOp.getOperationInfo());
        }
    }

}
</pre>
</div></div><p>Note that you will need to specify the phase that the interceptor will be included in. This is done in the interceptor's constructor:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public class MyInterceptor extends AbstractSoapInterceptor {
  public MyInterceptor() {
    super(Phase.USER_PROTOCOL);
  }
  ...
}
</pre>
</div></div><p>You can also express that you would like the interceptor to run before/after certain other interceptors defined in the same phase:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public class MyInterceptor extends AbstractSoapInterceptor {
  public MyInterceptor() {
    super(Phase.USER_PROTOCOL);

    // MyInterceptor needs to run after SomeOtherInterceptor
    getAfter().add(SomeOtherInterceptor.class.getName());

    // MyInterceptor needs to run before YetAnotherInterceptor
    getBefore().add(YetAnotherInterceptor.class.getName());
  }
  ...
}
</pre>
</div></div><p>You can add your interceptors into the interceptor chain either programmatically or through configuration.</p><h2 id="Interceptors-Addinginterceptorsprogrammatically">Adding interceptors programmatically</h2><p>To add this to your server, you'll want to get access to the Server object (see <a shape="rect" href="server-service-and-client-factorybeans.html">here</a> for more info):</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import org.apache.cxf.endpoint.Server;
import org.apache.cxf.frontend.ServerFactoryBean;
...

MyInterceptor myInterceptor = new MyInterceptor();

Server server = serverFactoryBean.create();
server.getEndpoint().getInInterceptor().add(myInterceptor);
</pre>
</div></div><p>On the Client side the process is very similar:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import org.apache.cxf.endpoint.Client;
import org.apache.cxf.frontend.ClientProxy;
...

MyInterceptor myInterceptor = new MyInterceptor();
FooService client = ... ; // created from ClientProxyFactoryBean or generated JAX-WS client

//You could also call clientProxyFactroyBean.getInInterceptor().add(myInterceptor) to add the interceptor

Client cxfClient = ClientProxy.getClient(client);
cxfClient.getInInterceptors().add(myInterceptor);

// then you can call the service
client.doSomething();
</pre>
</div></div><p>You can also use annotation to add the interceptors from the SEI or service class. When CXF create the server or client, CXF will add the interceptor according with the annotation.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@org.apache.cxf.interceptor.InInterceptors (interceptors = {"com.example.Test1Interceptor" })
@org.apache.cxf.interceptor.InFaultInterceptors (interceptors = {"com.example.Test2Interceptor" })
@org.apache.cxf.interceptor.OutInterceptors (interceptors = {"com.example.Test1Interceptor" })
@org.apache.cxf.interceptor.InFaultInterceptors (interceptors = {"com.example.Test2Interceptor","com.example.Test3Intercetpor" })
@WebService(endpointInterface = "org.apache.cxf.javascript.fortest.SimpleDocLitBare",
            targetNamespace = "uri:org.apache.cxf.javascript.fortest")
public class SayHiImplementation implements SayHi {
   public long sayHi(long arg) {
       return arg;
   }
   ...
}
</pre>
</div></div><h2 id="Interceptors-Addinginterceptorsthroughconfiguration">Adding interceptors through configuration</h2><p>The <a shape="rect" href="configuration.html">configuration file</a> page provides examples on using configuration files to add interceptors.</p><p>Adding MyInterceptor to the bus:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cxf="http://cxf.apache.org/core"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd"&gt;

    &lt;bean id="MyInterceptor" class="demo.interceptor.MyInterceptor"/&gt;

    &lt;!-- We are adding the interceptors to the bus as we will have only one endpoint/service/bus. --&gt;

    &lt;cxf:bus&gt;
        &lt;cxf:inInterceptors&gt;
            &lt;ref bean="MyInterceptor"/&gt;
        &lt;/cxf:inInterceptors&gt;
        &lt;cxf:outInterceptors&gt;
            &lt;ref bean="MyInterceptor"/&gt;
       &lt;/cxf:outInterceptors&gt;
    &lt;/cxf:bus&gt;
&lt;/beans&gt;

</pre>
</div></div><p>For embedded Jetty-based web services, the configuration file can be declared by starting the service with the -Dcxf.config.file=server.xml option. See the <a shape="rect" class="external-link" href="http://tinyurl.com/2c9fuf" rel="nofollow">server configuration</a> section on the configuration file page for information on specifying the file for servlet WAR file-based web service implementations.</p><p>Adding MyInterceptor to your client:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:http="http://cxf.apache.org/transports/http/configuration"
       xsi:schemaLocation="http://cxf.apache.org/transports/http/configuration http://cxf.apache.org/schemas/configuration/http-conf.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;http:conduit name="{http://apache.org/hello_world_soap_http}SoapPort9001.http-conduit"&gt;
      &lt;http:client DecoupledEndpoint="http://localhost:9990/decoupled_endpoint"/&gt;
    &lt;/http:conduit&gt;

    &lt;bean id="MyInterceptor" class="demo.interceptor.MyInterceptor"/&gt;

    &lt;!-- We are adding the interceptors to the bus as we will have only one endpoint/service/bus. --&gt;

    &lt;bean id="cxf" class="org.apache.cxf.bus.CXFBusImpl"&gt;
        &lt;property name="inInterceptors"&gt;
            &lt;ref bean="MyInterceptor"/&gt;
        &lt;/property&gt;
        &lt;property name="outInterceptors"&gt;
            &lt;ref bean="MyInterceptor"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</pre>
</div></div><p>To specify the client-side configuration file, start your client using the -Dcxf.config.file=client.xml option.</p><h2 id="Interceptors-CXFcontributedinterceptors">CXF contributed interceptors</h2><p>In CXF, all the functionality of processing messages is done via interceptors. Thus, when debugging a message flow, you will come across a bunch of interceptors in the chain. Here is a list of some of the common interceptors and the functionality they provide. The source code for these interceptors is available on <a shape="rect" class="external-link" href="https://github.com/apache/cxf/" rel="nofollow">github</a>. </p><h4 id="Interceptors-DefaultJAX-WSIncominginterceptorchain(Server):">Default JAX-WS Incoming interceptor chain (Server):</h4><ul><li><strong>AttachmentInInterceptor</strong> Parse the mime headers for mime boundaries, finds the "root" part and resets the input stream to it, and stores the other parts in a collection of Attachments</li><li><strong>StaxInInterceptor</strong> Creates an XMLStreamReader from the transport InputStream on the Message</li><li><strong>ReadHeadersInterceptor</strong> Parses the SOAP headers and stores them on the Message</li><li><strong>SoapActionInInterceptor</strong> Parses "soapaction" header and looks up the operation if a unique operation can be found for that action.</li><li><strong>MustUnderstandInterceptor</strong> Checks the MustUnderstand headers, its applicability and process it, if required</li><li><strong>SOAPHandlerInterceptor</strong> SOAP Handler as per JAX-WS</li><li><strong>LogicalHandlerInInterceptor</strong> Logical Handler as per JAX-WS</li><li><strong>CheckFaultInterceptor</strong> Checks for fault, if present aborts interceptor chain and invokes fault handler chain</li><li><strong>URIMappingInterceptor</strong> (for CXF versions &lt;= 2.x) Can handle HTTP GET, extracts operation info and sets the same in the Message</li><li><strong>DocLiteralnInterceptor</strong> Examines the first element in the SOAP body to determine the appropriate Operation (if soapAction did not find one) and calls the Databinding to read in the data.</li><li><strong>SoapHeaderInterceptor</strong> Perform databinding of the SOAP headers for headers that are mapped to parameters</li><li><strong>WrapperClassInInterceptor</strong> For wrapped doc/lit, the DocLiteralInInterceptor probably read in a single JAXB bean. This interceptor pulls the individual parts out of that bean to construct the Object[] needed to invoke the service.</li><li><strong>SwAInInterceptor</strong> For Soap w/ Attachments, finds the appropriate attachments and assigns them to the correct spot in the parameter list.</li><li><strong>HolderInInterceptor</strong> For OUT and IN/OUT parameters, JAX-WS needs to create Holder objects. This interceptor creates the Holders and puts them in the parameter list.</li><li><strong>ServiceInvokerInInterceptor</strong> Actually invokes the service.</li></ul><h3 id="Interceptors-DefaultOutgoingchainstack(Server):">Default Outgoing chain stack (Server):</h3><ul><li><strong>HolderOutInterceptor</strong> For OUT and IN/OUT params, pulls the values out of the JAX-WS Holder objects (created in HolderInInterceptor) and adds them to the param list for the out message.</li><li><strong>SwAOutInterceptor</strong> For OUT parts that are Soap attachments, pulls them from the list and holds them for later.</li><li><strong>WrapperClassOutInterceptor</strong> For doc/lit wrapped, takes the remaining parts and creates a wrapper JAXB bean to represent the whole message.</li><li><strong>SoapHeaderOutFilterInterceptor</strong> Removes inbound marked headers</li><li><strong>SoapActionOutInterceptor</strong> Sets the SOAP Action</li><li><strong>MessageSenderInterceptor</strong> Calls back to the Destination object to have it setup the output streams, headers, etc... to prepare the outgoing transport.</li><li><strong>SoapPreProtocolOutInterceptor</strong> This interceptor is responsible for setting up the SOAP version and header, so that this is available to any pre-protocol interceptors that require these to be available.</li><li><strong>AttachmentOutInterceptor</strong> If this service uses attachments (either SwA or if MTOM is enabled), it sets up the Attachment marshallers and the mime stuff that is needed.</li><li><strong>StaxOutInterceptor</strong> Creates an XMLStreamWriter from the OutputStream on the Message.</li><li><strong>SoapHandlerInterceptor</strong> JAX-WS SOAPHandler</li><li><strong>SoapOutInterceptor</strong> Writes start element for soap:envelope and complete elements for other header blocks in the message. Adds start element for soap:body too.</li><li><strong>LogicalHandlerOutInterceptor</strong> JAX-WS Logical handler stuff</li><li><strong>WrapperOutInterceptor</strong> If wrapped doc/lit and not using a wrapper bean or if RPC lit, outputs the wrapper element to the stream.</li><li><strong>BareOutInterceptor</strong> Uses the databinding to write the params out.</li><li><strong>SoapOutInterceptor$SoapOutEndingInterceptor</strong> Closes the soap:body and soap:envelope</li><li><strong>StaxOutInterceptor$StaxOutEndingInterceptor</strong> Flushes the stax stream.</li><li><strong>MessageSenderInt$MessageSenderEnding</strong> Closes the exchange, lets the transport know everything is done and should be flushed to the client.</li></ul></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </table>
   </td>
   <td id="cell-2-2" colspan="2">&nbsp;</td>
  </tr>
  <tr>
   <td id="cell-3-0">&nbsp;</td>
   <td id="cell-3-1">&nbsp;</td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">Privacy Policy</a> - 
         (<a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=49956">edit page</a>) 
	 (<a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=49956&amp;showComments=true&amp;showCommentArea=true#addcomment">add comment</a>)<br>
	Apache CXF, CXF, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.<br>
        All other marks mentioned may be trademarks or registered trademarks of their respective owners.
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3">&nbsp;</td>
   <td id="cell-3-4">&nbsp;</td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2">&nbsp;</td>
    <td id="cell-4-1">&nbsp;</td>
    <td id="cell-4-2" colspan="2">&nbsp;</td>
  </tr>
</table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
</html>

