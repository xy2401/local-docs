
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<html>
  <head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - CXF OAuth 1.0">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushBash.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>
Apache CXF -- CXF OAuth 1.0
    </title>
  </head>
<body onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tr>
    <td id="cell-0-0" colspan="2">&nbsp;</td>
    <td id="cell-0-1">&nbsp;</td>
    <td id="cell-0-2" colspan="2">&nbsp;</td>
  </tr>
  <tr>
    <td id="cell-1-0">&nbsp;</td>
    <td id="cell-1-1">&nbsp;</td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight: bold; font-size: 170%; color: white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="The Apache Sofware Foundation"><img border="0" alt="ASF Logo" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs -->
<a href="index.html">Index</a>&nbsp;&gt;&nbsp;<a href="cxf-oauth-10.html">CXF OAuth 1.0</a>
                <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">Download</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">Documentation</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </table>
      </div>
    </td>
    <td id="cell-1-3">&nbsp;</td>
    <td id="cell-1-4">&nbsp;</td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2">&nbsp;</td>
    <td id="cell-2-1">
      <table>
        <tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">Overview</a></li><li><a shape="rect" href="how-tos.html">How-Tos</a></li><li><a shape="rect" href="frontends.html">Frontends</a></li><li><a shape="rect" href="databindings.html">DataBindings</a></li><li><a shape="rect" href="transports.html">Transports</a></li><li><a shape="rect" href="configuration.html">Configuration</a></li><li><a shape="rect" href="debugging-and-logging.html">Debugging and Logging</a></li><li><a shape="rect" href="tools.html">Tools</a></li><li><a shape="rect" href="restful-services.html">RESTful Services</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL Bindings</a></li><li><a shape="rect" href="service-routing.html">Service Routing</a></li><li><a shape="rect" href="dynamic-languages.html">Dynamic Languages</a></li><li><a shape="rect" href="ws-support.html">WS-* Support</a></li><li><a shape="rect" href="advanced-integration.html">Advanced Integration</a></li><li><a shape="rect" href="deployment.html">Deployment</a></li><li><a shape="rect" href="schemas-and-namespaces.html">Use of Schemas and Namespaces</a></li></ul><hr><ul class="alternate"><li><p>Search</p></li></ul><form enctype="application/x-www-form-urlencoded" method="get" id="cse-search-box" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="Search">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x (Javadoc)</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x (Javadoc)</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF Website</a></li></ul><p>&#160;</p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="CXFOAuth1.0-CXFOAuth1.0extension">CXF OAuth 1.0 extension</h1>

<p><strong>Note</strong>: This page describes the OAuth GSOC 2009 project led by Lucasz Moren. Please go to the <a shape="rect" href="jax-rs-oauth.html">JAX-RS OAuth</a> page for an up-to-date information.  </p>

<p>CXF OAuth 1.0 extension has been build during Google Summer of Code 2010 programme. It&#160;implements specification: <a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849" rel="nofollow">The OAuth 1.0 protocol (RFC 5849)</a>&#160;&#160;and&#160;allows CXF users to build OAuth server</p>

<p>and perform&#160;OAuth 1.0 authorization on their JAXRS services in a easy manner, by hiding complex OAuth flow.&#160;</p>

<h3 id="CXFOAuth1.0-DownloadingCXFOAuth1.0module"><span style="color: rgb(0,51,102);"><strong>Downloading CXF OAuth 1.0 module</strong></span></h3>


<h3 id="CXFOAuth1.0-OAuthServerbasicconfiguration">OAuth Server basic configuration</h3>

<p>CXF, provides implementation for three endpoints from OAuth 1.0 specification:</p>
<ul><li><strong>Temporary Credentials Endpoint</strong></li><li><strong>Authorization Endpoint</strong></li><li><strong>Token Credentials Endpoint</strong></li></ul>


<p>which are usual JAX-RS resources. They allow client application to receive access token from the server required to access resources at that server.</p>

<p>Configuration is exatcly this same as for every JAX-RS service:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
&lt;!-- Publish OAuth endpoints--&gt;
&#160;&#160; &#160;&lt;jaxrs:server id="oauthServer" address="/oauth/"&gt;
&#160;&#160; &#160; &#160; &#160;&lt;jaxrs:serviceBeans&gt;
&#160;&#160; &#160; &#160; &#160; &#160; &#160;&lt;ref bean="oauthServices"/&gt;
&#160;&#160; &#160; &#160; &#160;&lt;/jaxrs:serviceBeans&gt;
&#160;&#160; &#160; &#160; &#160;&lt;jaxrs:providers&gt;
&#160;&#160; &#160; &#160; &#160; &#160; &#160;&lt;ref bean="dispatchProvider"/&gt;
&#160;&#160; &#160; &#160; &#160;&lt;/jaxrs:providers&gt;
&#160;&#160; &#160;&lt;/jaxrs:server&gt;

&#160;&#160; &#160;&lt;!--Definitions of OAuth module endpoints--&gt;
&#160;&#160; &#160;&lt;bean id="oauthServices"
&#160;&#160; &#160; &#160; &#160; &#160;class="org.apache.cxf.auth.oauth.endpoints.OAuthDefaultServices"&gt;
&#160;&#160; &#160; &#160; &#160;&lt;property name="displayVerifierURL" value="http://www.example.com/app/displayVerifier"/&gt;
&#160;&#160; &#160;&lt;/bean&gt;

&#160;&#160; &#160;&lt;!--Redirects from Resource Owner Authorization Endpoint to sign in page--&gt;
&#160;&#160; &#160;&lt;bean id="dispatchProvider"&gt;
&#160;&#160; &#160; &#160; &#160;&lt;property name="resourcePath" value="/oAuthLogin.jsp"/&gt;
&#160;&#160; &#160;&lt;/bean&gt;
</pre>
</div></div>
<p>OAuth Server requires to save and read an OAuth data (OAuth tokens, oauth_verifier, client identifier ...)&#160;from the&#160;persistence&#160;storage specific for the&#160;particural web application.&#160;</p>

<p>To make that transparent to the developers, CXF uses:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.provider.OAuthDataProvider
</pre>
</div></div>
<p>interface as an integration point between llibrary and the application. There is provided sample&#160;implementation of that interface that manages data stored in the memory:</p>


<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.provider.MemoryOauthDataProvider
</pre>
</div></div>

<p>that is located in core OAuth module and&#160;</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.demo.server.oauth.SampleOAuthDataProvider
</pre>
</div></div>
<p>in OAuth demo server module.</p>

<h2 id="CXFOAuth1.0-OAuthEndpointsexplained"><strong>OAuth Endpoints explained</strong></h2>

<h5 id="CXFOAuth1.0-TemporaryCredentials"><a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849#section-2.1" rel="nofollow">Temporary Credentials</a></h5>

<p>Client sends oauth required parameters in order to receive temporary request token. CXF handles request, validates it,&#160;reads required information about the client and</p>

<p>save state(request token returned to the client in the response) required in the next OAuth request. CXF returns OAuth 1.0a specification compliant response.</p>

<h5 id="CXFOAuth1.0-ResourceOwnerAuthorization"><a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849#section-2.2" rel="nofollow">Resource Owner Authorization</a></h5>

<p>To assure more flexible authorization and access control to the server resources there were added two custom parameters, through which client specifies<br clear="none">
what resources would like to access (scope), and how will be it accessing (permission):</p>
<ul><li><strong>x_oauth_scope</strong> - specifies comma separated server uri's to which client wants to have access</li><li><strong>x_oauth_permission</strong> - specifies comma separated list of permissions to x_oauth_scope uri's which client wants to have (every permission is associated with role, ROLE_USER, ROLE_ADMIN, etc..)</li></ul>


<p>i.e.:<br clear="none">
After granting permissions by the user to server resources, CXF saves this data that will be required in later access control evaluation, generates oauth_verifier&#160;and returns it to the client. <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-content-image-border" src="cxf-oauth-10.data/confirmation.png"></span></p>

<p><strong>Examplar screen where server user allows/denies access for a scopes and permissions requested by a third party application</strong></p>

<p>Location of above confirmation screen can be configured by registering dispatch provider as shown in&#160;OAuth Server basic configuration. CXF returns OAuth compliant errors in case of wrong client requests.&#160;</p>


<h5 id="CXFOAuth1.0-TokenCredentials"><a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849#section-2.3" rel="nofollow">Token Credentials</a></h5>

<p>Client sends request to the Authorization Server in order to exchange received in&#160;previous&#160;step&#160;<strong>oauth_verifier</strong> for an access token. Similarly in this step CXF handles request and return suitable response.<br clear="none">
If the request is correct client receives an OAuth access token.<br clear="none">
Access token give the rights to the user on the particular client to access previously authorized scopes with associated permissions.<br clear="none">
Client need to attach access token with every request to oauth protected resource. In this implementation access token, represented by a string consist information of:</p>

<ul><li>client application&#160;</li><li>resource owner which provides credentials to authorize client to the server</li><li>list of scopes accepted&#160;by the resource owner</li><li>list of permissions (list of roles)</li></ul>


<h2 id="CXFOAuth1.0-InterceptingOAuthauthenticatedrequests"><span style="color: rgb(0,51,102);">Intercepting OAuth authenticated requests</span></h2>

<p>OAuthSecurityFilter</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.interceptors.OAuthSecurityFilter
</pre>
</div></div>
<p>intercepts OAuth authenticated request perform basic OAuth validation and check if requested scope is not greater than authorized by the resource owner.</p>

<p>Initial http request is wrapped with overrided:&#160;getUserPrincipal&#160;and&#160;isUserInRole methods and passed further. OAuth security filter does not assure access control based on permissions associated with the scope. It needs to be done by developer or&#160;</p>

<p>by using: SpringOAuthAuthenticationFilter</p>

<h2 id="CXFOAuth1.0-SpringSecurityIntegration"><span style="color: rgb(0,51,102);">Spring Security Integration</span></h2>


<h3 id="CXFOAuth1.0-SpringOAuthAuthenticationFilter">SpringOAuthAuthenticationFilter</h3>

<p>Spring Security extension provides integration of OAuth flow with security annotations like: @RolesAllowed or @Secured</p>

<p>The only thing that needs to be done is adding</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.integration.spring.security.SpringOAuthAuthenticationFilter
</pre>
</div></div>
<p>configuration in web.xml file <strong>following</strong> OAuthSecurityFilter. SpringOAuthAuthenticationFilter initializes SpringSecurityContext and allows to benefit from Spring Security framework.<br clear="none">
Sample JAX-RS service could looks like:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
@Path("/")
public class SampleResourceProvider {

    @GET
    @Produces("text/html")
    @Path("/person/get/{name}")
    @Secured ({"ROLE_USER"})
    public Response getInfo(@PathParam("name") String name, @Context HttpServletRequest request) {
        return Response.ok("Successfully accessed OAuth protected person: " + name).build();
    }
}
</pre>
</div></div>

<p>In above example <em>getInfo</em> resource can be invoked only by the client which attached access token that was authorized by the resource owner with<br clear="none">
scope: /*,&#160;person/*, person/get/* or /person/get/$particular_name and with permission associated with role: ROLE_USER.</p>

<h3 id="CXFOAuth1.0-SpringSecurityExceptionMapper">SpringSecurityExceptionMapper</h3>
<p>This exception mapper converts Spring Security exceptions (i.e. AccessDeniedException) into http response that is compliant with OAuth 1.0 specification.</p>

<h2 id="CXFOAuth1.0-OAuthDemoServer"><span style="color: rgb(0,51,102);">OAuth Demo Server</span></h2>
<p>Sample implementation of an OAuth server, build with using CXF OAuth extension. Provides simple functionality for preregistering OAuth clients, viewing authorized clients and revoking access to the server.</p>

<h2 id="CXFOAuth1.0-OAuthDemoClient"><span style="color: rgb(0,51,102);">OAuth Demo Client</span></h2>
<p>OAuth 1.0 client web application that is able to make OAuth authenticated requests</p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </table>
   </td>
   <td id="cell-2-2" colspan="2">&nbsp;</td>
  </tr>
  <tr>
   <td id="cell-3-0">&nbsp;</td>
   <td id="cell-3-1">&nbsp;</td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">Privacy Policy</a> - 
         (<a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24188735">edit page</a>) 
	 (<a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=24188735&amp;showComments=true&amp;showCommentArea=true#addcomment">add comment</a>)<br>
	Apache CXF, CXF, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.<br>
        All other marks mentioned may be trademarks or registered trademarks of their respective owners.
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3">&nbsp;</td>
   <td id="cell-3-4">&nbsp;</td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2">&nbsp;</td>
    <td id="cell-4-1">&nbsp;</td>
    <td id="cell-4-2" colspan="2">&nbsp;</td>
  </tr>
</table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
</html>

