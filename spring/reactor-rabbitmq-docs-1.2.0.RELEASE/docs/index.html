<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Arnaud Cogoluègnes, Pawel Mackowski">
<title>Reactor RabbitMQ Reference Guide</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Montserrat:400,700);
@import url(https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.6.2/semantic.min.css);


/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css);

article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {
    display: block;
}

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video {
    display: inline-block;
}

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) {
    display: none;
    height: 0;
}

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template {
    display: none;
}

script {
    display: none !important;
}

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html {
    font-family: sans-serif; /* 1 */
    -ms-text-size-adjust: 100%; /* 2 */
    -webkit-text-size-adjust: 100%; /* 2 */
}

/** Remove default margin. */
body {
    margin: 0;
}

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a {
    background: transparent;
}

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus {
    outline: thin dotted;
}

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover {
    outline: 0;
}

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 {
    font-size: 2em;
    margin: 1.2em 0;
}

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] {
    border-bottom: 1px dotted;
}

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong {
    font-weight: bold;
}

/** Address styling not present in Safari 5 and Chrome. */
dfn {
    font-style: italic;
}

/** Address differences between Firefox and other browsers. */
hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/** Address styling not present in IE 8/9. */
mark {
    background: #ff0;
    color: #000;
}

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp {
    font-family: monospace, serif;
    font-size: 1em;
}

/** Improve readability of pre-formatted text in all browsers. */
pre {
    white-space: pre-wrap;
}

/** Set consistent quote types. */
q {
    quotes: "\201C" "\201D" "\2018" "\2019";
}

/** Address inconsistent and variable font size in all browsers. */
small {
    font-size: 80%;
}

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img {
    border: 0;
}

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) {
    overflow: hidden;
}

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure {
    margin: 0;
}

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend {
    border: 0; /* 1 */
    padding: 0; /* 2 */
}

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea {
    font-family: inherit; /* 1 */
    font-size: 100%; /* 2 */
    margin: 0; /* 3 */
}

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input {
    line-height: normal;
}

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select {
    text-transform: none;
}

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
}

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] {
    cursor: default;
}

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
}

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table {
    border-collapse: collapse;
    border-spacing: 0;
}

meta.foundation-mq-small {
    font-family: "only screen and (min-width: 768px)";
    width: 768px;
}

meta.foundation-mq-medium {
    font-family: "only screen and (min-width:1280px)";
    width: 1280px;
}

meta.foundation-mq-large {
    font-family: "only screen and (min-width:1440px)";
    width: 1440px;
}

*, *:before, *:after {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

html, body {
    font-size: 100%;
}

body {
    background: white;
    color: #34302d;
    padding: 0;
    margin: 0;
    font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    line-height: 1.8em;
    position: relative;
    cursor: auto;
}

#content, #content p {
    line-height: 1.8em;
}

a:hover {
    cursor: pointer;
}

img, object, embed {
    max-width: 100%;
    height: auto;
}

object, embed {
    height: 100%;
}

img {
    -ms-interpolation-mode: bicubic;
}

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object {
    max-width: none !important;
}

.left {
    float: left !important;
}

.right {
    float: right !important;
}

.text-left {
    text-align: left !important;
}

.text-right {
    text-align: right !important;
}

.text-center {
    text-align: center !important;
}

.text-justify {
    text-align: justify !important;
}

.hide {
    display: none;
}

.antialiased, body {
    -webkit-font-smoothing: antialiased;
}

img {
    display: inline-block;
    vertical-align: middle;
}

textarea {
    height: auto;
    min-height: 50px;
}

select {
    width: 100%;
}

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p {
    font-size: 1.21875em;
}

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption {
    color: #6db33f;
    font-weight: 300;
    margin-top: 0.2em;
    margin-bottom: 0.5em;
}

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td {
    margin: 0;
    padding: 0;
    direction: ltr;
}

/* Default Link Styles */
a {
    color: #6db33f;
    line-height: inherit;
    text-decoration: none;
}

a:hover, a:focus {
    color: #6db33f;
    text-decoration: underline;
}

a img {
    border: none;
}

/* Default paragraph styles */
p {
    font-family: inherit;
    font-weight: normal;
    font-size: 1em;
    margin-bottom: 1.25em;
    text-rendering: optimizeLegibility;
}

p aside {
    font-size: 0.875em;
    font-style: italic;
}

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
    font-family: "Montserrat", Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    color: #34302d;
    text-rendering: optimizeLegibility;
    margin-top: 1.6em;
    margin-bottom: 0.6em;
}

h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small {
    font-size: 60%;
    color: #6db33f;
    line-height: 0;
}

h1 {
    font-size: 2.125em;
}

h2 {
    font-size: 1.6875em;
}

h3, #toctitle, .sidebarblock > .content > .title {
    font-size: 1.375em;
}

h4 {
    font-size: 1.125em;
}

h5 {
    font-size: 1.125em;
}

h6 {
    font-size: 1em;
}

hr {
    border: solid #dcd2c9;
    border-width: 1px 0 0;
    clear: both;
    margin: 1.25em 0 1.1875em;
    height: 0;
}

/* Helpful Typography Defaults */
em, i {
    font-style: italic;
    line-height: inherit;
}

strong, b {
    font-weight: bold;
    line-height: inherit;
}

small {
    font-size: 60%;
    line-height: inherit;
}

code {
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    font-weight: bold;
    color: #305CB5;
}

/* Lists */
ul, ol, dl {
    font-size: 1em;
    margin-bottom: 1.25em;
    list-style-position: outside;
    font-family: inherit;
}

ul, ol {
    margin-left: 1.5em;
}

ul.no-bullet, ol.no-bullet {
    margin-left: 1.5em;
}

/* Unordered Lists */
ul li ul, ul li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
    font-size: 1em; /* Override nested font-size change */
}

ul.square li ul, ul.circle li ul, ul.disc li ul {
    list-style: inherit;
}

ul.square {
    list-style-type: square;
}

ul.circle {
    list-style-type: circle;
}

ul.disc {
    list-style-type: disc;
}

ul.no-bullet {
    list-style: none;
}

/* Ordered Lists */
ol li ul, ol li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
}

/* Definition Lists */
dl dt {
    margin-bottom: 0.3125em;
    font-weight: bold;
}

dl dd {
    margin-bottom: 1.25em;
}

/* Abbreviations */
abbr, acronym {
    text-transform: uppercase;
    font-size: 90%;
    color: #34302d;
    border-bottom: 1px dotted #dddddd;
    cursor: help;
}

abbr {
    text-transform: none;
}

/* Blockquotes */
blockquote {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 1px solid #dddddd;
}

blockquote cite {
    display: block;
    font-size: 0.8125em;
    color: #655241;
}

blockquote cite:before {
    content: "\2014 \0020";
}

blockquote cite a, blockquote cite a:visited {
    color: #655241;
}

blockquote, blockquote p {
    color: #34302d;
}

/* Microformats */
.vcard {
    display: inline-block;
    margin: 0 0 1.25em 0;
    border: 1px solid #dddddd;
    padding: 0.625em 0.75em;
}

.vcard li {
    margin: 0;
    display: block;
}

.vcard .fn {
    font-weight: bold;
    font-size: 0.9375em;
}

.vevent .summary {
    font-weight: bold;
}

.vevent abbr {
    cursor: auto;
    text-decoration: none;
    font-weight: bold;
    border: none;
    padding: 0 0.0625em;
}

@media only screen and (min-width: 768px) {
    h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
    }

    h1 {
        font-size: 2.75em;
    }

    h2 {
        font-size: 2.3125em;
    }

    h3, #toctitle, .sidebarblock > .content > .title {
        font-size: 1.6875em;
    }

    h4 {
        font-size: 1.4375em;
    }
}

/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only {
    display: none !important;
}

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a, a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
        content: "";
    }

    pre, blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr, img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p, h2, h3, #toctitle, .sidebarblock > .content > .title {
        orphans: 3;
        widows: 3;
    }

    h2, h3, #toctitle, .sidebarblock > .content > .title {
        page-break-after: avoid;
    }

    .hide-on-print {
        display: none !important;
    }

    .print-only {
        display: block !important;
    }

    .hide-for-print {
        display: none !important;
    }

    .show-for-print {
        display: inherit !important;
    }
}

/* Tables */
table {
    background: white;
    margin-bottom: 1.25em;
    border: solid 1px #34302d;
}

table thead, table tfoot {
    font-weight: bold;
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
    padding: 0.5em 0.625em 0.625em;
    font-size: inherit;
    color: #34302d;
    text-align: left;
}

table thead tr th {
    color: white;
    background: #34302d;
}

table tr th, table tr td {
    padding: 0.5625em 0.625em;
    font-size: inherit;
    color: #34302d;
    border: 0 none;
}

table tr.even, table tr.alt, table tr:nth-of-type(even) {
    background: #f2F2F2;
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
    display: table-cell;
}

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after {
    content: " ";
    display: table;
}

.clearfix:after, .float-group:after {
    clear: both;
}

*:not(pre) > code {
    font-size: inherit;
    padding: 0;
    white-space: nowrap;
    background-color: inherit;
    border: 0 solid #dddddd;
    -webkit-border-radius: 6px;
    border-radius: 6px;
    text-shadow: none;
}

pre, pre > code {
    color: black;
    font-family: monospace, serif;
    font-weight: normal;
}

.keyseq {
    color: #774417;
}

kbd:not(.keyseq) {
    display: inline-block;
    color: #211306;
    font-size: 0.75em;
    background-color: #F7F7F7;
    border: 1px solid #ccc;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    margin: -0.15em 0.15em 0 0.15em;
    padding: 0.2em 0.6em 0.2em 0.5em;
    vertical-align: middle;
    white-space: nowrap;
}

.keyseq kbd:first-child {
    margin-left: 0;
}

.keyseq kbd:last-child {
    margin-right: 0;
}

.menuseq, .menu {
    color: black;
}

b.button:before, b.button:after {
    position: relative;
    top: -1px;
    font-weight: normal;
}

b.button:before {
    content: "[";
    padding: 0 3px 0 2px;
}

b.button:after {
    content: "]";
    padding: 0 2px 0 3px;
}

p a > code:hover {
    color: #541312;
}

#header, #content, #footnotes, #footer {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0;
    margin-bottom: 0;
    max-width: 62.5em;
    *zoom: 1;
    position: relative;
    padding-left: 4em;
    padding-right: 4em;
}

#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after {
    content: " ";
    display: table;
}

#header:after, #content:after, #footnotes:after, #footer:after {
    clear: both;
}

#header {
    margin-bottom: 2.5em;
}

#header > h1 {
    color: #34302d;
    font-weight: 400;
}

#header span {
    color: #34302d;
}

#header #revnumber {
    text-transform: capitalize;
}

#header br {
    display: none;
}

#header br + span {
}

#revdate {
    display: block;
}

#toc {
    border-bottom: 1px solid #e6dfd8;
    padding-bottom: 1.25em;
}

#toc > ul {
    margin-left: 0.25em;
}

#toc ul.sectlevel0 > li > a {
    font-style: italic;
}

#toc ul.sectlevel0 ul.sectlevel1 {
    margin-left: 0;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}

#toc ul {
    list-style-type: none;
}

#toctitle {
    color: #385dbd;
}

@media only screen and (min-width: 768px) {
    body.toc2 {
        padding-left: 15em;
        padding-right: 0;
    }

    #toc.toc2 {
        position: fixed;
        width: 15em;
        left: 0;
        border-bottom: 0;
        z-index: 1000;
        padding: 1em;
        height: 100%;
        top: 0px;
        background: #F1F1F1;
        overflow: auto;

        -moz-transition-property: top;
        -o-transition-property: top;
        -webkit-transition-property: top;
        transition-property: top;
        -moz-transition-duration: 0.4s;
        -o-transition-duration: 0.4s;
        -webkit-transition-duration: 0.4s;
        transition-duration: 0.4s;
    }

    #reactor-header {
        position: fixed;
        top: -75px;
        left: 0;
        right: 0;
        height: 75px;


        -moz-transition-property: top;
        -o-transition-property: top;
        -webkit-transition-property: top;
        transition-property: top;
        -moz-transition-duration: 0.4s;
        -o-transition-duration: 0.4s;
        -webkit-transition-duration: 0.4s;
        transition-duration: 0.4s;
    }

    body.head-show #toc.toc2 {
        top: 75px;
    }
    body.head-show #reactor-header {
        top: 0;
    }

    #toc.toc2 a {
        color: #34302d;
        font-family: Montserrat;
    }

    #toc.toc2 #toctitle {
        margin-top: 0;
        font-size: 1.2em;
    }

    #toc.toc2 > ul {
        font-size: .90em;
    }

    #toc.toc2 ul ul {
        margin-left: 0;
        padding-left: 0.4em;
    }

    #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
        padding-left: 0;
        margin-top: 0.5em;
        margin-bottom: 0.5em;
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 15em;
    }

    body.toc2.toc-right #toc.toc2 {
        border-right: 0;
        border-left: 1px solid #e6dfd8;
        left: auto;
        right: 0;
    }
}

@media only screen and (min-width: 1280px) {
    body.toc2 {
        padding-left: 20em;
        padding-right: 0;
    }

    #toc.toc2 {
        width: 20em;
    }

    #toc.toc2 #toctitle {
        font-size: 1.375em;
    }

    #toc.toc2 > ul {
        font-size: 0.95em;
    }

    #toc.toc2 ul ul {
        padding-left: 1.25em;
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 20em;
    }
}

#content #toc {
    border-style: solid;
    border-width: 1px;
    border-color: #d9d9d9;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #f2f2f2;
    border-width: 0;
    -webkit-border-radius: 6px;
    border-radius: 6px;
}

#content #toc > :first-child {
    margin-top: 0;
}

#content #toc > :last-child {
    margin-bottom: 0;
}

#content #toc a {
    text-decoration: none;
}

#content #toctitle {
    font-weight: bold;
    font-family: "Montserrat", Arial, sans-serif;
    font-size: 1em;
    padding-left: 0.125em;
}

#footer {
    max-width: 100%;
    background-color: white;
    padding: 1.25em;
    color: #CCC;
    border-top: 3px solid #F1F1F1;
}

#footer-text {
    color: #444;
    line-height: 1.44;
}

.sect1 {
    padding-bottom: 1.25em;
}

.sect1 + .sect1 {
    border-top: 1px solid #e6dfd8;
}

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor {
    position: absolute;
    width: 1em;
    margin-left: -1em;
    display: block;
    text-decoration: none;
    visibility: hidden;
    text-align: center;
    font-weight: normal;
}

#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before {
    content: '\00A7';
    font-size: .85em;
    vertical-align: text-top;
    display: block;
    margin-top: 0.05em;
}

#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover {
    visibility: visible;
}

#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link {
    color: #34302d;
    text-decoration: none;
}

#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover {
    color: #34302d;
}

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock {
    margin-bottom: 1.25em;
    margin-top: 1.25em;
}

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title {
    text-align: left;
    font-weight: bold;
}

.tableblock > caption {
    text-align: left;
    font-weight: bold;
    white-space: nowrap;
    overflow: visible;
    max-width: 0;
}

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p {
    font-size: inherit;
}

.admonitionblock > table {
    border: 0;
    background: none;
    width: 100%;
}

.admonitionblock > table td.icon {
    text-align: center;
    width: 80px;
}

.admonitionblock > table td.icon img {
    max-width: none;
}

.admonitionblock > table td.icon .title {
    font-weight: bold;
    text-transform: uppercase;
}

.admonitionblock > table td.content {
    padding-left: 1.125em;
    padding-right: 1.25em;
    border-left: 1px solid #dcd2c9;
    color: #34302d;
}

.admonitionblock > table td.content > :last-child > :last-child {
    margin-bottom: 0;
}

.exampleblock > .content {
    border-style: solid;
    border-width: 1px;
    border-color: #f3e0ce;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: white;
    -webkit-border-radius: 6px;
    border-radius: 6px;
}

.exampleblock > .content > :first-child {
    margin-top: 0;
}

.exampleblock > .content > :last-child {
    margin-bottom: 0;
}

.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p {
    color: #333333;
}

.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 {
    margin-bottom: 0.625em;
}

.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader {
}

.exampleblock.result > .content {
    -webkit-box-shadow: 0 1px 8px #d9d9d9;
    box-shadow: 0 1px 8px #d9d9d9;
}

.sidebarblock {
    padding: 1.25em 2em;
    background: #F1F1F1;
    margin: 2em -2em;

}

.sidebarblock > :first-child {
    margin-top: 0;
}

.sidebarblock > :last-child {
    margin-bottom: 0;
}

.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p {
    color: #333333;
}

.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 {
    margin-bottom: 0.625em;
}

.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader {
}

.sidebarblock > .content > .title {
    color: #6db33f;
    margin-top: 0;
    font-size: 1.2em;
}

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child {
    margin-bottom: 0;
}

.literalblock pre:not([class]), .listingblock pre:not([class]) {
    background: url('../images/golo/pre-bg.png?1370460826');
}

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
    border-width: 1px;
    border-style: solid;
    border-color: rgba(21, 35, 71, 0.1);
    -webkit-border-radius: 6px;
    border-radius: 6px;
    padding: 0.8em;
    word-wrap: break-word;
}

.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap {
    overflow-x: auto;
    white-space: pre;
    word-wrap: normal;
}

.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code {
    display: block;
}

@media only screen {
    .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
        font-size: 0.72em;
    }
}

@media only screen and (min-width: 768px) {
    .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
        font-size: 0.81em;
    }
}

@media only screen and (min-width: 1280px) {
    .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
        font-size: 0.9em;
    }
}

.listingblock pre.highlight {
    padding: 0;
    line-height: 1em;
}

.listingblock pre.highlight > code {
    padding: 0.8em;
}

.listingblock > .content {
    position: relative;
}

.listingblock:hover code[class*=" language-"]:before {
    text-transform: uppercase;
    font-size: 0.9em;
    color: #999;
    position: absolute;
    top: 0.375em;
    right: 0.375em;
}

.listingblock:hover code.asciidoc:before {
    content: "asciidoc";
}

.listingblock:hover code.clojure:before {
    content: "clojure";
}

.listingblock:hover code.css:before {
    content: "css";
}

.listingblock:hover code.groovy:before {
    content: "groovy";
}

.listingblock:hover code.html:before {
    content: "html";
}

.listingblock:hover code.java:before {
    content: "java";
}

.listingblock:hover code.javascript:before {
    content: "javascript";
}

.listingblock:hover code.python:before {
    content: "python";
}

.listingblock:hover code.ruby:before {
    content: "ruby";
}

.listingblock:hover code.sass:before {
    content: "sass";
}

.listingblock:hover code.scss:before {
    content: "scss";
}

.listingblock:hover code.xml:before {
    content: "xml";
}

.listingblock:hover code.yaml:before {
    content: "yaml";
}

.listingblock.terminal pre .command:before {
    content: attr(data-prompt);
    padding-right: 0.5em;
    color: #999;
}

.listingblock.terminal pre .command:not([data-prompt]):before {
    content: '$';
}

table.pyhltable {
    border: 0;
    margin-bottom: 0;
}

table.pyhltable td {
    vertical-align: top;
    padding-top: 0;
    padding-bottom: 0;
}

table.pyhltable td.code {
    padding-left: .75em;
    padding-right: 0;
}

.highlight.pygments .lineno, table.pyhltable td:not(.code) {
    color: #999;
    padding-left: 0;
    padding-right: .5em;
    border-right: 1px solid #dcd2c9;
}

.highlight.pygments .lineno {
    display: inline-block;
    margin-right: .25em;
}

table.pyhltable .linenodiv {
    background-color: transparent !important;
    padding-right: 0 !important;
}

.quoteblock {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 3px solid #dddddd;
}

.quoteblock blockquote {
    margin: 0 0 1.25em 0;
    padding: 0 0 0.5625em 0;
    border: 0;
}

.quoteblock blockquote > .paragraph:last-child p {
    margin-bottom: 0;
}

.quoteblock .attribution {
    margin-top: -.25em;
    padding-bottom: 0.5625em;
    font-size: 0.8125em;
}

.quoteblock .attribution br {
    display: none;
}

.quoteblock .attribution cite {
    display: block;
    margin-bottom: 0.625em;
}

table thead th, table tfoot th {
    font-weight: bold;
}

table.tableblock.grid-all {
    border-collapse: separate;
    border-radius: 6px;
    border-top: 1px solid #34302d;
    border-bottom: 1px solid #34302d;
}

table.tableblock.frame-topbot, table.tableblock.frame-none {
    border-left: 0;
    border-right: 0;
}

table.tableblock.frame-sides, table.tableblock.frame-none {
    border-top: 0;
    border-bottom: 0;
}

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child {
    margin-bottom: 0;
}

th.tableblock.halign-left, td.tableblock.halign-left {
    text-align: left;
}

th.tableblock.halign-right, td.tableblock.halign-right {
    text-align: right;
}

th.tableblock.halign-center, td.tableblock.halign-center {
    text-align: center;
}

th.tableblock.valign-top, td.tableblock.valign-top {
    vertical-align: top;
}

th.tableblock.valign-bottom, td.tableblock.valign-bottom {
    vertical-align: bottom;
}

th.tableblock.valign-middle, td.tableblock.valign-middle {
    vertical-align: middle;
}

tbody tr th {
    display: table-cell;
    background: rgba(105, 60, 22, 0.25);
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
    color: #211306;
    font-weight: bold;
}

td > div.verse {
    white-space: pre;
}

ol {
    margin-left: 1.75em;
}

ul li ol {
    margin-left: 1.5em;
}

dl dd {
    margin-left: 1.125em;
}

dl dd:last-child, dl dd:last-child > :last-child {
    margin-bottom: 0;
}

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist {
    margin-bottom: 0.625em;
}

ul.unstyled, ol.unnumbered, ul.checklist, ul.none {
    list-style-type: none;
}

ul.unstyled, ol.unnumbered, ul.checklist {
    margin-left: 0.625em;
}

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
    margin-right: 0.25em;
}

ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
    position: relative;
    top: 1px;
}

ul.inline {
    margin: 0 auto 0.625em auto;
    margin-left: -1.375em;
    margin-right: 0;
    padding: 0;
    list-style: none;
    overflow: hidden;
}

ul.inline > li {
    list-style: none;
    float: left;
    margin-left: 1.375em;
    display: block;
}

ul.inline > li > * {
    display: block;
}

.unstyled dl dt {
    font-weight: normal;
    font-style: normal;
}

ol.arabic {
    list-style-type: decimal;
}

ol.decimal {
    list-style-type: decimal-leading-zero;
}

ol.loweralpha {
    list-style-type: lower-alpha;
}

ol.upperalpha {
    list-style-type: upper-alpha;
}

ol.lowerroman {
    list-style-type: lower-roman;
}

ol.upperroman {
    list-style-type: upper-roman;
}

ol.lowergreek {
    list-style-type: lower-greek;
}

.hdlist > table, .colist > table {
    border: 0;
    background: none;
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
    background: none;
}

td.hdlist1 {
    padding-right: .75em;
    font-weight: bold;
}

td.hdlist1, td.hdlist2 {
    vertical-align: top;
}

.literalblock + .colist, .listingblock + .colist {
    margin-top: -0.5em;
}

.colist > table tr > td:first-of-type {
    padding: 0 .75em;
}

.colist > table tr > td:last-of-type {
    padding: 0.25em 0;
}

.qanda > ol > li > p > em:only-child {
    color: #063f40;
}

.thumb, .th {
    line-height: 0;
    display: inline-block;
    border: solid 4px white;
    -webkit-box-shadow: 0 0 0 1px #dddddd;
    box-shadow: 0 0 0 1px #dddddd;
}

.imageblock.left, .imageblock[style*="float: left"] {
    margin: 0.25em 0.625em 1.25em 0;
}

.imageblock.right, .imageblock[style*="float: right"] {
    margin: 0.25em 0 1.25em 0.625em;
}

.imageblock > .title {
    margin-bottom: 0;
}

.imageblock.thumb, .imageblock.th {
    border-width: 6px;
}

.imageblock.thumb > .title, .imageblock.th > .title {
    padding: 0 0.125em;
}

.image.left, .image.right {
    margin-top: 0.25em;
    margin-bottom: 0.25em;
    display: inline-block;
    line-height: 0;
}

.image.left {
    margin-right: 0.625em;
}

.image.right {
    margin-left: 0.625em;
}

a.image {
    text-decoration: none;
}

span.footnote, span.footnoteref {
    vertical-align: super;
    font-size: 0.875em;
}

span.footnote a, span.footnoteref a {
    text-decoration: none;
}

#footnotes {
    padding-top: 0.75em;
    padding-bottom: 0.75em;
    margin-bottom: 0.625em;
}

#footnotes hr {
    width: 20%;
    min-width: 6.25em;
    margin: -.25em 0 .75em 0;
    border-width: 1px 0 0 0;
}

#footnotes .footnote {
    padding: 0 0.375em;
    font-size: 0.875em;
    margin-left: 1.2em;
    text-indent: -1.2em;
    margin-bottom: .2em;
}

#footnotes .footnote a:first-of-type {
    font-weight: bold;
    text-decoration: none;
}

#footnotes .footnote:last-of-type {
    margin-bottom: 0;
}

#content #footnotes {
    margin-top: -0.625em;
    margin-bottom: 0;
    padding: 0.75em 0;
}

.gist .file-data > table {
    border: none;
    background: #fff;
    width: 100%;
    margin-bottom: 0;
}

.gist .file-data > table td.line-data {
    width: 99%;
}

div.unbreakable {
    page-break-inside: avoid;
}

.big {
    font-size: larger;
}

.small {
    font-size: smaller;
}

.underline {
    text-decoration: underline;
}

.overline {
    text-decoration: overline;
}

.line-through {
    text-decoration: line-through;
}

.aqua {
    color: #00bfbf;
}

.aqua-background {
    background-color: #00fafa;
}

.black {
    color: black;
}

.black-background {
    background-color: black;
}

.blue {
    color: #0000bf;
}

.blue-background {
    background-color: #0000fa;
}

.fuchsia {
    color: #bf00bf;
}

.fuchsia-background {
    background-color: #fa00fa;
}

.gray {
    color: #606060;
}

.gray-background {
    background-color: #7d7d7d;
}

.green {
    color: #006000;
}

.green-background {
    background-color: #007d00;
}

.lime {
    color: #00bf00;
}

.lime-background {
    background-color: #00fa00;
}

.maroon {
    color: #600000;
}

.maroon-background {
    background-color: #7d0000;
}

.navy {
    color: #000060;
}

.navy-background {
    background-color: #00007d;
}

.olive {
    color: #606000;
}

.olive-background {
    background-color: #7d7d00;
}

.purple {
    color: #600060;
}

.purple-background {
    background-color: #7d007d;
}

.red {
    color: #bf0000;
}

.red-background {
    background-color: #fa0000;
}

.silver {
    color: #909090;
}

.silver-background {
    background-color: #bcbcbc;
}

.teal {
    color: #006060;
}

.teal-background {
    background-color: #007d7d;
}

.white {
    color: #bfbfbf;
}

.white-background {
    background-color: #fafafa;
}

.yellow {
    color: #bfbf00;
}

.yellow-background {
    background-color: #fafa00;
}

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] {
    cursor: default;
}

.admonitionblock td.icon [class^="icon-"]:before {
    font-size: 2.5em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    cursor: default;
}

.admonitionblock td.icon .icon-note:before {
    content: "\f05a";
    color: #095557;
    color: #064042;
}

.admonitionblock td.icon .icon-tip:before {
    content: "\f0eb";
    text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8);
    color: #111;
}

.admonitionblock td.icon .icon-warning:before {
    content: "\f071";
    color: #bf6900;
}

.admonitionblock td.icon .icon-caution:before {
    content: "\f06d";
    color: #bf3400;
}

.admonitionblock td.icon .icon-important:before {
    content: "\f06a";
    color: #bf0000;
}

.conum {
    display: inline-block;
    color: white !important;
    background-color: #211306;
    -webkit-border-radius: 100px;
    border-radius: 100px;
    text-align: center;
    width: 20px;
    height: 20px;
    font-size: 12px;
    font-weight: bold;
    line-height: 20px;
    font-family: Arial, sans-serif;
    font-style: normal;
    position: relative;
    top: -2px;
    letter-spacing: -1px;
}

.conum * {
    color: white !important;
}

.conum + b {
    display: none;
}

.conum:after {
    content: attr(data-value);
}

.conum:not([data-value]):empty {
    display: none;
}

body {
    padding-top: 60px;
}

#toc.toc2 ul ul {
    padding-left: 1em;
}
#toc.toc2 ul ul.sectlevel2 {
}

#toctitle {
    color: #34302d;
    display: none;
}

#header h1 {
    font-weight: bold;
    position: relative;
    left: -0.0625em;
}

#header h1 span.lo {
    color: #dc9424;
}

#content h2, #content h3, #content #toctitle, #content .sidebarblock > .content > .title, #content h4, #content h5, #content #toctitle {
    font-weight: normal;
    position: relative;
    left: -0.0625em;
}

#content h2 {
    font-weight: bold;
}

.literalblock .content pre.highlight, .listingblock .content pre.highlight {
    background: url('../images/golo/pre-bg.png?1370460826');
}

.admonitionblock > table td.content {
    border-color: #e6dfd8;
}

table.tableblock.grid-all {
    -webkit-border-radius: 0;
    border-radius: 0;
}

#footer {
    background-color: #while;
    color: #34302d;
}

.imageblock .title {
    text-align: center;
}

#content h1.sect0 {
    font-size: 48px;
}

#toc > ul > li > a {
    font-size: large;
}




@import url(https://fonts.googleapis.com/css?family=Montserrat:400,700|Karla:400,700);
body {
}
#reactor-header {
    background: #34302d;
    border-top: 4px solid #6db33f;
    z-index: 2000;
    font-family: 'Montserrat';
    height: 75px;
}

#reactor-header h1#logo {
    margin: 7px 0 0 10px;
    padding: 0;
    float: left;
}

#reactor-header h1#logo a {
    display: block;
    background: url(images/logo-2x.png) no-repeat 0 0;
    background-size: 253px 80px;
    height: 40px;
    width: 253px;
    text-indent: -6000em;
    margin: 8px 0;
}
#reactor-header h1#logo a:hover strong {
    filter: progid:DXImageTransform.Microsoft.Alpha(enabled=false);
    opacity: 1;
}
#reactor-header h1#logo a strong {
    display: block;
    background: url(images/logo-2x.png) no-repeat 0 -30px;
    background-size: 190px 60px;
    height: 30px;
    width: 190px;
    text-indent: -6000em;
    margin: 8px 0;
    -moz-transition-property: opacity;
    -o-transition-property: opacity;
    -webkit-transition-property: opacity;
    transition-property: opacity;
    -moz-transition-duration: 0.2s;
    -o-transition-duration: 0.2s;
    -webkit-transition-duration: 0.2s;
    transition-duration: 0.2s;
    filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0);
    opacity: 0;
}

#nav, #nav ul {
    display: block;
    margin: 0;
    padding: 0;
}
#nav {
    float: right;
    margin-right: 10px;
}
#nav ul li {
    display: block;
    float: left;
    list-style: none;
    margin: 0;
    padding: 0;
}
#nav ul li a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    display: block;
    text-transform: uppercase;
    font-size: 13.5px;
    line-height: 71px;
    margin: 0;
    padding: 0 12px;
    -moz-transition-property: background-color;
    -o-transition-property: background-color;
    -webkit-transition-property: background-color;
    transition-property: background-color;
    -moz-transition-duration: 0.2s;
    -o-transition-duration: 0.2s;
    -webkit-transition-duration: 0.2s;
    transition-duration: 0.2s;
}
#nav ul li a:hover {
    background: #6db33f;
}
#nav ul li a.active {
    background: #6db33f;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Reactor RabbitMQ Reference Guide</h1>
<div class="details">
<span id="author" class="author">Arnaud Cogoluègnes, Pawel Mackowski</span><br>
<span id="revdate">1.2.0.RELEASE</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#rabbitmq">1.1. RabbitMQ</a></li>
<li><a href="#_project_reactor">1.2. Project Reactor</a></li>
<li><a href="#_reactive_api_for_rabbitmq">1.3. Reactive API for RabbitMQ</a></li>
</ul>
</li>
<li><a href="#_motivation">2. Motivation</a>
<ul class="sectlevel2">
<li><a href="#motivation-functional">2.1. Functional interface for RabbitMQ</a></li>
<li><a href="#back-pressure">2.2. Non-blocking Back-pressure</a></li>
<li><a href="#end-to-end-reactive">2.3. End-to-end Reactive Pipeline</a></li>
<li><a href="#comparison">2.4. Comparisons with other RabbitMQ Java libraries</a>
<ul class="sectlevel3">
<li><a href="#_rabbitmq_java_client">2.4.1. RabbitMQ Java Client</a></li>
<li><a href="#_spring_amqp">2.4.2. Spring AMQP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_getting_started">3. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#Requirements">3.1. Requirements</a></li>
<li><a href="#_quick_start">3.2. Quick Start</a>
<ul class="sectlevel3">
<li><a href="#_start_rabbitmq">3.2.1. Start RabbitMQ</a></li>
<li><a href="#_run_reactor_rabbitmq_samples">3.2.2. Run Reactor RabbitMQ Samples</a>
<ul class="sectlevel4">
<li><a href="#_sample_sender">Sample Sender</a></li>
<li><a href="#_sample_receiver">Sample Receiver</a></li>
<li><a href="#_sample_spring_boot_application">Sample Spring Boot Application</a></li>
</ul>
</li>
<li><a href="#_building_reactor_rabbitmq_applications">3.2.3. Building Reactor RabbitMQ Applications</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_additional_resources">4. Additional Resources</a>
<ul class="sectlevel2">
<li><a href="#support">4.1. Getting help</a></li>
<li><a href="#resources">4.2. Resources</a></li>
</ul>
</li>
<li><a href="#_new_noteworthy">5. New &amp; Noteworthy</a>
<ul class="sectlevel2">
<li><a href="#new">5.1. What&#8217;s new in Reactor RabbitMQ 1.2</a></li>
<li><a href="#_what_s_new_in_reactor_rabbitmq_1_1">5.2. What&#8217;s new in Reactor RabbitMQ 1.1</a></li>
<li><a href="#_what_s_new_in_reactor_rabbitmq_1_0">5.3. What&#8217;s new in Reactor RabbitMQ 1.0</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_reference_documentation">Reference Documentation</a>
<ul class="sectlevel1">
<li><a href="#_reactor_rabbitmq_api">6. Reactor RabbitMQ API</a>
<ul class="sectlevel2">
<li><a href="#api-guide-overview">6.1. Overview</a></li>
<li><a href="#api-guide-sender">6.2. Reactive RabbitMQ Sender</a>
<ul class="sectlevel3">
<li><a href="#_managing_resources_exchanges_queues_and_bindings">6.2.1. Managing resources (exchanges, queues, and bindings)</a></li>
<li><a href="#_reliable_publishing_with_publisher_confirms">6.2.2. Reliable publishing with publisher confirms</a></li>
<li><a href="#_threading_model">6.2.3. Threading model</a></li>
<li><a href="#_closing_the_code_sender_code">6.2.4. Closing the <code>Sender</code></a></li>
<li><a href="#_error_handling_during_publishing">6.2.5. Error handling during publishing</a></li>
<li><a href="#_request_reply">6.2.6. Request/reply</a></li>
</ul>
</li>
<li><a href="#api-guide-receiver">6.3. Reactive RabbitMQ Receiver</a>
<ul class="sectlevel3">
<li><a href="#_consuming_options">6.3.1. Consuming options</a></li>
<li><a href="#_acknowledgment">6.3.2. Acknowledgment</a></li>
<li><a href="#_closing_the_code_receiver_code">6.3.3. Closing the <code>Receiver</code></a></li>
<li><a href="#_connection_failure">6.3.4. Connection failure</a></li>
</ul>
</li>
<li><a href="#api-guide-advanced-features">6.4. Advanced features</a>
<ul class="sectlevel3">
<li><a href="#_creating_a_connection_with_a_custom_code_mono_code">6.4.1. Creating a connection with a custom <code>Mono</code></a></li>
<li><a href="#_sharing_the_same_connection_between_code_sender_code_and_code_receiver_code">6.4.2. Sharing the same connection between <code>Sender</code> and <code>Receiver</code></a></li>
<li><a href="#_creating_channels_with_a_custom_code_mono_code_in_code_sender_code">6.4.3. Creating channels with a custom <code>Mono</code> in <code>Sender</code></a></li>
<li><a href="#_threading_considerations_for_resource_management">6.4.4. Threading considerations for resource management</a></li>
<li><a href="#_channel_pooling_in_code_sender_code">6.4.5. Channel pooling in <code>Sender</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_introduction" class="sect0">Introduction</h1>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="rabbitmq">1.1. RabbitMQ</h3>
<div class="paragraph">
<p>With more than 35,000 production deployments world-wide
at small startups and large enterprises, <a href="https://rabbitmq.com/">RabbitMQ</a> is the most popular
open source message broker.</p>
</div>
<div class="paragraph">
<p>RabbitMQ is lightweight and easy to deploy on premises and in the cloud.
It supports multiple messaging protocols. RabbitMQ can be deployed in
distributed and federated configurations to meet high-scale, high-availability requirements.</p>
</div>
</div>
<div class="sect2">
<h3 id="_project_reactor">1.2. Project Reactor</h3>
<div class="paragraph">
<p><a href="https://projectreactor.io">Reactor</a> is a highly optimized reactive library for
building efficient, non-blocking applications on the JVM based on the
<a href="https://github.com/reactive-streams/reactive-streams-jvm">Reactive Streams Specification</a>.
Reactor based applications can sustain very high throughput message rates
and operate with a very low memory footprint,
making it suitable for building efficient event-driven applications using
the microservices architecture.</p>
</div>
<div class="paragraph">
<p>Reactor implements two publishers
<a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux&lt;T&gt;</a> and
<a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono&lt;T&gt;</a>,
both of which support non-blocking back-pressure.
This enables exchange of data between threads with well-defined memory usage,
avoiding unnecessary intermediate buffering or blocking.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reactive_api_for_rabbitmq">1.3. Reactive API for RabbitMQ</h3>
<div class="paragraph">
<p><a href="../api/index.html">Reactor RabbitMQ</a> is a reactive API for RabbitMQ
based on Reactor and <a href="https://www.rabbitmq.com/api-guide.html">RabbitMQ Java Client</a>.
Reactor RabbitMQ API enables messages to be published to
RabbitMQ and consumed from RabbitMQ using functional APIs
with non-blocking back-pressure and very low overheads.
This enables applications using Reactor to use RabbitMQ as a message bus or
streaming platform and integrate with other systems to provide an end-to-end
reactive pipeline.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">2. Motivation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="motivation-functional">2.1. Functional interface for RabbitMQ</h3>
<div class="paragraph">
<p>Reactor RabbitMQ is a functional Java API for RabbitMQ.
For applications that are written in functional style,
this API enables RabbitMQ interactions to be integrated
easily without requiring non-functional produce or consume APIs to be
incorporated into the application logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="back-pressure">2.2. Non-blocking Back-pressure</h3>
<div class="paragraph">
<p>The Reactor RabbitMQ API benefits from non-blocking back-pressure
provided by Reactor. For example, in a pipeline, where
messages received from an external source (e.g. an HTTP proxy) are published
to RabbitMQ, back-pressure can be applied easily to the
whole pipeline, limiting the number of messages in-flight and controlling memory usage.
Messages flow through the pipeline as they are available,
with Reactor taking care of limiting the flow rate to avoid overflow,
keeping application logic simple.</p>
</div>
</div>
<div class="sect2">
<h3 id="end-to-end-reactive">2.3. End-to-end Reactive Pipeline</h3>
<div class="paragraph">
<p>The value proposition for Reactor RabbitMQ is the efficient utilization of resources
in applications with multiple external interactions where RabbitMQ is one of the
external systems. End-to-end reactive pipelines benefit from
non-blocking back-pressure and efficient use of threads, enabling a
large number of concurrent requests to be processed efficiently.
The optimizations provided by Project Reactor enable development of reactive applications
with very low overheads and predictable capacity planning to deliver low-latency,
high-throughput pipelines.</p>
</div>
</div>
<div class="sect2">
<h3 id="comparison">2.4. Comparisons with other RabbitMQ Java libraries</h3>
<div class="paragraph">
<p>Reactor RabbitMQ is not intended to replace any of the existing Java libraries.
Instead, it is aimed at providing an alternative API for reactive event-driven applications.</p>
</div>
<div class="sect3">
<h4 id="_rabbitmq_java_client">2.4.1. RabbitMQ Java Client</h4>
<div class="paragraph">
<p>For non-reactive applications, <a href="https://www.rabbitmq.com/api-guide.html">RabbitMQ Java Client</a>
provides the most complete API to manage resources, publish messages to and
consume messages from RabbitMQ. Note Reactor RabbitMQ is based on RabbitMQ Java Client.</p>
</div>
<div class="paragraph">
<p>Applications using RabbitMQ as a message bus using this API may consider
switching to Reactor RabbitMQ if the application is implemented in a functional style.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring_amqp">2.4.2. Spring AMQP</h4>
<div class="paragraph">
<p><a href="https://projects.spring.io/spring-amqp/">Spring AMQP</a> applies core
<a href="https://projects.spring.io/spring-framework/">Spring Framework</a>
concepts to the development of AMQP-based messaging solutions.
It provides a "template" as a high-level abstraction for sending and receiving messages.
It also provides support for Message-driven POJOs with a "listener container".
These libraries facilitate management of AMQP resources while promoting the use of
dependency injection and declarative configuration. Spring AMQP is based on
RabbitMQ Java Client.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">3. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Requirements">3.1. Requirements</h3>
<div class="paragraph">
<p>You need Java JRE installed (Java 8 or later).</p>
</div>
<div class="paragraph">
<p>You also need to install RabbitMQ. Follow the
<a href="https://www.rabbitmq.com/download.html">instructions from the website</a>.
Note you should use RabbitMQ 3.6.x or later.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quick_start">3.2. Quick Start</h3>
<div class="paragraph">
<p>This quick start tutorial sets up a single node RabbitMQ and runs the sample reactive
sender and consumer.</p>
</div>
<div class="sect3">
<h4 id="_start_rabbitmq">3.2.1. Start RabbitMQ</h4>
<div class="paragraph">
<p>Start RabbitMQ on your local machine with all the defaults (e.g. AMQP port is 5672).</p>
</div>
</div>
<div class="sect3">
<h4 id="_run_reactor_rabbitmq_samples">3.2.2. Run Reactor RabbitMQ Samples</h4>
<div class="paragraph">
<p>Download Reactor RabbitMQ from <a href="https://github.com/reactor/reactor-rabbitmq/" class="bare">github.com/reactor/reactor-rabbitmq/</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; git clone https://github.com/reactor/reactor-rabbitmq
&gt; cd reactor-rabbitmq</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_sample_sender">Sample Sender</h5>
<div class="paragraph">
<p>The <a href="https://github.com/reactor/reactor-rabbitmq/blob/master/reactor-rabbitmq-samples/src/main/java/reactor/rabbitmq/samples/SampleSender.java"><code>SampleSender</code></a>
code is on GitHub.</p>
</div>
<div class="paragraph">
<p>Run the sample sender:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; ./gradlew -q sender
10:20:12.590 INFO r.rabbitmq.samples.SampleSender - Message Message_1 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_2 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_3 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_4 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_5 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_6 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_7 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_8 sent successfully
10:20:12.596 INFO r.rabbitmq.samples.SampleSender - Message Message_9 sent successfully
10:20:12.597 INFO r.rabbitmq.samples.SampleSender - Message Message_10 sent successfully
10:20:12.597 INFO r.rabbitmq.samples.SampleSender - Message Message_11 sent successfully
10:20:12.597 INFO r.rabbitmq.samples.SampleSender - Message Message_12 sent successfully
10:20:12.599 INFO r.rabbitmq.samples.SampleSender - Message Message_13 sent successfully
10:20:12.600 INFO r.rabbitmq.samples.SampleSender - Message Message_14 sent successfully
10:20:12.600 INFO r.rabbitmq.samples.SampleSender - Message Message_15 sent successfully
10:20:12.600 INFO r.rabbitmq.samples.SampleSender - Message Message_16 sent successfully
10:20:12.600 INFO r.rabbitmq.samples.SampleSender - Message Message_17 sent successfully
10:20:12.600 INFO r.rabbitmq.samples.SampleSender - Message Message_18 sent successfully
10:20:12.601 INFO r.rabbitmq.samples.SampleSender - Message Message_19 sent successfully
10:20:12.601 INFO r.rabbitmq.samples.SampleSender - Message Message_20 sent successfully</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SampleSender</code> sends 20 messages to the <code>demo-queue</code> queue, with publisher
confirms enabled. The log line for a given message is printed to the console
when the publisher confirmation is received from the broker.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sample_receiver">Sample Receiver</h5>
<div class="paragraph">
<p>The <a href="https://github.com/reactor/reactor-rabbitmq/blob/master/reactor-rabbitmq-samples/src/main/java/reactor/rabbitmq/samples/SampleReceiver.java"><code>SampleReceiver</code></a>
code is on GitHub.</p>
</div>
<div class="paragraph">
<p>Run the sample receiver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; ./gradlew -q receiver
10:22:43.568 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_1
10:22:43.575 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_2
10:22:43.576 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_3
10:22:43.576 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_4
10:22:43.576 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_5
10:22:43.576 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_6
10:22:43.576 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_7
10:22:43.576 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_8
10:22:43.577 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_9
10:22:43.577 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_10
10:22:43.577 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_11
10:22:43.577 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_12
10:22:43.577 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_13
10:22:43.577 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_14
10:22:43.577 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_15
10:22:43.578 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_16
10:22:43.578 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_17
10:22:43.578 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_18
10:22:43.578 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_19
10:22:43.578 INFO r.rabbitmq.samples.SampleReceiver - Received message Message_20</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SampleReceiver</code> consumes messages from the <code>demo-queue</code> queue and logs
the message content in the console.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sample_spring_boot_application">Sample Spring Boot Application</h5>
<div class="paragraph">
<p>The <a href="https://github.com/reactor/reactor-rabbitmq/blob/master/reactor-rabbitmq-samples/src/main/java/reactor/rabbitmq/samples/SpringBootSample.java"><code>SpringBootSample</code></a>
code is on GitHub.</p>
</div>
<div class="paragraph">
<p>Run the sample Spring Boot application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; ./gradlew -q springboot
...
11:47:43.837 INFO r.rabbitmq.samples.SpringBootSample - Sending messages...
11:47:43.846 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_1
11:47:43.849 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_2
11:47:43.850 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_3
11:47:43.850 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_4
11:47:43.851 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_5
11:47:43.851 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_6
11:47:43.851 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_7
11:47:43.851 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_8
11:47:43.851 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_9
11:47:43.851 INFO r.rabbitmq.samples.SpringBootSample - Received message Message_10</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring Boot sample publishes messages with a <code>Sender</code> and consumes them with
a <code>Receiver</code>. This application illustrates how to configure Reactor RabbitMQ in a Spring
Boot environment.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_reactor_rabbitmq_applications">3.2.3. Building Reactor RabbitMQ Applications</h4>
<div class="paragraph">
<p>To build your own application using the Reactor RabbitMQ API,
you need to include a dependency to Reactor RabbitMQ.</p>
</div>
<div class="paragraph">
<p>For gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.projectreactor.rabbitmq:reactor-rabbitmq:1.2.0.RELEASE</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.projectreactor.rabbitmq<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>reactor-rabbitmq<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.2.0.RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using a milestone or a release candidate, you need to add the Spring IO
milestone repository.</p>
</div>
<div class="paragraph">
<p>For gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
  maven { url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.spring.io/milestone</span><span class="delimiter">'</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repositories&gt;</span>
    <span class="tag">&lt;repository&gt;</span>
        <span class="tag">&lt;id&gt;</span>spring-milestones<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;name&gt;</span>Spring Milestones<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;url&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/url&gt;</span>
        <span class="tag">&lt;snapshots&gt;</span>
            <span class="tag">&lt;enabled&gt;</span>false<span class="tag">&lt;/enabled&gt;</span>
        <span class="tag">&lt;/snapshots&gt;</span>
    <span class="tag">&lt;/repository&gt;</span>
<span class="tag">&lt;/repositories&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources">4. Additional Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="support">4.1. Getting help</h3>
<div class="paragraph">
<p>If you are having trouble with Reactor RabbitMQ, you can ask for help on
<a href="https://groups.google.com/forum/#!forum/rabbitmq-users">RabbitMQ community mailing list</a>.</p>
</div>
<div class="paragraph">
<p>Report bugs in Reactor RabbitMQ at <a href="https://github.com/reactor/reactor-rabbitmq/issues" class="bare">github.com/reactor/reactor-rabbitmq/issues</a>.</p>
</div>
<div class="paragraph">
<p>Reactor Rabbitmq is open source and the code and documentation are available
at <a href="https://github.com/reactor/reactor-rabbitmq" class="bare">github.com/reactor/reactor-rabbitmq</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="resources">4.2. Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/reactor/reactor-rabbitmq">Reactor RabbitMQ on github</a></p>
</li>
<li>
<p><a href="https://www.rabbitmq.com/documentation.html">RabbitMQ</a></p>
</li>
<li>
<p><a href="https://projectreactor.io/">Project Reactor</a></p>
</li>
<li>
<p><a href="https://github.com/reactor/reactor-core">Reactor Core</a></p>
</li>
<li>
<p><a href="https://github.com/reactive-streams/reactive-streams-jvm">Reactive Streams Specification</a></p>
</li>
<li>
<p><a href="https://spring.io/blog/2016/04/19/understanding-reactive-types">Understanding Reactive types</a></p>
</li>
<li>
<p><a href="https://github.com/reactor/lite-rx-api-hands-on">Lite Rx API Hands-on</a></p>
</li>
<li>
<p><a href="https://www.infoq.com/articles/reactor-by-example">Reactor by Example</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_noteworthy">5. New &amp; Noteworthy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="new">5.1. What&#8217;s new in Reactor RabbitMQ 1.2</h3>
<div class="ulist">
<ul>
<li>
<p>Limit in-flight records in publisher confirms if requested</p>
</li>
<li>
<p>Implement back pressure in publisher confirms support</p>
</li>
<li>
<p>Use Reactor 3.2.8.RELEASE</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_what_s_new_in_reactor_rabbitmq_1_1">5.2. What&#8217;s new in Reactor RabbitMQ 1.1</h3>
<div class="ulist">
<ul>
<li>
<p>Let user provide <code>Mono&lt;Channel&gt;</code> for sending messages</p>
</li>
<li>
<p>Add optional channel pooling for sending messages</p>
</li>
<li>
<p>Automatically retry on ack and nack</p>
</li>
<li>
<p>Use Reactor 3.2.5.RELEASE</p>
</li>
<li>
<p>Use Java client 5.6.0</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_what_s_new_in_reactor_rabbitmq_1_0">5.3. What&#8217;s new in Reactor RabbitMQ 1.0</h3>
<div class="ulist">
<ul>
<li>
<p>Introduction of the <code>Sender</code> and <code>Receiver</code> API</p>
</li>
<li>
<p>Support for request/reply</p>
</li>
<li>
<p>Exception handling</p>
</li>
<li>
<p>Let user provide <code>Mono&lt;Channel&gt;</code> for resource management</p>
</li>
<li>
<p>Complete receiving flux on channel termination</p>
</li>
<li>
<p>Handle error signal of <code>connectionMono</code> subscription to enable proper error handling</p>
</li>
<li>
<p>Use Reactor 3.2.3.RELEASE</p>
</li>
<li>
<p>Use Java client 5.5.1</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_reference_documentation" class="sect0">Reference Documentation</h1>
<div class="sect1">
<h2 id="_reactor_rabbitmq_api">6. Reactor RabbitMQ API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="api-guide-overview">6.1. Overview</h3>
<div class="paragraph">
<p>This section describes the reactive API for producing and consuming messages using RabbitMQ.
There are two main classes in Reactor RabbitMQ:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>reactor.rabbitmq.Sender</code> for publishing messages to RabbitMQ</p>
</li>
<li>
<p><code>reactor.rabbitmq.Receiver</code> for consuming messages from RabbitMQ</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Full API for Reactor RabbitMQ is available in the <a href="../api/index.html">javadocs</a>.</p>
</div>
<div class="paragraph">
<p>The project uses <a href="https://github.com/reactor/reactor-core">Reactor Core</a> to expose a <a href="https://github.com/reactive-streams/reactive-streams-jvm">"Reactive Streams"</a> API.</p>
</div>
</div>
<div class="sect2">
<h3 id="api-guide-sender">6.2. Reactive RabbitMQ Sender</h3>
<div class="paragraph">
<p>Outbound messages are sent to RabbitMQ using <code>reactor.rabbitmq.Sender</code>.
A <code>Sender</code> is associated with one RabbitMQ <code>Connection</code> that is used
to transport messages to the broker. A <code>Sender</code> can also manage resources
(exchanges, queues, bindings).</p>
</div>
<div class="paragraph">
<p>A <code>Sender</code> is created with an instance of sender configuration options
<code>reactor.rabbitmq.SenderOptions</code>.
The properties of <code>SenderOptions</code> contains the <code>ConnectionFactory</code> that creates
connections to the broker and some Reactor <code>Scheduler`s used by the `Sender</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();
connectionFactory.useNio();

SenderOptions senderOptions =  <span class="keyword">new</span> SenderOptions()
    .connectionFactory(connectionFactory)                         <i class="conum" data-value="1"></i><b>(1)</b>
    .resourceManagementScheduler(Schedulers.elastic());           <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify connection factory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify scheduler for resource management</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note you can control the creation of the <code>Connection</code> thanks to the
<code>connectionSupplier(ConnectionFactory)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SenderOptions senderOptions =  <span class="keyword">new</span> SenderOptions()
    .connectionFactory(connectionFactory)
    .connectionSupplier(cf -&gt; cf.newConnection(                                  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">new</span> Address<span class="type">[]</span> {<span class="keyword">new</span> Address(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.1</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> Address(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.2</span><span class="delimiter">&quot;</span></span>)},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">reactive-sender</span><span class="delimiter">&quot;</span></span>))
    .resourceManagementScheduler(Schedulers.elastic());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify array of addresses and connection name</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the snippet above the connection can be created from 2 different nodes (useful for
failover) and the connection name is set up.</p>
</div>
<div class="paragraph">
<p>Once the required options have been configured on the options instance,
a new <code>Sender</code> instance can be created with the options already
configured in <code>senderOptions</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Sender sender = RabbitFlux.createSender(senderOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Sender</code> is now ready to send messages to RabbitMQ.
At this point, a <code>Sender</code> instance has been created,
but no connections to RabbitMQ have been made yet.
The underlying <code>Connection</code> instance is created lazily
when a first call is made to create a resource or to send messages.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now create a sequence of messages to send to RabbitMQ.
Each outbound message to be sent to RabbitMQ is represented as a <code>OutboundMessage</code>.
An <code>OutboundMessage</code> contains routing information (exchange to send to and routing key)
as well as the message itself (properties and body).</p>
</div>
<div class="paragraph">
<p>A <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux&lt;OutboundMessage&gt;</a>
of messages is created for sending to RabbitMQ.
For beginners, <a href="https://github.com/reactor/lite-rx-api-hands-on">Lite Rx API Hands-on</a>
provides a hands-on tutorial on using the Reactor classes <code>Flux</code> and <code>Mono</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux&lt;OutboundMessage&gt; outboundFlux  =
    Flux.range(<span class="integer">1</span>, <span class="integer">10</span>)
        .map(i -&gt; <span class="keyword">new</span> OutboundMessage(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">amq.direct</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">routing.key</span><span class="delimiter">&quot;</span></span>, (<span class="string"><span class="delimiter">&quot;</span><span class="content">Message </span><span class="delimiter">&quot;</span></span> + i).getBytes()
        ));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code segment above creates a sequence of messages to send to RabbitMQ.
The outbound Flux can now be sent to RabbitMQ using the
<code>Sender</code> created earlier.</p>
</div>
<div class="paragraph">
<p>The code segment below sends the messages to RabbitMQ. The final <code>subscribe()</code> in the code block
requests upstream to send the messages to RabbitMQ.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sender.send(outboundFlux)                         <i class="conum" data-value="1"></i><b>(1)</b>
    .doOnError(e -&gt; log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Send failed</span><span class="delimiter">&quot;</span></span>, e))  <i class="conum" data-value="2"></i><b>(2)</b>
    .subscribe();                                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reactive send operation for the outbound Flux</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the sending fails, log an error</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Subscribe to trigger the actual flow of records from <code>outboundFlux</code> to RabbitMQ.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/reactor/reactor-rabbitmq/blob/master/reactor-rabbitmq-samples/src/main/java/reactor/rabbitmq/samples/SampleSender.java">SampleSender</a>
for a full code listing for a <code>Sender</code>.</p>
</div>
<div class="sect3">
<h4 id="_managing_resources_exchanges_queues_and_bindings">6.2.1. Managing resources (exchanges, queues, and bindings)</h4>
<div class="paragraph">
<p>The <code>Sender</code> is also able to declare and delete AMQP resources the reactive way.
You can learn more about the <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html">AMQP
model on RabbitMQ website</a>.</p>
</div>
<div class="paragraph">
<p><code>Sender</code> has a <code>declare*</code> method for each type of resource
(exchange, binding, and queue) and there&#8217;s also a respective <code>*Specification</code>
class to describe each creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Mono&lt;AMQP.Exchange.DeclareOk&gt; exchange = sender.declareExchange(
    ExchangeSpecification.exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>)
);
Mono&lt;AMQP.Queue.DeclareOk&gt; queue = sender.declareQueue(
    QueueSpecification.queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>)
);
Mono&lt;AMQP.Queue.BindOk&gt; binding = sender.bind(
    BindingSpecification.binding().exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>)
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>).routingKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">a.b</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>Sender#declare*</code> methods return their respective AMQP results
wrapped into a <code>Mono</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For queue creation, note that if a queue specification has a
null name, the queue to be created will have a server-generated name
and will be non-durable, exclusive, and auto-delete. If you want
a queue to have a server-generated name but other parameters,
specify an empty name <code>""</code> and set the parameters accordingly on
the <code>QueueSpecification</code> instance. For more information about queues,
see the <a href="https://www.rabbitmq.com/queues.html">official documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One can also use the <code>ResourcesSpecification</code> factory class
with a static import to reduce boilerplate code. Combined with
<code>Mono</code> chaining and <code>Sender#declare</code> shortcuts, it allows for condensed syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">reactor.rabbitmq.ResourcesSpecification</span>.*;
...
sender.declare(exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>))
    .then(sender.declare(queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>)))
    .then(sender.bind(binding(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">a.b</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>)))
    .subscribe(r -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exchange and queue declared and bound</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Sender</code> has <code>delete*</code> and <code>delete</code> methods as well. Here is an example with
the short method forms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">reactor.rabbitmq.ResourcesSpecification</span>.*;
...
sender.unbind(binding(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">a.b</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>))
    .then(sender.delete(exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>)))
    .then(sender.delete(queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>)))
    .subscribe(r -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exchange and queue unbound and deleted</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reliable_publishing_with_publisher_confirms">6.2.2. Reliable publishing with publisher confirms</h4>
<div class="paragraph">
<p><code>Sender</code> offers also the <code>sendWithPublishConfirms</code> method to send
messages and receive <a href="https://www.rabbitmq.com/confirms.html#publisher-confirms">publisher
confirms</a> to make sure the broker has taken into account the outbound messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux&lt;OutboundMessage&gt; outboundFlux  = Flux.range(<span class="integer">1</span>, <span class="integer">10</span>)
    .map(i -&gt; <span class="keyword">new</span> OutboundMessage(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">amq.direct</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">routing.key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>.getBytes()
    ));
sender.sendWithPublishConfirms(outboundFlux)
    .subscribe(outboundMessageResult -&gt; {
        <span class="comment">// outbound message has reached the broker</span>
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Sender#sendWithPublishConfirms</code> returns a <code>Flux&lt;OutboundMessageResult&gt;</code>
that can be subscribed to to know that outbound messages
have successfully reached the broker.</p>
</div>
</div>
<div class="sect3">
<h4 id="_threading_model">6.2.3. Threading model</h4>
<div class="paragraph">
<p>Reactor RabbitMQ configure by default the Java Client to use NIO, i.e. there&#8217;s only
one thread that deals with IO. This can be changed by specifying a <code>ConnectionFactory</code>
in the <code>SenderOptions</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Sender</code> uses 2 Reactor&#8217;s <code>Scheduler</code>: one for the subscription when creating the
connection and another one for resources management. The <code>Sender</code> defaults
to 2 elastic schedulers, this can be overriden in the <code>SenderOptions</code>. The <code>Sender</code>
takes care of disposing the default schedulers when closing. If not using the default
schedulers, it&#8217;s developer&#8217;s job to dispose schedulers they passed in to the
<code>SenderOptions</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_closing_the_code_sender_code">6.2.4. Closing the <code>Sender</code></h4>
<div class="paragraph">
<p>When the <code>Sender</code> is no longer required, the instance can be closed.
The underlying <code>Connection</code> is closed, as well as the default
schedulers if none has been explicitly provided.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sender.close();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_error_handling_during_publishing">6.2.5. Error handling during publishing</h4>
<div class="paragraph">
<p>The <code>send</code> and <code>sendWithPublishConfirms</code> methods can take an additional
<code>SendOptions</code> parameter to specify the behavior to adopt if the publishing of a message
fails. The default behavior is to retry every 200 milliseconds for 10 seconds
in case of connection failure. As <a href="https://www.rabbitmq.com/api-guide.html#recovery">automatic connection recovery</a>
is enabled by default,
the connection is likely to be re-opened after a network glitch and the flux of
outbound messages should stall only during connection recovery before restarting automatically.
This default behavior tries to find a trade-off between reactivity and robustness.</p>
</div>
<div class="paragraph">
<p>You can customize the retry by settings your own instance of <code>RetrySendingExceptionHandler</code>
in the <code>SendOptions</code>, e.g. to retry for 20 seconds every 500 milliseconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Sender sender = RabbitFlux.createSender();
sender.send(outboundFlux, <span class="keyword">new</span> SendOptions().exceptionHandler(
   <span class="keyword">new</span> ExceptionHandlers.RetrySendingExceptionHandler(
       <span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">20</span>), <span class="predefined-type">Duration</span>.ofMillis(<span class="integer">500</span>),
       ExceptionHandlers.CONNECTION_RECOVERY_PREDICATE
   )
));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>RetrySendingExceptionHandler</code> uses a <code>Predicate&lt;Throwable&gt;</code> to decide whether
an exception should trigger a retry or not. If the exception isn&#8217;t retryable, the exception
handler wraps the exception in a <code>RabbitFluxException</code> and throws it.</p>
</div>
<div class="paragraph">
<p>For consistency sake, the retry exception handler used with <code>ExceptionHandlers.CONNECTION_RECOVERY_PREDICATE</code>
(the default) will trigger retry attempts for the same conditions as connection recovery triggering.
This means that if connection recovery has kicked in, publishing will be retried at least for the retry
timeout configured (10 seconds by default).</p>
</div>
<div class="paragraph">
<p>Note the exception handler is a <code>BiConsumer&lt;Sender.SendContext, Exception&gt;</code>, where <code>Sender.SendContext</code>
is a class providing access to the <code>OutboundMessage</code> and the underlying AMQP <code>Channel</code>. This makes it
easy to customize the default behavior: logging <code>BiConsumer#andThen</code> retrying, only logging, trying to
send the message somewhere else, etc.</p>
</div>
</div>
<div class="sect3">
<h4 id="_request_reply">6.2.6. Request/reply</h4>
<div class="paragraph">
<p>Reactor RabbitMQ supports reactive request/reply. From RabbitMQ documentation:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>RPC (request/reply) is a popular pattern to implement with a
messaging broker like RabbitMQ. [&#8230;&#8203;] The typical way to do
this is for RPC clients to send requests that are routed to a
long lived (known) server queue. The RPC server(s)
consume requests from this queue and then send replies
to each client using the queue named by the client in the reply-to header.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>For performance reason, Reactor RabbitMQ builds on top
<a href="https://www.rabbitmq.com/direct-reply-to.html">direct reply-to</a>. The next
snippet shows the usage of the <code>RpcClient</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> queue = <span class="string"><span class="delimiter">&quot;</span><span class="content">rpc.server.queue</span><span class="delimiter">&quot;</span></span>;
Sender sender = RabbitFlux.createSender();
RpcClient rpcClient = sender.rpcClient(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, queue);  <i class="conum" data-value="1"></i><b>(1)</b>
Mono&lt;Delivery&gt; reply = rpcClient.rpc(Mono.just(
    <span class="keyword">new</span> RpcClient.RpcRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>.getBytes())    <i class="conum" data-value="2"></i><b>(2)</b>
));
rpcClient.close();                                  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create <code>RpcClient</code> instance from a <code>Sender</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send request and get reply</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Close <code>RpcClient</code> when done</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example above, a consumer waits on the <code>rpc.server.queue</code> to
process requests. A <code>RpcClient</code> is created from a <code>Sender</code>, it will
send requests to a given exchange with a given routing key. The <code>RpcClient</code>
handles the machinery to send the request and wait on a reply queue the
result processed on the server queue, wrapping everything up with reactive API.
Note a RPC client isn&#8217;t meant to be used for only 1 request, it can be a long-lived object
handling different requests, as long as they&#8217;re directed to the same destination (defined
by the exchange and the routing key passed in when the <code>RpcClient</code> is created).</p>
</div>
<div class="paragraph">
<p>A <code>RpcClient</code> uses a sequence of <code>Long</code> for correlation, but this can be changed
by passing in a <code>Supplier&lt;String&gt;</code> when creating the <code>RpcClient</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> queue = <span class="string"><span class="delimiter">&quot;</span><span class="content">rpc.server.queue</span><span class="delimiter">&quot;</span></span>;
Supplier&lt;<span class="predefined-type">String</span>&gt; correlationIdSupplier = () -&gt; <span class="predefined-type">UUID</span>.randomUUID().toString(); <i class="conum" data-value="1"></i><b>(1)</b>
Sender sender = RabbitFlux.createSender();
RpcClient rpcClient = sender.rpcClient(
    <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, queue, correlationIdSupplier                                         <i class="conum" data-value="2"></i><b>(2)</b>
);
Mono&lt;Delivery&gt; reply = rpcClient.rpc(Mono.just(
    <span class="keyword">new</span> RpcClient.RpcRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>.getBytes())
));
rpcClient.close();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use random UUID correlation ID supplier</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass in supplier on <code>RpcClient</code> creation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be useful e.g. when the RPC server can make sense of the correlation ID.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-guide-receiver">6.3. Reactive RabbitMQ Receiver</h3>
<div class="paragraph">
<p>Messages stored in RabbitMQ queues are consumed using the reactive
receiver <code>reactor.rabbitmq.Receiver</code>.
Each instance of <code>Receiver</code> is associated with a single instance
of <code>Connection</code> created by the options-provided <code>ConnectionFactory</code>.</p>
</div>
<div class="paragraph">
<p>A receiver is created with an instance of receiver configuration options
<code>reactor.rabbitmq.ReceiverOptions</code>. The properties of <code>ReceiverOptions</code>
contains the <code>ConnectionFactory</code> that creates connections to the broker
and a Reactor <code>Scheduler</code> used for the connection creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();
connectionFactory.useNio();

ReceiverOptions receiverOptions =  <span class="keyword">new</span> ReceiverOptions()
    .connectionFactory(connectionFactory)                       <i class="conum" data-value="1"></i><b>(1)</b>
    .connectionSubscriptionScheduler(Schedulers.elastic());     <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify connection factory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify scheduler for connection creation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note you can control the creation of the <code>Connection</code> thanks to the
<code>connectionSupplier(ConnectionFactory)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SenderOptions senderOptions =  <span class="keyword">new</span> SenderOptions()
    .connectionFactory(connectionFactory)
    .connectionSupplier(cf -&gt; cf.newConnection(                                  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">new</span> Address<span class="type">[]</span> {<span class="keyword">new</span> Address(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.1</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> Address(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.2</span><span class="delimiter">&quot;</span></span>)},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">reactive-sender</span><span class="delimiter">&quot;</span></span>))
    .resourceManagementScheduler(Schedulers.elastic());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify array of addresses and connection name</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the snippet above the connection can be created from 2 different nodes (useful for
failover) and the connection name is set up.</p>
</div>
<div class="paragraph">
<p>Once the required configuration options have been configured on the options instance,
a new <code>Receiver</code> instance can be created with these options to consume inbound messages.
The code snippet below creates a receiver instance and an inbound <code>Flux</code> for the receiver.
The underlying <code>Connection</code> and <code>Consumer</code> instances are created lazily
later when the inbound <code>Flux</code> is subscribed to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux&lt;Delivery&gt; inboundFlux = RabbitFlux.createReceiver(receiverOptions)
        .consumeNoAck(<span class="string"><span class="delimiter">&quot;</span><span class="content">reactive.queue</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The inbound RabbitMQ <code>Flux</code> is ready to be consumed.
Each inbound message delivered by the Flux is represented as a
<a href="https://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/com/rabbitmq/client/Delivery.html"><code>Delivery</code></a>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/reactor/reactor-rabbitmq/blob/master/reactor-rabbitmq-samples/src/main/java/reactor/rabbitmq/samples/SampleReceiver.java"><code>SampleReceiver</code></a>
for a full code listing for a <code>Receiver</code>.</p>
</div>
<div class="sect3">
<h4 id="_consuming_options">6.3.1. Consuming options</h4>
<div class="paragraph">
<p>The <code>Receiver</code> class has different flavors of the <code>receive*</code> method and each of them
can accept a <code>ConsumeOptions</code> instance. Here are the different options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>overflowStrategy</code>: the <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/FluxSink.OverflowStrategy.html"><code>OverflowStrategy</code></a>
used when creating the <code>Flux</code> of messages. Default is <code>BUFFER</code>.</p>
</li>
<li>
<p><code>qos</code>: the prefetch count used when message acknowledgment is enabled. Default is 250.</p>
</li>
<li>
<p><code>hookBeforeEmitBiFunction</code>: a <code>BiFunction&lt;Long, ? super Delivery, Boolean&gt;</code> to decide
whether a message should be emitted downstream or not. Default is to always emit.</p>
</li>
<li>
<p><code>stopConsumingBiFunction</code>: a <code>BiFunction&lt;Long, ? super Delivery, Boolean&gt;</code> to decide
whether the flux should be completed after the emission of the message. Default is to never complete.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_acknowledgment">6.3.2. Acknowledgment</h4>
<div class="paragraph">
<p><code>Receiver</code> has several <code>receive*</code> methods that differ on the way consumer are acknowledged
back to the broker. Acknowledgment mode can have profound impacts on performance and memory
consumption.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>consumeNoAck</code>: the broker forgets about a message as soon as it has sent it to the consumer.
Use this mode if downstream subscribers are very fast, at least faster than the flow of inbound
messages. Messages will pile up in the JVM process memory if subscribers are not
able to cope with the flow of messages, leading to out-of-memory errors. Note this mode
uses the auto-acknowledgment mode when registering the RabbitMQ <code>Consumer</code>.</p>
</li>
<li>
<p><code>consumeAutoAck</code>: with this mode, messages are acknowledged right after their arrival,
in the <code>Flux#doOnNext</code> callback. This can help to cope with the flow of messages, avoiding
the downstream subscribers to be overwhelmed. Note this mode
<strong>does not use</strong> the auto-acknowledgment mode when registering the RabbitMQ <code>Consumer</code>.
In this case, <code>consumeAutoAck</code> means messages are automatically acknowledged by the library
in one the <code>Flux</code> hooks.</p>
</li>
<li>
<p><code>consumeManualAck</code>: this method returns a <code>Flux&lt;AcknowledgableDelivery&gt;</code> and messages
must be manually acknowledged or rejected downstream with <code>AcknowledgableDelivery#ack</code>
or <code>AcknowledgableDelivery#nack</code>, respectively. This mode lets the developer
acknowledge messages in the most efficient way, e.g. by acknowledging several messages
at the same time with <code>AcknowledgableDelivery#ack(true)</code> and letting Reactor control
the batch size with one of the <code>Flux#buffer</code> methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To learn more on how the <code>ConsumeOptions#qos</code> setting can impact the behavior
of <code>Receiver#consumeAutoAck</code> and <code>Receiver#consumeManualAck</code>, have a look at
<a href="https://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/">this
post about queuing theory</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_closing_the_code_receiver_code">6.3.3. Closing the <code>Receiver</code></h4>
<div class="paragraph">
<p>When the <code>Receiver</code> is no longer required, the instance can be closed.
The underlying <code>Connection</code> is closed, as well as the default scheduler
if none has been explicitly provided.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiver.close();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_connection_failure">6.3.4. Connection failure</h4>
<div class="paragraph">
<p>Network connection between the broker and the client can fail. This
is transparent for consumers thanks to RabbitMQ Java client
<a href="https://www.rabbitmq.com/api-guide.html#recovery">automatic connection recovery</a>.
Connection failures affect sending though, and acknowledgment is a sending operation.</p>
</div>
<div class="paragraph">
<p>When using <code>Receiver#consumeAutoAck</code>, acknowledgments are retried for 10 seconds every 200 milliseconds
in case of connection failure. This can be changed by setting the
<code>BiConsumer&lt;Receiver.AcknowledgmentContext, Exception&gt; exceptionHandler</code> in the
<code>ConsumeOptions</code>, e.g. to retry for 20 seconds every 500 milliseconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux&lt;Delivery&gt; inboundFlux = RabbitFlux
    .createReceiver()
    .consumeAutoAck(<span class="string"><span class="delimiter">&quot;</span><span class="content">reactive.queue</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> ConsumeOptions()
        .exceptionHandler(<span class="keyword">new</span> ExceptionHandlers.RetryAcknowledgmentExceptionHandler(
            <span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">20</span>), <span class="predefined-type">Duration</span>.ofMillis(<span class="integer">500</span>), <i class="conum" data-value="1"></i><b>(1)</b>
            ExceptionHandlers.CONNECTION_RECOVERY_PREDICATE
        ))
    );</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Retry acknowledgment for 20 seconds every 500 milliseconds on connection failure</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using <code>Receiver#consumeManualAck</code>, acknowledgment is handled by the developer, who
can do pretty anything they want on acknowledgment failure.</p>
</div>
<div class="paragraph">
<p><code>AcknowledgableDelivery#ack</code> and <code>AcknowledgableDelivery#nack</code> methods handle retry internally
based on <code>BiConsumer&lt;Receiver.AcknowledgmentContext, Exception&gt; exceptionHandler</code> in the <code>ConsumeOptions</code>.
Developer does not have to execute retry explicitly on acknowledgment failure and benefits from Reactor RabbitMQ
retry support when acknowledging a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Receiver</span> receiver = RabbitFlux.createReceiver();
BiConsumer&lt;<span class="predefined-type">Receiver</span>.AcknowledgmentContext, <span class="exception">Exception</span>&gt; exceptionHandler =
    <span class="keyword">new</span> ExceptionHandlers.RetryAcknowledgmentExceptionHandler(                  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">20</span>), <span class="predefined-type">Duration</span>.ofMillis(<span class="integer">500</span>),
        ExceptionHandlers.CONNECTION_RECOVERY_PREDICATE
);
receiver.consumeManualAck(<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span>,
            <span class="keyword">new</span> ConsumeOptions().exceptionHandler(exceptionHandler))
        .subscribe(msg -&gt; {
            <span class="comment">// ...                                                              </span><i class="conum" data-value="2"></i><b>(2)</b>
            msg.ack();                                                          <i class="conum" data-value="3"></i><b>(3)</b>
        });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure retry logic when exception occurs</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Process message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send acknowledgment after business processing</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note the exception handler is a <code>BiConsumer&lt;Receiver.AcknowledgmentContext, Exception&gt;</code>. This means
acknowledgment failure can be handled in any way, here we choose to retry the acknowledgment.
Note also that by using <code>ExceptionHandlers.CONNECTION_RECOVERY_PREDICATE</code>, we choose
to retry only on unexpected connection failures and rely on the AMQP Java client to automatically re-create
a new connection in the background. The decision to retry on a given
exception can be customized by providing a <code>Predicate&lt;Throwable&gt;</code> in place of
<code>ExceptionHandlers.CONNECTION_RECOVERY_PREDICATE</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-guide-advanced-features">6.4. Advanced features</h3>
<div class="paragraph">
<p>This section covers advanced uses of the Reactor RabbitMQ API.</p>
</div>
<div class="sect3">
<h4 id="_creating_a_connection_with_a_custom_code_mono_code">6.4.1. Creating a connection with a custom <code>Mono</code></h4>
<div class="paragraph">
<p>It is possible to specify only a <code>ConnectionFactory</code> for <code>Sender/ReceiverOptions</code> and
let Reactor RabbitMQ create connection from this <code>ConnectionFactory</code>.
If you want more control over the creation of connections, you can use
<code>Sender/ReceiverOptions#connectionSupplier(ConnectionFactory)</code>. This is fine for most cases
and doesn&#8217;t use any reactive API. Both <code>Sender</code> and <code>Receiver</code> use internally a <code>Mono&lt;Connection&gt;</code>
to open the connection only when needed. It is possible to provide this <code>Mono&lt;Connection&gt;</code>
through the appropriate <code>*Options</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();                <i class="conum" data-value="1"></i><b>(1)</b>
connectionFactory.useNio();

Sender sender = RabbitFlux.createSender(<span class="keyword">new</span> SenderOptions()
    .connectionMono(
        Mono.fromCallable(() -&gt; connectionFactory.newConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sender</span><span class="delimiter">&quot;</span></span>)))   <i class="conum" data-value="2"></i><b>(2)</b>
);
<span class="predefined-type">Receiver</span> receiver = RabbitFlux.createReceiver(<span class="keyword">new</span> ReceiverOptions()
    .connectionMono(
        Mono.fromCallable(() -&gt; connectionFactory.newConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">receiver</span><span class="delimiter">&quot;</span></span>))) <i class="conum" data-value="3"></i><b>(3)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create and configure connection factory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create <code>Mono</code> that creates connection with a name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create <code>Mono</code> that creates connection with a name</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Providing your own <code>Mono&lt;Connection&gt;</code> lets you take advantage of all the Reactor API
(e.g. for caching).</p>
</div>
</div>
<div class="sect3">
<h4 id="_sharing_the_same_connection_between_code_sender_code_and_code_receiver_code">6.4.2. Sharing the same connection between <code>Sender</code> and <code>Receiver</code></h4>
<div class="paragraph">
<p><code>Sender</code> and <code>Receiver</code> instances create their own <code>Connection</code> but it&#8217;s possible to use
only one or a few <code>Connection</code> instances to be able to use exclusive resources between a <code>Sender</code>
and a <code>Receiver</code> or simply to control the number of created connections.</p>
</div>
<div class="paragraph">
<p>Both <code>SenderOptions</code> and <code>ReceiverOptions</code> have a <code>connectionMono</code> method that can encapsulate
any logic to create the <code>Mono&lt;Connection&gt;</code> the <code>Sender</code> or <code>Receiver</code> will end up using. Reactor
RabbitMQ provides a way to share the exact same connection instance from a <code>Mono&lt;Connection&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();           <i class="conum" data-value="1"></i><b>(1)</b>
connectionFactory.useNio();
Mono&lt;? <span class="directive">extends</span> <span class="predefined-type">Connection</span>&gt; connectionMono = Utils.singleConnectionMono(  <i class="conum" data-value="2"></i><b>(2)</b>
    connectionFactory, cf -&gt; cf.newConnection()
);

Sender sender = RabbitFlux.createSender(
    <span class="keyword">new</span> SenderOptions().connectionMono(connectionMono)                   <i class="conum" data-value="3"></i><b>(3)</b>
);
<span class="predefined-type">Receiver</span> receiver = RabbitFlux.createReceiver(
    <span class="keyword">new</span> ReceiverOptions().connectionMono(connectionMono)                 <i class="conum" data-value="4"></i><b>(4)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create and configure connection factory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create <code>Mono</code> that re-uses the same connection instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create sender with connection <code>Mono</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create receiver with connection <code>Mono</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Be aware that closing the first <code>Sender</code> or <code>Receiver</code> will close the underlying
AMQP connection for all the others.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_channels_with_a_custom_code_mono_code_in_code_sender_code">6.4.3. Creating channels with a custom <code>Mono</code> in <code>Sender</code></h4>
<div class="paragraph">
<p><code>SenderOptions</code> provides a <code>channelMono</code> property that is called when creating the <code>Channel</code> used
in sending methods. This is a convenient way to provide any custom logic when
creating the <code>Channel</code>, e.g. retry logic.</p>
</div>
</div>
<div class="sect3">
<h4 id="_threading_considerations_for_resource_management">6.4.4. Threading considerations for resource management</h4>
<div class="paragraph">
<p>A <code>Sender</code> instance maintains a <code>Mono&lt;Channel&gt;</code> to manage resources and by default
the underlying <code>Channel</code> is cached. A new <code>Channel</code> is also automatically created in case of error.
Channel creation is not a cheap operation, so this default behavior fits most use
cases. Each resource management method provides a counterpart method with an additional
<code>ResourceManagementOptions</code> argument. This allows to provide a custom <code>Mono&lt;Channel&gt;</code>
for a given resource operation. This can be useful when multiple threads are using
the same <code>Sender</code> instance, to avoid using the same <code>Channel</code> from multiple threads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Mono&lt;<span class="predefined-type">Channel</span>&gt; channelMono = connectionMono.map(c -&gt; {
    <span class="keyword">try</span> {
        <span class="keyword">return</span> c.createChannel();
    } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
        <span class="keyword">throw</span> <span class="keyword">new</span> RabbitFluxException(e);
    }
}).cache();                                                                <i class="conum" data-value="1"></i><b>(1)</b>

ResourceManagementOptions options = <span class="keyword">new</span> ResourceManagementOptions()
    .channelMono(channelMono);                                             <i class="conum" data-value="2"></i><b>(2)</b>

sender.declare(exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>), options)                           <i class="conum" data-value="3"></i><b>(3)</b>
    .then(sender.declare(queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>), options))                      <i class="conum" data-value="3"></i><b>(3)</b>
    .then(sender.bind(binding(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.exchange</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">a.b</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">my.queue</span><span class="delimiter">&quot;</span></span>), options)) <i class="conum" data-value="3"></i><b>(3)</b>
    .subscribe(r -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exchange and queue declared and bound</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create <code>Channel</code> and cache it</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>Mono&lt;Channel&gt;</code> in <code>ResourceManagementOptions</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>Mono&lt;Channel&gt;</code> for each operation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example above, each operation will use the same <code>Channel</code> as it is cached.
This way these operations won&#8217;t interfer with any other thread using the default
resource management <code>Mono&lt;Channel&gt;</code> in the <code>Sender</code> instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_channel_pooling_in_code_sender_code">6.4.5. Channel pooling in <code>Sender</code></h4>
<div class="paragraph">
<p>By default, <code>Sender#send*</code> methods open a new <code>Channel</code> for every call. This is
OK for long-running calls, e.g. when the flux of outbound messages is
infinite. For workloads whereby <code>Sender#send*</code> is called often for finite,
short flux of messages, opening a new <code>Channel</code> every time may not be optimal.</p>
</div>
<div class="paragraph">
<p>It is possible to use a pool of channels as part of the <code>SendOptions</code> when
sending outbound messages with <code>Sender</code>, as illustrated in the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChannelPool channelPool = ChannelPoolFactory.createChannelPool(         <i class="conum" data-value="1"></i><b>(1)</b>
    connectionMono,
    <span class="keyword">new</span> ChannelPoolOptions().maxCacheSize(<span class="integer">5</span>)                            <i class="conum" data-value="2"></i><b>(2)</b>
);
sender.send(outboundFlux, <span class="keyword">new</span> SendOptions().channelPool(channelPool));  <i class="conum" data-value="3"></i><b>(3)</b>
<span class="comment">// ...</span>
channelPool.close();                                                    <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create <code>ChannelPool</code> with factory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the maximum size to 5 channels</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use a channel from the pool to send messages</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Close the pool when no longer needed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note it is developer&#8217;s responsibility to close the pool when it is no longer
necessary, typically at application shutdown.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/reactor/reactor-rabbitmq/tree/master/src/jmh/java/reactor/rabbitmq">Micro-benchmarks</a>
revealed channel pooling performs much better for sending short sequence
of messages (1 to 10) repeatedly, without publisher confirms. With longer sequence
of messages (100 or more), channel pooling can perform worse than
without pooling at all. According to the same micro-benchmarks, channel pooling
does not make sending with publisher confirms perform better, it appears to perform
even worse. Don&#8217;t take these conclusions for granted, you should always make your
own benchmarks depending on your workloads.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-04-05 07:41:45 +00:00
</div>
</div>
</body>
</html>