<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Sabby Anandan, Marius Bogoevici, Eric Bottard, Mark Fisher, Ilayaperumal Gopinathan, Gunnar Hillert, Mark Pollack, Patrick Peralta, Glenn Renfro, Thomas Risberg, Florian Rosenberg, Dave Syer, David Turanski, Janne Valkealahti, Oleg Zhurakousky, Vinicius Carvalho, Chris Schaefer, Jay Bryant">
<title>Spring Cloud Data Flow Server for Kubernetes</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: false,
            context: "#content",
            highlightOnScroll: false,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Cloud Data Flow Server for Kubernetes</h1>
<div class="details">
<span id="author" class="author">Sabby Anandan, Marius Bogoevici, Eric Bottard, Mark Fisher, Ilayaperumal Gopinathan, Gunnar Hillert, Mark Pollack, Patrick Peralta, Glenn Renfro, Thomas Risberg, Florian Rosenberg, Dave Syer, David Turanski, Janne Valkealahti, Oleg Zhurakousky, Vinicius Carvalho, Chris Schaefer, Jay Bryant</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#kubernetes-getting-started">Getting Started</a>
<ul class="sectlevel1">
<li><a href="#_installation">1. Installation</a>
<ul class="sectlevel2">
<li><a href="#_kubernetes_compatibility">1.1. Kubernetes Compatibility</a></li>
<li><a href="#_create_a_kubernetes_cluster">1.2. Create a Kubernetes Cluster</a></li>
<li><a href="#_deploying_with_code_kubectl_code">1.3. Deploying with <code>kubectl</code></a>
<ul class="sectlevel3">
<li><a href="#_choosing_a_message_broker">1.3.1. Choosing a Message Broker</a></li>
<li><a href="#getting-started-deploy-services-and-data-flow">1.3.2. Deploy Services and Data Flow</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_helm_installation">2. Helm Installation</a></li>
<li><a href="#getting-started-deploying-streams">3. Deploying Streams</a>
<ul class="sectlevel2">
<li><a href="#getting-started-create-stream-without-skipper">3.1. Create Streams without Skipper</a></li>
<li><a href="#getting-started-create-with-skipper">3.2. Create Streams with Skipper</a></li>
<li><a href="#_accessing_an_application_from_outside_the_cluster">3.3. Accessing an Application from outside the Cluster</a></li>
</ul>
</li>
<li><a href="#_deploying_tasks">4. Deploying Tasks</a></li>
<li><a href="#_application_and_server_properties">5. Application and Server Properties</a>
<ul class="sectlevel2">
<li><a href="#_using_deployments">5.1. Using Deployments</a></li>
<li><a href="#_memory_and_cpu_settings">5.2. Memory and CPU Settings</a></li>
<li><a href="#_environment_variables">5.3. Environment Variables</a></li>
<li><a href="#_liveness_and_readiness_probes">5.4. Liveness and Readiness Probes</a></li>
<li><a href="#_using_code_spring_application_json_code">5.5. Using <code>SPRING_APPLICATION_JSON</code></a></li>
<li><a href="#_private_docker_registry">5.6. Private Docker Registry</a></li>
<li><a href="#_annotations">5.7. Annotations</a></li>
<li><a href="#_entry_point_style">5.8. Entry Point Style</a></li>
<li><a href="#_deployment_service_account">5.9. Deployment Service Account</a></li>
<li><a href="#_image_pull_policy">5.10. Image Pull Policy</a></li>
<li><a href="#_deployment_labels">5.11. Deployment Labels</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#applications">Applications</a>
<ul class="sectlevel1">
<li><a href="#_available_applications">6. Available Applications</a></li>
</ul>
</li>
<li><a href="#architecture">Architecture</a>
<ul class="sectlevel1">
<li><a href="#arch-intro">7. Introduction</a></li>
<li><a href="#arch-microservice-style">8. Microservice Architectural Style</a>
<ul class="sectlevel2">
<li><a href="#arch-comparison">8.1. Comparison to Other Platform Architectures</a></li>
</ul>
</li>
<li><a href="#arch-data-flow-server">9. Data Flow Server</a>
<ul class="sectlevel2">
<li><a href="#arch-data-flow-server-endpoints">9.1. Endpoints</a></li>
<li><a href="#arch-data-flow-server-security">9.2. Security</a></li>
</ul>
</li>
<li><a href="#arch-streams">10. Streams</a>
<ul class="sectlevel2">
<li><a href="#arch-streams-topologies">10.1. Topologies</a></li>
<li><a href="#arch-streams-concurrency">10.2. Concurrency</a></li>
<li><a href="#arch-streams-partitioning">10.3. Partitioning</a></li>
<li><a href="#arch-streams-delivery">10.4. Message Delivery Guarantees</a></li>
</ul>
</li>
<li><a href="#arch-streaming-apps">11. Stream Programming Models</a>
<ul class="sectlevel2">
<li><a href="#arch-streaming-imperative-programming">11.1. Imperative Programming Model</a></li>
<li><a href="#arch-streaming-functional-programming">11.2. Functional Programming Model</a></li>
</ul>
</li>
<li><a href="#arch-application-versioning">12. Application Versioning</a></li>
<li><a href="#arch-task">13. Task Programming Model</a></li>
<li><a href="#arch-analytics">14. Analytics</a></li>
<li><a href="#arch-runtime">15. Runtime</a>
<ul class="sectlevel2">
<li><a href="#arch-runtime-fault-tolerance">15.1. Fault Tolerance</a></li>
<li><a href="#arch-runtime-resource-management">15.2. Resource Management</a></li>
<li><a href="#arch-runtime-scaling">15.3. Scaling at Runtime</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration">Server Configuration</a>
<ul class="sectlevel1">
<li><a href="#enable-disable-specific-features">16. Feature Toggles</a></li>
<li><a href="#configuration-general">17. General Configuration</a>
<ul class="sectlevel2">
<li><a href="#_using_configmap_and_secrets">17.1. Using ConfigMap and Secrets</a></li>
</ul>
</li>
<li><a href="#configuration-rdbms">18. Database Configuration</a></li>
<li><a href="#configuration-security">19. Security</a></li>
<li><a href="#configuration-monitoring-management">20. Monitoring and Management</a>
<ul class="sectlevel2">
<li><a href="#_inspecting_server_logs">20.1. Inspecting Server Logs</a></li>
<li><a href="#_streams">20.2. Streams</a></li>
<li><a href="#_tasks">20.3. Tasks</a></li>
</ul>
</li>
<li><a href="#_scheduling">21. Scheduling</a>
<ul class="sectlevel2">
<li><a href="#_entry_point_style_2">21.1. Entry Point Style</a></li>
<li><a href="#_environment_variables_2">21.2. Environment Variables</a></li>
<li><a href="#_image_pull_policy_2">21.3. Image Pull Policy</a></li>
<li><a href="#_private_docker_registry_2">21.4. Private Docker Registry</a></li>
<li><a href="#_namespace">21.5. Namespace</a></li>
<li><a href="#_service_account">21.6. Service Account</a></li>
</ul>
</li>
<li><a href="#_debug_support">22. Debug Support</a>
<ul class="sectlevel2">
<li><a href="#_enabling_debugging_manually">22.1. Enabling Debugging Manually</a></li>
<li><a href="#_enabling_debugging_with_patching">22.2. Enabling Debugging with Patching</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#shell">Shell</a>
<ul class="sectlevel1">
<li><a href="#shell-options">23. Shell Options</a></li>
<li><a href="#shell-commands">24. Listing Available Commands</a></li>
<li><a href="#shell-tab-completion">25. Tab Completion</a></li>
<li><a href="#shell-white-space">26. White Space and Quoting Rules</a>
<ul class="sectlevel2">
<li><a href="#dsl-quotes-escaping">26.1. Quotes and Escaping</a>
<ul class="sectlevel3">
<li><a href="#_shell_rules">26.1.1. Shell rules</a></li>
<li><a href="#_property_files_rules">26.1.2. Property files rules</a></li>
<li><a href="#_dsl_parsing_rules">26.1.3. DSL Parsing Rules</a></li>
<li><a href="#_spel_syntax_and_spel_literals">26.1.4. SpEL Syntax and SpEL Literals</a></li>
<li><a href="#_putting_it_all_together">26.1.5. Putting It All Together</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-streams">Streams</a>
<ul class="sectlevel1">
<li><a href="#spring-cloud-dataflow-stream-intro">27. Introduction</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-dataflow-stream-intro-dsl">27.1. Stream Pipeline DSL</a></li>
<li><a href="#spring-cloud-dataflow-stream-app-dsl">27.2. Stream Application DSL</a></li>
<li><a href="#_application_properties">27.3. Application properties</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-stream-lifecycle">28. Stream Lifecycle</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-dataflow-register-stream-apps">28.1. Register a Stream App</a>
<ul class="sectlevel3">
<li><a href="#supported-apps-and-tasks">28.1.1. Register Supported Applications and Tasks</a></li>
<li><a href="#spring-cloud-dataflow-stream-app-whitelisting">28.1.2. Whitelisting application properties</a></li>
<li><a href="#spring-cloud-dataflow-stream-app-metadata-artifact">28.1.3. Creating and Using a Dedicated Metadata Artifact</a></li>
<li><a href="#_using_the_companion_artifact">28.1.4. Using the Companion Artifact</a></li>
<li><a href="#custom-applications">28.1.5. Creating Custom Applications</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-create-stream">28.2. Creating a Stream</a>
<ul class="sectlevel3">
<li><a href="#_application_properties_2">28.2.1. Application Properties</a></li>
<li><a href="#spring-cloud-dataflow-global-properties">28.2.2. Common Application Properties</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-deploy-stream">28.3. Deploying a Stream</a>
<ul class="sectlevel3">
<li><a href="#_deployment_properties">28.3.1. Deployment Properties</a>
<ul class="sectlevel4">
<li><a href="#_passing_instance_count">Passing Instance Count</a></li>
<li><a href="#_inline_versus_file_based_properties">Inline Versus File-based Properties</a></li>
<li><a href="#_passing_application_properties">Passing application properties</a></li>
<li><a href="#passing_producer_consumer_properties">Passing Spring Cloud Stream properties</a></li>
<li><a href="#_passing_per_binding_producer_and_consumer_properties">Passing Per-binding Producer and Consumer Properties</a></li>
<li><a href="#passing_stream_partition_properties">Passing Stream Partition Properties</a></li>
<li><a href="#passing_content_type_properties">Passing application content type properties</a></li>
<li><a href="#_overriding_application_properties_during_stream_deployment">Overriding Application Properties During Stream Deployment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-destroy-stream">28.4. Destroying a Stream</a></li>
<li><a href="#spring-cloud-dataflow-undeploy-stream">28.5. Undeploying a Stream</a></li>
<li><a href="#spring-cloud-dataflow-validate-stream">28.6. Validating a Stream</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-stream-lifecycle-skipper">29. Stream Lifecycle with Skipper</a>
<ul class="sectlevel2">
<li><a href="#_register_a_versioned_stream_app">29.1. Register a Versioned Stream App</a></li>
<li><a href="#spring-cloud-dataflow-stream-lifecycle-skipper-create">29.2. Creating and Deploying a Stream</a></li>
<li><a href="#spring-cloud-dataflow-stream-lifecycle-skipper-update">29.3. Updating a Stream</a></li>
<li><a href="#spring-cloud-dataflow-stream-lifecycle-skipper-force-update">29.4. Force update of a Stream</a></li>
<li><a href="#_stream_versions">29.5. Stream versions</a></li>
<li><a href="#_stream_manifests">29.6. Stream Manifests</a></li>
<li><a href="#spring-cloud-dataflow-stream-lifecycle-skipper-rollback">29.7. Rollback a Stream</a></li>
<li><a href="#_application_count">29.8. Application Count</a></li>
<li><a href="#_skipper_s_upgrade_strategy">29.9. Skipper&#8217;s Upgrade Strategy</a></li>
</ul>
</li>
<li><a href="#_stream_dsl">30. Stream DSL</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-dataflow-stream-dsl-tap">30.1. Tap a Stream</a></li>
<li><a href="#spring-cloud-dataflow-stream-dsl-labels">30.2. Using Labels in a Stream</a></li>
<li><a href="#spring-cloud-dataflow-stream-dsl-named-destinations">30.3. Named Destinations</a></li>
<li><a href="#spring-cloud-dataflow-stream-dsl-fanin-fanout">30.4. Fan-in and Fan-out</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-stream-java-dsl">31. Stream Java DSL</a>
<ul class="sectlevel2">
<li><a href="#_overview">31.1. Overview</a></li>
<li><a href="#_java_dsl_styles">31.2. Java DSL styles</a></li>
<li><a href="#_using_the_deploymentpropertiesbuilder">31.3. Using the DeploymentPropertiesBuilder</a></li>
<li><a href="#_deploying_using_skipper">31.4. Deploying using Skipper</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-stream-multi-binder">32. Stream Applications with Multiple Binder Configurations</a></li>
<li><a href="#spring-cloud-dataflow-stream-examples">33. Examples</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-dataflow-simple-stream">33.1. Simple Stream Processing</a></li>
<li><a href="#spring-cloud-dataflow-stream-partitions">33.2. Stateful Stream Processing</a></li>
<li><a href="#spring-cloud-dataflow-stream-app-types">33.3. Other Source and Sink Application Types</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#streams-using-skipper">Deploying Streams by Using Skipper</a>
<ul class="sectlevel1">
<li><a href="#_rolling_back_to_a_previous_version">34. Rolling back to a Previous Version</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-task">Tasks</a>
<ul class="sectlevel1">
<li><a href="#spring-cloud-dataflow-task-intro">35. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_application_properties_3">35.1. Application properties</a></li>
</ul>
</li>
<li><a href="#_the_lifecycle_of_a_task">36. The Lifecycle of a Task</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-dataflow-create-task-apps">36.1. Creating a Task Application</a>
<ul class="sectlevel3">
<li><a href="#_task_database_configuration">36.1.1. Task Database Configuration</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-register-task-apps">36.2. Registering a Task Application</a></li>
<li><a href="#spring-cloud-dataflow-create-task-definition">36.3. Creating a Task Definition</a></li>
<li><a href="#spring-cloud-dataflow-task-launch">36.4. Launching a Task</a>
<ul class="sectlevel3">
<li><a href="#_common_application_properties">36.4.1. Common application properties</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-task-limit-concurrent-executions">36.5. Limit the number concurrent task launches</a></li>
<li><a href="#spring-cloud-dataflow-task-review-executions">36.6. Reviewing Task Executions</a></li>
<li><a href="#spring-cloud-dataflow-task-definition-destroying">36.7. Destroying a Task Definition</a></li>
<li><a href="#spring-cloud-dataflow-validate-task">36.8. Validating a Task</a></li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-task-events">37. Subscribing to Task/Batch Events</a></li>
<li><a href="#spring-cloud-dataflow-composed-tasks">38. Composed Tasks</a>
<ul class="sectlevel2">
<li><a href="#_configuring_the_composed_task_runner">38.1. Configuring the Composed Task Runner</a>
<ul class="sectlevel3">
<li><a href="#_registering_the_composed_task_runner">38.1.1. Registering the Composed Task Runner</a></li>
<li><a href="#_configuring_the_composed_task_runner_2">38.1.2. Configuring the Composed Task Runner</a>
<ul class="sectlevel4">
<li><a href="#_configuration_options">Configuration Options</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_the_lifecycle_of_a_composed_task">38.2. The Lifecycle of a Composed Task</a>
<ul class="sectlevel3">
<li><a href="#spring-cloud-data-flow-composed-task-creating">38.2.1. Creating a Composed Task</a>
<ul class="sectlevel4">
<li><a href="#_task_application_parameters">Task Application Parameters</a></li>
</ul>
</li>
<li><a href="#_launching_a_composed_task">38.2.2. Launching a Composed Task</a>
<ul class="sectlevel4">
<li><a href="#_passing_properties_to_the_child_tasks">Passing properties to the child tasks</a></li>
<li><a href="#_passing_arguments_to_the_composed_task_runner">Passing arguments to the composed task runner</a></li>
<li><a href="#_exit_statuses">Exit Statuses</a></li>
</ul>
</li>
<li><a href="#_destroying_a_composed_task">38.2.3. Destroying a Composed Task</a></li>
<li><a href="#spring-cloud-data-flow-composed-task-stopping">38.2.4. Stopping a Composed Task</a></li>
<li><a href="#spring-cloud-data-flow-composed-task-restarting">38.2.5. Restarting a Composed Task</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_composed_tasks_dsl">39. Composed Tasks DSL</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-data-flow-conditional-execution">39.1. Conditional Execution</a></li>
<li><a href="#spring-cloud-data-flow-transitional-execution">39.2. Transitional Execution</a>
<ul class="sectlevel3">
<li><a href="#_basic_transition">39.2.1. Basic Transition</a></li>
<li><a href="#_transition_with_a_wildcard">39.2.2. Transition With a Wildcard</a></li>
<li><a href="#_transition_with_a_following_conditional_execution">39.2.3. Transition With a Following Conditional Execution</a></li>
</ul>
</li>
<li><a href="#spring-cloud-data-flow-split-execution">39.3. Split Execution</a>
<ul class="sectlevel3">
<li><a href="#_split_containing_conditional_execution">39.3.1. Split Containing Conditional Execution</a></li>
<li><a href="#_establishing_the_proper_thread_count_for_splits">39.3.2. Establishing the proper thread count for splits</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-launch-tasks-from-stream">40. Launching Tasks from a Stream</a>
<ul class="sectlevel2">
<li><a href="#_triggertask">40.1. TriggerTask</a></li>
<li><a href="#_tasklaunchrequest_transform">40.2. TaskLaunchRequest-transform</a></li>
<li><a href="#_launching_a_composed_task_from_a_stream">40.3. Launching a Composed Task From a Stream</a></li>
</ul>
</li>
<li><a href="#sharing-spring-cloud-dataflows-datastore-with-tasks">41. Sharing Spring Cloud Data Flow&#8217;s Datastore with Tasks</a>
<ul class="sectlevel2">
<li><a href="#_a_common_datastore_dependency">41.1. A Common DataStore Dependency</a></li>
<li><a href="#_a_common_data_store">41.2. A Common Data Store</a>
<ul class="sectlevel3">
<li><a href="#_simple_task_launch">41.2.1. Simple Task Launch</a></li>
<li><a href="#_task_launcher_sink">41.2.2. Task Launcher Sink</a></li>
<li><a href="#_composed_task_runner">41.2.3. Composed Task Runner</a></li>
<li><a href="#_launching_a_task_externally_from_spring_cloud_data_flow">41.2.4. Launching a task externally from Spring Cloud Data Flow</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-cloud-dataflow-schedule-launch-tasks">42. Scheduling Tasks</a>
<ul class="sectlevel2">
<li><a href="#_the_scheduler">42.1. The Scheduler</a></li>
<li><a href="#_enabling_scheduling">42.2. Enabling Scheduling</a></li>
<li><a href="#_the_lifecycle_of_a_schedule">42.3. The Lifecycle of a Schedule</a>
<ul class="sectlevel3">
<li><a href="#spring-cloud-data-flow-schedule-scheduling">42.3.1. Scheduling a Task Execution</a></li>
<li><a href="#spring-cloud-data-flow-schedule-unscheduling">42.3.2. Deleting a Schedule</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#dashboard">Dashboard</a>
<ul class="sectlevel1">
<li><a href="#dashboard-introduction">43. Introduction</a></li>
<li><a href="#dashboard-apps">44. Apps</a>
<ul class="sectlevel2">
<li><a href="#_bulk_import_of_applications">44.1. Bulk Import of Applications</a></li>
</ul>
</li>
<li><a href="#dashboard-runtime">45. Runtime</a></li>
<li><a href="#dashboard-streams">46. Streams</a>
<ul class="sectlevel2">
<li><a href="#dashboard-stream-definitions">46.1. Working with Stream Definitions</a></li>
<li><a href="#dashboard-flo-streams-designer">46.2. Creating a Stream</a></li>
<li><a href="#dashboard-stream-deploy">46.3. Deploying a Stream</a></li>
<li><a href="#_creating_fan_in_fan_out_streams">46.4. Creating Fan-In/Fan-Out Streams</a></li>
<li><a href="#_creating_a_tap_stream">46.5. Creating a Tap Stream</a></li>
</ul>
</li>
<li><a href="#dashboard-tasks">47. Tasks</a>
<ul class="sectlevel2">
<li><a href="#dashboard-tasks-apps">47.1. Apps</a>
<ul class="sectlevel3">
<li><a href="#_view_task_app_details">47.1.1. View Task App Details</a></li>
<li><a href="#_create_a_task_definition">47.1.2. Create a Task Definition</a></li>
</ul>
</li>
<li><a href="#dashboard-task-definition">47.2. Definitions</a>
<ul class="sectlevel3">
<li><a href="#_creating_composed_task_definitions">47.2.1. Creating Composed Task Definitions</a></li>
<li><a href="#_launching_tasks">47.2.2. Launching Tasks</a></li>
</ul>
</li>
<li><a href="#dashboard-tasks-executions">47.3. Executions</a></li>
<li><a href="#dashboard-tasks-execution-detail">47.4. Execution Detail</a></li>
</ul>
</li>
<li><a href="#dashboard-jobs">48. Jobs</a>
<ul class="sectlevel2">
<li><a href="#dashboard-job-executions-details">48.1. Job Execution Details</a></li>
<li><a href="#dashboard-job-executions-steps">48.2. Step Execution Details</a></li>
<li><a href="#dashboard-job-executions-steps-progress">48.3. Step Execution Progress</a></li>
</ul>
</li>
<li><a href="#dashboard-task-scheduling">49. Scheduling</a>
<ul class="sectlevel2">
<li><a href="#_creating_or_deleting_a_schedule_from_the_task_definition_s_page">49.1. Creating or deleting a Schedule from the Task Definition&#8217;s page</a></li>
<li><a href="#_creating_a_schedule">49.2. Creating a Schedule</a></li>
<li><a href="#_listing_available_schedules">49.3. Listing Available Schedules</a></li>
</ul>
</li>
<li><a href="#dashboard-analytics">50. Analytics</a></li>
<li><a href="#dashboard-auditing">51. Auditing</a></li>
</ul>
</li>
<li><a href="#api-guide">REST API Guide</a></li>
<li><a href="#appendix">Appendices</a></li>
<li><a href="#howto">Appendix E: &#8220;How-to&#8221; guides</a>
<ul class="sectlevel1">
<li><a href="#_logging">52. Logging</a>
<ul class="sectlevel2">
<li><a href="#howto-deployment-logs">52.1. Deployment Logs</a></li>
<li><a href="#howto-application-logs">52.2. Application Logs</a></li>
</ul>
</li>
<li><a href="#dataflow-template">Appendix A: Data Flow Template</a>
<ul class="sectlevel2">
<li><a href="#_using_the_data_flow_template">A.1. Using the Data Flow Template</a></li>
</ul>
</li>
<li><a href="#migrationguide">Appendix B: Spring XD to SCDF</a>
<ul class="sectlevel2">
<li><a href="#_terminology_changes">B.1. Terminology Changes</a></li>
<li><a href="#_modules_to_applications">B.2. Modules to Applications</a>
<ul class="sectlevel3">
<li><a href="#_custom_applications">B.2.1. Custom Applications</a></li>
<li><a href="#_application_registration">B.2.2. Application Registration</a></li>
<li><a href="#_application_properties_4">B.2.3. Application Properties</a></li>
</ul>
</li>
<li><a href="#_message_bus_to_binders">B.3. Message Bus to Binders</a>
<ul class="sectlevel3">
<li><a href="#_message_bus">B.3.1. Message Bus</a></li>
<li><a href="#_binders">B.3.2. Binders</a></li>
<li><a href="#_named_channels">B.3.3. Named Channels</a></li>
<li><a href="#_directed_graphs">B.3.4. Directed Graphs</a></li>
</ul>
</li>
<li><a href="#_batch_to_tasks">B.4. Batch to Tasks</a></li>
<li><a href="#_shell_and_dsl_command_changes">B.5. Shell and DSL Command Changes</a></li>
<li><a href="#_rest_api_changes">B.6. REST API Changes</a></li>
<li><a href="#_ui_including_flo">B.7. UI (including Flo)</a></li>
<li><a href="#_architecture_components">B.8. Architecture Components</a>
<ul class="sectlevel3">
<li><a href="#_zookeeper">B.8.1. ZooKeeper</a></li>
<li><a href="#rdbms">B.8.2. RDBMS</a></li>
<li><a href="#_redis">B.8.3. Redis</a></li>
<li><a href="#_cluster_topology">B.8.4. Cluster Topology</a></li>
</ul>
</li>
<li><a href="#_central_configuration">B.9. Central Configuration</a></li>
<li><a href="#_distribution">B.10. Distribution</a></li>
<li><a href="#_hadoop_distribution_compatibility">B.11. Hadoop Distribution Compatibility</a></li>
<li><a href="#_use_case_comparison">B.12. Use Case Comparison</a>
<ul class="sectlevel3">
<li><a href="#_use_case_1_ticktock">B.12.1. Use Case #1: Ticktock</a></li>
<li><a href="#_use_case_2_stream_with_custom_module_or_application">B.12.2. Use Case #2: Stream with Custom Module or Application</a></li>
<li><a href="#_use_case_3_batch_job">B.12.3. Use Case #3: Batch Job</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#building">Appendix C: Building</a>
<ul class="sectlevel2">
<li><a href="#_documentation">C.1. Documentation</a></li>
<li><a href="#_working_with_the_code">C.2. Working with the Code</a>
<ul class="sectlevel3">
<li><a href="#_importing_into_eclipse_with_m2eclipse">C.2.1. Importing into Eclipse with m2eclipse</a></li>
<li><a href="#_importing_into_eclipse_without_m2eclipse">C.2.2. Importing into Eclipse without m2eclipse</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#contributing">Appendix D: Contributing</a>
<ul class="sectlevel2">
<li><a href="#_sign_the_contributor_license_agreement">D.1. Sign the Contributor License Agreement</a></li>
<li><a href="#_code_conventions_and_housekeeping">D.2. Code Conventions and Housekeeping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Version 1.7.3.RELEASE</p>
</div>
<div class="paragraph">
<p>&#169; 2012-2018 Pivotal Software, Inc.</p>
</div>
<div class="paragraph">
<p>Copies of this document may be made for your own use and for distribution to
others, provided that you do not charge any fee for such copies and further
provided that each copy contains this Copyright Notice, whether distributed in
print or electronically.</p>
</div>
</div>
</div>
<h1 id="kubernetes-getting-started" class="sect0"><a class="anchor" href="#kubernetes-getting-started"></a>Getting Started</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><a href="http://cloud.spring.io/spring-cloud-dataflow/">Spring Cloud Data Flow</a> is a toolkit for building data integration and real-time data-processing pipelines.</p>
</div>
<div class="paragraph">
<p>Pipelines consist of Spring Boot apps, built with the Spring Cloud Stream or Spring Cloud Task microservice frameworks. This makes Spring Cloud Data Flow suitable for a range of data-processing use cases, from import-export to event-streaming and predictive analytics.</p>
</div>
<div class="paragraph">
<p>This project provides support for using Spring Cloud Data Flow with Kubernetes as the runtime for these pipelines, with applications packaged as Docker images.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a>1. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers how to install the Spring Cloud Data Flow Server on a Kubernetes cluster.
Spring Cloud Data Flow depends on a few services and their availability.
For example, we need an RDBMS service for the application registry, stream and task repositories, and task management.
For streaming pipelines, we also need a messaging middleware option, such as Apache Kafka or RabbitMQ.
In addition, if the analytics features are in use, we need a Redis service.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This guide describes setting up an environment for testing Spring Cloud Data Flow on Google Kubernetes Engine and is not meant to be a definitive guide for setting up a production environment. Feel free to adjust the suggestions to fit your test setup. Remember that a production environment requires much more consideration for persistent storage of message queues, high availability, security, and other concerns.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, only applications registered with a <code>--uri</code> property pointing to a Docker resource are supported by the Data Flow Server for Kubernetes. However, we do support Maven resources for the <code>--metadata-uri</code> property, which is used to list the properties supported by each application. For example, the following application registration is valid:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">dataflow:>app register --type source --name time --uri docker://springcloudstream/time-source-rabbit:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:time-source-rabbit:jar:metadata:1.3.1.RELEASE</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, any application registered with a Maven, HTTP, or File resource for the executable jar (by using a <code>--uri</code> property prefixed with <code>maven://</code>, <code>http://</code> or <code>file://</code>) is <strong><em>not supported</em></strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_kubernetes_compatibility"><a class="anchor" href="#_kubernetes_compatibility"></a>1.1. Kubernetes Compatibility</h3>
<div class="paragraph">
<p>The Spring Cloud Data Flow implementation for Kubernetes uses the <a href="https://github.com/spring-cloud/spring-cloud-deployer-kubernetes">Spring Cloud Deployer Kubernetes</a>
library for orchestration. Before you begin setting up a Kubermetes cluster, refer to the <a href="https://github.com/spring-cloud/spring-cloud-deployer-kubernetes#kubernetes-compatibility">compatibility matrix</a>
to learn more about deployer and server compatibility against Kubernetes release versions.</p>
</div>
<div class="paragraph">
<p>The following outlines the compatibility between Spring Cloud Data Flow for Kubernetes Server and Kubernetes versions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">| Versions: SCDF K8S Server - K8S Deployer \ Kubernetes | 1.8.x | 1.9.x | 1.10.x |
|-------------------------------------------------------|-------|-------|--------|
| Server: 1.4.x - Deployer: 1.3.2                       |      |      |      |
| Server: 1.5.x - Deployer: 1.3.6                       |      |      |      |
| Server: 1.6.x - Deployer: 1.3.7                       |      |      |      |
| Server: 1.7.x - Deployer: 1.3.9                       |      |      |      |
|--------------------------------------------------------------------------------|</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_kubernetes_cluster"><a class="anchor" href="#_create_a_kubernetes_cluster"></a>1.2. Create a Kubernetes Cluster</h3>
<div class="paragraph">
<p>The Kubernetes <a href="https://kubernetes.io/docs/setup/pick-right-solution/">Picking the Right Solution</a> guide lets you choose among many options, so you can pick the one that you are most comfortable using.</p>
</div>
<div class="paragraph">
<p>All our testing is done with the <a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine</a> that is part of the Google Cloud Platform. That is also the target platform for this section. We have also successfully deployed with <a href="https://kubernetes.io/docs/getting-started-guides/minikube/">Minikube</a>. We note where you need to adjust for deploying on Minikube.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When starting Minikube, you should allocate some extra resources, since we deploy several services. We start with <code>minikube start --cpus=4 --memory=4096</code>. Please note that the allocated memory and cpu for the Minikube VM directly gets assigned to the number of applications deployed in a stream/task. The more you add, the more VM resources is required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The rest of this getting started guide assumes that you have a working Kubernetes cluster and a <code>kubectl</code> command line utility. See the docs for installation instructions: <a href="http://kubernetes.io/docs/user-guide/prereqs/">Installing and Setting up kubectl</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_with_code_kubectl_code"><a class="anchor" href="#_deploying_with_code_kubectl_code"></a>1.3. Deploying with <code>kubectl</code></h3>
<div class="paragraph">
<p>To deploy with <code>kubectl</code></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the Kubernetes configuration files.</p>
<div class="paragraph">
<p>You can use the sample deployment and service YAML files in the <a href="https://github.com/spring-cloud/spring-cloud-dataflow-server-kubernetes">https://github.com/spring-cloud/spring-cloud-dataflow-server-kubernetes</a> repository as a starting point. They have the required metadata set for service discovery by the different applications and services deployed. To check out the code, enter the following commands:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git clone https://github.com/spring-cloud/spring-cloud-dataflow-server-kubernetes
$ cd spring-cloud-dataflow-server-kubernetes
$ git checkout v1.7.3.RELEASE</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_choosing_a_message_broker"><a class="anchor" href="#_choosing_a_message_broker"></a>1.3.1. Choosing a Message Broker</h4>
<div class="paragraph">
<p>For deployed applications to communicate with each other, you need to select a message broker. The sample deployment and service YAML files provide configurations for RabbitMQ and Kafka. You need to configure only one message broker.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ</p>
<div class="paragraph">
<p>Run the following command to start the RabbitMQ service:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl create -f src/kubernetes/rabbitmq/</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use <code>kubectl get all -l app=rabbitmq</code> to verify that the deployment, pod, and service resources are running. You can use <code>kubectl delete all -l app=rabbitmq</code> to clean up afterwards.</p>
</div>
</li>
<li>
<p>Kafka</p>
<div class="paragraph">
<p>Run the following command to start the Kafka service:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl create -f src/kubernetes/kafka/</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use <code>kubectl get all -l app=kafka</code> to verify that the deployment, pod, and service resources are running. You can use <code>kubectl delete all -l app=kafka</code> to clean up afterwards.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-deploy-services-and-data-flow"><a class="anchor" href="#getting-started-deploy-services-and-data-flow"></a>1.3.2. Deploy Services and Data Flow</h4>
<div class="paragraph">
<p>You must deploy a number of services and the Data Flow server. To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy MySQL.</p>
<div class="paragraph">
<p>We use MySQL for this guide, but you could use a Postgres or H2 database instead. We include JDBC drivers for all three of these databases. To use a database other than MySQL, you must adjust the database URL and driver class name settings.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You can modify the password in the <code>src/kubernetes/mysql/mysql-deployment.yaml</code> files if you prefer to be more secure. If you do modify the password, you must also provide it as base64-encoded string in the <code>src/kubernetes/mysql/mysql-secrets.yaml</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the following command to start the MySQL service:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create -f src/kubernetes/mysql/</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use <code>kubectl get all -l app=mysql</code> to verify that the deployment, pod, and service resources are running. You can use <code>kubectl delete all,pvc,secrets -l app=mysql</code> to clean up afterwards.</p>
</div>
</li>
<li>
<p>Deploy Redis.</p>
<div class="paragraph">
<p>The Redis service is used for the analytics functionality. Run the following command to start the Redis service:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create -f src/kubernetes/redis/</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not need the analytics functionality, you can turn this feature off by setting <code>SPRING_CLOUD_DATAFLOW_FEATURES_ANALYTICS_ENABLED</code> to <code>false</code> in the <code>src/kubernetes/server/server-deployment.yaml</code> file. If you do not install the Redis service, you should also remove the Redis configuration settings from the following files depending on your message broker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ: <code>src/kubernetes/server/server-config-rabbit.yaml</code></p>
</li>
<li>
<p>Kafka: <code>src/kubernetes/server/server-config-kafka.yaml</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use <code>kubectl get all -l app=redis</code> to verify that the deployment, pod, and service resources are running. You can use <code>kubectl delete all -l app=redis</code> to clean up afterwards.</p>
</div>
</li>
<li>
<p>Deploy the Metrics Collector.</p>
<div class="paragraph">
<p>The Metrics Collector provides message rates for all deployed stream applications. These message rates are visible in the Dashboard UI. Run one of the following commands (depending on your message broker) to start the Metrics Collector:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ: <code>kubectl create -f src/kubernetes/metrics/metrics-deployment-rabbit.yaml</code></p>
</li>
<li>
<p>Kafka: <code>kubectl create -f src/kubernetes/metrics/metrics-deployment-kafka.yaml</code></p>
<div class="paragraph">
<p>Create the metrics service:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl create -f src/kubernetes/metrics/metrics-svc.yaml</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use <code>kubectl get all -l app=metrics</code> to verify that the deployment, pod, and service resources are running. You can use <code>kubectl delete all -l app=metrics</code> to clean up afterwards.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Deploy Skipper (optional, recommended)</p>
<div class="paragraph">
<p>Optionally, you can deploy <a href="http://cloud.spring.io/spring-cloud-skipper/">Skipper</a> to leverage the features of upgrading and
rolling back Streams, since Data Flow delegates to Skipper for those features. For more details, see
<a href="https://docs.spring.io/spring-cloud-skipper/docs/1.1.4.RELEASE/reference/htmlsingle/#overview">Spring Cloud Skipper Reference Guide</a>
for a complete overview.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Specify the version of Skipper that you want to deploy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The deployment is defined in the <code>src/kubernetes/skipper/skipper-deployment.yaml</code> file. To control what version of Skipper gets deployed, modify the tag used for the Docker image in the container specification, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">    spec:
      containers:
      - name: skipper
        image: springcloud/spring-cloud-skipper-server:1.1.4.RELEASE   <i class="conum" data-value="1"></i><b>(1)</b>
        imagePullPolicy: Always</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You may change the version as you like.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Skipper includes the concept of <a href="https://docs.spring.io/spring-cloud-skipper/docs/current/reference/htmlsingle/#using-platforms">platforms</a>,
so it is important to define the &#8220;accounts&#8221; based on the project preferences. In the preceding YAML file, the accounts map
to <code>minikube</code> as the platform. You can modify this, and you can have any number of platform definitions.
More details are in the <a href="https://docs.spring.io/spring-cloud-skipper/docs/1.1.4.RELEASE/reference/htmlsingle/#overview">Spring Cloud Skipper Reference Guide</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to orchestrate stream processing pipelines with Apache Kafka as the messaging middleware by using Skipper, you must change
the <code>SPRING_APPLICATION_JSON</code> environment variable value in the <code>src/kubernetes/skipper/skipper-deployment.yaml</code> file as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">"{\"spring.cloud.skipper.server.enableLocalPlatform\" : false, \"spring.cloud.skipper.server.platform.kubernetes.accounts.minikube.environmentVariables\": \"SPRING_CLOUD_STREAM_KAFKA_BINDER_BROKERS=${KAFKA_SERVICE_HOST}:${KAFKA_SERVICE_PORT}, SPRING_CLOUD_STREAM_KAFKA_BINDER_ZK_NODES=${KAFKA_ZK_SERVICE_HOST}:${KAFKA_ZK_SERVICE_PORT}\",\"spring.cloud.skipper.server.platform.kubernetes.accounts.minikube.memory\" : \"1024Mi\"}"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Additionally, if you want to use the
<a href="https://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle/#_apache_kafka_streams_binder">Apache Kafka Streams Binder</a>, configure the <code>SPRING_APPLICATION_JSON</code> environment variable in <code>src/kubernetes/skipper/skipper-deployment.yaml</code> as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">"{\"spring.cloud.skipper.server.enableLocalPlatform\" : false, \"spring.cloud.skipper.server.platform.kubernetes.accounts.minikube.environmentVariables\": \"SPRING_CLOUD_STREAM_KAFKA_BINDER_BROKERS=${KAFKA_SERVICE_HOST}:${KAFKA_SERVICE_PORT}, SPRING_CLOUD_STREAM_KAFKA_BINDER_ZK_NODES=${KAFKA_ZK_SERVICE_HOST}:${KAFKA_ZK_SERVICE_PORT}, SPRING_CLOUD_STREAM_KAFKA_STREAMS_BINDER_BROKERS=${KAFKA_SERVICE_HOST}:${KAFKA_SERVICE_PORT}, SPRING_CLOUD_STREAM_KAFKA_STREAMS_BINDER_ZK_NODES=${KAFKA_ZK_SERVICE_HOST}:${KAFKA_ZK_SERVICE_PORT}\",\"spring.cloud.skipper.server.platform.kubernetes.accounts.minikube.memory\" : \"1024Mi\"}"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Run the following commands to start Skipper as the companion server for Spring Cloud Data Flow:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create -f src/kubernetes/skipper/skipper-deployment.yaml
kubectl create -f src/kubernetes/skipper/skipper-svc.yaml</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use the command <code>kubectl get all -l app=skipper</code> to verify that the deployment, pod, and service resources are running. You can use <code>kubectl delete all -l app=skipper</code> to clean up afterwards.</p>
</div>
</li>
<li>
<p>Deploy the Data Flow Server.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Specify the version of Spring Cloud Data Flow server that you want to deploy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The deployment is defined in the <code>src/kubernetes/server/server-deployment.yaml</code> file. To control which version of Spring Cloud Data Flow server gets deployed, modify the tag used for the Docker image in the container specification, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">    spec:
      containers:
      - name: scdf-server
        image: springcloud/spring-cloud-dataflow-server-kubernetes:1.7.3.RELEASE   <i class="conum" data-value="1"></i><b>(1)</b>
        imagePullPolicy: Always</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Change the version as you like. This document is based on the <code>1.7.3.RELEASE</code> release. The docker tag <code>latest</code> can be used for <code>BUILD-SNAPSHOT</code> releases.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use Skipper, you must uncomment the following properties in <code>src/kubernetes/server/server-deployment.yaml</code>, under the <code>env:</code> section</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml"> - name: SPRING_CLOUD_SKIPPER_CLIENT_SERVER_URI
   value: 'http://${SKIPPER_SERVICE_HOST}/api'
 - name: SPRING_CLOUD_DATAFLOW_FEATURES_SKIPPER_ENABLED
   value: 'true'</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Data Flow Server uses the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 Java client library</a> to connect to the Kubernetes cluster. We use environment variables to set the values needed when deploying the Data Flow server to Kubernetes. We also use the <a href="https://github.com/fabric8io/spring-cloud-kubernetes">Fabric8 Spring Cloud integration with Kubernetes library</a> to access the Kubernetes <a href="http://kubernetes.io/docs/user-guide/configmap/">ConfigMap</a> and <a href="http://kubernetes.io/docs/user-guide/secrets/">Secrets</a> settings.
The ConfigMap settings for RabbitMQ are specified in the <code>src/kubernetes/server/server-config-rabbit.yaml</code> file and for Kafka in the <code>src/kubernetes/server/server-config-kafka.yaml</code> file. MySQL secrets are located in the <code>src/kubernetes/mysql/mysql-secrets.yaml</code> file. If you modified the password for MySQL, you should change it in the <code>src/kubernetes/mysql/mysql-secrets.yaml</code> file. Any secrets have to be provided in base64 encoding.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We now configure the Data Flow server with file-based security, and the default user is 'user' with a password of 'password'. You should change these values in <code>src/kubernetes/server/server-config-rabbit.yaml</code> for RabbitMQ or <code>src/kubernetes/server/server-config-kafka.yaml</code> for Kafka.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default memory for the pods is 1024Mi. If you expect most of your applications to require more memory, update the value in the <code>src/kubernetes/server/server-deployment.yaml</code> file .
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Since version 1.9, the latest releases of Kubernetes have enabled <a href="https://kubernetes.io/docs/admin/authorization/rbac/">RBAC</a> on the api-server. If your target platform has RBAC enabled, you must ask a <code>cluster-admin</code> to create the <code>roles</code> and <code>role-bindings</code> for you before deploying the Data Flow server. They associate the Data Flow service account with the roles it needs to be run with.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create Role Bindings and Service account:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create -f src/kubernetes/server/server-roles.yaml
kubectl create -f src/kubernetes/server/server-rolebinding.yaml
kubectl create -f src/kubernetes/server/service-account.yaml</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ: <code>kubectl create -f src/kubernetes/server/server-config-rabbit.yaml</code></p>
</li>
<li>
<p>Kafka: <code>kubectl create -f src/kubernetes/server/server-config-kafka.yaml</code></p>
<div class="paragraph">
<p>To create a server deployment:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create -f src/kubernetes/server/server-svc.yaml
kubectl create -f src/kubernetes/server/server-deployment.yaml</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use <code>kubectl get all -l app=scdf-server</code> to verify that the deployment, pod, and service resources are running. You can use <code>kubectl delete all,cm -l app=scdf-server</code> to clean up afterwards. To cleanup roles, bindings and the service account, use the following commands:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl delete role scdf-role
$ kubectl delete rolebinding scdf-rb
$ kubectl delete serviceaccount scdf-sa</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>kubectl get svc scdf-server</code> command to locate the <code>EXTERNAL_IP</code> address assigned to <code>scdf-server</code>. We use that later to connect from the shell. The following example (with output) shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get svc scdf-server
NAME         CLUSTER-IP       EXTERNAL-IP       PORT(S)    AGE
scdf-server  10.103.246.82    130.211.203.246   80/TCP     4m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The URL you need to use is in this case is <code><a href="http://130.211.203.246" class="bare">130.211.203.246</a></code>.</p>
</div>
<div class="paragraph">
<p>If you use Minikube, you do not have an external load balancer and the <code>EXTERNAL_IP</code> shows as <code>&lt;pending&gt;</code>. You need to use the <code>NodePort</code> assigned for the <code>scdf-server</code> service. You can use the following command to look up the URL to use:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ minikube service --url scdf-server
http://192.168.99.100:31991</code></pre>
</div>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_helm_installation"><a class="anchor" href="#_helm_installation"></a>2. Helm Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow offers a <a href="https://hub.kubeapps.com/charts/incubator/spring-cloud-data-flow">Helm Chart</a> for deploying
the Spring Cloud Data Flow server and its required services to a Kubernetes Cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Helm chart is available since the 1.2 GA release of Spring Cloud Data Flow for Kubernetes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following instructions cover how to initialize <code>Helm</code> and install Spring Cloud Data Flow on a Kubernetes cluster.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installing Helm</p>
<div class="paragraph">
<p><code>Helm</code> is comprised of two components: the client (Helm) and the server (Tiller).
The <code>Helm</code> client runs on your local machine and can be installed by following the instructions found
<a href="https://github.com/kubernetes/helm/blob/master/README.md#install">here</a>.
If Tiller has not been installed on your cluster, run the following <code>Helm</code> client command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ helm init</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To verify that the <code>Tiller</code> pod is running, use the following command: <code>kubectl get pod --namespace kube-system</code>. You should see the <code>Tiller</code> pod running.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Installing the Spring Cloud Data Flow Server and required services.</p>
<div class="paragraph">
<p>Update the <code>Helm</code> repository and install the chart:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ helm repo update
$ helm install --name my-release stable/spring-cloud-data-flow</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Spring Cloud Data Flow 1.7.0, the <code>Helm</code> chart has been promoted to the <code>Stable</code> repository. If you would like to install a previous version, you need access to the incubator repository. To add this repository to our <code>Helm</code> set and install the chart, run the following commands:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ helm repo add incubator https://kubernetes-charts-incubator.storage.googleapis.com
$ helm repo update
$ helm install --name my-release incubator/spring-cloud-data-flow</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you run on a Kubernetes cluster without a load balancer, such as in Minikube, you should override the service type to use <code>NodePort</code>.
To do so, add the <code>--set server.service.type=NodePort</code> override, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">helm install --name my-release --set server.service.type=NodePort \
    stable/spring-cloud-data-flow</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you run on a Kubernetes cluster without RBAC, such as in Minikube, you should override <code>rbac.create</code> to <code>false</code>. By default, it is set to <code>true</code> (based on best practices).
To do so, add the <code>--set rbac.create=false</code> override, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">helm install --name my-release --set server.service.type=NodePort \
    --set rbac.create=false \
    stable/spring-cloud-data-flow</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you wish to specify a version of Spring Cloud Data Flow other than the
current GA release, you can set the <code>server.version</code>, as follows (replacing <code>stable</code> with <code>incubator</code> if needed):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">helm install --name my-release stable/spring-cloud-data-flow --set server.version=&lt;version-you-want&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To see all of the settings that can be configured on the Spring Cloud Data Flow chart, view the <a href="https://github.com/kubernetes/charts/tree/master/incubator/spring-cloud-data-flow/README.md">README</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following listing shows Spring Cloud Data Flow&#8217;s Kubernetes version compatibility with the respective Helm Chart releases:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">| SCDF-K8S-Server Version \ Chart Version | 0.1.x | 0.2.x | 1.0.x |
|-----------------------------------------|-------|---------------|
|1.2.x                                    |      |     |      |
|1.3.x                                    |      |     |      |
|1.4.x                                    |      |     |      |
|1.5.x                                    |      |     |      |
|1.6.x                                    |      |     |      |
|1.7.x                                    |      |     |      |
|-----------------------------------------------------------------|</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should see the following output:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">NAME:   my-release
LAST DEPLOYED: Sat Mar 10 11:33:29 2018
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/Secret
NAME                  TYPE    DATA  AGE
my-release-mysql      Opaque  2     1s
my-release-data-flow  Opaque  2     1s
my-release-redis      Opaque  1     1s
my-release-rabbitmq   Opaque  2     1s

==&gt; v1/ConfigMap
NAME                          DATA  AGE
my-release-data-flow-server   1     1s
my-release-data-flow-skipper  1     1s

==&gt; v1/PersistentVolumeClaim
NAME                 STATUS   VOLUME                                    CAPACITY  ACCESSMODES  STORAGECLASS  AGE
my-release-rabbitmq  Bound    pvc-e9ed7f55-2499-11e8-886f-08002799df04  8Gi       RWO          standard      1s
my-release-mysql     Pending  standard                                  1s
my-release-redis     Pending  standard                                  1s

==&gt; v1/ServiceAccount
NAME                  SECRETS  AGE
my-release-data-flow  1        1s

==&gt; v1/Service
NAME                          CLUSTER-IP      EXTERNAL-IP  PORT(S)                                AGE
my-release-mysql              10.110.98.253   &lt;none&gt;       3306/TCP                               1s
my-release-data-flow-server   10.105.216.155  &lt;pending&gt;    80:32626/TCP                           1s
my-release-redis              10.111.63.33    &lt;none&gt;       6379/TCP                               1s
my-release-data-flow-metrics  10.107.157.1    &lt;none&gt;       80/TCP                                 1s
my-release-rabbitmq           10.106.76.215   &lt;none&gt;       4369/TCP,5672/TCP,25672/TCP,15672/TCP  1s
my-release-data-flow-skipper  10.100.28.64    &lt;none&gt;       80/TCP                                 1s

==&gt; v1beta1/Deployment
NAME                          DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE
my-release-mysql              1        1        1           0          1s
my-release-rabbitmq           1        1        1           0          1s
my-release-data-flow-metrics  1        1        1           0          1s
my-release-data-flow-skipper  1        1        1           0          1s
my-release-redis              1        1        1           0          1s
my-release-data-flow-server   1        1        1           0          1s


NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of the server by running 'kubectl get svc -w my-release-data-flow-server'
  export SERVICE_IP=$(kubectl get svc --namespace default my-release-data-flow-server -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
  echo http://$SERVICE_IP:80</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You have just created a new release in the default namespace of your Kubernetes cluster.
The <code>NOTES</code> section gives instructions for connecting to the newly installed server.
It takes a couple of minutes for the application and its required services to start up.
You can check on the status by issuing a <code>kubectl get pod -w</code> command.
Wait for the READY column to show <code>1/1</code> for all pods. Once that is done, you can
connect to the Data Flow server with the external IP listed by the
<code>kubectl get svc my-release-data-flow-server</code> command.
The default username is <code>user</code>, and its password is <code>password</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you run on Minikube, you can use the following command to get the URL for the server:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">minikube service --url my-release-data-flow-server</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To see what <code>Helm</code> releases you have running, you can use the <code>helm list</code> command.
When it is time to delete the release, run <code>helm delete my-release</code>.
This removes any resources created for the release but keeps release information
so that you can rollback any changes by using a <code>helm rollback my-release 1</code> command.
To completely delete the release and purge any release metadata, use <code>helm delete my-release --purge</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is an <a href="https://github.com/kubernetes/charts/issues/980">issue</a> with
generated secrets used for the required services getting
rotated on chart upgrades. To avoid this issue, set the password for these services
when installing the chart. You can use the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">helm install --name my-release \
    --set rabbitmq.rabbitmqPassword=rabbitpwd \
    --set mysql.mysqlRootPassword=mysqlpwd \
    --set redis.redisPassword=redispwd incubator/spring-cloud-data-flow</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-deploying-streams"><a class="anchor" href="#getting-started-deploying-streams"></a>3. Deploying Streams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers how to deploy streams with Spring Cloud Data Flow.
Your choice at this point is whether to use Skipper, which lets you discover applications and manage their lifecycles. For more about Skipper, see <a href="https://cloud.spring.io/spring-cloud-skipper/" class="bare">cloud.spring.io/spring-cloud-skipper/</a>.</p>
</div>
<div class="paragraph">
<p>If you want to use Skipper, see <a href="#getting-started-create-with-skipper">Create Streams with Skipper</a>. If not, continue reading.</p>
</div>
<div class="sect2">
<h3 id="getting-started-create-stream-without-skipper"><a class="anchor" href="#getting-started-create-stream-without-skipper"></a>3.1. Create Streams without Skipper</h3>
<div class="paragraph">
<p>This section describes how to create streams without using Skipper. To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and run the Spring Cloud Data Flow shell.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">wget http://repo.spring.io/release/org/springframework/cloud/spring-cloud-dataflow-shell/1.7.4.RELEASE/spring-cloud-dataflow-shell-1.7.4.RELEASE.jar

java -jar spring-cloud-dataflow-shell-1.7.4.RELEASE.jar</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You should see the following startup message from the shell:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">  ____                              ____ _                __
 / ___| _ __  _ __(_)_ __   __ _   / ___| | ___  _   _  __| |
 \___ \| '_ \| '__| | '_ \ / _` | | |   | |/ _ \| | | |/ _` |
  ___) | |_) | |  | | | | | (_| | | |___| | (_) | |_| | (_| |
 |____/| .__/|_|  |_|_| |_|\__, |  \____|_|\___/ \__,_|\__,_|
  ____ |_|    _          __|___/                 __________
 |  _ \  __ _| |_ __ _  |  ___| | _____      __  \ \ \ \ \ \
 | | | |/ _` | __/ _` | | |_  | |/ _ \ \ /\ / /   \ \ \ \ \ \
 | |_| | (_| | || (_| | |  _| | | (_) \ V  V /    / / / / / /
 |____/ \__,_|\__\__,_| |_|   |_|\___/ \_/\_/    /_/_/_/_/_/

1.7.4.RELEASE

Welcome to the Spring Cloud Data Flow shell. For assistance hit TAB or type "help".
server-unknown:></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Configure the Data Flow server URI with the following command (use the URL determined in the previous step and the default user name and password):</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">server-unknown:&gt;dataflow config server --username user --password password --uri http://130.211.203.246/
Successfully targeted http://130.211.203.246/
dataflow:&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Register the Docker images of the Rabbit or Kafka binder based <code>time</code> and <code>log</code> apps by using the shell.</p>
<div class="paragraph">
<p>RabbitMQ:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>dataflow:>app register --type source --name time --uri docker://springcloudstream/time-source-rabbit:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:time-source-rabbit:jar:metadata:1.3.1.RELEASE
dataflow:>app register --type sink --name log --uri docker://springcloudstream/log-sink-rabbit:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:log-sink-rabbit:jar:metadata:1.3.1.RELEASE</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Kafka:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>dataflow:>app register --type source --name time --uri docker://springcloudstream/time-source-kafka-10:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:time-source-kafka-10:jar:metadata:1.3.1.RELEASE
dataflow:>app register --type sink --name log --uri docker://springcloudstream/log-sink-kafka-10:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:log-sink-kafka-10:jar:metadata:1.3.1.RELEASE</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you want register all out-of-the-box stream applications for a particular binder in bulk,
you can use one of the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ: <code>dataflow:&gt;app import --uri <a href="http://bit.ly/Celsius-SR3-stream-applications-rabbit-docker" class="bare">bit.ly/Celsius-SR3-stream-applications-rabbit-docker</a></code></p>
</li>
<li>
<p>Kafka: <code>dataflow:&gt;app import --uri <a href="http://bit.ly/Celsius-SR3-stream-applications-kafka-10-docker" class="bare">bit.ly/Celsius-SR3-stream-applications-kafka-10-docker</a></code></p>
<div class="paragraph">
<p>For more details, review how to <a href="http://docs.spring.io/spring-cloud-dataflow/docs//reference/html/spring-cloud-dataflow-register-apps.html">register applications</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Deploy a simple stream in the shell, bu running the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream create --name ticktock --definition "time | log" --deploy</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use <code>kubectl get pods</code> to check on the state of the pods that correspond to this stream. You can run this from the shell by by adding a "!" before the command (which makes a command run as an OS command ).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;! kubectl get pods -l role=spring-app
command is:kubectl get pods -l role=spring-app
NAME                  READY     STATUS    RESTARTS   AGE
ticktock-log-0-qnk72  1/1       Running   0          2m
ticktock-time-r65cn   1/1       Running   0          2m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now you can view the logs for the pod deployed for the log sink by using the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;! kubectl logs ticktock-log-0-qnk72
command is:kubectl logs ticktock-log-0-qnk72
...
2017-07-20 04:34:37.369  INFO 1 --- [time.ticktock-1] log-sink                                 : 07/20/17 04:34:37
2017-07-20 04:34:38.371  INFO 1 --- [time.ticktock-1] log-sink                                 : 07/20/17 04:34:38
2017-07-20 04:34:39.373  INFO 1 --- [time.ticktock-1] log-sink                                 : 07/20/17 04:34:39
2017-07-20 04:34:40.380  INFO 1 --- [time.ticktock-1] log-sink                                 : 07/20/17 04:34:40
2017-07-20 04:34:41.381  INFO 1 --- [time.ticktock-1] log-sink                                 : 07/20/17 04:34:41</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Destroy the stream, by using the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream destroy --name ticktock</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To troubleshoot issues such as a container that has a fatal error starting up, add the <code>--previous</code> option to view the last terminated container log. You can also get more detailed information about the pods by using the <code>kubctl describe</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl describe pods/ticktock-log-qnk72</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you need to specify any of the application-specific configuration properties, you might use the &#8220;long form&#8221; of them by including the application-specific prefix (for example, <code>--jdbc.tableName=TEST_DATA</code>). If you did not register the <code>--metadata-uri</code> for the Docker based starter applications, this form is <strong>required</strong>. In this case, you also do not see the configuration properties listed when using the <code>app info</code> command or in the Dashboard GUI.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-create-with-skipper"><a class="anchor" href="#getting-started-create-with-skipper"></a>3.2. Create Streams with Skipper</h3>
<div class="paragraph">
<p>You can create a stream with Spring Cloud Skipper. Skipper lets you discover applications and manage their lifecycles. For more about Skipper, see <a href="https://cloud.spring.io/spring-cloud-skipper/" class="bare">cloud.spring.io/spring-cloud-skipper/</a>.
For more about using Skipper with streams, see <a href="#streams-using-skipper">Deploying Streams by Using Skipper</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_an_application_from_outside_the_cluster"><a class="anchor" href="#_accessing_an_application_from_outside_the_cluster"></a>3.3. Accessing an Application from outside the Cluster</h3>
<div class="paragraph">
<p>If you need to be able to connect from outside of the Kubernetes cluster to an application that you deploy (such as the <code>http-source</code>), you need to use either an external load balancer for the incoming connections or you need to use a NodePort configuration that exposes a proxy port on each Kubetnetes node. If your cluster does not support external load balancers (such as Minikube), you must use the NodePort approach. You can use deployment properties to configure the access. To specify that you want to have a load balancer with an external IP address created for your application&#8217;s service, use <code>deployer.http.kubernetes.createLoadBalancer=true</code> for the application. For the NodePort configuration, use <code>deployer.http.kubernetes.createNodePort=&lt;port&gt;</code>, where <code>&lt;port&gt;</code> is a number between 30000 and 32767.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register the <code>http-source</code> by using one of the following commands:</p>
<div class="paragraph">
<p>RabbitMQ:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:>app register --type source --name http --uri docker//springcloudstream/http-source-rabbit:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:http-source-rabbit:jar:metadata:1.3.1.RELEASE</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Kafka:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:>app register --type source --name http --uri docker//springcloudstream/http-source-kafka:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:http-source-kafka:jar:metadata:1.3.1.RELEASE</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create the <code>http | log</code> stream without deploying it by using the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream create --name test --definition "http | log"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If your cluster supports an External LoadBalancer for the <code>http-source</code>, you can use the following command to deploy the stream:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy test --properties "deployer.http.kubernetes.createLoadBalancer=true"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Check whether the pods have started by using the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;! kubectl get pods -l role=spring-app
command is:kubectl get pods -l role=spring-app
NAME               READY     STATUS    RESTARTS   AGE
test-http-2bqx7    1/1       Running   0          3m
test-log-0-tg1m4   1/1       Running   0          3m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Pods that are ready show <code>1/1</code> in the <code>READY</code> column.
Now you can look up the external IP address for the <code>http</code> application (it can sometimes take a minute or two for the external IP to get assigned) by using the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;! kubectl get service test-http
command is:kubectl get service test-http
NAME         CLUSTER-IP       EXTERNAL-IP      PORT(S)    AGE
test-http    10.103.251.157   130.211.200.96   8080/TCP   58s</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you use Minikube or any cluster that does not support an external load balancer, you should deploy the stream with a NodePort in the range of 30000-32767. You can use the following command to deploy it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy test --properties "deployer.http.kubernetes.createNodePort=32123"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Check whether the pods have started by using the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;! kubectl get pods -l role=spring-app
command is:kubectl get pods -l role=spring-app
NAME               READY     STATUS    RESTARTS   AGE
test-http-9obkq    1/1       Running   0          3m
test-log-0-ysiz3   1/1       Running   0          3m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Pods that are ready show <code>1/1</code> in the <code>READY</code> column.
Now you can look up the URL to use with the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock bash">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;! minikube service --url test-http
command is:minikube service --url test-http
http://192.168.99.100:32123</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Post some data to the <code>test-http</code> application either by using the <code>EXTERNAL_IP</code> address (mentioned <a href="#getting-started-deploy-services-and-data-flow">earlier</a>) with port 8080 or by using the URL provided by the following Minikube command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;http post --target http://130.211.200.96:8080 --data "Hello"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>View the logs for the <code>test-log</code> pod, by using the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;! kubectl get pods-l role=spring-app
command is:kubectl get pods-l role=spring-app
NAME              READY     STATUS             RESTARTS   AGE
test-http-9obkq   1/1       Running            0          2m
test-log-0-ysiz3  1/1       Running            0          2m
dataflow:&gt;! kubectl logs test-log-0-ysiz3
command is:kubectl logs test-log-0-ysiz3
...
2016-04-27 16:54:29.789  INFO 1 --- [           main] o.s.c.s.b.k.KafkaMessageChannelBinder$3  : started inbound.test.http.test
2016-04-27 16:54:29.799  INFO 1 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
2016-04-27 16:54:29.799  INFO 1 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 2147482647
2016-04-27 16:54:29.895  INFO 1 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
2016-04-27 16:54:29.896  INFO 1 --- [  kafka-binder-] log.sink                                 : Hello</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Destroy the stream</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream destroy --name test</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_tasks"><a class="anchor" href="#_deploying_tasks"></a>4. Deploying Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers how to deploy tasks. To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a task and launch it. To do so, register the <code>timestamp</code> task app and create a simple task definition and launch it, as follows:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:>app register --type task --name timestamp --uri docker:springcloudtask/timestamp-task:1.3.1.RELEASE --metadata-uri maven://org.springframework.cloud.task.app:timestamp-task:jar:metadata:1.3.1.RELEASE
dataflow:>task create task1 --definition "timestamp"
dataflow:>task launch task1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can now list the tasks and executions byusing the following commands:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">dataflow:&gt;task list

Task NameTask DefinitionTask Status

task1    timestamp      running    


dataflow:&gt;task execution list

Task NameID         Start Time                   End Time          Exit Code

task1    1 Fri May 05 18:12:05 EDT 2017Fri May 05 18:12:05 EDT 20170        
</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Destroy the task, by using the following command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;task destroy --name task1</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_and_server_properties"><a class="anchor" href="#_application_and_server_properties"></a>5. Application and Server Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers how you can customize the deployment of your applications. You can use a number of properties to influence settings for the applications that are deployed. Properties can be applied on a per-application basis or in the server configuration for all deployed applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Properties set on a per-application basis always take precedence over properties set as the server configuration. This arrangement allows for the ability to override global server level properties on a per-application basis.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/spring-cloud/spring-cloud-deployer-kubernetes/blob/master/src/main/java/org/springframework/cloud/deployer/spi/kubernetes/KubernetesDeployerProperties.java"><code>KubernetesDeployerProperties</code></a> for more on the supported options.</p>
</div>
<div class="sect2">
<h3 id="_using_deployments"><a class="anchor" href="#_using_deployments"></a>5.1. Using Deployments</h3>
<div class="paragraph">
<p>The deployer uses <code>ReplicationController</code> by default. To use deployments instead, you can set the following option as part of the container <code>env</code> section in a deployment YAML file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">env:
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_CREATE_DEPLOYMENT
  value: 'true'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is now the preferred setting and will be the default in future releases of the deployer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_memory_and_cpu_settings"><a class="anchor" href="#_memory_and_cpu_settings"></a>5.2. Memory and CPU Settings</h3>
<div class="paragraph">
<p>The apps are deployed by default with the following <code>Limits</code> and <code>Requests</code> settings:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Limits:
  cpu:	500m
  memory:	512Mi
Requests:
  cpu:	500m
  memory:	512Mi</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You might find that the 512Mi memory limit is too low. To increase it, you can provide a common <code>spring.cloud.deployer.memory</code> deployer property, as the following example shows (replace <code>&lt;app&gt;</code> with the name of the app for which you want to set the memory):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.memory=640m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This property affects both the <code>Requests</code> and <code>Limits</code> memory value set for the container.</p>
</div>
<div class="paragraph">
<p>If you want to set the <code>Requests</code> and <code>Limits</code> values separately, you can use the deployer properties that are specific to the Kubernetes deployer. The following example shows how to set <code>Limits</code> to <code>1000m</code> for <code>CPU</code> and <code>1024Mi</code> for memory and <code>Requests</code> to <code>800m</code> for CPU and <code>640Mi</code> for memory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.limits.cpu=1000m
deployer.&lt;app&gt;.kubernetes.limits.memory=1024Mi
deployer.&lt;app&gt;.kubernetes.requests.cpu=800m
deployer.&lt;app&gt;.kubernetes.requests.memory=640Mi</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Those values results in the following container settings being used:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Limits:
  cpu:	1
  memory:	1Gi
Requests:
  cpu:	800m
  memory:	640Mi</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using the common memory property, you should use an <code>m</code> suffix for the value. When using the Kubernetes-specific properties, you should use the Kubernetes <code>Mi</code> style suffix.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also control the default values to which to set the <code>cpu</code> and <code>memory</code> requirements for the pods that are created as part of application deployments. You can declare the following as part of the container <code>env</code> section in a deployment YAML file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">env:
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_CPU
  value: 500m
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_MEMORY
  value: 640Mi</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The settings we have used so far only affect the settings for the container. They do not affect the memory setting for the JVM process in the container. If you would like to set JVM memory settings, you can provide an environment variable to do so. See the next section for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>5.3. Environment Variables</h3>
<div class="paragraph">
<p>To influence the environment settings for a given application, you can take advantage of the <code>spring.cloud.deployer.kubernetes.environmentVariables</code> deployer property.
For example, a common requirement in production settings is to influence the JVM memory arguments.
You can achieve this by using the <code>JAVA_TOOL_OPTIONS</code> environment variable, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.environmentVariables=JAVA_TOOL_OPTIONS=-Xmx1024m</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>environmentVariables</code> property accepts a comma-delimited string. If an environment variable contains a value
which is also a comma-delimited string, it must be enclosed in single quotation marks&#8201;&#8212;&#8201;for example,
<code>spring.cloud.deployer.kubernetes.environmentVariables=spring.cloud.stream.kafka.binder.brokers='somehost:9092,
anotherhost:9093'</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This overrides the JVM memory setting for the desired <code>&lt;app&gt;</code> (replace <code>&lt;app&gt;</code> with the name of your application).</p>
</div>
</div>
<div class="sect2">
<h3 id="_liveness_and_readiness_probes"><a class="anchor" href="#_liveness_and_readiness_probes"></a>5.4. Liveness and Readiness Probes</h3>
<div class="paragraph">
<p>The <code>liveness</code> and <code>readiness</code> probes use paths called <code>/health</code> and <code>/info</code> respectively. They use a <code>delay</code> of <code>10</code> for both and a <code>period</code> of <code>60</code> and <code>10</code> respectively. You can change these defaults when you deploy the stream by using deployer properties.</p>
</div>
<div class="paragraph">
<p>The following example changes the <code>liveness</code> probe (replace <code>&lt;app&gt;</code> with the name of your application) by setting deployer properties:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.livenessProbePath=/health
deployer.&lt;app&gt;.kubernetes.livenessProbeDelay=120
deployer.&lt;app&gt;.kubernetes.livenessProbePeriod=20</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same can be declared as part of the container env section in a deployment YAML file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_LIVENESS_PROBE_PATH
  value: '/health'
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_LIVENESS_PROBE_DELAY
  value: '120'
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_LIVENESS_PROBE_PERIOD
  value: '20'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can swap <code>liveness</code> for <code>readiness</code> to override the default <code>readiness</code> settings.</p>
</div>
<div class="paragraph">
<p>By default, port 8080 is used as the probe port. You can change the defaults for both <code>liveness</code> and <code>readiness</code> probe ports by using deployer properties, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.readinessProbePort=7000
deployer.&lt;app&gt;.kubernetes.livenessProbePort=7000</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also set the port values in the container <code>env</code> section of a deployment YAML file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_READINESS_PROBE_PORT
  value: '7000'
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_LIVENESS_PROBE_PORT
  value: '7000'</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you intend to use Spring Boot 2.x+, all Actuator endpoints in Spring Boot 2.x have been moved under <code>/actuator</code> by default. You must adjust the <code>liveness</code> and <code>readiness</code> probe paths to the new defaults. The following example configures Spring Boot 2.x+ <code>liveness</code> and <code>readiness</code> endpoint paths (replace <code>&lt;app&gt;</code> with the name of your application):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.livenessProbePath=/actuator/health
deployer.&lt;app&gt;.kubernetes.readinessProbePath=/actuator/info</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To automatically set both <code>liveness</code> and <code>readiness</code> endpoints on a per-application basis to the default Spring Boot 2.x paths, you can set the following property:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.bootMajorVersion=2</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#base-path">Spring Boot 2.0 Migration Guide</a> for more information and how to restore the Spring Boot 1.x base path behavior.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can access secured probe endpoints by using credentials stored in a <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes secret</a>. You can use an existing secret, provided the credentials are contained under the <code>credentials</code> key name of the secret&#8217;s <code>data</code> block. You can configure probe authentication on a per-application basis. When enabled, it is applied to both the <code>liveness</code> and <code>readiness</code> probe endpoints by using the same credentials and authentication type. Currently, only <code>Basic</code> authentication is supported.</p>
</div>
<div class="paragraph">
<p>To create a new secret:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First generate the base64 string with the credentials used to access the secured probe endpoints.</p>
<div class="paragraph">
<p>Basic authentication encodes a username and password as a base64 string in the format of <code>username:password</code>.</p>
</div>
<div class="paragraph">
<p>The following example (which includes output and in which you should replace <code>user</code> and <code>pass</code> with your values) shows how to generate a base64 string:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ echo -n "user:pass" | base64
dXNlcjpwYXNz
$</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>With the encoded credentials, create a file (for example, <code>myprobesecret.yml</code>) with the following contents:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>apiVersion: v1
kind: Secret
metadata:
  name: myprobesecret
type: Opaque
data:
  credentials: GENERATED_BASE64_STRING</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Replace <code>GENERATED_BASE64_STRING</code> with the base64-encoded value generated earlier.</p>
</li>
<li>
<p>Create the secret by using <code>kubectl</code>, as the following example shows:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl create -f ./myprobesecret.yml
secret "myprobesecret" created
$</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Set the following deployer properties to use authentication when accessing probe endpoints, as the following example shows:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.probeCredentialsSecret=myprobesecret</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;app&gt;</code> with the name of the application to which to apply authentication.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_using_code_spring_application_json_code"><a class="anchor" href="#_using_code_spring_application_json_code"></a>5.5. Using <code>SPRING_APPLICATION_JSON</code></h3>
<div class="paragraph">
<p>You can use a <code>SPRING_APPLICATION_JSON</code> environment variable to set Data Flow server properties (including the configuration of maven repository settings) that are common across all of the Data Flow server implementations. These settings go at the server level in the container <code>env</code> section of a deployment YAML. The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>env:
- name: SPRING_APPLICATION_JSON
  value: "{ \"maven\": { \"local-repository\": null, \"remote-repositories\": { \"repo1\": { \"url\": \"https://repo.spring.io/libs-snapshot\"} } } }"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_private_docker_registry"><a class="anchor" href="#_private_docker_registry"></a>5.6. Private Docker Registry</h3>
<div class="paragraph">
<p>You can pull Docker images from a private registry on a per-application basis. First, you must create a secret in the cluster. Follow the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">Pull an Image from a Private Registry</a> guide to create the secret.</p>
</div>
<div class="paragraph">
<p>Once you have created the secret, use the <code>imagePullSecret</code> property to set the secret to use, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.&lt;app&gt;.kubernetes.imagePullSecret=mysecret</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;app&gt;</code> with the name of your application and <code>mysecret</code> with the name of the secret you created earlier.</p>
</div>
<div class="paragraph">
<p>You can also configure the image pull secret at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_IMAGE_PULL_SECRET
  value: mysecret</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>mysecret</code> with the name of the secret you created earlier.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotations"><a class="anchor" href="#_annotations"></a>5.7. Annotations</h3>
<div class="paragraph">
<p>You can add annotations to Kubernetes objects on a per-application basis. The supported object types are pod <code>Deployment</code>, <code>Service</code> and <code>Job</code>. Annotations are defined in a <code>key:value</code> format allowing for multiple annotations separated by a comma. For more information and use cases on annotations see <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how you can configure applications to use annotations:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>deployer.&lt;app&gt;.kubernetes.podAnnotations=annotationName:annotationValue
deployer.&lt;app&gt;.kubernetes.serviceAnnotations=annotationName:annotationValue,annotationName2:annotationValue2
deployer.&lt;app&gt;.kubernetes.jobAnnotations=annotationName:annotationValue</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;app&gt;</code> with the name of your application and the value of your annotations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entry_point_style"><a class="anchor" href="#_entry_point_style"></a>5.8. Entry Point Style</h3>
<div class="paragraph">
<p>An Entry Point Style affects how application properties are passed to the container to be deployed. Currently, three styles are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>exec</code>: (default) Passes all application properties and command line arguments in the deployment request as container args. Application properties are transformed into the format of <code>--key=value</code>.</p>
</li>
<li>
<p><code>shell</code>: Passes all application properties as environment variables. Command line arguments from the deployment request are not converted into environment variables nor set on the container. Application properties are transformed into an uppercase string and <code>.</code> characters are replaced with <code>_</code>.</p>
</li>
<li>
<p><code>boot</code>: Creates an environment variable called <code>SPRING_APPLICATION_JSON</code> that contains a JSON representation of all application properties. Command line arguments from the deployment request are set as container args.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In all cases, environment variables defined at the server level configuration and on a per-application basis are set onto the container as-is.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure applications as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>deployer.&lt;app&gt;.kubernetes.entryPointStyle=&lt;Entry Point Style&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;app&gt;</code> with the name of your application and <code>&lt;Entry Point Style&gt;</code> with your desired Entry Point Style.</p>
</div>
<div class="paragraph">
<p>You can also configure the Entry Point Style at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_ENTRY_POINT_STYLE
  value: entryPointStyle</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>entryPointStye</code> with the desired Entry Point Style.</p>
</div>
<div class="paragraph">
<p>You should choose an Entry Point Style of either <code>exec</code> or <code>shell</code>, to correspond to how the <code>ENTRYPOINT</code> syntax is defined in the container&#8217;s <code>Dockerfile</code>. For more information and uses cases on <code>exec</code> vs <code>shell</code>, see the <a href="https://docs.docker.com/engine/reference/builder/#entrypoint">ENTRYPOINT</a> section of the Docker documentation.</p>
</div>
<div class="paragraph">
<p>Using the <code>boot</code> Entry Point Style corresponds to using the <code>exec</code> style <code>ENTRYPOINT</code>. Command line arguments from the deployment request are passed to the container, with the addition of application properties mapped into the <code>SPRING_APPLICATION_JSON</code> environment variable rather than command line arguments.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you use the <code>boot</code> Entry Point Style, the <code>deployer.&lt;app&gt;.kubernetes.environmentVariables</code> property must not contain <code>SPRING_APPLICATION_JSON</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_service_account"><a class="anchor" href="#_deployment_service_account"></a>5.9. Deployment Service Account</h3>
<div class="paragraph">
<p>You can configure a custom service account for application deployments through properties. You can use an existing service account or create a new one. One way to create a service account is by using <code>kubectl</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl create serviceaccount myserviceaccountname
serviceaccount "myserviceaccountname" created</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can configure individual applications as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>deployer.&lt;app&gt;.kubernetes.deploymentServiceAccountName=myserviceaccountname</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;app&gt;</code> with the name of your application and <code>myserviceaccountname</code> with your service account name.</p>
</div>
<div class="paragraph">
<p>You can also configure the service account name at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_DEPLOYER_KUBERNETES_DEPLOYMENT_SERVICE_ACCOUNT_NAME
  value: myserviceaccountname</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>myserviceaccountname</code> with the service account name to be applied to all deployments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_image_pull_policy"><a class="anchor" href="#_image_pull_policy"></a>5.10. Image Pull Policy</h3>
<div class="paragraph">
<p>An image pull policy defines when a Docker image should be pulled to the local registry. Currently, three policies are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IfNotPresent</code>: (default) Do not pull an image if it already exists.</p>
</li>
<li>
<p><code>Always</code>: Always pull the image regardless of whether it already exists.</p>
</li>
<li>
<p><code>Never</code>: Never pull an image. Use only an image that already exists.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how you can individually configure applications:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>deployer.&lt;app&gt;.kubernetes.imagePullPolicy=Always</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;app&gt;</code> with the name of your application and <code>Always</code> with your desired image pull policy.</p>
</div>
<div class="paragraph">
<p>You can configure an image pull policy at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>        env:
        - name: SPRING_CLOUD_DEPLOYER_KUBERNETES_IMAGE_PULL_POLICY
          value: Always</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>Always</code> with your desired image pull policy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_labels"><a class="anchor" href="#_deployment_labels"></a>5.11. Deployment Labels</h3>
<div class="paragraph">
<p>Custom labels can be set on <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> related objects. See <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels</a> for more information on labels. Labels are specified in <code>key:value</code> format.</p>
</div>
<div class="paragraph">
<p>The following example shows how you can individually configure applications:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>deployer.&lt;app&gt;.kubernetes.deploymentLabels=myLabelName:myLabelValue</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;app&gt;</code> with the name of your application, <code>myLabelName</code> with your label name and <code>myLabelValue</code> with the value of your label.</p>
</div>
<div class="paragraph">
<p>Additionally, multiple labels can be applied, for example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>deployer.&lt;app&gt;.kubernetes.deploymentLabels=myLabelName:myLabelValue,myLabelName2:myLabelValue2</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="applications" class="sect0"><a class="anchor" href="#applications"></a>Applications</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>A selection of pre-built <a href="http://cloud.spring.io/spring-cloud-stream-app-starters/">stream</a> and <a href="http://cloud.spring.io/spring-cloud-task-app-starters/">task/batch</a> starter apps for various data integration and processing scenarios to facilitate learning and experimentation. The table below includes the pre-built applications at a glance. For more details, review how to <a href="#supported-apps-and-tasks">register supported applications</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_available_applications"><a class="anchor" href="#_available_applications"></a>6. Available Applications</h2>
<div class="sectionbody">
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Processor</th>
<th class="tableblock halign-left valign-top">Sink</th>
<th class="tableblock halign-left valign-top">Task</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-sftp-source">sftp</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-tcp-client-processor">tcp-client</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-mqtt-sink">mqtt</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud-task-app-starters/docs/Clark.RELEASE/reference/htmlsingle/#_spark_yarn_task">spark-yarn</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-jms-source">jms</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-scriptable-transform">scriptable-transform</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-log-sink">log</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud-task-app-starters/docs/Clark.RELEASE/reference/htmlsingle/#_spark_cluster_task">spark-cluster</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-ftp-source">ftp</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-clound-stream-modules-transform-processor">transform</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task-launcher-yarn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud-task-app-starters/docs/Clark.RELEASE/reference/html/spring-cloud-task-modules-spark-client.html">spark-client</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-time-source">time</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-header-enricher-processor">header-enricher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-throughput-sink">throughput</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud-task-app-starters/docs/Clark.RELEASE/reference/htmlsingle/#_timestamp_task">timestamp</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-load-generator-source">load-generator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-python-http-processor">python-http</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task-launcher-local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud-task-app-starters/docs/Clark.RELEASE/reference/htmlsingle/#_jdbchdfs_task">jdbchdfs-local</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-syslog-source">syslog</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-twitter-sentiment-processor">twitter-sentiment</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-mongodb-sink">mongodb</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud-task-app-starters/docs/Clark.RELEASE/reference/htmlsingle/#_composed_task_runner">composed-task-runner</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-aws-s3-source">s3</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-splitter">splitter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-hdfs-dataset-sink">hdfs-dataset</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud-task-app-starters/docs/Clark.RELEASE/reference/htmlsingle/#_timestamp_batch_task">timestamp-batch</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggregator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-bridge-processor">bridge</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-ftp-sink">ftp</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-trigger-source">triggertask</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-pmml-processor">pmml</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-jdbc-sink">jdbc</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-twitterstream-source">twitterstream</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-python-jython-processor">python-jython</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-aggregate-counter-sink">aggregate-counter</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-mongodb-source">mongodb</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-groovy-transform-processor">groovy-transform</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-cassandra-sink">cassandra</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-gemfire-cq-source">gemfire-cq</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-httpclient-processor">httpclient</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-router-sink">router</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-http-source">http</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-filter-processor">filter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-redis-sink">redis-pubsub</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-rabbit-source">rabbit</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-groovy-filter-processor">groovy-filter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-file-sink">file</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-tcp-source">tcp</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-aggregator-processor">aggregator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-websocket-sink">websocket</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-trigger-source">trigger</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-tensorflow-processor">tensorflow</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-aws-s3-sink">s3</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-mqtt-source">mqtt</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tasklaunchrequest-transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-rabbit-sink">rabbit</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-tcp-client-source">tcp-client</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-counter-sink">counter</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-mail-source">mail</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-pgcopy-sink">pgcopy</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-jdbc-source">jdbc</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-gpfdist-sink">gpfdist</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-gemfire-source">gemfire</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-sftp-sink">sftp</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-file-source">file</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-field-value-counter-sink">field-value-counter</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-hdfs-sink">hdfs</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-tcp-sink">tcp</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{scs-app-starters-docs-htmlsingle}/#spring-cloud-stream-modules-gemfire-sink">gemfire</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task-launcher-cloudfoundry</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="architecture" class="sect0"><a class="anchor" href="#architecture"></a>Architecture</h1>
<div class="sect1">
<h2 id="arch-intro"><a class="anchor" href="#arch-intro"></a>7. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow simplifies the development and deployment of applications focused on data processing use cases.
The major concepts of the architecture are Applications, the Data Flow Server, and the target runtime.</p>
</div>
<div class="paragraph">
<p>Applications come in two flavors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Long-lived Stream applications where an unbounded amount of data is consumed or produced through messaging middleware.</p>
</li>
<li>
<p>Short-lived Task applications that process a finite set of data and then terminate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the runtime, applications can be packaged in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Boot uber-jar that is hosted in a maven repository, file, or HTTP(S).</p>
</li>
<li>
<p>Docker image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The runtime is the place where applications execute.
The target runtimes for applications are platforms that you may already be using for other application deployments.</p>
</div>
<div class="paragraph">
<p>The supported platforms are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cloud Foundry</p>
</li>
<li>
<p>Kubernetes</p>
</li>
<li>
<p>Local Server</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The local server is supported in production for Task deployment as a replacement for the Spring Batch Admin project.  The local server is not supported in production for Stream deployments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is a deployer Service Provider Interface (SPI) that lets you extend Data Flow to deploy onto other runtimes.
There are community implementations</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/donovanmuller/spring-cloud-dataflow-server-nomad">HashiCorp Nomad</a></p>
</li>
<li>
<p><a href="https://github.com/donovanmuller/spring-cloud-dataflow-server-openshift">OpenShift</a></p>
</li>
<li>
<p><a href="https://github.com/trustedchoice/spring-cloud-dataflow-server-mesos">Apache Mesos</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/spring-cloud/spring-cloud-dataflow-server-yarn">Apache YARN</a> implementation has reached end-of-line status.
Let us know at <a href="https://gitter.im/spring-cloud/spring-cloud-dataflow">Gitter</a> if youare interested in forking the project to continue developing and maintaining it.</p>
</div>
<div class="paragraph">
<p>There are two mutually exclusive options that determine how long lived streaming applications are deployed to the platform.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select a Spring Cloud Data Flow Server executable jar that targets a single platform.</p>
</li>
<li>
<p>Enable the Spring Cloud Data Flow Server to delegate the deployment and runtime status of applications to the Spring Cloud Skipper Server, which has the capability to deploy to multiple platforms.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Selecting the Spring Cloud Skipper option also enables the ability to update and rollback applications in a Stream at runtime.</p>
</div>
<div class="paragraph">
<p>The Data Flow server is also responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interpreting and executing a stream DSL that describes the logical flow of data through multiple long-lived applications.</p>
</li>
<li>
<p>Launching a long-lived task application.</p>
</li>
<li>
<p>Interpreting and executing a composed task DSL that describes the logical flow of data through multiple short-lived applications.</p>
</li>
<li>
<p>Applying a deployment manifest that describes the mapping of applications onto the runtime - for example, to set the initial number of instances, memory requirements, and data partitioning.</p>
</li>
<li>
<p>Providing the runtime status of deployed applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, the stream DSL to describe the flow of data from an HTTP source to an Apache Cassandra sink would be written using a Unix pipes and filter syntax " <code>http | cassandra</code> ".  Each name in the DSL is mapped to an application that can that Maven or Docker repositories.  You can also register an application to an <code>http</code> location.  Many source, processor, and sink applications for common use cases (such as JDBC, HDFS, HTTP, and router) are provided by the Spring Cloud Data Flow team.  The pipe symbol represents the communication between the two applications through messaging middleware. The two messaging middleware brokers that are supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>RabbitMQ</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the case of Kafka, when deploying the stream, the Data Flow server is responsible for creating the topics that correspond to each pipe symbol and configure each application to produce or consume from the topics so the desired flow of data is achieved.  Similarly for RabbitMQ, exchanges and queues are created as needed to achieve the desired flow.</p>
</div>
<div class="paragraph">
<p>The interaction of the main components is shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-arch.png" alt="The Spring Cloud Data Flow High Level Architecture">
</div>
<div class="title">Figure 1. The Spring Cloud Data High Level Architecure</div>
</div>
<div class="paragraph">
<p>In the preceding diagram, a DSL description of a stream is POSTed to the Data Flow Server.  Based on the mapping of DSL application names to Maven and Docker artifacts, the http-source and cassandra-sink applications are deployed on the target runtime.  Data that is posted to the HTTP application will then be stored in Cassandra.  The <a href="https://docs.spring.io/spring-cloud-dataflow-samples/docs/current/reference/html/_streaming.html#spring-cloud-data-flow-samples-http-cassandra-overview">Samples Repository</a> shows this use case in full detail.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-microservice-style"><a class="anchor" href="#arch-microservice-style"></a>8. Microservice Architectural Style</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Data Flow Server deploys applications onto the target runtime that conform to the microservice architectural style.  For example, a stream represents a high-level application that consists of multiple small microservice applications each running in their own process.  Each microservice application can be scaled up or down independently of the other and each has its own versioning lifecycle.  Using Data Flow with Skipper enables you to independently upgrade or rollback each application at runtime.</p>
</div>
<div class="paragraph">
<p>Both Streaming and Task-based microservice applications build upon Spring Boot as the foundational library.
This gives all microservice applications functionality such as health checks, security, configurable logging, monitoring, and management functionality, as well as executable JAR packaging.</p>
</div>
<div class="paragraph">
<p>It is important to emphasize that these microservice applications are 'just apps' that you can run by yourself by using <code>java -jar</code> and passing in appropriate configuration properties.  We provide many common microservice applications for common operations so you need not start from scratch when addressing common use cases that build upon the rich ecosystem of Spring Projects, such as Spring Integration, Spring Data, and Spring Batch.  Creating your own microservice application is similar to creating other Spring Boot applications. You can start by using the <a href="https://start.spring.io">Spring Initializr web site</a> to create the basic scaffolding of either a Stream or Task-based microservice.</p>
</div>
<div class="paragraph">
<p>In addition to passing the appropriate application properties to each applications, the Data Flow server is responsible for preparing the target platform&#8217;s infrastructure so that the applications can be deployed.  For example, in Cloud Foundry, it would bind specified services to the applications and execute the <code>cf push</code> command for each application.  For Kubernetes, it would create the replication controller, service, and load balancer.</p>
</div>
<div class="paragraph">
<p>The Data Flow Server helps simplify the deployment of multiple, relatated, applications onto a target runtime, setting up necessary input and output topics, partitions, and metrics functionality.  However, one could also opt to deploy each of the microservice applications manually and not use Data Flow at all. This approach might be more appropriate to start out with for small scale deployments, gradually adopting the convenience and consistency of Data Flow as you develop more applications.
Manual deployment of Stream- and Task-based microservices is also a useful educational exercise that can help you better understand some of the automatic application configuration and platform targeting steps that the Data Flow Server provides.</p>
</div>
<div class="sect2">
<h3 id="arch-comparison"><a class="anchor" href="#arch-comparison"></a>8.1. Comparison to Other Platform Architectures</h3>
<div class="paragraph">
<p>Spring Cloud Data Flows architectural style is different than other Stream and Batch processing platforms.  For example in Apache Spark, Apache Flink, and Google Cloud Dataflow, applications run on a dedicated compute engine cluster.  The nature of the compute engine gives these platforms a richer environment for performing complex calculations on the data as compared to Spring Cloud Data Flow, but it introduces the complexity of another execution environment that is often not needed when creating data-centric applications.  That does not mean you cannot do real-time data computations when using Spring Cloud Data Flow.  Refer to the section <a href="#arch-analytics">Analytics</a>, which describes the integration of Redis to handle common counting-based use cases.  Spring Cloud Stream also supports using Reactive APIs such as <a href="https://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle/#_reactive_programming_support">Project Reactor and RxJava</a> which can be useful for creating functional style applications that contain time-sliding-window and moving-average functionality.  Similarly, Spring Cloud Stream also supports the development of applications in that use the <a href="https://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle/#_kafka_streams_binding_capabilities_of_spring_cloud_stream">Kafka Streams</a> API.</p>
</div>
<div class="paragraph">
<p>Apache Storm, Hortonworks DataFlow, and Spring Cloud Data Flows predecessor, Spring XD, use a dedicated application execution cluster, unique to each product, that determines where your code should run on the cluster and performs health checks to ensure that long-lived applications are restarted if they fail.  Often, framework-specific interfaces are required in order to correctly plug in to the clusters execution framework.</p>
</div>
<div class="paragraph">
<p>As we discovered during the evolution of Spring XD, the rise of multiple container frameworks in 2015 made creating our own runtime a duplication of effort.  There is no reason to build your own resource management mechanics when there are multiple runtime platforms that offer this functionality already.  Taking these considerations into account is what made us shift to the current architecture, where we delegate the execution to popular runtimes, which you may already be using for other purposes.  This is an advantage in that it reduces the cognitive distance for creating and managing data-centric applications as many of the same skills used for deploying other end-user/web applications are applicable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-data-flow-server"><a class="anchor" href="#arch-data-flow-server"></a>9. Data Flow Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Data Flow Server provides the following functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#arch-data-flow-server-endpoints">Endpoints</a></p>
</li>
<li>
<p><a href="#arch-data-flow-server-security">Security</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="arch-data-flow-server-endpoints"><a class="anchor" href="#arch-data-flow-server-endpoints"></a>9.1. Endpoints</h3>
<div class="paragraph">
<p>The Data Flow Server uses an embedded servlet container and exposes REST endpoints for creating, deploying, undeploying, and destroying streams and tasks, querying runtime state, analytics, and the like. The Data Flow Server is implemented by using Springs MVC framework and the <a href="https://github.com/spring-projects/spring-hateoas">Spring HATEOAS</a> library to create REST representations that follow the HATEOAS principle, as shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-server-arch.png" alt="The Spring Cloud Data Flow Server Architecture">
</div>
<div class="title">Figure 2. The Spring Cloud Data Flow Server</div>
</div>
<div class="paragraph">
<p>[NOTE] The Data Flow Server that deploys applications to the  local machine is not intended to be used in production for streaming use cases but for the development and testing of stream based applications.
The local Data Flow  <strong>is</strong> intended to be used in production for batch use cases as a replacement for the Spring Batch Admin project.
Both streaming and batch use cases are intended to be used in production when deploying to Cloud Foundry or Kuberenetes.</p>
</div>
</div>
<div class="sect2">
<h3 id="arch-data-flow-server-security"><a class="anchor" href="#arch-data-flow-server-security"></a>9.2. Security</h3>
<div class="paragraph">
<p>The Data Flow Server executable jars support basic HTTP, LDAP(S), File-based, and OAuth 2.0 authentication to access its endpoints. Refer to the <a href="#configuration-security">security section</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-streams"><a class="anchor" href="#arch-streams"></a>10. Streams</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="arch-streams-topologies"><a class="anchor" href="#arch-streams-topologies"></a>10.1. Topologies</h3>
<div class="paragraph">
<p>The Stream DSL describes linear sequences of data flowing through the system.  For example, in the stream definition <code>http | transformer | cassandra</code>, each pipe symbol connects the application on the left to the one on the right.  Named channels can be used for routing and to fan in/fan out data to multiple messaging destinations.</p>
</div>
<div class="paragraph">
<p>The concept of a <a href="#spring-cloud-dataflow-stream-dsl-tap">tap</a> can be used to listen to the data that is flowing across any of the pipe symbols. "Taps" are just other streams that use an input any one of the "pipes" in a target stream and have an independent life cycle from the target stream.</p>
</div>
</div>
<div class="sect2">
<h3 id="arch-streams-concurrency"><a class="anchor" href="#arch-streams-concurrency"></a>10.2. Concurrency</h3>
<div class="paragraph">
<p>For an application that consumes events, Spring Cloud Stream exposes a concurrency setting that controls the size of a thread pool used for dispatching incoming messages.  See the {spring-cloud-stream-docs}#_consumer_properties[Consumer properties] documentation for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="arch-streams-partitioning"><a class="anchor" href="#arch-streams-partitioning"></a>10.3. Partitioning</h3>
<div class="paragraph">
<p>A common pattern in stream processing is to partition the data as it moves from one application to the next.  Partitioning is a critical concept in stateful processing, for either performance or consistency reasons, to ensure that all related data is processed together. For example, in a time-windowed average calculation example, it is important that all measurements from any given sensor are processed by the same application instance.  Alternatively, you may want to cache some data related to the incoming events so that it can be enriched without making a remote procedure call to retrieve the related data.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Data Flow supports partitioning by configuring Spring Cloud Stream&#8217;s output and input bindings.  Spring Cloud Stream provides a common abstraction for implementing partitioned processing use cases in a uniform fashion across different types of middleware.  Partitioning can thus be used whether the broker itself is naturally partitioned (for example, Kafka topics) or not (RabbitMQ).  The following image shows how data could be partitioned into two buckets, such that each instance of the average processor application consumes a unique set of data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/stream-partitioning.png" alt="Stream Partitioning Architecture">
</div>
<div class="title">Figure 3. Spring Cloud Stream Partitioning</div>
</div>
<div class="paragraph">
<p>To use a simple partitioning strategy in Spring Cloud Data Flow, you need only set the instance count for each application in the stream and a <code>partitionKeyExpression</code> producer property when deploying the stream.  The <code>partitionKeyExpression</code> identifies what part of the message is used as the key to partition data in the underlying middleware.  An <code>ingest</code> stream can be defined as <code>http | averageprocessor | cassandra</code>. (Note that the Cassandra sink is not shown in the diagram above.)  Suppose the payload being sent to the HTTP source was in JSON format and had a field called <code>sensorId</code>. For example, consider the case of deploying the stream with the shell command <code>stream deploy ingest --propertiesFile ingestStream.properties</code> where the contents of the <code>ingestStream.properties</code> file are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">deployer.http.count=3
deployer.averageprocessor.count=2
app.http.producer.partitionKeyExpression=payload.sensorId</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is to deploy the stream such that all the input and output destinations are configured for data to flow through the applications but also ensure that a unique set of data is always delivered to each <code>averageprocessor</code> instance.  In this case, the default algorithm is to evaluate <code>payload.sensorId % partitionCount</code> where the <code>partitionCount</code> is the application count in the case of RabbitMQ and the partition count of the topic in the case of Kafka.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="#passing_stream_partition_properties">Passing Stream Partition Properties</a> for additional strategies to partition streams during deployment and how they map onto the underlying {spring-cloud-stream-docs}#_partitioning[Spring Cloud Stream Partitioning properties].</p>
</div>
<div class="paragraph">
<p>Also note that you cannot currently scale partitioned streams.  Read <a href="#arch-runtime-scaling">Scaling at Runtime</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="arch-streams-delivery"><a class="anchor" href="#arch-streams-delivery"></a>10.4. Message Delivery Guarantees</h3>
<div class="paragraph">
<p>Streams are composed of applications that use the Spring Cloud Stream library as the basis for communicating with the underlying messaging middleware product.  Spring Cloud Stream also provides an opinionated configuration of middleware from several vendors, in particular providing {spring-cloud-stream-docs}#_persistent_publish_subscribe_support[persistent publish-subscribe semantics].</p>
</div>
<div class="paragraph">
<p>The {spring-cloud-stream-docs}#_binders[Binder abstraction] in Spring Cloud Stream is what connects the application to the middleware.  There are several configuration properties of the binder that are portable across all binder implementations and some that are specific to the middleware.</p>
</div>
<div class="paragraph">
<p>For consumer applications, there is a retry policy for exceptions generated during message handling. The retry policy is configured by using the {spring-cloud-stream-docs}#_consumer_properties[common consumer properties] <code>maxAttempts</code>, <code>backOffInitialInterval</code>, <code>backOffMaxInterval</code>, and <code>backOffMultiplier</code>.  The default values of these properties retry the callback method invocation 3 times and wait one second for the first retry.  A backoff multiplier of 2 is used for the second and third attempts.</p>
</div>
<div class="paragraph">
<p>When the number of retry attempts has exceeded the <code>maxAttempts</code> value, the exception and the failed message become the payload of a message and are sent to the application&#8217;s error channel. By default, the default message handler for this error channel logs the message. You can change the default behavior in your application by creating your own message handler that subscribes to the error channel.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Stream also supports a configuration option for both Kafka and RabbitMQ binder implementations that sends the failed message and stack trace to a dead letter queue.  The dead letter queue is a destination and its nature depends on the messaging middleware (for example, in the case of Kafka, it is a dedicated topic).  To enable this for RabbitMQ set the <code>republishtoDlq</code> and <code>autoBindDlq</code> {spring-cloud-stream-docs}#_rabbitmq_consumer_properties[consumer properties] and the <code>autoBindDlq</code> {spring-cloud-stream-docs}#_rabbit_producer_properties[producer property] to true when deploying the stream.  To always apply these producer and consumer properties when deploying streams, configure them as <a href="#spring-cloud-dataflow-global-properties">common application properties</a> when starting the Data Flow server.</p>
</div>
<div class="paragraph">
<p>Additional messaging delivery guarantees are those provided by the underlying messaging middleware that is chosen for the application for both producing and consuming applications.  Refer to the Kafka {spring-cloud-stream-docs}#_kafka_consumer_properties[Consumer] and {spring-cloud-stream-docs}#_kafka_producer_properties[Producer] and Rabbit {spring-cloud-stream-docs}#_rabbitmq_consumer_properties[Consumer] and {spring-cloud-stream-docs}#_rabbit_producer_properties[Producer] documentation for more details.  You can find extensive declarative support for all the native QOS options.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-streaming-apps"><a class="anchor" href="#arch-streaming-apps"></a>11. Stream Programming Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While Spring Boot provides the foundation for creating DevOps-friendly microservice applications, other libraries in the Spring ecosystem help create Stream-based microservice applications.  The most important of these is Spring Cloud Stream.</p>
</div>
<div class="paragraph">
<p>The essence of the Spring Cloud Stream programming model is to provide an easy way to describe multiple inputs and outputs of an application that communicate over messaging middleware. These input and outputs map onto Kafka topics or Rabbit exchanges and queues as well as the KStream/KTable programming model.  Common application configuration for a Source that generates data, a Processor that consumes and produces data, and a Sink that consumes data is provided as part of the library.</p>
</div>
<div class="sect2">
<h3 id="arch-streaming-imperative-programming"><a class="anchor" href="#arch-streaming-imperative-programming"></a>11.1. Imperative Programming Model</h3>
<div class="paragraph">
<p>Spring Cloud Stream is most closely integrated with Spring Integrations imperative "one event at a time" programming model.  This means you write code that handles a single event callback, as shown in the following example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableBinding(Sink.class)
public class LoggingSink {

    @StreamListener(Sink.INPUT)
    public void log(String message) {
        System.out.println(message);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>String</code> payload of a message coming on the input channel is handed to the <code>log</code> method.  The <code>@EnableBinding</code> annotation is used to tie the input channel to the external middleware.</p>
</div>
</div>
<div class="sect2">
<h3 id="arch-streaming-functional-programming"><a class="anchor" href="#arch-streaming-functional-programming"></a>11.2. Functional Programming Model</h3>
<div class="paragraph">
<p>However, Spring Cloud Stream can support other programming styles, such as reactive APIs, where incoming and outgoing data is handled as continuous data flows and how each individual message should be handled is defined. With many reactive AOIs, you can also use operators that describe functional transformations from inbound to outbound data flows.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableBinding(Processor.class)
public static class UppercaseTransformer {

  @StreamListener
  @Output(Processor.OUTPUT)
  public Flux&lt;String&gt; receive(@Input(Processor.INPUT) Flux&lt;String&gt; input) {
    return input.map(s -&gt; s.toUpperCase());
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-application-versioning"><a class="anchor" href="#arch-application-versioning"></a>12. Application Versioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Application versioning within a Stream is now supported when using Data Flow together with Skipper.  You can update application and deployment properties as well as the version of the application.
Rolling back to a previous application version is also supported.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-task"><a class="anchor" href="#arch-task"></a>13. Task Programming Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Cloud Task programming model provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistence of the Tasks lifecycle events and exit code status.</p>
</li>
<li>
<p>Lifecycle hooks to execute code before or after a task execution.</p>
</li>
<li>
<p>The ability to emit task events to a stream (as a source) during the task lifecycle.</p>
</li>
<li>
<p>Integration with Spring Batch Jobs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="#spring-cloud-dataflow-task">Tasks</a> section for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-analytics"><a class="anchor" href="#arch-analytics"></a>14. Analytics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow is aware of certain Sink applications that write counter data to Redis and provides a REST endpoint to read counter data.  The types of counters supported are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-cloud-stream-app-starters/counter/tree/master/spring-cloud-starter-stream-sink-counter">Counter</a>: Counts the number of messages it receives, optionally storing counts in a separate store such as Redis.</p>
</li>
<li>
<p><a href="https://github.com/spring-cloud-stream-app-starters/field-value-counter/tree/master/spring-cloud-starter-stream-sink-field-value-counter">Field Value Counter</a>: Counts occurrences of unique values for a named field in a message payload.</p>
</li>
<li>
<p><a href="https://github.com/spring-cloud-stream-app-starters/aggregate-counter/tree/master/spring-cloud-starter-stream-sink-aggregate-counter">Aggregate Counter</a>: Stores total counts but also retains the total count values for each minute, hour, day, and month.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the timestamp used in the aggregate counter can come from a field in the message itself so that out-of-order messages are properly accounted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arch-runtime"><a class="anchor" href="#arch-runtime"></a>15. Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Data Flow Server relies on the target platform for the following runtime functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#arch-runtime-fault-tolerance">Fault Tolerance</a></p>
</li>
<li>
<p><a href="#arch-runtime-resource-management">Resource Management</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="arch-runtime-fault-tolerance"><a class="anchor" href="#arch-runtime-fault-tolerance"></a>15.1. Fault Tolerance</h3>
<div class="paragraph">
<p>The target runtimes supported by Data Flow all have the ability to restart a long-lived application. Spring Cloud Data Flow sets up health probes are required by the runtime environment when deploying the application.
You also have the ability to customize the health probes.</p>
</div>
<div class="paragraph">
<p>The collective state of all applications that make up the stream is used to determine the state of the stream. If an application fails, the state of the stream changes from deployed to partial.</p>
</div>
</div>
<div class="sect2">
<h3 id="arch-runtime-resource-management"><a class="anchor" href="#arch-runtime-resource-management"></a>15.2. Resource Management</h3>
<div class="paragraph">
<p>Each target runtime lets you control the amount of memory, disk, and CPU allocated to each application. These are passed as properties in the deployment manifest by using key names that are unique to each runtime. Refer to each platform&#8217;s server documentation for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="arch-runtime-scaling"><a class="anchor" href="#arch-runtime-scaling"></a>15.3. Scaling at Runtime</h3>
<div class="paragraph">
<p>When deploying a stream, you can set the instance count for each individual application that makes up the stream.
Once the stream is deployed, each target runtime lets you control the target number of instances for each individual application.
Using the APIs, UIs, or command line tools for each runtime, you can scale up or down the number of instances as required.</p>
</div>
<div class="paragraph">
<p>Currently, scaling at runtime is not supported with the Kafka binder, as well as with partitioned streams, for which the suggested workaround is redeploying the stream with an updated number of instances.
Both cases require a static consumer to be set up, based on information about the total instance count and current instance index.</p>
</div>
</div>
</div>
</div>
<h1 id="configuration" class="sect0"><a class="anchor" href="#configuration"></a>Server Configuration</h1>
<div class="openblock partintro">
<div class="content">
This section describes how to configure Spring Cloud Data Flow features, such as security and which relational database to use.
</div>
</div>
<div class="sect1">
<h2 id="enable-disable-specific-features"><a class="anchor" href="#enable-disable-specific-features"></a>16. Feature Toggles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data Flow server offers specific set of features that can be enabled or disabled when launching. These features include all the lifecycle operations, REST endpoints (server and client implementations including Shell and the UI) for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Streams</p>
</li>
<li>
<p>Tasks</p>
</li>
<li>
<p>Analytics</p>
</li>
<li>
<p>Schedules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can enable or disable these features by setting the following boolean environment variables when launching the Data Flow server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SPRING_CLOUD_DATAFLOW_FEATURES_STREAMS_ENABLED</code></p>
</li>
<li>
<p><code>SPRING_CLOUD_DATAFLOW_FEATURES_TASKS_ENABLED</code></p>
</li>
<li>
<p><code>SPRING_CLOUD_DATAFLOW_FEATURES_ANALYTICS_ENABLED</code></p>
</li>
<li>
<p><code>SPRING_CLOUD_DATAFLOW_FEATURES_SCHEDULES_ENABLED</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, all the features are enabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since the analytics feature is enabled by default, the Data Flow server is expected to have a valid Redis store available as an analytics repository. Consequently, we provide a default implementation of analytics based on Redis. This also means that the Data Flow server&#8217;s <code>health</code> depends on the redis store availability as well. If you do not want to enable HTTP endpoints to read analytics data written to Redis, you can disable the analytics feature by setting the property mentioned earlier to <code>false</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>/features</code> REST endpoint provides information on the features that have been enabled and disabled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-general"><a class="anchor" href="#configuration-general"></a>17. General Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Cloud Data Flow server for Kubernetes uses the <a href="https://github.com/fabric8io/spring-cloud-kubernetes"><code>spring-cloud-kubernetes</code></a> module process both the ConfigMap and the secrets settings. To enable the ConfigMap support, pass in an environment variable of <code>SPRING_CLOUD_KUBERNETES_CONFIG_NAME</code> and set it to the name of the ConfigMap. The same is true for the secrets, where the environment variable is <code>SPRING_CLOUD_KUBERNETES_SECRETS_NAME</code>. To use the secrets, you also need to set <code>SPRING_CLOUD_KUBERNETES_SECRETS_ENABLE_API</code> to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows a snippet from a deployment script that sets these environment variables:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">env:
- name: SPRING_CLOUD_KUBERNETES_SECRETS_ENABLE_API
  value: 'true'
- name: SPRING_CLOUD_KUBERNETES_SECRETS_NAME
  value: mysql
- name: SPRING_CLOUD_KUBERNETES_CONFIG_NAME
  value: scdf-server</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_configmap_and_secrets"><a class="anchor" href="#_using_configmap_and_secrets"></a>17.1. Using ConfigMap and Secrets</h3>
<div class="paragraph">
<p>You can pass configuration properties to the Data Flow Server by using Kubernetes <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configmap/">ConfigMap</a> and <a href="https://kubernetes.io/docs/concepts/configuration/secret/">secrets</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows one possible configuration, which enables RabbitMQ, MySQL and Redis as well as basic security settings for the server:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: scdf-server
  labels:
    app: scdf-server
data:
  application.yaml: |-
    security:
      basic:
        enabled: true
        realm: Spring Cloud Data Flow
    spring:
      cloud:
        dataflow:
          security:
            authentication:
              file:
                enabled: true
                users:
                  admin: admin, ROLE_MANAGE, ROLE_VIEW
                  user: password, ROLE_VIEW, ROLE_CREATE
        deployer:
          kubernetes:
            environmentVariables: 'SPRING_RABBITMQ_HOST=${RABBITMQ_SERVICE_HOST},SPRING_RABBITMQ_PORT=${RABBITMQ_SERVICE_PORT},SPRING_REDIS_HOST=${REDIS_SERVICE_HOST},SPRING_REDIS_PORT=${REDIS_SERVICE_PORT}'
      datasource:
        url: jdbc:mysql://${MYSQL_SERVICE_HOST}:${MYSQL_SERVICE_PORT}/mysql
        username: root
        password: ${mysql-root-password}
        driverClassName: org.mariadb.jdbc.Driver
        testOnBorrow: true
        validationQuery: "SELECT 1"
      redis:
        host: ${REDIS_SERVICE_HOST}
        port: ${REDIS_SERVICE_PORT}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example assumes that RabbitMQ is deployed with <code>rabbitmq</code> as the service name. For MySQL, it assumes that the service name is <code>mysql</code>. For Redis, it assumes that the service name is <code>redis</code>. Kubernetes publishes the host and port values of these services as environment variables that we can use when configuring the apps we deploy.</p>
</div>
<div class="paragraph">
<p>We prefer to provide the MySQL connection password in a Secrets file, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: mysql
  labels:
    app: mysql
data:
  mysql-root-password: eW91cnBhc3N3b3Jk</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The password is a base64-encoded value.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-rdbms"><a class="anchor" href="#configuration-rdbms"></a>18. Database Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow provides schemas for H2, HSQLDB, MySQL, Oracle, PostgreSQL, DB2, and SQL Server. The appropriate schema is automatically created when the server starts, provided the right database driver and appropriate credentials are in the classpath.</p>
</div>
<div class="paragraph">
<p>The JDBC drivers for MySQL (via MariaDB driver), HSQLDB, PostgreSQL, and embedded H2 are available out of the box.
If you use any other database, you need to put the corresponding JDBC driver jar on the classpath of the server.</p>
</div>
<div class="paragraph">
<p>For instance, if you use MySQL in addition to a password in the secrets file, you could provide the following properties in the ConfigMap:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">data:
  application.yaml: |-
    spring:
      datasource:
        url: jdbc:mysql://${MYSQL_SERVICE_HOST}:${MYSQL_SERVICE_PORT}/mysql
        username: root
        password: ${mysql-root-password}
        driverClassName: org.mariadb.jdbc.Driver
        url: jdbc:mysql://${MYSQL_SERVICE_HOST}:${MYSQL_SERVICE_PORT}/test
        driverClassName: org.mariadb.jdbc.Driver</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For PostgreSQL, you could use the following configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">data:
  application.yaml: |-
    spring:
      datasource:
        url: jdbc:postgresql://${PGSQL_SERVICE_HOST}:${PGSQL_SERVICE_PORT}/database
        username: root
        password: ${postgres-password}
        driverClassName: org.postgresql.Driver</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For HSQLDB, you could use the following configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">data:
  application.yaml: |-
    spring:
      datasource:
        url: jdbc:hsqldb:hsql://${HSQLDB_SERVICE_HOST}:${HSQLDB_SERVICE_PORT}/database
        username: sa
        driverClassName: org.hsqldb.jdbc.JDBCDriver</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can find migration scripts for specific database types in the <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-core/src/main/resources/org/springframework/cloud/task/migration">spring-cloud-task</a> repo.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-security"><a class="anchor" href="#configuration-security"></a>19. Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers how to secure the server application in the sample configurations file used in <a href="#kubernetes-getting-started">Getting Started</a>.</p>
</div>
<div class="paragraph">
<p>This section covers the basic configuration settings in the sample configuration. See the  <a href="http://docs.spring.io/spring-cloud-dataflow/docs//reference/htmlsingle/#configuration-security">core security documentation</a> for more detailed coverage of the security configuration options for the Spring Cloud Data Flow server and shell.</p>
</div>
<div class="paragraph">
<p>When using RabbitMQ as the transport, the security settings are located in the <code>src/kubernetes/server/server-config-rabbit.yaml</code> file. For Kafka, the settings are located in the <code>src/kubernetes/server/server-config-kafka.yaml</code> file. The following example shows a security configuration in YAML:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">security:
  basic:
    enabled: true                                         <i class="conum" data-value="1"></i><b>(1)</b>
    realm: Spring Cloud Data Flow                         <i class="conum" data-value="2"></i><b>(2)</b>
spring:
  cloud:
    dataflow:
      security:
        authentication:
          file:
            enabled: true
            users:
              admin: admin, ROLE_MANAGE, ROLE_VIEW        <i class="conum" data-value="3"></i><b>(3)</b>
              user: password, ROLE_VIEW, ROLE_CREATE      <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable security</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionally set the realm (defaults to <code>Spring</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an 'admin' user with its password set to 'admin'. It can view applications, streams, and tasks and can also view management endpoints.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create a 'user' user with its password set to 'password'. It can register applications, create streams and tasks, and view them.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Feel free to change user names and passwords to suit and move the definition of user passwords to a Kubernetes secret.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-monitoring-management"><a class="anchor" href="#configuration-monitoring-management"></a>20. Monitoring and Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend using the <code>kubectl</code> command for troubleshooting streams and tasks.</p>
</div>
<div class="paragraph">
<p>You can list all artifacts and resources used by using the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl get all,cm,secrets,pvc</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can list all resources used by a specific application or service by using a label to select resources. The following command lists all resources used by the <code>mysql</code> service:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl get all -l app=mysql</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can get the logs for a specific pod by issuing the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl logs pod &lt;pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the pod is continuously getting restarted, you can add <code>-p</code> as an option to see the previous log, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl logs -p &lt;pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also tail or follow a log by adding an <code>-f</code> option, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl logs -f &lt;pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A useful command to help in troubleshooting issues, such as a container that has a fatal error when starting up, is to use the <code>describe</code> command, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl describe pod ticktock-log-0-qnk72</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inspecting_server_logs"><a class="anchor" href="#_inspecting_server_logs"></a>20.1. Inspecting Server Logs</h3>
<div class="paragraph">
<p>You can access the server logs by using the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl get pod -l app=scdf=server
kubectl logs &lt;scdf-server-pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_streams"><a class="anchor" href="#_streams"></a>20.2. Streams</h3>
<div class="paragraph">
<p>Stream applications are deployed with the stream name followed by the name of the application. For processors and sinks, an instance index is also appended.</p>
</div>
<div class="paragraph">
<p>To see all the pods that are deployed by the Spring Cloud Data Flow server, you can specify the <code>role=spring-app</code> label, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl get pod -l role=spring-app</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To see details for a specific application deployment you can use the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl describe pod &lt;app-pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To view the application logs, you can use the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl logs &lt;app-pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you would like to tail a log you can use the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl logs -f &lt;app-pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tasks"><a class="anchor" href="#_tasks"></a>20.3. Tasks</h3>
<div class="paragraph">
<p>Tasks are launched as bare pods without a replication controller. The pods remain after the tasks complete, which gives you an opportunity to review the logs.</p>
</div>
<div class="paragraph">
<p>To see all pods for a specific task, use the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl get pod -l task-name=&lt;task-name&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To review the task logs, use the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl logs &lt;task-pod-name&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You have two options to delete completed pods. You can delete them manually once they are no longer needed or you can use the Data Flow shell <code>task execution cleanup</code> command to remove the completed pod for a task execution.</p>
</div>
<div class="paragraph">
<p>To delete the task pod manually, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl delete pod &lt;task-pod-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the <code>task execution cleanup</code> command, you must first determine the <code>ID</code> for the task execution. To do so, use the <code>task execution list</code> command, as the following example (with output) shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">dataflow:&gt;task execution list

Task NameID         Start Time                   End Time          Exit Code

task1    1 Fri May 05 18:12:05 EDT 2017Fri May 05 18:12:05 EDT 20170        
</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once you have the ID, you can issue the command to cleanup the execution artifacts (the completed pod), as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">dataflow:&gt;task execution cleanup --id 1
Request to clean up resources for task execution 1 has been submitted</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scheduling"><a class="anchor" href="#_scheduling"></a>21. Scheduling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers customization of how scheduled tasks are configured. Scheduling of tasks is enabled by default in the Spring Cloud Data Flow Kubernetes Server. Properties are used to influence settings for scheduled tasks and can be configured on a global or per-schedule basis.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unless noted, properties set on a per-schedule basis always take precedence over properties set as the server configuration. This arrangement allows for the ability to override global server level properties for a specific schedule.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/spring-cloud/spring-cloud-scheduler-kubernetes/blob/master/src/main/java/org/springframework/cloud/scheduler/spi/kubernetes/KubernetesSchedulerProperties.java"><code>KubernetesSchedulerProperties</code></a> for more on the supported options.</p>
</div>
<div class="sect2">
<h3 id="_entry_point_style_2"><a class="anchor" href="#_entry_point_style_2"></a>21.1. Entry Point Style</h3>
<div class="paragraph">
<p>An Entry Point Style affects how application properties are passed to the task container to be deployed. Currently, three styles are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>exec</code>: (default) Passes all application properties as command line arguments.</p>
</li>
<li>
<p><code>shell</code>: Passes all application properties as environment variables.</p>
</li>
<li>
<p><code>boot</code>: Creates an environment variable called <code>SPRING_APPLICATION_JSON</code> that contains a JSON representation of all application properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure the entry point style as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>scheduler.kubernetes.entryPointStyle=&lt;Entry Point Style&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;Entry Point Style&gt;</code> with your desired Entry Point Style.</p>
</div>
<div class="paragraph">
<p>You can also configure the Entry Point Style at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_SCHEDULER_KUBERNETES_ENTRY_POINT_STYLE
  value: entryPointStyle</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>entryPointStyle</code> with the desired Entry Point Style.</p>
</div>
<div class="paragraph">
<p>You should choose an Entry Point Style of either <code>exec</code> or <code>shell</code>, to correspond to how the <code>ENTRYPOINT</code> syntax is defined in the container&#8217;s <code>Dockerfile</code>. For more information and uses cases on <code>exec</code> vs <code>shell</code>, see the <a href="https://docs.docker.com/engine/reference/builder/#entrypoint">ENTRYPOINT</a> section of the Docker documentation.</p>
</div>
<div class="paragraph">
<p>Using the <code>boot</code> Entry Point Style corresponds to using the <code>exec</code> style <code>ENTRYPOINT</code>. Command line arguments from the deployment request are passed to the container, with the addition of application properties mapped into the <code>SPRING_APPLICATION_JSON</code> environment variable rather than command line arguments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables_2"><a class="anchor" href="#_environment_variables_2"></a>21.2. Environment Variables</h3>
<div class="paragraph">
<p>To influence the environment settings for a given application, you can take advantage of the <code>spring.cloud.scheduler.kubernetes.environmentVariables</code> property.
For example, a common requirement in production settings is to influence the JVM memory arguments.
You can achieve this by using the <code>JAVA_TOOL_OPTIONS</code> environment variable, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>scheduler.kubernetes.environmentVariables=JAVA_TOOL_OPTIONS=-Xmx1024m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Additionally you can configure environment variables at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When specifying environment variables in the server configuration and on a per-schedule basis, environment variables will be merged. This allows for the ability to set common environment variables in the server configuration and more specific at the specific schedule level.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_SCHEDULER_KUBERNETES_ENVIRONMENT_VARIABLES
  value: myVar=myVal</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>myVar=myVal</code> with your desired environment variables.</p>
</div>
</div>
<div class="sect2">
<h3 id="_image_pull_policy_2"><a class="anchor" href="#_image_pull_policy_2"></a>21.3. Image Pull Policy</h3>
<div class="paragraph">
<p>An image pull policy defines when a Docker image should be pulled to the local registry. Currently, three policies are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IfNotPresent</code>: (default) Do not pull an image if it already exists.</p>
</li>
<li>
<p><code>Always</code>: Always pull the image regardless of whether it already exists.</p>
</li>
<li>
<p><code>Never</code>: Never pull an image. Use only an image that already exists.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how you can individually configure containers:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>scheduler.kubernetes.imagePullPolicy=Always</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>Always</code> with your desired image pull policy.</p>
</div>
<div class="paragraph">
<p>You can configure an image pull policy at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_SCHEDULER_KUBERNETES_IMAGE_PULL_POLICY
  value: Always</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>Always</code> with your desired image pull policy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_private_docker_registry_2"><a class="anchor" href="#_private_docker_registry_2"></a>21.4. Private Docker Registry</h3>
<div class="paragraph">
<p>Docker images that are private and require authentication can be pulled by configuring a Secret. First, you must create a Secret in the cluster. Follow the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">Pull an Image from a Private Registry</a> guide to create the Secret.</p>
</div>
<div class="paragraph">
<p>Once you have created the secret, use the <code>imagePullSecret</code> property to set the secret to use, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>scheduler.kubernetes.imagePullSecret=mysecret</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>mysecret</code> with the name of the secret you created earlier.</p>
</div>
<div class="paragraph">
<p>You can also configure the image pull secret at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_SCHEDULER_KUBERNETES_IMAGE_PULL_SECRET
  value: mysecret</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>mysecret</code> with the name of the secret you created earlier.</p>
</div>
</div>
<div class="sect2">
<h3 id="_namespace"><a class="anchor" href="#_namespace"></a>21.5. Namespace</h3>
<div class="paragraph">
<p>By default the namespace used for scheduled tasks is <code>default</code>. This value can be set at the server level configuration in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_SCHEDULER_KUBERNETES_NAMESPACE
  value: mynamespace</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_account"><a class="anchor" href="#_service_account"></a>21.6. Service Account</h3>
<div class="paragraph">
<p>You can configure a custom service account for scheduled tasks through properties. An existing service account can be used or a new one created. One way to create a service account is by using <code>kubectl</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl create serviceaccount myserviceaccountname
serviceaccount "myserviceaccountname" created</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can configure the service account to use on a per-schedule basis as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>scheduler.kubernetes.taskServiceAccountName=myserviceaccountname</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>myserviceaccountname</code> with your service account name.</p>
</div>
<div class="paragraph">
<p>You can also configure the service account name at the server level in the container <code>env</code> section of a deployment YAML, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>env:
- name: SPRING_CLOUD_SCHEDULER_KUBERNETES_TASK_SERVICE_ACCOUNT_NAME
  value: myserviceaccountname</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace <code>myserviceaccountname</code> with the service account name to be applied to all deployments.</p>
</div>
<div class="paragraph">
<p>For more information on scheduling tasks see <a href="#spring-cloud-dataflow-schedule-launch-tasks">Scheduling Tasks</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debug_support"><a class="anchor" href="#_debug_support"></a>22. Debug Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Debugging the Spring Cloud Data Flow Kubernetes Server and included components (such as the <a href="https://github.com/spring-cloud/spring-cloud-deployer-kubernetes">Spring Cloud Kubernetes Deployer</a>) is supported through the <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jpda/jdwp-spec.html">Java Debug Wire Protocol (JDWP)</a>. This section outlines an approach to manually enable debugging and another approach that uses configuration files provided with Spring Cloud Data Flow Server Kubernetes to &#8220;patch&#8221; a running deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
JDWP itself does not use any authentication. This section assumes debugging is being done on a local development environment (such as Minikube), so guidance on securing the debug port is not provided.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_enabling_debugging_manually"><a class="anchor" href="#_enabling_debugging_manually"></a>22.1. Enabling Debugging Manually</h3>
<div class="paragraph">
<p>To manually enable JDWP, first edit <code>src/kubernetes/server/server-deployment.yaml</code> and add an additional <code>containerPort</code> entry under <code>spec.template.spec.containers.ports</code> with a value of <code>5005</code>. Additionally, add the <a href="https://docs.oracle.com/javase/8/docs/platform/jvmti/jvmti.html#tooloptions"><code>JAVA_TOOL_OPTIONS</code></a> environment variable under <code>spec.template.spec.containers.env</code> as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spec:
  ...
  template:
    ...
    spec:
      containers:
      - name: scdf-server
        ...
        ports:
        ...
		- containerPort: 5005
        env:
        - name: JAVA_TOOL_OPTIONS
          value: '-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005'</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The preceding example uses port 5005, but it can be any number that does not conflict with another port. The chosen port number must also be the same for the added <code>containerPort</code> value and the <code>address</code> parameter of the <code>JAVA_TOOL_OPTIONS</code> <code>-agentlib</code> flag, as shown in the preceding example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now start the Spring Cloud Data Flow Kubernetes Server. Once the server is up, you can verify the configuration changes on the <code>scdf-server</code> deployment, as the following example (with output) shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl describe deployment/scdf-server
...
...
Pod Template:
  ...
  Containers:
   scdf-server:
    ...
    Ports:       80/TCP, 5005/TCP
    ...
    Environment:
      JAVA_TOOL_OPTIONS:  -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005
	  ...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the server started and JDWP enabled, you need to configure access to the port. In this example, we use the <a href="https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"><code>port-forward</code></a> subcommand of <code>kubectl</code>. The following example (with output) shows how to expose a local port to your debug target by using <code>port-forward</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl get pod -l app=scdf-server
NAME                           READY     STATUS    RESTARTS   AGE
scdf-server-5b7cfd86f7-d8mj4   1/1       Running   0          10m
$ kubectl port-forward scdf-server-5b7cfd86f7-d8mj4 5005:5005
Forwarding from 127.0.0.1:5005 -&gt; 5005
Forwarding from [::1]:5005 -&gt; 5005</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can now attach a debugger by pointing it to <code>127.0.0.1</code> as the host and <code>5005</code> as the port. The <code>port-forward</code> subcommand runs until stopped (by pressing <code>CTRL+c</code>, for example).</p>
</div>
<div class="paragraph">
<p>You can remove debugging support by reverting the changes to <code>src/kubernetes/server/server-deployment.yaml</code>. The reverted changes are picked up on the next deployment of the Spring Cloud Data Flow Kubernetes Server. Manually adding debug support to the configuration is useful when debugging should be enabled by default each time the server is deployed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_debugging_with_patching"><a class="anchor" href="#_enabling_debugging_with_patching"></a>22.2. Enabling Debugging with Patching</h3>
<div class="paragraph">
<p>Rather than manually changing the <code>server-deployment.yaml</code>, Kubernetes objects can be &#8220;patched&#8221; in place. For convenience, patch files that provide the same configuration as the manual approach are included. To enable debugging by patching, use the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl patch deployment scdf-server -p "$(cat src/kubernetes/server/server-deployment-debug.yaml)"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Running the preceding command automatically adds the <code>containerPort</code> attribute and the <code>JAVA_TOOL_OPTIONS</code> environment variable. The following example (with output) shows how toverify changes to the <code>scdf-server</code> deployment:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl describe deployment/scdf-server
...
...
Pod Template:
  ...
  Containers:
   scdf-server:
    ...
    Ports:       5005/TCP, 80/TCP
    ...
    Environment:
      JAVA_TOOL_OPTIONS:  -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005
	  ...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable access to the debug port, rather than using the <code>port-forward</code> subcommand of <code>kubectl</code>, you can patch the <code>scdf-server</code> Kubernetes service object. You must first ensure that the <code>scdf-server</code> Kubernetes service object has the proper configuration. The following example (with output) shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl describe service/scdf-server
Port:                     &lt;unset&gt;  80/TCP
TargetPort:               80/TCP
NodePort:                 &lt;unset&gt;  30784/TCP</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the output contains <code>&lt;unset&gt;</code>, you must patch the service to add a name for this port. The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl patch service scdf-server -p "$(cat src/kubernetes/server/server-svc.yaml)"</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A port name should only be missing if the target cluster had been created prior to debug functionality being added. Since multiple ports are being added to the <code>scdf-server</code> Kubernetes Service Object, each needs to have its own name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can add the debug port, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">kubectl patch service scdf-server -p "$(cat src/kubernetes/server/server-svc-debug.yaml)"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example (with output) shows how to verify the mapping:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl describe service scdf-server
Name:                     scdf-server
...
...
Port:                     scdf-server-jdwp  5005/TCP
TargetPort:               5005/TCP
NodePort:                 scdf-server-jdwp  31339/TCP
...
...
Port:                     scdf-server  80/TCP
TargetPort:               80/TCP
NodePort:                 scdf-server  30883/TCP
...
...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The output shows that container port 5005 has been mapped to the NodePort of 31339. The following example (with output) shows how to get the IP address of the Minikube node:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ minikube ip
192.168.99.100</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With this information, you can create a debug connection by using a host of 192.168.99.100 and a port of 31339.</p>
</div>
<div class="paragraph">
<p>The following example shows how to disable JDWP:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ kubectl rollout undo deployment/scdf-server
$ kubectl patch service scdf-server --type json -p='[{"op": "remove", "path": "/spec/ports/0"}]'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Kubernetes deployment object is rolled back to its state before being patched. The Kubernetes service object is then patched with a <code>remove</code> operation to remove port 5005 from the <code>containerPorts</code> list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>kubectl rollout undo</code> forces the pod to restart. Patching the Kubernetes Service Object does not re-create the service, and the port mapping to the <code>scdf-server</code> deployment remains the same.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment">Rolling Back a Deployment</a> for more information on deployment rollbacks, including managing history and <a href="https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/">Updating API Objects in Place Using kubectl Patch</a>.</p>
</div>
</div>
</div>
</div>
<h1 id="shell" class="sect0"><a class="anchor" href="#shell"></a>Shell</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section covers the options for starting the shell and more advanced functionality relating to how the shell handles white spaces, quotes, and interpretation of SpEL expressions.
The introductory chapters to the
<a href="#spring-cloud-dataflow-stream-intro">Stream DSL</a> and <a href="#spring-cloud-dataflow-composed-tasks">Composed Task DSL</a> are good places to start for the most common usage of shell commands.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shell-options"><a class="anchor" href="#shell-options"></a>23. Shell Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The shell is built upon the <a href="https://projects.spring.io/spring-shell/">Spring Shell</a> project.
There are command line options generic to Spring Shell and some specific to Data Flow.
The shell takes the following command line options</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">unix:>java -jar spring-cloud-dataflow-shell-1.7.3.RELEASE.jar --help
Data Flow Options:
  --dataflow.uri=<uri>                              Address of the Data Flow Server [default: http://localhost:9393].
  --dataflow.username=<USER>                        Username of the Data Flow Server [no default].
  --dataflow.password=<PASSWORD>                    Password of the Data Flow Server [no default].
  --dataflow.credentials-provider-command=<COMMAND> Executes an external command which must return an
                                                    OAuth Bearer Token (Access Token prefixed with 'Bearer '),
                                                    e.g. 'Bearer 12345'), [no default].
  --dataflow.skip-ssl-validation=<true|false>       Accept any SSL certificate (even self-signed) [default: no].
  --dataflow.proxy.uri=<PROXY-URI>                  Address of an optional proxy server to use [no default].
  --dataflow.proxy.username=<PROXY-USERNAME>        Username of the proxy server (if required by proxy server) [no default].
  --dataflow.proxy.password=<PROXY-PASSWORD>        Password of the proxy server (if required by proxy server) [no default].
  --spring.shell.historySize=<SIZE>                 Default size of the shell log file [default: 3000].
  --spring.shell.commandFile=<FILE>                 Data Flow Shell executes commands read from the file(s) and then exits.
  --help                                            This message.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>spring.shell.commandFile</code> option can be used to point to an existing file that contains
all the shell commands to deploy one or many related streams and tasks.<br>
Multiple files execution is also supported, they should be passed as comma delimited string :<br></p>
</div>
<div class="paragraph">
<p><code>--spring.shell.commandFile=file1.txt,file2.txt</code></p>
</div>
<div class="paragraph">
<p>This is useful when creating some scripts to help automate deployment.</p>
</div>
<div class="paragraph">
<p>Also, the following shell command helps to modularize a complex script into multiple independent files:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt;script --file &lt;YOUR_AWESOME_SCRIPT&gt;</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shell-commands"><a class="anchor" href="#shell-commands"></a>24. Listing Available Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Typing <code>help</code> at the command prompt gives a listing of all available commands.
Most of the commands are for Data Flow functionality, but a few are general purpose.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">! - Allows execution of operating system (OS) commands
clear - Clears the console
cls - Clears the console
date - Displays the local date and time
exit - Exits the shell
http get - Make GET request to http endpoint
http post - POST data to http endpoint
quit - Exits the shell
system properties - Shows the shell's properties
version - Displays shell version</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding the name of the command to <code>help</code> shows additional information on how to invoke the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;help stream create
Keyword:                   stream create
Description:               Create a new stream definition
 Keyword:                  ** default **
 Keyword:                  name
   Help:                   the name to give to the stream
   Mandatory:              true
   Default if specified:   '__NULL__'
   Default if unspecified: '__NULL__'

 Keyword:                  definition
   Help:                   a stream definition, using the DSL (e.g. "http --port=9000 | hdfs")
   Mandatory:              true
   Default if specified:   '__NULL__'
   Default if unspecified: '__NULL__'

 Keyword:                  deploy
   Help:                   whether to deploy the stream immediately
   Mandatory:              false
   Default if specified:   'true'
   Default if unspecified: 'false'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shell-tab-completion"><a class="anchor" href="#shell-tab-completion"></a>25. Tab Completion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The shell command options can be completed in the shell by pressing the <code>TAB</code> key after the leading <code>--</code>. For example, pressing <code>TAB</code> after <code>stream create --</code> results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;stream create --
stream create --definition    stream create --name</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you type <code>--de</code> and then hit tab, <code>--definition</code> will be expanded.</p>
</div>
<div class="paragraph">
<p>Tab completion is also available inside the stream or composed task DSL expression for application or task properties.  You can also use <code>TAB</code> to get hints in a stream DSL expression for what available sources, processors, or sinks can be used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shell-white-space"><a class="anchor" href="#shell-white-space"></a>26. White Space and Quoting Rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is only necessary to quote parameter values if they contain spaces or the <code>|</code> character. The following example passes a SpEL expression (which is applied to any data it encounters) to a transform processor:</p>
</div>
<div class="paragraph">
<p><code>transform --expression='new StringBuilder(payload).reverse()'</code></p>
</div>
<div class="paragraph">
<p>If the parameter value needs to embed a single quote, use two single quotes, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>scan --query='Select * from /Customers where name=''Smith'''</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="dsl-quotes-escaping"><a class="anchor" href="#dsl-quotes-escaping"></a>26.1. Quotes and Escaping</h3>
<div class="paragraph">
<p>There is a Spring Shell-based client that talks to the Data Flow Server and is responsible for <strong>parsing</strong> the DSL.
In turn, applications may have applications properties that rely on embedded languages, such as the <strong>Spring Expression Language</strong>.</p>
</div>
<div class="paragraph">
<p>The shell, Data Flow DSL parser, and SpEL have rules about how they handle quotes and how syntax escaping works.
When combined together, confusion may arise.
This section explains the rules that apply and provides examples of the most complicated situations you may encounter when all three components are involved.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">It&#8217;s not always that complicated</div>
<div class="paragraph">
<p>If you do not use the Data Flow shell (for example, you use the REST API directly) or if application properties are not SpEL expressions, then the escaping rules are simpler.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_shell_rules"><a class="anchor" href="#_shell_rules"></a>26.1.1. Shell rules</h4>
<div class="paragraph">
<p>Arguably, the most complex component when it comes to quotes is the shell. The rules can be laid out quite simply, though:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A shell command is made of keys (<code>--something</code>) and corresponding values. There is a special, keyless mapping, though, which is described later.</p>
</li>
<li>
<p>A value cannot normally contain spaces, as space is the default delimiter for commands.</p>
</li>
<li>
<p>Spaces can be added though, by surrounding the value with quotes (either single (<code>'</code>) or double (<code>"</code>) quotes).</p>
</li>
<li>
<p>Values passed inside deployment properties (e.g. <code>deployment &lt;stream-name&gt; --properties " &#8230;&#8203;"</code>) should not be quoted again.</p>
</li>
<li>
<p>If surrounded with quotes, a value can embed a literal quote of the same kind by prefixing it with a backslash (<code>\</code>).</p>
</li>
<li>
<p>Other escapes are available, such as <code>\t</code>, <code>\n</code>, <code>\r</code>, <code>\f</code> and unicode escapes of the form <code>\uxxxx</code>.</p>
</li>
<li>
<p>The keyless mapping is handled in a special way such that it does not need quoting to contain spaces.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the shell supports the <code>!</code> command to execute native shell commands. The <code>!</code> accepts a single keyless argument. This is why the following works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataflow:&gt;! rm something</pre>
</div>
</div>
<div class="paragraph">
<p>The argument here is the whole <code>rm something</code> string, which is passed as is to the underlying shell.</p>
</div>
<div class="paragraph">
<p>As another example, the following commands are strictly equivalent, and the argument value is <code>something</code> (without the quotes):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataflow:&gt;stream destroy something
dataflow:&gt;stream destroy --name something
dataflow:&gt;stream destroy "something"
dataflow:&gt;stream destroy --name "something"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_property_files_rules"><a class="anchor" href="#_property_files_rules"></a>26.1.2. Property files rules</h4>
<div class="paragraph">
<p>Rules are relaxed when loading the properties from files.
* The special characters used in property files (both Java and YAML) needs to be escaped. For example <code>\</code> should be replaced  by <code>\\</code>, '\t` by <code>\\t</code> and so forth.
* For Java property files (<code>--propertiesFile</code> &lt;FILE_PATH&gt;.properties) the property values should not be surrounded by quotes! It is not needed even if they contain spaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter.expression=payload &gt; 5</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>For YAML property files (<code>--propertiesFile</code> &lt;FILE_PATH&gt;.yaml), though, the values need to be surrounded by double quotes.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>app:
    filter:
        filter:
            expression: "payload &gt; 5"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dsl_parsing_rules"><a class="anchor" href="#_dsl_parsing_rules"></a>26.1.3. DSL Parsing Rules</h4>
<div class="paragraph">
<p>At the parser level (that is, inside the body of a stream or task definition) the rules are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Option values are normally parsed until the first space character.</p>
</li>
<li>
<p>They can be made of literal strings, though, surrounded by single or double quotes.</p>
</li>
<li>
<p>To embed such a quote, use two consecutive quotes of the desired kind.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As such, the values of the <code>--expression</code> option to the filter application are semantically equivalent in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter --expression=payload&gt;5
filter --expression="payload&gt;5"
filter --expression='payload&gt;5'
filter --expression='payload &gt; 5'</pre>
</div>
</div>
<div class="paragraph">
<p>Arguably, the last one is more readable. It is made possible thanks to the surrounding quotes. The actual expression is <code>payload &gt; 5</code> (without quotes).</p>
</div>
<div class="paragraph">
<p>Now, imagine that we want to test against string messages. If we want to compare the payload to the SpEL literal string, <code>"something"</code>, we could use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter --expression=payload=='something'           <i class="conum" data-value="1"></i><b>(1)</b>
filter --expression='payload == ''something'''     <i class="conum" data-value="2"></i><b>(2)</b>
filter --expression='payload == "something"'       <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This works because there are no spaces. It is not very legible, though.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This uses single quotes to protect the whole argument. Hence, the actual single quotes need to be doubled.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>SpEL recognizes String literals with either single or double quotes, so this last method is arguably the most readable.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please note that the preceding examples are to be considered outside of the shell (for example, when calling the REST API directly).
When entered inside the shell, chances are that the whole stream definition is itself inside double quotes, which would need to be escaped. The whole example then becomes the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataflow:&gt;stream create something --definition "http | filter --expression=payload='something' | log"

dataflow:&gt;stream create something --definition "http | filter --expression='payload == ''something''' | log"

dataflow:&gt;stream create something --definition "http | filter --expression='payload == \"something\"' | log"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spel_syntax_and_spel_literals"><a class="anchor" href="#_spel_syntax_and_spel_literals"></a>26.1.4. SpEL Syntax and SpEL Literals</h4>
<div class="paragraph">
<p>The last piece of the puzzle is about SpEL expressions.
Many applications accept options that are to be interpreted as SpEL expressions, and, as seen above, String literals are handled in a special way there, too. The rules are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Literals can be enclosed in either single or double quotes.</p>
</li>
<li>
<p>Quotes need to be doubled to embed a literal quote. Single quotes inside double quotes need no special treatment, and the reverse is also true.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a last example, assume you want to use the <a href="${scs-app-starters-docs}/spring-cloud-stream-modules-processors.html#spring-clound-stream-modules-transform-processor">transform processor</a>.
This processor accepts an <code>expression</code> option which is a SpEL expression. It is to be evaluated against the incoming message, with a default of <code>payload</code> (which forwards the message payload untouched).</p>
</div>
<div class="paragraph">
<p>It is important to understand that the following statements are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>transform --expression=payload
transform --expression='payload'</pre>
</div>
</div>
<div class="paragraph">
<p>However, they are different from the following (and variations upon them):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>transform --expression="'payload'"
transform --expression='''payload'''</pre>
</div>
</div>
<div class="paragraph">
<p>The first series evaluates to the message payload, while the latter examples evaluate to the literal string, <code>payload</code>, (again, without quotes).</p>
</div>
</div>
<div class="sect3">
<h4 id="_putting_it_all_together"><a class="anchor" href="#_putting_it_all_together"></a>26.1.5. Putting It All Together</h4>
<div class="paragraph">
<p>As a last, complete example, consider how one could force the transformation of all messages to the string literal, <code>hello world</code>, by creating a stream in the context of the Data Flow shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataflow:&gt;stream create something --definition "http | transform --expression='''hello world''' | log" <i class="conum" data-value="1"></i><b>(1)</b>

dataflow:&gt;stream create something --definition "http | transform --expression='\"hello world\"' | log" <i class="conum" data-value="2"></i><b>(2)</b>

dataflow:&gt;stream create something --definition "http | transform --expression=\"'hello world'\" | log" <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In the first line, there are single quotes around the string (at the Data Flow parser level), but they need to be doubled because they are inside a string literal (started by the first single quote after the equals sign).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The second and third lines, use single and double quotes respectively to encompass the whole string at the Data Flow parser level. Consequently, the other kind of quote can be used inside the string. The whole thing is inside the <code>--definition</code> argument to the shell, though, which uses double quotes. Consequently, double quotes are escaped (at the shell level)</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<h1 id="spring-cloud-dataflow-streams" class="sect0"><a class="anchor" href="#spring-cloud-dataflow-streams"></a>Streams</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section goes into more detail about how you can create Streams, which are collections of
<a href="http://cloud.spring.io/spring-cloud-stream/">Spring Cloud Stream</a> applications. It covers topics such as
creating and deploying Streams.</p>
</div>
<div class="paragraph">
<p>If you are just starting out with Spring Cloud Data Flow, you should probably read the
<a href="#getting-started">Getting Started</a> guide before diving into
this section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-stream-intro"><a class="anchor" href="#spring-cloud-dataflow-stream-intro"></a>27. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Stream is are a collection of long-lived <a href="http://cloud.spring.io/spring-cloud-stream/">Spring Cloud Stream</a> applications that communicate with each other over messaging middleware.
A text-based DSL defines the configuration and data flow between the applications.  While many applications are provided for you to implement common use-cases, you typically create a custom Spring Cloud Stream application to implement custom business logic.</p>
</div>
<div class="paragraph">
<p>The general lifecycle of a Stream is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register applications.</p>
</li>
<li>
<p>Create a Stream Definition.</p>
</li>
<li>
<p>Deploy the Stream.</p>
</li>
<li>
<p>Undeploy or Destroy the Stream.</p>
</li>
<li>
<p>Upgrade or Rollack applications in the Stream.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you use Skipper, you can upgrade or rollback applications in the Stream.</p>
</div>
<div class="paragraph">
<p>There are two options for deploying streams:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a Data Flow Server implementation that deploys to a single platform.</p>
</li>
<li>
<p>Configure the Data Flow Server to delegate the deployment to a new server in the Spring Cloud ecosystem named <a href="http://cloud.spring.io/spring-cloud-skipper/">Skipper</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using the first option, you can use the Local Data Flow Server to deploy streams to your local machine, the Data Flow Server for Cloud Foundry to deploy streams to a single org and space on Cloud Foundry.
Similarly, you can use Data Flow Server for Kuberenetes to deploy a stream to a single namespace on a Kubernetes cluster.
See <a href="http://cloud.spring.io/spring-cloud-dataflow/#platform-implementations">the Spring Cloud Data Flow project page</a> for a list of Data Flow server implementations.</p>
</div>
<div class="paragraph">
<p>When using the second option, you can configure Skipper to deploy applications to one or more Cloud Foundry orgs and spaces, one or more namespaces on a Kubernetes cluster, or to the local machine.
When deploying a stream in Data Flow using Skipper, you can specify which platform to use at deployment time.
Skipper also provides Data Flow with the ability to perform updates to deployed streams.
There are many ways the applications in a stream can be updated, but one of the most common examples is to upgrade a processor application with new custom business logic while leaving the existing source and sink applications alone.</p>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-intro-dsl"><a class="anchor" href="#spring-cloud-dataflow-stream-intro-dsl"></a>27.1. Stream Pipeline DSL</h3>
<div class="paragraph">
<p>A stream is defined by using a unix-inspired <a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)">Pipeline syntax</a>.
The syntax uses vertical bars, also known as &#8220;pipes&#8221; to connect multiple commands.
The command <code>ls -l | grep key | less</code> in Unix takes the output of the <code>ls -l</code> process and pipes it to the input of the <code>grep key</code> process.
The output of <code>grep</code> in turn is sent to the input of the <code>less</code> process.
Each <code>|</code> symbol connects the standard output of the command on the left to the standard input of the command on the right.
Data flows through the pipeline from left to right.</p>
</div>
<div class="paragraph">
<p>In Data Flow, the Unix command is replaced by a <a href="http://cloud.spring.io/spring-cloud-stream/">Spring Cloud Stream</a> application and each pipe symbol represents connecting the input and output of applications over messaging middleware, such as RabbitMQ or Apache Kafka.</p>
</div>
<div class="paragraph">
<p>Each Spring Cloud Stream application is registered under a simple name.
The registration process specifies where the application can be obtained (for example, in a Maven Repository or a Docker registry).  You can find out more information on how to register Spring Cloud Stream applications in this <a href="#spring-cloud-dataflow-register-stream-apps">section</a>.
In Data Flow, we classify the Spring Cloud Stream applications as Sources, Processors, or Sinks.</p>
</div>
<div class="paragraph">
<p>As a simple example, consider the collection of data from an HTTP Source writing to a File Sink.
Using the DSL, the stream description is:</p>
</div>
<div class="paragraph">
<p><code>http | file</code></p>
</div>
<div class="paragraph">
<p>A stream that involves some processing would be expressed as:</p>
</div>
<div class="paragraph">
<p><code>http | filter | transform | file</code></p>
</div>
<div class="paragraph">
<p>Stream definitions can be created by using the shell&#8217;s <code>stream create</code> command, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream create --name httpIngest --definition "http | file"</code></p>
</div>
<div class="paragraph">
<p>The Stream DSL is passed in to the <code>--definition</code> command option.</p>
</div>
<div class="paragraph">
<p>The deployment of stream definitions is done through the shell&#8217;s <code>stream deploy</code> command.</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream deploy --name ticktock</code></p>
</div>
<div class="paragraph">
<p>The <a href="#getting-started">Getting Started</a> section shows you how to start the server and how to start and use the Spring Cloud Data Flow shell.</p>
</div>
<div class="paragraph">
<p>Note that the shell calls the Data Flow Servers' REST API. For more information on making HTTP requests directly to the server, consult the <a href="#api-guide">REST API Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-app-dsl"><a class="anchor" href="#spring-cloud-dataflow-stream-app-dsl"></a>27.2. Stream Application DSL</h3>
<div class="paragraph">
<p>The Stream Pipeline DSL described in the previous section automatically sets the input and output binding properties of each Spring Cloud Stream application.
This can be done because there is only one input and/or output destination in a Spring Cloud Stream application that uses the provided binding interface of a <code>Source</code>, <code>Processor</code>, or <code>Sink</code>.
However, a Spring Cloud Stream application can define a custom binding interface such as the one shown below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Barista {

    @Input
    SubscribableChannel orders();

    @Output
    MessageChannel hotDrinks();

    @Output
    MessageChannel coldDrinks();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or as is common when creating a Kafka Streams application,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">interface KStreamKTableBinding {

    @Input
    KStream&lt;?, ?&gt; inputStream();

    @Input
    KTable&lt;?, ?&gt; inputTable();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In these cases with multiple input and output bindings, Data Flow cannot make any assumptions about the flow of data from one application to another.
Therefore the developer needs to set the binding properties to 'wire up' the application.
The <strong>Stream Application DSL</strong> uses a <code>double pipe</code>, instead of the <code>pipe symbol</code>, to indicate that Data Flow should not configure the binding properties of the application.  Think of <code>||</code> as meaning 'in parallel'.
For example:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream create --definition "orderGeneratorApp || baristaApp || hotDrinkDeliveryApp || coldDrinkDeliveryApp" --name myCafeStream</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Breaking Change!  Versions of SCDF Local, Cloud Foundry 1.7.0 to 1.7.2 and SCDF Kubernetes 1.7.0 to 1.7.1 used the <code>comma</code> character as the separator between applications.  This caused breaking changes in the traditional Stream DSL.  While not ideal, changing the separator character was felt to be the best solution with the least impact on existing users.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are four applications in this stream.
 The baristaApp has two output destinations, <code>hotDrinks</code> and <code>coldDrinks</code> intended to be consumed by the <code>hotDrinkDeliveryApp</code> and <code>coldDrinkDeliveryApp</code> respectively.
When deploying this stream, you need to set the binding properties so that the <code>baristaApp</code> sends hot drink messages to the <code>hotDrinkDeliveryApp</code> destination and cold drink messages to the <code>coldDrinkDeliveryApp</code> destination.
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">app.baristaApp.spring.cloud.stream.bindings.hotDrinks.destination=hotDrinksDest
app.baristaApp.spring.cloud.stream.bindings.coldDrinks.destination=coldDrinksDest
app.hotDrinkDeliveryApp.spring.cloud.stream.bindings.input.destination=hotDrinksDest
app.coldDrinkDeliveryApp.spring.cloud.stream.bindings.input.destination=coldDrinksDest</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use consumer groups, you will need to set the Spring Cloud Stream application property <code>spring.cloud.stream.bindings.&lt;channelName&gt;.producer.requiredGroups</code> and <code>spring.cloud.stream.bindings.&lt;channelName&gt;.group</code> on the producer and consumer applications respectively.</p>
</div>
<div class="paragraph">
<p>Another common use case for the Stream Application DSL is to deploy a http gateway application that sends a synchronous request/reply message to a Kafka or RabbitMQ application.
In this case both the http gateway application and the Kafka or RabbitMQ application can be a Spring Integration application that does not make use of the Spring Cloud Stream library.</p>
</div>
<div class="paragraph">
<p>It is also possible to deploy just a single application using the Stream application DSL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_application_properties"><a class="anchor" href="#_application_properties"></a>27.3. Application properties</h3>
<div class="paragraph">
<p>Each application takes properties to customize its behavior.  As an example, the <code>http</code> source module exposes a <code>port</code> setting that allows the data ingestion port to be changed from the default value.</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream create --definition "http --port=8090 | log" --name myhttpstream</code></p>
</div>
<div class="paragraph">
<p>This <code>port</code> property is actually the same as the standard Spring Boot <code>server.port</code> property.
Data Flow adds the ability to use the shorthand form <code>port</code> instead of <code>server.port</code>.
One may also specify the longhand version as well, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream create --definition "http --server.port=8000 | log" --name myhttpstream</code></p>
</div>
<div class="paragraph">
<p>This shorthand behavior is discussed more in the section on <a href="#spring-cloud-dataflow-stream-app-whitelisting">Whitelisting application properties</a>.
If you have <a href="#spring-cloud-dataflow-stream-app-metadata-artifact">registered application property metadata</a> you can use tab completion in the shell after typing <code>--</code> to get a list of candidate property names.</p>
</div>
<div class="paragraph">
<p>The shell provides tab completion for application properties. The shell command <code>app info --name &lt;appName&gt; --type &lt;appType&gt;</code> provides additional documentation for all the supported properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Supported Stream <code>&lt;appType&gt;</code> possibilities are: source, processor, and sink.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-stream-lifecycle"><a class="anchor" href="#spring-cloud-dataflow-stream-lifecycle"></a>28. Stream Lifecycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The lifecycle of a stream, in "classic" mode, goes through the following stages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#spring-cloud-dataflow-register-stream-apps">Register a Stream App</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-create-stream">Creating a Stream</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-deploy-stream">Deploying a Stream</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-destroy-stream">Destroying a Stream</a> or <a href="#spring-cloud-dataflow-undeploy-stream">Undeploying a Stream</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-register-stream-apps"><a class="anchor" href="#spring-cloud-dataflow-register-stream-apps"></a>28.1. Register a Stream App</h3>
<div class="paragraph">
<p>You can register a Stream App with the App Registry by using the Spring Cloud Data Flow Shell
<code>app register</code> command. You must provide a unique name, an application type, and a URI that can be
resolved to the app artifact. For the type, specify <code>source</code>, <code>processor</code>, <code>sink</code>, or <code>app</code>.
Here are a few examples for <code>source</code>, <code>processor</code> and <code>sink</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;app register --name mysource --type source --uri maven://com.example:mysource:0.0.1-SNAPSHOT

dataflow:&gt;app register --name myprocessor --type processor --uri file:///Users/example/myprocessor-1.2.3.jar

dataflow:&gt;app register --name mysink --type sink --uri http://example.com/mysink-2.0.1.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>When providing a URI with the <code>maven</code> scheme, the format should conform to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>maven://&lt;groupId&gt;:&lt;artifactId&gt;[:&lt;extension&gt;[:&lt;classifier&gt;]]:&lt;version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, if you would like to register the snapshot versions of the <code>http</code> and <code>log</code>
applications built with the RabbitMQ binder, you could do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;app register --name http --type source --uri maven://org.springframework.cloud.stream.app:http-source-rabbit:1.2.1.BUILD-SNAPSHOT
dataflow:&gt;app register --name log --type sink --uri maven://org.springframework.cloud.stream.app:log-sink-rabbit:1.2.1.BUILD-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you would like to register multiple apps at one time, you can store them in a properties file
where the keys are formatted as <code>&lt;type&gt;.&lt;name&gt;</code> and the values are the URIs.</p>
</div>
<div class="paragraph">
<p>For example, if you would like to register the snapshot versions of the <code>http</code> and <code>log</code>
applications built with the RabbitMQ binder, you could have the following in a properties file (for example, <code>stream-apps.properties</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>source.http=maven://org.springframework.cloud.stream.app:http-source-rabbit:1.2.1.BUILD-SNAPSHOT
sink.log=maven://org.springframework.cloud.stream.app:log-sink-rabbit:1.2.1.BUILD-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then to import the apps in bulk, use the <code>app import</code> command and provide the location of the properties file with the <code>--uri</code> switch, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;app import --uri file:///&lt;YOUR_FILE_LOCATION&gt;/stream-apps.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Registering an application using <code>--type app</code> is the same as registering a <code>source</code>, <code>processor</code> or <code>sink</code>.
Applications of the type <code>app</code> are only allowed to be used in the Stream Application DSL, which uses a comma instead of the pipe symbol in the DSL, and instructs Data Flow not to configure the Spring Cloud Stream binding properties of the application.
The application that is registered using <code>--type app</code> does not have to be a Spring Cloud Stream app, it can be any Spring Boot application.
See the <a href="#spring-cloud-dataflow-stream-app-dsl">Stream Application DSL introduction</a> for more information on using this application type.</p>
</div>
<div class="sect3">
<h4 id="supported-apps-and-tasks"><a class="anchor" href="#supported-apps-and-tasks"></a>28.1.1. Register Supported Applications and Tasks</h4>
<div class="paragraph">
<p>For convenience, we have the static files with application-URIs (for both maven and docker) available
for all the out-of-the-box stream and task/batch app-starters. You can point to this file and import
all the application-URIs in bulk. Otherwise, as explained previously, you can register them individually or have your own custom property file with only the required application-URIs in it. It is recommended, however, to have a &#8220;focused&#8221; list of desired application-URIs in a custom property file.</p>
</div>
<div class="paragraph">
<p>The following table lists the bit.ly links to the available Stream Application Starters based on Spring Boot 1.5.x:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Artifact Type</th>
<th class="tableblock halign-left valign-top">Stable Release</th>
<th class="tableblock halign-left valign-top">SNAPSHOT Release</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ + Maven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-SR3-stream-applications-rabbit-maven" class="bare">bit.ly/Celsius-SR3-stream-applications-rabbit-maven</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-rabbit-maven" class="bare">bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-rabbit-maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ + Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-SR3-stream-applications-rabbit-docker" class="bare">bit.ly/Celsius-SR3-stream-applications-rabbit-docker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-rabbit-docker" class="bare">bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-rabbit-docker</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka 0.10 + Maven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-SR3-stream-applications-kafka-10-maven" class="bare">bit.ly/Celsius-SR3-stream-applications-kafka-10-maven</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-kafka-10-maven" class="bare">bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-kafka-10-maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka 0.10 + Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-SR3-stream-applications-kafka-10-docker" class="bare">bit.ly/Celsius-SR3-stream-applications-kafka-10-docker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-kafka-10-docker" class="bare">bit.ly/Celsius-BUILD-SNAPSHOT-stream-applications-kafka-10-docker</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table lists the bit.ly links to the available Stream Application Starters based on Spring Boot 2.0.x:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
App Starter actuator endpoints are secured by default.  You can disable security by deploying streams with the property <code>app.*.spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration</code>.  On Kubernetes refer to the section <a href="https://docs.spring.io/spring-cloud-dataflow-server-kubernetes/docs/current/reference/htmlsingle/#_liveness_and_readiness_probes">Liveness and readiness probes</a> to configure security for actuator endpoints.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Artifact Type</th>
<th class="tableblock halign-left valign-top">Stable Release</th>
<th class="tableblock halign-left valign-top">SNAPSHOT Release</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ + Maven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-SR3-stream-applications-rabbit-maven" class="bare">bit.ly/Darwin-SR3-stream-applications-rabbit-maven</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-rabbit-maven" class="bare">bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-rabbit-maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ + Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-SR3-stream-applications-rabbit-docker" class="bare">bit.ly/Darwin-SR3-stream-applications-rabbit-docker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-rabbit-docker" class="bare">bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-rabbit-docker</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka 0.11 and above + Maven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-SR3-stream-applications-kafka-maven" class="bare">bit.ly/Darwin-SR3-stream-applications-kafka-maven</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-kafka-maven" class="bare">bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-kafka-maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka 0.11 and above + Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-SR3-stream-applications-kafka-docker" class="bare">bit.ly/Darwin-SR3-stream-applications-kafka-docker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-kafka-docker" class="bare">bit.ly/Darwin-BUILD-SNAPSHOT-stream-applications-kafka-docker</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table lists the available Task Application Starters:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Artifact Type</th>
<th class="tableblock halign-left valign-top">Stable Release</th>
<th class="tableblock halign-left valign-top">SNAPSHOT Release</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-SR1-task-applications-maven" class="bare">bit.ly/Clark-SR1-task-applications-maven</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-BUILD-SNAPSHOT-task-applications-maven" class="bare">bit.ly/Clark-BUILD-SNAPSHOT-task-applications-maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-SR1-task-applications-docker" class="bare">bit.ly/Clark-SR1-task-applications-docker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-BUILD-SNAPSHOT-task-applications-docker" class="bare">bit.ly/Clark-BUILD-SNAPSHOT-task-applications-docker</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can find more information about the available task starters in the <a href="http://cloud.spring.io/spring-cloud-task-app-starters/">Task App Starters Project Page</a> and
related reference documentation.  For more information about the available stream starters, look at the <a href="http://cloud.spring.io/spring-cloud-stream-app-starters/">Stream App Starters Project Page</a>
and related reference documentation.</p>
</div>
<div class="paragraph">
<p>As an example, if you would like to register all out-of-the-box stream applications built with the Kafka binder in bulk, you can use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ dataflow:>app import --uri http://bit.ly/Darwin-SR3-stream-applications-kafka-maven</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can register all the stream applications with the Rabbit binder, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ dataflow:>app import --uri http://bit.ly/Darwin-SR3-stream-applications-rabbit-maven</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass the <code>--local</code> option (which is <code>true</code> by default) to indicate whether the
properties file location should be resolved within the shell process itself. If the location should
be resolved from the Data Flow Server process, specify <code>--local false</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using either <code>app register</code> or <code>app import</code>, if an app is already registered with
the provided name and type, it is not overridden by default. If you would like to override the
pre-existing app coordinates, then include the <code>--force</code> option.</p>
</div>
<div class="paragraph">
<p>Note, however, that, once downloaded, applications may be cached locally on the Data Flow server, based on the resource
location. If the resource location does not change (even though the actual resource <em>bytes</em> may be different), then it
is not re-downloaded. When using <code>maven://</code> resources on the other hand, using a constant location may still circumvent
caching (if using <code>-SNAPSHOT</code> versions).</p>
</div>
<div class="paragraph">
<p>Moreover, if a stream is already deployed and using some version of a registered app, then (forcibly) re-registering a
different app has no effect until the stream is deployed again.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In some cases, the Resource is resolved on the server side. In others, the
URI is passed to a runtime container instance where it is resolved. Consult
the specific documentation of each Data Flow Server for more detail.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-dataflow-stream-app-whitelisting"><a class="anchor" href="#spring-cloud-dataflow-stream-app-whitelisting"></a>28.1.2. Whitelisting application properties</h4>
<div class="paragraph">
<p>Stream and Task applications are Spring Boot applications that are aware of many <a href="#spring-cloud-dataflow-global-properties">Common Application Properties</a>, such as <code>server.port</code> but also families of properties such as those with the prefix <code>spring.jmx</code> and <code>logging</code>.  When creating your own application, you should whitelist properties so that the shell and the UI can display them first as primary properties when presenting options through TAB completion or in drop-down boxes.</p>
</div>
<div class="paragraph">
<p>To whitelist application properties, create a file named <code>spring-configuration-metadata-whitelist.properties</code> in the <code>META-INF</code> resource directory. There are two property keys that can be used inside this file. The first key is named <code>configuration-properties.classes</code>. The value is a comma separated list of fully qualified <code>@ConfigurationProperty</code> class names. The second key is <code>configuration-properties.names</code>, whose value is a comma-separated list of property names. This can contain the full name of the property, such as <code>server.port</code>, or a partial name to whitelist a category of property names, such as <code>spring.jmx</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/spring-cloud-stream-app-starters">Spring Cloud Stream application starters</a> are a good place to look for examples of usage. The following example comes from the file sink&#8217;s <code>spring-configuration-metadata-whitelist.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>configuration-properties.classes=org.springframework.cloud.stream.app.file.sink.FileSinkProperties</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we also want to add <code>server.port</code> to be white listed, it would become the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>configuration-properties.classes=org.springframework.cloud.stream.app.file.sink.FileSinkProperties
configuration-properties.names=server.port</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure to add 'spring-boot-configuration-processor' as an optional dependency to generate configuration metadata file for the properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
    &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-dataflow-stream-app-metadata-artifact"><a class="anchor" href="#spring-cloud-dataflow-stream-app-metadata-artifact"></a>28.1.3. Creating and Using a Dedicated Metadata Artifact</h4>
<div class="paragraph">
<p>You can go a step further in the process of describing the main properties that your stream or task app supports by
creating a metadata companion artifact. This jar file contains only the Spring boot JSON file about
configuration properties metadata and the whitelisting file described in the previous section.</p>
</div>
<div class="paragraph">
<p>The following example shows the contents of such an artifact, for the canonical <code>log</code> sink:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ jar tvf log-sink-rabbit-1.2.1.BUILD-SNAPSHOT-metadata.jar
373848 META-INF/spring-configuration-metadata.json
   174 META-INF/spring-configuration-metadata-whitelist.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>spring-configuration-metadata.json</code> file is quite large. This is because it contains the concatenation of <em>all</em> the properties that
are available at runtime to the <code>log</code> sink (some of them come from <code>spring-boot-actuator.jar</code>, some of them come from
<code>spring-boot-autoconfigure.jar</code>, some more from <code>spring-cloud-starter-stream-sink-log.jar</code>, and so on). Data Flow
always relies on all those properties, even when a companion artifact is not available, but here all have been merged
into a single file.</p>
</div>
<div class="paragraph">
<p>To help with that (you do not want to try to craft this giant JSON file by hand), you can use the
following plugin in your build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
 	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
 	&lt;artifactId&gt;spring-cloud-app-starter-metadata-maven-plugin&lt;/artifactId&gt;
 	&lt;executions&gt;
 		&lt;execution&gt;
 			&lt;id&gt;aggregate-metadata&lt;/id&gt;
 			&lt;phase&gt;compile&lt;/phase&gt;
 			&lt;goals&gt;
 				&lt;goal&gt;aggregate-metadata&lt;/goal&gt;
 			&lt;/goals&gt;
 		&lt;/execution&gt;
 	&lt;/executions&gt;
 &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This plugin comes in addition to the <code>spring-boot-configuration-processor</code> that creates the individual JSON files.
Be sure to configure both.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The benefits of a companion artifact include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Being much lighter. (The companion artifact is usually a few kilobytes, as opposed to megabytes for the actual app.) Consequently, they are quicker to download,
allowing quicker feedback when using, for example, <code>app info</code> or the Dashboard UI.</p>
</li>
<li>
<p>As a consequence of being lighter, they can be used in resource constrained environments (such as PaaS) when metadata is
the only piece of information needed.</p>
</li>
<li>
<p>For environments that do not deal with Spring Boot uber jars directly (for example, Docker-based runtimes such as
Kubernetes or Cloud Foundry), this is the only way to provide metadata about the properties supported by the app.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remember, though, that this is entirely optional when dealing with uber jars. The uber jar itself also includes the
metadata in it already.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_companion_artifact"><a class="anchor" href="#_using_the_companion_artifact"></a>28.1.4. Using the Companion Artifact</h4>
<div class="paragraph">
<p>Once you have a companion artifact at hand, you need to make the system aware of it so that it can be used.</p>
</div>
<div class="paragraph">
<p>When registering a single app with <code>app register</code>, you can use the optional <code>--metadata-uri</code> option in the shell, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;app register --name log --type sink
    --uri maven://org.springframework.cloud.stream.app:log-sink-kafka-10:1.2.1.BUILD-SNAPSHOT
    --metadata-uri maven://org.springframework.cloud.stream.app:log-sink-kafka-10:jar:metadata:1.2.1.BUILD-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>When registering several files by using the <code>app import</code> command, the file should contain a <code>&lt;type&gt;.&lt;name&gt;.metadata</code> line
in addition to each <code>&lt;type&gt;.&lt;name&gt;</code> line. Strictly speaking, doing so is optional (if some apps have it but some others do not, it works), but it is best practice.</p>
</div>
<div class="paragraph">
<p>The following example shows a Dockerized app, where the metadata artifact is being hosted in a Maven repository (retrieving
it through <code>http://</code> or <code>file://</code> would be equally possible).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">...
source.http=docker:springcloudstream/http-source-rabbit:latest
source.http.metadata=maven://org.springframework.cloud.stream.app:http-source-rabbit:jar:metadata:1.2.1.BUILD-SNAPSHOT
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-applications"><a class="anchor" href="#custom-applications"></a>28.1.5. Creating Custom Applications</h4>
<div class="paragraph">
<p>While there are out-of-the-box source, processor, sink applications available, you can extend these applications or write a custom <a href="https://github.com/spring-cloud/spring-cloud-stream">Spring Cloud Stream</a> application.</p>
</div>
<div class="paragraph">
<p>The process of creating Spring Cloud Stream applications with <a href="http://start.spring.io/">Spring Initializr</a> is detailed in the Spring Cloud Stream {spring-cloud-stream-docs}#_getting_started[documentation].
It is possible to include multiple binders to an application.
If doing so, see the instructions in <a href="#passing_producer_consumer_properties">Passing Spring Cloud Stream properties</a> for how to configure them.</p>
</div>
<div class="paragraph">
<p>For supporting property whitelisting, Spring Cloud Stream applications running in Spring Cloud Data Flow may include the Spring Boot <code>configuration-processor</code> as an optional dependency, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
  &lt;!-- other dependencies --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
    &lt;optional&gt;true&lt;/optional&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that the <code>spring-boot-maven-plugin</code> is included in the POM.
The plugin is necessary for creating the executable jar that is registered with Spring Cloud Data Flow.
Spring Initialzr includes the plugin in the generated POM.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once a custom application has been created, it can be registered as described in <a href="#spring-cloud-dataflow-register-stream-apps">Register a Stream App</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-create-stream"><a class="anchor" href="#spring-cloud-dataflow-create-stream"></a>28.2. Creating a Stream</h3>
<div class="paragraph">
<p>The Spring Cloud Data Flow Server exposes a full RESTful API for managing the lifecycle of stream definitions, but the easiest way to use is it is through the Spring Cloud Data Flow shell. Start the shell as described in the <a href="#getting-started">Getting Started</a> section.</p>
</div>
<div class="paragraph">
<p>New streams are created with the help of stream definitions. The definitions are built from a simple DSL. For example, consider what happens if we execute the following shell command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt; stream create --definition "time | log" --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines a stream named <code>ticktock</code> that is based off the DSL expression <code>time | log</code>. The DSL uses the "pipe" symbol (<code>|</code>), to connect a source to a sink.</p>
</div>
<div class="sect3">
<h4 id="_application_properties_2"><a class="anchor" href="#_application_properties_2"></a>28.2.1. Application Properties</h4>
<div class="paragraph">
<p>Application properties are the properties associated with each application in the stream. When the application is deployed, the application properties are applied to the application through
command line arguments or environment variables, depending on the underlying deployment implementation.</p>
</div>
<div class="paragraph">
<p>The following stream can have application properties defined at the time of stream creation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; stream create --definition "time | log" --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>The shell command <code>app info --name &lt;appName&gt; --type &lt;appType&gt;</code> displays the white-listed application properties for the application.
For more info on the property white listing, refer to <a href="#spring-cloud-dataflow-stream-app-whitelisting">Whitelisting application properties</a></p>
</div>
<div class="paragraph">
<p>The following listing shows the white_listed properties for the <code>time</code> app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">dataflow:&gt; app info --name time --type source

         Option Name                   Description                     Default                         Type             

trigger.time-unit             The TimeUnit to apply to delay&lt;none&gt;                        java.util.concurrent.TimeUnit 
                              values.                                                                                   
trigger.fixed-delay           Fixed delay for periodic      1                             java.lang.Integer             
                              triggers.                                                                                 
trigger.cron                  Cron expression value for the &lt;none&gt;                        java.lang.String              
                              Cron Trigger.                                                                             
trigger.initial-delay         Initial delay for periodic    0                             java.lang.Integer             
                              triggers.                                                                                 
trigger.max-messages          Maximum messages per poll, -1 1                             java.lang.Long                
                              means infinity.                                                                           
trigger.date-format           Format for the date value.    &lt;none&gt;                        java.lang.String              
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the white-listed properties for the <code>log</code> app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">dataflow:&gt; app info --name log --type sink

         Option Name                   Description                     Default                         Type             

log.name                      The name of the logger to use.&lt;none&gt;                        java.lang.String              
log.level                     The level at which to log     &lt;none&gt;                        org.springframework.integratio
                              messages.                                                   n.handler.LoggingHandler$Level
log.expression                A SpEL expression (against thepayload                       java.lang.String              
                              incoming message) to evaluate                                                             
                              as the logged message.                                                                    
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application properties for the <code>time</code> and <code>log</code> apps can be specified at the time of <code>stream</code> creation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; stream create --definition "time --fixed-delay=5 | log --level=WARN" --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, in the preceding example, the <code>fixed-delay</code> and <code>level</code> properties defined for the apps <code>time</code> and <code>log</code> are the "'short-form'" property names provided by the shell completion.
These "'short-form'" property names are applicable only for the white-listed properties. In all other cases, only fully qualified property names should be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-dataflow-global-properties"><a class="anchor" href="#spring-cloud-dataflow-global-properties"></a>28.2.2. Common Application Properties</h4>
<div class="paragraph">
<p>In addition to configuration through DSL, Spring Cloud Data Flow provides a mechanism for setting common properties to all
the streaming applications that are launched by it.
This can be done by adding properties prefixed with <code>spring.cloud.dataflow.applicationProperties.stream</code> when starting
the server.
When doing so, the server passes all the properties, without the prefix, to the instances it launches.</p>
</div>
<div class="paragraph">
<p>For example, all the launched applications can be configured to use a specific Kafka broker by launching the
Data Flow server with the following options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>--spring.cloud.dataflow.applicationProperties.stream.spring.cloud.stream.kafka.binder.brokers=192.168.1.100:9092
--spring.cloud.dataflow.applicationProperties.stream.spring.cloud.stream.kafka.binder.zkNodes=192.168.1.100:2181</code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so causes the properties <code>spring.cloud.stream.kafka.binder.brokers</code> and <code>spring.cloud.stream.kafka.binder.zkNodes</code>
to be passed to all the launched applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Properties configured with this mechanism have lower precedence than stream deployment properties.
They are overridden if a property with the same key is specified at stream deployment time (for example,
<code>app.http.spring.cloud.stream.kafka.binder.brokers</code> overrides the common property).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-deploy-stream"><a class="anchor" href="#spring-cloud-dataflow-deploy-stream"></a>28.3. Deploying a Stream</h3>
<div class="paragraph">
<p>This section describes how to deploy a Stream when the Spring Cloud Data Flow server is responsible for deploying the stream.  The following section, <a href="#spring-cloud-dataflow-stream-lifecycle-skipper">Stream Lifecycle with Skipper</a>, covers the new deployment and upgrade features when the Spring Cloud Data Flow server delegates to Skipper for stream deployment.  The description of how deployment properties applies to both approaches of Stream deployment.</p>
</div>
<div class="paragraph">
<p>Give the <code>ticktock</code> stream definition:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream create --definition "time | log" --name ticktock</code></p>
</div>
<div class="paragraph">
<p>To deploy the stream, use the following shell command:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream deploy --name ticktock</code></p>
</div>
<div class="paragraph">
<p>The Data Flow Server resolves <code>time</code> and <code>log</code> to maven coordinates and uses those to launch the <code>time</code> and <code>log</code> applications of the stream, as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2016-06-01 09:41:21.728  INFO 79016 --- [nio-9393-exec-6] o.s.c.d.spi.local.LocalAppDeployer       : deploying app ticktock.log instance 0
   Logs will be in /var/folders/wn/8jxm_tbd1vj28c8vj37n900m0000gn/T/spring-cloud-dataflow-912434582726479179/ticktock-1464788481708/ticktock.log
2016-06-01 09:41:21.914  INFO 79016 --- [nio-9393-exec-6] o.s.c.d.spi.local.LocalAppDeployer       : deploying app ticktock.time instance 0
   Logs will be in /var/folders/wn/8jxm_tbd1vj28c8vj37n900m0000gn/T/spring-cloud-dataflow-912434582726479179/ticktock-1464788481910/ticktock.time</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the time source sends the current time as a message each second, and the log sink outputs it by using the logging framework.
You can tail the <code>stdout</code> log (which has an <code>&lt;instance&gt;</code> suffix). The log files are located within the directory displayed in the Data Flow Server&#8217;s log output, as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ tail -f /var/folders/wn/8jxm_tbd1vj28c8vj37n900m0000gn/T/spring-cloud-dataflow-912434582726479179/ticktock-1464788481708/ticktock.log/stdout_0.log
2016-06-01 09:45:11.250  INFO 79194 --- [  kafka-binder-] log.sink    : 06/01/16 09:45:11
2016-06-01 09:45:12.250  INFO 79194 --- [  kafka-binder-] log.sink    : 06/01/16 09:45:12
2016-06-01 09:45:13.251  INFO 79194 --- [  kafka-binder-] log.sink    : 06/01/16 09:45:13</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also create and deploy the stream in one step by passing the <code>--deploy</code> flag when creating the stream, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt; stream create --definition "time | log" --name ticktock --deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, it is not very common in real-world use cases to create and deploy the stream in one step.
The reason is that when you use the <code>stream deploy</code> command, you can pass in properties that define how to map the applications onto the platform (for example, what is the memory size of the container to use, the number of each application to run, and whether to enable data partitioning features).
Properties can also override application properties that were set when creating the stream.
The next sections cover this feature in detail.</p>
</div>
<div class="sect3">
<h4 id="_deployment_properties"><a class="anchor" href="#_deployment_properties"></a>28.3.1. Deployment Properties</h4>
<div class="paragraph">
<p>When deploying a stream, you can specify properties that fall into two groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties that control how the apps are deployed to the target platform.
These properties use a <code>deployer</code> prefix and are referred to as <code>deployer</code> properties.</p>
</li>
<li>
<p>Properties that set application properties or override application properties set during stream creation and are referred to as <code>application</code> properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The syntax for <code>deployer</code> properties is <code>deployer.&lt;app-name&gt;.&lt;short-property-name&gt;=&lt;value&gt;</code>, and the syntax for <code>application</code> properties <code>app.&lt;app-name&gt;.&lt;property-name&gt;=&lt;value&gt;</code>. This syntax is used when passing deployment properties through the shell. You may also specify them in a YAML file, which is discussed later in this chapter.</p>
</div>
<div class="paragraph">
<p>The following table shows the difference in behavior between setting <code>deployer</code> and <code>application</code> properties when deploying an application.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Application Properties</th>
<th class="tableblock halign-left valign-top">Deployer Properties</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example Syntax</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>app.filter.expression=something</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer.filter.count=3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>What the application "sees"</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expression=something</code> or, if <code>expression</code> is one of the whitelisted properties, <code>&lt;some-prefix&gt;.expression=something</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nothing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>What the deployer "sees"</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nothing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.deployer.count=3</code>. The <code>spring.cloud.deployer</code> prefix is automatically and always prepended to the property name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Typical usage</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passing/Overriding application properties, passing Spring Cloud Stream binder or partitioning properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setting the number of instances, memory, disk, and others</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_passing_instance_count"><a class="anchor" href="#_passing_instance_count"></a>Passing Instance Count</h5>
<div class="paragraph">
<p>If you would like to have multiple instances of an application in the stream, you
can include a deployer property called <code>count</code> with the <code>deploy</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:> stream deploy --name ticktock --properties "deployer.time.count=3"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>count</code> is the reserved property name used by the underlying deployer. Consequently, if the application also has a custom property named <code>count</code>, it is not supported
when specified in 'short-form' form during stream deployment as it could conflict with the instance <code>count</code> deployer property. Instead, the <code>count</code> as a custom application property can be
specified in its fully qualified form (for example, <code>app.something.somethingelse.count</code>) during stream deployment or it can be specified by using the 'short-form' or the fully qualified form during the stream creation,
where it is processed as an app property.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
See <a href="#spring-cloud-dataflow-stream-dsl-labels">Using Labels in a Stream</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_inline_versus_file_based_properties"><a class="anchor" href="#_inline_versus_file_based_properties"></a>Inline Versus File-based Properties</h5>
<div class="paragraph">
<p>When using the Spring Cloud Data Flow Shell, there are two ways to provide deployment
properties: either <strong>inline</strong> or through a <strong>file reference</strong>. Those two ways are exclusive.</p>
</div>
<div class="paragraph">
<p>Inline properties use the <code>--properties</code> shell option and list properties as a comma separated
list of key=value pairs, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">stream deploy foo
    --properties "deployer.transform.count=2,app.transform.producer.partitionKeyExpression=payload"</code></pre>
</div>
</div>
<div class="paragraph">
<p>File references use the <code>--propertiesFile</code> option and point it to a local <code>.properties</code>, <code>.yaml</code> or <code>.yml</code> file
(that is, a file that resides in the filesystem of the machine running the shell). Being read
as a <code>.properties</code> file, normal rules apply (ISO 8859-1 encoding, <code>=</code>, <code>&lt;space&gt;</code> or
<code>:</code> delimiter, and others), although we recommend using <code>=</code> as a key-value pair delimiter,
for consistency. The following example shows a <code>stream deploy</code> command that uses the <code>--propertiesFile</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">stream deploy something --propertiesFile myprops.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume that <code>myprops.properties</code> contains the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer.transform.count=2
app.transform.producer.partitionKeyExpression=payload</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of the properties are passed as deployment properties for the <code>something</code> stream.</p>
</div>
<div class="paragraph">
<p>If you use YAML as the format for the deployment properties, use the <code>.yaml</code> or <code>.yml</code> file extention when deploying the stream, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">stream deploy foo --propertiesFile myprops.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>In that case, the <code>myprops.yaml</code> file might contain the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>deployer:
  transform:
    count: 2
app:
  transform:
    producer:
      partitionKeyExpression: payload</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_passing_application_properties"><a class="anchor" href="#_passing_application_properties"></a>Passing application properties</h5>
<div class="paragraph">
<p>The application properties can also be specified when deploying a stream. When specified during deployment, these application properties can either be specified as
 'short-form' property names (applicable for white-listed properties) or as fully qualified property names. The application properties should have the prefix <code>app.&lt;appName/label&gt;</code>.</p>
</div>
<div class="paragraph">
<p>For example, consider the following stream command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; stream create --definition "time | log" --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>The stream in the precedig example can also be deployed with application properties by using the 'short-form' property names, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy ticktock --properties "app.time.fixed-delay=5,app.log.level=ERROR"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">stream create ticktock --definition "a: time | b: log"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the app label, the application properties can be defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">stream deploy ticktock --properties "app.a.fixed-delay=4,app.b.level=ERROR"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="passing_producer_consumer_properties"><a class="anchor" href="#passing_producer_consumer_properties"></a>Passing Spring Cloud Stream properties</h5>
<div class="paragraph">
<p>Spring Cloud Data Flow sets the <code>required</code> Spring Cloud Stream properties for the applications inside the stream. Most importantly, the <code>spring.cloud.stream.bindings.&lt;input/output&gt;.destination</code> is set internally for the apps to bind.</p>
</div>
<div class="paragraph">
<p>If you want to override any of the Spring Cloud Stream properties, they can be set with deployment properties.</p>
</div>
<div class="paragraph">
<p>For example, consider the following stream definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; stream create --definition "http | transform --expression=payload.getValue('hello').toUpperCase() | log" --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are multiple binders available in the classpath for each of the applications and the binder is chosen for each deployment, then the stream can be deployed with the specific Spring Cloud Stream properties, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy ticktock --properties "app.time.spring.cloud.stream.bindings.output.binder=kafka,app.transform.spring.cloud.stream.bindings.input.binder=kafka,app.transform.spring.cloud.stream.bindings.output.binder=rabbit,app.log.spring.cloud.stream.bindings.input.binder=rabbit"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Overriding the destination names is not recommended, because Spring Cloud Data Flow internally takes care of setting this property.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_passing_per_binding_producer_and_consumer_properties"><a class="anchor" href="#_passing_per_binding_producer_and_consumer_properties"></a>Passing Per-binding Producer and Consumer Properties</h5>
<div class="paragraph">
<p>A Spring Cloud Stream application can have producer and consumer properties set on a <code>per-binding</code> basis.
While Spring Cloud Data Flow supports specifying short-hand notation for per-binding producer properties such as <code>partitionKeyExpression</code> and <code>partitionKeyExtractorClass</code> (as described in <a href="#passing_stream_partition_properties">Passing Stream Partition Properties</a>), all the supported Spring Cloud Stream producer/consumer properties can be set as Spring Cloud Stream properties for the app directly as well.</p>
</div>
<div class="paragraph">
<p>The consumer properties can be set for the <code>inbound</code> channel name with the prefix <code>app.[app/label name].spring.cloud.stream.bindings.&lt;channelName&gt;.consumer.</code>. The producer properties can be set for the <code>outbound</code> channel name with the prefix <code>app.[app/label name].spring.cloud.stream.bindings.&lt;channelName&gt;.producer.</code>.
Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; stream create --definition "time | log" --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>The stream can be deployed with producer and consumer properties, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy ticktock --properties "app.time.spring.cloud.stream.bindings.output.producer.requiredGroups=myGroup,app.time.spring.cloud.stream.bindings.output.producer.headerMode=raw,app.log.spring.cloud.stream.bindings.input.consumer.concurrency=3,app.log.spring.cloud.stream.bindings.input.consumer.maxAttempts=5"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>binder</code>-specific producer and consumer properties can also be specified in a similar way, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy ticktock --properties "app.time.spring.cloud.stream.rabbit.bindings.output.producer.autoBindDlq=true,app.log.spring.cloud.stream.rabbit.bindings.input.consumer.transacted=true"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="passing_stream_partition_properties"><a class="anchor" href="#passing_stream_partition_properties"></a>Passing Stream Partition Properties</h5>
<div class="paragraph">
<p>A common pattern in stream processing is to partition the data as it is streamed.
This entails deploying multiple instances of a message-consuming app and using
content-based routing so that messages with a given key (as determined at runtime)
are always routed to the same app instance. You can pass the partition properties during
stream deployment to declaratively configure a partitioning strategy to route each
message to a specific consumer instance.</p>
</div>
<div class="paragraph">
<p>The following list shows variations of deploying partitioned streams:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>app.[app/label name].producer.partitionKeyExtractorClass</strong>:
The class name of a <code>PartitionKeyExtractorStrategy</code> (default: <code>null</code>)</p>
</li>
<li>
<p><strong>app.[app/label name].producer.partitionKeyExpression</strong>:
A SpEL expression, evaluated against the message, to determine the partition key.
Only applies if <code>partitionKeyExtractorClass</code> is null. If both are null, the app
is not partitioned (default: <code>null</code>)</p>
</li>
<li>
<p><strong>app.[app/label name].producer.partitionSelectorClass</strong>:
The class name of a <code>PartitionSelectorStrategy</code> (default: <code>null</code>)</p>
</li>
<li>
<p><strong>app.[app/label name].producer.partitionSelectorExpression</strong>:
A SpEL expression, evaluated against the partition key, to determine the partition
index to which the message is routed. The final partition index is the
return value (an integer) modulo <code>[nextModule].count</code>. If both the class and
expression are null, the underlying binder&#8217;s default <code>PartitionSelectorStrategy</code>
is applied to the key (default: <code>null</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, an app is partitioned if its count is &gt; 1 and the previous app has a
<code>partitionKeyExtractorClass</code> or <code>partitionKeyExpression</code> (<code>partitionKeyExtractorClass</code> takes precedence).
When a partition key is extracted, the partitioned app instance is determined by
invoking the <code>partitionSelectorClass</code>, if present, or the <code>partitionSelectorExpression % partitionCount</code>.
<code>partitionCount</code> is application count, in the case of RabbitMQ, or the underlying
partition count of the topic, in the case of Kafka.</p>
</div>
<div class="paragraph">
<p>If neither a <code>partitionSelectorClass</code> nor a <code>partitionSelectorExpression</code> is
present, the result is <code>key.hashCode() % partitionCount</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="passing_content_type_properties"><a class="anchor" href="#passing_content_type_properties"></a>Passing application content type properties</h5>
<div class="paragraph">
<p>In a stream definition, you can specify that the input or the output of an application must be converted to a different type.
You can use the <code>inputType</code> and <code>outputType</code> properties to specify the content type for the incoming data and outgoing data, respectively.</p>
</div>
<div class="paragraph">
<p>For example, consider the following stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;stream create tuple --definition "http | filter --inputType=application/x-spring-tuple
 --expression=payload.hasFieldName('hello') | transform --expression=payload.getValue('hello').toUpperCase()
 | log" --deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>http</code> app is expected to send the data in JSON and the <code>filter</code> app receives the JSON data
and processes it as a Spring Tuple.
In order to do so, we use the <code>inputType</code> property on the filter app to convert the data into the expected Spring Tuple format.
The <code>transform</code> application processes the Tuple data and sends the processed data to the downstream <code>log</code> application.</p>
</div>
<div class="paragraph">
<p>Consider the following example of sending some data to the <code>http</code> application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataflow:&gt;http post --data {"hello":"world","something":"somethingelse"} --contentType application/json --target http://localhost:&lt;http-port&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>At the log application, you see the content as follows:</p>
</div>
<div class="paragraph">
<p><code>INFO 18745 --- [transform.tuple-1] log.sink                                 : WORLD</code></p>
</div>
<div class="paragraph">
<p>Depending on how applications are chained, the content type conversion can be specified either as an <code>--outputType</code> in the upstream app or as an <code>--inputType</code> in the downstream app.
For instance, in the above stream, instead of specifying the <code>--inputType</code> on the 'transform' application to convert, the option <code>--outputType=application/x-spring-tuple</code> can also be specified on the 'http' application.</p>
</div>
<div class="paragraph">
<p>For the complete list of message conversion and message converters, please refer to Spring Cloud Stream {spring-cloud-stream-docs}#contenttypemanagement[documentation].</p>
</div>
</div>
<div class="sect4">
<h5 id="_overriding_application_properties_during_stream_deployment"><a class="anchor" href="#_overriding_application_properties_during_stream_deployment"></a>Overriding Application Properties During Stream Deployment</h5>
<div class="paragraph">
<p>Application properties that are defined during deployment override the same properties defined during the stream creation.</p>
</div>
<div class="paragraph">
<p>For example, the following stream has application properties defined during stream creation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; stream create --definition "time --fixed-delay=5 | log --level=WARN" --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>To override these application properties, you can specify the new property values during deployment, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy ticktock --properties "app.time.fixed-delay=4,app.log.level=ERROR"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-destroy-stream"><a class="anchor" href="#spring-cloud-dataflow-destroy-stream"></a>28.4. Destroying a Stream</h3>
<div class="paragraph">
<p>You can delete a stream by issuing the <code>stream destroy</code> command from the shell, as follows:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream destroy --name ticktock</code></p>
</div>
<div class="paragraph">
<p>If the stream was deployed, it is undeployed before the stream definition is deleted.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-undeploy-stream"><a class="anchor" href="#spring-cloud-dataflow-undeploy-stream"></a>28.5. Undeploying a Stream</h3>
<div class="paragraph">
<p>Often you want to stop a stream but retain the name and definition for future use. In that case, you can <code>undeploy</code> the stream by name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt; stream undeploy --name ticktock
dataflow:&gt; stream deploy --name ticktock</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can issue the <code>deploy</code> command at a later time to restart it.</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; stream deploy --name ticktock</code></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-validate-stream"><a class="anchor" href="#spring-cloud-dataflow-validate-stream"></a>28.6. Validating a Stream</h3>
<div class="paragraph">
<p>Sometimes the one or more of the apps contained within a stream definition contain an invalid URI in its registration.
This can caused by an invalid URI entered at app registration time or the app was removed from the repository from which it was to be drawn.
To verify that all the apps contained in a stream are resolve-able, a user can use the <code>validate</code> command.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream validate ticktock

Stream NameStream Definition

ticktock   time | log       



ticktock is a valid stream.

 App Name  Validation Status

source:timevalid            
sink:log   valid            
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the user validated their ticktock stream.   As we see that both the <code>source:time</code> and <code>sink:log</code> are valid.
Now let&#8217;s see what happens if we have a stream definition with a registered app with an invalid URI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream validate bad-ticktock

Stream Name Stream Definition

bad-ticktockbad-time | log   



bad-ticktock is an invalid stream.

   App Name    Validation Status

source:bad-timeinvalid          
sink:log       valid            
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case Spring Cloud Data Flow states that the stream is invalid because source:bad-time has an invalid URI.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-stream-lifecycle-skipper"><a class="anchor" href="#spring-cloud-dataflow-stream-lifecycle-skipper"></a>29. Stream Lifecycle with Skipper</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An additional lifecycle stage of Stream is available if you run in "skipper" mode.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#spring-cloud-dataflow-streams-skipper-upgrading">Upgrade</a> or <a href="#spring-cloud-dataflow-streams-skipper-rollback">Rollback</a> applications in the Stream. (Skipper mode)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="https://cloud.spring.io/spring-cloud-skipper/">Skipper</a> is a server that you discover Spring Boot applications and manage their lifecycle on multiple Cloud Platforms.</p>
</div>
<div class="paragraph">
<p>Applications in Skipper are bundled as packages that contain the application&#8217;s resource location, application properties and deployment properites.
You can think Skipper packages as analogous to packages found in tools such as <code>apt-get</code> or <code>brew</code>.</p>
</div>
<div class="paragraph">
<p>When Data Flow deploys a Stream, it will generate and upload a package to Skipper that represents the applications in the Stream.
Subsequent commands to upgrade or rollback the applications within the Stream are passed through to Skipper.
In addition, the Stream definition is reverse engineered from the package and the status of the Stream is also delegated to Skipper.</p>
</div>
<div class="sect2">
<h3 id="_register_a_versioned_stream_app"><a class="anchor" href="#_register_a_versioned_stream_app"></a>29.1. Register a Versioned Stream App</h3>
<div class="paragraph">
<p>Skipper extends the <em><a href="streams.html#spring-cloud-dataflow-register-stream-apps">Register a Stream App</a></em>
 lifecycle with support of multi-versioned stream applications.
This allows to upgrade or rollback those applications at runtime using the deployment properties.</p>
</div>
<div class="paragraph">
<p>Register a versioned stream application using the <code>app register</code> command. You must provide a unique name, application type, and a URI that can be resolved to the app artifact.
For the type, specify "source", "processor", or "sink". The version is resolved from the URI. Here are a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;app register --name mysource --type source --uri maven://com.example:mysource:0.0.1
dataflow:&gt;app register --name mysource --type source --uri maven://com.example:mysource:0.0.2
dataflow:&gt;app register --name mysource --type source --uri maven://com.example:mysource:0.0.3

dataflow:&gt;app list --id source:mysource

app      source      processorsinktask

   &gt; mysource-0.0.1 &lt;                 
   mysource-0.0.2                     
   mysource-0.0.3                     
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application URI should conform to one the following schema formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>maven schema</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>maven://&lt;groupId&gt;:&lt;artifactId&gt;[:&lt;extension&gt;[:&lt;classifier&gt;]]:&lt;version&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>http schema</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>http://&lt;web-path&gt;/&lt;artifactName&gt;-&lt;version&gt;.jar</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>file schema</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>file:///&lt;local-path&gt;/&lt;artifactName&gt;-&lt;version&gt;.jar</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>docker schema</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>docker:&lt;docker-image-path&gt;/&lt;imageName&gt;:&lt;version&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The URI <code>&lt;version&gt;</code> part is compulsory for the versioned stream applications
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Multiple versions can be registered for the same applications (e.g. same name and type) but only one can be set as default.
The default version is used for deploying Streams.</p>
</div>
<div class="paragraph">
<p>The first time an application is registered it will be marked as default. The default application version can be altered with the <code>app default</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;app default --id source:mysource --version 0.0.2
dataflow:&gt;app list --id source:mysource

app      source      processorsinktask

   mysource-0.0.1                     
   &gt; mysource-0.0.2 &lt;                 
   mysource-0.0.3                     
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>app list --id &lt;type:name&gt;</code> command lists all versions for a given stream application.</p>
</div>
<div class="paragraph">
<p>The <code>app unregister</code> command has an optional <code>--version</code> parameter to specify the app version to unregister.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;app unregister --name mysource --type source --version 0.0.1
dataflow:&gt;app list --id source:mysource

app      source      processorsinktask

   &gt; mysource-0.0.2 &lt;                 
   mysource-0.0.3                     
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a <code>--version</code> is not specified, the default version is unregistered.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All applications in a stream should have a default version set for the stream to be deployed.
Otherwise they will be treated as unregistered application during the deployment.
Use the <code>app default</code> to set the defaults.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">app default --id source:mysource --version 0.0.3
dataflow:&gt;app list --id source:mysource

app      source      processorsinktask

   mysource-0.0.2                     
   &gt; mysource-0.0.3 &lt;                 
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>stream deploy</code> necessitates default app versions to be set.
The <code>stream update</code> and <code>stream rollback</code> commands though can use all (default and non-default) registered app versions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream create foo --definition "mysource | log"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create stream using the default mysource version (0.0.3). Then we can update the version to 0.0.2 like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream update foo --properties version.mysource=0.0.2</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only pre-registered applications can be used to <code>deploy</code>, <code>update</code> or <code>rollback</code> a Stream.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An attempt to update the <code>mysource</code> to version <code>0.0.1</code> (not registered) will fail!</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-lifecycle-skipper-create"><a class="anchor" href="#spring-cloud-dataflow-stream-lifecycle-skipper-create"></a>29.2. Creating and Deploying a Stream</h3>
<div class="paragraph">
<p>You create and deploy a stream by using Skipper in two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creating the stream definition.</p>
</li>
<li>
<p>Deploying the stream.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows the two steps in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; stream create --name httptest --definition "http --server.port=9000 | log"
dataflow:&gt; stream deploy --name httptest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>stream info</code> command shows useful information about the stream, including the deployment properties, as shown (with its output) in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream info httptest

             Name                          DSL                        Status            

httptest                      http --server.port=9000 | log deploying                   


Stream Deployment properties: {
  "log" : {
    "spring.cloud.deployer.indexed" : "true",
    "spring.cloud.deployer.group" : "httptest",
    "maven://org.springframework.cloud.stream.app:log-sink-rabbit" : "1.1.0.RELEASE"
  },
  "http" : {
    "spring.cloud.deployer.group" : "httptest",
    "maven://org.springframework.cloud.stream.app:http-source-rabbit" : "1.1.0.RELEASE"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is an important optional command argument (called <code>--platformName</code>) to the <code>stream deploy</code> command.
Skipper can be configured to deploy to multiple platforms.
Skipper is pre-configured with a platform named <code>default</code>, which deploys applications to the local machine where Skipper is running.
The default value of the command line argument <code>--platformName</code> is <code>default</code>.
If you commonly deploy to one platform, when installing Skipper, you can override the configuration of the <code>default</code> platform.
Otherwise, specify the <code>platformName</code> to one of the values returned by the <code>stream platform-list</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-lifecycle-skipper-update"><a class="anchor" href="#spring-cloud-dataflow-stream-lifecycle-skipper-update"></a>29.3. Updating a Stream</h3>
<div class="paragraph">
<p>To update the stream, use the command <code>stream update</code> which takes as a command argument either <code>--properties</code> or <code>--propertiesFile</code>.
You can pass in values to these command arguments in the same format as when deploy the stream with or without Skipper.
There is an important new top level prefix available when using Skipper, which is <code>version</code>.
If the Stream <code>http | log</code> was deployed, and the version of <code>log</code> which registered at the time of deployment was <code>1.1.0.RELEASE</code>, the following command will update the Stream to use the <code>1.2.0.RELEASE</code> of the log application.
Before updating the stream with the specific version of the app, we need to make sure that the app is registered with that version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;app register --name log --type sink --uri maven://org.springframework.cloud.stream.app:log-sink-rabbit:1.2.0.RELEASE
Successfully registered application 'sink:log'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream update --name httptest --properties version.log=1.2.0.RELEASE</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only pre-registered application versions can be used to <code>deploy</code>, <code>update</code>, or <code>rollback</code> a stream.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To verify the deployment properties and the updated version, we can use <code>stream info</code>, as shown (with its output) in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream info httptest

             Name                          DSL                        Status            

httptest                      http --server.port=9000 | log deploying                   


Stream Deployment properties: {
  "log" : {
    "spring.cloud.deployer.indexed" : "true",
    "spring.cloud.deployer.count" : "1",
    "spring.cloud.deployer.group" : "httptest",
    "maven://org.springframework.cloud.stream.app:log-sink-rabbit" : "1.2.0.RELEASE"
  },
  "http" : {
    "spring.cloud.deployer.group" : "httptest",
    "maven://org.springframework.cloud.stream.app:http-source-rabbit" : "1.1.0.RELEASE"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-lifecycle-skipper-force-update"><a class="anchor" href="#spring-cloud-dataflow-stream-lifecycle-skipper-force-update"></a>29.4. Force update of a Stream</h3>
<div class="paragraph">
<p>When upgrading a stream, the <code>--force</code> option can be used to deploy new instances of currently deployed applications even if no applicaton or deployment properties have changed.
This behavior is needed in the case when configuration information is obtained by the application itself at startup time, for example from Spring Cloud Config Server.
You can specify which applications to force upgrade by using the option <code>--app-names</code>.
If you do not specify any application names, all the applications will be force upgraded.
You can specify <code>--force</code> and <code>--app-names</code> options together with <code>--properties</code> or <code>--propertiesFile</code> options.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stream_versions"><a class="anchor" href="#_stream_versions"></a>29.5. Stream versions</h3>
<div class="paragraph">
<p>Skipper keeps a history of the streams that were deployed.
After updating a Stream, there will be a second version of the stream.
You can query for the history of the versions using the command <code>stream history --name &lt;name-of-stream&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream history --name httptest

Version        Last updated         Status Package NamePackage Version  Description   

2      Mon Nov 27 22:41:16 EST 2017DEPLOYEDhttptest    1.0.0          Upgrade complete
1      Mon Nov 27 22:40:41 EST 2017DELETED httptest    1.0.0          Delete complete 
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stream_manifests"><a class="anchor" href="#_stream_manifests"></a>29.6. Stream Manifests</h3>
<div class="paragraph">
<p>Skipper keeps a &#8220;manifest&#8221; of the all the applications, their application properties, and their deployment properties after all values have been substituted.
This represents the final state of what was deployed to the platform.
You can view the manifest for any of the versions of a Stream by using the following command:</p>
</div>
<div class="paragraph">
<p><code>stream manifest --name &lt;name-of-stream&gt; --releaseVersion &lt;optional-version&gt;</code></p>
</div>
<div class="paragraph">
<p>If the <code>--releaseVersion</code> is not specified, the manifest for the last version is returned.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of the manifest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream manifest --name httptest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the command results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># Source: log.yml
apiVersion: skipper.spring.io/v1
kind: SpringCloudDeployerApplication
metadata:
  name: log
spec:
  resource: maven://org.springframework.cloud.stream.app:log-sink-rabbit
  version: 1.2.0.RELEASE
  applicationProperties:
    spring.metrics.export.triggers.application.includes: integration**
    spring.cloud.dataflow.stream.app.label: log
    spring.cloud.stream.metrics.key: httptest.log.${spring.cloud.application.guid}
    spring.cloud.stream.bindings.input.group: httptest
    spring.cloud.stream.metrics.properties: spring.application.name,spring.application.index,spring.cloud.application.*,spring.cloud.dataflow.*
    spring.cloud.dataflow.stream.name: httptest
    spring.cloud.dataflow.stream.app.type: sink
    spring.cloud.stream.bindings.input.destination: httptest.http
  deploymentProperties:
    spring.cloud.deployer.indexed: true
    spring.cloud.deployer.group: httptest
    spring.cloud.deployer.count: 1

---
# Source: http.yml
apiVersion: skipper.spring.io/v1
kind: SpringCloudDeployerApplication
metadata:
  name: http
spec:
  resource: maven://org.springframework.cloud.stream.app:http-source-rabbit
  version: 1.2.0.RELEASE
  applicationProperties:
    spring.metrics.export.triggers.application.includes: integration**
    spring.cloud.dataflow.stream.app.label: http
    spring.cloud.stream.metrics.key: httptest.http.${spring.cloud.application.guid}
    spring.cloud.stream.bindings.output.producer.requiredGroups: httptest
    spring.cloud.stream.metrics.properties: spring.application.name,spring.application.index,spring.cloud.application.*,spring.cloud.dataflow.*
    server.port: 9000
    spring.cloud.stream.bindings.output.destination: httptest.http
    spring.cloud.dataflow.stream.name: httptest
    spring.cloud.dataflow.stream.app.type: source
  deploymentProperties:
    spring.cloud.deployer.group: httptest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The majority of the deployment and application properties were set by Data Flow to enable the applications to talk to each other and to send application metrics with identifying labels.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-lifecycle-skipper-rollback"><a class="anchor" href="#spring-cloud-dataflow-stream-lifecycle-skipper-rollback"></a>29.7. Rollback a Stream</h3>
<div class="paragraph">
<p>You can rollback to a previous version of the stream using the command <code>stream rollback</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream rollback --name httptest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional <code>--releaseVersion</code> command argument adds the version of the stream.
If not specified, the rollback goes to the previous stream version.</p>
</div>
</div>
<div class="sect2">
<h3 id="_application_count"><a class="anchor" href="#_application_count"></a>29.8. Application Count</h3>
<div class="paragraph">
<p>The application count is a dynamic property of the system.
If, due to scaling at runtime, the application to be upgraded has 5 instances running, then 5 instances of the upgraded application are deployed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_skipper_s_upgrade_strategy"><a class="anchor" href="#_skipper_s_upgrade_strategy"></a>29.9. Skipper&#8217;s Upgrade Strategy</h3>
<div class="paragraph">
<p>Skipper has a simple 'red/black' upgrade strategy.  It deploys the new version of the applications, using as many instances as the currently running version, and checks the <code>/health</code> endpoint of the application.
If the health of the new application is good, then the previous application is undeployed.
If the health of the new application is bad, then all new applications are undeployed and the upgrade is considered to be not successful.</p>
</div>
<div class="paragraph">
<p>The upgrade strategy is not a rolling upgrade, so if five applications of the application are running, then in a sunny-day scenario, five of the new applications are also running before the older version is undeployed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stream_dsl"><a class="anchor" href="#_stream_dsl"></a>30. Stream DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers additional features of the Stream DSL not covered in the  <a href="#spring-cloud-dataflow-stream-intro-dsl">Stream DSL introduction</a>.</p>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-dsl-tap"><a class="anchor" href="#spring-cloud-dataflow-stream-dsl-tap"></a>30.1. Tap a Stream</h3>
<div class="paragraph">
<p>Taps can be created at various producer endpoints in a stream. For a stream such as that defined in the following example, taps can be created at the output of <code>http</code>, <code>step1</code> and <code>step2</code>:</p>
</div>
<div class="paragraph">
<p><code>stream create --definition "http | step1: transform --expression=payload.toUpperCase() | step2: transform --expression=payload+'!' | log" --name mainstream --deploy</code></p>
</div>
<div class="paragraph">
<p>To create a stream that acts as a 'tap' on another stream requires specifying the <code>source destination name</code> for the tap stream. The syntax for the source destination name is as follows:</p>
</div>
<div class="paragraph">
<p><code>:&lt;streamName&gt;.&lt;label/appName&gt;</code></p>
</div>
<div class="paragraph">
<p>To create a tap at the output of <code>http</code> in the preceding stream, the source destination name is <code>mainstream.http</code>
To create a tap at the output of the first transform app in the stream above, the source destination name is <code>mainstream.step1</code></p>
</div>
<div class="paragraph">
<p>The tap stream DSL resembles the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>stream create --definition ":mainstream.http &gt; counter" --name tap_at_http --deploy

stream create --definition ":mainstream.step1 &gt; jdbc" --name tap_at_step1_transformer --deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the colon (<code>:</code>) prefix before the destination names. The colon lets the parser recognize this as a destination name instead of an app name.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-dsl-labels"><a class="anchor" href="#spring-cloud-dataflow-stream-dsl-labels"></a>30.2. Using Labels in a Stream</h3>
<div class="paragraph">
<p>When a stream is made up of multiple apps with the same name, they must be qualified with labels:
<code>stream create --definition "http | firstLabel: transform --expression=payload.toUpperCase() | secondLabel: transform --expression=payload+'!' | log" --name myStreamWithLabels --deploy</code></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-dsl-named-destinations"><a class="anchor" href="#spring-cloud-dataflow-stream-dsl-named-destinations"></a>30.3. Named Destinations</h3>
<div class="paragraph">
<p>Instead of referencing a source or sink application, you can use a named destination.
A named destination corresponds to a specific destination name in the middleware broker (Rabbit, Kafka, and others).
When using the <code>|</code> symbol, applications are connected to each other with messaging middleware destination names created by the Data Flow server.
In keeping with the Unix analogy, one can redirect standard input and output using the less-than (<code>&lt;</code>) and greater-than (<code>&gt;</code>) characters.
To specify the name of the destination, prefix it with a colon (<code>:</code>).
For example, the following stream has the destination name in the <code>source</code> position:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt;stream create --definition ":myDestination &gt; log" --name ingest_from_broker --deploy</code></p>
</div>
<div class="paragraph">
<p>This stream receives messages from the destination called <code>myDestination</code>, located at the broker, and connects it to the <code>log</code> app. You can also create additional streams that consume data from the same named destination.</p>
</div>
<div class="paragraph">
<p>The following stream has the destination name in the <code>sink</code> position:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt;stream create --definition "http &gt; :myDestination" --name ingest_to_broker --deploy</code></p>
</div>
<div class="paragraph">
<p>It is also possible to connect two different destinations (<code>source</code> and <code>sink</code> positions) at the broker in a stream, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt;stream create --definition ":destination1 &gt; :destination2" --name bridge_destinations --deploy</code></p>
</div>
<div class="paragraph">
<p>In the preceding stream, both the destinations (<code>destination1</code> and <code>destination2</code>) are located in the broker. The messages flow from the source destination to the sink destination over a <code>bridge</code> app that connects them.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-dsl-fanin-fanout"><a class="anchor" href="#spring-cloud-dataflow-stream-dsl-fanin-fanout"></a>30.4. Fan-in and Fan-out</h3>
<div class="paragraph">
<p>By using named destinations, you can support fan-in and fan-out use cases.  Fan-in use cases are when multiple sources all send data to the same named destination, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>s3 &gt; :data
ftp &gt; :data
http &gt; :data</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example directs the data payloads from the Amazon S3, FTP, and HTTP sources to the same named destination called <code>data</code>. Then an additional stream created with the following DSL expression would have all the data from those three sources sent to the file sink:</p>
</div>
<div class="paragraph">
<p><code>:data &gt; file</code></p>
</div>
<div class="paragraph">
<p>The fan-out use case is when you determine the destination of a stream based on some information that is only known at runtime.
In this case, the <a href="{scs-app-starters-docs}/spring-cloud-stream-modules-sinks.html#spring-cloud-stream-modules-router-sink">Router Application</a> can be used to specify how to direct the incoming message to one of N named destinations.</p>
</div>
<div class="paragraph">
<p>A nice <a href="https://youtu.be/l8SgHtP5QCI">Video</a> showing Fan-in and Fan-out behavior is also available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-stream-java-dsl"><a class="anchor" href="#spring-cloud-dataflow-stream-java-dsl"></a>31. Stream Java DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of using the shell to create and deploy streams, you can use the Java-based DSL provided by the <code>spring-cloud-dataflow-rest-client</code> module.
The Java DSL is a convenient wrapper around the <code>DataFlowTemplate</code> class that enables creating and deploying streams programmatically.</p>
</div>
<div class="paragraph">
<p>To get started, you need to add the following dependency to your project, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
	&lt;artifactId&gt;spring-cloud-dataflow-rest-client&lt;/artifactId&gt;
	&lt;version&gt;1.7.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A complete sample can be found in the <a href="https://github.com/spring-cloud/spring-cloud-dataflow-samples">Spring Cloud Data Flow Samples Repository</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>31.1. Overview</h3>
<div class="paragraph">
<p>The classes at the heart of the Java DSL are <code>StreamBuilder</code>, <code>StreamDefinition</code>, <code>Stream</code>,  <code>StreamApplication</code>, and <code>DataFlowTemplate</code>.
The entry point is a <code>builder</code> method on <code>Stream</code> that takes an instance of a <code>DataFlowTemplate</code>.
To create an instance of a <code>DataFlowTemplate</code>, you need to provide a <code>URI</code> location of the Data Flow Server.</p>
</div>
<div class="paragraph">
<p>Spring Boot auto-configuration for <code>StreamBuilder</code> and <code>DataFlowTemplate</code> is also available.  The properties in <a href="https://github.com/spring-cloud/spring-cloud-dataflow/blob/master/spring-cloud-dataflow-rest-client/src/main/java/org/springframework/cloud/dataflow/rest/client/config/DataFlowClientProperties.java">DataFlowClientProperties</a> can be used to configure the connection to the Data Flow server.  The common property to start using is <code>spring.cloud.dataflow.client.uri</code></p>
</div>
<div class="paragraph">
<p>Consider the following example, using the <code>definition</code> style.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">URI dataFlowUri = URI.create("http://localhost:9393");
DataFlowOperations dataFlowOperations = new DataFlowTemplate(dataFlowUri);
dataFlowOperations.appRegistryOperations().importFromResource(
                     "http://bit.ly/Darwin-SR3-stream-applications-rabbit-maven", true);
StreamDefinition streamDefinition = Stream.builder(dataFlowOperations)
                                      .name("ticktock")
                                      .definition("time | log")
                                      .create();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>create</code> method returns an instance of a <code>StreamDefinition</code> representing a Stream that has been created but not deployed.
This is called the <code>definition</code> style since it takes a single string for the stream definition, same as in the shell.
If applications have not yet been registered in the Data Flow server, you can use the <code>DataFlowOperations</code> class to register them.
With the <code>StreamDefinition</code> instance, you have methods available to <code>deploy</code> or <code>destory</code> the stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Stream stream = streamDefinition.deploy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Stream</code> instance provides <code>getStatus</code>, <code>destroy</code> and <code>undeploy</code> methods to control and query the stream.
If you are going to immediately deploy the stream, there is no need to create a separate local variable of the type <code>StreamDefinition</code>.  You can just chain the calls together, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">Stream stream = Stream.builder(dataFlowOperations)
                  .name("ticktock")
                  .definition("time | log")
                  .create()
                  .deploy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>deploy</code> method is overloaded to take a <code>java.util.Map</code> of deployment properties.</p>
</div>
<div class="paragraph">
<p>The <code>StreamApplication</code> class is used in the 'fluent' Java DSL style and is discussed in the next section. The <code>StreamBuilder</code> class is returned from the method <code>Stream.builder(dataFlowOperations)</code>. In larger applications, it is common to create a single instance of the <code>StreamBuilder</code> as a Spring <code>@Bean</code> and share it across the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_java_dsl_styles"><a class="anchor" href="#_java_dsl_styles"></a>31.2. Java DSL styles</h3>
<div class="paragraph">
<p>The Java DSL offers two styles to create Streams.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>definition</code> style keeps the feel of using the pipes and filters textual DSL in the shell. This style is selected by using the <code>definition</code> method after setting the stream name - for example, <code>Stream.builder(dataFlowOperations).name("ticktock").definition(&lt;definition goes here&gt;)</code>.</p>
</li>
<li>
<p>The <code>fluent</code> style lets you chain together sources, processors, and sinks by passing in an instance of a <code>StreamApplication</code>. This style is selected by using the <code>source</code> method after setting the stream name - for example, <code>Stream.builder(dataFlowOperations).name("ticktock").source(&lt;stream application instance goes here&gt;)</code>. You then chain together <code>processor()</code> and <code>sink()</code> methods to create a stream definition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To demonstrate both styles, we include a simple stream that uses both approaches.
A complete sample for you to get started can be found in the <a href="https://github.com/spring-cloud/spring-cloud-dataflow-samples">Spring Cloud Data Flow Samples Repository</a>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the definition approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public void definitionStyle() throws Exception{

  Map&lt;String, String&gt; deploymentProperties = createDeploymentProperties();

  Stream woodchuck = Stream.builder(dataFlowOperations)
          .name("woodchuck")
          .definition("http --server.port=9900 | splitter --expression=payload.split(' ') | log")
          .create()
          .deploy(deploymentProperties);

  waitAndDestroy(woodchuck)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example demonstrates the fluent approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">private void fluentStyle(DataFlowOperations dataFlowOperations) throws InterruptedException {

  logger.info("Deploying stream.");

  Stream woodchuck = builder
    .name("woodchuck")
    .source(source)
    .processor(processor)
    .sink(sink)
    .create()
    .deploy();

  waitAndDestroy(woodchuck);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>waitAndDestroy</code> method uses the <code>getStatus</code> method to poll for the stream&#8217;s status, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">private void waitAndDestroy(Stream stream) throws InterruptedException {

  while(!stream.getStatus().equals("deployed")){
    System.out.println("Wating for deployment of stream.");
    Thread.sleep(5000);
  }

  System.out.println("Letting the stream run for 2 minutes.");
  // Let the stream run for 2 minutes
  Thread.sleep(120000);

  System.out.println("Destroying stream");
  stream.destroy();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the definition style, the deployment properties are specified as a <code>java.util.Map</code> in the same manner as using the shell. The <code>createDeploymentProperties</code> method is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">private Map&lt;String, String&gt; createDeploymentProperties() {
  DeploymentPropertiesBuilder propertiesBuilder = new DeploymentPropertiesBuilder();
  propertiesBuilder.memory("log", 512);
  propertiesBuilder.count("log",2);
  propertiesBuilder.put("app.splitter.producer.partitionKeyExpression", "payload");
  return propertiesBuilder.build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Is this case, application properties are also overridden at deployment time in addition to setting the deployer property <code>count</code> for the log application.
When using the fluent style, the deployment properties are added by using the method <code>addDeploymentProperty</code> (for example, <code>new StreamApplication("log").addDeploymentProperty("count", 2)</code>), and you do not need to prefix the property with <code>deployer.&lt;app_name&gt;</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to create and deploy your streams, you need to make sure that the corresponding apps have been registered in the DataFlow server first.
Attempting to create or deploy a stream that contains an unknown app throws an exception. You can register your application by using the <code>DataFlowTemplate</code>, as follows:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">dataFlowOperations.appRegistryOperations().importFromResource(
            "http://bit.ly/Darwin-SR3-stream-applications-rabbit-maven", true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Stream applications can also be beans within your application that are injected in other classes to create Streams.
There are many ways to structure Spring applications, but one way is to have an <code>@Configuration</code> class define the <code>StreamBuilder</code> and <code>StreamApplications</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Configuration
public class StreamConfiguration {

  @Bean
  public StreamBuilder builder() {
    return Stream.builder(new DataFlowTemplate(URI.create("http://localhost:9393")));
  }

  @Bean
  public StreamApplication httpSource(){
    return new StreamApplication("http");
  }

  @Bean
  public StreamApplication logSink(){
    return new StreamApplication("log");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in another class you can <code>@Autowire</code> these classes and deploy a stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Component
public class MyStreamApps {

  @Autowired
  private StreamBuilder streamBuilder;

  @Autowired
  private StreamApplication httpSource;

  @Autowired
  private StreamApplication logSink;


  public void deploySimpleStream() {
    Stream simpleStream = streamBuilder.name("simpleStream")
                            .source(httpSource)
                            .sink(logSink)
                            .create()
                            .deploy();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This style lets you share <code>StreamApplications</code> across multiple Streams.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_deploymentpropertiesbuilder"><a class="anchor" href="#_using_the_deploymentpropertiesbuilder"></a>31.3. Using the DeploymentPropertiesBuilder</h3>
<div class="paragraph">
<p>Regardless of style you choose, the <code>deploy(Map&lt;String, String&gt; deploymentProperties)</code> method allows customization of how your streams will be deployed. We made it a easier to create a map with properties by using a builder style, as well as creating static methods for some properties so you don&#8217;t need to remember the name of such properties. If you take the previous example of <code>createDeploymentProperties</code> it could be rewritten as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">private Map&lt;String, String&gt; createDeploymentProperties() {
	return new DeploymentPropertiesBuilder()
		.count("log", 2)
		.memory("log", 512)
		.put("app.splitter.producer.partitionKeyExpression", "payload")
		.build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This utility class is meant to help with the creation of a Map and adds a few methods to assist with defining pre-defined properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_using_skipper"><a class="anchor" href="#_deploying_using_skipper"></a>31.4. Deploying using Skipper</h3>
<div class="paragraph">
<p>If you desire to deploy your streams using Skipper, you need to pass certain properties to the server specific to a Skipper based deployment, for example selecting the target platfrom.
The <code>SkipperDeploymentPropertiesBuilder</code> provides you all the properties in <code>DeploymentPropertiesBuilder</code> and adds those needed for Skipper.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">private Map&lt;String, String&gt; createDeploymentProperties() {
	return new SkipperDeploymentPropertiesBuilder()
		.count("log", 2)
		.memory("log", 512)
		.put("app.splitter.producer.partitionKeyExpression", "payload")
		.platformName("pcf")
		.build();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-stream-multi-binder"><a class="anchor" href="#spring-cloud-dataflow-stream-multi-binder"></a>32. Stream Applications with Multiple Binder Configurations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases, a stream can have its applications bound to multiple spring cloud stream binders when they are required to connect to different messaging
middleware configurations. In those cases, it is important to make sure the applications are configured appropriately with their binder
configurations. For example, a multi-binder transformer that supports both Kafka and Rabbit binders is the processor in the following stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>http | multibindertransform --expression=payload.toUpperCase() | log</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the example above you would write your own multibindertransform application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this stream, each application connects to messaging middleware in the following way:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The HTTP source sends events to RabbitMQ (<code>rabbit1</code>).</p>
</li>
<li>
<p>The Multi-Binder Transform processor receives events from RabbitMQ (<code>rabbit1</code>) and sends the processed events into Kafka (<code>kafka1</code>).</p>
</li>
<li>
<p>The log sink receives events from Kafka (<code>kafka1</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here, <code>rabbit1</code> and <code>kafka1</code> are the binder names given in the spring cloud stream application properties.
Based on this setup, the applications have the following binder(s) in their classpath with the appropriate configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP: Rabbit binder</p>
</li>
<li>
<p>Transform: Both Kafka and Rabbit binders</p>
</li>
<li>
<p>Log: Kafka binder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The spring-cloud-stream <code>binder</code> configuration properties can be set within the applications themselves.
If not, they can be passed through <code>deployment</code> properties when the stream is deployed as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream create --definition "http | multibindertransform --expression=payload.toUpperCase() | log" --name mystream

dataflow:&gt;stream deploy mystream --properties "app.http.spring.cloud.stream.bindings.output.binder=rabbit1,app.multibindertransform.spring.cloud.stream.bindings.input.binder=rabbit1,
app.multibindertransform.spring.cloud.stream.bindings.output.binder=kafka1,app.log.spring.cloud.stream.bindings.input.binder=kafka1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>One can override any of the binder configuration properties by specifying them through deployment properties.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-stream-examples"><a class="anchor" href="#spring-cloud-dataflow-stream-examples"></a>33. Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter includes the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spring-cloud-dataflow-simple-stream">Simple Stream Processing</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-stream-partitions">Stateful Stream Processing</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-stream-app-types">Other Source and Sink Application Types</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find links to more samples in the &#8220;<a href="#dataflow-samples">[dataflow-samples]</a>&#8221; chapter.</p>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-simple-stream"><a class="anchor" href="#spring-cloud-dataflow-simple-stream"></a>33.1. Simple Stream Processing</h3>
<div class="paragraph">
<p>As an example of a simple processing step, we can transform the payload of the HTTP posted data to upper case by using the following stream definition:
<code>http | transform --expression=payload.toUpperCase() | log</code></p>
</div>
<div class="paragraph">
<p>To create this stream enter the following command in the shell</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt; stream create --definition "http --server.port=9000 | transform --expression=payload.toUpperCase() | log" --name mystream --deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example uses a shell command to post some data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt; http post --target http://localhost:9000 --data "hello"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example results in an upper-case 'HELLO' in the log, as follows:</p>
</div>
<div class="paragraph">
<p><code>2016-06-01 09:54:37.749  INFO 80083 --- [  kafka-binder-] log.sink    : HELLO</code></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-partitions"><a class="anchor" href="#spring-cloud-dataflow-stream-partitions"></a>33.2. Stateful Stream Processing</h3>
<div class="paragraph">
<p>To demonstrate the data partitioning functionality, the following listing deploys a stream with Kafka as the binder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;stream create --name words --definition "http --server.port=9900 | splitter --expression=payload.split(' ') | log"
Created new stream 'words'

dataflow:&gt;stream deploy words --properties "app.splitter.producer.partitionKeyExpression=payload,deployer.log.count=2"
Deployed stream 'words'

dataflow:&gt;http post --target http://localhost:9900 --data "How much wood would a woodchuck chuck if a woodchuck could chuck wood"
&gt; POST (text/plain;Charset=UTF-8) http://localhost:9900 How much wood would a woodchuck chuck if a woodchuck could chuck wood
&gt; 202 ACCEPTED</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should then see the following in the server logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2016-06-05 18:33:24.982  INFO 58039 --- [nio-9393-exec-9] o.s.c.d.spi.local.LocalAppDeployer       : deploying app words.log instance 0
   Logs will be in /var/folders/c3/ctx7_rns6x30tq7rb76wzqwr0000gp/T/spring-cloud-dataflow-694182453710731989/words-1465176804970/words.log
2016-06-05 18:33:24.988  INFO 58039 --- [nio-9393-exec-9] o.s.c.d.spi.local.LocalAppDeployer       : deploying app words.log instance 1
   Logs will be in /var/folders/c3/ctx7_rns6x30tq7rb76wzqwr0000gp/T/spring-cloud-dataflow-694182453710731989/words-1465176804970/words.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you review the <code>words.log instance 0</code> logs, you should see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2016-06-05 18:35:47.047  INFO 58638 --- [  kafka-binder-] log.sink                                 : How
2016-06-05 18:35:47.066  INFO 58638 --- [  kafka-binder-] log.sink                                 : chuck
2016-06-05 18:35:47.066  INFO 58638 --- [  kafka-binder-] log.sink                                 : chuck</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you review the <code>words.log instance 1</code> logs, you shoul see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2016-06-05 18:35:47.047  INFO 58639 --- [  kafka-binder-] log.sink                                 : much
2016-06-05 18:35:47.066  INFO 58639 --- [  kafka-binder-] log.sink                                 : wood
2016-06-05 18:35:47.066  INFO 58639 --- [  kafka-binder-] log.sink                                 : would
2016-06-05 18:35:47.066  INFO 58639 --- [  kafka-binder-] log.sink                                 : a
2016-06-05 18:35:47.066  INFO 58639 --- [  kafka-binder-] log.sink                                 : woodchuck
2016-06-05 18:35:47.067  INFO 58639 --- [  kafka-binder-] log.sink                                 : if
2016-06-05 18:35:47.067  INFO 58639 --- [  kafka-binder-] log.sink                                 : a
2016-06-05 18:35:47.067  INFO 58639 --- [  kafka-binder-] log.sink                                 : woodchuck
2016-06-05 18:35:47.067  INFO 58639 --- [  kafka-binder-] log.sink                                 : could
2016-06-05 18:35:47.067  INFO 58639 --- [  kafka-binder-] log.sink                                 : wood</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example has shown that payload splits that contain the same word are routed to the same application instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-stream-app-types"><a class="anchor" href="#spring-cloud-dataflow-stream-app-types"></a>33.3. Other Source and Sink Application Types</h3>
<div class="paragraph">
<p>This example shows something a bit more complicated: swapping out the <code>time</code> source for something else. Another supported source type is <code>http</code>, which accepts data for ingestion over HTTP POSTs. Note that the <code>http</code> source accepts data on a different port from the Data Flow Server (default 8080). By default, the port is randomly assigned.</p>
</div>
<div class="paragraph">
<p>To create a stream using an <code>http</code> source but still using the same <code>log</code> sink, we would change the original command in the <a href="#spring-cloud-dataflow-simple-stream">Simple Stream Processing</a> example to the following:</p>
</div>
<div class="paragraph">
<p>`dataflow:&gt; stream create --definition "http | log" --name myhttpstream --deploy</p>
</div>
<div class="paragraph">
<p>The preceding command produces the following output from the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2016-06-01 09:47:58.920  INFO 79016 --- [io-9393-exec-10] o.s.c.d.spi.local.LocalAppDeployer       : deploying app myhttpstream.log instance 0
   Logs will be in /var/folders/wn/8jxm_tbd1vj28c8vj37n900m0000gn/T/spring-cloud-dataflow-912434582726479179/myhttpstream-1464788878747/myhttpstream.log
2016-06-01 09:48:06.396  INFO 79016 --- [io-9393-exec-10] o.s.c.d.spi.local.LocalAppDeployer       : deploying app myhttpstream.http instance 0
   Logs will be in /var/folders/wn/8jxm_tbd1vj28c8vj37n900m0000gn/T/spring-cloud-dataflow-912434582726479179/myhttpstream-1464788886383/myhttpstream.http</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we do not see any other output this time until we actually post some data (by using a shell command). In order to see the randomly assigned port on which the http source is listening, run the following command:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; runtime apps</code></p>
</div>
<div class="paragraph">
<p>You should see that the corresponding <code>http</code> source has a <code>url</code> property containing the host and port information on which it is listening. You are now ready to post to that url, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt; http post --target http://localhost:1234 --data "hello"
dataflow:&gt; http post --target http://localhost:1234 --data "goodbye"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The stream then funnels the data from the http source to the output log implemented by the log sink, yielding output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2016-06-01 09:50:22.121  INFO 79654 --- [  kafka-binder-] log.sink    : hello
2016-06-01 09:50:26.810  INFO 79654 --- [  kafka-binder-] log.sink    : goodbye</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also change the sink implementation. You could pipe the output to a file (<code>file</code>), to hadoop (<code>hdfs</code>), or to any of the other sink applications that are available. You can also define your own applications.</p>
</div>
</div>
</div>
</div>
<h1 id="streams-using-skipper" class="sect0"><a class="anchor" href="#streams-using-skipper"></a>Deploying Streams by Using Skipper</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section assumes that Spring Cloud Data Flow, <a href="#spring-cloud-skipper-integration">Spring Cloud Skipper</a>, an RDBMS, and your desired messaging  middleware is up and running in minikube. We use RabbitMQ as the messaging middleware. The same concepts and steps apply for Kafka. <a href="#getting-started-create-stream-without-skipper">Create Streams without Skipper</a> describes how to use Kafka-based Docker images.</p>
</div>
<div class="paragraph">
<p>Before you get started, you can see what applications are running. The following example (with output) shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">$ kubectl get all
NAME                              READY     STATUS    RESTARTS   AGE
po/mysql-777890292-z0dsw          1/1       Running   0          38m
po/rabbitmq-317767540-2qzrr       1/1       Running   0          38m
po/redis-4054078334-37m0l         1/1       Running   0          38m
po/scdf-server-2734071167-bjd3g   1/1       Running   0          48s
po/skipper-2408247821-50z31       1/1       Running   0          3m

...
...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to start the Data Flow Shell for the Data Flow server running in <code>skipper</code> mode:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ java -jar spring-cloud-dataflow-shell-1.7.4.RELEASE.jar --dataflow.mode=skipper</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the Data Flow Server and shell do not run on the same host, point the shell to the Data Flow server URL. To do so, you can use the <code>kubectl get svc scdf-server</code> command to locate the EXTERNAL-IP address assigned to <code>scdf-server</code> and use that to connect from the shell. The following example (with output) shows how to get the external IP address (and other details):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl get svc scdf-server
NAME         CLUSTER-IP       EXTERNAL-IP       PORT(S)    AGE
scdf-server  10.103.246.82    130.211.203.246   80/TCP     4m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the URL to use is <a href="http://130.211.203.246" class="bare">130.211.203.246</a></p>
</div>
<div class="paragraph">
<p>If you use Minikube, you do not have an external load balancer and the EXTERNAL-IP column shows <code>&lt;pending&gt;</code>. You need to use the NodePort assigned for the <code>skipper</code> service. The following example (with output) shows how to look up the URL to use:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ minikube service --url scdf-server
http://192.168.99.100:31991</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example (with output) shows how to configure the Data Flow server URI (with the default user and password settings):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">server-unknown:&gt;dataflow config server --username user --password password --uri http://130.211.203.246
Successfully targeted http://130.211.203.246
dataflow:&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <code>--dataflow.uri</code> command line option.  The shell&#8217;s <code>--help</code> command line option shows what is available.</p>
</div>
<div class="paragraph">
<p>Then you can verify the registered platforms in Skipper, as the following example (with output) shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">dataflow:&gt;stream platform-list

  Name     Type                                         Description                                               

minikubekubernetesmaster url = [https://kubernetes.default.svc/], namespace = [default], api version = [v1]       
</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We start by deploying a stream with the <code>time-source</code> pointing to the 1.3.0.RELEASE and <code>log-sink</code> pointing
to the 1.2.0.RELEASE. The goal is to perform a rolling upgrade of the <code>log-sink</code> application to 1.3.0.RELEASE. The following multi-step example (with output after each command) shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">dataflow:&gt;app register --type source --name time --uri docker://springcloudstream/time-source-rabbit:1.3.0.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:time-source-rabbit:jar:metadata:1.3.0.RELEASE
Successfully registered application 'source:time'

dataflow:&gt;app register --type sink --name log --uri docker://springcloudstream/log-sink-rabbit:1.2.0.RELEASE --metadata-uri maven://org.springframework.cloud.stream.app:log-sink-rabbit:jar:metadata:1.2.0.RELEASE
Successfully registered application 'sink:log'

dataflow:&gt;app info time --type source
Information about source application 'time':
Version: '1.3.0.RELEASE':
Default application version: 'true':
Resource URI: docker://springcloudstream/time-source-rabbit:1.3.0.RELEASE

         Option Name                   Description                     Default                         Type             

trigger.time-unit             The TimeUnit to apply to delay&lt;none&gt;                        java.util.concurrent.TimeUnit 
                              values.                                                                                   
trigger.fixed-delay           Fixed delay for periodic      1                             java.lang.Integer             
                              triggers.                                                                                 
trigger.cron                  Cron expression value for the &lt;none&gt;                        java.lang.String              
                              Cron Trigger.                                                                             
trigger.initial-delay         Initial delay for periodic    0                             java.lang.Integer             
                              triggers.                                                                                 
trigger.max-messages          Maximum messages per poll, -1 1                             java.lang.Long                
                              means infinity.                                                                           
trigger.date-format           Format for the date value.    &lt;none&gt;                        java.lang.String              


dataflow:&gt;app info log --type sink
Information about sink application 'log':
Version: '1.2.0.RELEASE':
Default application version: 'true':
Resource URI: docker://springcloudstream/log-sink-rabbit:1.2.0.RELEASE

         Option Name                   Description                     Default                         Type             

log.name                      The name of the logger to use.&lt;none&gt;                        java.lang.String              
log.level                     The level at which to log     &lt;none&gt;                        org.springframework.integratio
                              messages.                                                   n.handler.LoggingHandler$Level
log.expression                A SpEL expression (against thepayload                       java.lang.String              
                              incoming message) to evaluate                                                             
                              as the logged message.                                                                    
</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The remainder of this chapter describes the process for deploying streams with Skipper.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a stream.</p>
<div class="paragraph">
<p>The following example shows how to create a stream:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;stream create mystream --definition "time | log"
Created new stream 'mystream'</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Deploy the stream.</p>
<div class="paragraph">
<p>The following example shows how to deploy the stream:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;stream deploy mysteam --platformName minikube
Deployment request has been sent for stream 'mystream'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>NOTE:While deploying the stream, we supply <code>--platformName</code>, which indicates the platform repository (in this case, <code>minikube</code>) to
use when deploying the stream applications with Skipper.</p>
</div>
</li>
<li>
<p>List the pods.</p>
<div class="paragraph">
<p>The following command (with output) shows how to list the pods:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">$ kubectl get pods
NAME                              READY     STATUS    RESTARTS   AGE
mystream-log-v1-0-2k4r8             1/1       Running   0          2m
mystream-time-v1-qhdqq              1/1       Running   0          2m
mysql-777890292-z0dsw          1/1       Running   0          49m
rabbitmq-317767540-2qzrr       1/1       Running   0          49m
redis-4054078334-37m0l         1/1       Running   0          49m
scdf-server-2734071167-bjd3g   1/1       Running   0          12m
skipper-2408247821-50z31       1/1       Running   0          15m

...
...</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the logs.</p>
<div class="paragraph">
<p>The followig example shows how to make sure that the values you expect appear in the logs:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">$ kubectl logs -f mystream-log-v1-0-2k4r8
...
...
2017-10-30 22:59:04.966  INFO 1 --- [ mystream.time.mystream-1] log-sink                                 : 10/30/17 22:59:04
2017-10-30 22:59:05.968  INFO 1 --- [ mystream.time.mystream-1] log-sink                                 : 10/30/17 22:59:05
2017-10-30 22:59:07.000  INFO 1 --- [ mystream.time.mystream-1] log-sink                                 : 10/30/17 22:59:06</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the stream history.</p>
<div class="paragraph">
<p>The following example (with output) shows how to display the stream history, so that you can verify its content:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">dataflow:&gt;stream history --name mystream

Version        Last updated         Status Package NamePackage Version  Description   

1      Mon Oct 30 16:18:28 PDT 2017DEPLOYEDmystream    1.0.0          Install complete
</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the package manifest.</p>
<div class="paragraph">
<p>The <code>log-sink</code> should be at 1.2.0.RELEASE. The following example (with output) shows how to display the package manifest so that you can ensure the version of the <code>log-sink</code> application:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yml" data-lang="yml">dataflow:&gt;stream manifest --name mystream

---
# Source: log.yml
apiVersion: skipper.spring.io/v1
kind: SpringCloudDeployerApplication
metadata:
  "name": "log"
spec:
  resource: "docker:springcloudstream/log-sink-rabbit"
  resourceMetadata: "docker:springcloudstream/log-sink-rabbit:jar:metadata:1.2.0.RELEASE"
  version: "1.2.0.RELEASE"
  applicationProperties:
    "spring.metrics.export.triggers.application.includes": "integration**"
    "spring.cloud.dataflow.stream.app.label": "log"
    "spring.cloud.stream.metrics.key": "mystream.log.${spring.cloud.application.guid}"
    "spring.cloud.stream.bindings.input.group": "mystream"
    "spring.cloud.stream.metrics.properties": "spring.application.name,spring.application.index,spring.cloud.application.*,spring.cloud.dataflow.*"
    "spring.cloud.stream.bindings.applicationMetrics.destination": "metrics"
    "spring.cloud.dataflow.stream.name": "mystream"
    "spring.cloud.dataflow.stream.app.type": "sink"
    "spring.cloud.stream.bindings.input.destination": "mystream.time"
  deploymentProperties:
    "spring.cloud.deployer.group": "mystream"

---
# Source: time.yml
apiVersion: skipper.spring.io/v1
kind: SpringCloudDeployerApplication
metadata:
  "name": "time"
spec:
  resource: "docker:springcloudstream/time-source-rabbit"
  resourceMetadata: "docker:springcloudstream/time-source-rabbit:jar:metadata:1.3.0.RELEASE"
  version: "1.3.0.RELEASE"
  applicationProperties:
    "spring.metrics.export.triggers.application.includes": "integration**"
    "spring.cloud.dataflow.stream.app.label": "time"
    "spring.cloud.stream.metrics.key": "mystream.time.${spring.cloud.application.guid}"
    "spring.cloud.stream.bindings.output.producer.requiredGroups": "mystream"
    "spring.cloud.stream.metrics.properties": "spring.application.name,spring.application.index,spring.cloud.application.*,spring.cloud.dataflow.*"
    "spring.cloud.stream.bindings.applicationMetrics.destination": "metrics"
    "spring.cloud.stream.bindings.output.destination": "mystream.time"
    "spring.cloud.dataflow.stream.name": "mystream"
    "spring.cloud.dataflow.stream.app.type": "source"
  deploymentProperties:
    "spring.cloud.deployer.group": "mystream"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Register the <code>log-sink</code> application version 1.3.0.RELEASE and update your stream to use it</p>
<div class="paragraph">
<p>The following example (with output after each command) shows how to register the <code>log-sink</code> application and update its version:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">dataflow:&gt;app register --name log --type sink --uri docker:springcloudstream/log-sink-rabbit:1.3.0.RELEASE --force
Successfully registered application 'sink:log'

dataflow:&gt;stream update --name mystream --properties version.log=1.3.0.RELEASE
Update request has been sent for stream 'mystream'</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>List the pods again.</p>
<div class="paragraph">
<p>The following example (with output) shows how to list the pods, so that you can see your application in the list:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">$ kubectl get pods
NAME                              READY     STATUS        RESTARTS   AGE
mystream-log-v1-0-2k4r8        1/1       Terminating   0          3m
mystream-log-v2-0-fjnlt        0/1       Running       0          9s
mystream-time-v1-qhdqq         1/1       Running       0          3m
mysql-777890292-z0dsw          1/1       Running       0          51m
rabbitmq-317767540-2qzrr       1/1       Running       0          51m
redis-4054078334-37m0l         1/1       Running       0          51m
scdf-server-2734071167-bjd3g   1/1       Running       0          14m
skipper-2408247821-50z31       1/1       Running       0          16m

...
...</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The list shows two versions of the <code>log-sink</code> applications. The <code>mystream-log-v1-0-2k4r8</code> pod is going down and the
newly spawned <code>mystream-log-v2-0-fjnlt</code> pod is bootstrapping. The version number is incremented and the version-number
(<code>v2</code>) is included in the new application name.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Once the new pod is up and running, you can verify the logs.</p>
<div class="paragraph">
<p>The following example shows how to display the logs so that you can verify their content:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">$ kubectl logs -f mystream-log-v2-0-fjnlt
...
...
2017-10-30 23:24:30.016  INFO 1 --- [ mystream.time.mystream-1] log-sink                                 : 10/30/17 23:24:30
2017-10-30 23:24:31.017  INFO 1 --- [ mystream.time.mystream-1] log-sink                                 : 10/30/17 23:24:31
2017-10-30 23:24:32.018  INFO 1 --- [ mystream.time.mystream-1] log-sink                                 : 10/30/17 23:24:32</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>View the updated package manifest persisted in Skipper. You should now see <code>log-sink</code> at 1.3.0.RELEASE.</p>
<div class="paragraph">
<p>The following example (with output) shows how to view the updated package manifest:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yml" data-lang="yml">dataflow:&gt;stream manifest --name mystream

---
# Source: log.yml
apiVersion: skipper.spring.io/v1
kind: SpringCloudDeployerApplication
metadata:
  "name": "log"
spec:
  resource: "docker:springcloudstream/log-sink-rabbit"
  resourceMetadata: "docker:springcloudstream/log-sink-rabbit:jar:metadata:1.3.0.RELEASE"
  version: "1.3.0.RELEASE"
  applicationProperties:
    "spring.metrics.export.triggers.application.includes": "integration**"
    "spring.cloud.dataflow.stream.app.label": "log"
    "spring.cloud.stream.metrics.key": "mystream.log.${spring.cloud.application.guid}"
    "spring.cloud.stream.bindings.input.group": "mystream"
    "spring.cloud.stream.metrics.properties": "spring.application.name,spring.application.index,spring.cloud.application.*,spring.cloud.dataflow.*"
    "spring.cloud.stream.bindings.applicationMetrics.destination": "metrics"
    "spring.cloud.dataflow.stream.name": "mystream"
    "spring.cloud.dataflow.stream.app.type": "sink"
    "spring.cloud.stream.bindings.input.destination": "mystream.time"
  deploymentProperties:
    "spring.cloud.deployer.group": "mystream"
    "spring.cloud.deployer.count": "1"

---
# Source: time.yml
apiVersion: skipper.spring.io/v1
kind: SpringCloudDeployerApplication
metadata:
  "name": "time"
spec:
  resource: "docker:springcloudstream/time-source-rabbit"
  resourceMetadata: "docker:springcloudstream/time-source-rabbit:jar:metadata:1.3.0.RELEASE"
  version: "1.3.0.RELEASE"
  applicationProperties:
    "spring.metrics.export.triggers.application.includes": "integration**"
    "spring.cloud.dataflow.stream.app.label": "time"
    "spring.cloud.stream.metrics.key": "mystream.time.${spring.cloud.application.guid}"
    "spring.cloud.stream.bindings.output.producer.requiredGroups": "mystream"
    "spring.cloud.stream.metrics.properties": "spring.application.name,spring.application.index,spring.cloud.application.*,spring.cloud.dataflow.*"
    "spring.cloud.stream.bindings.applicationMetrics.destination": "metrics"
    "spring.cloud.stream.bindings.output.destination": "mystream.time"
    "spring.cloud.dataflow.stream.name": "mystream"
    "spring.cloud.dataflow.stream.app.type": "source"
  deploymentProperties:
    "spring.cloud.deployer.group": "mystream"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Verify stream history for the latest updates.</p>
<div class="paragraph">
<p>The following example (with output) shows how to display the version history of your stream so that you can verify the version:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">dataflow:&gt;stream history --name mystream

Version        Last updated         Status Package NamePackage Version  Description   

2      Mon Oct 30 16:21:55 PDT 2017DEPLOYEDmystream    1.0.0          Upgrade complete
1      Mon Oct 30 16:18:28 PDT 2017DELETED mystream    1.0.0          Delete complete 
</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rolling_back_to_a_previous_version"><a class="anchor" href="#_rolling_back_to_a_previous_version"></a>34. Rolling back to a Previous Version</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Skipper includes a <code>rollback</code> command so that you can roll back to a previous version.
The following example (with output) shows how to use it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-console" data-lang="console">dataflow:&gt;stream rollback --name mystream
Rollback request has been sent for the stream 'mystream'

...
...

dataflow:&gt;stream history --name mystream

Version        Last updated         Status Package NamePackage Version  Description   

3      Mon Oct 30 16:22:51 PDT 2017DEPLOYEDmystream    1.0.0          Upgrade complete
2      Mon Oct 30 16:21:55 PDT 2017DELETED mystream    1.0.0          Delete complete 
1      Mon Oct 30 16:18:28 PDT 2017DELETED mystream    1.0.0          Delete complete 
</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="spring-cloud-dataflow-task" class="sect0"><a class="anchor" href="#spring-cloud-dataflow-task"></a>Tasks</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section goes into more detail about how you can work with <a href="http://cloud.spring.io/spring-cloud-task/">Spring Cloud Task</a>.
It covers topics such as creating and running task applications.</p>
</div>
<div class="paragraph">
<p>If you are just starting out with Spring Cloud Data Flow, you should probably read the &#8220;<a href="#getting-started">Getting Started</a>&#8221; guide before diving into this section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-task-intro"><a class="anchor" href="#spring-cloud-dataflow-task-intro"></a>35. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A task executes a process on demand.
In the case of Spring Cloud Task, a task is a <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> application that is annotated with <code>@EnableTask</code>.
A user launches a task that performs a certain process, and, once complete, the task ends.  Unlike a stream where a stream definition can have at most one deployment a single task definition can be launched multiple times simultaneously.
An example of a task would be a Spring Boot application that exports data from a JDBC repository to an HDFS instance.
Tasks record the start time and the end time as well as the boot exit code in a relational database.
The task implementation is based on the <a href="http://cloud.spring.io/spring-cloud-task/">Spring Cloud Task</a> project.</p>
</div>
<div class="sect2">
<h3 id="_application_properties_3"><a class="anchor" href="#_application_properties_3"></a>35.1. Application properties</h3>
<div class="paragraph">
<p>Each application takes properties to customize its behavior.  As an example, the <code>timestamp</code> task <code>format</code> setting establishes a output format that is different from the default value.</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; task create --definition "timestamp --format=\"yyyy\"" --name printTimeStamp</code></p>
</div>
<div class="paragraph">
<p>This <code>timestamp</code> property is actually the same as the <code>timestamp.format</code> property specified by the timestamp application.
Data Flow adds the ability to use the shorthand form <code>format</code> instead of <code>timestamp.format</code>.
One may also specify the longhand version as well, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; task create --definition "timestamp --timestamp.format=\"yyyy\"" --name printTimeStamp</code></p>
</div>
<div class="paragraph">
<p>This shorthand behavior is discussed more in the section on <a href="#spring-cloud-dataflow-stream-app-whitelisting">Whitelisting application properties</a>.
If you have <a href="#spring-cloud-dataflow-stream-app-metadata-artifact">registered application property metadata</a> you can use tab completion in the shell after typing <code>--</code> to get a list of candidate property names.</p>
</div>
<div class="paragraph">
<p>The shell provides tab completion for application properties. The shell command <code>app info --name &lt;appName&gt; --type &lt;appType&gt;</code> provides additional documentation for all the supported properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The supported Task <code>&lt;appType&gt;</code> is task.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_lifecycle_of_a_task"><a class="anchor" href="#_the_lifecycle_of_a_task"></a>36. The Lifecycle of a Task</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we dive deeper into the details of creating Tasks, we need to understand the typical lifecycle for tasks in the context of Spring Cloud Data Flow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#spring-cloud-dataflow-create-task-apps">Creating a Task Application</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-register-task-apps">Registering a Task Application</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-create-task-definition">Creating a Task Definition</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-task-launch">Launching a Task</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-task-review-executions">Reviewing Task Executions</a></p>
</li>
<li>
<p><a href="#spring-cloud-dataflow-task-definition-destroying">Destroying a Task Definition</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-create-task-apps"><a class="anchor" href="#spring-cloud-dataflow-create-task-apps"></a>36.1. Creating a Task Application</h3>
<div class="paragraph">
<p>While Spring Cloud Task does provide a number of out-of-the-box applications (at <a href="https://github.com/spring-cloud-task-app-starters">spring-cloud-task-app-starters</a>), most task applications require custom development.
  To create a custom task application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <a href="http://start.spring.io">Spring Initializer</a> to create a new project, making sure to select the following starters:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Cloud Task</code>: This dependency is the <code>spring-cloud-starter-task</code>.</p>
</li>
<li>
<p><code>JDBC</code>: This dependency is the <code>spring-jdbc</code> starter.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Within your new project, create a new class to serve as your main class, as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableTask
@SpringBootApplication
public class MyTask {

    public static void main(String[] args) {
		SpringApplication.run(MyTask.class, args);
	}
}</code></pre>
</div>
</div>
</li>
<li>
<p>With this class, you need one or more <code>CommandLineRunner</code> or <code>ApplicationRunner</code> implementations within your application.  You can either implement your own or use the ones provided by Spring Boot (there is one for running batch jobs, for example).</p>
</li>
<li>
<p>Packaging your application with Spring Boot into an ber jar is done through the standard {spring-boot-docs-reference}/html/getting-started-first-application.html#getting-started-first-application-executable-jar[Spring Boot conventions].
The packaged application can be registered and deployed as noted below.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_task_database_configuration"><a class="anchor" href="#_task_database_configuration"></a>36.1.1. Task Database Configuration</h4>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
When launching a task application, be sure that the database driver that is being used by Spring Cloud Data Flow is also a dependency on the task application.
For example, if your Spring Cloud Data Flow is set to use Postgresql, be sure that the task application also has Postgresql as a dependency.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When you run tasks externally (that is, from the command line) and you want Spring Cloud Data Flow to show the TaskExecutions in its UI, be sure that common datasource settings are shared among the both.
By default, Spring Cloud Task uses a local H2 instance, and the execution is recorded to the database used by Spring Cloud Data Flow.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-register-task-apps"><a class="anchor" href="#spring-cloud-dataflow-register-task-apps"></a>36.2. Registering a Task Application</h3>
<div class="paragraph">
<p>You can register a Task App with the App Registry by using the Spring Cloud Data Flow Shell <code>app register</code> command.
You must provide a unique name and a URI that can be resolved to the app artifact. For the type, specify "task".
The following listing shows three examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;app register --name task1 --type task --uri maven://com.example:mytask:1.0.2

dataflow:&gt;app register --name task2 --type task --uri file:///Users/example/mytask-1.0.2.jar

dataflow:&gt;app register --name task3 --type task --uri http://example.com/mytask-1.0.2.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>When providing a URI with the <code>maven</code> scheme, the format should conform to the following:</p>
</div>
<div class="paragraph">
<p><code>maven://&lt;groupId&gt;:&lt;artifactId&gt;[:&lt;extension&gt;[:&lt;classifier&gt;]]:&lt;version&gt;</code></p>
</div>
<div class="paragraph">
<p>If you would like to register multiple apps at one time, you can store them in a properties file where the keys are formatted as <code>&lt;type&gt;.&lt;name&gt;</code> and the values are the URIs.
For example, the followinng listing would be a valid properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>task.foo=file:///tmp/foo-1.2.1.BUILD-SNAPSHOT.jar
task.bar=file:///tmp/bar-1.2.1.BUILD-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use the <code>app import</code> command and provide the location of the properties file by using the  <code>--uri</code> option, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>app import --uri file:///tmp/task-apps.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>For convenience, we have the static files with application-URIs (for both maven and docker) available for all the out-of-the-box Task app-starters.
You can point to this file and import all the application-URIs in bulk.
Otherwise, as explained earlier in this chapter, you can register them individually or have your own custom property file with only the required application-URIs in it.
It is recommended, however, to have a &#8220;focused&#8221; list of desired application-URIs in a custom property file.</p>
</div>
<div class="paragraph">
<p>The following table lists the available static property files:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Artifact Type</th>
<th class="tableblock halign-left valign-top">Stable Release</th>
<th class="tableblock halign-left valign-top">SNAPSHOT Release</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-GA-task-applications-maven" class="bare">bit.ly/Clark-GA-task-applications-maven</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-BUILD-SNAPSHOT-task-applications-maven" class="bare">bit.ly/Clark-BUILD-SNAPSHOT-task-applications-maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-GA-task-applications-docker" class="bare">bit.ly/Clark-GA-task-applications-docker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/Clark-BUILD-SNAPSHOT-task-applications-docker" class="bare">bit.ly/Clark-BUILD-SNAPSHOT-task-applications-docker</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, if you would like to register all out-of-the-box task applications in bulk, you can do so with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;app import --uri http://bit.ly/Clark-GA-task-applications-maven</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass the <code>--local</code> option (which is <code>TRUE</code> by default) to indicate whether the properties file location should be resolved within the shell process itself.
If the location should be resolved from the Data Flow Server process, specify <code>--local false</code>.</p>
</div>
<div class="paragraph">
<p>When using either <code>app register</code> or <code>app import</code>, if a task app is already registered with
the provided name, it is not overridden by default. If you would like to override the
pre-existing task app, then include the <code>--force</code> option.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In some cases, the Resource is resolved on the server side.
In other cases, the URI is passed to a runtime container instance where it is resolved.
Consult the specific documentation of each Data Flow Server for more detail.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-create-task-definition"><a class="anchor" href="#spring-cloud-dataflow-create-task-definition"></a>36.3. Creating a Task Definition</h3>
<div class="paragraph">
<p>You can create a task Definition from a task app by providing a definition name as well as
properties that apply to the task execution.  Creating a task definition can be done through
the RESTful API or the shell.  To create a task definition by using the shell, use the
<code>task create</code> command to create the task definition, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;task create mytask --definition "timestamp --format=\"yyyy\""
Created new task 'mytask'</code></pre>
</div>
</div>
<div class="paragraph">
<p>A listing of the current task definitions can be obtained through the RESTful API or the shell.
To get the task definition list by using the shell, use the <code>task list</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-task-launch"><a class="anchor" href="#spring-cloud-dataflow-task-launch"></a>36.4. Launching a Task</h3>
<div class="paragraph">
<p>An adhoc task can be launched through the RESTful API or the shell.
To launch an ad-hoc task through the shell, use the <code>task launch</code> command, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;task launch mytask
 Launched task 'mytask'</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a task is launched, any properties that need to be passed as command line arguments to the task application can be set when launching the task, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;task launch mytask --arguments "--server.port=8080 --custom=value"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The arguments need to be passed as <code>space</code> delimited values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional properties meant for a <code>TaskLauncher</code> itself can be passed in by using a <code>--properties</code> option.
The format of this option is a comma-separated string of properties prefixed with <code>app.&lt;task definition name&gt;.&lt;property&gt;</code>.
Properties are passed to <code>TaskLauncher</code> as application properties.
It is up to an implementation to choose how those are passed into an actual task application.
If the property is prefixed with <code>deployer</code> instead of <code>app</code>, it is passed to <code>TaskLauncher</code> as a deployment property and its meaning may be <code>TaskLauncher</code> implementation specific.</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt;task launch mytask --properties "deployer.timestamp.custom1=value1,app.timestamp.custom2=value2"</code></p>
</div>
<div class="sect3">
<h4 id="_common_application_properties"><a class="anchor" href="#_common_application_properties"></a>36.4.1. Common application properties</h4>
<div class="paragraph">
<p>In addition to configuration through DSL, Spring Cloud Data Flow provides a mechanism for setting common properties to all the task applications that are launched by it.
This can be done by adding properties prefixed with <code>spring.cloud.dataflow.applicationProperties.task</code> when starting the server.
When doing so, the server passes all the properties, without the prefix, to the instances it launches.</p>
</div>
<div class="paragraph">
<p>For example, all the launched applications can be configured to use the properties <code>prop1</code> and <code>prop2</code> by launching the Data Flow server with the following options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>--spring.cloud.dataflow.applicationProperties.task.prop1=value1
--spring.cloud.dataflow.applicationProperties.task.prop2=value2</code></pre>
</div>
</div>
<div class="paragraph">
<p>This causes the properties, <code>prop1=value1</code> and <code>prop2=value2</code>, to be passed to all the launched applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Properties configured by using this mechanism have lower precedence than task deployment properties.
They are overridden if a property with the same key is specified at task launch time (for example, <code>app.trigger.prop2</code>
overrides the common property).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-task-limit-concurrent-executions"><a class="anchor" href="#spring-cloud-dataflow-task-limit-concurrent-executions"></a>36.5. Limit the number concurrent task launches</h3>
<div class="paragraph">
<p>Spring Cloud Data Flow allows a user establish the maximum number of concurrently running tasks to prevent the saturation of IaaS/hardware resources.
This limit can be configured by setting the <code>spring.cloud.dataflow.task.maximum-concurrent-tasks</code> property.   By default it is set to <code>20</code>.
If the number of concurrently running tasks is equal or greater than the value set by <code>spring.cloud.dataflow.task.maximum-concurrent-tasks</code> the next
task launch request will be declined and a warning message will be returned via the RESTful API, Shell or UI.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-task-review-executions"><a class="anchor" href="#spring-cloud-dataflow-task-review-executions"></a>36.6. Reviewing Task Executions</h3>
<div class="paragraph">
<p>Once the task is launched, the state of the task is stored in a relational DB.  The state
includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Task Name</p>
</li>
<li>
<p>Start Time</p>
</li>
<li>
<p>End Time</p>
</li>
<li>
<p>Exit Code</p>
</li>
<li>
<p>Exit Message</p>
</li>
<li>
<p>Last Updated Time</p>
</li>
<li>
<p>Parameters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A user can check the status of their task executions through the RESTful API or the shell.
To display the latest task executions through the shell, use the <code>task execution list</code> command.</p>
</div>
<div class="paragraph">
<p>To get a list of task executions for just one task definition, add <code>--name</code> and
the task definition name, for example <code>task execution list --name foo</code>.  To retrieve full
details for a task execution use the <code>task execution status</code> command with the id of the task execution,
for example <code>task execution status --id 549</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-task-definition-destroying"><a class="anchor" href="#spring-cloud-dataflow-task-definition-destroying"></a>36.7. Destroying a Task Definition</h3>
<div class="paragraph">
<p>Destroying a Task Definition removes the definition from the definition repository.
This can be done through the RESTful API or the shell.
To destroy a task through the shell, use the <code>task destroy</code> command, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;task destroy mytask
 Destroyed task 'mytask'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task execution information for previously launched tasks for the definition remains in the task repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This does not stop any currently executing tasks for this definition. Instead, it removes the task definition from the database.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-dataflow-validate-task"><a class="anchor" href="#spring-cloud-dataflow-validate-task"></a>36.8. Validating a Task</h3>
<div class="paragraph">
<p>Sometimes the one or more of the apps contained within a task definition contain an invalid URI in its registration.
This can be caused by an invalid URI entered at app registration time or the app was removed from the repository from which it was to be drawn.
To verify that all the apps contained in a task are resolve-able, a user can use the <code>validate</code> command.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;task validate time-stamp

Task Name Task Definition

time-stamptimestamp      



time-stamp is a valid task.

   App Name    Validation Status

task:timestamp valid            
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the user validated their time-stamp task.   As we see <code>task:timestamp</code> app is valid.
Now let&#8217;s see what happens if we have a stream definition with a registered app with an invalid URI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;task validate bad-timestamp

  Task Name  Task Definition

bad-timestampbadtimestamp   



bad-timestamp is an invalid task.

     App Name     Validation Status

task:badtimestamp invalid          
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case Spring Cloud Data Flow states that the task is invalid because task:badtimestamp has an invalid URI.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-task-events"><a class="anchor" href="#spring-cloud-dataflow-task-events"></a>37. Subscribing to Task/Batch Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also tap into various task and batch events when the task is launched.
If the task is enabled to generate task or batch events (with the additional dependencies <code>spring-cloud-task-stream</code> and, in the case of Kafka as the binder, <code>spring-cloud-stream-binder-kafka</code>), those events are published during the task lifecycle.
By default, the destination names for those published events on the broker (Rabbit, Kafka, and others) are the event names themselves (for instance: <code>task-events</code>, <code>job-execution-events</code>, and so on).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;task create myTask --definition "myBatchJob"
dataflow:&gt;stream create task-event-subscriber1 --definition ":task-events &gt; log" --deploy
dataflow:&gt;task launch myTask</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can control the destination name for those events by specifying explicit names when launching the task, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt;stream create task-event-subscriber2 --definition ":myTaskEvents &gt; log" --deploy
dataflow:&gt;task launch myTask --properties "app.myBatchJob.spring.cloud.stream.bindings.task-events.destination=myTaskEvents"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table lists the default task and batch event and destination names on the broker:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Task and Batch Event Destinations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Destination</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>task-events</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Job Execution events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>job-execution-events</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Step Execution events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>step-execution-events</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item Read events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>item-read-events</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item Process events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>item-process-events</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item Write events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>item-write-events</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skip-events</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-composed-tasks"><a class="anchor" href="#spring-cloud-dataflow-composed-tasks"></a>38. Composed Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow lets a user create a directed graph where each node of the graph is a task application.
This is done by using the DSL for composed tasks.
A composed task can be created through the RESTful API, the Spring Cloud Data Flow Shell, or the Spring Cloud Data Flow UI.</p>
</div>
<div class="sect2">
<h3 id="_configuring_the_composed_task_runner"><a class="anchor" href="#_configuring_the_composed_task_runner"></a>38.1. Configuring the Composed Task Runner</h3>
<div class="paragraph">
<p>Composed tasks are executed through a task application called the <a href="https://github.com/spring-cloud-task-app-starters/composed-task-runner">Composed Task Runner</a>.</p>
</div>
<div class="sect3">
<h4 id="_registering_the_composed_task_runner"><a class="anchor" href="#_registering_the_composed_task_runner"></a>38.1.1. Registering the Composed Task Runner</h4>
<div class="paragraph">
<p>By default, the Composed Task Runner application is not registered with Spring Cloud Data Flow.
Consequently, to launch composed tasks, we must first register the Composed
Task Runner as an application with Spring Cloud Data Flow, as follows:</p>
</div>
<div class="paragraph">
<p><code>app register --name composed-task-runner --type task --uri maven://org.springframework.cloud.task.app:composedtaskrunner-task:&lt;DESIRED_VERSION&gt;</code></p>
</div>
<div class="paragraph">
<p>You can also configure Spring Cloud Data Flow to use a different task definition name for the composed task runner.
This can be done by setting the <code>spring.cloud.dataflow.task.composedTaskRunnerName</code> property to the name of your choice.
You can then register the composed task runner application with the name you set by using that property.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_composed_task_runner_2"><a class="anchor" href="#_configuring_the_composed_task_runner_2"></a>38.1.2. Configuring the Composed Task Runner</h4>
<div class="paragraph">
<p>The Composed Task Runner application has a <code>dataflow.server.uri</code> property that is used for validation and for launching child tasks.
This defaults to <code><a href="http://localhost:9393" class="bare">localhost:9393</a></code>. If you run a distributed Spring Cloud Data Flow server, as you would if you deploy the server on Cloud Foundry, YARN, or Kubernetes, you need to provide the URI that can be used to access the server.
You can either provide this <code>dataflow.server.uri</code> property for the Composed Task Runner application when launching a composed task or you can provide a <code>spring.cloud.dataflow.server.uri</code> property for the Spring Cloud Data Flow server when it is started.
For the latter case, the <code>dataflow.server.uri</code> Composed Task Runner application property is automatically set when a composed task is launched.</p>
</div>
<div class="paragraph">
<p>In some cases, you may wish to execute an instance of the Composed Task Runner through the Task Launcher sink.
In that case, you must configure the Composed Task Runner to use the same datasource that the Spring Cloud Data Flow instance is using.
The datasource properties are set with the <code>TaskLaunchRequest</code> through the use of the <code>commandlineArguments</code> or the <code>environmentProperties</code> switches.
This is because the Composed Task Runner monitors the <code>task_executions</code> table to check the status of the tasks that it is running.
Using information from the table, it determines how it should navigate the graph.</p>
</div>
<div class="sect4">
<h5 id="_configuration_options"><a class="anchor" href="#_configuration_options"></a>Configuration Options</h5>
<div class="paragraph">
<p>The ComposedTaskRunner task has the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>increment-instance-enabled</strong>
Allows a single ComposedTaskRunner instance to be re-executed without changing the parameters. Default is false which means a ComposedTaskRunner instance can only be executed once with a given set of parameters, if true it can be re-executed. (Boolean, default: false).
ComposedTaskRunner is built using <a href="https://github.com/spring-projects/spring-batch">Spring Batch</a> and thus upon a successful execution the batch job is considered complete.
To launch the same ComposedTaskRunner definition multiple times you must set the <code>increment-instance-enabled</code> property to true or change the parameters for the definition for each launch.</p>
</li>
<li>
<p><strong>interval-time-between-checks</strong>
The amount of time in millis that the ComposedTaskRunner will wait between checks of the database to see if a task has completed. (Integer, default: 10000).
ComposedTaskRunner uses the datastore to determine the status of each child tasks.  This interval indicates to ComposedTaskRunner how often it should check the status its child tasks.</p>
</li>
<li>
<p><strong>max-wait-time</strong>
The maximum amount of time in millis that a individual step can run before the execution of the Composed task is failed (Integer, default: 0).
Determines the maximum time each child task is allowed to run before the CTR will terminate with a failure.  The default of <code>0</code> indicates no timeout.</p>
</li>
<li>
<p><strong>split-thread-allow-core-thread-timeout</strong>
Specifies whether to allow split core threads to timeout. Default is false; (Boolean, default: false)
Sets the policy governing whether core threads may timeout and terminate if no tasks arrive within the keep-alive time, being replaced if needed when new tasks arrive.</p>
</li>
<li>
<p><strong>split-thread-core-pool-size</strong>
Split&#8217;s core pool size. Default is 1; (Integer, default: 1)
Each child task contained in a split requires a thread in order to execute.   So for example a definition like: <code>&lt;AAA || BBB || CCC&gt; &amp;&amp; &lt;DDD || EEE&gt;</code> would require a split-thread-core-pool-size of 3.
This is because the largest split contains 3 child tasks.   A count of 2 would mean that <code>AAA</code> and <code>BBB</code> would run in parallel but CCC would wait until either <code>AAA</code> or <code>BBB</code> to finish in order to run.
Then <code>DDD</code> and <code>EEE</code> would run in parallel.</p>
</li>
<li>
<p><strong>split-thread-keep-alive-seconds</strong>
Split&#8217;s thread keep alive seconds. Default is 60. (Integer, default: 60)
If the pool currently has more than corePoolSize threads, excess threads will be terminated if they have been idle for more than the keepAliveTime.</p>
</li>
<li>
<p><strong>split-thread-max-pool-size</strong>
Split&#8217;s maximum pool size. Default is {@code Integer.MAX_VALUE} (Integer, default: &lt;none&gt;).
Establish the maximum number of threads allowed for the thread pool.</p>
</li>
<li>
<p><strong>split-thread-queue-capacity</strong>
Capacity for Split&#8217;s BlockingQueue. Default is {@code Integer.MAX_VALUE}. (Integer, default: &lt;none&gt;)</p>
<div class="ulist">
<ul>
<li>
<p>If fewer than corePoolSize threads are running, the Executor always prefers adding a new thread rather than queuing.</p>
</li>
<li>
<p>If corePoolSize or more threads are running, the Executor always prefers queuing a request rather than adding a new thread.</p>
</li>
<li>
<p>If a request cannot be queued, a new thread is created unless this would exceed maximumPoolSize, in which case, the task will be rejected.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>split-thread-wait-for-tasks-to-complete-on-shutdown</strong>
Whether to wait for scheduled tasks to complete on shutdown, not interrupting running tasks and executing all tasks in the queue. Default is false; (Boolean, default: false)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note
when using the options above as environment variables, convert to uppercase, remove the dash character and replace with the underscore character. For example: increment-instance-enabled would be INCREMENT_INSTANCE_ENABLED.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_lifecycle_of_a_composed_task"><a class="anchor" href="#_the_lifecycle_of_a_composed_task"></a>38.2. The Lifecycle of a Composed Task</h3>
<div class="paragraph">
<p>The lifecycle of a composed task has three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spring-cloud-data-flow-composed-task-creating">Creating a Composed Task</a></p>
</li>
<li>
<p><a href="#spring-cloud-data-flow-composed-task-stopping">Stopping a Composed Task</a></p>
</li>
<li>
<p><a href="#spring-cloud-data-flow-composed-task-restarting">Restarting a Composed Task</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="spring-cloud-data-flow-composed-task-creating"><a class="anchor" href="#spring-cloud-data-flow-composed-task-creating"></a>38.2.1. Creating a Composed Task</h4>
<div class="paragraph">
<p>The DSL for the composed tasks is used when creating a task definition through the task create command, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dataflow:&gt; app register --name timestamp --type task --uri maven://org.springframework.cloud.task.app:timestamp-task:&lt;DESIRED_VERSION&gt;
dataflow:&gt; app register --name mytaskapp --type task --uri file:///home/tasks/mytask.jar
dataflow:&gt; task create my-composed-task --definition "mytaskapp &amp;&amp; timestamp"
dataflow:&gt; task launch my-composed-task</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, we assume that the applications to be used by our composed task have not been registered yet.
Consequently, in the first two steps, we register two task applications.
We then create our composed task definition by using the <code>task create</code> command.
The composed task DSL in the preceding example, when launched, runs mytaskapp and then runs the timestamp application.</p>
</div>
<div class="paragraph">
<p>But before we launch the <code>my-composed-task</code> definition, we can view what Spring Cloud Data Flow generated for us.
This can be done by executing the task list command, as shown (including its output) in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">dataflow:&gt;task list

        Task Name            Task Definition    Task Status

my-composed-task          mytaskapp &amp;&amp; timestampunknown    
my-composed-task-mytaskappmytaskapp             unknown    
my-composed-task-timestamptimestamp             unknown    
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, Spring Cloud Data Flow created three task definitions, one for each of the applications that makes up our composed task (<code>my-composed-task-mytaskapp</code> and <code>my-composed-task-timestamp</code>) as well as the composed task (<code>my-composed-task</code>) definition.
We also see that each of the generated names for the child tasks is made up of the name of the composed task and the name of the application, separated by a dash <code>-</code> (as in <em>my-composed-task</em> <code>-</code> <em>mytaskapp</em>).</p>
</div>
<div class="sect4">
<h5 id="_task_application_parameters"><a class="anchor" href="#_task_application_parameters"></a>Task Application Parameters</h5>
<div class="paragraph">
<p>The task applications that make up the composed task definition can also contain parameters, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>dataflow:&gt; task create my-composed-task --definition "mytaskapp --displayMessage=hello &amp;&amp; timestamp --format=YYYY"</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_launching_a_composed_task"><a class="anchor" href="#_launching_a_composed_task"></a>38.2.2. Launching a Composed Task</h4>
<div class="paragraph">
<p>Launching a composed task is done the same way as launching a stand-alone task, as follows:</p>
</div>
<div class="paragraph">
<p><code>task launch my-composed-task</code></p>
</div>
<div class="paragraph">
<p>Once the task is launched, and assuming all the tasks complete successfully, you can see three task executions when executing a <code>task execution list</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">dataflow:&gt;task execution list

        Task Name         ID          Start Time                   End Time          Exit Code

my-composed-task-timestamp713Wed Apr 12 16:43:07 EDT 2017Wed Apr 12 16:43:07 EDT 20170        
my-composed-task-mytaskapp712Wed Apr 12 16:42:57 EDT 2017Wed Apr 12 16:42:57 EDT 20170        
my-composed-task          711Wed Apr 12 16:42:55 EDT 2017Wed Apr 12 16:43:15 EDT 20170        
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, we see that <code>my-compose-task</code> launched and that it also launched the other tasks in sequential order.
All of them executed successfully with <code>Exit Code</code> as <code>0</code>.</p>
</div>
<div class="sect4">
<h5 id="_passing_properties_to_the_child_tasks"><a class="anchor" href="#_passing_properties_to_the_child_tasks"></a>Passing properties to the child tasks</h5>
<div class="paragraph">
<p>To set the properties for child tasks in a composed task graph at task launch time,
you would use the following format of <code>app.&lt;composed task definition name&gt;.&lt;child task app name&gt;.&lt;property&gt;</code>.
Using the following Composed Task definition as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt; task create my-composed-task --definition "mytaskapp  &amp;&amp; mytimestamp"</code></pre>
</div>
</div>
<div class="paragraph">
<p>To have mytaskapp display 'HELLO' and set the mytimestamp timestamp format to 'YYYY' for the Composed Task definition, you would use the following task launch format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">task launch my-composed-task --properties "app.my-composed-task.mytaskapp.displayMessage=HELLO,app.my-composed-task.mytimestamp.timestamp.format=YYYY"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to application properties, the <code>deployer</code> properties can also be set for child tasks using the format format of <code>deployer.&lt;composed task definition name&gt;.&lt;child task app name&gt;.&lt;deployer-property&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">task launch my-composed-task --properties "deployer.my-composed-task.mytaskapp.memory=2048m,app.my-composed-task.mytimestamp.timestamp.format=HH:mm:ss"
Launched task 'a1'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_passing_arguments_to_the_composed_task_runner"><a class="anchor" href="#_passing_arguments_to_the_composed_task_runner"></a>Passing arguments to the composed task runner</h5>
<div class="paragraph">
<p>Command line arguments for the composed task runner can be passed using <code>--arguments</code> option.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;task create my-composed-task --definition "&lt;aaa: timestamp || bbb: timestamp&gt;"
Created new task 'my-composed-task'

dataflow:&gt;task launch my-composed-task --arguments "--increment-instance-enabled=true --max-wait-time=50000 --split-thread-core-pool-size=4" --properties "app.my-composed-task.bbb.timestamp.format=dd/MM/yyyy HH:mm:ss"
Launched task 'my-composed-task'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exit_statuses"><a class="anchor" href="#_exit_statuses"></a>Exit Statuses</h5>
<div class="paragraph">
<p>The following list shows how the Exit Status is set for each step (task) contained in the composed task following each step execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code>TaskExecution</code> has an <code>ExitMessage</code>, that is used as the <code>ExitStatus</code>.</p>
</li>
<li>
<p>If no <code>ExitMessage</code> is present and the <code>ExitCode</code> is set to zero, then the <code>ExitStatus</code> for the step is <code>COMPLETED</code>.</p>
</li>
<li>
<p>If no <code>ExitMessage</code> is present and the <code>ExitCode</code> is set to any non-zero number, the <code>ExitStatus</code> for the step is <code>FAILED</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_destroying_a_composed_task"><a class="anchor" href="#_destroying_a_composed_task"></a>38.2.3. Destroying a Composed Task</h4>
<div class="paragraph">
<p>The command used to destroy a stand-alone task is the same as the command used to destroy a composed task.
The only difference is that destroying a composed task also destroys the child tasks associated with it.
The following example shows the task list before and after using the <code>destroy</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">dataflow:&gt;task list

        Task Name            Task Definition    Task Status

my-composed-task          mytaskapp &amp;&amp; timestampCOMPLETED  
my-composed-task-mytaskappmytaskapp             COMPLETED  
my-composed-task-timestamptimestamp             COMPLETED  

...
dataflow:&gt;task destroy my-composed-task
dataflow:&gt;task list

Task NameTask DefinitionTask Status
</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-data-flow-composed-task-stopping"><a class="anchor" href="#spring-cloud-data-flow-composed-task-stopping"></a>38.2.4. Stopping a Composed Task</h4>
<div class="paragraph">
<p>In cases where a composed task execution needs to be stopped, you can do so through the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RESTful API</p>
</li>
<li>
<p>Spring Cloud Data Flow Dashboard</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To stop a composed task through the dashboard, select the Jobs tab and click the Stop button next to the job execution that you want to stop.</p>
</div>
<div class="paragraph">
<p>The composed task run is stopped when the currently running child task completes.
The step associated with the child task that was running at the time that the composed task was stopped is marked as <code>STOPPED</code> as well as the composed task job execution.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-data-flow-composed-task-restarting"><a class="anchor" href="#spring-cloud-data-flow-composed-task-restarting"></a>38.2.5. Restarting a Composed Task</h4>
<div class="paragraph">
<p>In cases where a composed task fails during execution and the status of the composed task is <code>FAILED</code>, the task can be restarted.
You can do so through the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RESTful API</p>
</li>
<li>
<p>The shell</p>
</li>
<li>
<p>Spring Cloud Data Flow Dashboard</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To restart a composed task through the shell, launch the task with the same parameters.
To restart a composed task through the dashboard, select the Jobs tab and click the Restart button next to the job execution that you want to restart.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Restarting a Composed Task job that has been stopped (through the Spring Cloud Data Flow Dashboard or RESTful API) relaunches the <code>STOPPED</code> child task and then launches the remaining (unlaunched) child tasks in the specified order.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_composed_tasks_dsl"><a class="anchor" href="#_composed_tasks_dsl"></a>39. Composed Tasks DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Composed tasks can be run in three ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spring-cloud-data-flow-conditional-execution">Conditional Execution</a></p>
</li>
<li>
<p><a href="#spring-cloud-data-flow-transitional-execution">Transitional Execution</a></p>
</li>
<li>
<p><a href="#spring-cloud-data-flow-split-execution">Split Execution</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="spring-cloud-data-flow-conditional-execution"><a class="anchor" href="#spring-cloud-data-flow-conditional-execution"></a>39.1. Conditional Execution</h3>
<div class="paragraph">
<p>Conditional execution is expressed by using a double ampersand symbol (<code>&amp;&amp;</code>).
This lets each task in the sequence be launched only if the previous task
successfully completed, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>task create my-composed-task --definition "task1 &amp;&amp; task2"</code></p>
</div>
<div class="paragraph">
<p>When the composed task called <code>my-composed-task</code> is launched, it launches the task called <code>task1</code> and, if it completes successfully, then the task called <code>task2</code> is launched.
If <code>task1</code> fails, then <code>task2</code> does not launch.</p>
</div>
<div class="paragraph">
<p>You can also use the Spring Cloud Data Flow Dashboard to create your conditional execution, by using the designer to drag and drop applications that are required and connecting them together to create your directed graph, as shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-conditional-execution.png" alt="Composed Task Conditional Execution">
</div>
<div class="title">Figure 4. Conditional Execution</div>
</div>
<div class="paragraph">
<p>The preceding diagram is a screen capture of the directed graph as it being created by using the Spring Cloud Data Flow Dashboard.
You can see that are four components in the diagram that comprise a conditional execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Start icon: All directed graphs start from this symbol.
There is only one.</p>
</li>
<li>
<p>Task icon: Represents each task in the directed graph.</p>
</li>
<li>
<p>End icon: Represents the termination of a directed graph.</p>
</li>
<li>
<p>Solid line arrow: Represents the flow conditional execution flow between:</p>
<div class="ulist">
<ul>
<li>
<p>Two applications.</p>
</li>
<li>
<p>The start control node and an application.</p>
</li>
<li>
<p>An application and the end control node.</p>
</li>
</ul>
</div>
</li>
<li>
<p>End icon: All directed graphs end at this symbol.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can view a diagram of your directed graph by clicking the Detail button next to the composed task definition on the Definitions tab.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-data-flow-transitional-execution"><a class="anchor" href="#spring-cloud-data-flow-transitional-execution"></a>39.2. Transitional Execution</h3>
<div class="paragraph">
<p>The DSL supports fine- grained control over the transitions taken during the execution of the directed graph.
Transitions are specified by providing a condition for equality based on the exit status of the previous task.
A task transition is represented by the following symbol <code>-&gt;</code>.</p>
</div>
<div class="sect3">
<h4 id="_basic_transition"><a class="anchor" href="#_basic_transition"></a>39.2.1. Basic Transition</h4>
<div class="paragraph">
<p>A basic transition would look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>task create my-transition-composed-task --definition "foo 'FAILED' -&gt; bar 'COMPLETED' -&gt; baz"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, <code>foo</code> would launch, and, if it had an exit status of <code>FAILED</code>, the <code>bar</code> task would launch.
If the exit status of <code>foo</code> was <code>COMPLETED</code>, <code>baz</code> would launch.
All other statuses returned by <code>foo</code> have no effect, and the task would terminate normally.</p>
</div>
<div class="paragraph">
<p>Using the Spring Cloud Data Flow Dashboard to create the same " <code>basic transition</code> " would resemble the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-transition-basic.png" alt="Composed Task Basic Transition">
</div>
<div class="title">Figure 5. Basic Transition</div>
</div>
<div class="paragraph">
<p>The preceding diagram is a screen capture of the directed graph as it being created in the Spring Cloud Data Flow Dashboard.
Notice that there are two different types of connectors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dashed line: Represents transitions from the application to one of the possible destination applications.</p>
</li>
<li>
<p>Solid line: Connects applications in a conditional execution or a connection between the application and a control node (start or end).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a transitional connector:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When creating a transition, link the application to each possible destination by using the connector.</p>
</li>
<li>
<p>Once complete, go to each connection and select it by clicking it.</p>
</li>
<li>
<p>A bolt icon appears.</p>
</li>
<li>
<p>Click that icon.</p>
</li>
<li>
<p>Enter the exit status required for that connector.</p>
</li>
<li>
<p>The solid line for that connector turns to a dashed line.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_transition_with_a_wildcard"><a class="anchor" href="#_transition_with_a_wildcard"></a>39.2.2. Transition With a Wildcard</h4>
<div class="paragraph">
<p>Wildcards are supported for transitions by the DSL, as shown in the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>task create my-transition-composed-task --definition "foo 'FAILED' -&gt; bar '*' -&gt; baz"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, <code>foo</code> would launch, and, if it had an exit status of <code>FAILED</code>, the <code>bar</code> task would launch.
For any exit status of <code>foo</code> other than <code>FAILED</code>, <code>baz</code> would launch.</p>
</div>
<div class="paragraph">
<p>Using the Spring Cloud Data Flow Dashboard to create the same &#8220;transition with wildcard&#8221; would resemble the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-transition-basic-wildcard.png" alt="Composed Task Basic Transition with Wildcard">
</div>
<div class="title">Figure 6. Basic Transition With Wildcard</div>
</div>
</div>
<div class="sect3">
<h4 id="_transition_with_a_following_conditional_execution"><a class="anchor" href="#_transition_with_a_following_conditional_execution"></a>39.2.3. Transition With a Following Conditional Execution</h4>
<div class="paragraph">
<p>A transition can be followed by a conditional execution so long as the wildcard
is not used, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>task create my-transition-conditional-execution-task --definition "foo 'FAILED' -&gt; bar 'UNKNOWN' -&gt; baz &amp;&amp; qux &amp;&amp; quux"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, <code>foo</code> would launch, and, if it had an exit status of <code>FAILED</code>, the <code>bar</code> task would launch.
If <code>foo</code> had an exit status of <code>UNKNOWN</code>, <code>baz</code> would launch.
For any exit status of <code>foo</code> other than <code>FAILED</code> or <code>UNKNOWN</code>, <code>qux</code> would launch and, upon successful completion, <code>quux</code> would launch.</p>
</div>
<div class="paragraph">
<p>Using the Spring Cloud Data Flow Dashboard to create the same &#8220;transition with conditional execution&#8221; would resemble the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-transition-conditional-execution.png" alt="Composed Task Transition with Conditional Execution">
</div>
<div class="title">Figure 7. Transition With Conditional Execution</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this diagram we see the dashed line (transition) connecting the <code>foo</code> application to the target applications, but a solid line connecting the conditional executions between <code>foo</code>, <code>qux</code>, and  <code>quux</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-data-flow-split-execution"><a class="anchor" href="#spring-cloud-data-flow-split-execution"></a>39.3. Split Execution</h3>
<div class="paragraph">
<p>Splits allow multiple tasks within a composed task to be run in parallel.
It is denoted by using angle brackets (<code>&lt;&gt;</code>) to group tasks and flows that are to be run in parallel.
These tasks and flows are separated by the double pipe <code>||</code> symbol, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>task create my-split-task --definition "&lt;foo || bar || baz&gt;"</code></p>
</div>
<div class="paragraph">
<p>The preceding example above launches tasks <code>foo</code>, <code>bar</code> and <code>baz</code> in parallel.</p>
</div>
<div class="paragraph">
<p>Using the Spring Cloud Data Flow Dashboard to create the same &#8220;split execution&#8221; would resemble the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-split.png" alt="Composed Task Split">
</div>
<div class="title">Figure 8. Split</div>
</div>
<div class="paragraph">
<p>With the task DSL, a user may also execute multiple split groups in succession, as shown in the following example:</p>
</div>
<div class="paragraph">
<p>`task create my-split-task --definition "&lt;foo || bar || baz&gt; &amp;&amp; &lt;qux || quux&gt;"'</p>
</div>
<div class="paragraph">
<p>In the preceding example, tasks <code>foo</code>, <code>bar</code>, and <code>baz</code> are launched in parallel.
Once they all complete, then tasks <code>qux</code> and <code>quux</code> are launched in parallel.
Once they complete, the composed task ends.
However, if <code>foo</code>, <code>bar</code>, or <code>baz</code> fails, the split containing <code>qux</code> and <code>quux</code> does not launch.</p>
</div>
<div class="paragraph">
<p>Using the Spring Cloud Data Flow Dashboard to create the same &#8220;split with multiple groups&#8221; would resemble the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-multiple-splits.png" alt="Composed Task Split">
</div>
<div class="title">Figure 9. Split as a part of a conditional execution</div>
</div>
<div class="paragraph">
<p>Notice that there is a <code>SYNC</code> control node that is inserted by the designer when
connecting two consecutive splits.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tasks that are used in a split should not set the their <code>ExitMessage</code>.   Setting the <code>ExitMessage</code> is only to be used
with  <a href="#spring-cloud-data-flow-transitional-execution">transitions</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_split_containing_conditional_execution"><a class="anchor" href="#_split_containing_conditional_execution"></a>39.3.1. Split Containing Conditional Execution</h4>
<div class="paragraph">
<p>A split can also have a conditional execution within the angle brackets, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>task create my-split-task --definition "&lt;foo &amp;&amp; bar || baz&gt;"</code></p>
</div>
<div class="paragraph">
<p>In the preceding example, we see that <code>foo</code> and <code>baz</code> are launched in parallel.
However, <code>bar</code> does not launch until <code>foo</code> completes successfully.</p>
</div>
<div class="paragraph">
<p>Using the Spring Cloud Data Flow Dashboard to create the same " <code>split containing conditional execution</code> " resembles the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-split-contains-conditional.png" alt="Composed Task Split With Conditional Execution">
</div>
<div class="title">Figure 10. Split with conditional execution</div>
</div>
</div>
<div class="sect3">
<h4 id="_establishing_the_proper_thread_count_for_splits"><a class="anchor" href="#_establishing_the_proper_thread_count_for_splits"></a>39.3.2. Establishing the proper thread count for splits</h4>
<div class="paragraph">
<p>Each child task contained in a split requires a thread in order to execute.  To set this properly you want to look at your graph and count the split that has the largest number of child tasks, this will be the number of threads you will need to utilize.
To set the thread count use the split-thread-core-pool-size property (defaults to 1).   So for example a definition like: <code>&lt;AAA || BBB || CCC&gt; &amp;&amp; &lt;DDD || EEE&gt;</code> would require a split-thread-core-pool-size of 3.
This is because the largest split contains 3 child tasks.   A count of 2 would mean that <code>AAA</code> and <code>BBB</code> would run in parallel but CCC would wait until either <code>AAA</code> or <code>BBB</code> to finish in order to run.
Then <code>DDD</code> and <code>EEE</code> would run in parallel.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-launch-tasks-from-stream"><a class="anchor" href="#spring-cloud-dataflow-launch-tasks-from-stream"></a>40. Launching Tasks from a Stream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can launch a task from a stream by using one of the available <code>task-launcher</code> sinks. Currently the platforms supported by the <code>task-launcher</code> sinks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-local">local</a>,</p>
</li>
<li>
<p><a href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-cloudfoundry">Cloud Foundry</a></p>
</li>
<li>
<p><a href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-kubernetes">Kubernetes</a></p>
</li>
<li>
<p><a href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-yarn">Yarn</a></p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<code>task-launcher-local</code> is meant for development purposes only.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <code>task-launcher</code> sink expects a message containing a <a href="https://github.com/spring-cloud/spring-cloud-task/blob/master/spring-cloud-task-stream/src/main/java/org/springframework/cloud/task/launcher/TaskLaunchRequest.java">TaskLaunchRequest</a> object in its payload.
From the <code>TaskLaunchRequest</code> object, the <code>task-launcher</code> obtains the URI of the artifact to be launched, as well as the environment properties, command line arguments, deployment properties, and application name to be used by the task.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-local/blob/v1.2.0.RELEASE/spring-cloud-starter-stream-sink-task-launcher-local/README.adoc">task-launcher-local</a> can be added to the available sinks by executing the app register command, as follows (for the Rabbit Binder, in this case):</p>
</div>
<div class="paragraph">
<p><code>app register --name task-launcher-local --type sink --uri maven://org.springframework.cloud.stream.app:task-launcher-local-sink-rabbit:jar:1.2.0.RELEASE</code></p>
</div>
<div class="paragraph">
<p>In the case of a Maven-based task that is to be launched, the <code>task-launcher</code> application is responsible for downloading the artifact.
You <strong>must</strong> configure the <code>task-launcher</code> with the appropriate configuration of <a href="https://github.com/spring-cloud/spring-cloud-deployer/blob/master/spring-cloud-deployer-resource-maven/src/main/java/org/springframework/cloud/deployer/resource/maven/MavenProperties.java">Maven Properties</a>, such as <code>--maven.remote-repositories.repo1.url=http://repo.spring.io/libs-milestone"</code> to resolve artifacts (in this case against a milestone repo).  Note that this repostory can be different than the one used to register the <code>task-launcher</code> application itself.</p>
</div>
<div class="sect2">
<h3 id="_triggertask"><a class="anchor" href="#_triggertask"></a>40.1. TriggerTask</h3>
<div class="paragraph">
<p>One way to launch a task with the <code>task-launcher</code> is to use the <a href="https://github.com/spring-cloud-stream-app-starters/triggertask/blob/v1.2.0.RELEASE/spring-cloud-starter-stream-source-triggertask/README.adoc">triggertask</a> source.
The <code>triggertask</code> source emits a message with a <code>TaskLaunchRequest</code> object that contains the required launch information.
The <code>triggertask</code> can be added to the available sources by running the app register command, as follows (for the Rabbit Binder, in this case):</p>
</div>
<div class="paragraph">
<p><code>app register --type source --name triggertask --uri maven://org.springframework.cloud.stream.app:triggertask-source-rabbit:1.2.0.RELEASE</code></p>
</div>
<div class="paragraph">
<p>For example, to launch the timestamp task once every 60 seconds, the stream implementation would be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>stream create foo --definition "triggertask --triggertask.uri=maven://org.springframework.cloud.task.app:timestamp-task:jar:1.2.0.RELEASE --trigger.fixed-delay=60 --triggertask.environment-properties='spring.datasource.url=jdbc:h2:tcp://localhost:19092/mem:dataflow,spring.datasource.username=sa' | task-launcher-local --maven.remote-repositories.repo1.url=http://repo.spring.io/libs-release" --deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run <code>runtime apps</code>, you can find the log file for the task launcher sink.
By using the <code>tail</code> command on that file, you can find the log file for the launched tasks.
Setting of <code>triggertask.environment-properties</code> establishes the Data Flow Server&#8217;s H2 Database as the database where the task executions will be recorded.
You can then see the list of task executions by using the shell command <code>task execution list</code>, as shown (with its output) in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">dataflow:&gt;task execution list

     Task Name      ID         Start Time                   End Time          Exit Code

timestamp-task_261764 Tue May 02 12:13:49 EDT 2017Tue May 02 12:13:49 EDT 20170        
timestamp-task_329963 Tue May 02 12:12:49 EDT 2017Tue May 02 12:12:49 EDT 20170        
timestamp-task_589712 Tue May 02 12:11:50 EDT 2017Tue May 02 12:11:50 EDT 20170        
timestamp-task_134671 Tue May 02 12:10:50 EDT 2017Tue May 02 12:10:50 EDT 20170        
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tasklaunchrequest_transform"><a class="anchor" href="#_tasklaunchrequest_transform"></a>40.2. TaskLaunchRequest-transform</h3>
<div class="paragraph">
<p>Another way to start a task with the <code>task-launcher</code> would be to create a stream by using the
<a href="https://github.com/spring-cloud-stream-app-starters/tasklaunchrequest-transform">Tasklaunchrequest-transform</a> processor to translate a message payload to a <code>TaskLaunchRequest</code>.</p>
</div>
<div class="paragraph">
<p>The <code>tasklaunchrequest-transform</code> can be added to the available processors by executing the app register command, as follows (for the Rabbit Binder, in this case):</p>
</div>
<div class="paragraph">
<p><code>app register --type processor --name tasklaunchrequest-transform --uri maven://org.springframework.cloud.stream.app:tasklaunchrequest-transform-processor-rabbit:1.2.0.RELEASE</code></p>
</div>
<div class="paragraph">
<p>The following example shows the creation of a task that includes the <code>tasklaunchrequest-transform</code>:</p>
</div>
<div class="paragraph">
<p><code>stream create task-stream --definition "http --port=9000 | tasklaunchrequest-transform --uri=maven://org.springframework.cloud.task.app:timestamp-task:jar:1.2.0.RELEASE | task-launcher-local --maven.remote-repositories.repo1.url=http://repo.spring.io/libs-release"</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_launching_a_composed_task_from_a_stream"><a class="anchor" href="#_launching_a_composed_task_from_a_stream"></a>40.3. Launching a Composed Task From a Stream</h3>
<div class="paragraph">
<p>A composed task can be launched with one of the <code>task-launcher</code> sinks as discussed <a href="#spring-cloud-dataflow-launch-tasks-from-stream">here</a>.
Since we use the <code>ComposedTaskRunner</code> directly, we need to set up the task definitions it uses prior to the creation of the composed task launching stream.
Suppose we wanted to create the following composed task definition: <code>AAA &amp;&amp; BBB</code>.
The first step would be to create the task definitions, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>task create AAA --definition "timestamp"
task create BBB --definition "timestamp"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that the task definitions we need for composed task definition are ready, we need to create a stream that launches <code>ComposedTaskRunner</code>.
So, in this case, we create a stream with</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A trigger that emits a message once every 30 seconds</p>
</li>
<li>
<p>A transformer that creates a <code>TaskLaunchRequest</code> for each message received</p>
</li>
<li>
<p>A <code>task-launcher-local</code> sink that launches a the <code>ComposedTaskRunner</code> on our local machine</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The stream should resemble the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>stream create ctr-stream --definition "time --fixed-delay=30 | tasklaunchrequest-transform --uri=maven://org.springframework.cloud.task.app:composedtaskrunner-task:&lt;current release&gt; --command-line-arguments='--graph=AAA&amp;&amp;BBB --increment-instance-enabled=true --spring.datasource.url=...' | task-launcher-local"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, we see that the <code>tasklaunchrequest-transform</code> is establishing two primary components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>uri</strong>: The URI of the <code>ComposedTaskRunner</code> that is used</p>
</li>
<li>
<p><strong>command-line-arguments</strong>: To configure the <code>ComposedTaskRunner</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For now, we focus on the configuration that is required to launch the <code>ComposedTaskRunner</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>graph</strong>: this is the graph that is to be executed by the <code>ComposedTaskRunner</code>.
In this case it is <code>AAA&amp;&amp;BBB</code>.</p>
</li>
<li>
<p><strong>increment-instance-enabled</strong>: This lets each execution of <code>ComposedTaskRunner</code> be unique.
<code>ComposedTaskRunner</code> is built by using <a href="http://projects.spring.io/spring-batch/">Spring Batch</a>.
Thus, we want a new Job Instance for each launch of the <code>ComposedTaskRunner</code>.
To do this, we set <code>increment-instance-enabled</code> to be <code>true</code>.</p>
</li>
<li>
<p><strong>spring.datasource.</strong>*: The datasource that is used by Spring Cloud
Data Flow, which lets the user track the tasks launched by the
<code>ComposedTaskRunner</code> and the state of the job execution.
Also, this is so that the <code>ComposedTaskRunner</code> can track the state of the tasks it launched and update its state.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Releases of <code>ComposedTaskRunner</code> can be found
<a href="https://github.com/spring-cloud-task-app-starters/composed-task-runner/releases">here</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sharing-spring-cloud-dataflows-datastore-with-tasks"><a class="anchor" href="#sharing-spring-cloud-dataflows-datastore-with-tasks"></a>41. Sharing Spring Cloud Data Flow&#8217;s Datastore with Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As discussed in the <a href="#spring-cloud-dataflow-task">Tasks</a> documentation Spring
Cloud Data Flow allows a user to view Spring Cloud Task App executions. So in
this section we will discuss what is required by a Task Application and Spring
Cloud Data Flow to share the task execution information.</p>
</div>
<div class="sect2">
<h3 id="_a_common_datastore_dependency"><a class="anchor" href="#_a_common_datastore_dependency"></a>41.1. A Common DataStore Dependency</h3>
<div class="paragraph">
<p>Spring Cloud Data Flow supports many database <a href="appendix-migration-guide.html#rdbms">types</a> out-of-the-box,
so all the user typically has to do is declare the <code>spring_datasource_*</code> environment variables
to establish what data store Spring Cloud Data Flow will need.
So whatever database you decide to use for Spring Cloud Data Flow make sure that the your task also
includes that database dependency in its <code>pom.xml</code> or <code>gradle.build</code> file.  If the database dependency
that is used by Spring Cloud Data Flow is not present in the Task Application, the task will fail
and the task execution will not be recorded.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_common_data_store"><a class="anchor" href="#_a_common_data_store"></a>41.2. A Common Data Store</h3>
<div class="paragraph">
<p>Spring Cloud Data Flow and your task application must access the same datastore instance.
This is so that the task executions recorded by the task application can be read by Spring Cloud Data Flow to list them in the Shell and Dashboard views.
Also the task app must have read  &amp; write privileges to the task data tables that are used by Spring Cloud Data Flow.</p>
</div>
<div class="paragraph">
<p>Given the understanding of Datasource dependency between Task apps and Spring Cloud Data Flow, let&#8217;s review how to apply them in various Task orchestration scenarios.</p>
</div>
<div class="sect3">
<h4 id="_simple_task_launch"><a class="anchor" href="#_simple_task_launch"></a>41.2.1. Simple Task Launch</h4>
<div class="paragraph">
<p>When launching a task from Spring Cloud Data Flow, Data Flow adds its datasource
properties (<code>spring.datasource.url</code>, <code>spring.datasource.driverClassName</code>, <code>spring.datasource.username</code>, <code>spring.datasource.password</code>)
to the app properties of the task being launched.  Thus a task application
will record its task execution information to the Spring Cloud Data Flow repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="_task_launcher_sink"><a class="anchor" href="#_task_launcher_sink"></a>41.2.2. Task Launcher Sink</h4>
<div class="paragraph">
<p>The <a href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-local">Task Launcher Sink</a> allows tasks to be launched via a stream as discussed <a href="#spring-cloud-dataflow-launch-tasks-from-stream">here</a>.
Since tasks launched by the Task Launcher Sink may not want their task executions
recorded to the same datastore as Spring Cloud Data Flow,
each <a href="https://docs.spring.io/spring-cloud-task/docs/current/apidocs/org/springframework/cloud/task/launcher/TaskLaunchRequest.html">TaskLaunchRequest</a>
received by the Task Launcher Sink must have the required datasource information established as app properties or command line arguments.
Both <a href="https://github.com/spring-cloud-stream-app-starters/tasklaunchrequest-transform/blob/master/spring-cloud-starter-stream-processor-tasklaunchrequest-transform/README.adoc">TaskLaunchRequest-Transform</a>
and <a href="https://github.com/spring-cloud-stream-app-starters/triggertask/blob/master/spring-cloud-starter-stream-source-triggertask/README.adoc">TriggerTask Source</a> are examples
of how a source and a processor allow a user to set the datasource properties via the app properties or command line arguments.</p>
</div>
</div>
<div class="sect3">
<h4 id="_composed_task_runner"><a class="anchor" href="#_composed_task_runner"></a>41.2.3. Composed Task Runner</h4>
<div class="paragraph">
<p>Spring Cloud Data Flow allows a user to create a directed graph where each node
of the graph is a task application and this is done via the
<a href="https://github.com/spring-cloud-task-app-starters/composed-task-runner/blob/master/spring-cloud-starter-task-composedtaskrunner/README.adoc">Composed Task Runner</a>.
In this case the rules that applied to a <a href="#datasource-simple-task-launch">Simple Task Launch</a>
or <a href="#datasource-task-launcher-sink">Task Launcher Sink</a> apply to the composed task runner as well.
All child apps must also have access to the datastore that is being used by the composed task runner
Also, All child apps must have the same database dependency as the composed task runner enumerated in their <code>pom.xml</code> or <code>gradle.build</code> file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_launching_a_task_externally_from_spring_cloud_data_flow"><a class="anchor" href="#_launching_a_task_externally_from_spring_cloud_data_flow"></a>41.2.4. Launching a task externally from Spring Cloud Data Flow</h4>
<div class="paragraph">
<p>Users may wish to launch Spring Cloud Task applications via another method (scheduler for example) but still track the task execution via Spring Cloud Data Flow.
This can be done so long as the task applications observe the rules specified <a href="#a-common-datastore-dependency">here</a> and <a href="#a-common-datastore">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a user wishes to use Spring Cloud Data Flow to view their
<a href="https://projects.spring.io/spring-batch/">Spring Batch</a> jobs, the user must make sure that
their batch application use the <code>@EnableTask</code> annotation and follow the rules enumerated <a href="#a-common-datastore-dependency">here</a> and <a href="#a-common-datastore">here</a>.
More information is available <a href="https://github.com/spring-projects/spring-batch-admin/blob/master/MIGRATION.md">here</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-dataflow-schedule-launch-tasks"><a class="anchor" href="#spring-cloud-dataflow-schedule-launch-tasks"></a>42. Scheduling Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow lets a user schedule the execution of tasks via a cron expression.
A schedule can be created through the RESTful API or the Spring Cloud Data Flow UI.</p>
</div>
<div class="sect2">
<h3 id="_the_scheduler"><a class="anchor" href="#_the_scheduler"></a>42.1. The Scheduler</h3>
<div class="paragraph">
<p>Spring Cloud Data Flow will schedule the execution of its tasks via a scheduling agent that is available on the cloud platform.
When using the Cloud Foundry platform Spring Cloud Data Flow will use the <a href="https://www.cloudfoundry.org/the-foundry/scheduler/">PCF Scheduler</a>.
When using Kubernetes, a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/">CronJob</a> will be used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-scheduling-architecture.png" alt="Scheduler Architecture Overview">
</div>
<div class="title">Figure 11. Architectural Overview</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_scheduling"><a class="anchor" href="#_enabling_scheduling"></a>42.2. Enabling Scheduling</h3>
<div class="paragraph">
<p>By default the Spring Cloud Data Flow leaves the scheduling feature disabled.  To enable the scheduling feature the following feature properties must be set to <code>true</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.dataflow.features.schedules-enabled</code></p>
</li>
<li>
<p><code>spring.cloud.dataflow.features.tasks-enabled</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_lifecycle_of_a_schedule"><a class="anchor" href="#_the_lifecycle_of_a_schedule"></a>42.3. The Lifecycle of a Schedule</h3>
<div class="paragraph">
<p>The lifecycle of a schedule has 2 parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spring-cloud-data-flow-schedule-scheduling">Scheduling a Task Execution</a></p>
</li>
<li>
<p><a href="#spring-cloud-data-flow-schedule-unscheduling">Deleting a Schedule</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="spring-cloud-data-flow-schedule-scheduling"><a class="anchor" href="#spring-cloud-data-flow-schedule-scheduling"></a>42.3.1. Scheduling a Task Execution</h4>
<div class="paragraph">
<p>You can schedule a task execution via the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RESTful API</p>
</li>
<li>
<p>Spring Cloud Data Flow Dashboard</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To schedule a task from the UI click the Tasks tab at the top of the screen, this will take you to the Task Definitions screen.   Then from the Task Definition that you wish to schedule click the "clock" icon associated with task definition you wish to schedule.
This will lead you to a <code>Create Schedule(s)</code> screen, where you will create a unique name for the schedule and enter the associated cron expression.
Keep in mind you can always create multiple schedules for a single task definition.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-data-flow-schedule-unscheduling"><a class="anchor" href="#spring-cloud-data-flow-schedule-unscheduling"></a>42.3.2. Deleting a Schedule</h4>
<div class="paragraph">
<p>You can delete a schedule via the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RESTful API</p>
</li>
<li>
<p>Spring Cloud Data Flow Dashboard</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To delete a schedule through the dashboard, select the Schedule tab under Tasks tab and click the <code>garbage can</code> icon next to the schedule you wish to delete.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any currently running tasks that were run by the scheduling agent will not be stopped if the schedule is deleted.   It only prevents future executions.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<h1 id="dashboard" class="sect0"><a class="anchor" href="#dashboard"></a>Dashboard</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section describes how to use the dashboard of Spring Cloud Data Flow.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-introduction"><a class="anchor" href="#dashboard-introduction"></a>43. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow provides a browser-based GUI called the dashboard to manage the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Apps</strong>: The Apps tab lists all available applications and provides the controls to register/unregister them.</p>
</li>
<li>
<p><strong>Runtime</strong>: The Runtime tab provides the list of all running applications.</p>
</li>
<li>
<p><strong>Streams</strong>: The Streams tab lets you list, design, create, deploy, and destroy Stream Definitions.</p>
</li>
<li>
<p><strong>Tasks</strong>: The Tasks tab lets you list, create, launch, schedule and, destroy Task Definitions.</p>
</li>
<li>
<p><strong>Jobs</strong>: The Jobs tab lets you perform batch job related functions.</p>
</li>
<li>
<p><strong>Analytics</strong>: The Analytics tab lets you create data visualizations for the various analytics applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon starting Spring Cloud Data Flow, the dashboard is available at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://&lt;host&gt;:&lt;port&gt;/dashboard" class="bare">&lt;host&gt;:&lt;port&gt;/dashboard</a></code></p>
</div>
<div class="paragraph">
<p>For example, if Spring Cloud Data Flow is running locally, the dashboard is available at <code>http://localhost:9393/dashboard</code>.</p>
</div>
<div class="paragraph">
<p>If you have enabled https, then the dashboard will be located at <code>https://localhost:9393/dashboard</code>.
If you have enabled security, a login form is available at <code>http://localhost:9393/dashboard/#/login</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default Dashboard server port is <code>9393</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following image shows the opening page of the Spring Cloud Data Flow dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-dashboard-about.png" alt="The Spring Cloud Data Flow Dashboard">
</div>
<div class="title">Figure 12. The Spring Cloud Data Flow Dashboard</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-apps"><a class="anchor" href="#dashboard-apps"></a>44. Apps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Apps section of the dashboard lists all the available applications and provides the controls to register and unregister them (if applicable).
It is possible to import a number of applications at once by using the Bulk Import Applications action.</p>
</div>
<div class="paragraph">
<p>The following image shows a typical list of available apps within the dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-available-apps-list.png" alt="List of available applications">
</div>
<div class="title">Figure 13. List of Available Applications</div>
</div>
<div class="sect2">
<h3 id="_bulk_import_of_applications"><a class="anchor" href="#_bulk_import_of_applications"></a>44.1. Bulk Import of Applications</h3>
<div class="paragraph">
<p>The Bulk Import Applications page provides numerous options for defining and importing a set of applications all at once.
For bulk import, the application definitions are expected to be expressed in a properties style, as follows:</p>
</div>
<div class="paragraph">
<p><code>&lt;type&gt;.&lt;name&gt; = &lt;coordinates&gt;</code></p>
</div>
<div class="paragraph">
<p>The following examples show a typical application definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>task.timestamp=maven://org.springframework.cloud.task.app:timestamp-task:1.2.0.RELEASE
processor.transform=maven://org.springframework.cloud.stream.app:transform-processor-rabbit:1.2.0.RELEASE</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the top of the bulk import page, a URI can be specified that points to a properties file stored elsewhere, it should contain properties formatted as shown in the previous example.
Alternatively, by using the textbox labeled &#8220;Apps as Properties&#8221;, you can directly list each property string. Finally, if the properties are stored in a local file, the &#8220;Select Properties File&#8221; option opens a local file browser to select the file.
After setting your definitions through one of these routes, click Import.</p>
</div>
<div class="paragraph">
<p>The following image shows the Bulk Import Applications page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-bulk-import-applications.png" alt="Bulk Import Applications">
</div>
<div class="title">Figure 14. Bulk Import Applications</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-runtime"><a class="anchor" href="#dashboard-runtime"></a>45. Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Runtime section of the Dashboard application shows the list of all running applications.
For each runtime app, the state of the deployment and the number of deployed instances is shown.
A list of the used deployment properties is available by clicking on the App Id.</p>
</div>
<div class="paragraph">
<p>The following image shows an example of the Runtime tab in use:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-runtime.png" alt="List of running applications">
</div>
<div class="title">Figure 15. List of Running Applications</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-streams"><a class="anchor" href="#dashboard-streams"></a>46. Streams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Streams tab has two child tabs: Definitions and Create Stream. The following topics describe how to work with each one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dashboard-stream-definitions">Working with Stream Definitions</a></p>
</li>
<li>
<p><a href="#dashboard-flo-streams-designer">Creating a Stream</a></p>
</li>
<li>
<p><a href="#dashboard-stream-deploy">Deploying a Stream</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="dashboard-stream-definitions"><a class="anchor" href="#dashboard-stream-definitions"></a>46.1. Working with Stream Definitions</h3>
<div class="paragraph">
<p>The Streams section of the Dashboard includes the Definitions tab that provides a listing of Stream definitions.
There you have the option to deploy or undeploy those stream definitions.
Additionally, you can remove the definition by clicking on Destroy.
Each row includes an arrow on the left, which you can click to see a visual representation of the definition.
Hovering over the boxes in the visual representation shows more details about the apps, including any options passed to them.</p>
</div>
<div class="paragraph">
<p>In the following screenshot, the <code>timer</code> stream has been expanded to show the visual representation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-streams-list-definitions.png" alt="List of Stream Definitions">
</div>
<div class="title">Figure 16. List of Stream Definitions</div>
</div>
<div class="paragraph">
<p>If you click the details button, the view changes to show a visual representation of that stream and any related streams.
In the preceding example, if you click details for the <code>timer</code> stream, the view changes to the following view, which clearly shows the relationship between the three streams (two of them are tapping into the <code>timer</code> stream):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-stream-details.png" alt="Stream Details Page">
</div>
<div class="title">Figure 17. Stream Details Page</div>
</div>
</div>
<div class="sect2">
<h3 id="dashboard-flo-streams-designer"><a class="anchor" href="#dashboard-flo-streams-designer"></a>46.2. Creating a Stream</h3>
<div class="paragraph">
<p>The Streams section of the Dashboard includes the Create Stream tab, which makes available the <a href="https://github.com/spring-projects/spring-flo">Spring Flo</a> designer: a canvas application that offers an interactive graphical interface for creating data pipelines.</p>
</div>
<div class="paragraph">
<p>In this tab, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create, manage, and visualize stream pipelines using DSL, a graphical canvas, or both</p>
</li>
<li>
<p>Write pipelines via DSL with content-assist and auto-complete</p>
</li>
<li>
<p>Use auto-adjustment and grid-layout capabilities in the GUI for simpler and interactive organization of pipelines</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should watch this <a href="https://www.youtube.com/watch?v=78CgV46OstI">screencast</a> that highlights some of the "Flo for Spring Cloud Data Flow" capabilities.
The Spring Flo <a href="https://github.com/spring-projects/spring-flo/wiki">wiki</a> includes more detailed content on core Flo capabilities.</p>
</div>
<div class="paragraph">
<p>The following image shows the Flo designer in use:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-flo-create-stream.png" alt="Flo for Spring Cloud Data Flo">
</div>
<div class="title">Figure 18. Flo for Spring Cloud Data Flow</div>
</div>
</div>
<div class="sect2">
<h3 id="dashboard-stream-deploy"><a class="anchor" href="#dashboard-stream-deploy"></a>46.3. Deploying a Stream</h3>
<div class="paragraph">
<p>The stream deploy page includes tabs that provide different ways to setup the deployment properties and deploy the stream.
The following screenshots show the stream deploy page for <code>foobar</code> (<code>time | log</code>).</p>
</div>
<div class="paragraph">
<p>You can define deployments properties using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Form builder tab: a builder which help you to define deployment properties (deployer, application properties&#8230;&#8203;)</p>
</li>
<li>
<p>Free text tab: a free textarea (key/value pairs)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can switch between the both views, the form builder provides a more stronger validation of the inputs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-stream-deploy-builder.png" alt="Form builder">
</div>
<div class="title">Figure 19. The following image shows the form builder</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-stream-deploy-freetext.png" alt="Free text">
</div>
<div class="title">Figure 20. The following image shows the same properties in the free text</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_fan_in_fan_out_streams"><a class="anchor" href="#_creating_fan_in_fan_out_streams"></a>46.4. Creating Fan-In/Fan-Out Streams</h3>
<div class="paragraph">
<p>In chapter <a href="#spring-cloud-dataflow-stream-dsl-fanin-fanout">Fan-in and Fan-out</a> you learned how we can support fan-in and fan-out use cases using <a href="#spring-cloud-dataflow-stream-dsl-named-destinations">named destinations</a>.
The UI provides dedicated support for named destinations as well:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-flo-create-stream-fanin-fanout.png" alt="Fan-in and Fan-out example">
</div>
<div class="title">Figure 21. Flo for Spring Cloud Data Flow</div>
</div>
<div class="paragraph">
<p>In this example we have data from an <em>HTTP Source</em> and a <em>JDBC Source</em> that is being sent to the
<em>sharedData</em> channel which represents a <strong>Fan-in</strong> use case.
On the other end we have a <em>Cassandra Sink</em> and a <em>File Sink</em> subscribed to the <em>sharedData</em> channel which represents a <strong>Fan-out</strong> use case.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_tap_stream"><a class="anchor" href="#_creating_a_tap_stream"></a>46.5. Creating a Tap Stream</h3>
<div class="paragraph">
<p>Creating Taps using the Dashboard is straightforward.
Let&#8217;s say you have stream consisting of an <em>HTTP Source</em> and a <em>File Sink</em> and you would like to tap into the stream
to also send data to a <em>JDBC Sink</em>.
In order to create the tap stream simply connect the output connector of the <em>HTTP Source</em> to the <em>JDBC Sink</em>.
The connection will be displayed as a dotted line, indicating that you created a tap stream.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-flo-create-tap-stream.png" alt="Tap stream example">
</div>
<div class="title">Figure 22. Creating a Tap Stream</div>
</div>
<div class="paragraph">
<p>The primary stream (<em>HTTP Source</em> to <em>File Sink</em>) will be automatically named, in case you did not provide a name for the stream, yet.
When creating tap streams, the primary stream must always be explicitly named.
In the picture above, the primary stream was named <em>HTTP_INGEST</em>.</p>
</div>
<div class="paragraph">
<p>Using the Dashboard, you can also switch the primary stream to become the secondary tap stream.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-flo-tap-stream-switch-to-primary-stream.png" alt="Switch tap stream to primary stream">
</div>
<div class="title">Figure 23. Change Primary Stream to Secondary Tap Stream</div>
</div>
<div class="paragraph">
<p>Simply hover over the existing primary stream, the line between <em>HTTP Source</em> and <em>File Sink</em>.
Several control icons will appear, and by clicking on the icon labeled <em>Switch to/from tap</em>,
you change the primary stream into a tap stream.
Do the same for the tap stream and switch it to a primary stream.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-flo-tap-stream-switch-to-primary-stream-result.png" alt="End result of switching the tap stream to a primary stream">
</div>
<div class="title">Figure 24. End Result of Switching the Primary Stream</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When interacting directly with <a href="#spring-cloud-dataflow-stream-dsl-named-destinations">named destinations</a>,
there can be "n" combinations (Inputs/Outputs). This allows you to create complex topologies involving a
wide variety of data sources and destinations.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-tasks"><a class="anchor" href="#dashboard-tasks"></a>47. Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Tasks section of the Dashboard currently has three tabs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dashboard-tasks-apps">Apps</a></p>
</li>
<li>
<p><a href="#dashboard-task-definition">Definitions</a></p>
</li>
<li>
<p><a href="#dashboard-tasks-executions">Executions</a></p>
</li>
<li>
<p><a href="#dashboard-task-scheduling">Scheduling</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="dashboard-tasks-apps"><a class="anchor" href="#dashboard-tasks-apps"></a>47.1. Apps</h3>
<div class="paragraph">
<p>Each app encapsulates a unit of work into a reusable component.
Within the Data Flow runtime environment, apps let users create definitions for streams as well as tasks.
Consequently, the Apps tab within the Tasks section lets users create task definitions.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also use this tab to create Batch Jobs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following image shows a typical list of task apps:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-task-apps-list.png" alt="List of Task Apps">
</div>
<div class="title">Figure 25. List of Task Apps</div>
</div>
<div class="paragraph">
<p>On this screen, you can perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View details, such as the task app options.</p>
</li>
<li>
<p>Create a task definition from the respective app.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_view_task_app_details"><a class="anchor" href="#_view_task_app_details"></a>47.1.1. View Task App Details</h4>
<div class="paragraph">
<p>On this page you can view the details of a selected task app, including the list of available options (properties) for that app.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_task_definition"><a class="anchor" href="#_create_a_task_definition"></a>47.1.2. Create a Task Definition</h4>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-task-definition-create.png" alt="List of Task Apps">
</div>
</div>
<div class="paragraph">
<p>At a minimum, you must provide a name for the new definition.
You also have the option to specify various properties that are used during the deployment of the app.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Each parameter is included only if the Include checkbox is selected.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dashboard-task-definition"><a class="anchor" href="#dashboard-task-definition"></a>47.2. Definitions</h3>
<div class="paragraph">
<p>This page lists the Data Flow task definitions and provides actions to launch or destroy those tasks.
It also provides a shortcut operation to define one or more tasks with simple textual input, indicated by
the Bulk Define Tasks button.</p>
</div>
<div class="paragraph">
<p>The following image shows the Definitions page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-task-definitions-list.png" alt="List of Task Definitions">
</div>
<div class="title">Figure 26. List of Task Definitions</div>
</div>
<div class="sect3">
<h4 id="_creating_composed_task_definitions"><a class="anchor" href="#_creating_composed_task_definitions"></a>47.2.1. Creating Composed Task Definitions</h4>
<div class="paragraph">
<p>The dashboard includes the Create Composed Task tab, which provides an interactive graphical interface for creating composed tasks.</p>
</div>
<div class="paragraph">
<p>In this tab, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create and visualize composed tasks using DSL, a graphical canvas, or both.</p>
</li>
<li>
<p>Use auto-adjustment and grid-layout capabilities in the GUI for simpler and interactive organization of the composed task.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On the Create Composed Task screen, you can define one or more task parameters by entering both the parameter key and the parameter value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Task parameters are not typed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following image shows the composed task designer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-flo-tab.png" alt="Composed Task Designer">
</div>
<div class="title">Figure 27. Composed Task Designer</div>
</div>
</div>
<div class="sect3">
<h4 id="_launching_tasks"><a class="anchor" href="#_launching_tasks"></a>47.2.2. Launching Tasks</h4>
<div class="paragraph">
<p>Once the task definition has been created, the tasks can be launched through the dashboard.
To do so, click the Definitions tab and select the task you want to launch by pressing <code>Launch</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dashboard-tasks-executions"><a class="anchor" href="#dashboard-tasks-executions"></a>47.3. Executions</h3>
<div class="paragraph">
<p>The Executions tab shows the current running and completed tasks.</p>
</div>
<div class="paragraph">
<p>The following image shows the Executions tab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-task-executions-list.png" alt="List of Task Executions">
</div>
<div class="title">Figure 28. List of Task Executions</div>
</div>
</div>
<div class="sect2">
<h3 id="dashboard-tasks-execution-detail"><a class="anchor" href="#dashboard-tasks-execution-detail"></a>47.4. Execution Detail</h3>
<div class="paragraph">
<p>For each task execution on the Executions page, a user can retrieve detailed information about a specific execution by clicking the information icon located to the right of the task execution.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-task-execution-detail.png" alt="List of Task Executions">
</div>
</div>
<div class="paragraph">
<p>On this screen the user can view not only the information from the Task Executions page but also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Task Arguments</p>
</li>
<li>
<p>External Execution Id</p>
</li>
<li>
<p>Batch Job Indicator (indicates if the task execution contained Spring Batch jobs.)</p>
</li>
<li>
<p>Job Execution Ids links (Clicking the Job Execution Id will take you to the <a href="#dashboard-job-executions-details">Job Execution Details</a> for that Job Execution Id.)</p>
</li>
<li>
<p>Task Execution Duration</p>
</li>
<li>
<p>Task Execution Exit Message</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-jobs"><a class="anchor" href="#dashboard-jobs"></a>48. Jobs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Jobs section of the Dashboard lets you inspect batch jobs.
The main section of the screen provides a list of job executions.
Batch jobs are tasks that each execute one or more batch jobs.
Each job execution has a reference to the task execution ID (in the Task Id column).</p>
</div>
<div class="paragraph">
<p>The list of Job Executions also shows the state of the underlying Job Definition.
Thus, if the underlying definition has been deleted, &#8220;No definition found&#8221; appears in the Status column.</p>
</div>
<div class="paragraph">
<p>You can take the following actions for each job:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restart (for failed jobs).</p>
</li>
<li>
<p>Stop (for running jobs).</p>
</li>
<li>
<p>View execution details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: Clicking the stop button actually sends a stop request to the running job, which may not immediately stop.</p>
</div>
<div class="paragraph">
<p>The following image shows the Jobs page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-job-executions-list.png" alt="List of Job Executions">
</div>
<div class="title">Figure 29. List of Job Executions</div>
</div>
<div class="sect2">
<h3 id="dashboard-job-executions-details"><a class="anchor" href="#dashboard-job-executions-details"></a>48.1. Job Execution Details</h3>
<div class="paragraph">
<p>After having launched a batch job, the Job Execution Details page will show information about the job.</p>
</div>
<div class="paragraph">
<p>The following image shows the Job Execution Details page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-jobs-job-execution-details.png" alt="Job Execution Details">
</div>
<div class="title">Figure 30. Job Execution Details</div>
</div>
<div class="paragraph">
<p>The Job Execution Details page contains a list of the executed steps.
You can further drill into the details of each step&#8217;s execution by clicking the magnifying glass icon.</p>
</div>
</div>
<div class="sect2">
<h3 id="dashboard-job-executions-steps"><a class="anchor" href="#dashboard-job-executions-steps"></a>48.2. Step Execution Details</h3>
<div class="paragraph">
<p>The Step Execution Details page provides information about an individual step within a job.</p>
</div>
<div class="paragraph">
<p>The following image shows the Step Execution Details page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-step-execution-history.png" alt="Step Execution History">
</div>
<div class="title">Figure 31. Step Execution Details</div>
</div>
<div class="paragraph">
<p>On the top of the page, you can see a progress indicator the respective step, with the option to refresh the indicator.
A link is provided to view the step execution history.</p>
</div>
<div class="paragraph">
<p>The Step Execution Details screen provides a complete list of all Step Execution Context key/value pairs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For exceptions, the Exit Description field contains additional error information.
However, this field can have a maximum of 2500 characters.
Therefore, in the case of long exception stack traces, trimming of error messages may occur.
When that happens, refer to the server log files for further details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dashboard-job-executions-steps-progress"><a class="anchor" href="#dashboard-job-executions-steps-progress"></a>48.3. Step Execution Progress</h3>
<div class="paragraph">
<p>On this screen, you can see a progress bar indicator in regards to the execution
of the current step. Under the Step Execution History, you can also view various
metrics associated with the selected step, such as duration, read counts, write
counts, and others.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-task-scheduling"><a class="anchor" href="#dashboard-task-scheduling"></a>49. Scheduling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_creating_or_deleting_a_schedule_from_the_task_definition_s_page"><a class="anchor" href="#_creating_or_deleting_a_schedule_from_the_task_definition_s_page"></a>49.1. Creating or deleting a Schedule from the Task Definition&#8217;s page</h3>
<div class="paragraph">
<p>From the Task Definitions page a user can create or delete a schedule for a specific task definition.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-scheduling-task-definition.png" alt="Task Definitions with Schedule Controls">
</div>
<div class="title">Figure 32. Task Definitions with Schedule controls</div>
</div>
<div class="paragraph">
<p>On this screen you can perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user can click the clock icon and this will take you to the Schedule Creation screen.</p>
</li>
<li>
<p>The user can click the clock icon with the <code>x</code> to the upper right to delete the schedule(s) associated with the task definition.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_schedule"><a class="anchor" href="#_creating_a_schedule"></a>49.2. Creating a Schedule</h3>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-scheduling-create.png" alt="Create Schedule for Task Execution">
</div>
<div class="title">Figure 33. Create Schedule for Task Execution</div>
</div>
<div class="paragraph">
<p>Once the user clicks the clock icon on the Task Definition screen, Spring Cloud Data Flow will take the user to the Schedule Creation screen.
On this screen a user can establish the schedule name, the cron expression as well as establish the properties and arguments to be used when the task is launched by this schedule.</p>
</div>
</div>
<div class="sect2">
<h3 id="_listing_available_schedules"><a class="anchor" href="#_listing_available_schedules"></a>49.3. Listing Available Schedules</h3>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-scheduling-list.png" alt="List Available Schedules">
</div>
<div class="title">Figure 34. List Available Schedules</div>
</div>
<div class="paragraph">
<p>On this screen you can perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete a schedule</p>
</li>
<li>
<p>Get details for a schedule</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-analytics"><a class="anchor" href="#dashboard-analytics"></a>50. Analytics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Analytics page of the Dashboard provides the following data visualization capabilities for the various analytics applications available in Spring Cloud Data Flow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Counters</p>
</li>
<li>
<p>Field-Value Counters</p>
</li>
<li>
<p>Aggregate Counters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if you create a stream with a <a href="https://github.com/spring-cloud-stream-app-starters/counter/tree/master/spring-cloud-starter-stream-sink-counter">Counter</a> application, you can create the corresponding graph from within the Dashboard tab.
To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Under <code>Metric Type</code>, select <code>Counters</code> from the select box.</p>
</li>
<li>
<p>Under <code>Stream</code>, select <code>tweetcount</code>.</p>
</li>
<li>
<p>Under <code>Visualization</code>, select the desired chart option, <code>Bar Chart</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using the icons to the right, you can add additional charts to the Dashboard, re-arange the order of created dashboards, or remove data visualizations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dashboard-auditing"><a class="anchor" href="#dashboard-auditing"></a>51. Auditing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Auditing page of the Dashboard gives you access to recorded audit events. Currently audit event
are recorded for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Streams</p>
<div class="ulist">
<ul>
<li>
<p>Create</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Deploy</p>
</li>
<li>
<p>Undeploy</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tasks</p>
<div class="ulist">
<ul>
<li>
<p>Create</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Launch</p>
</li>
</ul>
</div>
</li>
<li>
<p>Scheduling of Tasks</p>
<div class="ulist">
<ul>
<li>
<p>Create Schedule</p>
</li>
<li>
<p>Delete Schedule</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-audit-records-list.png" alt="List Available Audit Records">
</div>
<div class="title">Figure 35. List Overview of Audit Records</div>
</div>
<div class="paragraph">
<p>By clicking on the <em>Show Details</em> icon, you can obtain further details regarding
the auditing details:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.7.4.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-audit-records-details.png" alt="Details of a single Audit Record">
</div>
<div class="title">Figure 36. List Details of an Audit Record</div>
</div>
<div class="paragraph">
<p>Generally, auditing provides the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When was the record created?</p>
</li>
<li>
<p>Username that triggered the audit event (if security is enabled)</p>
</li>
<li>
<p>Audit operation (Schedule, Stresm, Task)</p>
</li>
<li>
<p>Performed action (Create, Delete, Deploy, Rollback, Undeploy, Update)</p>
</li>
<li>
<p>Correlation Id, e.g. Stream/Task name</p>
</li>
<li>
<p>Audit Data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The written value of the property <em>Audit Data</em> depends on the performed <em>Audit Operation</em> and the <em>ActionType</em>.
For example, when a Schedule is being created, the name of the task definition,
task definition properties, deployment properties, as well as command line arguments are written
to the persistence store.</p>
</div>
<div class="paragraph">
<p>Sensitive information is sanitized prior to saving the Audit Record, in an <em>best-effort-manner</em>.
Any of the following keys are being detected and its sensitive values are
masked:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>password</p>
</li>
<li>
<p>secret</p>
</li>
<li>
<p>key</p>
</li>
<li>
<p>token</p>
</li>
<li>
<p>.*credentials.*</p>
</li>
<li>
<p>vcap_services</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="api-guide" class="sect0"><a class="anchor" href="#api-guide"></a>REST API Guide</h1>
<div class="openblock partintro">
<div class="content">
You can find the documentation about the Data Flow REST API in the <a href="http://docs.spring.io/spring-cloud-dataflow/docs//reference/htmlsingle/index.html#api-guide">core documentation</a>.
</div>
</div>
<h1 id="appendix" class="sect0"><a class="anchor" href="#appendix"></a>Appendices</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Having trouble with Spring Cloud Data Flow? We want to help!</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ask a question. We monitor <a href="http://stackoverflow.com">stackoverflow.com</a> for questions
tagged with <a href="http://stackoverflow.com/tags/spring-cloud-dataflow"><code>spring-cloud-dataflow</code></a>.</p>
</li>
<li>
<p>Report bugs with Spring Cloud Data Flow at <a href="https://github.com/spring-cloud/spring-cloud-dataflow/issues" class="bare">github.com/spring-cloud/spring-cloud-dataflow/issues</a>.</p>
</li>
<li>
<p>Report bugs with Spring Cloud Data Flow for Kubernetes at <a href="https://github.com/spring-cloud/spring-cloud-dataflow-server-kubernetes/issues" class="bare">github.com/spring-cloud/spring-cloud-dataflow-server-kubernetes/issues</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="howto"><a class="anchor" href="#howto"></a>Appendix E: &#8220;How-to&#8221; guides</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides answers to some common &#8220;how do I do that&#8230;&#8203;&#8221; type of questions
that often arise when developers use Spring Cloud Data Flow.</p>
</div>
<div class="paragraph">
<p>If you have a specific problem that we don&#8217;t cover here, you might want to check out
<a href="http://stackoverflow.com/tags/spring-cloud-dataflow">stackoverflow.com</a> to see if someone has
already provided an answer. Stack Overflow is also a great place to ask new questions (please use
the <code>spring-cloud-dataflow</code> tag).</p>
</div>
<div class="paragraph">
<p>We are also more than happy to extend this section. If you want to add a &#8220;how-to&#8221;, you
can send us a <a href="http://github.com/spring-cloud/spring-cloud-dataflow-server-kubernetes">pull request</a>.</p>
</div>
<div class="sect1">
<h2 id="_logging"><a class="anchor" href="#_logging"></a>52. Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Data Flow is built upon several Spring projects, but ultimately the dataflow-server is a
Spring Boot app, so the logging techniques that apply to any <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/howto-logging.html#howto-logging">Spring Boot</a>
application are applicable here as well.</p>
</div>
<div class="paragraph">
<p>While troubleshooting, the following are the two primary areas where enabling the DEBUG logs could be useful.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#howto-deployment-logs">Deployment Logs</a></p>
</li>
<li>
<p><a href="#howto-application-logs">Application Logs</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="howto-deployment-logs"><a class="anchor" href="#howto-deployment-logs"></a>52.1. Deployment Logs</h3>
<div class="paragraph">
<p>Spring Cloud Data Flow builds upon the <a href="https://github.com/spring-cloud/spring-cloud-deployer">Spring Cloud Deployer</a> SPI. The platform-specific dataflow-server uses the respective <a href="https://github.com/spring-cloud?utf8=%E2%9C%93&amp;query=deployer">SPI implementations</a>.
Specifically, if you want to troubleshoot deployment-specific issues (such as the network errors), it helps
to enable the DEBUG logs at the underlying deployer and the libraries used by it.</p>
</div>
<div class="paragraph">
<p>For instance, if you want to enable DEBUG logs for the <a href="https://github.com/spring-cloud/spring-cloud-deployer-kubernetes/tree/master/spring-cloud-deployer-kubernetes">kubernetes-deployer</a>,
start the server with following environment variable:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_CLOUD_DEPLOYER_SPI_KUBERNETES=DEBUG</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="howto-application-logs"><a class="anchor" href="#howto-application-logs"></a>52.2. Application Logs</h3>
<div class="paragraph">
<p>The streaming applications in Spring Cloud Data Flow are Spring Boot applications, and you can set them up
independently with logging configurations.</p>
</div>
<div class="paragraph">
<p>For instance, if you need to troubleshoot the <code>header</code> and <code>payload</code> specifics that are being passed
around source, processor, and sink channels, you can deploy the stream with the following
options:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream create foo --definition "http --logging.level.org.springframework.integration=DEBUG | transform --logging.level.org.springframework.integration=DEBUG | log --logging.level.org.springframework.integration=DEBUG" --deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>org.springframework.integration</code> is the global package for everything related to Spring Integration,
which is responsible for messaging channels</p>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also enable the DEBUG logs individually for each application or as a global setting for all the applications in the stream by using deployment properties when you deploy the stream, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dataflow:&gt;stream deploy foo --properties "app.*.logging.level.org.springframework.integration=DEBUG"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dataflow-template"><a class="anchor" href="#dataflow-template"></a>Appendix A: Data Flow Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in the previous chapter, Spring Cloud Data Flow&#8217;s functionality is completely exposed through REST endpoints.
While you can use those endpoints directly, Spring Cloud Data Flow also provides a Java-based API, which makes using those REST endpoints even easier.</p>
</div>
<div class="paragraph">
<p>The central entry point is the <code>DataFlowTemplate</code> class in the <code>org.springframework.cloud.dataflow.rest.client</code> package.</p>
</div>
<div class="paragraph">
<p>This class implements the <code>DataFlowOperations</code> interface and delegates to the following sub-templates that provide the specific functionality for each feature-set:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StreamOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for stream operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CounterOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for counter operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FieldValueCounterOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for field value counter operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AggregateCounterOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for aggregate counter operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TaskOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for task operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JobOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for job operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AppRegistryOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for app registry operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletionOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST client for completion operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuntimeOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST Client for runtime operations</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>DataFlowTemplate</code> is being initialized, the sub-templates can be discovered through the REST relations, which are provided by HATEOAS.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If a resource cannot be resolved, the respective sub-template results
in NULL. A common cause is that Spring Cloud Data Flow offers for specific
sets of features to be enabled/disabled when launching. For more information, see &#8220;<a href="#enable-disable-specific-features">Feature Toggles</a>&#8221;.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_using_the_data_flow_template"><a class="anchor" href="#_using_the_data_flow_template"></a>A.1. Using the Data Flow Template</h3>
<div class="paragraph">
<p>When you use the Data Flow Template, the only needed Data Flow dependency is the
Spring Cloud Data Flow Rest Client, as shown in the following Maven snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-dataflow-rest-client&lt;/artifactId&gt;
  &lt;version&gt;1.7.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that dependency, you get the <code>DataFlowTemplate</code> class as well as all the dependencies needed to make calls to a Spring Cloud Data Flow server.</p>
</div>
<div class="paragraph">
<p>When instantiating the <code>DataFlowTemplate</code>, you also pass in a <code>RestTemplate</code>.
Please be aware that the needed <code>RestTemplate</code> requires some additional configuration to be valid in the context of the <code>DataFlowTemplate</code>.
When declaring a <code>RestTemplate</code> as a bean, the following configuration suffices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  @Bean
  public static RestTemplate restTemplate() {
    RestTemplate restTemplate = new RestTemplate();
    restTemplate.setErrorHandler(new VndErrorResponseErrorHandler(restTemplate.getMessageConverters()));
    for(HttpMessageConverter&lt;?&gt; converter : restTemplate.getMessageConverters()) {
      if (converter instanceof MappingJackson2HttpMessageConverter) {
        final MappingJackson2HttpMessageConverter jacksonConverter =
            (MappingJackson2HttpMessageConverter) converter;
        jacksonConverter.getObjectMapper()
            .registerModule(new Jackson2HalModule())
            .addMixIn(JobExecution.class, JobExecutionJacksonMixIn.class)
            .addMixIn(JobParameters.class, JobParametersJacksonMixIn.class)
            .addMixIn(JobParameter.class, JobParameterJacksonMixIn.class)
            .addMixIn(JobInstance.class, JobInstanceJacksonMixIn.class)
            .addMixIn(ExitStatus.class, ExitStatusJacksonMixIn.class)
            .addMixIn(StepExecution.class, StepExecutionJacksonMixIn.class)
            .addMixIn(ExecutionContext.class, ExecutionContextJacksonMixIn.class)
            .addMixIn(StepExecutionHistory.class, StepExecutionHistoryJacksonMixIn.class);
      }
    }
    return restTemplate;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can instantiate the <code>DataFlowTemplate</code> with the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">DataFlowTemplate dataFlowTemplate = new DataFlowTemplate(
    new URI("http://localhost:9393/"), restTemplate);         <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>URI</code> points to the ROOT of your Spring Cloud Data Flow Server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on your requirements, you can now make calls to the server. For instance,
if you want to get a list of currently available applications you can run the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PagedResources&lt;AppRegistrationResource&gt; apps = dataFlowTemplate.appRegistryOperations().list();

System.out.println(String.format("Retrieved %s application(s)",
    apps.getContent().size()));

for (AppRegistrationResource app : apps.getContent()) {
  System.out.println(String.format("App Name: %s, App Type: %s, App URI: %s",
    app.getName(),
    app.getType(),
    app.getUri()));
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrationguide"><a class="anchor" href="#migrationguide"></a>Appendix B: Spring XD to SCDF</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix describes how to migrate from Spring XD to Spring Cloud Data Flow, along with some tips and tricks that may be helpful.</p>
</div>
<div class="sect2">
<h3 id="_terminology_changes"><a class="anchor" href="#_terminology_changes"></a>B.1. Terminology Changes</h3>
<div class="paragraph">
<p>The following table describes the changes in terminology from Spring XD to Spring Cloud Data Flow:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old</th>
<th class="tableblock halign-left valign-top">New</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XD-Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server (implementations: local, Cloud Foundry, and Kubernetes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XD-Container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dashboard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Bus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binders</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch / Job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_modules_to_applications"><a class="anchor" href="#_modules_to_applications"></a>B.2. Modules to Applications</h3>
<div class="paragraph">
<p>If you have custom Spring XD modules, you need refactor them to use Spring Cloud Stream and Spring Cloud Task annotations.
As part of that work, you need to update dependencies and build them as normal Spring Boot applications.</p>
</div>
<div class="sect3">
<h4 id="_custom_applications"><a class="anchor" href="#_custom_applications"></a>B.2.1. Custom Applications</h4>
<div class="paragraph">
<p>As you convert custom applications, keep the following information in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring XD&#8217;s stream and batch modules are refactored into the <a href="https://github.com/spring-cloud-stream-app-starters">Spring Cloud Stream</a> and <a href="https://github.com/spring-cloud-task-app-starters">Spring Cloud Task</a> application-starters, respectively.
These applications can be used as the reference while refactoring Spring XD modules.</p>
</li>
<li>
<p>There are also some samples for <a href="https://github.com/spring-cloud/spring-cloud-stream-samples">Spring Cloud Stream</a> and <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples">Spring Cloud Task</a> applications for reference.</p>
</li>
<li>
<p>If you want to create a brand new custom application, use the getting started guide for <a href="http://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle/#_getting_started">Spring Cloud Stream</a> and <a href="http://docs.spring.io/spring-cloud-task/docs/current/reference/htmlsingle/#getting-started">Spring Cloud Task</a> applications and as well as  review the <a href="http://docs.spring.io/spring-cloud-stream-app-starters/docs/current/reference/htmlsingle/#_creating_your_own_applications">develeopment guide</a>.</p>
</li>
<li>
<p>Alternatively, if you want to patch any of the out-of-the-box stream applications, you can follow the procedure <a href="http://docs.spring.io/spring-cloud-stream-app-starters/docs/current/reference/htmlsingle/#_patching_pre_built_applications">described here</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_application_registration"><a class="anchor" href="#_application_registration"></a>B.2.2. Application Registration</h4>
<div class="paragraph">
<p>As you register your applications, keep the following information in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Custom Stream/Task applications can be registered as Spring Boot uber-jar for Cloud Foundry or local implementations.  They can also be registerd as a docker image for Local, Cloud Foundry, or Kuberenetes implementations.  Other than Maven and docker resolution, you can also resolve application artifacts from <code>http(s)</code> and <code>file</code> coordinates.</p>
</li>
<li>
<p>Unlike Spring XD, you do not have to upload the application bits while registering custom applications anymore.
Instead, you need to <a href="#spring-cloud-dataflow-register-stream-apps">register</a> the application coordinates that are hosted in the Maven repository or by other means as discussed in the previous bullet.</p>
</li>
<li>
<p>By default, none of the out-of-the-box applications are preloaded. It is intentionally designed to provide the flexibility to register apps as you find appropriate for the given use-case requirement.</p>
</li>
<li>
<p>Depending on the binder choice, you can manually add the appropriate binder dependency to build applications specific to that binder-type.
Alternatively, you can follow the <a href="http://start.spring.io">Spring Initializr</a> <a href="https://github.com/spring-cloud/spring-cloud-stream-app-starters/blob/master/spring-cloud-stream-app-starters-docs/src/main/asciidoc/overview.adoc#using-the-starters-to-create-custom-components">procedure</a> to create an application with binder embedded in it.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_application_properties_4"><a class="anchor" href="#_application_properties_4"></a>B.2.3. Application Properties</h4>
<div class="paragraph">
<p>As you modify your applications' properties, keep the following information in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Counter-sink:</p>
<div class="ulist">
<ul>
<li>
<p>The peripheral <code>redis</code> is not required in Spring Cloud Data Flow.
If you intend to use the <code>counter-sink</code>, then <code>redis</code> is required, and you need to have your own running <code>redis</code> cluster.</p>
</li>
</ul>
</div>
</li>
<li>
<p>field-value-counter-sink:</p>
<div class="ulist">
<ul>
<li>
<p>The peripheral <code>redis</code> is not required in Spring Cloud Data Flow.
If you intend to use the <code>field-value-counter-sink</code>, then <code>redis</code> becomes required, and you need to have your own running <code>redis</code> cluster.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Aggregate-counter-sink:</p>
<div class="ulist">
<ul>
<li>
<p>The peripheral <code>redis</code> is not required in Spring Cloud Data Flow.
If you intend to use the <code>aggregate-counter-sink</code>, then <code>redis</code> becomes required, and you need to have your own running <code>redis</code> cluster.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_message_bus_to_binders"><a class="anchor" href="#_message_bus_to_binders"></a>B.3. Message Bus to Binders</h3>
<div class="paragraph">
<p>Terminology wise, in Spring Cloud Data Flow, the message bus implementation is commonly referred to as binders.</p>
</div>
<div class="sect3">
<h4 id="_message_bus"><a class="anchor" href="#_message_bus"></a>B.3.1. Message Bus</h4>
<div class="paragraph">
<p>Similar to Spring XD, Spring Cloud Data Flow includes an abstraction that you can use to extend the binder interface.
By default, we take the opinionated view of <a href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka">Apache Kafka</a> and <a href="https://github.com/spring-cloud/spring-cloud-stream-binder-rabbit">RabbitMQ</a> as the production-ready binders.
They are available as GA releases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_binders"><a class="anchor" href="#_binders"></a>B.3.2. Binders</h4>
<div class="paragraph">
<p>Selecting a binder requires providing the right binder dependency in the classpath.
If you choose Kafka as the binder, you need to register stream applications that are pre-built with Kafka binder in it.
If you to create a custom application with Kafka binder, you need add the following dependency in the classpath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-stream-binder-kafka&lt;/artifactId&gt;
    &lt;version&gt;1.0.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Cloud Stream supports <a href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka">Apache Kafka</a> and  <a href="https://github.com/spring-cloud/spring-cloud-stream-binder-rabbit">RabbitMQ</a>.
All binder implementations are maintained and managed in their individual repositories.</p>
</li>
<li>
<p>Every Stream/Task application can be built with the binder implementation of your choice.
All the out-of-the-box applications are pre-built for both Kafka and Rabbit and are readily available for use as Maven artifacts (<a href="http://repo.spring.io/libs-milestone/org/springframework/cloud/stream/app/">Spring Cloud Stream</a> or <a href="http://repo.spring.io/libs-milestone/org/springframework/cloud/task/app/">Spring Cloud Task</a>) or as Docker images (<a href="https://hub.docker.com/r/springcloudstream/">Spring Cloud Stream</a> or <a href="https://hub.docker.com/r/springcloudtask/">Spring Cloud Task</a>).
Changing the binder requires selecting the right binder <a href="http://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle/#_binders">dependency</a>.
Alternatively, you can download the pre-built application from this version of <a href="http://start-scs.cfapps.io/">Spring Initializr</a> with the desired binder-starter dependency.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_named_channels"><a class="anchor" href="#_named_channels"></a>B.3.3. Named Channels</h4>
<div class="paragraph">
<p>Fundamentally, all the messaging channels are backed by pub/sub semantics.
Unlike Spring XD, the messaging channels are backed only by <code>topics</code> or <code>topic-exchange</code> and there is no representation of <code>queues</code> in the new architecture.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${xd.module.index}</code> is no longer supported. Instead, you can directly interact with <a href="#spring-cloud-dataflow-stream-dsl-named-destinations">named destinations</a>.</p>
</li>
<li>
<p><code>stream.index</code> changes to <code>:&lt;stream-name&gt;.&lt;label/app-name&gt;</code></p>
<div class="ulist">
<ul>
<li>
<p>For example, <code>ticktock.0</code> changes to <code>:ticktock.time</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>topic/queue prefixes are not required to interact with named-channels.</p>
<div class="ulist">
<ul>
<li>
<p>For example, <code>topic:mytopic</code> changes to <code>:mytopic</code>.</p>
</li>
<li>
<p>For example, <code>stream create stream1 --definition ":foo &gt; log"</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_directed_graphs"><a class="anchor" href="#_directed_graphs"></a>B.3.4. Directed Graphs</h4>
<div class="paragraph">
<p>If you build non-linear streams, you can take advantage of <a href="#spring-cloud-dataflow-stream-dsl-named-destinations">named destinations</a> to build directed graphs.</p>
</div>
<div class="paragraph">
<p>Consider the following example from Spring XD:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">stream create f --definition "queue:foo &gt; transform --expression=payload+'-sample1' | log" --deploy
stream create b --definition "queue:bar &gt; transform --expression=payload+'-sample2' | log" --deploy
stream create r --definition "http | router --expression=payload.contains('a')?'queue:sample1':'queue:sample2'" --deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can do the following in Spring Cloud Data Flow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">stream create f --definition ":foo &gt; transform --expression=payload+'-sample1' | log" --deploy
stream create b --definition ":bar &gt; transform --expression=payload+'-sample2' | log" --deploy
stream create r --definition "http | router --expression=payload.contains('a')?'sample1':'sample2'" --deploy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_batch_to_tasks"><a class="anchor" href="#_batch_to_tasks"></a>B.4. Batch to Tasks</h3>
<div class="paragraph">
<p>A Task, by definition, is any application that does not run forever, and they end at some point.
Tasks include Spring Batch jobs.
Task applications can be used for on-demand use cases, such as database migration, machine learning, scheduled operations, and others.
With <a href="http://cloud.spring.io/spring-cloud-task/">Spring Cloud Task</a>, you can build Spring Batch jobs as microservice applications.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Batch <a href="http://docs.spring.io/spring-xd/docs/current-SNAPSHOT/reference/html/#jobs">jobs</a> from Spring XD are being refactored to Spring Boot applications, also known as Spring Cloud Task <a href="https://github.com/spring-cloud-task-app-starters">applications</a>.</p>
</li>
<li>
<p>Unlike Spring XD, these tasks do not require explicit deployment. Instead, a task is ready to be launched directly once the definition is declared.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_shell_and_dsl_command_changes"><a class="anchor" href="#_shell_and_dsl_command_changes"></a>B.5. Shell and DSL Command Changes</h3>
<div class="paragraph">
<p>The following table shows the changes to shell and DSL commands:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old Command</th>
<th class="tableblock halign-left valign-top">New Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">module upload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">app register / app import</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">module list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">app list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">module info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">app info</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin config server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dataflow config server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job launch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task launch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task display</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job destroy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task destroy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job execution list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task execution list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtime modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtime apps</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_rest_api_changes"><a class="anchor" href="#_rest_api_changes"></a>B.6. REST API Changes</h3>
<div class="paragraph">
<p>The following table shows the changes to the REST API:</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 70%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old API</th>
<th class="tableblock halign-left valign-top">New API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/apps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/runtime/modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/runtime/apps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/runtime/modules/{moduleId}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/runtime/apps/{appId}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/task/definitions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/task/deployments</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ui_including_flo"><a class="anchor" href="#_ui_including_flo"></a>B.7. UI (including Flo)</h3>
<div class="paragraph">
<p>The Admin-UI is now named Dashboard. The URI for accessing the Dashboard is changed from
<code><a href="http://localhost:9393/admin-ui" class="bare">localhost:9393/admin-ui</a></code> to <code><a href="http://localhost:9393/dashboard" class="bare">localhost:9393/dashboard</a></code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apps (a new view): Lists all the registered applications that are available for use.
This view includes details such as the URI and the properties supported by each application.
You can also register/unregister applications from this view.</p>
</li>
<li>
<p>Runtime (was Container): Container changes to Runtime. The notion of <code>xd-container</code> is gone, replaced by out-of-the-box applications running as autonomous Spring Boot applications.
The Runtime tab displays the applications running in the runtime platforms (implementations: Local, Cloud Foundry, or Kubernetes). You can click on each application to review relevant details, such
as where it is running, what resources it uses, and other details.</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-flo">Spring Flo</a> is now an OSS product. Flo for
Spring Cloud Data Flows &#8220;Create Stream&#8221; is now the designer-tab in the Dashboard.</p>
</li>
<li>
<p>Tasks (a new view):</p>
<div class="ulist">
<ul>
<li>
<p>The &#8220;Modules&#8221; sub-tab is renamed to &#8220;Apps&#8221;.</p>
</li>
<li>
<p>The &#8220;Definitions&#8221; sub-tab lists all the task definitions, including Spring Batch jobs that are orchestrated as tasks.</p>
</li>
<li>
<p>The &#8220;Executions&#8221; sub-tab lists all the task execution details in a fashion similar to the listing of Spring XD&#8217;s Job executions.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_architecture_components"><a class="anchor" href="#_architecture_components"></a>B.8. Architecture Components</h3>
<div class="paragraph">
<p>Spring Cloud Data Flow comes with a significantly simplified architecture.
In fact, when compared with Spring XD, you need fewer peripherals to use Spring Cloud Data Flow.</p>
</div>
<div class="sect3">
<h4 id="_zookeeper"><a class="anchor" href="#_zookeeper"></a>B.8.1. ZooKeeper</h4>
<div class="paragraph">
<p>ZooKeeper is not used in the new architecture.</p>
</div>
</div>
<div class="sect3">
<h4 id="rdbms"><a class="anchor" href="#rdbms"></a>B.8.2. RDBMS</h4>
<div class="paragraph">
<p>Spring Cloud Data Flow uses an RDBMS instead of Redis for stream/task definitions, application registration, and for job repositories.
The default configuration uses an embedded H2 instance, but Oracle, DB2, SqlServer, MySQL/MariaDB, PostgreSQL, H2, and HSQLDB databases are supported.
To use Oracle, DB2, and SqlServer, you need to create your own Data Flow Server by using <a href="https://start.spring.io/">Spring Initializr</a> and add the appropriate JDBC driver dependency.</p>
</div>
</div>
<div class="sect3">
<h4 id="_redis"><a class="anchor" href="#_redis"></a>B.8.3. Redis</h4>
<div class="paragraph">
<p>Running a Redis cluster is only required for analytics functionality.
Specifically, when you use the <code>counter-sink</code>, <code>field-value-counter-sink</code>, or <code>aggregate-counter-sink</code> applications, you also need to have a running instance of Redis cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cluster_topology"><a class="anchor" href="#_cluster_topology"></a>B.8.4. Cluster Topology</h4>
<div class="paragraph">
<p>Spring XDs <code>xd-admin</code> and <code>xd-container</code> server components are replaced by stream and task applications that are themselves running as autonomous Spring Boot applications.
The applications run natively on various platforms, including Cloud Foundry and Kubernetes.
You can develop, test, deploy, scale up or down, and interact with (Spring Boot) applications individually, and they can evolve in isolation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_central_configuration"><a class="anchor" href="#_central_configuration"></a>B.9. Central Configuration</h3>
<div class="paragraph">
<p>To support centralized and consistent management of an applications configuration properties, <a href="https://cloud.spring.io/spring-cloud-config/">Spring Cloud Config</a> client libraries have been included in the Spring Cloud Data Flow server as well as the Spring Cloud Stream applications provided by the Spring Cloud Stream App Starters. You can also <a href="streams.html#spring-cloud-dataflow-global-properties">pass common application properties</a> to all streams when the Data Flow Server starts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_distribution"><a class="anchor" href="#_distribution"></a>B.10. Distribution</h3>
<div class="paragraph">
<p>Spring Cloud Data Flow is a Spring Boot application. Depending on the platform of your choice, you can download the respective release uber jar and deploy or push it to the runtime platform (Cloud Foundry or Kubernetes). For example, if you run Spring Cloud Data Flow on Cloud Foundry, you can download the Cloud Foundry server implementation and do a <code>cf push</code>, as explained in the <a href="http://docs.spring.io/spring-cloud-dataflow-server-cloudfoundry/docs/current-SNAPSHOT/reference/htmlsingle/#getting-started">Cloud Foundry Reference Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hadoop_distribution_compatibility"><a class="anchor" href="#_hadoop_distribution_compatibility"></a>B.11. Hadoop Distribution Compatibility</h3>
<div class="paragraph">
<p>The <code>hdfs-sink</code> application builds upon Spring Hadoop 2.4.0 release, so this application is compatible
with the following Hadoop distributions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cloudera: cdh5</p>
</li>
<li>
<p>Pivotal Hadoop: phd30</p>
</li>
<li>
<p>Hortonworks Hadoop: hdp24</p>
</li>
<li>
<p>Hortonworks Hadoop: hdp23</p>
</li>
<li>
<p>Vanilla Hadoop: hadoop26</p>
</li>
<li>
<p>Vanilla Hadoop: 2.7.x (default)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_use_case_comparison"><a class="anchor" href="#_use_case_comparison"></a>B.12. Use Case Comparison</h3>
<div class="paragraph">
<p>The remainder of this appendix reviews some use cases to show the differences between Spring XD and Spring Cloud Data Flow.</p>
</div>
<div class="sect3">
<h4 id="_use_case_1_ticktock"><a class="anchor" href="#_use_case_1_ticktock"></a>B.12.1. Use Case #1: Ticktock</h4>
<div class="paragraph">
<p>This use case assumes that you have already downloaded both the XD and the SCDF distributions.</p>
</div>
<div class="paragraph">
<p>Description: Simple <code>ticktock</code> example using local/singlenode.</p>
</div>
<div class="paragraph">
<p>The following table describes the differences:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring XD</th>
<th class="tableblock halign-left valign-top">Spring Cloud Data Flow</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start an <code>xd-singlenode</code> server from CLI
</p><p class="tableblock"><code> xd-singlenode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start a binder of your choice
</p><p class="tableblock">Start a <code>local-server</code> implementation of SCDF from the CLI
</p><p class="tableblock"><code> java -jar spring-cloud-dataflow-server-local-1.0.0.BUILD-SNAPSHOT.jar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start an <code>xd-shell</code> server from the CLI
</p><p class="tableblock"><code> xd-shell</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start <code>dataflow-shell</code> server from the CLI
</p><p class="tableblock"><code> java -jar spring-cloud-dataflow-shell-1.0.0.BUILD-SNAPSHOT.jar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create <code>ticktock</code> stream
</p><p class="tableblock"><code>xd:&gt;stream create ticktock --definition time | log --deploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create <code>ticktock</code> stream
</p><p class="tableblock"><code>dataflow:&gt;stream create ticktock --definition time | log --deploy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Review <code>ticktock</code> results in the <code>xd-singlenode</code> server console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Review <code>ticktock</code> results by using the <code>tail</code> commang to view the <code>ticktock.log/stdout_log</code> application logs</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_use_case_2_stream_with_custom_module_or_application"><a class="anchor" href="#_use_case_2_stream_with_custom_module_or_application"></a>B.12.2. Use Case #2: Stream with Custom Module or Application</h4>
<div class="paragraph">
<p>This use case assumes that you have already downloaded both the XD and the SCDF distributions.</p>
</div>
<div class="paragraph">
<p>Description: Stream with custom module or application.</p>
</div>
<div class="paragraph">
<p>The following table describes the differences:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring XD</th>
<th class="tableblock halign-left valign-top">Spring Cloud Data Flow</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start an <code>xd-singlenode</code> server from CLI
</p><p class="tableblock"><code> xd-singlenode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start a binder of your choice
</p><p class="tableblock">Start a <code>local-server</code> implementation of SCDF from the CLI
</p><p class="tableblock"><code> java -jar spring-cloud-dataflow-server-local-1.0.0.BUILD-SNAPSHOT.jar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start an <code>xd-shell</code> server from the CLI
</p><p class="tableblock"><code> xd-shell</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start <code>dataflow-shell</code> server from the CLI
</p><p class="tableblock"><code> java -jar spring-cloud-dataflow-shell-1.0.0.BUILD-SNAPSHOT.jar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register a custom processor module to transform the payload to the desired format
</p><p class="tableblock"><code>xd:&gt;module upload --name toupper --type processor --file &lt;CUSTOM_JAR_FILE_LOCATION&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register custom processor application to transform payload to a desired format
</p><p class="tableblock"><code>dataflow:&gt;app register --name toupper --type processor --uri &lt;MAVEN_URI_COORDINATES&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a stream with a custom module
</p><p class="tableblock"><code>xd:&gt;stream create testupper --definition http | toupper | log --deploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a stream with custom application
</p><p class="tableblock"><code>dataflow:&gt;stream create testupper --definition http | toupper | log --deploy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Review results in the <code>xd-singlenode</code> server console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Review results by using the <code>tail</code> command to view the <code>testupper.log/stdout_log</code> application logs</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_use_case_3_batch_job"><a class="anchor" href="#_use_case_3_batch_job"></a>B.12.3. Use Case #3: Batch Job</h4>
<div class="paragraph">
<p>This use case assumes that you have already downloaded both the XD and the SCDF distributions.</p>
</div>
<div class="paragraph">
<p>Description: batch-job.</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring XD</th>
<th class="tableblock halign-left valign-top">Spring Cloud Data Flow</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start an <code>xd-singlenode</code> server from CLI
</p><p class="tableblock"><code> xd-singlenode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start a <code>local-server</code> implementation of SCDF from the CLI
</p><p class="tableblock"><code> java -jar spring-cloud-dataflow-server-local-1.0.0.BUILD-SNAPSHOT.jar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start an <code>xd-shell</code> server from the CLI
</p><p class="tableblock"><code> xd-shell</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start <code>dataflow-shell</code> server from the CLI
</p><p class="tableblock"><code> java -jar spring-cloud-dataflow-shell-1.0.0.BUILD-SNAPSHOT.jar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register a custom &#8220;batch job&#8221; module
</p><p class="tableblock"><code>xd:&gt;module upload --name simple-batch --type job --file &lt;CUSTOM_JAR_FILE_LOCATION&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register a custom batch-job as task application
</p><p class="tableblock"><code>dataflow:&gt;app register --name simple-batch --type task --uri &lt;MAVEN_URI_COORDINATES&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a job with custom batch-job module
</p><p class="tableblock"><code>xd:&gt;job create batchtest --definition simple-batch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a task with a custom batch-job application
</p><p class="tableblock"><code>dataflow:&gt;task create batchtest --definition simple-batch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy job
</p><p class="tableblock"><code>xd:&gt;job deploy batchtest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Launch job
</p><p class="tableblock"><code>xd:&gt;job launch batchtest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Launch task
</p><p class="tableblock"><code>dataflow:&gt;task launch batchtest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Review results in the <code>xd-singlenode</code> server console as well as the Jobs tab in the UI
(executions sub-tab should include all step details)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Review results by using the <code>tail</code> command to view the <code>batchtest/stdout_log</code> application logs as well as the Task tab in UI (the executions sub-tab should include all step details)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building"><a class="anchor" href="#building"></a>Appendix C: Building</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To build the source, you need to install JDK 1.8.</p>
</div>
<div class="paragraph">
<p>The build uses the Maven wrapper so that you do not have to install a specific version of Maven.
To enable the tests for Redis, run the server before building.
More information on how to run Redis appears later in this appendix.</p>
</div>
<div class="paragraph">
<p>The main build command is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./mvnw clean install</pre>
</div>
</div>
<div class="paragraph">
<p>If you like, you can add '-DskipTests' to avoid running the tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also install Maven (&gt;=3.3.3) yourself and run the <code>mvn</code> command in place of <code>./mvnw</code> in the examples below.
If you do that, you also might need to add <code>-P spring</code> if your local Maven settings do not contain repository declarations for Spring pre-release artifacts.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You might need to increase the amount of memory available to Maven by setting a <code>MAVEN_OPTS</code> environment variable with a value similar to <code>-Xmx512m -XX:MaxPermSize=128m</code>.
We try to cover this in the <code>.mvn</code> configuration, so, if you find you have to do it to make a build succeed, please raise a ticket to get the settings added to source control.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_documentation"><a class="anchor" href="#_documentation"></a>C.1. Documentation</h3>
<div class="paragraph">
<p>There is a <code>full</code> profile that generates documentation. You can build only the documentation by using the following command:</p>
</div>
<div class="paragraph">
<p><code>$ ./mvnw clean package -DskipTests -P full -pl spring-cloud-dataflow-server-kubernetes-docs -am</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_the_code"><a class="anchor" href="#_working_with_the_code"></a>C.2. Working with the Code</h3>
<div class="paragraph">
<p>If you do not have an IDE preference, we recommend that you use <a href="https://spring.io/tools">Spring Tools Suite</a> or <a href="http://www.eclipse.org">Eclipse</a> when working with the code.
We use the <a href="http://www.eclipse.org/m2e/">m2eclipse</a> Eclipse plugin for Maven support.
Other IDEs and tools generally also work without issue.</p>
</div>
<div class="sect3">
<h4 id="_importing_into_eclipse_with_m2eclipse"><a class="anchor" href="#_importing_into_eclipse_with_m2eclipse"></a>C.2.1. Importing into Eclipse with m2eclipse</h4>
<div class="paragraph">
<p>We recommend the <a href="http://www.eclipse.org/m2e/">m2eclipe</a> eclipse plugin when working with Eclipse.
If you do not already have m2eclipse installed, it is available from the Eclipse marketplace.</p>
</div>
<div class="paragraph">
<p>Unfortunately, m2e does not yet support Maven 3.3.
Consequently, once the projects are imported into Eclipse, you also need to tell m2eclipse to use the <code>.settings.xml</code> file for the projects.
If you do not do this, you may see many different errors related to the POMs in the projects.
To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open your Eclipse preferences.</p>
</li>
<li>
<p>Expand the Maven preferences.</p>
</li>
<li>
<p>Select User Settings.</p>
</li>
<li>
<p>In the User Settings field, click Browse and navigate to the Spring Cloud project you imported.</p>
</li>
<li>
<p>Select the <code>.settings.xml</code> file in that project.</p>
</li>
<li>
<p>Click Apply.</p>
</li>
<li>
<p>Click OK.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Alternatively, you can copy the repository settings from Spring Cloud&#8217;s <a href="https://github.com/spring-cloud/spring-cloud-build/blob/master/.settings.xml"><code>.settings.xml</code></a> file into your own <code>~/.m2/settings.xml</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_importing_into_eclipse_without_m2eclipse"><a class="anchor" href="#_importing_into_eclipse_without_m2eclipse"></a>C.2.2. Importing into Eclipse without m2eclipse</h4>
<div class="paragraph">
<p>If you prefer not to use m2eclipse, you can generate Eclipse project metadata by using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./mvnw eclipse:eclipse</pre>
</div>
</div>
<div class="paragraph">
<p>The generated Eclipse projects can be imported by selecting <code>Import existing projects</code>
from the <code>File</code> menu.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributing"><a class="anchor" href="#contributing"></a>Appendix D: Contributing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud is released under the non-restrictive Apache 2.0 license and follows a very standard Github development process, using Github tracker for issues and merging pull requests into master.
If you want to contribute even something trivial, please do not hesitate, but follow the guidelines below.</p>
</div>
<div class="sect2">
<h3 id="_sign_the_contributor_license_agreement"><a class="anchor" href="#_sign_the_contributor_license_agreement"></a>D.1. Sign the Contributor License Agreement</h3>
<div class="paragraph">
<p>Before we accept a non-trivial patch or pull request, we need you to sign the <a href="https://cla.pivotal.io">contributor&#8217;s agreement</a>.
Signing the contributor&#8217;s agreement does not grant anyone commit rights to the main repository, but it does mean that we can accept your contributions, and you will get an author credit if we do.
Active contributors might be asked to join the core team and be given the ability to merge pull requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_code_conventions_and_housekeeping"><a class="anchor" href="#_code_conventions_and_housekeeping"></a>D.2. Code Conventions and Housekeeping</h3>
<div class="paragraph">
<p>None of the following guidelines is essential for a pull request, but they all help your fellow developers understand and work with your code.
They can also be added after the original pull request but before a merge.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Spring Framework code format conventions. If you use Eclipse, you can import formatter settings by using the <code>eclipse-code-formatter.xml</code> file from the <a href="https://github.com/spring-cloud/spring-cloud-build/blob/master/spring-cloud-dependencies-parent/eclipse-code-formatter.xml">Spring Cloud Build</a> project.
If using IntelliJ, you can use the <a href="http://plugins.jetbrains.com/plugin/6546">Eclipse Code Formatter Plugin</a> to import the same file.</p>
</li>
<li>
<p>Make sure all new <code>.java</code> files have a simple Javadoc class comment with at least an  <code>@author</code> tag identifying you, and preferably at least a paragraph describing the class&#8217;s purpose.</p>
</li>
<li>
<p>Add the ASF license header comment to all new <code>.java</code> files (to do so, copy from existing files in the project).</p>
</li>
<li>
<p>Add yourself as an <code>@author</code> to the .java files that you modify substantially (more than cosmetic changes).</p>
</li>
<li>
<p>Add some Javadocs and, if you change the namespace, some XSD doc elements.</p>
</li>
<li>
<p>A few unit tests would help a lot as well. Someone has to do it, and your fellow developers appreciate the effort.</p>
</li>
<li>
<p>If no one else uses your branch, rebase it against the current master (or other target branch in the main project).</p>
</li>
<li>
<p>When writing a commit message, follow <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">these conventions</a>.
If you fix an existing issue, add <code>Fixes gh-XXXX</code> (where XXXX is the issue number) at the end of the commit message.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. HATEOAS stands for Hypermedia as the Engine of Application State
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-02-08 18:21:51 UTC
</div>
</div>
</body>
</html>