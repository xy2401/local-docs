<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 5. The contextual component model</title><link rel="stylesheet" href="css/seamframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Seam - Contextual Components"/><link rel="up" href="index.html" title="Seam - Contextual Components"/><link rel="prev" href="migration23.html" title="Chapter 4. Migration from 2.2 to 2.3"/><link rel="next" href="xml.html" title="Chapter 6. Configuring Seam components"/></head><body><p id="title"><a href="http://www.seamframework.org" class="site_href"><strong>SeamFramework.org</strong></a><a href="http://www.seamframework.org/Documentation" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="migration23.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="xml.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="concepts"/>Chapter 5. The contextual component model</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="concepts.html#d0e3489">5.1. Seam contexts</a></span></dt><dd><dl><dt><span class="sect2"><a href="concepts.html#d0e3528">5.1.1. Stateless context</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3533">5.1.2. Event context</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3540">5.1.3. Page context</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3545">5.1.4. Conversation context</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3578">5.1.5. Session context</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3585">5.1.6. Business process context</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3593">5.1.7. Application context</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3598">5.1.8. Context variables</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3622">5.1.9. Context search priority</a></span></dt><dt><span class="sect2"><a href="concepts.html#concurrency">5.1.10. Concurrency model</a></span></dt></dl></dd><dt><span class="sect1"><a href="concepts.html#d0e3682">5.2. Seam components</a></span></dt><dd><dl><dt><span class="sect2"><a href="concepts.html#d0e3711">5.2.1. Stateless session beans</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3733">5.2.2. Stateful session beans</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3758">5.2.3. Entity beans</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3782">5.2.4. JavaBeans</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3804">5.2.5. Message-driven beans</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3813">5.2.6. Interception</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3827">5.2.7. Component names</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3891">5.2.8. Defining the component scope</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3906">5.2.9. Components with multiple roles</a></span></dt><dt><span class="sect2"><a href="concepts.html#d0e3929">5.2.10. Built-in components</a></span></dt></dl></dd><dt><span class="sect1"><a href="concepts.html#d0e3944">5.3. Bijection</a></span></dt><dt><span class="sect1"><a href="concepts.html#d0e4047">5.4. Lifecycle methods</a></span></dt><dt><span class="sect1"><a href="concepts.html#d0e4099">5.5. Conditional installation</a></span></dt><dt><span class="sect1"><a href="concepts.html#d0e4185">5.6. Logging</a></span></dt><dt><span class="sect1"><a href="concepts.html#d0e4233">5.7. The Mutable interface and @ReadOnly</a></span></dt><dt><span class="sect1"><a href="concepts.html#d0e4286">5.8. Factory and manager components</a></span></dt></dl></div><p> 
        The two core concepts in Seam are the notion of a <span class="emphasis"><em>context</em></span> and the notion of a
        <span class="emphasis"><em>component</em></span>. Components are stateful objects, usually EJBs, and an instance of a
        component is associated with a context, and given a name in that context. <span class="emphasis"><em>Bijection</em></span>
        provides a mechanism for aliasing internal component names (instance variables) to contextual names, allowing
        component trees to be dynamically assembled, and reassembled by Seam.
    </p><p>
        Let's start by describing the contexts built in to Seam.
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3489"/>5.1. Seam contexts</h2></div></div></div><p> Seam contexts are created and destroyed by the framework. The application does not control context
            demarcation via explicit Java API calls. Context are usually implicit. In some cases, however, contexts are
            demarcated via annotations. </p><p> The basic Seam contexts are: </p><div class="itemizedlist"><ul><li><p> Stateless context </p></li><li><p> Event (i.e., request) context </p></li><li><p> Page context </p></li><li><p> Conversation context </p></li><li><p> Session context </p></li><li><p> Business process context </p></li><li><p> Application context </p></li></ul></div><p> 
            You will recognize some of these contexts from servlet and related specifications. However, two of them
            might be new to you: <span class="emphasis"><em>conversation context</em></span>, and <span class="emphasis"><em>business process
            context</em></span>. One reason state management in web applications is so fragile and error-prone is that
            the three built-in contexts (request, session and application) are not especially meaningful from the point
            of view of the business logic. A user login session, for example, is a fairly arbitrary construct in terms
            of the actual application work flow. Therefore, most Seam components are scoped to the conversation or
            business process contexts, since they are the contexts which are most meaningful in terms of the
            application.
        </p><p>
            Let's look at each context in turn.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3528"/>5.1.1. Stateless context</h3></div></div></div><p>
                Components which are truly stateless (stateless session beans, primarily) always live in the stateless
                context (which is basically the absence of a context since the instance Seam resolves is not stored).
                Stateless components are not very interesting, and are arguably not very object-oriented. Nevertheless,
                they do get developed and used and are thus an important part of any Seam application.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3533"/>5.1.2. Event context</h3></div></div></div><p>
                The event context is the "narrowest" stateful context, and is a generalization of the notion of the
                web request context to cover other kinds of events. Nevertheless, the event context associated with the
                lifecycle of a JSF request is the most important example of an event context, and the one you will work
                with most often. Components associated with the event context are destroyed at the end of the request,
                but their state is available and well-defined for at least the lifecycle of the request.
            </p><p> 
                When you invoke a Seam component via RMI, or Seam Remoting, the event context is created and
                destroyed just for the invocation.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3540"/>5.1.3. Page context</h3></div></div></div><p>
                The page context allows you to associate state with a particular instance of a rendered page. You can
                initialize state in your event listener, or while actually rendering the page, and then have access to
                it from any event that originates from that page. This is especially useful for functionality like
                clickable lists, where the list is backed by changing data on the server side. The state is actually
                serialized to the client, so this construct is extremely robust with respect to multi-window operation
                and the back button.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3545"/>5.1.4. Conversation context</h3></div></div></div><p>
                The conversation context is a truly central concept in Seam. A <span class="emphasis"><em>conversation</em></span> is a
                unit of work from the point of view of the user. It might span several interactions with the user,
                several requests, and several database transactions. But to the user, a conversation solves a single
                problem. For example, "book hotel", "approve contract", "create order" are all conversations. You might
                like to think of a conversation implementing a single "use case" or "user story", but the relationship 
                is not necessarily quite exact.
            </p><p>
                A conversation holds state associated with "what the user is doing now, in this window". A single
                user may have multiple conversations in progress at any point in time, usually in multiple windows. The
                conversation context allows us to ensure that state from the different conversations does not collide
                and cause bugs.
            </p><p>
                It might take you some time to get used to thinking of applications in terms of conversations. But
                once you get used to it, we think you'll love the notion, and never be able to not think in terms of
                conversations again!
            </p><p>
                Some conversations last for just a single request. Conversations that span multiple requests must be
                demarcated using annotations provided by Seam.
            </p><p>
                Some conversations are also <span class="emphasis"><em>tasks</em></span>. A task is a conversation that is significant
                in terms of a long-running business process, and has the potential to trigger a business process state
                transition when it is successfully completed. Seam provides a special set of annotations for task
                demarcation.
            </p><p>
                Conversations may be <span class="emphasis"><em>nested</em></span>, with one conversation taking place "inside" a wider
                conversation. This is an advanced feature.
            </p><p>
                Usually, conversation state is actually held by Seam in the servlet session between requests. Seam
                implements configurable <span class="emphasis"><em>conversation timeout</em></span>, automatically destroying inactive
                conversations, and thus ensuring that the state held by a single user login session does not grow
                without bound if the user abandons conversations.
            </p><p>
                Seam serializes processing of concurrent requests that take place in the same long-running
                conversation context, in the same process.
            </p><p>
                Alternatively, Seam may be configured to keep conversational state in the client browser.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3578"/>5.1.5. Session context</h3></div></div></div><p>
                A session context holds state associated with the user login session. While there are some cases
                where it is useful to share state between several conversations, we generally frown on the use of
                session context for holding components other than global information about the logged in user.
            </p><p> 
                In a JSR-168 portal environment, the session context represents the portlet session. 
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3585"/>5.1.6. Business process context</h3></div></div></div><p> 
                The business process context holds state associated with the long running business process. This
                state is managed and made persistent by the BPM engine (JBoss jBPM). The business process spans multiple
                interactions with multiple users, so this state is shared between multiple users, but in a well-defined
                manner. The current task determines the current business process instance, and the lifecycle of the
                business process is defined externally using a <span class="emphasis"><em>process definition language</em></span>, so
                there are no special annotations for business process demarcation. 
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3593"/>5.1.7. Application context</h3></div></div></div><p> 
                The application context is the familiar servlet context from the servlet spec. Application context is
                mainly useful for holding static information such as configuration data, reference data or metamodels.
                For example, Seam stores its own configuration and metamodel in the application context. 
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3598"/>5.1.8. Context variables</h3></div></div></div><p> 
                A context defines a namespace, a set of <span class="emphasis"><em>context variables</em></span>. These work much the
                same as session or request attributes in the servlet spec. You may bind any value you like to a context
                variable, but usually we bind Seam component instances to context variables. 
            </p><p> 
                So, within a context, a component instance is identified by the context variable name (this is
                usually, but not always, the same as the component name). You may programmatically access a named
                component instance in a particular scope via the <code class="literal">Contexts</code> class, which provides
                access to several thread-bound instances of the <code class="literal">Context</code> interface: 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">User</span><!-- <br/> --><span class="java_plain">&nbsp;user&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">User</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Contexts</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSessionContext</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">get</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;user&quot;</span><!-- <br/> --><span class="java_separator">);</span></pre><p>
                You may also set or change the value associated with a name: 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Contexts</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSessionContext</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">set</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;user&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;user</span><!-- <br/> --><span class="java_separator">);</span></pre><p> 
                Usually, however, we obtain components from a context via injection, and put component instances into
                a context via outjection. 
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3622"/>5.1.9. Context search priority</h3></div></div></div><p> 
                Sometimes, as above, component instances are obtained from a particular known scope. Other times, all
                stateful scopes are searched, in <span class="emphasis"><em>priority order</em></span>. The order is as follows: 
            </p><div class="itemizedlist"><ul><li><p> Event context </p></li><li><p> Page context </p></li><li><p> Conversation context </p></li><li><p> Session context </p></li><li><p> Business process context </p></li><li><p> Application context </p></li></ul></div><p> 
                You can perform a priority search by calling <code class="literal">Contexts.lookupInStatefulContexts()</code>.
                Whenever you access a component by name from a JSF page, a priority search occurs. 
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="concurrency"/>5.1.10. Concurrency model</h3></div></div></div><p> 
                Neither the servlet nor EJB specifications define any facilities for managing concurrent requests
                originating from the same client. The servlet container simply lets all threads run concurrently and
                leaves enforcing thread safeness to application code. The EJB container allows stateless components to be
                accessed concurrently, and throws an exception if multiple threads access a stateful session bean. 
            </p><p> 
                This behavior might have been okay in old-style web applications which were based around
                fine-grained, synchronous requests. But for modern applications which make heavy use of many
                fine-grained, asynchronous (AJAX) requests, concurrency is a fact of life, and must be supported by the
                programming model. Seam weaves a concurrency management layer into its context model. 
            </p><p> 
                The Seam session and application contexts are multithreaded. Seam will allow concurrent requests in a
                context to be processed concurrently. The event and page contexts are by nature single threaded. The
                business process context is strictly speaking multi-threaded, but in practice concurrency is
                sufficiently rare that this fact may be disregarded most of the time. Finally, Seam enforces a
                <span class="emphasis"><em>single thread per conversation per process</em></span> model for the conversation context
                by serializing concurrent requests in the same long-running conversation context. 
            </p><p> 
                Since the session context is multithreaded, and often contains volatile state, session scope
                components are always protected by Seam from concurrent access so long as the Seam interceptors 
                are not disabled for that component.  If interceptors are disabled, then any thread-safety that is
                required must be implemented by the component itself. Seam serializes requests to session
                scope JavaBeans by default (and detects and breaks any deadlocks that occur). This is
                not the default behaviour for application scoped components however, since application scoped components
                do not usually hold volatile state and because synchronization at the global level is
                <span class="emphasis"><em>extremely</em></span> expensive. However, you can force a serialized threading model on any
                JavaBean component by adding the <code class="literal">@Synchronized</code> annotation. 
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Seam 2.3 removed the serialization of Stateful 
               session beans by Seam synchronization interceptor 
               because stateful session beans are serialized by EJB 3.1 
               container by default .</p></div><p> 
                This concurrency model means that AJAX clients can safely use volatile session and conversational
                state, without the need for any special work on the part of the developer.
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>
                    Be warned that Statefull session Beans are not serialized by Seam anymore. 
                    Serialization of Statefull session beans are controlled by EJB container, 
                    so there is no need for Seam to duplicate that. So @Synchronized annotation
                    is ignored on Statefull session beans. 
                </p></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3682"/>5.2. Seam components</h2></div></div></div><p> 
            Seam components are POJOs (Plain Old Java Objects). In particular, they are JavaBeans or EJB 3.0
            enterprise beans. While Seam does not require that components be EJBs and can even be used without an EJB
            3.0 compliant container, Seam was designed with EJB 3.0 in mind and includes deep integration with EJB 3.0.
            Seam supports the following <span class="emphasis"><em>component types</em></span>. 
        </p><div class="itemizedlist"><ul><li><p> EJB 3.0 stateless session beans </p></li><li><p> EJB 3.0 stateful session beans </p></li><li><p> EJB 3.0 entity beans (i.e., JPA entity classes)</p></li><li><p> JavaBeans </p></li><li><p> EJB 3.0 message-driven beans </p></li><li><p> Spring beans (see <a class="xref" href="spring.html" title="Chapter 28. Spring Framework integration">Chapter 28, <i>Spring Framework integration</i></a>)</p></li></ul></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3711"/>5.2.1. Stateless session beans</h3></div></div></div><p> 
                Stateless session bean components are not able to hold state across multiple invocations. Therefore,
                they usually work by operating upon the state of other components in the various Seam contexts. They may
                be used as JSF action listeners, but cannot provide properties to JSF components for display. 
            </p><p> 
                Stateless session beans always live in the stateless context. 
            </p><p> 
                Stateless session beans can be accessed concurrently as a new instance is used for each request. 
                Assigning the instance to the request is the responsibility of the EJB3 container (normally instances
                will be allocated from a reusable pool meaning that you may find any instance variables contain data
                from previous uses of the bean). 
            </p><p> 
                Stateless session beans are the least interesting kind of Seam component. 
            </p><p>
                Seam stateless session bean components may be instantiated using <code class="literal">Component.getInstance()</code>
                or <code class="literal">@In(create=true)</code>. They should not be directly instantiated via JNDI lookup
                or the <code class="literal">new</code> operator.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3733"/>5.2.2. Stateful session beans</h3></div></div></div><p> 
                Stateful session bean components are able to hold state not only across multiple invocations of the
                bean, but also across multiple requests. Application state that does not belong in the database should
                usually be held by stateful session beans. This is a major difference between Seam and many other web
                application frameworks. Instead of sticking information about the current conversation directly in the
                <code class="literal">HttpSession</code>, you should keep it in instance variables of a stateful session bean
                that is bound to the conversation context. This allows Seam to manage the lifecycle of this state for
                you, and ensure that there are no collisions between state relating to different concurrent
                conversations. 
            </p><p> 
                Stateful session beans are often used as JSF action listener, and as backing beans that provide
                properties to JSF components for display or form submission. 
            </p><p> 
                By default, stateful session beans are bound to the conversation context. They may never be bound to
                the page or stateless contexts. 
            </p><p> 
                Concurrent requests to session-scoped stateful session beans are not serialized by Seam as long
                as EJB 3.1 has changed that. This is a difference in comparison to previous Seam 2.2.x.
                
            </p><p>
                Seam stateful session bean components may be instantiated using <code class="literal">Component.getInstance()</code>
                or <code class="literal">@In(create=true)</code>. They should not be directly instantiated via JNDI lookup
                or the <code class="literal">new</code> operator.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3758"/>5.2.3. Entity beans</h3></div></div></div><p> 
                Entity beans may be bound to a context variable and function as a seam component. Because entities
                have a persistent identity in addition to their contextual identity, entity instances are usually bound
                explicitly in Java code, rather than being instantiated implicitly by Seam. 
            </p><p> 
                Entity bean components do not support bijection or context demarcation. Nor does invocation of an
                entity bean trigger validation. 
            </p><p> 
                Entity beans are not usually used as JSF action listeners, but do often function as backing beans
                that provide properties to JSF components for display or form submission. In particular, it is common to
                use an entity as a backing bean, together with a stateless session bean action listener to implement
                create/update/delete type functionality. 
            </p><p>
                By default, entity beans are bound to the conversation context. They may never be bound to the
                stateless context. 
            </p><p> 
                Note that it in a clustered environment is somewhat less efficient to bind an entity bean directly to
                a conversation or session scoped Seam context variable than it would be to hold a reference to the
                entity bean in a stateful session bean. For this reason, not all Seam applications define entity beans
                to be Seam components. 
            </p><p>
                Seam entity bean components may be instantiated using <code class="literal">Component.getInstance()</code>,
                <code class="literal">@In(create=true)</code> or directly using the <code class="literal">new</code> operator.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3782"/>5.2.4. JavaBeans</h3></div></div></div><p> 
                JavaBeans may be used just like a stateless or stateful session bean. However, they do not provide
                the functionality of a session bean (declarative transaction demarcation, declarative security,
                efficient clustered state replication, EJB 3.0 persistence, timeout methods, etc). 
            </p><p> 
                In a later chapter, we show you how to use Seam and Hibernate without an EJB container. In this use
                case, components are JavaBeans instead of session beans. Note, however, that in many application servers
                it is somewhat less efficient to cluster conversation or session scoped Seam JavaBean components than it
                is to cluster stateful session bean components. 
            </p><p> 
                By default, JavaBeans are bound to the event context. 
            </p><p> 
                Concurrent requests to session-scoped JavaBeans are always serialized by Seam. 
            </p><p>
                Seam JavaBean components may be instantiated using <code class="literal">Component.getInstance()</code>
                or <code class="literal">@In(create=true)</code>. They should not be directly instantiated using the 
                <code class="literal">new</code> operator.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3804"/>5.2.5. Message-driven beans</h3></div></div></div><p> 
                Message-driven beans may function as a seam component. However, message-driven beans are called quite
                differently to other Seam components - instead of invoking them via the context variable, they listen
                for messages sent to a JMS queue or topic. 
            </p><p> 
                Message-driven beans may not be bound to a Seam context. Nor do they have access to the session or
                conversation state of their "caller". However, they do support bijection and some other Seam
                functionality. 
            </p><p>
                Message-driven beans are never instantiated by the application. They are instantiated by the EJB
                container when a message is received.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3813"/>5.2.6. Interception</h3></div></div></div><p> 
                In order to perform its magic (bijection, context demarcation, validation, etc), Seam must intercept
                component invocations. For JavaBeans, Seam is in full control of instantiation of the component, and no
                special configuration is needed. For entity beans, interception is not required since bijection and
                context demarcation are not defined. For session beans, we must register an EJB interceptor for the
                session bean component. We could use an annotation, as follows: 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Interceptors</span><span class="java_separator">(</span><span class="java_type">SeamInterceptor</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
                But a much better way is to define the interceptor in <code class="literal">ejb-jar.xml</code>. 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">interceptors</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">interceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">interceptor-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.ejb.SeamInterceptor</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">interceptor-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">interceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">interceptors</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">assembly-descriptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">interceptor-binding</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ejb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">*</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ejb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">interceptor-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.ejb.SeamInterceptor</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">interceptor-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">interceptor-binding</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">assembly-descriptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3827"/>5.2.7. Component names</h3></div></div></div><p> 
                All seam components need a name. We can assign a name to a component using the
                <code class="literal">@Name</code> annotation: 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
                This name is the <span class="emphasis"><em>seam component name</em></span> and is not related to any other name
                defined by the EJB specification. However, seam component names work just like JSF managed bean names
                and you can think of the two concepts as identical. 
            </p><p>
                <code class="literal">@Name</code> is not the only way to define a component name, but we always need
                to specify the name <span class="emphasis"><em>somewhere</em></span>. If we don't, then none of the other
                Seam annotations will function.
            </p><p> 
                Whenever Seam instantiates a component, it binds the new instance to a variable in the scope configured
                for the component that matches the component name. This behavior is identical to how JSF managed beans
                work, except that Seam allows you to configure this mapping using annotations rather than XML. You can
                also programmatically bind a component to a context variable. This is useful if a particular component
                serves more than one role in the system. For example, the currently logged in <code class="literal">User</code>
                might be bound to the <code class="literal">currentUser</code> session context variable, while a
                <code class="literal">User</code> that is the subject of some administration functionality might be bound to the
                <code class="literal">user</code> conversation context variable. Be careful, though, because through a
                programmatic assignment, it's possible to overwrite a context variable that has a reference to a Seam
                component, potentially confusing matters.  </p><p> 
                For very large applications, and for built-in seam components, qualified component names are often used
                to avoid naming conflicts. 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;com.jboss.myapp.loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
                We may use the qualified component name both in Java code and in JSF's expression language: 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XHTML"><!-- XHTML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;submit&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Login&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{com.jboss.myapp.loginAction.login}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p> 
                Since this is noisy, Seam also provides a means of aliasing a qualified name to a simple name. Add a
                line like this to the <code class="literal">components.xml</code> file: 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">factory</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;loginAction&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">scope</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;STATELESS&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{com.jboss.myapp.loginAction}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p> 
                All of the built-in Seam components have qualified names but can be accessed through 
                their unqualified names due to the namespace import feature of Seam. 
                The <code class="literal">components.xml</code> file included in the Seam JAR defines the following
                namespaces.
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">components</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/schema/seam/components&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.core</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.cache</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.transaction</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.framework</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.web</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.faces</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.international</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.theme</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.pageflow</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.bpm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.jms</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.mail</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.security</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.security.management</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.security.permission</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.captcha</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.seam.excel.exporter</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">import</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;...&nbsp;---&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">components</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>
                When attempting to resolve an unqualified name, Seam will check each of those namespaces, in order.
                You can include additional namespaces in your application's <code class="literal">components.xml</code> file
                for application-specific namespaces.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3891"/>5.2.8. Defining the component scope</h3></div></div></div><p> 
                We can override the default scope (context) of a component using the <code class="literal">@Scope</code>
                annotation. This lets us define what context a component instance is bound to, when it is instantiated
                by Seam. 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;user&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Scope</span><span class="java_separator">(</span><span class="java_plain">SESSION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
                <code class="literal">org.jboss.seam.ScopeType</code> defines an enumeration of possible scopes.
            </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3906"/>5.2.9. Components with multiple roles</h3></div></div></div><p> 
                Some Seam component classes can fulfill more than one role in the system. For example, we often have
                a <code class="literal">User</code> class which is usually used as a session-scoped component representing the
                current user but is used in user administration screens as a conversation-scoped component. The
                <code class="literal">@Role</code> annotation lets us define an additional named role for a component, with a
                different scope — it lets us bind the same component class to different context variables. (Any
                Seam component <span class="emphasis"><em>instance</em></span> may be bound to multiple context variables, but this lets
                us do it at the class level, and take advantage of auto-instantiation.) 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;user&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Scope</span><span class="java_separator">(</span><span class="java_plain">CONVERSATION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Role</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;currentUser&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;scope</span><span class="java_operator">=</span><span class="java_plain">SESSION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
                The <code class="literal">@Roles</code> annotation lets us specify as many additional roles as we like.
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;user&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Scope</span><span class="java_separator">(</span><span class="java_plain">CONVERSATION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Roles</span><span class="java_separator">({</span><span class="java_plain">@</span><span class="java_type">Role</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;currentUser&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;scope</span><span class="java_operator">=</span><span class="java_plain">SESSION</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Role</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;tempUser&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;scope</span><span class="java_operator">=</span><span class="java_plain">EVENT</span><span class="java_separator">)})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3929"/>5.2.10. Built-in components</h3></div></div></div><p>
                Like many good frameworks, Seam eats its own dogfood and is implemented mostly as a set of built-in
                Seam interceptors (see later) and Seam components. This makes it easy for applications to interact with
                built-in components at runtime or even customize the basic functionality of Seam by replacing the
                built-in components with custom implementations. The built-in components are defined in the Seam
                namespace <code class="literal">org.jboss.seam.core</code> and the Java package of the same name.
            </p><p> 
                The built-in components may be injected, just like any Seam components, but they also provide
                convenient static <code class="literal">instance()</code> methods: 
            </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FacesMessages</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">instance</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">add</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;Welcome&nbsp;back,&nbsp;#{user.name}!&quot;</span><!-- <br/> --><span class="java_separator">);</span></pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3944"/>5.3. Bijection</h2></div></div></div><p>
            <span class="emphasis"><em>Dependency injection</em></span> or <span class="emphasis"><em>inversion of control</em></span> is by now a familiar
            concept to most Java developers. Dependency injection allows a component to obtain a reference to another
            component by having the container "inject" the other component to a setter method or instance variable. In
            all dependency injection implementations that we have seen, injection occurs when the component is
            constructed, and the reference does not subsequently change for the lifetime of the component instance. For
            stateless components, this is reasonable. From the point of view of a client, all instances of a particular
            stateless component are interchangeable. On the other hand, Seam emphasizes the use of stateful components.
            So traditional dependency injection is no longer a very useful construct. Seam introduces the notion of
            <span class="emphasis"><em>bijection</em></span> as a generalization of injection. In contrast to injection, bijection is: 
        </p><div class="itemizedlist"><ul><li><p>
                    <span class="emphasis"><em>contextual</em></span> - bijection is used to assemble stateful components from various
                    different contexts (a component from a "wider" context may even have a reference to a component from
                    a "narrower" context)
                </p></li><li><p>
                    <span class="emphasis"><em>bidirectional</em></span> - values are injected from context variables into attributes of
                    the component being invoked, and also <span class="emphasis"><em>outjected</em></span> from the component attributes
                    back out to the context, allowing the component being invoked to manipulate the values of contextual
                    variables simply by setting its own instance variables 
                </p></li><li><p>
                    <span class="emphasis"><em>dynamic</em></span> - since the value of contextual variables changes over time, and since
                    Seam components are stateful, bijection takes place every time a component is invoked 
                </p></li></ul></div><p> 
            In essence, bijection lets you alias a context variable to a component instance variable, by specifying
            that the value of the instance variable is injected, outjected, or both. Of course, we use annotations to
            enable bijection.
        </p><p> 
            The <code class="literal">@In</code> annotation specifies that a value should be injected, either into an instance
            variable: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            or into a setter method: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUser</span><span class="java_separator">(</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">user</span><span class="java_operator">=</span><span class="java_plain">user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            By default, Seam will do a priority search of all contexts, using the name of the property or instance
            variable that is being injected. You may wish to specify the context variable name explicitly, using, for
            example, <code class="literal">@In("currentUser")</code>. 
        </p><p> 
            If you want Seam to create an instance of the component when there is no existing component instance
            bound to the named context variable, you should specify <code class="literal">@In(create=true)</code>. If the value is
            optional (it can be null), specify <code class="literal">@In(required=false)</code>. 
        </p><p>
            For some components, it can be repetitive to have to specify <code class="literal">@In(create=true)</code> everywhere
            they are used. In such cases, you can annotate the component <code class="literal">@AutoCreate</code>, and then it
            will always be created, whenever needed, even without the explicit use of <code class="literal">create=true</code>.
        </p><p> 
            You can even inject the value of an expression: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_separator">(</span><span class="java_literal">&quot;#{user.username}&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
            Injected values are disinjected (i.e., set to <code class="literal">null</code>) immediately after method 
            completion and outjection.
        </p><p> 
            (There is much more information about component lifecycle and injection in the next chapter.) 
        </p><p> 
            The <code class="literal">@Out</code> annotation specifies that an attribute should be outjected, either from an
            instance variable: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Out</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            or from a getter method: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Out</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;getUser</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            An attribute may be both injected and outjected: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_plain">&nbsp;@</span><span class="java_type">Out</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            or: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;loginAction&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUser</span><span class="java_separator">(</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">user</span><span class="java_operator">=</span><span class="java_plain">user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Out</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;getUser</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4047"/>5.4. Lifecycle methods</h2></div></div></div><p> 
            Session bean and entity bean Seam components support all the usual EJB 3.0 lifecycle callback
            (<code class="literal">@PostConstruct</code>, <code class="literal">@PreDestroy</code>, etc). But Seam also supports 
            the use of any of these callbacks with JavaBean components. However, since these annotations are
            not available in a J2EE environment, Seam defines two additional component lifecycle callbacks,
            equivalent to <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code>.
        </p><p> 
            The <code class="literal">@Create</code> method is called after Seam instantiates a component. 
            Components may define only one <code class="literal">@Create</code> method. 
        </p><p> 
            The <code class="literal">@Destroy</code> method is called when the context that the Seam component is bound to
            ends. Components may define only one <code class="literal">@Destroy</code> method.
        </p><p>
            In addition, stateful session bean components <span class="emphasis"><em>must</em></span> define a method with no parameters 
            annotated <code class="literal">@Remove</code>. This method is called by Seam when the context ends.
        </p><p> 
            Finally, a related annotation is the <code class="literal">@Startup</code> annotation, which may be applied to any
            application or session scoped component. The <code class="literal">@Startup</code> annotation tells Seam to
            instantiate the component immediately, when the context begins, instead of waiting until it is first
            referenced by a client. It is possible to control the order of instantiation of startup components by
            specifying <code class="literal">@Startup(depends={....})</code>. 
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4099"/>5.5. Conditional installation</h2></div></div></div><p>
            The <code class="literal">@Install</code> annotation lets you control conditional installation of components that
            are required in some deployment scenarios and not in others. This is useful if:
        </p><div class="itemizedlist"><ul><li><p>
        		    You want to mock out some infrastructural component in tests.
        		</p></li><li><p>
        		    You want change the implementation of a component in certain
        		    deployment scenarios.
        		</p></li><li><p>
        		    You want to install some components only if their dependencies are
        		    available (useful for framework authors).
        		</p></li></ul></div><p>
            <code class="literal">@Install</code> works by letting you specify <span class="emphasis"><em>precedence</em></span>
            and <span class="emphasis"><em>dependencies</em></span>. 
        </p><p>
            The precedence of a component is a number that Seam uses to decide which component to
            install when there are multiple classes with the same component name in the classpath.
            Seam will choose the component with the higher precedence. There are some predefined
            precedence values (in ascending order):
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
        		    <code class="literal">BUILT_IN</code> — the lowest precedence components are
        		    the components built in to Seam. 
        		</p></li><li><p>
        		    <code class="literal">FRAMEWORK</code> — components defined by third-party 
        		    frameworks may override built-in components, but are overridden by
        		    application components. 
        		</p></li><li><p>
        		    <code class="literal">APPLICATION</code> — the default precedence. This is 
                    appropriate for most application components.
        		</p></li><li><p>
        		    <code class="literal">DEPLOYMENT</code> — for application components which
        		    are deployment-specific. 
        		</p></li><li><p>
        		    <code class="literal">MOCK</code> — for mock objects used in testing. 
        		</p></li></ol></div><p>
            Suppose we have a component named <code class="literal">messageSender</code> that talks to
            a JMS queue. 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;messageSender&quot;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageSender</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;sendMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;something&nbsp;with&nbsp;JMS</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
            In our unit tests, we don't have a JMS queue available, so we would like to stub
            out this method. We'll create a <span class="emphasis"><em>mock</em></span> component that exists
            in the classpath when unit tests are running, but is never deployed with the
            application:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;messageSender&quot;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Install</span><span class="java_separator">(</span><span class="java_plain">precedence</span><span class="java_operator">=</span><span class="java_plain">MOCK</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MockMessageSender</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageSender</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;sendMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;nothing</span><span class="java_operator">!</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
            The <code class="literal">precedence</code> helps Seam decide which version to use when it finds
            both components in the classpath.
        </p><p>
            This is nice if we are able to control exactly which classes are in the classpath. But
            if I'm writing a reusable framework with many dependencies, I don't want to have to 
            break that framework across many jars. I want to be able to decide which components
            to install depending upon what other components are installed, and upon what classes
            are available in the classpath. The <code class="literal">@Install</code> annotation also 
            controls this functionality. Seam uses this mechanism internally to enable conditional 
            installation of many of the built-in components. However, you probably won't need to
            use it in your application.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4185"/>5.6. Logging</h2></div></div></div><p> 
            Who is not totally fed up with seeing noisy code like this? 
         </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">static</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">final</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Log</span><!-- <br/> --><span class="java_plain">&nbsp;log&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">LogFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getLog</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">CreateOrderAction</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;createOrder</span><span class="java_separator">(</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;log</span><span class="java_separator">.</span><span class="java_plain">isDebugEnabled</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log</span><span class="java_separator">.</span><span class="java_plain">debug</span><span class="java_separator">(</span><span class="java_literal">&quot;Creating&nbsp;new&nbsp;order&nbsp;for&nbsp;user:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;user</span><span class="java_separator">.</span><span class="java_plain">username</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;&nbsp;product:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;product</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&nbsp;quantity:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_separator">(</span><span class="java_plain">user</span><span class="java_separator">,</span><span class="java_plain">&nbsp;product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            It is difficult to imagine how the code for a simple log message could possibly be more verbose. There is
            more lines of code tied up in logging than in the actual business logic! I remain totally astonished that
            the Java community has not come up with anything better in 10 years. 
        </p><p> 
            Seam provides a logging API that simplifies this code significantly: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Log</span><!-- <br/> --><span class="java_plain">&nbsp;log</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;createOrder</span><span class="java_separator">(</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;log</span><span class="java_separator">.</span><span class="java_plain">debug</span><span class="java_separator">(</span><span class="java_literal">&quot;Creating&nbsp;new&nbsp;order&nbsp;for&nbsp;user:&nbsp;#0&nbsp;product:&nbsp;#1&nbsp;quantity:&nbsp;#2&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;user</span><span class="java_separator">.</span><span class="java_plain">username</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;product</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_separator">(</span><span class="java_plain">user</span><span class="java_separator">,</span><span class="java_plain">&nbsp;product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
            It doesn't matter if you declare the <code class="literal">log</code> variable static or not — it will work 
            either way, except for entity bean components which require the <code class="literal">log</code> variable to be
            static.
        </p><p> 
            Note that we don't need the noisy <code class="literal">if ( log.isDebugEnabled() )</code> guard, since string
            concatenation happens <span class="emphasis"><em>inside</em></span> the <code class="literal">debug()</code> method. Note also that we
            don't usually need to specify the log category explicitly, since Seam knows what component it is injecting
            the <code class="literal">Log</code> into. 
        </p><p> 
            If <code class="literal">User</code> and <code class="literal">Product</code> are Seam components available in the current
            contexts, it gets even better: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Log</span><!-- <br/> --><span class="java_plain">&nbsp;log</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;createOrder</span><span class="java_separator">(</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;log</span><span class="java_separator">.</span><span class="java_plain">debug</span><span class="java_separator">(</span><span class="java_literal">&quot;Creating&nbsp;new&nbsp;order&nbsp;for&nbsp;user:&nbsp;#{user.username}&nbsp;product:&nbsp;#{product.name}&nbsp;quantity:&nbsp;#0&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_separator">(</span><span class="java_plain">user</span><span class="java_separator">,</span><span class="java_plain">&nbsp;product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>
            Seam logging automagically chooses whether to send output to log4j or JDK logging. If log4j is in the
            classpath, Seam with use it. If it is not, Seam will use JDK logging.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4233"/>5.7. The <code class="literal">Mutable</code> interface and <code class="literal">@ReadOnly</code></h2></div></div></div><p> 
            Many application servers feature an amazingly broken implementation of <code class="literal">HttpSession</code>
            clustering, where changes to the state of mutable objects bound to the session are only replicated when the
            application calls <code class="literal">setAttribute()</code> explicitly. This is a source of bugs that can not
            effectively be tested for at development time, since they will only manifest when failover occurs.
            Furthermore, the actual replication message contains the entire serialized object graph bound to the session
            attribute, which is inefficient. 
        </p><p> 
            Of course, EJB stateful session beans must perform automatic dirty checking and replication of mutable
            state and a sophisticated EJB container can introduce optimizations such as attribute-level replication.
            Unfortunately, not all Seam users have the good fortune to be working in an environment that supports EJB
            3.0. So, for session and conversation scoped JavaBean and entity bean components, Seam provides an extra
            layer of cluster-safe state management over the top of the web container session clustering. 
        </p><p> 
            For session or conversation scoped JavaBean components, Seam automatically forces replication to occur by
            calling <code class="literal">setAttribute()</code> once in every request that the component was invoked by the
            application. Of course, this strategy is inefficient for read-mostly components. You can control this
            behavior by implementing the <code class="literal">org.jboss.seam.core.Mutable</code> interface, or by extending
            <code class="literal">org.jboss.seam.core.AbstractMutable</code>, and writing your own dirty-checking logic inside
            the component. For example, 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;account&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AbstractMutable</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setBalance</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDirty</span><span class="java_separator">(</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">balance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">balance&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;getBalance</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            Or, you can use the <code class="literal">@ReadOnly</code> annotation to achieve a similar effect: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;account&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setBalance</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">balance&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ReadOnly</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;getBalance</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;balance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            For session or conversation scoped entity bean components, Seam automatically forces replication to occur
            by calling <code class="literal">setAttribute()</code> once in every request, <span class="emphasis"><em>unless the (conversation-scoped) 
            entity is currently associated with a Seam-managed persistence context, in which case no replication is 
            needed</em></span>. This strategy is not necessarily efficient, so session or conversation scope entity beans 
            should be used with care. You can always write a stateful session bean or JavaBean component to "manage" the 
            entity bean instance. For example, 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Stateful</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Name</span><span class="java_separator">(</span><span class="java_literal">&quot;account&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountManager</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AbstractMutable</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;account</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;an&nbsp;entity&nbsp;bean</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Unwrap</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;getAccount</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;account</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            Note that the <code class="literal">EntityHome</code> class in the Seam Application Framework provides a great example 
            of managing an entity bean instance using a Seam component. 
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4286"/>5.8. Factory and manager components</h2></div></div></div><p> 
            We often need to work with objects that are not Seam components. But we still want to be able to inject
            them into our components using <code class="literal">@In</code> and use them in value and method binding expressions,
            etc. Sometimes, we even need to tie them into the Seam context lifecycle (<code class="literal">@Destroy</code>, for
            example). So the Seam contexts can contain objects which are not Seam components, and Seam provides a couple
            of nice features that make it easier to work with non-component objects bound to contexts. 
        </p><p> 
            The <span class="emphasis"><em>factory component pattern</em></span> lets a Seam component act as the instantiator for a
            non-component object. A <span class="emphasis"><em>factory method</em></span> will be called when a context variable is
            referenced but has no value bound to it. We define factory methods using the <code class="literal">@Factory</code>
            annotation. The factory method binds a value to the context variable, and determines the scope of the bound
            value. There are two styles of factory method. The first style returns a value, which is bound to the
            context by Seam:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Factory</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">scope</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">CONVERSATION</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Customer</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getCustomerList</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;</span></pre><p> 
            The second style is a method of type <code class="literal">void</code> which binds the value to the context
            variable itself: 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">DataModel</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Customer</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;customerList</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Factory</span><span class="java_separator">(</span><span class="java_literal">&quot;customerList&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initCustomerList</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;customerList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;</span></pre><p> 
            In both cases, the factory method is called when we reference the <code class="literal">customerList</code> context
            variable and its value is null, and then has no further part to play in the lifecycle of the value. An even
            more powerful pattern is the <span class="emphasis"><em>manager component pattern</em></span>. In this case, we have a Seam
            component that is bound to a context variable, that manages the value of the context variable, while
            remaining invisible to clients. 
        </p><p> 
            A manager component is any component with an <code class="literal">@Unwrap</code> method. This method returns the
            value that will be visible to clients, and is called <span class="emphasis"><em>every time</em></span> a context variable is
            referenced. 
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;customerList&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Scope</span><span class="java_separator">(</span><span class="java_plain">CONVERSATION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomerListManager</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Unwrap</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Customer</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getCustomerList</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p> 
            The manager component pattern is especially useful if we have an object where you need more control over the 
            lifecycle of the component.  For example, if you have a heavyweight object that needs a cleanup operation when 
            the context ends you could <code class="literal">@Unwrap</code> the object, and perform cleanup in the 
            <code class="literal">@Destroy</code> method of the manager component.
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Name</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;hens&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Scope</span><span class="java_separator">(</span><span class="java_plain">APPLICATION</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">HenHouse</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Hen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;hens</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">In</span><span class="java_separator">(</span><span class="java_plain">required</span><span class="java_operator">=</span><span class="java_literal">false</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">Hen</span><span class="java_plain">&nbsp;hen</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Unwrap</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Hen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getHens</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">hens&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Setup</span><span class="java_plain">&nbsp;our&nbsp;hens</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;hens</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Observer</span><span class="java_separator">({</span><span class="java_literal">&quot;chickBorn&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;chickenBoughtAtMarket&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;addHen</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hens</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">hen</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Observer</span><span class="java_separator">(</span><span class="java_literal">&quot;chickenSoldAtMarket&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;removeHen</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hens</span><span class="java_separator">.</span><span class="java_plain">remove</span><span class="java_separator">(</span><span class="java_plain">hen</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Observer</span><span class="java_separator">(</span><span class="java_literal">&quot;foxGetsIn&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;removeAllHens</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hens</span><span class="java_separator">.</span><span class="java_plain">clear</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;</span></pre><p>
		Here the managed component observes many events which change the underlying object. 
		The component manages these actions itself, and because the object is unwrapped
		on every access, a consistent view is provided.
	</p></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="migration23.html"><strong>Prev</strong>Chapter 4. Migration from 2.2 to 2.3</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="xml.html"><strong>Next</strong>Chapter 6. Configuring Seam components</a></li></ul></body></html>