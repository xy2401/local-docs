<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="The Drools Team &lt;https://www.drools.org/community/team.html&gt;">
<title>Drools Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Adobe Analytics for Red Hat - DPAL (DTM Property Auto-Loader) - part 1/2 -->
<script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
<!-- Google Analytics for kie team: Global site tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-62250098-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-62250098-1');
</script>

<!-- Collapsed Table of Content -->
<link rel="stylesheet" href="website/jstree/style.css" />
<link rel="stylesheet" href="website/toc.css" />
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Drools Documentation</h1>
<div class="details">
<span id="author" class="author">The Drools Team &lt;https://www.drools.org/community/team.html&gt;</span><br>
<span id="revnumber">version 7.30.0.Final</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_welcome">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_introduction">1.1. Introduction</a></li>
<li><a href="#_gettingstarted">1.2. Getting Involved</a>
<ul class="sectlevel3">
<li><a href="#_sign_up_to_jboss_org">1.2.1. Sign up to jboss.org</a></li>
<li><a href="#_sign_the_contributor_agreement">1.2.2. Sign the Contributor Agreement</a></li>
<li><a href="#_submitting_issues_via_jira">1.2.3. Submitting issues via JIRA</a></li>
<li><a href="#_fork_github">1.2.4. Fork GitHub</a></li>
<li><a href="#_writing_tests">1.2.5. Writing Tests</a></li>
<li><a href="#_commit_with_correct_conventions">1.2.6. Commit with Correct Conventions</a></li>
<li><a href="#_submit_pull_requests">1.2.7. Submit Pull Requests</a></li>
</ul>
</li>
<li><a href="#_installationandsetup">1.3. Installation and Setup (Core and IDE)</a>
<ul class="sectlevel3">
<li><a href="#_installing_and_using">1.3.1. Installing and using</a></li>
<li><a href="#_building_from_source">1.3.2. Building from source</a></li>
<li><a href="#_eclipse">1.3.3. Eclipse</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_kiechapter">2. KIE</a>
<ul class="sectlevel2">
<li><a href="#_kieoverviewsection">2.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_kieanatomysection">2.1.1. Anatomy of Projects</a></li>
<li><a href="#_kielifecyclessection">2.1.2. Lifecycles</a></li>
<li><a href="#installation-options-ref_decision-management-architecture">2.1.3. Installation environment options for Drools</a></li>
<li><a href="#decision-authoring-assets-ref_decision-management-architecture">2.1.4. Decision-authoring assets in Drools</a></li>
<li><a href="#project-storage-version-build-options-ref_decision-management-architecture">2.1.5. Project storage and build options with Drools</a></li>
<li><a href="#project-deployment-options-ref_decision-management-architecture">2.1.6. Project deployment options with Drools</a></li>
<li><a href="#project-asset-execution-options-ref_decision-management-architecture">2.1.7. Asset execution options with Drools</a></li>
<li><a href="#architecture-scenarios-ref_decision-management-architecture">2.1.8. Example decision management architectures with Drools</a></li>
</ul>
</li>
<li><a href="#_builddeployutilizeandrunsection">2.2. Build, Deploy, Utilize and Run</a>
<ul class="sectlevel3">
<li><a href="#_kiemoduleintroductionbuildingintroductionsection">2.2.1. Introduction</a></li>
<li><a href="#_kiebuildingsection">2.2.2. Building</a></li>
<li><a href="#_kiedeployingsection">2.2.3. Deploying</a></li>
<li><a href="#_kierunningsection">2.2.4. Running</a></li>
<li><a href="#_kiedeploycheatsheets">2.2.5. Installation and Deployment Cheat Sheets</a></li>
<li><a href="#_kieexamplessection">2.2.6. Build,  Deploy and Utilize Examples</a></li>
<li><a href="#kie-scanner-proc_decision-management-architecture">2.2.7. Using a KIE scanner to monitor and update KIE containers</a></li>
</ul>
</li>
<li><a href="#_kiesecuritysection">2.3. Security</a>
<ul class="sectlevel3">
<li><a href="#_securitymanager">2.3.1. Security Manager</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#decision-engine-con_decision-engine">3. Drools engine</a>
<ul class="sectlevel2">
<li><a href="#kie-sessions-con_decision-engine">3.1. KIE sessions</a>
<ul class="sectlevel3">
<li><a href="#kie-sessions-stateless-con_decision-engine">3.1.1. Stateless KIE sessions</a></li>
<li><a href="#kie-sessions-stateful-con_decision-engine">3.1.2. Stateful KIE sessions</a></li>
<li><a href="#kie-sessions-pools-con_decision-engine">3.1.3. KIE session pools</a></li>
</ul>
</li>
<li><a href="#inference-and-truth-maintenance_decision-engine">3.2. Inference and truth maintenance in the Drools engine</a>
<ul class="sectlevel3">
<li><a href="#_government_id_example">3.2.1. Government ID example</a></li>
<li><a href="#fact-equality-modes-con_decision-engine">3.2.2. Fact equality modes in the Drools engine</a></li>
</ul>
</li>
<li><a href="#execution-control-con_decision-engine">3.3. Execution control in the Drools engine</a>
<ul class="sectlevel3">
<li><a href="#_salience_for_rules">3.3.1. Salience for rules</a></li>
<li><a href="#_agenda_groups_for_rules">3.3.2. Agenda groups for rules</a></li>
<li><a href="#_activation_groups_for_rules">3.3.3. Activation groups for rules</a></li>
<li><a href="#rule-execution-modes-con_decision-engine">3.3.4. Rule execution modes and thread safety in the Drools engine</a></li>
<li><a href="#fact-propagation-modes-con_decision-engine">3.3.5. Fact propagation modes in the Drools engine</a></li>
<li><a href="#agenda-filters-con_decision-engine">3.3.6. Agenda evaluation filters</a></li>
<li><a href="#drl-rule-units-con_decision-engine">3.3.7. Rule units in DRL rule sets</a></li>
</ul>
</li>
<li><a href="#phreak-algorithm-con_decision-engine">3.4. Phreak rule algorithm in the Drools engine</a>
<ul class="sectlevel3">
<li><a href="#phreak-rule-evaluation-con_decision-engine">3.4.1. Rule evaluation in Phreak</a></li>
<li><a href="#rule-base-configuration-con_decision-engine">3.4.2. Rule base configuration</a></li>
<li><a href="#phreak-sequential-mode-con_decision-engine">3.4.3. Sequential mode in Phreak</a></li>
</ul>
</li>
<li><a href="#cep-con_decision-engine">3.5. Complex event processing (CEP)</a>
<ul class="sectlevel3">
<li><a href="#cep-events-con_decision-engine">3.5.1. Events in complex event processing</a></li>
<li><a href="#cep-events-proc_decision-engine">3.5.2. Declaring facts as events</a></li>
<li><a href="#drl-declarations-metadata-tags-ref_decision-engine">3.5.3. Metadata tags for events</a></li>
<li><a href="#cep-modes-con_decision-engine">3.5.4. Event processing modes in the Drools engine</a></li>
<li><a href="#property-change-listeners-con_decision-engine">3.5.5. Property-change settings and listeners for fact types</a></li>
<li><a href="#cep-temporal-operators_decision-engine">3.5.6. Temporal operators for events</a></li>
<li><a href="#cep-clock-ref_decision-engine">3.5.7. Session clock implementations in the Drools engine</a></li>
<li><a href="#cep-event-streams-con_decision-engine">3.5.8. Event streams and entry points</a></li>
<li><a href="#cep-sliding-windows-con_decision-engine">3.5.9. Sliding windows of time or length</a></li>
<li><a href="#cep-memory-management-con_decision-engine">3.5.10. Memory management for events</a></li>
</ul>
</li>
<li><a href="#engine-queries-con_decision-engine">3.6. Drools engine queries and live queries</a></li>
<li><a href="#engine-event-listeners-con_decision-engine">3.7. Drools engine event listeners and debug logging</a>
<ul class="sectlevel3">
<li><a href="#logging-proc_decision-engine">3.7.1. Configuring a logging utility in the Drools engine</a></li>
</ul>
</li>
<li><a href="#performance-tuning-decision-engine-ref_decision-engine">3.8. Performance tuning considerations with the Drools engine</a></li>
</ul>
</li>
<li><a href="#_droolslanguagereferencechapter">4. Rule Language Reference</a>
<ul class="sectlevel2">
<li><a href="#drl-rules-con_drl-rules">4.1. DRL (Drools Rule Language) rules</a>
<ul class="sectlevel3">
<li><a href="#drl-packages-con_drl-rules">4.1.1. Packages in DRL</a></li>
<li><a href="#drl-imports-con_drl-rules">4.1.2. Import statements in DRL</a></li>
<li><a href="#drl-functions-con_drl-rules">4.1.3. Functions in DRL</a></li>
<li><a href="#drl-queries-con_drl-rules">4.1.4. Queries in DRL</a></li>
<li><a href="#drl-declarations-con_drl-rules">4.1.5. Type declarations and metadata in DRL</a></li>
<li><a href="#drl-globals-con_drl-rules">4.1.6. Global variables in DRL</a></li>
<li><a href="#rules-attributes-ref_drl-rules">4.1.7. Rule attributes in DRL</a></li>
<li><a href="#drl-rules-WHEN-con_drl-rules">4.1.8. Rule conditions in DRL (WHEN)</a></li>
<li><a href="#drl-rules-THEN-con_drl-rules">4.1.9. Rule actions in DRL (THEN)</a></li>
<li><a href="#drl-rules-comments-con_drl-rules">4.1.10. Comments in DRL files</a></li>
<li><a href="#drl-rules-errors-ref_drl-rules">4.1.11. Error messages for DRL troubleshooting</a></li>
<li><a href="#drl-rule-units-con_drl-rules">4.1.12. Rule units in DRL rule sets</a></li>
<li><a href="#performance-tuning-drl-ref_drl-rules">4.1.13. Performance tuning considerations with DRL</a></li>
</ul>
</li>
<li><a href="#_domain_specific_languages">4.2. Domain Specific Languages</a>
<ul class="sectlevel3">
<li><a href="#_when_to_use_a_dsl">4.2.1. When to Use a DSL</a></li>
<li><a href="#_dsl_basics">4.2.2. DSL Basics</a></li>
<li><a href="#_adding_constraints_to_facts">4.2.3. Adding Constraints to Facts</a></li>
<li><a href="#_developing_a_dsl">4.2.4. Developing a DSL</a></li>
<li><a href="#_dsl_and_dslr_reference">4.2.5. DSL and DSLR Reference</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#drools.DMN">5. Decision Model and Notation (DMN)</a>
<ul class="sectlevel2">
<li><a href="#dmn-con_dmn-models">5.1. Decision Model and Notation (DMN)</a>
<ul class="sectlevel3">
<li><a href="#dmn-conformance-levels-con_dmn-models">5.1.1. DMN conformance levels</a></li>
<li><a href="#dmn-drd-components-ref_dmn-models">5.1.2. DMN decision requirements diagram (DRD) components</a></li>
<li><a href="#dmn-feel-con_dmn-models">5.1.3. Rule expressions in FEEL</a></li>
<li><a href="#dmn-boxed-expressions-con_dmn-models">5.1.4. DMN decision logic in boxed expressions</a></li>
<li><a href="#dmn-model-example-ref_dmn-models">5.1.5. DMN model example</a></li>
</ul>
</li>
<li><a href="#dmn-support-con_dmn-models">5.2. DMN support in Drools</a>
<ul class="sectlevel3">
<li><a href="#dmn-feel-enhancements-ref_dmn-models">5.2.1. FEEL enhancements in Drools</a></li>
<li><a href="#dmn-model-enhancements-ref_dmn-models">5.2.2. DMN model enhancements in Drools</a></li>
<li><a href="#dmn-properties-ref_dmn-models">5.2.3. Configurable DMN properties in Drools</a></li>
</ul>
</li>
<li><a href="#dmn-model-creating-proc_dmn-models">5.3. Creating and editing DMN models in Business Central</a>
<ul class="sectlevel3">
<li><a href="#dmn-logic-defining-proc_dmn-models">5.3.1. Defining DMN decision logic in boxed expressions in Business Central</a></li>
<li><a href="#dmn-data-types-defining-proc_dmn-models">5.3.2. Creating custom data types for DMN boxed expressions in Business Central</a></li>
<li><a href="#dmn-included-models-con_dmn-models">5.3.3. Included models in DMN files in Business Central</a></li>
<li><a href="#dmn-documentation-con_dmn-models">5.3.4. DMN model documentation in Business Central</a></li>
<li><a href="#dmn-designer-nav-ref_dmn-models">5.3.5. DMN designer navigation and properties in Business Central</a></li>
</ul>
</li>
<li><a href="#dmn-execution-con">5.4. DMN model execution</a>
<ul class="sectlevel3">
<li><a href="#dmn-execution-embedded-proc">5.4.1. Embedding a DMN call directly in a Java application</a></li>
<li><a href="#dmn-execution-remote-java-proc">5.4.2. Executing a DMN service using the KIE Server Java client API</a></li>
<li><a href="#dmn-execution-rest-proc">5.4.3. Executing a DMN service using the KIE Server REST API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#drools.PMML">6. Predictive Model Markup Language (PMML)</a>
<ul class="sectlevel2">
<li><a href="#pmml-con_pmml-models">6.1. Predictive Model Markup Language (PMML)</a>
<ul class="sectlevel3">
<li><a href="#pmml-conformance-con_pmml-models">6.1.1. PMML conformance levels</a></li>
</ul>
</li>
<li><a href="#pmml-examples-ref_pmml-models">6.2. PMML model examples</a></li>
<li><a href="#pmml-support-con_pmml-models">6.3. PMML support in Drools</a>
<ul class="sectlevel3">
<li><a href="#pmml-naming-conventions-ref_pmml-models">6.3.1. PMML naming conventions in Drools</a></li>
<li><a href="#pmml-extensions-ref_pmml-models">6.3.2. PMML extensions in Drools</a></li>
</ul>
</li>
<li><a href="#pmml-invocation-options-con_pmml-models">6.4. PMML model execution</a>
<ul class="sectlevel3">
<li><a href="#pmml-invocation-embedded-proc_pmml-models">6.4.1. Embedding a PMML call directly in a Java application</a></li>
<li><a href="#pmml-invocation-kie-server-proc_pmml-models">6.4.2. Executing a PMML model using KIE Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_experimentalfeatureschapter">7. Experimental Features</a>
<ul class="sectlevel2">
<li><a href="#_declarative_agenda">7.1. Declarative Agenda</a></li>
<li><a href="#_traits">7.2. Traits</a>
<ul class="sectlevel3">
<li><a href="#_cascading_traits">7.2.1. Cascading traits</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.commands">8. Drools commands</a>
<ul class="sectlevel2">
<li><a href="#runtime-commands-con_kie-apis">8.1. Runtime commands in Drools</a>
<ul class="sectlevel3">
<li><a href="#runtime-commands-samples-ref_kie-apis">8.1.1. Sample runtime commands in Drools</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cdichapter">9. CDI</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">9.1. Introduction</a></li>
<li><a href="#_annotations">9.2. Annotations</a>
<ul class="sectlevel3">
<li><a href="#_kreleaseid">9.2.1. @KReleaseId</a></li>
<li><a href="#_kcontainer">9.2.2. @KContainer</a></li>
<li><a href="#_kbase">9.2.3. @KBase</a></li>
<li><a href="#_ksession_for_kiesession">9.2.4. @KSession for KieSession</a></li>
<li><a href="#_ksession_for_statelesskiesession">9.2.5. @KSession for StatelessKieSession</a></li>
</ul>
</li>
<li><a href="#_api_example_comparison">9.3. API Example Comparison</a></li>
</ul>
</li>
<li><a href="#_ch.kie.spring">10. Integration with Spring</a>
<ul class="sectlevel2">
<li><a href="#_important_changes_for_drools_6_0">10.1. Important Changes for Drools 6.0</a></li>
<li><a href="#_integration_with_drools_expert">10.2. Integration with Drools Expert</a>
<ul class="sectlevel3">
<li><a href="#_kiemodule">10.2.1. KieModule</a></li>
<li><a href="#_kiebase_3">10.2.2. KieBase</a></li>
<li><a href="#_important_note">10.2.3. IMPORTANT NOTE</a></li>
<li><a href="#_kiesessions">10.2.4. KieSessions</a></li>
<li><a href="#_kiereleaseid">10.2.5. Kie:ReleaseId</a></li>
<li><a href="#_kieimport">10.2.6. Kie:Import</a></li>
<li><a href="#_annotations_2">10.2.7. Annotations</a></li>
<li><a href="#_event_listeners">10.2.8. Event Listeners</a></li>
<li><a href="#_loggers">10.2.9. Loggers</a></li>
<li><a href="#_defining_batch_commands">10.2.10. Defining Batch Commands</a></li>
<li><a href="#_persistence">10.2.11. Persistence</a></li>
<li><a href="#_leveraging_other_spring_features">10.2.12. Leveraging Other Spring Features</a></li>
</ul>
</li>
<li><a href="#_integration_with_jbpm_human_task">10.3. Integration with jBPM Human Task</a>
<ul class="sectlevel3">
<li><a href="#_how_to_configure_spring_with_jbpm_human_task">10.3.1. How to configure Spring with jBPM Human task</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.kie.blueprint">11. Integration with Aries Blueprint</a>
<ul class="sectlevel2">
<li><a href="#_integration_with_drools_expert_2">11.1. Integration with Drools Expert</a>
<ul class="sectlevel3">
<li><a href="#_kiemodule_2">11.1.1. KieModule</a></li>
<li><a href="#_kiebase_4">11.1.2. KieBase</a></li>
<li><a href="#_kiesessions_2">11.1.3. KieSessions</a></li>
<li><a href="#_kiereleaseid_2">11.1.4. Kie:ReleaseId</a></li>
<li><a href="#_kieimport_2">11.1.5. Kie:Import</a></li>
<li><a href="#_event_listeners_2">11.1.6. Event Listeners</a></li>
<li><a href="#_loggers_2">11.1.7. Loggers</a></li>
<li><a href="#_defining_batch_commands_2">11.1.8. Defining Batch Commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.kie.android">12. Android Integration</a>
<ul class="sectlevel2">
<li><a href="#_integration_with_drools_expert_3">12.1. Integration with Drools Expert</a>
<ul class="sectlevel3">
<li><a href="#_pre_serialized_rules">12.1.1. Pre-serialized Rules</a></li>
<li><a href="#_kiecontainer_api_with_drools_compiler_dependency">12.1.2. KieContainer API with drools-compiler dependency</a></li>
</ul>
</li>
<li><a href="#_integration_with_roboguice">12.2. Integration with Roboguice</a>
<ul class="sectlevel3">
<li><a href="#_pre_serialized_rules_with_roboguice">12.2.1. Pre-serialized Rules with Roboguice</a></li>
<li><a href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice">12.2.2. KieContainer with drools-compiler dependency and Roboguice</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.camel">13. Apache Camel Integration</a>
<ul class="sectlevel2">
<li><a href="#_camel">13.1. Camel</a></li>
</ul>
</li>
<li><a href="#_ch.server">14. Drools Camel Server</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">14.1. Introduction</a></li>
<li><a href="#_deployment">14.2. Deployment</a></li>
<li><a href="#_configuration">14.3. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_restcamel_services_configuration">14.3.1. REST/Camel Services configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbench">15. Business Central (General)</a>
<ul class="sectlevel2">
<li><a href="#_wb.installation">15.1. Installation</a>
<ul class="sectlevel3">
<li><a href="#_wb.warinstallation">15.1.1. War installation</a></li>
<li><a href="#_wb.workbenchdata">15.1.2. Business Central data</a></li>
<li><a href="#_wb.troubleshooting">15.1.3. Trouble shooting</a></li>
</ul>
</li>
<li><a href="#business-central-system-properties-ref">15.2. Business Central system properties</a></li>
<li><a href="#_wb.quickstart">15.3. Quick Start</a>
<ul class="sectlevel3">
<li><a href="#_wb.quickstartimportexamples">15.3.1. Importing examples</a></li>
<li><a href="#_wb.quickstartaddproject">15.3.2. Add Project</a></li>
<li><a href="#_wb.quickstartdefinedatamodel">15.3.3. Define Data Model</a></li>
<li><a href="#_wb.quickstartdefinerule">15.3.4. Define Rule</a></li>
<li><a href="#_wb.quickstartbuildanddeloy">15.3.5. Build and Deploy</a></li>
</ul>
</li>
<li><a href="#_wb.configuration">15.4. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_wb.usermanagement">15.4.1. Basic user management</a></li>
<li><a href="#_wb.roles">15.4.2. Roles</a></li>
</ul>
</li>
<li><a href="#_wb.introduction">15.5. Introduction</a>
<ul class="sectlevel3">
<li><a href="#_wb.loginandlogout">15.5.1. Log in and log out</a></li>
<li><a href="#_wb.homescreen">15.5.2. Home screen</a></li>
<li><a href="#_wb.administrationoverview">15.5.3. Business Central overview</a></li>
<li><a href="#_wb.workbenchconcepts">15.5.4. Business Central user interface concepts</a></li>
</ul>
</li>
<li><a href="#_wb.changinglayout">15.6. Changing the layout</a>
<ul class="sectlevel3">
<li><a href="#_wb.resizing">15.6.1. Resizing</a></li>
</ul>
</li>
<li><a href="#_wb.authoring">15.7. Authoring (General)</a>
<ul class="sectlevel3">
<li><a href="#_wb.artifactrepository">15.7.1. Artifact Repository</a></li>
<li><a href="#_wb.asseteditor">15.7.2. Asset Editor</a></li>
<li><a href="#_wb.tagseditor">15.7.3. Tags Editor</a></li>
<li><a href="#_wb.projectexplorer">15.7.4. Project Explorer</a></li>
<li><a href="#_wb.projecteditor">15.7.5. Project Editor</a></li>
<li><a href="#_wb.validation">15.7.6. Validation</a></li>
<li><a href="#_wb.datamodeller">15.7.7. Data Modeller</a></li>
<li><a href="#_wb.datasets">15.7.8. Data Sets</a></li>
<li><a href="#_wb.datasources">15.7.9. Data Source Management</a></li>
</ul>
</li>
<li><a href="#_wb.userandgroupmgmt">15.8. Security management</a>
<ul class="sectlevel3">
<li><a href="#_basic_concepts">15.8.1. Basic concepts</a></li>
<li><a href="#_installation_and_setup">15.8.2. Installation and setup</a></li>
<li><a href="#_usage">15.8.3. Usage</a></li>
<li><a href="#_security_settings_editor">15.8.4. Security Settings Editor</a></li>
<li><a href="#_security_policy_storage">15.8.5. Security Policy Storage</a></li>
</ul>
</li>
<li><a href="#_wb.sshkeystore">15.9. SSH keystore</a>
<ul class="sectlevel3">
<li><a href="#_introduction_4">15.9.1. Introduction</a></li>
<li><a href="#_using_the_ssh_keystore">15.9.2. Using the SSH keystore</a></li>
</ul>
</li>
<li><a href="#_wb.embedding">15.10. Embedding Business Central in Your Application</a></li>
<li><a href="#_wb.execserverui">15.11. Execution Server Management UI</a>
<ul class="sectlevel3">
<li><a href="#_wb.execserveruitemplate">15.11.1. Server Templates</a></li>
<li><a href="#_wb.execserveruicontainer">15.11.2. Container</a></li>
<li><a href="#_wb.execserveruiremoteserver">15.11.3. Remote Server</a></li>
</ul>
</li>
<li><a href="#_wb.experimentalFeatures">15.12. Experimental Features Framework</a>
<ul class="sectlevel3">
<li><a href="#_introduction_5">15.12.1. Introduction</a></li>
<li><a href="#_types_of_experimental_features">15.12.2. Types of <em>Experimental Features</em></a></li>
<li><a href="#_experimental_features_editor">15.12.3. Experimental Features Editor</a></li>
<li><a href="#_enabling_the_experimental_features_framework">15.12.4. Enabling the Experimental Features Framework</a></li>
</ul>
</li>
<li><a href="#_wb.workbenchProfiles">15.13. Business Central profiles</a>
<ul class="sectlevel3">
<li><a href="#_introduction_6">15.13.1. Introduction</a></li>
<li><a href="#_selecting_a_profile">15.13.2. Selecting a profile</a></li>
</ul>
</li>
<li><a href="#performance-tuning-business-central-ref_kie-apis">15.14. Performance tuning considerations with Business Central</a></li>
</ul>
</li>
<li><a href="#drools.AuthoringAssets">16. Authoring rule assets</a>
<ul class="sectlevel2">
<li><a href="#_drools.newpackage">16.1. Creating a package</a>
<ul class="sectlevel3">
<li><a href="#_empty_package">16.1.1. Empty package</a></li>
<li><a href="#_copy_rename_and_delete_packages">16.1.2. Copy, rename, and delete packages</a></li>
</ul>
</li>
<li><a href="#guided-rules-con_kie-apis">16.2. Guided rules</a>
<ul class="sectlevel3">
<li><a href="#guided-rules-create-proc_kie-apis">16.2.1. Creating guided rules</a></li>
<li><a href="#_drools.guidedruleeditordsl">16.2.2. Augmenting with DSL sentences</a></li>
<li><a href="#guided-rules-options-proc_kie-apis">16.2.3. Adding other rule options</a></li>
<li><a href="#_drools.guidedruleeditorcomplexexample">16.2.4. A more complex example:</a></li>
</ul>
</li>
<li><a href="#guided-rule-templates-con">16.3. Guided rule templates</a>
<ul class="sectlevel3">
<li><a href="#guided-rule-templates-create-proc">16.3.1. Creating guided rule templates</a></li>
<li><a href="#guided-rule-templates-tables-proc">16.3.2. Defining data tables for guided rule templates</a></li>
</ul>
</li>
<li><a href="#guided-decision-tables-con">16.4. Guided decision tables</a>
<ul class="sectlevel3">
<li><a href="#guided-decision-tables-create-proc">16.4.1. Creating guided decision tables</a></li>
<li><a href="#hit-policies-con">16.4.2. Hit policies for guided decision tables</a></li>
<li><a href="#guided-decision-tables-columns-create-proc">16.4.3. Adding columns to guided decision tables</a></li>
<li><a href="#guided-decision-tables-columns-types-con">16.4.4. Types of columns in guided decision tables</a></li>
<li><a href="#guided-decision-tables-columns-edit-proc">16.4.5. Editing or deleting columns in guided decision tables</a></li>
<li><a href="#guided-decision-tables-rows-create-proc">16.4.6. Adding rows and defining rules in guided decision tables</a></li>
<li><a href="#guided-decision-tables-validation-con">16.4.7. Real-time verification and validation of guided decision tables</a></li>
<li><a href="#guided-decision-tables-convert-proc">16.4.8. Converting a guided decision table to a spreadsheet decision table</a></li>
</ul>
</li>
<li><a href="#_drools.guideddecisiontablegrapheditor">16.5. Guided decision table graphs</a>
<ul class="sectlevel3">
<li><a href="#_editor">16.5.1. Editor</a></li>
<li><a href="#_creating_a_new_graph">16.5.2. Creating a new graph</a></li>
<li><a href="#_adding_new_tables_to_the_graph">16.5.3. Adding new tables to the graph</a></li>
<li><a href="#_removing_tables">16.5.4. Removing tables</a></li>
</ul>
</li>
<li><a href="#_drools.guideddecisiontreeeditor">16.6. Guided decision trees</a>
<ul class="sectlevel3">
<li><a href="#_the_initial_editor_layout">16.6.1. The initial editor layout</a></li>
<li><a href="#_first_steps">16.6.2. First steps</a></li>
<li><a href="#_editing_data_object_nodes">16.6.3. Editing Data Object nodes</a></li>
<li><a href="#_editing_field_constraint_nodes">16.6.4. Editing Field Constraint nodes</a></li>
<li><a href="#_editing_action_nodes">16.6.5. Editing Action nodes</a></li>
<li><a href="#_managing_the_tree">16.6.6. Managing the tree</a></li>
</ul>
</li>
<li><a href="#decision-tables-con_decision-tables">16.7. Spreadsheet decision tables</a>
<ul class="sectlevel3">
<li><a href="#decision-tables-use-case-con">16.7.1. Decision table use case</a></li>
<li><a href="#decision-tables-defining-proc">16.7.2. Defining spreadsheet decision tables</a></li>
<li><a href="#_creating_and_integrating_spreadsheet_decision_tables">16.7.3. Creating and integrating spreadsheet decision tables</a></li>
<li><a href="#_decision_table_workflow_and_collaboration">16.7.4. Decision table workflow and collaboration</a></li>
<li><a href="#_using_spreadsheet_features">16.7.5. Using spreadsheet features</a></li>
<li><a href="#_rule_templates">16.7.6. Rule templates</a></li>
<li><a href="#decision-tables-upload-proc">16.7.7. Uploading spreadsheet decision tables to Business Central</a></li>
<li><a href="#decision-tables-convert-proc">16.7.8. Converting an uploaded spreadsheet decision table to a guided decision table in Business Central</a></li>
</ul>
</li>
<li><a href="#drl-rules-con_drl-rules">16.8. DRL (Drools Rule Language) rules</a>
<ul class="sectlevel3">
<li><a href="#drl-rules-central-create-proc">16.8.1. Creating DRL rules in Business Central</a></li>
</ul>
</li>
<li><a href="#_drools.dsleditor">16.9. DSL (domain specific language) rules</a></li>
<li><a href="#_drools.guidedscorecardeditor">16.10. Scorecards</a>
<ul class="sectlevel3">
<li><a href="#_drools.guidedscorecardeditorsetupparameters">16.10.1. (a) Setup parameters</a></li>
<li><a href="#_drools.guidedscorecardeditorcharacteristics">16.10.2. (b) Characteristics</a></li>
</ul>
</li>
<li><a href="#enumerations-define-proc_drl-rules">16.11. Defining enumerations for drop-down lists in rule assets</a>
<ul class="sectlevel3">
<li><a href="#enumerations-advanced-ref_drl-rules">16.11.1. Advanced enumeration options for rule assets</a></li>
</ul>
</li>
<li><a href="#test-scenarios-intro-con">16.12. Test scenarios</a>
<ul class="sectlevel3">
<li><a href="#test-designer-con">16.12.1. Test scenarios designer in Business Central</a></li>
<li><a href="#test-designer-create-test-scenario-template-con">16.12.2. Test scenario template</a></li>
<li><a href="#test-designer-test-template-dmn-based-con">16.12.3. Test template for DMN-based test scenarios</a></li>
<li><a href="#test-designer-test-scenario-definition-proc">16.12.4. Defining a test scenario</a></li>
<li><a href="#test-designer-list-map-add-remove-item-proc">16.12.5. Using list and map collections in test scenarios</a></li>
<li><a href="#test-designer-expressions-syntax-intro-ref">16.12.6. Expression syntax in test scenarios</a></li>
<li><a href="#test-designer-run-test-proc">16.12.7. Running the test scenarios</a></li>
<li><a href="#test-scenarios-running-locally-proc">16.12.8. Running a test scenario locally</a></li>
<li><a href="#test-designer-create-mortgages-example-proc">16.12.9. Creating test scenario using the sample Mortgages project</a></li>
<li><a href="#test-scenarios-legacy-designer-con">16.12.10. Test scenarios (legacy) designer in Business Central</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbenchintegration">17. Business Central integration</a>
<ul class="sectlevel2">
<li><a href="#knowledge-store-rest-api-con_drl-rules">17.1. Knowledge Store REST API for Business Central spaces and projects</a>
<ul class="sectlevel3">
<li><a href="#knowledge-store-rest-api-requests-proc_drl-rules">17.1.1. Sending requests with the Knowledge Store REST API using a REST client or curl utility</a></li>
<li><a href="#knowledge-store-rest-api-endpoints-ref_drl-rules">17.1.2. Supported Knowledge Store REST API endpoints</a></li>
</ul>
</li>
<li><a href="#_embedded_drools_controller_calls">17.2. Embedded Drools controller calls</a></li>
<li><a href="#_kie.keycloakssointegration">17.3. Keycloak SSO integration</a>
<ul class="sectlevel3">
<li><a href="#_scenario">17.3.1. Scenario</a></li>
<li><a href="#_install_and_set_up_a_keycloak_server">17.3.2. Install and set up a Keycloak server</a></li>
<li><a href="#_create_and_set_up_the_demo_realm">17.3.3. Create and set up the demo realm</a></li>
<li><a href="#_install_and_set_up_business_central">17.3.4. Install and set up Business Central</a></li>
<li><a href="#_securing_business_central_remote_services_via_keycloak">17.3.5. Securing Business Central remote services via Keycloak</a></li>
<li><a href="#_securing_business_centrals_file_system_services_via_keycloak">17.3.6. Securing Business Central's file system services via Keycloak</a></li>
<li><a href="#_execution_server">17.3.7. Execution server</a></li>
<li><a href="#consumingRemoteServices">17.3.8. Consuming remote services</a></li>
<li><a href="#_keycloak_and_the_business_centrals_security_administration_area">17.3.9. Keycloak and the Business Central's security administration area</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbenchhighavailability">18. Business Central High Availability</a>
<ul class="sectlevel2">
<li><a href="#_wb.vfsclustering">18.1. VFS clustering</a></li>
<li><a href="#_jbpm_clustering">18.2. jBPM clustering</a></li>
</ul>
</li>
<li><a href="#_ch.kie.server">19. KIE Execution Server</a>
<ul class="sectlevel2">
<li><a href="#_overview">19.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_glossary">19.1.1. Glossary</a></li>
</ul>
</li>
<li><a href="#_installing_the_kie_server">19.2. Installing the KIE Server</a>
<ul class="sectlevel3">
<li><a href="#_installation_details_for_different_containers">19.2.1. Installation details for different containers</a></li>
</ul>
</li>
<li><a href="#kie-server-system-properties-ref_kie-apis">19.3. KIE Server system properties</a></li>
<li><a href="#kie-server-extensions-con_kie-apis">19.4. KIE Server capabilities and extensions</a>
<ul class="sectlevel3">
<li><a href="#kie-server-extensions-endpoint-proc_kie-apis">19.4.1. Extending an existing KIE Server capability with a custom REST API endpoint</a></li>
<li><a href="#kie-server-extensions-transport-proc_kie-apis">19.4.2. Extending KIE Server to use a custom data transport</a></li>
<li><a href="#kie-server-extensions-client-proc_kie-apis">19.4.3. Extending the KIE Server client with a custom client API</a></li>
</ul>
</li>
<li><a href="#_kie_server_setup">19.5. Kie Server setup</a>
<ul class="sectlevel3">
<li><a href="#_managed_kie_server">19.5.1. Managed Kie Server</a></li>
<li><a href="#_unmanaged_kie_execution_server">19.5.2. Unmanaged KIE Execution Server</a></li>
</ul>
</li>
<li><a href="#_creating_a_kie_container">19.6. Creating a Kie Container</a></li>
<li><a href="#_managing_containers">19.7. Managing Containers</a>
<ul class="sectlevel3">
<li><a href="#_starting_a_container">19.7.1. Starting a Container</a></li>
<li><a href="#_stopping_and_deleting_a_container">19.7.2. Stopping and Deleting a Container</a></li>
<li><a href="#_updating_a_container">19.7.3. Updating a Container</a></li>
</ul>
</li>
<li><a href="#kie-server-rest-api-con_kie-apis">19.8. KIE Server REST API for KIE containers and business assets</a>
<ul class="sectlevel3">
<li><a href="#kie-server-rest-api-requests-proc_kie-apis">19.8.1. Sending requests with the KIE Server REST API using a REST client or curl utility</a></li>
<li><a href="#kie-server-rest-api-requests-swagger-proc_kie-apis">19.8.2. Sending requests with the KIE Server REST API using the Swagger interface</a></li>
<li><a href="#kie-server-rest-api-endpoints-ref_kie-apis">19.8.3. Supported KIE Server REST API endpoints</a></li>
</ul>
</li>
<li><a href="#kie-server-java-api-con_kie-apis">19.9. KIE Server Java client API for KIE containers and business assets</a>
<ul class="sectlevel3">
<li><a href="#kie-server-java-api-requests-proc_kie-apis">19.9.1. Sending requests with the KIE Server Java client API</a></li>
<li><a href="#kie-server-java-clients-ref_kie-apis">19.9.2. Supported KIE Server Java clients</a></li>
<li><a href="#kie-server-java-api-examples-ref_kie-apis">19.9.3. Example requests with the KIE Server Java client API</a></li>
</ul>
</li>
<li><a href="#kie-server-commands-con_kie-apis">19.10. KIE Server and KIE container commands in Drools</a>
<ul class="sectlevel3">
<li><a href="#kie-server-commands-samples-ref_kie-apis">19.10.1. Sample KIE Server and KIE container commands</a></li>
</ul>
</li>
<li><a href="#runtime-commands-con_kie-apis">19.11. Runtime commands in Drools</a>
<ul class="sectlevel3">
<li><a href="#runtime-commands-samples-ref_kie-apis">19.11.1. Sample runtime commands in Drools</a></li>
</ul>
</li>
<li><a href="#controller-rest-api-con_kie-apis">19.12. Drools controller REST API for KIE Server templates and instances</a>
<ul class="sectlevel3">
<li><a href="#controller-rest-api-requests-proc_kie-apis">19.12.1. Sending requests with the Drools controller REST API using a REST client or curl utility</a></li>
<li><a href="#controller-rest-api-requests-swagger-proc_kie-apis">19.12.2. Sending requests with the Drools controller REST API using the Swagger interface</a></li>
<li><a href="#controller-rest-api-endpoints-ref_kie-apis">19.12.3. Supported Drools controller REST API endpoints</a></li>
</ul>
</li>
<li><a href="#controller-java-api-con_kie-apis">19.13. Drools controller Java client API for KIE Server templates and instances</a>
<ul class="sectlevel3">
<li><a href="#controller-java-api-requests-proc_kie-apis">19.13.1. Sending requests with the Drools controller Java client API</a></li>
<li><a href="#controller-java-clients-ref_kie-apis">19.13.2. Supported Drools controller Java clients</a></li>
<li><a href="#controller-java-api-examples-ref_kie-apis">19.13.3. Example requests with the Drools controller Java client API</a></li>
</ul>
</li>
<li><a href="#_securing_password_using_key_store">19.14. Securing password using key store</a>
<ul class="sectlevel3">
<li><a href="#_simple_usecase">19.14.1. Simple usecase</a></li>
<li><a href="#_implementation_and_business_logic">19.14.2. Implementation and business logic</a></li>
<li><a href="#_system_requirements">19.14.3. System requirements</a></li>
<li><a href="#_initialization_of_a_key_store">19.14.4. Initialization of a key store</a></li>
<li><a href="#_system_parameters_for_loading_key_store">19.14.5. System parameters for loading key store</a></li>
<li><a href="#_example_3">19.14.6. Example</a></li>
</ul>
</li>
<li><a href="#prometheus-monitoring-con_kie-apis">19.15. Prometheus metrics monitoring in Drools</a>
<ul class="sectlevel3">
<li><a href="#prometheus-monitoring-proc_kie-apis">19.15.1. Configuring Prometheus metrics monitoring for KIE Server</a></li>
<li><a href="#prometheus-monitoring-custom-proc_kie-apis">19.15.2. Extending Prometheus metrics monitoring in KIE Server with custom metrics</a></li>
</ul>
</li>
<li><a href="#performance-tuning-kie-server-ref_kie-apis">19.16. Performance tuning considerations with KIE Server</a></li>
</ul>
</li>
<li><a href="#_examples">20. Examples</a>
<ul class="sectlevel2">
<li><a href="#decision-examples-IDE-con_drools-examples">20.1. Example decisions in Drools for an IDE</a></li>
<li><a href="#decision-examples-IDE-proc_drools-examples">20.2. Importing and executing Drools example decisions in an IDE</a></li>
<li><a href="#decision-examples-helloworld-ref_drools-examples">20.3. Hello World example decisions (basic rules and debugging)</a></li>
<li><a href="#decision-examples-state-ref_drools-examples">20.4. State example decisions (forward chaining and conflict resolution)</a></li>
<li><a href="#decision-examples-fibonacci-ref_drools-examples">20.5. Fibonacci example decisions (recursion and conflict resolution)</a></li>
<li><a href="#decision-examples-pricing-ref_drools-examples">20.6. Pricing example decisions (decision tables)</a></li>
<li><a href="#decision-examples-petstore-ref_drools-examples">20.7. Pet Store example decisions (agenda groups, global variables, callbacks, and GUI integration)</a></li>
<li><a href="#decision-examples-politician-ref_drools-examples">20.8. Honest Politician example decisions (truth maintenance and salience)</a></li>
<li><a href="#decision-examples-sudoku-ref_drools-examples">20.9. Sudoku example decisions (complex pattern matching, callbacks, and GUI integration)</a></li>
<li><a href="#decision-examples-conway-ref_drools-examples">20.10. Conway&#8217;s Game of Life example decisions (ruleflow groups and GUI integration)</a></li>
<li><a href="#decision-examples-doom-ref_drools-examples">20.11. House of Doom example decisions (backward chaining and recursion)</a></li>
</ul>
</li>
<li><a href="#droolsreleasenoteschapter">21. Release Notes</a>
<ul class="sectlevel2">
<li><a href="#drools.releasenotesdrools.7.24.0">21.1. New and Noteworthy in Drools 7.24.0</a>
<ul class="sectlevel3">
<li><a href="#dmn-pmml-support">21.1.1. PMML support in DMN included models</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.23.0.final">21.2. New and Noteworthy in Business Central 7.23.0</a>
<ul class="sectlevel3">
<li><a href="#_enhanced_bc_collaboration_features">21.2.1. Enhanced BC collaboration features</a></li>
<li><a href="#_role_based_access_control_for_branches">21.2.2. Role based access control for branches</a></li>
<li><a href="#_importing_a_subset_of_branches">21.2.3. Importing a subset of branches</a></li>
<li><a href="#_dmn_included_models">21.2.4. DMN included models</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.19.0.final">21.3. New and Noteworthy in Business Central 7.19.0</a>
<ul class="sectlevel3">
<li><a href="#_dmn_automatic_layout">21.3.1. DMN Automatic Layout</a></li>
<li><a href="#_dmn_and_test_scenario_context_menu_keyboard_control">21.3.2. DMN and Test Scenario context menu keyboard control</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.18.0">21.4. New and Noteworthy in Drools 7.18</a>
<ul class="sectlevel3">
<li><a href="#_new_builder_options">21.4.1. New Builder Options</a></li>
<li><a href="#_groupdrlsinkiebasesbyfolderoption">21.4.2. GroupDRLsInKieBasesByFolderOption</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.18.0.final">21.5. New and Noteworthy in Business Central 7.18.0</a>
<ul class="sectlevel3">
<li><a href="#_guided_rules_designer_filtering">21.5.1. Guided rules designer filtering</a></li>
<li><a href="#_test_scenario_preview_renamed_to_test_scenario_and_listmap_support">21.5.2. Test Scenario (Preview) renamed to Test Scenario and List/Map support</a></li>
<li><a href="#_development_streamline_lifecycle">21.5.3. Development streamline lifecycle</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.17.0">21.6. New and Noteworthy in Drools 7.17</a>
<ul class="sectlevel3">
<li><a href="#_minor_changes_in_dmn_feel_built_in_functions_parameter_names">21.6.1. Minor changes in DMN FEEL built-in functions' parameter names</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.17.0.final">21.7. New and Noteworthy in Business Central 7.17.0</a>
<ul class="sectlevel3">
<li><a href="#_test_scenario_preview_enabled_by_default">21.7.1. Test Scenario (Preview) enabled by default</a></li>
<li><a href="#_test_scenario_dmn_support">21.7.2. Test Scenario DMN support</a></li>
<li><a href="#_dmn_decision_service_support">21.7.3. DMN Decision Service support</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.16.0.final">21.8. New and Noteworthy in Business Central 7.16.0</a>
<ul class="sectlevel3">
<li><a href="#_dmn_and_test_scenario_keyboard_control">21.8.1. DMN and Test Scenario keyboard control</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.15.0">21.9. New and Noteworthy in Drools 7.15</a>
<ul class="sectlevel3">
<li><a href="#_broken_dmn_resources_detected_in_drools_project_builds">21.9.1. Broken DMN resources detected in Drools project builds</a></li>
<li><a href="#_new_method_for_creating_a_knowledge_run_time">21.9.2. New method for creating a knowledge run time</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.15.0.final">21.10. New and Noteworthy in KIE Workbench 7.15.0</a>
<ul class="sectlevel3">
<li><a href="#_git_hooks_notifications">21.10.1. Git hooks notifications</a></li>
<li><a href="#_kie_workbench_consolidation">21.10.2. KIE Workbench Consolidation</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.14.0">21.11. New and Noteworthy in Drools 7.14</a>
<ul class="sectlevel3">
<li><a href="#_file_system_based_kiescanner">21.11.1. File-system based KieScanner</a></li>
<li><a href="#_support_for_executable_models_in_dmn_projects">21.11.2. Support for executable models in DMN projects</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.14.0.final">21.12. New and Noteworthy in KIE Workbench 7.14.0</a>
<ul class="sectlevel3">
<li><a href="#_ssh_and_git_daemon_port_assignment_changes">21.12.1. SSH and Git Daemon Port Assignment Changes</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.13.0.final">21.13. New and Noteworthy in KIE Workbench 7.13.0</a>
<ul class="sectlevel3">
<li><a href="#_test_scenarios_preview_editor">21.13.1. Test Scenarios (Preview) editor</a></li>
<li><a href="#_experimental_features_support">21.13.2. Experimental Features support</a></li>
<li><a href="#_ssh_keystore">21.13.3. SSH keystore</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.13.0">21.14. New and Noteworthy in Drools 7.13</a>
<ul class="sectlevel3">
<li><a href="#_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types">21.14.1. Allow to declare serialVersionUID on classes generated from declared types</a></li>
<li><a href="#_declaratively_set_calendars_on_kiesession_via_kmodule_xml">21.14.2. Declaratively set Calendars on KieSession via kmodule.xml</a></li>
<li><a href="#_kiesessions_pool">21.14.3. KieSessions pool</a></li>
<li><a href="#_wb.releasenotesworkbench.7.13.0.final">21.14.4. New and Noteworthy in KIE Workbench 7.13.0</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.12.0">21.15. New and Noteworthy in Drools 7.12</a>
<ul class="sectlevel3">
<li><a href="#_end_of_support_for_drools_rhq_plugin_component">21.15.1. End of support for <code>drools-rhq-plugin</code> component</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.11.0">21.16. New and Noteworthy in Drools 7.11</a>
<ul class="sectlevel3">
<li><a href="#_minor_api_changes_of_kie_dmn_open_source_engine">21.16.1. Minor API changes of Kie DMN open source engine</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.11.0.final">21.17. New and Noteworthy in KIE Workbench 7.11.0</a>
<ul class="sectlevel3">
<li><a href="#_multiple_git_branches_support">21.17.1. Multiple Git branches support</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.9.0">21.18. New and Noteworthy in Drools 7.9</a>
<ul class="sectlevel3">
<li><a href="#_moved_executablecommand_to_kie_public_api">21.18.1. Moved ExecutableCommand to KIE public API</a></li>
<li><a href="#_alpha_network_compiler">21.18.2. Alpha Network Compiler</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.8.0.final">21.19. New and Noteworthy in KIE Workbench 7.8.0</a>
<ul class="sectlevel3">
<li><a href="#_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files">21.19.1. New System Property for setting the Default Maven Repository in Project pom.xml files</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.7.0">21.20. New and Noteworthy in Drools 7.7</a>
<ul class="sectlevel3">
<li><a href="#executable-model-con_N&amp;N-7.7">21.20.1. Executable rule models</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.7.0.final">21.21. New and Noteworthy in KIE Workbench 7.7.0</a>
<ul class="sectlevel3">
<li><a href="#_project_oriented_workbench">21.21.1. Project Oriented Workbench</a></li>
<li><a href="#_connecting_to_a_headless_drools_controller">21.21.2. Connecting to a headless Drools controller</a></li>
<li><a href="#_content_management_enhancements">21.21.3. Content management enhancements</a></li>
<li><a href="#_new_migration_tool">21.21.4. New Migration Tool</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.6.0.final">21.22. New and Noteworthy in KIE Workbench 7.6.0</a>
<ul class="sectlevel3">
<li><a href="#_content_management_enhancements_2">21.22.1. Content management enhancements</a></li>
</ul>
</li>
<li><a href="#_kieserver.releasenoteskie.7.5.1">21.23. New Drools controller client API</a></li>
<li><a href="#_breaking_changes_in_kie_server_7_5_1_from_7_0">21.24. Breaking changes in Kie Server 7.5.1 from 7.0</a>
<ul class="sectlevel3">
<li><a href="#_drools_controller_api_changes">21.24.1. Drools controller API changes</a></li>
<li><a href="#_kie_server_api_changes">21.24.2. Kie Server API changes</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.5.0.final">21.25. New and Noteworthy in KIE Workbench 7.5.0</a>
<ul class="sectlevel3">
<li><a href="#_content_management_enhancements_3">21.25.1. Content management enhancements</a></li>
<li><a href="#_extra_navigation_components">21.25.2. Extra navigation components</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.4.0.final">21.26. New and Noteworthy in KIE Workbench 7.4.0</a>
<ul class="sectlevel3">
<li><a href="#_guided_decision_table_improvements">21.26.1. Guided Decision Table improvements</a></li>
<li><a href="#_disable_experimental_editors">21.26.2. Disable experimental editors</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.3.0.final">21.27. New and Noteworthy in KIE Workbench 7.3.0</a>
<ul class="sectlevel3">
<li><a href="#_new_home_and_menu_bar">21.27.1. New Home and Menu Bar</a></li>
<li><a href="#_admin_page_changes">21.27.2. Admin page changes</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.1.0">21.28. New and Noteworthy in Drools 7.1</a></li>
<li><a href="#_wb.releasenotesworkbench.7.1.0.final">21.29. New and Noteworthy in KIE Workbench 7.1.0</a>
<ul class="sectlevel3">
<li><a href="#_project_metrics_dashboard">21.29.1. Project Metrics Dashboard</a></li>
<li><a href="#_teams_metrics_dashboard">21.29.2. Teams Metrics Dashboard</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.0.0">21.30. New and Noteworthy in Drools 7.0</a>
<ul class="sectlevel3">
<li><a href="#_core_engine">21.30.1. Core Engine</a></li>
<li><a href="#_business_central_2">21.30.2. Business Central</a></li>
</ul>
</li>
<li><a href="#_breaking_changes_in_drools_7_0_from_6_x">21.31. Breaking changes in Drools 7.0 from 6.x</a>
<ul class="sectlevel3">
<li><a href="#_property_reactivity_enabled_by_default">21.31.1. Property reactivity enabled by default</a></li>
<li><a href="#_type_preserving_accumulate_functions">21.31.2. Type preserving accumulate functions</a></li>
<li><a href="#_renaming_timedruleexecutionoption">21.31.3. Renaming TimedRuleExecutionOption</a></li>
<li><a href="#_renaming_and_unification_of_configuration_files">21.31.4. Renaming and unification of configuration files</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.0.0.final">21.32. New and Noteworthy in KIE Workbench 7.0.0</a>
<ul class="sectlevel3">
<li><a href="#_new_authoring_library">21.32.1. New Authoring (Library)</a></li>
<li><a href="#_authoring_imports_of_examples">21.32.2. Authoring - Imports of Examples</a></li>
<li><a href="#_authoring_pop_ups_improvements">21.32.3. Authoring - Pop-ups improvements</a></li>
<li><a href="#_authoring_project_editor_reimport_button">21.32.4. Authoring - Project Editor - Reimport button</a></li>
<li><a href="#_security_management">21.32.5. Security Management</a></li>
<li><a href="#_kie_config_cli_has_been_removed">21.32.6. kie-config-cli has been removed</a></li>
<li><a href="#_user_and_project_admin_pages_and_preferences">21.32.7. User and Project Admin Pages and Preferences</a></li>
<li><a href="#_gav_conflict_check_and_child_gav_edition">21.32.8. GAV conflict check and child GAV edition</a></li>
<li><a href="#_data_source_management">21.32.9. Data Source Management</a></li>
</ul>
</li>
<li><a href="#_kieserver.releasenoteskie.7.0.0">21.33. Breaking changes in Kie Server 7.0 from 6.x</a>
<ul class="sectlevel3">
<li><a href="#_serviceresponse_xstream_marshalling_changes">21.33.1. ServiceResponse XStream marshalling changes</a></li>
<li><a href="#_simplified_planner_rest_api">21.33.2. Simplified Planner REST API</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.5.0">21.34. New and Noteworthy in Drools 6.5.0</a>
<ul class="sectlevel3">
<li><a href="#_configurable_threadfactory">21.34.1. Configurable ThreadFactory</a></li>
<li><a href="#_use_of_any_expressions_as_input_for_a_query">21.34.2. Use of any expressions as input for a query</a></li>
<li><a href="#_update_with_modified_properties">21.34.3. Update with modified properties</a></li>
<li><a href="#_monitoring_framework_improvements">21.34.4. Monitoring framework improvements</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.4.0">21.35. New and Noteworthy in Drools 6.4.0</a>
<ul class="sectlevel3">
<li><a href="#_better_java_8_compatibility">21.35.1. Better Java 8 compatibility</a></li>
<li><a href="#_more_robust_incremental_compilation">21.35.2. More robust incremental compilation</a></li>
<li><a href="#_improved_multi_threading_behaviour">21.35.3. Improved multi-threading behaviour</a></li>
<li><a href="#_oopath_improvements_2">21.35.4. OOPath improvements</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.4.0.final">21.36. New and Noteworthy in KIE Workbench 6.4.0</a>
<ul class="sectlevel3">
<li><a href="#_new_look_and_feel">21.36.1. New look and feel</a></li>
<li><a href="#_various_ui_improvements">21.36.2. Various UI improvements</a></li>
<li><a href="#_new_locales">21.36.3. New locales</a></li>
<li><a href="#_authoring_imports_consistent_terminology">21.36.4. Authoring - Imports - Consistent terminology</a></li>
<li><a href="#_disable_automatic_build">21.36.5. Disable automatic build</a></li>
<li><a href="#_support_for_scp_style_git_repository_urls">21.36.6. Support for <code>SCP</code> style <code>git</code> Repository URLs</a></li>
<li><a href="#_authoring_duplicate_gav_detection">21.36.7. Authoring - Duplicate GAV detection</a></li>
<li><a href="#_new_execution_server_management_user_interface">21.36.8. New Execution Server Management User Interface</a></li>
<li><a href="#_user_and_group_management">21.36.9. User and group management</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.3.0">21.37. New and Noteworthy in Drools 6.3.0</a>
<ul class="sectlevel3">
<li><a href="#_browsing_graphs_of_objects_with_oopath">21.37.1. Browsing graphs of objects with OOPath</a></li>
<li><a href="#_shared.releasenotes.kienavigator">21.37.2. Kie Navigator View for Eclipse</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.3.0.final">21.38. New and Noteworthy in KIE Workbench 6.3.0</a>
<ul class="sectlevel3">
<li><a href="#_real_time_validation_and_verification_for_the_decision_tables">21.38.1. Real Time Validation and Verification for the Decision Tables</a></li>
<li><a href="#_improved_drl_editor">21.38.2. Improved DRL Editor</a></li>
<li><a href="#_asset_locking">21.38.3. Asset locking</a></li>
<li><a href="#_data_modeller_tool_windows">21.38.4. Data Modeller Tool Windows</a></li>
<li><a href="#_generation_of_jpa_enabled_data_models">21.38.5. Generation of JPA enabled Data Models</a></li>
<li><a href="#_data_set_authoring">21.38.6. Data Set Authoring</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.2.0">21.39. New and Noteworthy in Drools 6.2.0</a>
<ul class="sectlevel3">
<li><a href="#_propagation_modes">21.39.1. Propagation modes</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.2.0.final">21.40. New and Noteworthy in KIE Workbench 6.2.0</a>
<ul class="sectlevel3">
<li><a href="#_download_repository_or_part_of_the_repository_as_a_zip">21.40.1. Download Repository or Part of the Repository as a ZIP</a></li>
<li><a href="#_project_editor_permissions">21.40.2. Project Editor permissions</a></li>
<li><a href="#_unify_validation_style_in_guided_decision_table_wizard">21.40.3. Unify validation style in Guided Decision Table Wizard.</a></li>
<li><a href="#_improved_wizards">21.40.4. Improved Wizards</a></li>
<li><a href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates">21.40.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</a></li>
<li><a href="#_improved_metadata_tab">21.40.6. Improved Metadata Tab</a></li>
<li><a href="#_improved_data_objects_editor">21.40.7. Improved Data Objects Editor</a></li>
<li><a href="#_execution_server_management_ui">21.40.8. Execution Server Management UI</a></li>
<li><a href="#_social_activities">21.40.9. Social Activities</a></li>
<li><a href="#_contributors_dashboard">21.40.10. Contributors Dashboard</a></li>
<li><a href="#_package_selector">21.40.11. Package selector</a></li>
<li><a href="#_improved_visual_consistency">21.40.12. Improved visual consistency</a></li>
<li><a href="#_guided_decision_tree_editor">21.40.13. Guided Decision Tree Editor</a></li>
<li><a href="#_create_repository_wizard">21.40.14. Create Repository Wizard</a></li>
<li><a href="#_repository_structure_screen">21.40.15. Repository Structure Screen</a></li>
</ul>
</li>
<li><a href="#_kie.releasenotesintegration.6.2.0">21.41. New and Noteworthy in Integration 6.2.0</a>
<ul class="sectlevel3">
<li><a href="#_kie_execution_server">21.41.1. KIE Execution Server</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.1.0">21.42. New and Noteworthy in Drools 6.1.0</a>
<ul class="sectlevel3">
<li><a href="#_jmx_support_for_kiescanner">21.42.1. JMX support for KieScanner</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.1.0">21.43. New and Noteworthy in KIE Workbench 6.1.0</a>
<ul class="sectlevel3">
<li><a href="#_data_modeler_round_trip_and_source_code_preservation">21.43.1. Data Modeler - round trip and source code preservation</a></li>
<li><a href="#_data_modeler_improved_annotations">21.43.2. Data Modeler - improved annotations</a></li>
<li><a href="#_standardization_of_the_display_of_tabular_data">21.43.3. Standardization of the display of tabular data</a></li>
<li><a href="#_generation_of_modifyx_blocks">21.43.4. Generation of <code>modify(x) {&#8230;&#8203;}</code> blocks</a></li>
</ul>
</li>
<li><a href="#_kie.releasenoteskie.6.0.0">21.44. New and Noteworthy in KIE API 6.0.0</a>
<ul class="sectlevel3">
<li><a href="#_new_kie_name">21.44.1. New KIE name</a></li>
<li><a href="#_maven_aligned_projects_and_modules_and_maven_deployment">21.44.2. Maven aligned projects and modules and Maven Deployment</a></li>
<li><a href="#_configuration_and_convention_based_projects">21.44.3. Configuration and convention based projects</a></li>
<li><a href="#_kiebase_inclusion">21.44.4. KieBase Inclusion</a></li>
<li><a href="#_kiemodules_kiecontainer_and_kie_ci">21.44.5. KieModules, KieContainer and KIE-CI</a></li>
<li><a href="#_kiescanner_2">21.44.6. KieScanner</a></li>
<li><a href="#_hierarchical_classloader">21.44.7. Hierarchical ClassLoader</a></li>
<li><a href="#_legacy_api_adapter">21.44.8. Legacy API Adapter</a></li>
<li><a href="#_kie_documentation">21.44.9. KIE Documentation</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.0.0">21.45. New and Noteworthy in Drools 6.0.0</a>
<ul class="sectlevel3">
<li><a href="#_phreak_lazy_rule_matching_algorithm">21.45.1. PHREAK - Lazy rule matching algorithm</a></li>
<li><a href="#_automatically_firing_timed_rule_in_passive_mode">21.45.2. Automatically firing timed rule in passive mode</a></li>
<li><a href="#_expression_timers">21.45.3. Expression Timers</a></li>
<li><a href="#_ruleflowgroups_and_agendagroups_are_merged">21.45.4. RuleFlowGroups and AgendaGroups are merged</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.0.0">21.46. New and Noteworthy in KIE Workbench 6.0.0</a></li>
<li><a href="#_kie.releasenotesintegration.6.0.0">21.47. New and Noteworthy in Integration 6.0.0</a>
<ul class="sectlevel3">
<li><a href="#_cdi">21.47.1. CDI</a></li>
<li><a href="#_spring">21.47.2. Spring</a></li>
<li><a href="#_aries_blueprints">21.47.3. Aries Blueprints</a></li>
<li><a href="#_osgi_ready">21.47.4. OSGi Ready</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./logos/droolsExpertLogo.png" alt="droolsExpertLogo">
</div>
</div>
<h1 id="_welcome" class="discrete">Welcome</h1>
</div>
</div>
<div class="sect1">
<h2 id="_welcome"><a class="anchor" href="#_welcome"></a><a class="link" href="#_welcome">1. Introduction</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">1.1. Introduction</a></h3>
<div class="paragraph">
<p>KIE (Knowledge Is Everything) is an umbrella project introduced to bring our related technologies together under one roof.
It also acts as the core shared between our projects.</p>
</div>
<div class="paragraph">
<p>KIE contains the following different but related projects offering a complete portfolio of solutions for business
automation and management:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Drools</strong> is a business-rule management system with a forward-chaining and backward-chaining inference-based rules engine,
allowing fast and reliable evaluation of business rules and complex event processing. A rules engine is also a fundamental
building block to create an expert system which, in artificial intelligence, is a computer system that emulates the decision-making
ability of a human expert.</p>
</li>
<li>
<p><strong>jBPM</strong> is a flexible Business Process Management suite allowing you to model your business goals by describing
the steps that need to be executed to achieve those goals.</p>
</li>
<li>
<p><strong>OptaPlanner</strong> is a constraint solver that optimizes use cases such as employee rostering, vehicle routing, task assignment
and cloud optimization.</p>
</li>
<li>
<p><strong>Business Central</strong> is a full featured web application for the visual composition of custom business rules and processes.</p>
</li>
<li>
<p><strong>UberFire</strong> is a web-based workbench framework inspired by Eclipse Rich Client Platform.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The 7.x series will follow a more agile approach with more regular and iterative releases. We plan to do some bigger changes than normal for a series of minor releases, and users need to be aware those are coming before adopting.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>UI sections and links will become object oriented, rather than task oriented. <a href="https://en.wikipedia.org/wiki/Object-oriented_user_interface" class="bare">https://en.wikipedia.org/wiki/Object-oriented_user_interface</a></p>
</li>
<li>
<p>Authoring/Library will become project oriented, rather than repository oriented. You&#8217;ll create, browse and open projects rather than repositories. The repository concept will be pushed lower, for instance it&#8217;ll be created automatically when you create the project.</p>
</li>
<li>
<p>The old form modeller will be removed and only the new one made available. Although old forms will continue to render.</p>
</li>
<li>
<p>The new designer will continue to mature with more nodes and improved UXD. Eventually it&#8217;ll become the default editor, but we will not remove the old one until there is feature parity in BPMN2 support.</p>
</li>
<li>
<p>Continued UXD improvements in lots of places.</p>
</li>
<li>
<p>We will introduce the AppFormer project, this will be a re-org and consolidation of existing projects and result in some artifact renames. UberFire will become AppFormer-Core, forms, data modeller and dashbuilder will come under AppFormer. Dashbuilder will most likely be called Appformer-Insight.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The 8.x series will come towards the end of this year. We have ongoing parallel work to introduce concepts of workspaces with improved git support, that will have a built in workflow for forking and pull requests. This will be combined with horizontal scaling and improved high availability. These changes are important for usability and cloud scalability, but too much of a change for a minor release, hence the bump to 8.x</p>
</div>
</div>
<div class="sect2">
<h3 id="_gettingstarted"><a class="anchor" href="#_gettingstarted"></a><a class="link" href="#_gettingstarted">1.2. Getting Involved</a></h3>
<div class="paragraph">
<p>We are often asked "How do I get involved". Luckily the answer is simple, just write some code and submit it :) There are no hoops you have to jump through or secret handshakes.
We have a very minimal "overhead" that we do request to allow for scalable project development.
Below we provide a general overview of the tools and "workflow" we request, along with some general advice.</p>
</div>
<div class="paragraph">
<p>If you contribute some good work, don&#8217;t forget to blog about it :)</p>
</div>
<div class="sect3">
<h4 id="_sign_up_to_jboss_org"><a class="anchor" href="#_sign_up_to_jboss_org"></a><a class="link" href="#_sign_up_to_jboss_org">1.2.1. Sign up to jboss.org</a></h4>
<div class="paragraph">
<p>Signing to jboss.org will give you access to the JBoss wiki, forums and JIRA.
Go to <a href="https://www.jboss.org/" class="bare">https://www.jboss.org/</a> and click "Register".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/sign_jbossorg.png" alt="sign jbossorg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sign_the_contributor_agreement"><a class="anchor" href="#_sign_the_contributor_agreement"></a><a class="link" href="#_sign_the_contributor_agreement">1.2.2. Sign the Contributor Agreement</a></h4>
<div class="paragraph">
<p>The only form you need to sign is the contributor agreement, which is fully automated via the web.
As the image below says "This establishes the terms and conditions for your contributions and ensures that source code can be licensed appropriately"</p>
</div>
<div class="paragraph">
<p><a href="https://cla.jboss.org/" class="bare">https://cla.jboss.org/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/sign_contributor.png" alt="sign contributor">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submitting_issues_via_jira"><a class="anchor" href="#_submitting_issues_via_jira"></a><a class="link" href="#_submitting_issues_via_jira">1.2.3. Submitting issues via JIRA</a></h4>
<div class="paragraph">
<p>To be able to interact with the core development team you will need to use JIRA, the issue tracker.
This ensures that all requests are logged and allocated to a release schedule and all discussions captured in one place.
Bug reports, bug fixes, feature requests and feature submissions should all go here.
General questions should be undertaken at the mailing lists.</p>
</div>
<div class="paragraph">
<p>Minor code submissions, like format or documentation fixes do not need an associated JIRA issue created.</p>
</div>
<div class="paragraph">
<p><a href="https://issues.jboss.org/browse/DROOLS" class="bare">https://issues.jboss.org/browse/DROOLS</a></p>
</div>
<div class="paragraph">
<p><a href="https://issues.jboss.org/browse/JBPM" class="bare">https://issues.jboss.org/browse/JBPM</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/submit_jira.png" alt="submit jira">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fork_github"><a class="anchor" href="#_fork_github"></a><a class="link" href="#_fork_github">1.2.4. Fork GitHub</a></h4>
<div class="paragraph">
<p>With the contributor agreement signed and your requests submitted to JIRA you should now be ready to code :) Create a GitHub account and fork any of the Drools, jBPM or Guvnor repositories.
The fork will create a copy in your own GitHub space which you can work on at your own pace.
If you make a mistake, don&#8217;t worry blow it away and fork again.
Note each GitHub repository provides you the clone (checkout) URL, GitHub will provide you URLs specific to your fork.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup" class="bare">https://github.com/kiegroup</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/fork_github.png" alt="fork github">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_writing_tests"><a class="anchor" href="#_writing_tests"></a><a class="link" href="#_writing_tests">1.2.5. Writing Tests</a></h4>
<div class="paragraph">
<p>When writing tests, try and keep them minimal and self contained.
We prefer to keep the DRL fragments within the test, as it makes for quicker reviewing.
If there are a large number of rules then using a String is not practical so then by all means place them in separate DRL files instead to be loaded from the classpath.
If your tests need to use a model, please try to use those that already exist for other unit tests; such as Person, Cheese or Order.
If no classes exist that have the fields you need, try and update fields of existing classes before adding a new class.</p>
</div>
<div class="paragraph">
<p>There are a vast number of tests to look over to get an idea, MiscTest is a good place to start.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup">https://github.com/kiegroup/drools/blob/master/drools-compiler/src/test/java/org/drools/integrationtests/MiscTest.java</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/unit_test.png" alt="unit test">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_commit_with_correct_conventions"><a class="anchor" href="#_commit_with_correct_conventions"></a><a class="link" href="#_commit_with_correct_conventions">1.2.6. Commit with Correct Conventions</a></h4>
<div class="paragraph">
<p>When you commit, make sure you use the correct conventions.
The commit must start with the JIRA issue id, such as DROOLS-1946.
This ensures the commits are cross referenced via JIRA, so we can see all commits for a given issue in the same place.
After the id the title of the issue should come next.
Then use a newline, indented with a dash, to provide additional information related to this commit.
Use an additional new line and dash for each separate point you wish to make.
You may add additional JIRA cross references to the same commit, if it&#8217;s appropriate.
In general try to avoid combining unrelated issues in the same commit.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to rebase your local fork from the original master and then push your commits back to your fork.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/jira_crossreferenced.png" alt="jira crossreferenced">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submit_pull_requests"><a class="anchor" href="#_submit_pull_requests"></a><a class="link" href="#_submit_pull_requests">1.2.7. Submit Pull Requests</a></h4>
<div class="paragraph">
<p>With your code rebased from original master and pushed to your personal GitHub area, you can now submit your work as a pull request.
If you look at the top of the page in GitHub for your work area there will be a "Pull Request" button.
Selecting this will then provide a gui to automate the submission of your pull request.</p>
</div>
<div class="paragraph">
<p>The pull request then goes into a queue for everyone to see and comment on.
Below you can see a typical pull request.
The pull requests allow for discussions and it shows all associated commits and the diffs for each commit.
The discussions typically involve code reviews which provide helpful suggestions for improvements, and allows for us to leave inline comments on specific parts of the code.
Don&#8217;t be disheartened if we don&#8217;t merge straight away, it can often take several revisions before we accept a pull request.
Luckily GitHub makes it very trivial to go back to your code, do some more commits and then update your pull request to your latest and greatest.</p>
</div>
<div class="paragraph">
<p>It can take time for us to get round to responding to pull requests, so please be patient.
Submitted tests that come with a fix will generally be applied quite quickly, where as just tests will often way until we get time to also submit that with a fix.
Don&#8217;t forget to rebase and resubmit your request from time to time, otherwise over time it will have merge conflicts and core developers will general ignore those.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/submit_pull_request.png" alt="submit pull request">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installationandsetup"><a class="anchor" href="#_installationandsetup"></a><a class="link" href="#_installationandsetup">1.3. Installation and Setup (Core and IDE)</a></h3>
<div class="sect3">
<h4 id="_installing_and_using"><a class="anchor" href="#_installing_and_using"></a><a class="link" href="#_installing_and_using">1.3.1. Installing and using</a></h4>
<div class="paragraph">
<p>Drools provides an Eclipse-based IDE (which is optional), but at its core only Java 1.5 (Java SE) is required.</p>
</div>
<div class="paragraph">
<p>A simple way to get started is to download and install the Eclipse plug-in - this will also require the Eclipse GEF framework to be installed (see below, if you don&#8217;t have it installed already). This will provide you with all the dependencies you need to get going: you can simply create a new rule project and everything will be done for you.
Refer to the chapter on Business Central and IDE for detailed instructions on this.
Installing the Eclipse plug-in is generally as simple as unzipping a file into your Eclipse plug-in directory.</p>
</div>
<div class="paragraph">
<p>Use of the Eclipse plug-in is not required.
Rule files are just textual input (or spreadsheets as the case may be) and the IDE (also known as Business Central) is just a convenience.
People have integrated the Drools engine in many ways, there is no "one size fits all".</p>
</div>
<div class="paragraph">
<p>Alternatively, you can download the binary distribution, and include the relevant JARs in your projects classpath.</p>
</div>
<div class="sect4">
<h5 id="_dependencies_and_jars"><a class="anchor" href="#_dependencies_and_jars"></a><a class="link" href="#_dependencies_and_jars">1.3.1.1. Dependencies and JARs</a></h5>
<div class="paragraph">
<p>Drools is broken down into a few modules, some are required during rule development/compiling, and some are required at runtime.
In many cases, people will simply want to include all the dependencies at runtime, and this is fine.
It allows you to have the most flexibility.
However, some may prefer to have their "runtime" stripped down to the bare minimum, as they will be deploying rules in binary form - this is also possible.
The core Drools engine can be quite compact, and only requires a few 100 kilobytes across 3 JAR files.</p>
</div>
<div class="paragraph">
<p>The following is a description of the important libraries that make up JBoss Drools</p>
</div>
<div class="ulist">
<ul>
<li>
<p>knowledge-api.jar - this provides the interfaces and factories. It also helps clearly show what is intended as a user API and what is just an engine API.</p>
</li>
<li>
<p>knowledge-internal-api.jar - this provides internal interfaces and factories.</p>
</li>
<li>
<p>drools-core.jar - this is the core Drools engine, runtime component. Contains both the RETE engine and the LEAPS engine. This is the only runtime dependency if you are pre-compiling rules (and deploying via Package or RuleBase objects).</p>
</li>
<li>
<p>drools-compiler.jar - this contains the compiler/builder components to take rule source, and build executable rule bases. This is often a runtime dependency of your application, but it need not be if you are pre-compiling your rules. This depends on drools-core.</p>
</li>
<li>
<p>drools-jsr94.jar - this is the JSR-94 compliant implementation, this is essentially a layer over the drools-compiler component. Note that due to the nature of the JSR-94 specification, not all features are easily exposed via this interface. In some cases, it will be easier to go direct to the Drools API, but in some environments the JSR-94 is mandated.</p>
</li>
<li>
<p>drools-decisiontables.jar - this is the decision tables 'compiler' component, which uses the drools-compiler component. This supports both excel and CSV input formats.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are quite a few other dependencies which the above components require, most of which are for the drools-compiler, drools-jsr94 or drools-decisiontables module.
Some key ones to note are "POI" which provides the spreadsheet parsing ability, and "antlr" which provides the parsing for the rule language itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you are using Drools in J2EE or servlet containers and you come across classpath issues with "JDT", then you can switch to the janino compiler.
Set the system property "drools.compiler": For example: -Ddrools.compiler=JANINO.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For up to date info on dependencies in a release, consult the released POMs, which can be found on the Maven repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_with_maven_gradle_ivy_buildr_or_ant"><a class="anchor" href="#_use_with_maven_gradle_ivy_buildr_or_ant"></a><a class="link" href="#_use_with_maven_gradle_ivy_buildr_or_ant">1.3.1.2. Use with Maven, Gradle, Ivy, Buildr or Ant</a></h5>
<div class="paragraph">
<p>The JARs are also available in <a href="http://search.maven.org/#search|ga|1|org.drools">the central
    Maven repository</a> (and also in <a href="https://repository.jboss.org/nexus/index.html#nexus-search;gav" class="bare">https://repository.jboss.org/nexus/index.html#nexus-search;gav</a><sub>org.drools</sub><sub>~</sub>[the JBoss Maven
    repository]).</p>
</div>
<div class="paragraph">
<p>If you use Maven, add KIE and Drools dependencies in your project&#8217;s <em class="path">pom.xml</em>
 like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.drools&lt;/groupId&gt;
        &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;version&gt;...&lt;/version&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
      ...
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
    ...
  &lt;dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is similar for Gradle, Ivy and Buildr.
To identify the latest version, check the Maven repository.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re still using Ant (without Ivy), copy all the JARs from the download zip&#8217;s <em class="path">binaries</em>
 directory and manually verify that your classpath doesn&#8217;t contain duplicate JARs.</p>
</div>
</div>
<div class="sect4">
<h5 id="_runtime"><a class="anchor" href="#_runtime"></a><a class="link" href="#_runtime">1.3.1.3. Runtime</a></h5>
<div class="paragraph">
<p>The "runtime" requirements mentioned here are if you are deploying rules as their binary form (either as KnowledgePackage objects, or KnowledgeBase objects etc). This is an optional feature that allows you to keep your runtime very light.
You may use drools-compiler to produce rule packages "out of process", and then deploy them to a runtime system.
This runtime system only requires drools-core.jar and knowledge-api for execution.
This is an optional deployment pattern, and many people do not need to "trim" their application this much, but it is an ideal option for certain environments.</p>
</div>
</div>
<div class="sect4">
<h5 id="_installing_ide_rule_workbench"><a class="anchor" href="#_installing_ide_rule_workbench"></a><a class="link" href="#_installing_ide_rule_workbench">1.3.1.4. Installing IDE (Rule Workbench)</a></h5>
<div class="paragraph">
<p>The rule workbench (for Eclipse) requires that you have Eclipse 3.4 or greater, as well as Eclipse GEF 3.4 or greater.
You can install it either by downloading the plug-in or using the update site.</p>
</div>
<div class="paragraph">
<p>Another option is to use the JBoss IDE, which comes with all the plug-in requirements pre packaged, as well as a choice of other tools separate to rules.
You can choose just to install rules from the "bundle" that JBoss IDE ships with.</p>
</div>
<div class="sect5">
<h6 id="_installing_gef_a_required_dependency"><a class="anchor" href="#_installing_gef_a_required_dependency"></a><a class="link" href="#_installing_gef_a_required_dependency">Installing GEF (a required dependency)</a></h6>
<div class="paragraph">
<p>GEF is the Eclipse Graphical Editing Framework, which is used for graph viewing components in the plug-in.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t have GEF installed, you can install it using the built in update mechanism (or downloading GEF from the Eclipse.org website not recommended). JBoss IDE has GEF already, as do many other "distributions" of Eclipse, so this step may be redundant for some people.</p>
</div>
<div class="paragraph">
<p>Open the Help&#8594;Software updates&#8230;&#8203;&#8594;Available Software&#8594;Add Site&#8230;&#8203; from the help menu.
Location is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>http://download.eclipse.org/tools/gef/updates/releases/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next you choose the GEF plug-in:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/install_gef.png" alt="install gef">
</div>
</div>
<div class="paragraph">
<p>Press next, and agree to install the plug-in (an Eclipse restart may be required). Once this is completed, then you can continue on installing the rules plug-in.</p>
</div>
</div>
<div class="sect5">
<h6 id="_installing_gef_from_zip_file"><a class="anchor" href="#_installing_gef_from_zip_file"></a><a class="link" href="#_installing_gef_from_zip_file">Installing GEF from zip file</a></h6>
<div class="paragraph">
<p>To install from the zip file, download and unzip the file.
Inside the zip you will see a plug-in directory, and the plug-in JAR itself.
You place the plug-in JAR into your Eclipse applications plug-in directory, and restart Eclipse.</p>
</div>
</div>
<div class="sect5">
<h6 id="_installing_drools_plug_in_from_zip_file"><a class="anchor" href="#_installing_drools_plug_in_from_zip_file"></a><a class="link" href="#_installing_drools_plug_in_from_zip_file">Installing Drools plug-in from zip file</a></h6>
<div class="paragraph">
<p>Download the Drools Eclipse IDE plugin from the link below.
Unzip the downloaded file in your main eclipse folder (do not just copy the file there, extract it so that the feature and plugin JARs end up in the features and plugin directory of eclipse) and (re)start Eclipse.</p>
</div>
<div class="paragraph">
<p><a href="https://www.drools.org/download/download.html" class="bare">https://www.drools.org/download/download.html</a></p>
</div>
<div class="paragraph">
<p>To check that the installation was successful, try opening the Drools perspective: Click the 'Open Perspective' button in the top right corner of your Eclipse window, select 'Other&#8230;&#8203;' and pick the Drools perspective.
If you cannot find the Drools perspective as one of the possible perspectives, the installation probably was unsuccessful.
Check whether you executed each of the required steps correctly: Do you have the right version of Eclipse (3.4.x)? Do you have Eclipse GEF installed (check whether the org.eclipse.gef_3.4.<strong>.jar exists in the plugins directory in your eclipse root folder)? Did you extract the Drools Eclipse plugin correctly (check whether the org.drools.eclipse_</strong>.jar exists in the plugins directory in your eclipse root folder)? If you cannot find the problem, try contacting us (e.g.
on irc or on the user mailing list), more info can be found no our homepage here:</p>
</div>
<div class="paragraph">
<p><a href="https://www.drools.org/" class="bare">https://www.drools.org/</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_drools_runtimes"><a class="anchor" href="#_drools_runtimes"></a><a class="link" href="#_drools_runtimes">Drools Runtimes</a></h6>
<div class="paragraph">
<p>A Drools runtime is a collection of JARs on your file system that represent one specific release of the Drools project JARs.
To create a runtime, you must point the IDE to the release of your choice.
If you want to create a new runtime based on the latest Drools project JARs included in the plugin itself, you can also easily do that.
You are required to specify a default Drools runtime for your Eclipse workspace, but each individual project can override the default and select the appropriate runtime for that project specifically.</p>
</div>
<div class="sect6">
<h7 id="_defining_a_drools_runtime"><a class="anchor" href="#_defining_a_drools_runtime"></a><a class="link" href="#_defining_a_drools_runtime">Defining a Drools runtime</a></h7>
<div class="paragraph">
<p>You are required to define one or more Drools runtimes using the Eclipse preferences view.
To open up your preferences, in the menu Window select the Preferences menu item.
A new preferences dialog should show all your preferences.
On the left side of this dialog, under the Drools category, select "Installed Drools runtimes". The panel on the right should then show the currently defined Drools runtimes.
If you have not yet defined any runtimes, it should like something like the figure below.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/drools-runtimes.png" alt="drools runtimes">
</div>
</div>
<div class="paragraph">
<p>To define a new Drools runtime, click the add button.
A dialog as shown below should pop up, requiring the name for your runtime and the location on your file system where it can be found.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/drools-runtimes-add.png" alt="drools runtimes add">
</div>
</div>
<div class="paragraph">
<p>In general, you have two options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you simply want to use the default JARs as included in the Drools Eclipse plugin, you can create a new Drools runtime automatically by clicking the "Create a new Drools 5 runtime &#8230;&#8203;" button. A file browser will show up, asking you to select the folder on your file system where you want this runtime to be created. The plugin will then automatically copy all required dependencies to the specified folder. After selecting this folder, the dialog should look like the figure shown below.</p>
</li>
<li>
<p>If you want to use one specific release of the Drools project, you should create a folder on your file system that contains all the necessary Drools libraries and dependencies. Instead of creating a new Drools runtime as explained above, give your runtime a name and select the location of this folder containing all the required JARs.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/drools-runtimes-add2.png" alt="drools runtimes add2">
</div>
</div>
<div class="paragraph">
<p>After clicking the OK button, the runtime should show up in your table of installed Drools runtimes, as shown below.
Click checkbox in front of the newly created runtime to make it the default Drools runtime.
The default Drools runtime will be used as the runtime of all your Drools project that have not selected a project-specific runtime.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/drools-runtimes2.png" alt="drools runtimes2">
</div>
</div>
<div class="paragraph">
<p>You can add as many Drools runtimes as you need.
For example, the screenshot below shows a configuration where three runtimes have been defined: a Drools 4.0.7 runtime, a Drools 5.0.0 runtime and a Drools 5.0.0.SNAPSHOT runtime.
The Drools 5.0.0 runtime is selected as the default one.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/drools-runtimes3.png" alt="drools runtimes3">
</div>
</div>
<div class="paragraph">
<p>Note that you will need to restart Eclipse if you changed the default runtime and you want to make sure that all the projects that are using the default runtime update their classpath accordingly.</p>
</div>
</div>
<div class="sect6">
<h7 id="_selecting_a_runtime_for_your_drools_project"><a class="anchor" href="#_selecting_a_runtime_for_your_drools_project"></a><a class="link" href="#_selecting_a_runtime_for_your_drools_project">Selecting a runtime for your Drools project</a></h7>
<div class="paragraph">
<p>Whenever you create a Drools project (using the New Drools Project wizard or by converting an existing Java project to a Drools project using the "Convert to Drools Project" action that is shown when you are in the Drools perspective and you right-click an existing Java project), the plugin will automatically add all the required JARs to the classpath of your project.</p>
</div>
<div class="paragraph">
<p>When creating a new Drools project, the plugin will automatically use the default Drools runtime for that project, unless you specify a project-specific one.
You can do this in the final step of the New Drools Project wizard, as shown below, by deselecting the "Use default Drools runtime" checkbox and selecting the appropriate runtime in the drop-down box.
If you click the "Configure workspace settings &#8230;&#8203;" link, the workspace preferences showing the currently installed Drools runtimes will be opened, so you can add new runtimes there.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/drools-runtimes-newproject.png" alt="drools runtimes newproject">
</div>
</div>
<div class="paragraph">
<p>You can change the runtime of a Drools project at any time by opening the project properties (right-click the project and select Properties) and selecting the Drools category, as shown below.
Check the "Enable project specific settings" checkbox and select the appropriate runtime from the drop-down box.
If you click the "Configure workspace settings &#8230;&#8203;" link, the workspace preferences showing the currently installed Drools runtimes will be opened, so you can add new runtimes there.
If you deselect the "Enable project specific settings" checkbox, it will use the default runtime as defined in your global preferences.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/drools-runtimes-project.png" alt="drools runtimes project">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_from_source"><a class="anchor" href="#_building_from_source"></a><a class="link" href="#_building_from_source">1.3.2. Building from source</a></h4>
<div class="sect4">
<h5 id="_getting_the_sources"><a class="anchor" href="#_getting_the_sources"></a><a class="link" href="#_getting_the_sources">1.3.2.1. Getting the sources</a></h5>
<div class="paragraph">
<p>The source code of each Maven artifact is available in the JBoss Maven repository as a source JAR.
The same source JARs are also included in the download zips.
However, if you want to build from source, it&#8217;s highly recommended to get our sources from our source control.</p>
</div>
<div class="paragraph">
<p>Drools and jBPM use <a href="http://git-scm.com/">Git</a> for source control.
The blessed git repositories are hosted on <a href="https://github.com">GitHub</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kiegroup" class="bare">https://github.com/kiegroup</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Git allows you to fork our code, independently make personal changes on it, yet still merge in our latest changes regularly and optionally share your changes with us.
To learn more about git, read the free book <a href="http://progit.org/book/">Git Pro</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_building_the_sources"><a class="anchor" href="#_building_the_sources"></a><a class="link" href="#_building_the_sources">1.3.2.2. Building the sources</a></h5>
<div class="paragraph">
<p>In essence, building from source is very easy, for example if you want to build the <em class="term">guvnor</em>
 project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ git clone git@github.com:kiegroup/guvnor.git
...
$ cd guvnor
$ mvn clean install -DskipTests -Dfull
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, <em>there are a lot potential pitfalls</em>, so if you&#8217;re serious about building from source
and possibly contributing to the project, <strong>follow the instructions
<a href="https://github.com/kiegroup/droolsjbpm-build-bootstrap/blob/master/README.md">in the README file in droolsjbpm-build-bootstrap</a>.</strong></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eclipse"><a class="anchor" href="#_eclipse"></a><a class="link" href="#_eclipse">1.3.3. Eclipse</a></h4>
<div class="sect4">
<h5 id="_importing_eclipse_projects"><a class="anchor" href="#_importing_eclipse_projects"></a><a class="link" href="#_importing_eclipse_projects">1.3.3.1. Importing Eclipse Projects</a></h5>
<div class="paragraph">
<p>With the 
Eclipse project files generated they can now be imported into Eclipse.
When starting Eclipse open the workspace in the root of your subversion checkout.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import1.jpg" alt="eclipse import1">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import2.jpg" alt="eclipse import2">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import3.jpg" alt="eclipse import3">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import4.jpg" alt="eclipse import4">
</div>
</div>
<div class="paragraph">
<p>When calling <code>mvn install</code> all the project dependencies were downloaded and added to the local Maven repository.
Eclipse cannot find those dependencies unless you tell it where that repository is.
To do this setup an <code>M2_REPO</code> classpath variable.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import6.jpg" alt="eclipse import6">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import7.jpg" alt="eclipse import7">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import8.jpg" alt="eclipse import8">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Install/eclipse_import9.jpg" alt="eclipse import9">
</div>
</div>
<h1 id="_kie" class="discrete">KIE</h1>
<div class="paragraph">
<p>KIE is the shared core for Drools and jBPM. It provides a unified methodology and programming model for
building, deploying and utilizing resources.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kiechapter"><a class="anchor" href="#_kiechapter"></a><a class="link" href="#_kiechapter">2. KIE</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kieoverviewsection"><a class="anchor" href="#_kieoverviewsection"></a><a class="link" href="#_kieoverviewsection">2.1. Overview</a></h3>
<div class="sect3">
<h4 id="_kieanatomysection"><a class="anchor" href="#_kieanatomysection"></a><a class="link" href="#_kieanatomysection">2.1.1. Anatomy of Projects</a></h4>
<div class="paragraph">
<p>The process of researching an integration knowledge solution for Drools and jBPM has simply used the "kiegroup" group name.
This name permeates GitHub accounts and Maven POMs.
As scopes broadened and new projects were spun KIE, an acronym for Knowledge Is Everything, was chosen as the new group name.
The KIE name is also used for the shared aspects of the system; such as the unified build, deploy and utilization.</p>
</div>
<div class="paragraph">
<p>KIE currently consists of the following subprojects:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/Overview/kie.png" alt="kie">
</div>
<div class="title">Figure 1. KIE Anatomy</div>
</div>
<div class="paragraph">
<p>OptaPlanner, a local search and optimization tool, has been spun off from Drools Planner and is now a top level project with Drools and jBPM.
This was a natural evolution as Optaplanner, while having strong Drools integration, has long been independent of Drools.</p>
</div>
<div class="paragraph">
<p>From the Polymita acquisition, along with other things, comes the powerful Dashboard Builder which provides powerful reporting capabilities.
Dashboard Builder is currently a temporary name and after the 6.0 release a new name will be chosen.
Dashboard Builder is completely independent of Drools and jBPM and will be used by many projects at JBoss, and hopefully outside of JBoss :)</p>
</div>
<div class="paragraph">
<p>UberFire is the new base Business Central project, spun off from the ground up rewrite.
UberFire provides Eclipse-like workbench capabilities, with panels and pages from plugins.
The project is independent of Drools and jBPM and anyone can use it as a basis of building flexible and powerful workbenches like Business Central.
UberFire will be used for console and workbench development throughout JBoss.</p>
</div>
<div class="paragraph">
<p>It was determined that the Guvnor brand leaked too much from its intended role; such as the authoring metaphors, like Decision Tables, being considered Guvnor components instead of Drools components.
This wasn&#8217;t helped by the monolithic projects structure used in 5.x for Guvnor.
In 6.0 Guvnor&#8217;s focus has been narrowed to encapsulate the set of UberFire plugins that provide the basis for building a web based IDE.
Such as Maven integration for building and deploying, management of Maven repositories and activity notifications via inboxes.
Drools and jBPM build Business Central distributions using Uberfire as the base and including a set of plugins, such as Guvnor, along with their own plugins for things like decision tables, guided editors, BPMN2 designer, human tasks.
Business Central is called business-central.</p>
</div>
<div class="paragraph">
<p>KIE-WB is the uber workbench that combined all the Guvnor, Drools and jBPM plugins.
The jBPM-WB is ghosted out, as it doesn&#8217;t actually exist, being made redundant by KIE-WB.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kielifecyclessection"><a class="anchor" href="#_kielifecyclessection"></a><a class="link" href="#_kielifecyclessection">2.1.2. Lifecycles</a></h4>
<div class="paragraph">
<p>The different aspects, or life cycles, of working with KIE system, whether it&#8217;s Drools or jBPM, can typically be broken down into the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Author</strong></p>
<div class="ulist">
<ul>
<li>
<p>Authoring of knowledge using a UI metaphor, such as: DRL, BPMN2, decision table, class models.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Build</strong></p>
<div class="ulist">
<ul>
<li>
<p>Builds the authored knowledge into deployable units.</p>
</li>
<li>
<p>For KIE this unit is a JAR.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Test</strong></p>
<div class="ulist">
<ul>
<li>
<p>Test KIE knowledge before it&#8217;s deployed to the application.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Deploy</strong></p>
<div class="ulist">
<ul>
<li>
<p>Deploys the unit to a location where applications may utilize (consume) them.</p>
</li>
<li>
<p>KIE uses Maven style repository.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Utilize</strong></p>
<div class="ulist">
<ul>
<li>
<p>The loading of a JAR to provide a KIE session (KieSession), for which the application can interact with.</p>
</li>
<li>
<p>KIE exposes the JAR at runtime via a KIE container (KieContainer).</p>
</li>
<li>
<p>KieSessions, for the runtime&#8217;s to interact with, are created from the KieContainer.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Run</strong></p>
<div class="ulist">
<ul>
<li>
<p>System interaction with the KieSession, via API.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Work</strong></p>
<div class="ulist">
<ul>
<li>
<p>User interaction with the KieSession, via command line or UI.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Manage</strong></p>
<div class="ulist">
<ul>
<li>
<p>Manage any KieSession or KieContainer.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="installation-options-ref_decision-management-architecture"><a class="anchor" href="#installation-options-ref_decision-management-architecture"></a><a class="link" href="#installation-options-ref_decision-management-architecture">2.1.3. Installation environment options for Drools</a></h4>
<div class="paragraph">
<p>With Drools, you can set up a development environment to develop business applications, a runtime environment to run those applications to support decisions, or both.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Development environment</strong>: Typically consists of one Business Central installation and at least one KIE Server installation. You can use Business Central to design decisions and other artifacts, and you can use KIE Server to execute and test the artifacts that you created.</p>
</li>
<li>
<p><strong>Runtime environment</strong>: Consists of one or more KIE Server instances with or without Business Central. Business Central has an embedded Drools controller. If you install Business Central, use the <strong>Menu</strong> &#8594; <strong>Deploy</strong> &#8594; <strong>Execution servers</strong> page to create and maintain containers. If you want to automate KIE Server management without Business Central, you can use the headless Drools controller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also cluster both development and runtime environments. A clustered development or runtime environment consists of a unified group or "cluster" of two or more servers. The primary benefit of clustering Drools development environments is high availability and enhanced collaboration, while the primary benefit of clustering Drools runtime environments is high availability and load balancing. High availability decreases the chance of a loss of data when a single server fails. When a server fails, another server fills the gap by providing a copy of the data that was on the failed server. When the failed server comes online again, it resumes its place in the cluster. Load balancing shares the computing load across the nodes of the cluster to improve the overall performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Clustering of the runtime environment is currently supported on Red Hat JBoss EAP 7.2
only. Clustering of Business Central is currently a Technology Preview feature that is not yet intended for production use.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_installationandsetup">Installation and Setup (Core and IDE)</a></p>
</li>
<li>
<p><a href="#_wb.advancedsettings">Advanced Settings</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="decision-authoring-assets-ref_decision-management-architecture"><a class="anchor" href="#decision-authoring-assets-ref_decision-management-architecture"></a><a class="link" href="#decision-authoring-assets-ref_decision-management-architecture">2.1.4. Decision-authoring assets in Drools</a></h4>
<div class="paragraph">
<p>Drools supports several assets that you can use to define business decisions for your decision service. Each decision-authoring asset has different advantages, and you might prefer to use one or a combination of multiple assets depending on your goals and needs.</p>
</div>
<div class="paragraph">
<p>The following table highlights the main decision-authoring assets supported in Drools projects to help you decide or confirm the best method for defining decisions in your decision service.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Decision-authoring assets supported in Drools</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Asset</th>
<th class="tableblock halign-left valign-top">Highlights</th>
<th class="tableblock halign-left valign-top">Authoring tools</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decision Model and Notation (DMN) models</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Are decision models based on a notation standard defined by the Object Management Group (OMG)</p>
</li>
<li>
<p>Use graphical decision requirements diagrams (DRDs) with one or more decision requirements graphs (DRGs) to trace business decision flows</p>
</li>
<li>
<p>Use an XML schema that allows the DMN models to be shared between DMN-compliant platforms</p>
</li>
<li>
<p>Support Friendly Enough Expression Language (FEEL) to define decision logic in DMN decision tables and other DMN boxed expressions</p>
</li>
<li>
<p>Are optimal for creating comprehensive, illustrative, and stable decision flows</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central or other DMN-compliant editor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#dmn-con_dmn-models">Decision Model and Notation (DMN)</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guided decision tables</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Are tables of rules that you create in a UI-based table designer in Business Central</p>
</li>
<li>
<p>Are a wizard-led alternative to spreadsheet decision tables</p>
</li>
<li>
<p>Provide fields and options for acceptable input</p>
</li>
<li>
<p>Support template keys and values for creating rule templates</p>
</li>
<li>
<p>Support hit policies, real-time validation, and other additional features not supported in other assets</p>
</li>
<li>
<p>Are optimal for creating rules in a controlled tabular format to minimize compilation errors</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#guided-decision-tables-con">Guided decision tables</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spreadsheet decision tables</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Are XLS or XLSX spreadsheet decision tables that you can upload into Business Central</p>
</li>
<li>
<p>Support template keys and values for creating rule templates</p>
</li>
<li>
<p>Are optimal for creating rules in decision tables already managed outside of Business Central</p>
</li>
<li>
<p>Have strict syntax requirements for rules to be compiled properly when uploaded</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spreadsheet editor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#decision-tables-con_decision-tables">Spreadsheet decision tables</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guided rules</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Are individual rules that you create in a UI-based rule designer in Business Central</p>
</li>
<li>
<p>Provide fields and options for acceptable input</p>
</li>
<li>
<p>Are optimal for creating single rules in a controlled format to minimize compilation errors</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#guided-rules-con_kie-apis">Guided rules</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guided rule templates</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Are reusable rule structures that you create in a UI-based template designer in Business Central</p>
</li>
<li>
<p>Provide fields and options for acceptable input</p>
</li>
<li>
<p>Support template keys and values for creating rule templates (fundamental to the purpose of this asset)</p>
</li>
<li>
<p>Are optimal for creating many rules with the same rule structure but with different defined field values</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#guided-rule-templates-con">Guided rule templates</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DRL rules</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Are individual rules that you define directly in <code>.drl</code> text files</p>
</li>
<li>
<p>Provide the most flexibility for defining rules and other technicalities of rule behavior</p>
</li>
<li>
<p>Can be created in certain standalone environments and integrated with Drools</p>
</li>
<li>
<p>Are optimal for creating rules that require advanced DRL options</p>
</li>
<li>
<p>Have strict syntax requirements for rules to be compiled properly</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central or integrated development environment (IDE)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#drl-rules-con_decision-tables">[drl-rules-con_decision-tables]</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Predictive Model Markup Language (PMML) models</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Are predictive data-analytic models based on a notation standard defined by the Data Mining Group (DMG)</p>
</li>
<li>
<p>Use an XML schema that allows the PMML models to be shared between PMML-compliant platforms</p>
</li>
<li>
<p>Support Regression, Scorecard, Tree, Mining, and other model types</p>
</li>
<li>
<p>Can be included with a standalone Drools project or imported into a project in Business Central</p>
</li>
<li>
<p>Are optimal for incorporating predictive data into decision services in Drools</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PMML or XML editor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#pmml-con_pmml-models">Predictive Model Markup Language (PMML)</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="project-storage-version-build-options-ref_decision-management-architecture"><a class="anchor" href="#project-storage-version-build-options-ref_decision-management-architecture"></a><a class="link" href="#project-storage-version-build-options-ref_decision-management-architecture">2.1.5. Project storage and build options with Drools</a></h4>
<div class="paragraph">
<p>As you develop a Drools project, you need to be able to track the versions of your project with a version-controlled repository, manage your project assets in a stable environment, and build your project for testing and deployment. You can use Business Central for all of these tasks, or use a combination of Business Central and external tools and repositories. Drools supports Git repositories for project version control, Apache Maven for project management, and a variety of Maven-based, Java-based, or custom-tool-based build options.</p>
</div>
<div class="paragraph">
<p>The following options are the main methods for Drools project versioning, storage, and building:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Project version control options (Git)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Versioning option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central Git VFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central contains a built-in Git Virtual File System (VFS) that stores all processes, rules, and other artifacts that you create in the authoring environment. Git is a distributed version control system that implements revisions as commit objects. When you commit your changes into a repository, a new commit object in the Git repository is created. When you create a project in Business Central, the project is added to the Git repository connected to Business Central.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External Git repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you have Drools projects in Git repositories outside of Business Central, you can import them into Drools spaces and use Git hooks to synchronize the internal and external Git repositories.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>NA</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Project management options (Maven)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Management option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central Maven repository</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Business Central contains a built-in Maven repository that organizes and builds project assets that you create in the authoring environment. Maven is a distributed build-automation tool that uses repositories to store Java libraries, plug-ins, and other build artifacts. When building projects and archetypes, Maven dynamically retrieves Java libraries and Maven plug-ins from local or remote repositories to promote shared dependencies across projects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a production environment, consider using an external Maven repository configured with Business Central.
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_wb.artifactrepository">Artifact Repository</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External Maven repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you have Drools projects in an external Maven repository, such as Nexus or Artifactory, you can create a <a href="https://maven.apache.org/settings.html"><code>settings.xml</code> file</a> with connection details and add that file path to the <code>kie.maven.settings.custom</code> property in your project <code>standalone-full.xml</code> file.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://maven.apache.org/settings.html"><em>Maven Settings Reference</em></a></p>
</div>
<div class="paragraph">
<p><a href="#_settings_xml_and_remote_repository_setup">Settings.xml and Remote Repository Setup</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Project build options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Build option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central (KJAR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central builds Drools projects stored in either the built-in Maven repository or a configured external Maven repository. Projects in Business Central are packaged automatically as knowledge JAR (KJAR) files with all components needed for deployment when you build the projects.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_wb.quickstartbuildanddeloy">Build and Deploy</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standalone Maven project (KJAR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you have a standalone Drools Maven project outside of Business Central, you can edit the project <code>pom.xml</code> file to package your project as a KJAR file, and then add a <code>kmodule.xml</code> file with the KIE base and KIE session configurations needed to build the project.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_buildingwithmaven">Building with Maven</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Embedded Java application (KJAR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you have an embedded Java application from which you want to build your Drools project, you can use a <code>KieModuleModel</code> instance to programmatically create a <code>kmodule.xml</code> file with the KIE base and KIE session configurations, and then add all resources in your project to the KIE virtual file system <code>KieFileSystem</code> to build the project.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_definingakiemoduleprogrammatically">Defining a KieModule programmatically</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CI/CD tool (KJAR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you use a tool for continuous integration and continuous delivery (CI/CD), you can configure the tool set to integrate with your Drools Git repositories to build a specified project. Ensure that your projects are packaged and built as KJAR files to ensure optimal deployment.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="project-deployment-options-ref_decision-management-architecture"><a class="anchor" href="#project-deployment-options-ref_decision-management-architecture"></a><a class="link" href="#project-deployment-options-ref_decision-management-architecture">2.1.6. Project deployment options with Drools</a></h4>
<div class="paragraph">
<p>After you develop, test, and build your Drools project, you can deploy the project to begin using the business assets you have created. You can deploy a Drools project to a configured KIE Server, to an embedded Java application, or into a Red Hat OpenShift Container Platform environment for an enhanced containerized implementation.</p>
</div>
<div class="paragraph">
<p>The following options are the main methods for Drools project deployment:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Project deployment options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deployment option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment to KIE Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KIE Server is the server provided with Drools that runs the decision services, process applications, and other deployable assets from a packaged and deployed Drools project (KJAR file). These services are consumed at run time through an instantiated KIE container, or <em>deployment unit</em>. You can deploy and maintain deployment units in KIE Server using Business Central or using a headless Drools controller with its associated REST API (considered a <em>managed</em> KIE Server instance). You can also deploy and maintain deployment units using the KIE Server REST API or Java client API from a standalone Maven project, an embedded Java application, or other custom environment (considered an <em>unmanaged</em> KIE Server instance).</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_kiedeployingsection">Deploying</a></p>
</div>
<div class="paragraph">
<p><a href="#_ch.kie.server">KIE Execution Server</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment to an embedded Java application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you want to deploy Drools projects to your own Java virtual machine (JVM) environment, microservice, or application server, you can bundle the application resources in the project WAR files to create a deployment unit similar to a KIE container. You can also use the core KIE APIs (not KIE Server APIs) to configure a KIE scanner to periodically update KIE containers.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="http://docs.jboss.org/drools/release/latestFinal/kie-api-javadoc/"><em>KIE Public API</em></a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="project-asset-execution-options-ref_decision-management-architecture"><a class="anchor" href="#project-asset-execution-options-ref_decision-management-architecture"></a><a class="link" href="#project-asset-execution-options-ref_decision-management-architecture">2.1.7. Asset execution options with Drools</a></h4>
<div class="paragraph">
<p>After you build and deploy your Drools project to KIE Server or other environment, you can execute the deployed assets for testing or for runtime consumption. You can also execute assets locally in addition to or instead of executing them after deployment.</p>
</div>
<div class="paragraph">
<p>The following options are the main methods for Drools asset execution:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Asset execution options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Execution option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution in KIE Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you deployed Drools project assets to KIE Server, you can use the KIE Server REST API or Java client API to execute and interact with the deployed assets. You can also use Business Central or the headless Drools controller outside of Business Central to manage the configurations and KIE containers in the KIE Server instances associated with your deployed assets.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_ch.kie.server">KIE Execution Server</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution in an embedded Java application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you deployed Drools project assets in your own Java virtual machine (JVM) environment, microservice, or application server, you can use custom APIs or application interactions with core KIE APIs (not KIE Server APIs) to execute assets in the embedded engine.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="http://docs.jboss.org/drools/release/latestFinal/kie-api-javadoc/"><em>KIE Public API</em></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution in a local environment for extended testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As part of your development cycle, you can execute assets locally to ensure that the assets you have created in Drools function as intended. You can use local execution in addition to or instead of executing assets after deployment.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#decision-examples-IDE-proc_drools-examples">Importing and executing Drools example decisions in an IDE</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Smart Router (KIE Server router)</div>
<div class="paragraph">
<p>Depending on your deployment and execution environment, you can use a Smart Router to aggregate multiple independent KIE Server instances as though they are a single server. Smart Router is a single endpoint that can receive calls from client applications to any of your services and route each call automatically to the KIE Server that runs the service. For more information about Smart Router, see
<a href="http://mswiderski.blogspot.com/2016/12/kie-server-router-even-more-flexibility.html">KIE Server router</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="architecture-scenarios-ref_decision-management-architecture"><a class="anchor" href="#architecture-scenarios-ref_decision-management-architecture"></a><a class="link" href="#architecture-scenarios-ref_decision-management-architecture">2.1.8. Example decision management architectures with Drools</a></h4>
<div class="paragraph">
<p>The following scenarios illustrate common variations of Drools installation, asset authoring, project storage, project deployment, and asset execution in a decision management architecture. Each section summarizes the methods and tools used and the advantages for the given architecture. The examples are basic and are only a few of the many combinations you might consider, depending on your specific goals and needs with Drools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Drools on Wildfly with Business Central and KIE Server</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Installation environment</strong>: Drools on
Wildfly</p>
</li>
<li>
<p><strong>Project storage and build environment</strong>: External Git repository for project versioning synchronized with the Business Central Git repository using Git hooks, and external Maven repository for project management and building configured with KIE Server</p>
</li>
<li>
<p><strong>Asset-authoring tool</strong>: Business Central</p>
</li>
<li>
<p><strong>Main asset types</strong>: Decision Model and Notation (DMN) models for decisions</p>
</li>
<li>
<p><strong>Project deployment and execution environment</strong>: KIE Server</p>
</li>
<li>
<p><strong>Scenario advantages</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Stable implementation of Drools in an on-premise development environment</p>
</li>
<li>
<p>Access to the repositories, assets, asset designers, and project build options in Business Central</p>
</li>
<li>
<p>Standardized asset-authoring approach using DMN
for optimal integration and stability</p>
</li>
<li>
<p>Access to KIE Server functionality and KIE APIs for asset deployment and execution</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./KIE/Overview/architecture-BA-on-wildfly.png" alt="architecture BA on wildfly">
</div>
<div class="title">Figure 2. Drools on Wildfly with Business Central and KIE Server</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Drools on Wildfly with an IDE and KIE Server</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Installation environment</strong>: Drools on
Wildfly</p>
</li>
<li>
<p><strong>Project storage and build environment</strong>: External Git repository for project versioning (not synchronized with Business Central) and external Maven repository for project management and building configured with KIE Server</p>
</li>
<li>
<p><strong>Asset-authoring tools</strong>: Integrated development environment (IDE), such as
Eclipse,
and a spreadsheet editor or a Decision Model and Notation (DMN) modeling tool for other decision formats</p>
</li>
<li>
<p><strong>Main asset types</strong>:
Drools Rule Language (DRL) rules, spreadsheet decision tables, and Decision Model and Notation (DMN) models for decisions</p>
</li>
<li>
<p><strong>Project deployment and execution environment</strong>: KIE Server</p>
</li>
<li>
<p><strong>Scenario advantages</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Flexible implementation of Drools in an on-premise development environment</p>
</li>
<li>
<p>Ability to define business assets using an external IDE and other asset-authoring tools of your choice</p>
</li>
<li>
<p>Access to KIE Server functionality and KIE APIs for asset deployment and execution</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./KIE/Overview/architecture-BA-with-IDE.png" alt="architecture BA with IDE">
</div>
<div class="title">Figure 3. Drools on Wildfly with an IDE and KIE Server</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Drools with an IDE and an embedded Java application</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Installation environment</strong>: Drools libraries embedded within a custom application</p>
</li>
<li>
<p><strong>Project storage and build environment</strong>: External Git repository for project versioning (not synchronized with Business Central) and external Maven repository for project management and building configured with your embedded Java application (not configured with KIE Server)</p>
</li>
<li>
<p><strong>Asset-authoring tools</strong>: Integrated development environment (IDE), such as
Eclipse,
and a spreadsheet editor or a Decision Model and Notation (DMN) modeling tool for other decision formats</p>
</li>
<li>
<p><strong>Main asset types</strong>:
Drools Rule Language (DRL) rules, spreadsheet decision tables, and Decision Model and Notation (DMN) models for decisions</p>
</li>
<li>
<p><strong>Project deployment and execution environment</strong>: Embedded Java application, such as in a Java virtual machine (JVM) environment, microservice, or custom application server</p>
</li>
<li>
<p><strong>Scenario advantages</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Custom implementation of Drools in an on-premise development environment with an embedded Java application</p>
</li>
<li>
<p>Ability to define business assets using an external IDE and other asset-authoring tools of your choice</p>
</li>
<li>
<p>Use of custom APIs to interact with core KIE APIs (not KIE Server APIs) and to execute assets in the embedded engine</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./KIE/Overview/architecture-BA-with-custom-app.png" alt="architecture BA with custom app">
</div>
<div class="title">Figure 4. Drools with an IDE and an embedded Java application</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_builddeployutilizeandrunsection"><a class="anchor" href="#_builddeployutilizeandrunsection"></a><a class="link" href="#_builddeployutilizeandrunsection">2.2. Build, Deploy, Utilize and Run</a></h3>
<div class="sect3">
<h4 id="_kiemoduleintroductionbuildingintroductionsection"><a class="anchor" href="#_kiemoduleintroductionbuildingintroductionsection"></a><a class="link" href="#_kiemoduleintroductionbuildingintroductionsection">2.2.1. Introduction</a></h4>
<div class="paragraph">
<p>6.0 introduces a new configuration and convention approach to building KIE bases, instead of using the programmatic builder approach in 5.x.
The builder is still available to fall back on, as it&#8217;s used for the tooling integration.</p>
</div>
<div class="paragraph">
<p>Building now uses Maven, and aligns with Maven practices.
A KIE project or module is simply a Maven Java project or module; with an additional metadata file META-INF/kmodule.xml.
The kmodule.xml file is the descriptor that selects resources to KIE bases and configures those KIE bases and sessions.
There is also alternative XML support via Spring and OSGi BluePrints.</p>
</div>
<div class="paragraph">
<p>While standard Maven can build and package KIE resources, it will not provide validation at build time.
There is a Maven plugin which is recommended to use to get build time validation.
The plugin also generates many classes, making the runtime loading faster too.</p>
</div>
<div class="paragraph">
<p>The example project layout and Maven POM descriptor is illustrated in the screenshot</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/defaultkiesession.png" alt="defaultkiesession">
</div>
<div class="title">Figure 5. Example project layout and Maven POM</div>
</div>
<div class="paragraph">
<p>KIE uses defaults to minimise the amount of configuration.
With an empty kmodule.xml being the simplest configuration.
There must always be a kmodule.xml file, even if empty, as it&#8217;s used for discovery of the JAR and its contents.</p>
</div>
<div class="paragraph">
<p>Maven can either 'mvn install' to deploy a KieModule to the local machine, where all other applications on the local machine use it.
Or it can 'mvn deploy' to push the KieModule to a remote Maven repository.
Building the Application will pull in the KieModule and populate the local Maven repository in the process.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/maven.png" alt="maven">
</div>
<div class="title">Figure 6. Example project layout and Maven POM</div>
</div>
<div class="paragraph">
<p>JARs can be deployed in one of two ways.
Either added to the classpath, like any other JAR in a Maven dependency listing, or they can be dynamically loaded at runtime.
KIE will scan the classpath to find all the JARs with a kmodule.xml in it.
Each found JAR is represented by the KieModule interface.
The terms classpath KieModule and dynamic KieModule are used to refer to the two loading approaches.
While dynamic modules support side by side versioning, classpath modules do not.
Further once a module is on the classpath, no other version may be loaded dynamically.</p>
</div>
<div class="paragraph">
<p>Detailed references for the API are included in the next sections, the impatient can jump straight to the examples section, which is fairly self-explanatory on the different use cases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebuildingsection"><a class="anchor" href="#_kiebuildingsection"></a><a class="link" href="#_kiebuildingsection">2.2.2. Building</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/builder.png" alt="builder">
</div>
<div class="title">Figure 7. org.kie.api.core.builder</div>
</div>
<div class="sect4">
<h5 id="_creatingandbuildingakieproject"><a class="anchor" href="#_creatingandbuildingakieproject"></a><a class="link" href="#_creatingandbuildingakieproject">2.2.2.1. Creating and building a Kie Project</a></h5>
<div class="paragraph">
<p>A Kie Project has the structure of a normal Maven project with the only peculiarity of including a kmodule.xml file defining in a declaratively way the <code>KieBase</code>s and <code>KieSession</code>s that can be created from it.
This file has to be placed in the resources/META-INF folder of the Maven project while all the other Kie artifacts, such as DRL or Excel files, must be stored in the resources folder or in any other subfolder under it.</p>
</div>
<div class="paragraph">
<p>Since meaningful defaults have been provided for all configuration aspects, the simplest kmodule.xml file can contain just an empty kmodule tag like the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. An empty kmodule.xml file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this way the kmodule will contain one single default <code>KieBase</code>.
All Kie assets stored under the resources folder, or any of its subfolders, will be compiled and added to it.
To trigger the building of these artifacts it is enough to create a <code>KieContainer</code> for them.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieContainer.png" alt="KieContainer">
</div>
<div class="title">Figure 8. KieContainer</div>
</div>
<div class="paragraph">
<p>For this simple case it is enough to create a <code>KieContainer</code> that reads the files to be built from the classpath:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Creating a KieContainer from the classpath</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>`
KieServices` is the interface from where it possible to access all the Kie building and runtime facilities:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieServices.png" alt="KieServices">
</div>
<div class="title">Figure 9. KieServices</div>
</div>
<div class="paragraph">
<p>In this way all the Java sources and the Kie resources are compiled and deployed into the KieContainer which makes its contents available for use at runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="_thekmodulexmlfile"><a class="anchor" href="#_thekmodulexmlfile"></a><a class="link" href="#_thekmodulexmlfile">2.2.2.2. The kmodule.xml file</a></h5>
<div class="paragraph">
<p>As explained in the former section, the kmodule.xml file is the place where it is possible to declaratively configure the <code>KieBase</code>(s) and <code>KieSession</code>(s) that can be created from a KIE project.</p>
</div>
<div class="paragraph">
<p>In particular a <code>KieBase</code> is a repository of all the application&#8217;s knowledge definitions.
It will contain rules, processes, functions, and type models.
The <code>KieBase</code> itself does not contain data; instead, sessions are created from the <code>KieBase</code> into which data can be inserted and from which process instances may be started.
Creating the <code>KieBase</code> can be heavy, whereas session creation is very light, so it is recommended that <code>KieBase</code> be cached where possible to allow for repeated session creation.
However end-users usually shouldn&#8217;t worry about it, because this caching mechanism is already automatically provided by the <code>KieContainer</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieBase.png" alt="KieBase">
</div>
<div class="title">Figure 10. KieBase</div>
</div>
<div class="paragraph">
<p>Conversely the <code>KieSession</code> stores and executes on the runtime data.
It is created from the <code>KieBase</code> or more easily can be created directly from the <code>KieContainer</code> if it has been defined in the kmodule.xml file</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieSession.png" alt="KieSession">
</div>
<div class="title">Figure 11. KieSession</div>
</div>
<div class="paragraph">
<p>The kmodule.xml allows to define and configure one or more <code>KieBase</code>s and for each <code>KieBase</code> all the different <code>KieSession</code>s that can be created from it, as showed by the follwing example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. A sample kmodule.xml file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;configuration&gt;
    &lt;property key="drools.evaluator.supersetOf" value="org.mycompany.SupersetOfEvaluatorDefinition"/&gt;
  &lt;/configuration&gt;
  &lt;kbase name="KBase1" default="true" eventProcessingMode="cloud" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg1"&gt;
    &lt;ksession name="KSession2_1" type="stateful" default="true"/&gt;
    &lt;ksession name="KSession2_2" type="stateless" default="false" beliefSystem="jtms"/&gt;
  &lt;/kbase&gt;
  &lt;kbase name="KBase2" default="false" eventProcessingMode="stream" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    &lt;ksession name="KSession3_1" type="stateful" default="false" clockType="realtime"&gt;
      &lt;fileLogger file="drools.log" threaded="true" interval="10"/&gt;
      &lt;workItemHandlers&gt;
        &lt;workItemHandler name="name" type="org.domain.WorkItemHandler"/&gt;
      &lt;/workItemHandlers&gt;
      &lt;calendars&gt;
        &lt;calendar name="monday" type="org.domain.Monday"/&gt;
      &lt;/calendars&gt;
      &lt;listeners&gt;
        &lt;ruleRuntimeEventListener type="org.domain.RuleRuntimeListener"/&gt;
        &lt;agendaEventListener type="org.domain.FirstAgendaListener"/&gt;
        &lt;agendaEventListener type="org.domain.SecondAgendaListener"/&gt;
        &lt;processEventListener type="org.domain.ProcessListener"/&gt;
      &lt;/listeners&gt;
    &lt;/ksession&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here the
tag contains a list of key-value pairs that are the optional properties used to configure the <code>KieBase</code>s building process.
For instance this sample kmodule.xml file defines an additional custom operator named <code>supersetOf</code> and implemented by the <code>org.mycompany.SupersetOfEvaluatorDefinition</code> class.</p>
</div>
<div class="paragraph">
<p>After this 2 <code>KieBase</code>s have been defined and it is possible to instance 2 different types of <code>KieSession</code>s from the first one, while only one from the second.
A list of the attributes that can be defined on the kbase tag, together with their meaning and default values follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. kbase Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Admitted values</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name with which retrieve this KieBase from the KieContainer.
            This is the only mandatory attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any comma separated list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of other KieBases contained in this kmodule.
            The artifacts of all these KieBases will be also included in this one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any comma separated list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default all the Drools artifacts under the resources folder,
            at any level, are included into the KieBase. This attribute allows to limit
            the artifacts that will be compiled in this KieBase to only the ones
            belonging to the list of packages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if this KieBase is the default one for this module, so
            it can be created from the KieContainer without passing any name to it.
            There can be at most one default KieBase in each module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">equalsBehavior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identity, equality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the behavior of Drools when a new fact is inserted into the
            Working Memory. With identity it always create a new FactHandle unless the same
            object isn&#8217;t already present in the Working Memory, while with equality only if
            the newly inserted object is not equal (according to its equal method) to an already
            existing fact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud, stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When compiled in cloud mode the KieBase treats events as normal facts, while
            in stream mode allow temporal reasoning on them.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">declarativeAgenda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled, enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if the Declarative Agenda is enabled or not.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Similarly all attributes of the ksession tag (except of course the name) have meaningful default.
They are listed and described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. ksession Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Admitted values</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique name of this KieSession. Used to fetch the KieSession from the KieContainer.
            This is the only mandatory attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stateful</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stateful, stateless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A stateful session allows to iteratively work with the Working Memory,
            while a stateless one is a one-off execution of a Working Memory with a provided data set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if this KieSession is the default one for this module, so
            it can be created from the KieContainer without passing any name to it.
            In each module there can be at most one default KieSession for each type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">realtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">realtime, pseudo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if events timestamps are determined by the system clock or by
            a psuedo clock controlled by the application. This clock is specially useful for
            unit testing temporal rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">beliefSystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple, jtms, defeasible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the type of belief system used by the KieSession.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As outlined in the former kmodule.xml sample, it is also possible to declaratively create on each <code>KieSession</code> a file (or a console) logger, one or more <code>WorkItemHandler</code>s and <code>Calendar</code>s plus some listeners that can be of 3 different types: ruleRuntimeEventListener, agendaEventListener and processEventListener</p>
</div>
<div class="paragraph">
<p>Having defined a kmodule.xml like the one in the former sample, it is now possible to simply retrieve the KieBases and KieSessions from the KieContainer using their names.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Retrieving KieBases and KieSessions from the KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();

KieBase kBase1 = kContainer.getKieBase("KBase1");
KieSession kieSession1 = kContainer.newKieSession("KSession2_1");
StatelessKieSession kieSession2 = kContainer.newStatelessKieSession("KSession2_2");</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It has to be noted that since KSession2_1 and KSession2_2 are of 2 different types (the first is stateful, while the second is stateless) it is necessary to invoke 2 different methods on the <code>KieContainer</code> according to their declared type.
If the type of the <code>KieSession</code> requested to the <code>KieContainer</code> doesn&#8217;t correspond with the one declared in the kmodule.xml file the <code>KieContainer</code> will throw a <code>RuntimeException</code>.
Also since a <code>KieBase</code> and a <code>KieSession</code> have been flagged as default is it possible to get them from the <code>KieContainer</code> without passing any name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Retrieving default KieBases and KieSessions from the KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainer kContainer = ...

KieBase kBase1 = kContainer.getKieBase(); // returns KBase1
KieSession kieSession1 = kContainer.newKieSession(); // returns KSession2_1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since a Kie project is also a Maven project the groupId, artifactId and version declared in the pom.xml file are used to generate a <code>ReleaseId</code> that uniquely identifies this project inside your application.
This allows creation of a new KieContainer from the project by simply passing its <code>ReleaseId</code> to the <code>KieServices</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Creating a KieContainer of an existing project by ReleaseId</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_buildingwithmaven"><a class="anchor" href="#_buildingwithmaven"></a><a class="link" href="#_buildingwithmaven">2.2.2.3. Building with Maven</a></h5>
<div class="paragraph">
<p>The KIE plugin for Maven ensures that artifact resources are validated and pre-compiled, it is recommended that this is used at all times.
To use the plugin simply add it to the build section of the Maven pom.xml and activate it by using packaging <code>kjar</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Adding the KIE plugin to a Maven pom.xml and activating it</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;packaging&gt;kjar&lt;/packaging&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.kie&lt;/groupId&gt;
        &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;7.30.0.Final&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin comes with support for all the Drools/jBPM knowledge resources.
However, in case you are using specific KIE annotations in your Java classes, like for example <code>@kie.api.Position</code>, you will need to add compile time dependency on <code>kie-api</code> into your project.
We recommend to use the provided scope for all the additional KIE dependencies.
That way the kjar stays as lightweight as possible, and not dependant on any particular KIE version.</p>
</div>
<div class="paragraph">
<p>Building a KIE module without the Maven plugin will copy all the resources, as is, into the resulting JAR.
When that JAR is loaded by the runtime, it will attempt to build all the resources then.
If there are compilation issues it will return a null KieContainer.
It also pushes the compilation overhead to the runtime.
In general this is not recommended, and the Maven plugin should always be used.</p>
</div>
</div>
<div class="sect4">
<h5 id="_definingakiemoduleprogrammatically"><a class="anchor" href="#_definingakiemoduleprogrammatically"></a><a class="link" href="#_definingakiemoduleprogrammatically">2.2.2.4. Defining a KieModule programmatically</a></h5>
<div class="paragraph">
<p>It is also possible to define the <code>KieBase</code>s and <code>KieSession</code>s belonging to a KieModule programmatically instead of the declarative definition in the kmodule.xml file.
The same programmatic API also allows in explicitly adding the file containing the Kie artifacts instead of automatically read them from the resources folder of your project.
To do that it is necessary to create a <code>KieFileSystem</code>, a sort of virtual file system, and add all the resources contained in your project to it.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieFileSystem.png" alt="KieFileSystem">
</div>
<div class="title">Figure 12. KieFileSystem</div>
</div>
<div class="paragraph">
<p>Like all other Kie core components you can obtain an instance of the <code>KieFileSystem</code> from the <code>KieServices</code>.
The kmodule.xml configuration file must be added to the filesystem.
This is a mandatory step.
Kie also provides a convenient fluent API, implemented by the <code>KieModuleModel</code>, to programmatically create this file.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieModuleModel.png" alt="KieModuleModel">
</div>
<div class="title">Figure 13. KieModuleModel</div>
</div>
<div class="paragraph">
<p>To do this in practice it is necessary to create a <code>KieModuleModel</code> from the <code>KieServices</code>, configure it with the desired <code>KieBase</code>s and <code>KieSession</code>s, convert it in XML and add the XML to the <code>KieFileSystem</code>.
This process is shown by the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Creating a kmodule.xml programmatically and adding it to a KieFileSystem</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieModuleModel kieModuleModel = kieServices.newKieModuleModel();

KieBaseModel kieBaseModel1 = kieModuleModel.newKieBaseModel( "KBase1 ")
        .setDefault( true )
        .setEqualsBehavior( EqualityBehaviorOption.EQUALITY )
        .setEventProcessingMode( EventProcessingOption.STREAM );

KieSessionModel ksessionModel1 = kieBaseModel1.newKieSessionModel( "KSession1" )
        .setDefault( true )
        .setType( KieSessionModel.KieSessionType.STATEFUL )
        .setClockType( ClockTypeOption.get("realtime") );

KieFileSystem kfs = kieServices.newKieFileSystem();
kfs.writeKModuleXML(kieModuleModel.toXML());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this point it is also necessary to add to the <code>KieFileSystem</code>, through its fluent API, all others Kie artifacts composing your project.
These artifacts have to be added in the same position of a corresponding usual Maven project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Adding Kie artifacts to a KieFileSystem</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieFileSystem kfs = ...
kfs.write( "src/main/resources/KBase1/ruleSet1.drl", stringContainingAValidDRL )
        .write( "src/main/resources/dtable.xls",
                kieServices.getResources().newInputStreamResource( dtableFileStream ) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example shows that it is possible to add the Kie artifacts both as plain Strings and as <code>Resource</code>s.
In the latter case the <code>Resource</code>s can be created by the <code>KieResources</code> factory, also provided by the <code>KieServices</code>.
The <code>KieResources</code> provides many convenient factory methods to convert an <code>InputStream</code>, a <code>URL</code>, a <code>File</code>, or a <code>String</code> representing a path of your file system to a <code>Resource</code> that can be managed by the <code>KieFileSystem</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieResources.png" alt="KieResources">
</div>
<div class="title">Figure 14. KieResources</div>
</div>
<div class="paragraph">
<p>Normally the type of a <code>Resource</code> can be inferred from the extension of the name used to add it to the <code>KieFileSystem</code>.
However it also possible to not follow the Kie conventions about file extensions and explicitly assign a specific <code>ResourceType</code> to a <code>Resource</code> as shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Creating and adding a Resource with an explicit type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieFileSystem kfs = ...
kfs.write( "src/main/resources/myDrl.txt",
           kieServices.getResources().newInputStreamResource( drlStream )
                      .setResourceType(ResourceType.DRL) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Add all the resources to the <code>KieFileSystem</code> and build it by passing the <code>KieFileSystem</code> to a <code>KieBuilder</code></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieBuilder.png" alt="KieBuilder">
</div>
<div class="title">Figure 15. KieBuilder</div>
</div>
<div class="paragraph">
<p>When the contents of a <code>KieFileSystem</code> are successfully built, the resulting <code>KieModule</code> is automatically added to the <code>KieRepository</code>.
The <code>KieRepository</code> is a singleton acting as a repository for all the available <code>KieModule</code>s.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRepository.png" alt="KieRepository">
</div>
<div class="title">Figure 16. KieRepository</div>
</div>
<div class="paragraph">
<p>After this it is possible to create through the <code>KieServices</code> a new <code>KieContainer</code> for that <code>KieModule</code> using its <code>ReleaseId</code>.
However, since in this case the <code>KieFileSystem</code> doesn&#8217;t contain any pom.xml file (it is possible to add one using the <code>KieFileSystem.writePomXML</code> method), Kie cannot determine the <code>ReleaseId</code> of the <code>KieModule</code> and assign to it a default one.
This default <code>ReleaseId</code> can be obtained from the <code>KieRepository</code> and used to identify the <code>KieModule</code> inside the <code>KieRepository</code> itself.
The following example shows this whole process.</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Building the contents of a KieFileSystem and creating a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieFileSystem kfs = ...
kieServices.newKieBuilder( kfs ).buildAll();
KieContainer kieContainer = kieServices.newKieContainer(kieServices.getRepository().getDefaultReleaseId());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this point it is possible to get <code>KieBase</code>s and create new <code>KieSession</code>s from this <code>KieContainer</code> exactly in the same way as in the case of a <code>KieContainer</code> created directly from the classpath.</p>
</div>
<div class="paragraph">
<p>It is a best practice to check the compilation results.
The <code>KieBuilder</code> reports compilation results of 3 different severities: ERROR, WARNING and INFO.
An ERROR indicates that the compilation of the project failed and in the case no <code>KieModule</code> is produced and nothing is added to the <code>KieRepository</code>.
WARNING and INFO results can be ignored, but are available for inspection.</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Checking that a compilation didn&#8217;t produce any error</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBuilder kieBuilder = kieServices.newKieBuilder( kfs ).buildAll();
assertEquals( 0, kieBuilder.getResults().getMessages( Message.Level.ERROR ).size() );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_changingthedefaultbuildresultseverity"><a class="anchor" href="#_changingthedefaultbuildresultseverity"></a><a class="link" href="#_changingthedefaultbuildresultseverity">2.2.2.5. Changing the Default Build Result Severity</a></h5>
<div class="paragraph">
<p>In some cases, it is possible to change the default severity of a type of build result.
For instance, when a new rule with the same name of an existing rule is added to a package, the default behavior is to replace the old rule by the new rule and report it as an INFO.
This is probably ideal for most use cases, but in some deployments the user might want to prevent the rule update and report it as an error.</p>
</div>
<div class="paragraph">
<p>Changing the default severity for a result type, configured like any other option in Drools, can be done by API calls, system properties or configuration files.
As of this version, Drools supports configurable result severity for rule updates and function updates.
To configure it using system properties or configuration files, the user has to use the following properties:</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Setting the severity using properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// sets the severity of rule updates
drools.kbuilder.severity.duplicateRule = &lt;INFO|WARNING|ERROR&gt;
// sets the severity of function updates
drools.kbuilder.severity.duplicateFunction = &lt;INFO|WARNING|ERROR&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_building_and_running_drools_in_a_fat_jar"><a class="anchor" href="#_building_and_running_drools_in_a_fat_jar"></a><a class="link" href="#_building_and_running_drools_in_a_fat_jar">2.2.2.6. Building and running Drools in a fat jar</a></h5>
<div class="paragraph">
<p>Many modules of Drools (e.g. drools-core, drools-compiler) have a file named <code>kie.conf</code> containing the names of the classes implementing the services
provided by the corresponding module. When running Drools in a fat JAR, for example created by the Maven Shade Plugin, those various <code>kie.conf</code> files
need to be merged, otherwise , the fat JAR will contain only 1 kie.conf from a single dependency, resulting into errors.  You can merge resources in
the Maven Shade Plugin using transformers, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer"&gt;
    &lt;resource&gt;META-INF/kie.conf&lt;/resource&gt;
&lt;/transformer&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance this is required when running Drools in a Vert.x application. In this case the Maven Shade Plugin can be configured as it follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.1.0&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;shade&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;transformers&gt;
                    &lt;transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"&gt;
                        &lt;manifestEntries&gt;
                            &lt;Main-Class&gt;io.vertx.core.Launcher&lt;/Main-Class&gt;
                            &lt;Main-Verticle&gt;${main.verticle}&lt;/Main-Verticle&gt;
                        &lt;/manifestEntries&gt;
                    &lt;/transformer&gt;
                    &lt;transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer"&gt;
                        &lt;resource&gt;META-INF/services/io.vertx.core.spi.VerticleFactory&lt;/resource&gt;
                    &lt;/transformer&gt;
                    &lt;transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer"&gt;
                        &lt;resource&gt;META-INF/kie.conf&lt;/resource&gt;
                    &lt;/transformer&gt;
                &lt;/transformers&gt;
                &lt;artifactSet&gt;
                &lt;/artifactSet&gt;
                &lt;outputFile&gt;${project.build.directory}/${project.artifactId}-${project.version}-fat.jar&lt;/outputFile&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiedeployingsection"><a class="anchor" href="#_kiedeployingsection"></a><a class="link" href="#_kiedeployingsection">2.2.3. Deploying</a></h4>
<div class="sect4">
<h5 id="_kiebase"><a class="anchor" href="#_kiebase"></a><a class="link" href="#_kiebase">2.2.3.1. KieBase</a></h5>
<div class="paragraph">
<p>The <code>KieBase</code> is a repository of all the application&#8217;s knowledge definitions.
It will contain rules, processes, functions, and type models.
The <code>KieBase</code> itself does not contain data; instead, sessions are created from the <code>KieBase</code> into which data can be inserted and from which process instances may be started.
The <code>KieBase</code> can be obtained from the <code>KieContainer</code> containing the <code>KieModule</code> where the <code>KieBase</code> has been defined.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieBase.png" alt="KieBase">
</div>
<div class="title">Figure 17. KieBase</div>
</div>
<div class="paragraph">
<p>Sometimes, for instance in a OSGi environment, the <code>KieBase</code> needs to resolve types that are not in the default class loader.
In this case it will be necessary to create a <code>KieBaseConfiguration</code> with an additional class loader and pass it to <code>KieContainer</code> when creating a new <code>KieBase</code> from it.</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Creating a new KieBase with a custom ClassLoader</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieBaseConfiguration kbaseConf = kieServices.newKieBaseConfiguration( null, MyType.class.getClassLoader() );
KieBase kbase = kieContainer.newKieBase( kbaseConf );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiesessions_and_kiebase_modifications"><a class="anchor" href="#_kiesessions_and_kiebase_modifications"></a><a class="link" href="#_kiesessions_and_kiebase_modifications">2.2.3.2. KieSessions and KieBase Modifications</a></h5>
<div class="paragraph">
<p>KieSessions will be discussed in more detail in section "Running". The <code>KieBase</code> creates and returns <code>KieSession</code> objects, and it may optionally keep references to those.
When <code>KieBase</code> modifications occur those modifications are applied against the data in the sessions.
This reference is a weak reference and it is also optional, which is controlled by a boolean flag.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kiescanner"><a class="anchor" href="#_kiescanner"></a><a class="link" href="#_kiescanner">2.2.3.3. KieScanner</a></h5>
<div class="paragraph">
<p>The <code>KieScanner</code> allows continuous monitoring of your Maven repository to check whether a new release of a Kie project has been installed.
A new release is deployed in the <code>KieContainer</code> wrapping that project.
The use of the <code>KieScanner</code> requires kie-ci.jar to be on the classpath.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieScanner.png" alt="KieScanner">
</div>
<div class="title">Figure 18. KieScanner</div>
</div>
<div class="paragraph">
<p>A <code>KieScanner</code> can be registered on a <code>KieContainer</code> as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Registering and starting a KieScanner on a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0-SNAPSHOT" );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example the <code>KieScanner</code> is configured to run with a fixed time interval, but it is also possible to run it on demand by invoking the <code>scanNow()</code> method on it.
If the <code>KieScanner</code> finds, in the Maven repository, an updated version of the Kie project used by that <code>KieContainer</code> it automatically downloads the new version and triggers an incremental build of the new project.
At this point, existing <code>KieBase</code>s and <code>KieSession</code>s under the control of <code>KieContainer</code> will get automatically upgraded with it - specifically, those <code>KieBase</code>s obtained with <code>getKieBase()</code> along with their related <code>KieSession</code>s, and any <code>KieSession</code> obtained directly with <code>KieContainer.newKieSession()</code> thus referencing the default <code>KieBase</code>.
Additionally, from this moment on, all the new <code>KieBase</code>s and <code>KieSession</code>s created from that <code>KieContainer</code> will use the new project version.
Please notice however any existing <code>KieBase</code> which was obtained via <code>newKieBase()</code> before the KieScanner upgrade, and any of its related <code>KieSession</code>s, will not get automatically upgraded; this is because <code>KieBase</code>s obtained via <code>newKieBase()</code> are not under the direct control of the <code>KieContainer</code>.</p>
</div>
<div class="paragraph">
<p>The <code>KieScanner</code> will only pickup changes to deployed jars if it is using a SNAPSHOT, version range, the LATEST, or the RELEASE setting.
Fixed versions will not automatically update at runtime.</p>
</div>
<div class="paragraph">
<p>In case you don&#8217;t want to install a maven repository, it is also possible to have a <code>KieScanner</code> that works
by simply fetching update from a folder of a plain file system. You can create such a <code>KieScanner</code> as simply as</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieScanner kScanner = kieServices.newKieScanner( kContainer, "/myrepo/kjars" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>where "/myrepo/kjars" will be the folder where the <code>KieScanner</code> will look for kjar updates. The jar files placed in this folder
have to follow the maven convention and then have to be a name in the form {artifactId}-{versionId}.jar</p>
</div>
</div>
<div class="sect4">
<h5 id="_maven_versions_and_dependencies"><a class="anchor" href="#_maven_versions_and_dependencies"></a><a class="link" href="#_maven_versions_and_dependencies">2.2.3.4. Maven Versions and Dependencies</a></h5>
<div class="paragraph">
<p>Maven supports a number of mechanisms to manage versioning and dependencies within applications.
Modules can be published with specific version numbers, or they can use the SNAPSHOT suffix.
Dependencies can specify version ranges to consume, or take advantage of SNAPSHOT mechanism.</p>
</div>
<div class="paragraph">
<p>StackOverflow provides a very good description for this, which is reproduced below.</p>
</div>
<div class="paragraph">
<p><a href="http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency">http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Maven 3.x metaversions RELEASE and LATEST are no longer supported for the sake of reproducible builds.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the POM Syntax section of the Maven book for more details.</p>
</div>
<div class="paragraph">
<p><a href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html </a></p>
</div>
<div class="paragraph">
<p><a href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html" class="bare">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html</a></p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example illustrating the various options.
In the Maven repository, com.foo:my-foo has the following metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;metadata&gt;
  &lt;groupId&gt;com.foo&lt;/groupId&gt;
  &lt;artifactId&gt;my-foo&lt;/artifactId&gt;
  &lt;version&gt;2.0.0&lt;/version&gt;
  &lt;versioning&gt;
    &lt;release&gt;1.1.1&lt;/release&gt;
    &lt;versions&gt;
      &lt;version&gt;1.0&lt;/version&gt;
      &lt;version&gt;1.0.1&lt;/version&gt;
      &lt;version&gt;1.1&lt;/version&gt;
      &lt;version&gt;1.1.1&lt;/version&gt;
      &lt;version&gt;2.0.0&lt;/version&gt;
    &lt;/versions&gt;
    &lt;lastUpdated&gt;20090722140000&lt;/lastUpdated&gt;
  &lt;/versioning&gt;
&lt;/metadata&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a dependency on that artifact is required, you have the following options (other version ranges can be specified of course, just showing the relevant ones here): Declare an exact version (will always resolve to 1.0.1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;[1.0.1]&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare an explicit version (will always resolve to 1.0.1 unless a collision occurs, when Maven will select a matching version):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;1.0.1&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare a version range for all 1.x (will currently resolve to 1.1.1):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;[1.0.0,2.0.0)&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare an open-ended version range (will resolve to 2.0.0):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;[1.0.0,)&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare the version as LATEST (will resolve to 2.0.0):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;LATEST&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare the version as RELEASE (will resolve to 1.1.1):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;RELEASE&lt;/version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that by default your own deployments will update the "latest" entry in the Maven metadata, but to update the "release" entry, you need to activate the "release-profile" from the Maven super POM.
You can do this with either "-Prelease-profile" or "-DperformRelease=true"</p>
</div>
</div>
<div class="sect4">
<h5 id="_settings_xml_and_remote_repository_setup"><a class="anchor" href="#_settings_xml_and_remote_repository_setup"></a><a class="link" href="#_settings_xml_and_remote_repository_setup">2.2.3.5. Settings.xml and Remote Repository Setup</a></h5>
<div class="paragraph">
<p>The maven settings.xml is used to configure Maven execution.
Detailed instructions can be found at the Maven website:</p>
</div>
<div class="paragraph">
<p><a href="http://maven.apache.org/settings.html" class="bare">http://maven.apache.org/settings.html</a></p>
</div>
<div class="paragraph">
<p>The settings.xml file can be located in 3 locations, the actual settings used is a merge of those 3 locations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Maven install: <code>$M2_HOME/conf/settings.xml</code></p>
</li>
<li>
<p>A user&#8217;s install: <code>${user.home}/.m2/settings.xml</code></p>
</li>
<li>
<p>Folder location specified by the system property <code>kie.maven.settings.custom</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The settings.xml is used to specify the location of remote repositories.
It is important that you activate the profile that specifies the remote repository, typically this can be done using "activeByDefault":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profiles&gt;
  &lt;profile&gt;
    &lt;id&gt;profile-1&lt;/id&gt;
    &lt;activation&gt;
      &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
    &lt;/activation&gt;
    ...
  &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maven provides detailed documentation on using multiple remote repositories:</p>
</div>
<div class="paragraph">
<p><a href="http://maven.apache.org/guides/mini/guide-multiple-repositories.html" class="bare">http://maven.apache.org/guides/mini/guide-multiple-repositories.html</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kierunningsection"><a class="anchor" href="#_kierunningsection"></a><a class="link" href="#_kierunningsection">2.2.4. Running</a></h4>
<div class="sect4">
<h5 id="_kiebase_2"><a class="anchor" href="#_kiebase_2"></a><a class="link" href="#_kiebase_2">2.2.4.1. KieBase</a></h5>
<div class="paragraph">
<p>The <code>KieBase</code> is a repository of all the application&#8217;s knowledge definitions.
It will contain rules, processes, functions, and type models.
The <code>KieBase</code> itself does not contain data; instead, sessions are created from the <code>KieBase</code> into which data can be inserted and from which process instances may be started.
The <code>KieBase</code> can be obtained from the <code>KieContainer</code> containing the <code>KieModule</code> where the <code>KieBase</code> has been defined.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Getting a KieBase from a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBase kBase = kContainer.getKieBase();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiesession"><a class="anchor" href="#_kiesession"></a><a class="link" href="#_kiesession">2.2.4.2. KieSession</a></h5>
<div class="paragraph">
<p>The <code>KieSession</code> stores and executes on the runtime data.
It is created from the <code>KieBase</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieSession.png" alt="KieSession">
</div>
<div class="title">Figure 19. KieSession</div>
</div>
<div class="exampleblock">
<div class="title">Example 17. Create a KieSession from a KieBase</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kbase.newKieSession();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kieruntime"><a class="anchor" href="#_kieruntime"></a><a class="link" href="#_kieruntime">2.2.4.3. KieRuntime</a></h5>
<div class="sect5">
<h6 id="_kieruntime_2"><a class="anchor" href="#_kieruntime_2"></a><a class="link" href="#_kieruntime_2">KieRuntime</a></h6>
<div class="paragraph">
<p>The <code>KieRuntime</code> provides methods that are applicable to both rules and processes, such as setting globals and registering channels.
("Exit point" is an obsolete synonym for "channel".)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRuntime.png" alt="KieRuntime">
</div>
<div class="title">Figure 20. KieRuntime</div>
</div>
<div class="sect6">
<h7 id="_globals"><a class="anchor" href="#_globals"></a><a class="link" href="#_globals">Globals</a></h7>
<div class="paragraph">
<p>Globals are named objects that are made visible to the Drools engine, but in a way that is fundamentally different from the one for facts: changes in the object backing a global do not trigger reevaluation of rules.
Still, globals are useful for providing static information, as an object offering services that are used in the RHS of a rule, or as a means to return objects from the Drools engine.
When you use a global on the LHS of a rule, make sure it is immutable, or, at least, don&#8217;t expect changes to have any effect on the behavior of your rules.</p>
</div>
<div class="paragraph">
<p>A global must be declared in a rules file, and then it needs to be backed up with a Java object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>global java.util.List list</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the KIE base now aware of the global identifier and its type, it is now possible to call <code>ksession.setGlobal()</code> with the global&#8217;s name and an object, for any session, to associate the object with the global.
Failure to declare the global type and identifier in DRL code will result in an exception being thrown from this call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; list = new ArrayList&lt;&gt;();
ksession.setGlobal("list", list);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to set any global before it is used in the evaluation of a rule.
Failure to do so results in a <code>NullPointerException</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_event_model"><a class="anchor" href="#_event_model"></a><a class="link" href="#_event_model">2.2.4.4. Event Model</a></h5>
<div class="paragraph">
<p>The event package provides means to be notified of Drools engine events, including rules firing, objects being asserted, etc.
This allows separation of logging and auditing activities from the main part of your application (and the rules).</p>
</div>
<div class="paragraph">
<p>The <code>KieRuntimeEventManager</code> interface is implemented by the <code>KieRuntime</code> which provides two interfaces, <code>RuleRuntimeEventManager</code> and <code>ProcessEventManager</code>.
We will only cover the <code>RuleRuntimeEventManager</code> here.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRuntimeEventManager.png" alt="KieRuntimeEventManager">
</div>
<div class="title">Figure 21. KieRuntimeEventManager</div>
</div>
<div class="paragraph">
<p>The <code>RuleRuntimeEventManager</code> allows for listeners to be added and removed, so that events for the working memory and the agenda can be listened to.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/RuleRuntimeEventManager.png" alt="RuleRuntimeEventManager">
</div>
<div class="title">Figure 22. RuleRuntimeEventManager</div>
</div>
<div class="paragraph">
<p>The following code snippet shows how a simple agenda listener is declared and attached to a session.
It will print matches after they have fired.</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Adding an AgendaEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DefaultAgendaEventListener() {
    public void afterMatchFired(AfterMatchFiredEvent event) {
        super.afterMatchFired( event );
        System.out.println( event );
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Drools also provides <code>DebugRuleRuntimeEventListener</code> and <code>DebugAgendaEventListener</code> which implement each method with a debug print statement.
To print all Working Memory events, you add a listener like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Adding a DebugRuleRuntimeEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DebugRuleRuntimeEventListener() );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All emitted events implement the <code>KieRuntimeEvent</code> interface which can be used to retrieve the actual <code>KnowlegeRuntime</code> the event originated from.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRuntimeEvent.png" alt="KieRuntimeEvent">
</div>
<div class="title">Figure 23. KieRuntimeEvent</div>
</div>
<div class="paragraph">
<p>The events currently supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MatchCreatedEvent</p>
</li>
<li>
<p>MatchCancelledEvent</p>
</li>
<li>
<p>BeforeMatchFiredEvent</p>
</li>
<li>
<p>AfterMatchFiredEvent</p>
</li>
<li>
<p>AgendaGroupPushedEvent</p>
</li>
<li>
<p>AgendaGroupPoppedEvent</p>
</li>
<li>
<p>ObjectInsertEvent</p>
</li>
<li>
<p>ObjectDeletedEvent</p>
</li>
<li>
<p>ObjectUpdatedEvent</p>
</li>
<li>
<p>ProcessCompletedEvent</p>
</li>
<li>
<p>ProcessNodeLeftEvent</p>
</li>
<li>
<p>ProcessNodeTriggeredEvent</p>
</li>
<li>
<p>ProcessStartEvent</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_kieruntimelogger"><a class="anchor" href="#_kieruntimelogger"></a><a class="link" href="#_kieruntimelogger">2.2.4.5. KieRuntimeLogger</a></h5>
<div class="paragraph">
<p>The KieRuntimeLogger uses the comprehensive event system in Drools to create an audit log that can be used to log the execution of an application for later inspection, using tools such as the Eclipse audit viewer.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieLoggers.png" alt="KieLoggers">
</div>
<div class="title">Figure 24. KieLoggers</div>
</div>
<div class="exampleblock">
<div class="title">Example 20. FileLogger</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieRuntimeLogger logger =
  KieServices.Factory.get().getLoggers().newFileLogger(ksession, "logdir/mylogfile");
...
logger.close();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_commands_and_the_commandexecutor"><a class="anchor" href="#_commands_and_the_commandexecutor"></a><a class="link" href="#_commands_and_the_commandexecutor">2.2.4.6. Commands and the CommandExecutor</a></h5>
<div class="paragraph">
<p>KIE has the concept of stateful or stateless sessions.
Stateful sessions have already been covered, which use the standard KieRuntime, and can be worked with iteratively over time.
Stateless is a one-off execution of a KieRuntime with a provided data set.
It may return some results, with the session being disposed at the end, prohibiting further iterative interactions.
You can think of stateless as treating an engine like a function call with optional return results.</p>
</div>
<div class="paragraph">
<p>The foundation for this is the <code>CommandExecutor</code> interface, which both the stateful and stateless interfaces extend.
This returns an <code>ExecutionResults</code>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/CommandExecutor.png" alt="CommandExecutor">
</div>
<div class="title">Figure 25. CommandExecutor</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/ExecutionResults.png" alt="ExecutionResults">
</div>
<div class="title">Figure 26. ExecutionResults</div>
</div>
<div class="paragraph">
<p>The <code>CommandExecutor</code> allows for commands to be executed on those sessions, the only difference being that the StatelessKieSession executes <code>fireAllRules()</code> at the end before disposing the session.
The commands can be created using the <code>CommandExecutor</code> .The Javadocs provide the full list of the allowed comands using the <code>CommandExecutor</code>.</p>
</div>
<div class="paragraph">
<p>setGlobal and getGlobal are two commands relevant to both Drools and jBPM.</p>
</div>
<div class="paragraph">
<p>Set Global calls setGlobal underneath.
The optional boolean indicates whether the command should return the global&#8217;s value as part of the <code>ExecutionResults</code>.
If true it uses the same name as the global name.
A String can be used instead of the boolean, if an alternative name is desired.</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Set Global Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.newSetGlobal( "stilton", new Cheese( "stilton" ), true);
Cheese stilton = bresults.getValue( "stilton" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Allows an existing global to be returned.
The second optional String argument allows for an alternative return name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Get Global Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.getGlobal( "stilton" );
Cheese stilton = bresults.getValue( "stilton" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All the above examples execute single commands.
The <code>BatchExecution</code> represents a composite command, created from a list of commands.
It will iterate over the list and execute each command in turn.
This means you can insert some objects, start a process, call fireAllRules and execute a query, all in a single <code>execute(&#8230;&#8203;)</code> call, which is quite powerful.</p>
</div>
<div class="paragraph">
<p>The StatelessKieSession will execute <code>fireAllRules()</code> automatically at the end.
However the keen-eyed reader probably has already noticed the <code>FireAllRules</code> command and wondered how that works with a StatelessKieSession.
The <code>FireAllRules</code> command is allowed, and using it will disable the automatic execution at the end; think of using it as a sort of manual override function.</p>
</div>
<div class="paragraph">
<p>Any command, in the batch, that has an out identifier set will add its results to the returned <code>ExecutionResults</code> instance.
Let&#8217;s look at a simple example to see how this works.
The example presented includes command from the Drools and jBPM, for the sake of illustration.
They are covered in more detail in the Drool and jBPM specific sections.</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. BatchExecution Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();

List cmds = new ArrayList();
cmds.add( CommandFactory.newInsertObject( new Cheese( "stilton", 1), "stilton") );
cmds.add( CommandFactory.newStartProcess( "process cheeses" ) );
cmds.add( CommandFactory.newQuery( "cheeses" ) );
ExecutionResults bresults = ksession.execute( CommandFactory.newBatchExecution( cmds ) );
Cheese stilton = ( Cheese ) bresults.getValue( "stilton" );
QueryResults qresults = ( QueryResults ) bresults.getValue( "cheeses" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example multiple commands are executed, two of which populate the <code>ExecutionResults</code>.
The query command defaults to use the same identifier as the query name, but it can also be mapped to a different identifier.</p>
</div>
<div class="paragraph">
<p>All commands support XML and JSON marshalling using XStream, as well as JAXB marshalling.
This is covered in <a href="#_ch.commands">Drools commands</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_statelesskiesession"><a class="anchor" href="#_statelesskiesession"></a><a class="link" href="#_statelesskiesession">2.2.4.7. StatelessKieSession</a></h5>
<div class="paragraph">
<p>The <code>StatelessKieSession</code> wraps the <code>KieSession</code>, instead of extending it.
Its main focus is on the decision service type scenarios.
It avoids the need to call <code>dispose()</code>.
Stateless sessions do not support iterative insertions and the method call <code>fireAllRules()</code> from Java code; the act of calling <code>execute()</code> is a single-shot method that will internally instantiate a <code>KieSession</code>, add all the user data and execute user commands, call <code>fireAllRules()</code>, and then call <code>dispose()</code>.
While the main way to work with this class is via the <code>BatchExecution</code> (a subinterface of <code>Command</code>) as supported by the <code>CommandExecutor</code> interface, two convenience methods are provided for when simple object insertion is all that&#8217;s required.
The <code>CommandExecutor</code> and <code>BatchExecution</code> are talked about in detail in their own section.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/StatelessKieSession.png" alt="StatelessKieSession">
</div>
<div class="title">Figure 27. StatelessKieSession</div>
</div>
<div class="paragraph">
<p>Our simple example shows a stateless session executing a given collection of Java objects using the convenience API.
It will iterate the collection, inserting each element in turn.</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Simple StatelessKieSession execution with a Collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If this was done as a single Command it would be as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Simple StatelessKieSession execution with InsertElements Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.execute( CommandFactory.newInsertElements( collection ) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you wanted to insert the collection itself, and the collection&#8217;s individual elements, then <code>CommandFactory.newInsert(collection)</code> would do the job.</p>
</div>
<div class="paragraph">
<p>Methods of the <code>CommandFactory</code> create the supported commands, all of which can be marshalled using XStream and the <code>BatchExecutionHelper</code>. <code>BatchExecutionHelper</code> provides details on the XML format as well as how to use Drools Pipeline to automate the marshalling of <code>BatchExecution</code> and <code>ExecutionResults</code>.</p>
</div>
<div class="paragraph">
<p><code>StatelessKieSession</code> supports globals, scoped in a number of ways.
We cover the non-command way first, as commands are scoped to a specific execution call.
Globals can be resolved in three ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The StatelessKieSession method <code>getGlobals()</code> returns a Globals instance which provides access to the session&#8217;s globals. These are used for <em>all</em> execution calls. Exercise caution regarding mutable globals because execution calls can be executing simultaneously in different threads.</p>
<div class="exampleblock">
<div class="title">Example 26. Session scoped global</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
// Set a global hbnSession, that can be used for DB interactions in the rules.
ksession.setGlobal( "hbnSession", hibernateSession );
// Execute while being able to resolve the "hbnSession" identifier.
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Using a delegate is another way of global resolution. Assigning a value to a global (with <code>setGlobal(String, Object)</code>) results in the value being stored in an internal collection mapping identifiers to values. Identifiers in this internal collection will have priority over any supplied delegate. Only if an identifier cannot be found in this internal collection, the delegate global (if any) will be used.</p>
</li>
<li>
<p>The third way of resolving globals is to have execution scoped globals. Here, a <code>Command</code> to set a global is passed to the <code>CommandExecutor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>CommandExecutor</code> interface also offers the ability to export data via "out" parameters.
Inserted facts, globals and query results can all be returned.</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. Out identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Set up a list of commands
List cmds = new ArrayList();
cmds.add( CommandFactory.newSetGlobal( "list1", new ArrayList(), true ) );
cmds.add( CommandFactory.newInsert( new Person( "jon", 102 ), "person" ) );
cmds.add( CommandFactory.newQuery( "Get People", "getPeople" ) );

// Execute the list
ExecutionResults results =
  ksession.execute( CommandFactory.newBatchExecution( cmds ) );

// Retrieve the ArrayList
results.getValue( "list1" );
// Retrieve the inserted Person fact
results.getValue( "person" );
// Retrieve the query as a QueryResults instance.
results.getValue( "Get People" );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_marshalling"><a class="anchor" href="#_marshalling"></a><a class="link" href="#_marshalling">2.2.4.8. Marshalling</a></h5>
<div class="paragraph">
<p>The <code>KieMarshallers</code> are used to marshal and unmarshal KieSessions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieMarshallers.png" alt="KieMarshallers">
</div>
<div class="title">Figure 28. KieMarshallers</div>
</div>
<div class="paragraph">
<p>An instance of the <code>KieMarshallers</code> can be retrieved from the <code>KieServices</code>.
A simple example is shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Simple Marshaller Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// ksession is the KieSession
// kbase is the KieBase
ByteArrayOutputStream baos = new ByteArrayOutputStream();
Marshaller marshaller = KieServices.Factory.get().getMarshallers().newMarshaller( kbase );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, with marshalling, you will need more flexibility when dealing with referenced user data.
To achieve this use the <code>ObjectMarshallingStrategy</code> interface.
Two implementations are provided, but users can implement their own.
The two supplied strategies are <code>IdentityMarshallingStrategy</code> and <code>SerializeMarshallingStrategy</code>. <code>SerializeMarshallingStrategy</code> is the default, as shown in the example above, and it just calls the <code>Serializable</code> or <code>Externalizable</code> methods on a user instance. <code>IdentityMarshallingStrategy</code> creates an integer id for each user object and stores them in a Map, while the id is written to the stream.
When unmarshalling it accesses the <code>IdentityMarshallingStrategy</code> map to retrieve the instance.
This means that if you use the <code>IdentityMarshallingStrategy</code>, it is stateful for the life of the Marshaller instance and will create ids and keep references to all objects that it attempts to marshal.
Below is the code to use an Identity Marshalling Strategy.</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. IdentityMarshallingStrategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ByteArrayOutputStream baos = new ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategy oms = kMarshallers.newIdentityMarshallingStrategy()
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase, new ObjectMarshallingStrategy[]{ oms } );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In most cases, a single strategy is insufficient.
For added flexibility, the <code>ObjectMarshallingStrategyAcceptor</code> interface can be used.
This Marshaller has a chain of strategies, and while reading or writing a user object it iterates the strategies asking if they accept responsibility for marshalling the user object.
One of the provided implementations is <code>ClassFilterAcceptor</code>.
This allows strings and wild cards to be used to match class names.
The default is "<strong>.</strong>", so in the above example the Identity Marshalling Strategy is used which has a default "<strong>.</strong>" acceptor.</p>
</div>
<div class="paragraph">
<p>Assuming that we want to serialize all classes except for one given package, where we will use identity lookup, we could do the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 30. IdentityMarshallingStrategy with Acceptor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ByteArrayOutputStream baos = new ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategyAcceptor identityAcceptor =
        kMarshallers.newClassFilterAcceptor( new String[] { "org.domain.pkg1.*" } );
ObjectMarshallingStrategy identityStrategy =
        kMarshallers.newIdentityMarshallingStrategy( identityAcceptor );
ObjectMarshallingStrategy sms = kMarshallers.newSerializeMarshallingStrategy();
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase,
                                    new ObjectMarshallingStrategy[]{ identityStrategy, sms } );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the acceptance checking order is in the natural order of the supplied elements.</p>
</div>
</div>
<div class="sect4">
<h5 id="_persistence_and_transactions"><a class="anchor" href="#_persistence_and_transactions"></a><a class="link" href="#_persistence_and_transactions">2.2.4.9. Persistence and Transactions</a></h5>
<div class="paragraph">
<p>Longterm out of the box persistence with Java Persistence API (JPA) is possible with Drools.
It is necessary to have some implementation of the Java Transaction API (JTA) installed.
For development purposes the Bitronix Transaction Manager is suggested, as it&#8217;s simple to set up and works embedded, but for production use JBoss Transactions is recommended.</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Simple example using transactions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
Environment env = kieServices.newEnvironment();
env.set( EnvironmentName.ENTITY_MANAGER_FACTORY,
         Persistence.createEntityManagerFactory( "emf-name" ) );
env.set( EnvironmentName.TRANSACTION_MANAGER,
         TransactionManagerServices.getTransactionManager() );

// KieSessionConfiguration may be null, and a default will be used
KieSession ksession =
        kieServices.getStoreServices().newKieSession( kbase, null, env );
int sessionId = ksession.getId();

UserTransaction ut =
  (UserTransaction) new InitialContext().lookup( "java:comp/UserTransaction" );
ut.begin();
ksession.insert( data1 );
ksession.insert( data2 );
ksession.startProcess( "process1" );
ut.commit();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use a JPA, the Environment must be set with both the <code>EntityManagerFactory</code> and the <code>TransactionManager</code>.
If rollback occurs the ksession state is also rolled back, hence it is possible to continue to use it after a rollback.
To load a previously persisted KieSession you&#8217;ll need the id, as shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Loading a KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession =
        kieServices.getStoreServices().loadKieSession( sessionId, kbase, null, env );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable persistence several classes must be added to your persistence.xml, as in the example below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 33. Configuring JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;persistence-unit name="org.drools.persistence.jpa" transaction-type="JTA"&gt;
   &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
   &lt;jta-data-source&gt;jdbc/BitronixJTADataSource&lt;/jta-data-source&gt;
   &lt;class&gt;org.drools.persistence.info.SessionInfo&lt;/class&gt;
   &lt;class&gt;org.drools.persistence.info.WorkItemInfo&lt;/class&gt;
   &lt;properties&gt;
         &lt;property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/&gt;
         &lt;property name="hibernate.max_fetch_depth" value="3"/&gt;
         &lt;property name="hibernate.hbm2ddl.auto" value="update" /&gt;
         &lt;property name="hibernate.show_sql" value="true" /&gt;
         &lt;property name="hibernate.transaction.manager_lookup_class"
                      value="org.hibernate.transaction.BTMTransactionManagerLookup" /&gt;
   &lt;/properties&gt;
&lt;/persistence-unit&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The jdbc JTA data source would have to be configured first.
Bitronix provides a number of ways of doing this, and its documentation should be consulted for details.
For a quick start, here is the programmatic approach:</p>
</div>
<div class="exampleblock">
<div class="title">Example 34. Configuring JTA DataSource</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">PoolingDataSource ds = new PoolingDataSource();
ds.setUniqueName( "jdbc/BitronixJTADataSource" );
ds.setClassName( "org.h2.jdbcx.JdbcDataSource" );
ds.setMaxPoolSize( 3 );
ds.setAllowLocalTransactions( true );
ds.getDriverProperties().put( "user", "sa" );
ds.getDriverProperties().put( "password", "sasa" );
ds.getDriverProperties().put( "URL", "jdbc:h2:mem:mydb" );
ds.init();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Bitronix also provides a simple embedded JNDI service, ideal for testing.
To use it, add a jndi.properties file to your META-INF folder and add the following line to it:</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. JNDI properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>java.naming.factory.initial=bitronix.tm.jndi.BitronixInitialContextFactory</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiedeploycheatsheets"><a class="anchor" href="#_kiedeploycheatsheets"></a><a class="link" href="#_kiedeploycheatsheets">2.2.5. Installation and Deployment Cheat Sheets</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/cheatsheet1.png" alt="cheatsheet1">
</div>
<div class="title">Figure 29. Installation Overview</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/cheatsheet2.png" alt="cheatsheet2">
</div>
<div class="title">Figure 30. Deployment Overview</div>
</div>
</div>
<div class="sect3">
<h4 id="_kieexamplessection"><a class="anchor" href="#_kieexamplessection"></a><a class="link" href="#_kieexamplessection">2.2.6. Build,  Deploy and Utilize Examples</a></h4>
<div class="paragraph">
<p>The best way to learn the new build system is by example.
The source project "drools-examples-api" contains a number of examples, and can be found at GitHub:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup/drools/tree/6.0.x/drools-examples-api" class="bare">https://github.com/kiegroup/drools/tree/6.0.x/drools-examples-api</a></p>
</div>
<div class="paragraph">
<p>Each example is described below, the order starts with the simplest (most of the options are defaulted) and working its way up to more complex use cases.</p>
</div>
<div class="paragraph">
<p>The Deploy use cases shown below all involve <code>mvn install</code>.
Remote deployment of JARs in Maven is well covered in Maven literature.
Utilize refers to the initial act of loading the resources and providing access to the KIE runtimes.
Whereas Run refers to the act of interacting with those runtimes.</p>
</div>
<div class="sect4">
<h5 id="_default_kiesession"><a class="anchor" href="#_default_kiesession"></a><a class="link" href="#_default_kiesession">2.2.6.1. Default KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: default-kesession.</p>
</li>
<li>
<p>Summary: Empty kmodule.xml KieModule on the classpath that includes all resources in a single default KieBase. The example shows the retrieval of the default KieSession from the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An empty kmodule.xml will produce a single KieBase that includes all files found under resources path, be it DRL, BPMN2, XLS etc.
That single KieBase is the default and also includes a single default KieSession.
Default means they can be created without knowing their names.</p>
</div>
<div class="exampleblock">
<div class="title">Example 36. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt; &lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 37. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed onto the environment classpath.
kContainer.newKieSession() creates the default KieSession.
Notice that you no longer need to look up the KieBase, in order to create the KieSession.
The KieSession knows which KieBase it&#8217;s associated with, and use that, which in this case is the default KieBase.</p>
</div>
<div class="exampleblock">
<div class="title">Example 38. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_named_kiesession"><a class="anchor" href="#_named_kiesession"></a><a class="link" href="#_named_kiesession">2.2.6.2. Named KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: named-kiesession.</p>
</li>
<li>
<p>Summary: kmodule.xml that has one named KieBase and one named KieSession. The examples shows the retrieval of the named KieSession from the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml will produce a single named KieBase, 'kbase1' that includes all files found under resources path, be it DRL, BPMN2, XLS etc.
KieSession 'ksession1' is associated with that KieBase and can be created by name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 39. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
    &lt;kbase name="kbase1"&gt;
        &lt;ksession name="ksession1"/&gt;
    &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 40. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed onto the environment classpath.
This time the KieSession uses the name 'ksession1'. You do not need to lookup the KieBase first, as it knows which KieBase 'ksession1' is assocaited with.</p>
</div>
<div class="exampleblock">
<div class="title">Example 41. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiebase_inheritance"><a class="anchor" href="#_kiebase_inheritance"></a><a class="link" href="#_kiebase_inheritance">2.2.6.3. KieBase Inheritance</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kiebase-inclusion.</p>
</li>
<li>
<p>Summary: 'kmodule.xml' demonstrates that one KieBase can include the resources from another KieBase, from another KieModule. In this case it inherits the named KieBase from the 'name-kiesession' example. The included KieBase can be from the current KieModule or any other KieModule that is in the pom.xml dependency list.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml will produce a single named KieBase, 'kbase2' that includes all files found under resources path, be it DRL, BPMN2, XLS etc.
Further it will include all the resources found from the KieBase 'kbase1', due to the use of the 'includes' attribute.
KieSession 'ksession2' is associated with that KieBase and can be created by name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 42. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kbase name="kbase2" includes="kbase1"&gt;
    &lt;ksession name="ksession2"/&gt;
&lt;/kbase&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example requires that the previous example, 'named-kiesession', is built and installed to the local Maven repository first.
Once installed it can be included as a dependency, using the standard Maven &lt;dependencies&gt; element.</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. Author - pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;parent&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-examples-api&lt;/artifactId&gt;
    &lt;version&gt;6.0.0/version&gt;
  &lt;/parent&gt;

  &lt;artifactId&gt;kiebase-inclusion&lt;/artifactId&gt;
  &lt;name&gt;Drools API examples - KieBase Inclusion&lt;/name&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;named-kiesession&lt;/artifactId&gt;
      &lt;version&gt;6.0.0&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once 'named-kiesession' is built and installed this example can be built and installed as normal.
Again the act of installing, will force the unit tests to run, demonstrating the use case.</p>
</div>
<div class="exampleblock">
<div class="title">Example 44. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed onto the environment classpath.
This time the KieSession uses the name 'ksession2'. You do not need to lookup the KieBase first, as it knows which KieBase 'ksession1' is assocaited with.
Notice two rules fire this time, showing that KieBase 'kbase2' has included the resources from the dependency KieBase 'kbase1'.</p>
</div>
<div class="exampleblock">
<div class="title">Example 45. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();
KieSession kSession = kContainer.newKieSession("ksession2");
kSession.setGlobal("out", out);

kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();

kSession.insert(new Message("Dave", "Open the pod bay doors, HAL."));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_kiebases"><a class="anchor" href="#_multiple_kiebases"></a><a class="link" href="#_multiple_kiebases">2.2.6.4. Multiple KieBases</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: 'multiple-kbases.</p>
</li>
<li>
<p>Summary: Demonstrates that the 'kmodule.xml'  can contain any number of KieBase or KieSession declarations. Introduces the 'packages' attribute to select the folders for the resources to be included in the KieBase.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml produces 6 different named KieBases.
'kbase1' includes all resources from the KieModule.
The other KieBases include resources from other selected folders, via the 'packages' attribute.
Note the use of wildcard '*', to select this package and all packages below it.</p>
</div>
<div class="exampleblock">
<div class="title">Example 46. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;

  &lt;kbase name="kbase1"&gt;
    &lt;ksession name="ksession1"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase2" packages="org.some.pkg"&gt;
    &lt;ksession name="ksession2"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase3" includes="kbase2" packages="org.some.pkg2"&gt;
    &lt;ksession name="ksession3"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase4" packages="org.some.pkg, org.other.pkg"&gt;
    &lt;ksession name="ksession4"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase5" packages="org.*"&gt;
    &lt;ksession name="ksession5"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase6" packages="org.some.*"&gt;
    &lt;ksession name="ksession6"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 47. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only part of the example is included below, as there is a test method per KieSession, but each one is a repetition of the other, with different list expectations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 48. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testSimpleKieBase() {
    List&lt;Integer&gt; list = useKieSession("ksession1");
    // no packages imported means import everything
    assertEquals(4, list.size());
    assertTrue( list.containsAll( asList(0, 1, 2, 3) ) );
}

//.. other tests for ksession2 to ksession6 here

private List&lt;Integer&gt; useKieSession(String name) {
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();
    KieSession kSession = kContainer.newKieSession(name);

    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();
    kSession.setGlobal("list", list);
    kSession.insert(1);
    kSession.fireAllRules();

    return list;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiecontainer_from_kierepository"><a class="anchor" href="#_kiecontainer_from_kierepository"></a><a class="link" href="#_kiecontainer_from_kierepository">2.2.6.5. KieContainer from KieRepository</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kcontainer-from-repository</p>
</li>
<li>
<p>Summary: The project does not contain a kmodule.xml, nor does the pom.xml have any dependencies for other KieModules. Instead the Java code demonstrates the loading of a dynamic KieModule from a Maven repository.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The pom.xml must include kie-ci as a dependency, to ensure Maven is available at runtime.
As this uses Maven under the hood you can also use the standard Maven settings.xml file.</p>
</div>
<div class="exampleblock">
<div class="title">Example 49. Author - pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;parent&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-examples-api&lt;/artifactId&gt;
    &lt;version&gt;6.0.0&lt;/version&gt;
  &lt;/parent&gt;

  &lt;artifactId&gt;kiecontainer-from-kierepo&lt;/artifactId&gt;
  &lt;name&gt;Drools API examples - KieContainer from KieRepo&lt;/name&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 50. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the previous examples the classpath KieContainer used.
This example creates a dynamic KieContainer as specified by the  ReleaseId.
The ReleaseId uses Maven conventions for group id, artifact id and version.
It also obeys LATEST and SNAPSHOT for versions.</p>
</div>
<div class="exampleblock">
<div class="title">Example 51. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();

// Install example1 in the local Maven repo before to do this
KieContainer kContainer = ks.newKieContainer(ks.newReleaseId("org.drools", "named-kiesession", "6.0.0-SNAPSHOT"));

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_default_kiesession_from_file"><a class="anchor" href="#_default_kiesession_from_file"></a><a class="link" href="#_default_kiesession_from_file">2.2.6.6. Default KieSession from File</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: default-kiesession-from-file</p>
</li>
<li>
<p>Summary: Dynamic KieModules can also be loaded from any Resource location. The loaded KieModule provides default KieBase and KieSession definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No kmodue.xml file exists.
The project 'default-kiesession' must be built first, so that the resulting JAR, in the target folder, can be referenced as a File.</p>
</div>
<div class="exampleblock">
<div class="title">Example 52. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any KieModule can be loaded from a Resource location and added to the KieRepository.
Once deployed in the KieRepository it can be resolved via its ReleaseId.
Note neither Maven or kie-ci are needed here.
It will not set up a transitive dependency parent classloader.</p>
</div>
<div class="exampleblock">
<div class="title">Example 53. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile("default-kiesession")));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_named_kiesession_from_file"><a class="anchor" href="#_named_kiesession_from_file"></a><a class="link" href="#_named_kiesession_from_file">2.2.6.7. Named KieSession from File</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: named-kiesession-from-file</p>
</li>
<li>
<p>Summary: Dynamic KieModules can also be loaded from any Resource location. The loaded KieModule provides named KieBase and KieSession definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No kmodue.xml file exists.
The project 'named-kiesession' must be built first, so that the resulting JAR, in the target folder, can be referenced as a File.</p>
</div>
<div class="exampleblock">
<div class="title">Example 54. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any KieModule can be loaded from a Resource location and added to the KieRepository.
Once in the KieRepository it can be resolved via its ReleaseId.
Note neither Maven or kie-ci are needed here.
It will not setup a transitive dependency parent classloader.</p>
</div>
<div class="exampleblock">
<div class="title">Example 55. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile("named-kiesession")));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiemodule_with_dependent_kiemodule"><a class="anchor" href="#_kiemodule_with_dependent_kiemodule"></a><a class="link" href="#_kiemodule_with_dependent_kiemodule">2.2.6.8. KieModule with Dependent KieModule</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kie-module-form-multiple-files</p>
</li>
<li>
<p>Summary: Programmatically provide the list of dependant KieModules, without using Maven to resolve anything.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No kmodue.xml file exists.
The projects 'named-kiesession' and 'kiebase-include' must be built first, so that the resulting JARs, in the target folders, can be referenced as Files.</p>
</div>
<div class="exampleblock">
<div class="title">Example 56. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Creates two resources.
One is for the main KieModule 'exRes1' the other is for the dependency 'exRes2'. Even though kie-ci is not present and thus Maven is not available to resolve the dependencies, this shows how you can manually specify the dependent KieModules, for the vararg.</p>
</div>
<div class="exampleblock">
<div class="title">Example 57. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile("kiebase-inclusion"));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile("named-kiesession"));

KieModule kModule = kr.addKieModule(ex1Res, ex2Res);
KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession("ksession2");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, "Dave", "Open the pod bay doors, HAL.");
kSession.insert(msg2);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_programmatically_build_a_simple_kiemodule_with_defaults"><a class="anchor" href="#_programmatically_build_a_simple_kiemodule_with_defaults"></a><a class="link" href="#_programmatically_build_a_simple_kiemodule_with_defaults">2.2.6.9. Programmatically build a Simple KieModule with Defaults</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kiemoduelmodel-example</p>
</li>
<li>
<p>Summary: Programmatically build a KieModule from just a single file. The POM and models are all defaulted. This is the quickest out of the box approach, but should not be added to a Maven repository.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 58. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This programmatically builds a KieModule.
It populates the model that represents the ReleaseId and  kmodule.xml, and it adds the relevant resources.
A pom.xml is generated from the ReleaseId.</p>
</div>
<div class="exampleblock">
<div class="title">Example 59. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();
KieFileSystem kfs = ks.newKieFileSystem();

kfs.write("src/main/resources/org/kie/example5/HAL5.drl", getRule());

KieBuilder kb = ks.newKieBuilder(kfs);

kb.buildAll(); // kieModule is automatically deployed to KieRepository if successfully built.
if (kb.getResults().hasMessages(Level.ERROR)) {
    throw new RuntimeException("Build Errors:\n" + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(kr.getDefaultReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);

kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_programmatically_build_a_kiemodule_using_meta_models"><a class="anchor" href="#_programmatically_build_a_kiemodule_using_meta_models"></a><a class="link" href="#_programmatically_build_a_kiemodule_using_meta_models">2.2.6.10. Programmatically build a KieModule using Meta Models</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kiemoduelmodel-example</p>
</li>
<li>
<p>Summary: Programmatically build a KieModule, by creating its kmodule.xml meta model resources.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 60. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This programmatically builds a KieModule.
It populates the model that represents the ReleaseId and  kmodule.xml, as well as add the relevant resources.
A pom.xml is generated from the ReleaseId.</p>
</div>
<div class="exampleblock">
<div class="title">Example 61. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieFileSystem kfs = ks.newKieFileSystem();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile("named-kiesession"));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile("kiebase-inclusion"));

ReleaseId rid = ks.newReleaseId("org.drools", "kiemodulemodel-example", "6.0.0-SNAPSHOT");
kfs.generateAndWritePomXML(rid);

KieModuleModel kModuleModel = ks.newKieModuleModel();
kModuleModel.newKieBaseModel("kiemodulemodel")
            .addInclude("kiebase1")
            .addInclude("kiebase2")
            .newKieSessionModel("ksession6");

kfs.writeKModuleXML(kModuleModel.toXML());
kfs.write("src/main/resources/kiemodulemodel/HAL6.drl", getRule());

KieBuilder kb = ks.newKieBuilder(kfs);
kb.setDependencies(ex1Res, ex2Res);
kb.buildAll(); // kieModule is automatically deployed to KieRepository if successfully built.
if (kb.getResults().hasMessages(Level.ERROR)) {
    throw new RuntimeException("Build Errors:\n" + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(rid);

KieSession kSession = kContainer.newKieSession("ksession6");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, "Dave", "Open the pod bay doors, HAL.");
kSession.insert(msg2);
kSession.fireAllRules();

Object msg3 = createMessage(kContainer, "Dave", "What's the problem?");
kSession.insert(msg3);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kie-scanner-proc_decision-management-architecture"><a class="anchor" href="#kie-scanner-proc_decision-management-architecture"></a><a class="link" href="#kie-scanner-proc_decision-management-architecture">2.2.7. Using a KIE scanner to monitor and update KIE containers</a></h4>
<div class="paragraph">
<p>The KIE scanner in Drools monitors your Maven repository for new <code>SNAPSHOT</code> versions of your Drools project and then deploys the latest version of the project to a specified KIE container. You can use a KIE scanner in a development environment to maintain your Drools project deployments more efficiently as new versions become available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For production environments, do not use a KIE scanner or <code>SNAPSHOT</code> project versions to avoid accidental or unexpected project updates. The KIE scanner is intended for development environments that use <code>SNAPSHOT</code> project versions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The <code>kie-ci.jar</code> file is available on the class path of your Drools project.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the relevant <code>.java</code> class in your project, register and start the KIE scanner as shown in the following example code:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Registering and starting a KIE scanner for a KIE container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.KieServices;
import org.kie.api.builder.ReleaseId;
import org.kie.api.runtime.KieContainer;
import org.kie.api.builder.KieScanner;

...

KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices
  .newReleaseId("com.sample", "my-app", "1.0-SNAPSHOT");
KieContainer kContainer = kieServices.newKieContainer(releaseId);
KieScanner kScanner = kieServices.newKieScanner(kContainer);

// Start KIE scanner for polling the Maven repository every 10 seconds (10000 ms)
kScanner.start(10000L);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the KIE scanner is configured to run with a fixed time interval. The minimum KIE scanner polling interval is 1 millisecond (ms) and the maximum polling interval is the maximum value of the data type <code>long</code>. A polling interval of 0 or less results in a <code>java.lang.IllegalArgumentException: pollingInterval must be positive</code> error. You can also configure the KIE scanner to run on demand by invoking the <code>scanNow()</code> method.</p>
</div>
<div class="paragraph">
<p>The project group ID, artifact ID, and version (GAV) settings in the example are defined as <code>com.sample:my-app:1.0-SNAPSHOT</code>. The project version must contain the <code>-SNAPSHOT</code> suffix to enable the KIE scanner to retrieve the latest build of the specified artifact version. If you change the snapshot project version number, such as increasing to <code>1.0.1-SNAPSHOT</code>, then you must also update the version in the GAV definition in your KIE scanner configuration. The KIE scanner does not retrieve updates for projects with static versions, such as <code>com.sample:my-app:1.0</code>.</p>
</div>
</div>
</div>
</li>
<li>
<p>In the <code>settings.xml</code> file of your Maven repository, set the <code>updatePolicy</code> configuration to <code>always</code> to enable the KIE scanner to function properly:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;guvnor-m2-repo&lt;/id&gt;
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;guvnor-m2-repo&lt;/id&gt;
      &lt;name&gt;BA Repository&lt;/name&gt;
      &lt;url&gt;http://localhost:8080/business-central/maven2/&lt;/url&gt;
      &lt;layout&gt;default&lt;/layout&gt;
      &lt;releases&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
      &lt;/releases&gt;
      &lt;snapshots&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
      &lt;/snapshots&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>After the KIE scanner starts polling, if the KIE scanner detects an updated version of the <code>SNAPSHOT</code> project in the specified KIE container, the KIE scanner automatically downloads the new project version and triggers an incremental build of the new project. From that moment, all of the new <code>KieBase</code> and <code>KieSession</code> objects that were created from the KIE container use the new project version.</p>
</div>
<div class="paragraph">
<p>For information about starting or stopping a KIE scanner using KIE Server APIs, see
<a href="#kie-server-commands-con_kie-apis">KIE Server and KIE container commands in Drools</a>.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kiesecuritysection"><a class="anchor" href="#_kiesecuritysection"></a><a class="link" href="#_kiesecuritysection">2.3. Security</a></h3>
<div class="sect3">
<h4 id="_securitymanager"><a class="anchor" href="#_securitymanager"></a><a class="link" href="#_securitymanager">2.3.1. Security Manager</a></h4>
<div class="paragraph">
<p>The KIE engine is a platform for the modelling and execution of business behavior, using a multitude of declarative abstractions and metaphors, like rules, processes, decision tables and etc.</p>
</div>
<div class="paragraph">
<p>Many times, the authoring of these metaphors is done by third party groups, be it a different group inside the same company, a group from a partner company, or even anonymous third parties on the internet.</p>
</div>
<div class="paragraph">
<p>Rules and Processes are designed to execute arbitrary code in order to do their job, but in such cases it might be necessary to constrain what they can do.
For instance, it is unlikely a rule should be allowed to create a classloader (what could open the system to an attack) and certainly it should not be allowed to make a call to <code>System.exit()</code>.</p>
</div>
<div class="paragraph">
<p>The Java Platform provides a very comprehensive and well defined security framework that allows users to define policies for what a system can do.
The KIE platform leverages that framework and allow application developers to define a specific policy to be applied to any execution of user provided code, be it in rules, processes, work item handlers and etc.</p>
</div>
<div class="sect4">
<h5 id="_howtodefinekiepolicy"><a class="anchor" href="#_howtodefinekiepolicy"></a><a class="link" href="#_howtodefinekiepolicy">2.3.1.1. How to define a KIE Policy</a></h5>
<div class="paragraph">
<p>Rules and processes can run with very restrict permissions, but the engine itself needs to perform many complex operations in order to work.
Examples are: it needs to create classloaders, read system properties, access the file system, etc.</p>
</div>
<div class="paragraph">
<p>Once a security manager is installed, though, it will apply restrictions to all the code executing in the JVM according to the defined policy.
For that reason, KIE allows the user to define two different policy files: one for the engine itself and one for the assets deployed into and executed by the engine.</p>
</div>
<div class="paragraph">
<p>One easy way to setup the environment is to give the engine itself a very permissive policy, while providing a constrained policy for rules and processes.</p>
</div>
<div class="paragraph">
<p>Policy files follow the standard policy file syntax as described in the Java documentation.
For more details, see:</p>
</div>
<div class="paragraph">
<p><a href="https://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html#FileSyntax" class="bare">https://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html#FileSyntax</a></p>
</div>
<div class="paragraph">
<p>A permissive policy file for the engine can look like the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 62. A sample engine.policy file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>grant {
    permission java.security.AllPermission;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An example security policy for rules could be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 63. A sample rules.policy file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>grant {
    permission java.util.PropertyPermission "*", "read";
    permission java.lang.RuntimePermission "accessDeclaredMembers";
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Please note that depending on what the rules and processes are supposed to do, many more permissions might need to be granted, like accessing files in the filesystem, databases, etc.</p>
</div>
<div class="paragraph">
<p>In order to use these policy files, all that is necessary is to execute the application with these files as parameters to the JVM.
Three parameters are required:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Parameters</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Djava.security.manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the security manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Djava.security.policy=&lt;jvm_policy_file&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the global policy file to be applied to the whole application, including the engine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dkie.security.policy=&lt;kie_policy_file&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the policy file to be applied to rules and processes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="paragraph">
<p><code>java -Djava.security.manager -Djava.security.policy=global.policy -Dkie.security.policy=rules.policy
        foo.bar.MyApp</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When executing the engine inside a container, use your container&#8217;s documentation to find out how to configure the Security Manager and how to define the global security policy.
Define the kie security policy as described above and set the <code>kie.security.policy</code> system property in order to configure the engine to use it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that unless a Security Manager is configured, the <code>kie.security.policy</code> will be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A Security Manager has a high performance impact in the JVM.
Applications with strict performance requirements are strongly discouraged of using a Security Manager.
An alternative is the use of other security procedures like the auditing of rules/processes before testing and deployment to prevent malicious code from being deployed to the environment.</p>
</div>
</td>
</tr>
</table>
</div>
<h1 id="_drools_run_time_and_language" class="discrete">Drools Run time and Language</h1>
<div class="paragraph">
<p>Drools is a powerful hybrid reasoning system that intelligently and efficiently processes rule data.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="decision-engine-con_decision-engine"><a class="anchor" href="#decision-engine-con_decision-engine"></a><a class="link" href="#decision-engine-con_decision-engine">3. Drools engine</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Drools engine is the rules engine in Drools. The Drools engine stores, processes, and evaluates data to execute the business rules or decision models that you define. The basic function of the Drools engine is to match incoming data, or <em>facts</em>, to the conditions of rules and determine whether and how to execute the rules.</p>
</div>
<div class="paragraph">
<p>The Drools engine operates using the following basic components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rules:</strong> Business rules or DMN decisions that you define. All rules must contain at a minimum the conditions that trigger the rule and the actions that the rule dictates.</p>
</li>
<li>
<p><strong>Facts:</strong> Data that enters or changes in the Drools engine that the Drools engine matches to rule conditions to execute applicable rules.</p>
</li>
<li>
<p><strong>Production memory:</strong> Location where rules are stored in the Drools engine.</p>
</li>
<li>
<p><strong>Working memory:</strong> Location where facts are stored in the Drools engine.</p>
</li>
<li>
<p><strong>Agenda:</strong> Location where activated rules are registered and sorted (if applicable) in preparation for execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a business user or an automated system adds or updates rule-related information in Drools, that information is inserted into the working memory of the Drools engine in the form of one or more facts. The Drools engine matches those facts to the conditions of the rules that are stored in the production memory to determine eligible rule executions. (This process of matching facts to rules is often referred to as <em>pattern matching</em>.) When rule conditions are met, the Drools engine activates and registers rules in the agenda, where the Drools engine then sorts prioritized or conflicting rules in preparation for execution.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates these basic components of the Drools engine:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/rule-engine-inkscape_enterprise.png" alt="rule engine inkscape enterprise">
</div>
<div class="title">Figure 31. Overview of basic Drools engine components</div>
</div>
<div class="paragraph">
<p>These core concepts can help you to better understand other more advanced components, processes, and sub-processes of the Drools engine, and as a result, to design more effective business assets in Drools.</p>
</div>
<div class="sect2">
<h3 id="kie-sessions-con_decision-engine"><a class="anchor" href="#kie-sessions-con_decision-engine"></a><a class="link" href="#kie-sessions-con_decision-engine">3.1. KIE sessions</a></h3>
<div class="paragraph">
<p>In Drools, a KIE session stores and executes runtime data. The KIE session is created from a KIE base or directly from a KIE container if you have defined the KIE session in the KIE module descriptor file (<code>kmodule.xml</code>) for your project.</p>
</div>
<div class="listingblock">
<div class="title">Example KIE session configuration in a <code>kmodule.xml</code> file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase&gt;
    ...
    &lt;ksession name="KSession2_1" type="stateless" default="true" clockType="realtime"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A KIE base is a repository that you define in the KIE module descriptor file (<code>kmodule.xml</code>) for your project and contains all
in Drools, but does not contain any runtime data.</p>
</div>
<div class="listingblock">
<div class="title">Example KIE base configuration in a <code>kmodule.xml</code> file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" eventProcessingMode="stream" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A KIE session can be stateless or stateful. In a stateless KIE session, data from a previous invocation of the KIE session (the previous session state) is discarded between session invocations. In a stateful KIE session, that data is retained. The type of KIE session you use depends on your project requirements and how you want data from different asset invocations to be persisted.</p>
</div>
<div class="sect3">
<h4 id="kie-sessions-stateless-con_decision-engine"><a class="anchor" href="#kie-sessions-stateless-con_decision-engine"></a><a class="link" href="#kie-sessions-stateless-con_decision-engine">3.1.1. Stateless KIE sessions</a></h4>
<div class="paragraph">
<p>A stateless KIE session is a session that does not use inference to make iterative changes to facts over time. In a stateless KIE session, data from a previous invocation of the KIE session (the previous session state) is discarded between session invocations, whereas in a stateful KIE session, that data is retained. A stateless KIE session behaves similarly to a function in that the results that it produces are determined by the contents of the KIE base and by the data that is passed into the KIE session for execution at a specific point in time. The KIE session has no memory of any data that was passed into the KIE session previously.</p>
</div>
<div class="paragraph">
<p>Stateless KIE sessions are commonly used for the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Validation</strong>, such as validating that a person is eligible for a mortgage</p>
</li>
<li>
<p><strong>Calculation</strong>, such as computing a mortgage premium</p>
</li>
<li>
<p><strong>Routing and filtering</strong>, such as sorting incoming emails into folders or sending incoming emails to a destination</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, consider the following driver&#8217;s license data model and sample DRL rule:</p>
</div>
<div class="listingblock">
<div class="title">Data model for driver&#8217;s license application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Applicant {
  private String name;
  private int age;
  private boolean valid;
  // Getter and setter methods
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample DRL rule for driver&#8217;s license application</div>
<div class="content">
<pre class="highlightjs highlight"><code>package com.company.license

rule "Is of valid age"
when
  $a : Applicant(age &lt; 18)
then
  $a.setValid(false);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Is of valid age</code> rule disqualifies any applicant younger than 18 years old. When the <code>Applicant</code> object is inserted into the Drools engine, the Drools engine evaluates the constraints for each rule and searches for a match. The <code>"objectType"</code> constraint is always implied, after which any number of explicit field constraints are evaluated. The variable <code>$a</code> is a binding variable that references the matched object in the rule consequence.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The dollar sign (<code>$</code>) is optional and helps to differentiate between variable names and field names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, the sample rule and all other files in the <code>~/resources</code> folder of the Drools project are built with the following code:</p>
</div>
<div class="listingblock">
<div class="title">Create the KIE container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code compiles all the rule files found on the class path and adds the result of this compilation, a <code>KieModule</code> object, in the <code>KieContainer</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the <code>StatelessKieSession</code> object is instantiated from the <code>KieContainer</code> and is executed against specified data:</p>
</div>
<div class="listingblock">
<div class="title">Instantiate the stateless KIE session and enter data</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession kSession = kContainer.newStatelessKieSession();

Applicant applicant = new Applicant("Mr John Smith", 16);

assertTrue(applicant.isValid());

ksession.execute(applicant);

assertFalse(applicant.isValid());</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a stateless KIE session configuration, the <code>execute()</code> call acts as a combination method that instantiates the <code>KieSession</code> object, adds all the user data and executes user commands, calls <code>fireAllRules()</code>, and then calls <code>dispose()</code>. Therefore, with a stateless KIE session, you do not need to call <code>fireAllRules()</code> or call <code>dispose()</code> after session invocation as you do with a stateful KIE session.</p>
</div>
<div class="paragraph">
<p>In this case, the specified applicant is under the age of 18, so the application is declined.</p>
</div>
<div class="paragraph">
<p>For a more complex use case, see the following example. This example uses a stateless KIE session and executes rules against an iterable list of objects, such as a collection.</p>
</div>
<div class="listingblock">
<div class="title">Expanded data model for driver&#8217;s license application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Applicant {
  private String name;
  private int age;
  // Getter and setter methods
}

public class Application {
  private Date dateApplied;
  private boolean valid;
  // Getter and setter methods
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Expanded DRL rule set for driver&#8217;s license application</div>
<div class="content">
<pre class="highlightjs highlight"><code>package com.company.license

rule "Is of valid age"
when
  Applicant(age &lt; 18)
  $a : Application()
then
  $a.setValid(false);
end

rule "Application was made this year"
when
  $a : Application(dateApplied &gt; "01-jan-2009")
then
  $a.setValid(false);
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Expanded Java source with iterable execution in a stateless KIE session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKnowledgeSession();
Applicant applicant = new Applicant("Mr John Smith", 16);
Application application = new Application();

assertTrue(application.isValid());
ksession.execute(Arrays.asList(new Object[] { application, applicant }));  <i class="conum" data-value="1"></i><b>(1)</b>
assertFalse(application.isValid());

ksession.execute
  (CommandFactory.newInsertIterable(new Object[] { application, applicant }));  <i class="conum" data-value="2"></i><b>(2)</b>

List&lt;Command&gt; cmds = new ArrayList&lt;Command&gt;();  <i class="conum" data-value="3"></i><b>(3)</b>
cmds.add(CommandFactory.newInsert(new Person("Mr John Smith"), "mrSmith"));
cmds.add(CommandFactory.newInsert(new Person("Mr John Doe"), "mrDoe"));

BatchExecutionResults results = ksession.execute(CommandFactory.newBatchExecution(cmds));
assertEquals(new Person("Mr John Smith"), results.getValue("mrSmith"));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method for executing rules against an iterable collection of objects produced by the <code>Arrays.asList()</code> method. Every collection element is inserted before any matched rules are executed. The <code>execute(Object object)</code> and <code>execute(Iterable objects)</code> methods are wrappers around the <code>execute(Command command)</code> method that comes from the <code>BatchExecutor</code> interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Execution of the iterable collection of objects using the <code>CommandFactory</code> interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>BatchExecutor</code> and <code>CommandFactory</code> configurations for working with many different commands or result output identifiers. The <code>CommandFactory</code> interface supports other commands that you can use in the <code>BatchExecutor</code>, such as <code>StartProcess</code>, <code>Query</code>, and <code>SetGlobal</code>.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="kie-sessions-stateless-globals-con_decision-engine"><a class="anchor" href="#kie-sessions-stateless-globals-con_decision-engine"></a><a class="link" href="#kie-sessions-stateless-globals-con_decision-engine">3.1.1.1. Global variables in stateless KIE sessions</a></h5>
<div class="paragraph">
<p>The <code>StatelessKieSession</code> object supports global variables (globals) that you can configure to be resolved as session-scoped globals, delegate globals, or execution-scoped globals.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Session-scoped globals:</strong> For session-scoped globals, you can use the method <code>getGlobals()</code> to return a <code>Globals</code> instance that provides access to the KIE session globals. These globals are used for all execution calls. Use caution with mutable globals because execution calls can be executing simultaneously in different threads.</p>
<div class="listingblock">
<div class="title">Session-scoped global</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.StatelessKieSession;

StatelessKieSession ksession = kbase.newStatelessKieSession();

// Set a global `myGlobal` that can be used in the rules.
ksession.setGlobal("myGlobal", "I am a global");

// Execute while resolving the `myGlobal` identifier.
ksession.execute(collection);</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Delegate globals:</strong> For delegate globals, you can assign a value to a global (with <code>setGlobal(String, Object)</code>) so that the value is stored in an internal collection that maps identifiers to values. Identifiers in this internal collection have priority over any supplied delegate. If an identifier cannot be found in this internal collection, the delegate global (if any) is used.</p>
</li>
<li>
<p><strong>Execution-scoped globals:</strong> For execution-scoped globals, you can use the <code>Command</code> object to set a global that is passed to the <code>CommandExecutor</code> interface for execution-specific global resolution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>CommandExecutor</code> interface also enables you to export data using out identifiers for globals, inserted facts, and query results:</p>
</div>
<div class="listingblock">
<div class="title">Out identifiers for globals, inserted facts, and query results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.ExecutionResults;

// Set up a list of commands.
List cmds = new ArrayList();
cmds.add(CommandFactory.newSetGlobal("list1", new ArrayList(), true));
cmds.add(CommandFactory.newInsert(new Person("jon", 102), "person"));
cmds.add(CommandFactory.newQuery("Get People" "getPeople"));

// Execute the list.
ExecutionResults results = ksession.execute(CommandFactory.newBatchExecution(cmds));

// Retrieve the `ArrayList`.
results.getValue("list1");
// Retrieve the inserted `Person` fact.
results.getValue("person");
// Retrieve the query as a `QueryResults` instance.
results.getValue("Get People");</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kie-sessions-stateful-con_decision-engine"><a class="anchor" href="#kie-sessions-stateful-con_decision-engine"></a><a class="link" href="#kie-sessions-stateful-con_decision-engine">3.1.2. Stateful KIE sessions</a></h4>
<div class="paragraph">
<p>A stateful KIE session is a session that uses inference to make iterative changes to facts over time. In a stateful KIE session, data from a previous invocation of the KIE session (the previous session state) is retained between session invocations, whereas in a stateless KIE session, that data is discarded.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Ensure that you call the <code>dispose()</code> method after running a stateful KIE session so that no memory leaks occur between session invocations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Stateful KIE sessions are commonly used for the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Monitoring</strong>, such as monitoring a stock market and automating the buying process</p>
</li>
<li>
<p><strong>Diagnostics</strong>, such as running fault-finding processes or medical diagnostic processes</p>
</li>
<li>
<p><strong>Logistics</strong>, such as parcel tracking and delivery provisioning</p>
</li>
<li>
<p><strong>Ensuring compliance</strong>, such as verifying the legality of market trades</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, consider the following fire alarm data model and sample DRL rules:</p>
</div>
<div class="listingblock">
<div class="title">Data model for sprinklers and fire alarm</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Room {
  private String name;
  // Getter and setter methods
}

public class Sprinkler {
  private Room room;
  private boolean on;
  // Getter and setter methods
}

public class Fire {
  private Room room;
  // Getter and setter methods
}

public class Alarm { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample DRL rule set for activating sprinklers and alarm</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "When there is a fire turn on the sprinkler"
when
  Fire($room : room)
  $sprinkler : Sprinkler(room == $room, on == false)
then
  modify($sprinkler) { setOn(true) };
  System.out.println("Turn on the sprinkler for room "+$room.getName());
end

rule "Raise the alarm when we have one or more fires"
when
    exists Fire()
then
    insert( new Alarm() );
    System.out.println( "Raise the alarm" );
end

rule "Cancel the alarm when all the fires have gone"
when
    not Fire()
    $alarm : Alarm()
then
    delete( $alarm );
    System.out.println( "Cancel the alarm" );
end


rule "Status output when things are ok"
when
    not Alarm()
    not Sprinkler( on == true )
then
    System.out.println( "Everything is ok" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>When there is a fire turn on the sprinkler</code> rule, when a fire occurs, the instances of the <code>Fire</code> class are created for that room and inserted into the KIE session. The rule adds a constraint for the specific <code>room</code> matched in the <code>Fire</code> instance so that only the sprinkler for that room is checked. When this rule is executed, the sprinkler activates. The other sample rules determine when the alarm is activated or deactivated accordingly.</p>
</div>
<div class="paragraph">
<p>Whereas a stateless KIE session relies on standard Java syntax to modify a field, a stateful KIE session relies on the <code>modify</code> statement in rules to notify the Drools engine of changes. The Drools engine then reasons over the changes and assesses impact on subsequent rule executions. This process is part of the Drools engine ability to use <em>inference</em> and <em>truth maintenance</em> and is essential in stateful KIE sessions.</p>
</div>
<div class="paragraph">
<p>In this example, the sample rules and all other files in the <code>~/resources</code> folder of the Drools project are built with the following code:</p>
</div>
<div class="listingblock">
<div class="title">Create the KIE container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code compiles all the rule files found on the class path and adds the result of this compilation, a <code>KieModule</code> object, in the <code>KieContainer</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the <code>KieSession</code> object is instantiated from the <code>KieContainer</code> and is executed against specified data:</p>
</div>
<div class="listingblock">
<div class="title">Instantiate the stateful KIE session and enter data</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kContainer.newKieSession();

String[] names = new String[]{"kitchen", "bedroom", "office", "livingroom"};
Map&lt;String,Room&gt; name2room = new HashMap&lt;String,Room&gt;();
for( String name: names ){
    Room room = new Room( name );
    name2room.put( name, room );
    ksession.insert( room );
    Sprinkler sprinkler = new Sprinkler( room );
    ksession.insert( sprinkler );
}

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Console output</div>
<div class="content">
<pre class="highlightjs highlight"><code>&gt; Everything is ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the data added, the Drools engine completes all pattern matching but no rules have been executed, so the configured verification message appears. As new data triggers rule conditions, the Drools engine executes rules to activate the alarm and later to cancel the alarm that has been activated:</p>
</div>
<div class="listingblock">
<div class="title">Enter new data to trigger rules</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Fire kitchenFire = new Fire( name2room.get( "kitchen" ) );
Fire officeFire = new Fire( name2room.get( "office" ) );

FactHandle kitchenFireHandle = ksession.insert( kitchenFire );
FactHandle officeFireHandle = ksession.insert( officeFire );

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Console output</div>
<div class="content">
<pre class="highlightjs highlight"><code>&gt; Raise the alarm
&gt; Turn on the sprinkler for room kitchen
&gt; Turn on the sprinkler for room office</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.delete( kitchenFireHandle );
ksession.delete( officeFireHandle );

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Console output</div>
<div class="content">
<pre class="highlightjs highlight"><code>&gt; Cancel the alarm
&gt; Turn off the sprinkler for room office
&gt; Turn off the sprinkler for room kitchen
&gt; Everything is ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, a reference is kept for the returned <code>FactHandle</code> object. A fact handle is an internal engine reference to the inserted instance and enables instances to be retracted or modified later.</p>
</div>
<div class="paragraph">
<p>As this example illustrates, the data and results from previous stateful KIE sessions (the activated alarm) affect the invocation of subsequent sessions (alarm cancellation).</p>
</div>
</div>
<div class="sect3">
<h4 id="kie-sessions-pools-con_decision-engine"><a class="anchor" href="#kie-sessions-pools-con_decision-engine"></a><a class="link" href="#kie-sessions-pools-con_decision-engine">3.1.3. KIE session pools</a></h4>
<div class="paragraph">
<p>In use cases with large amounts of KIE runtime data and high system activity, KIE sessions might be created and disposed very frequently. A high turnover of KIE sessions is not always time consuming, but when the turnover is repeated millions of times, the process can become a bottleneck and require substantial clean-up effort.</p>
</div>
<div class="paragraph">
<p>For these high-volume cases, you can use KIE session pools instead of many individual KIE sessions. To use a KIE session pool, you obtain a KIE session pool from a KIE container, define the initial number of KIE sessions in the pool, and create the KIE sessions from that pool as usual:</p>
</div>
<div class="listingblock">
<div class="title">Example KIE session pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Obtain a KIE session pool from the KIE container
KieContainerSessionsPool pool = kContainer.newKieSessionsPool(10);

// Create KIE sessions from the KIE session pool
KieSession kSession = pool.newKieSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the KIE session pool starts with 10 KIE sessions in it, but you can specify the number of KIE sessions that you need. This integer value is the number of KIE sessions that are only initially created in the pool. If required by the running application, the number of KIE sessions in the pool can dynamically grow beyond that value.</p>
</div>
<div class="paragraph">
<p>After you define a KIE session pool, the next time you use the KIE session as usual and call <code>dispose()</code> on it, the KIE session is reset and pushed back into the pool instead of being destroyed.</p>
</div>
<div class="paragraph">
<p>KIE session pools typically apply to stateful KIE sessions, but KIE session pools can also affect stateless KIE sessions that you reuse with multiple <code>execute()</code> calls. When you create a stateless KIE session directly from a KIE container, the KIE session continues to internally create a new KIE session for each <code>execute()</code> invocation. Conversely, when you create a stateless KIE session from a KIE session pool, the KIE session internally uses only the specific KIE sessions provided by the pool.</p>
</div>
<div class="paragraph">
<p>When you finish using a KIE session pool, you can call the <code>shutdown()</code> method on it to avoid memory leaks. Alternatively, you can call <code>dispose()</code> on the KIE container to shut down all the pools created from the KIE container.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inference-and-truth-maintenance_decision-engine"><a class="anchor" href="#inference-and-truth-maintenance_decision-engine"></a><a class="link" href="#inference-and-truth-maintenance_decision-engine">3.2. Inference and truth maintenance in the Drools engine</a></h3>
<div class="paragraph">
<p>The basic function of the Drools engine is to match data to business rules and determine whether and how to execute rules. To ensure that relevant data is applied to the appropriate rules, the Drools engine makes <em>inferences</em> based on existing knowledge and performs the actions based on the inferred information.</p>
</div>
<div class="paragraph">
<p>For example, the following DRL rule determines the age requirements for adults, such as in a bus pass policy:</p>
</div>
<div class="listingblock">
<div class="title">Rule to define age requirement</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Infer Adult"
when
  $p : Person(age &gt;= 18)
then
  insert(new IsAdult($p))
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on this rule, the Drools engine infers whether a person is an adult or a child and performs the specified action (the <code>then</code> consequence). Every person who is 18 years old or older has an instance of <code>IsAdult</code> inserted for them in the working memory. This inferred relation of age and bus pass can then be invoked in any rule, such as in the following rule segment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$p : Person()
IsAdult(person == $p)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In many cases, new data in a rule system is the result of other rule executions, and this new data can affect the execution of other rules. If the Drools engine asserts data as a result of executing a rule, the Drools engine uses truth maintenance to justify the assertion and enforce truthfulness when applying inferred information to other rules. Truth maintenance also helps to identify inconsistencies and to handle contradictions. For example, if two rules are executed and result in a contradictory action, the Drools engine chooses the action based on assumptions from previously calculated conclusions.</p>
</div>
<div class="paragraph">
<p>The Drools engine inserts facts using either stated or logical insertions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Stated insertions:</strong> Defined with <code>insert()</code>. After stated insertions, facts are generally retracted explicitly. (The term <em>insertion</em>, when used generically, refers to <em>stated insertion</em>.)</p>
</li>
<li>
<p><strong>Logical insertions:</strong> Defined with <code>insertLogical()</code>. After logical insertions, the facts that were inserted are automatically retracted when the conditions in the rules that inserted the facts are no longer true. The facts are retracted when no condition supports the logical insertion. A fact that is logically inserted is considered to be <em>justified</em> by the Drools engine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following sample DRL rules use stated fact insertion to determine the age requirements for issuing a child bus pass or an adult bus pass:</p>
</div>
<div class="listingblock">
<div class="title">Rules to issue bus pass, stated insertion</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Issue Child Bus Pass"
when
  $p : Person(age &lt; 18)
then
  insert(new ChildBusPass($p));
end

rule "Issue Adult Bus Pass"
when
  $p : Person(age &gt;= 18)
then
  insert(new AdultBusPass($p));
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>These rules are not easily maintained in the Drools engine as bus riders increase in age and move from child to adult bus pass. As an alternative, these rules can be separated into rules for bus rider age and rules for bus pass type using logical fact insertion. The logical insertion of the fact makes the fact dependent on the truth of the <code>when</code> clause.</p>
</div>
<div class="paragraph">
<p>The following DRL rules use logical insertion to determine the age requirements for children and adults:</p>
</div>
<div class="listingblock">
<div class="title">Children and adult age requirements, logical insertion</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Infer Child"
when
  $p : Person(age &lt; 18)
then
  insertLogical(new IsChild($p))
end

rule "Infer Adult"
when
  $p : Person(age &gt;= 18)
then
  insertLogical(new IsAdult($p))
end</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For logical insertions, your fact objects must override the <code>equals</code> and <code>hashCode</code> methods from the <code>java.lang.Object</code> object according to the Java standard. Two objects are equal if their <code>equals</code> methods return <code>true</code> for each other and if their <code>hashCode</code> methods return the same values. For more information, see the Java API documentation for your Java version.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the condition in the rule is false, the fact is automatically retracted. This behavior is helpful in this example because the two rules are mutually exclusive. In this example, if the person is younger than 18 years old, the rule logically inserts an <code>IsChild</code> fact. After the person is 18 years old or older, the <code>IsChild</code> fact is automatically retracted and the <code>IsAdult</code> fact is inserted.</p>
</div>
<div class="paragraph">
<p>The following DRL rules then determine whether to issue a child bus pass or an adult bus pass and logically insert the <code>ChildBusPass</code> and <code>AdultBusPass</code> facts. This rule configuration is possible because the truth maintenance system in the Drools engine supports chaining of logical insertions for a cascading set of retracts.</p>
</div>
<div class="listingblock">
<div class="title">Rules to issue bus pass, logical insertion</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Issue Child Bus Pass"
when
  $p : Person()
    IsChild(person == $p)
then
  insertLogical(new ChildBusPass($p));
end

rule "Issue Adult Bus Pass"
when
  $p : Person()
    IsAdult(person =$p)
then
  insertLogical(new AdultBusPass($p));
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a person turns 18 years old, the <code>IsChild</code> fact and the person&#8217;s <code>ChildBusPass</code> fact is retracted. To these set of conditions, you can relate another rule that states that a person must return the child pass after turning 18 years old. When the Drools engine automatically retracts the <code>ChildBusPass</code> object, the following rule is executed to send a request to the person:</p>
</div>
<div class="listingblock">
<div class="title">Rule to notify bus pass holder of new pass</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Return ChildBusPass Request"
when
  $p : Person()
    not(ChildBusPass(person == $p))
then
  requestChildBusPass($p);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following flowcharts illustrate the life cycle of stated and logical insertions:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./HybridReasoning/Stated_Assertion.png" alt="Stated Assertion">
</div>
<div class="title">Figure 32. Stated insertion</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./HybridReasoning/Logical_Assertion.png" alt="Logical Assertion">
</div>
<div class="title">Figure 33. Logical insertion</div>
</div>
<div class="paragraph">
<p>When the Drools engine logically inserts an object during a rule execution, the Drools engine <em>justifies</em> the object by executing the rule. For each logical insertion, only one equal object can exist, and each subsequent equal logical insertion increases the justification counter for that logical insertion. A justification is removed when the conditions of the rule become untrue. When no more justifications exist, the logical object is automatically retracted.</p>
</div>
<div class="sect3">
<h4 id="_government_id_example"><a class="anchor" href="#_government_id_example"></a><a class="link" href="#_government_id_example">3.2.1. Government ID example</a></h4>
<div class="paragraph">
<p>So now we know what inference is, and have a basic example, how does this facilitate good rule design and maintenance?</p>
</div>
<div class="paragraph">
<p>Consider a government ID department that is responsible for issuing ID cards when children become adults.
They might have a decision table that includes logic like this, which says when an adult living in London is 18 or over, issue the card:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" colspan="3" style="background-color: #000000;"><p class="tableblock"><span class="white">RuleTable ID Card</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" colspan="2" style="background-color: #ffcc99;"><p class="tableblock">p : Person</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">location</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">age &gt;= $1</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">issueIdCard($1)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #ccffcc;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ccffff;"><p class="tableblock">Select Person</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ccffff;"><p class="tableblock">Select Adults</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffff99;"><p class="tableblock">Issue ID Card</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">Issue ID Card to Adults</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">London</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">p</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>However the ID department does not set the policy on who an adult is.
That&#8217;s done at a central government level.
If the central government were to change that age to 21, this would initiate a change management process.
Someone would have to liaise with the ID department and make sure their systems are updated, in time for the law going live.</p>
</div>
<div class="paragraph">
<p>This change management process and communication between departments is not ideal for an agile environment, and change becomes costly and error prone.
Also the card department is managing more information than it needs to be aware of with its "monolithic" approach to rules management which is "leaking" information better placed elsewhere.
By this I mean that it doesn&#8217;t care what explicit "age &gt;= 18" information determines whether someone is an adult, only that they are an adult.</p>
</div>
<div class="paragraph">
<p>In contrast to this, let&#8217;s pursue an approach where we split (de-couple) the authoring responsibilities, so that both the central government and the ID department maintain their own rules.</p>
</div>
<div class="paragraph">
<p>It&#8217;s the central government&#8217;s job to determine who is an adult.
If they change the law they just update their central repository with the new rules, which others use:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" colspan="2" style="background-color: #000000;"><p class="tableblock"><span class="white">RuleTable Age Policy</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc94;"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc94;"><p class="tableblock">ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc94;"><p class="tableblock">p : Person</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc94;"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #bfbfbf;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc94;"><p class="tableblock">age &gt;= $1</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc94;"><p class="tableblock">insert($1)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #b9ffca;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ccffff;"><p class="tableblock">Adult Age Policy</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #f7ff92;"><p class="tableblock">Add Adult Relation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">Infer Adult</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">new IsAdult( p )</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The IsAdult fact, as discussed previously, is inferred from the policy rules.
It encapsulates the seemingly arbitrary piece of logic "age &gt;= 18" and provides semantic abstractions for its meaning.
Now if anyone uses the above rules, they no longer need to be aware of explicit information that determines whether someone is an adult or not.
They can just use the inferred fact:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0c0c0;"></td>
<td class="tableblock halign-center valign-top" colspan="3" style="background-color: #000000;"><p class="tableblock"><span class="white">RuleTable ID Card</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0c0c0;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0c0c0;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">p : Person</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">isAdult</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0c0c0;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">location</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">person == $1</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffcc99;"><p class="tableblock">issueIdCard($1)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #ccffcc;"></td>
<td class="tableblock halign-center valign-top" style="background-color: #ccffff;"><p class="tableblock">Select Person</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ccffff;"><p class="tableblock">Select Adults</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffff99;"><p class="tableblock">Issue ID Card</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">Issue ID Card to Adults</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">London</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">p</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #ffffff;"><p class="tableblock">p</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>While the example is very minimal and trivial it illustrates some important points.
We started with a monolithic and leaky approach to our knowledge engineering.
We created a single decision table that had all possible information in it and that leaks information from central government that the ID department did not care about and did not want to manage.</p>
</div>
<div class="paragraph">
<p>We first de-coupled the knowledge process so each department was responsible for only what it needed to know.
We then encapsulated this leaky knowledge using an inferred fact IsAdult.
The use of the term IsAdult also gave a semantic abstraction to the previously arbitrary logic "age &gt;= 18".</p>
</div>
<div class="paragraph">
<p>So a general rule of thumb when doing your knowledge engineering is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bad</strong></p>
<div class="ulist">
<ul>
<li>
<p>Monolithic</p>
</li>
<li>
<p>Leaky</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Good</strong></p>
<div class="ulist">
<ul>
<li>
<p>De-couple knowledge responsibilities</p>
</li>
<li>
<p>Encapsulate knowledge</p>
</li>
<li>
<p>Provide semantic abstractions for those encapsulations</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="fact-equality-modes-con_decision-engine"><a class="anchor" href="#fact-equality-modes-con_decision-engine"></a><a class="link" href="#fact-equality-modes-con_decision-engine">3.2.2. Fact equality modes in the Drools engine</a></h4>
<div class="paragraph">
<p>The Drools engine supports the following fact equality modes that determine how the Drools engine stores and compares inserted facts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identity</code>: (Default) The Drools engine uses an <code>IdentityHashMap</code> to store all inserted facts. For every new fact insertion, the Drools engine returns a new <code>FactHandle</code> object. If a fact is inserted again, the Drools engine returns the original <code>FactHandle</code> object, ignoring repeated insertions for the same fact. In this mode, two facts are the same for the Drools engine only if they are the very same object with the same identity.</p>
</li>
<li>
<p><code>equality</code>: The Drools engine uses a <code>HashMap</code> to store all inserted facts. The Drools engine returns a new <code>FactHandle</code> object only if the inserted fact is not equal to an existing fact, according to the <code>equals()</code> method of the inserted fact. In this mode, two facts are the same for the Drools engine if they are composed the same way, regardless of identity. Use this mode when you want objects to be assessed based on feature equality instead of explicit identity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an illustration of fact equality modes, consider the following example facts:</p>
</div>
<div class="listingblock">
<div class="title">Example facts</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person p1 = new Person("John", 45);
Person p2 = new Person("John", 45);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>identity</code> mode, facts <code>p1</code> and <code>p2</code> are different instances of a <code>Person</code> class and are treated as separate objects because they have separate identities. In <code>equality</code> mode, facts <code>p1</code> and <code>p2</code> are treated as the same object because they are composed the same way. This difference in behavior affects how you can interact with fact handles.</p>
</div>
<div class="paragraph">
<p>For example, assume that you insert facts <code>p1</code> and <code>p2</code> into the Drools engine and later you want to retrieve the fact handle for <code>p1</code>. In <code>identity</code> mode, you must specify <code>p1</code> to return the fact handle for that exact object, whereas in <code>equality</code> mode, you can specify <code>p1</code>, <code>p2</code>, or <code>new Person("John", 45)</code> to return the fact handle.</p>
</div>
<div class="listingblock">
<div class="title">Example code to insert a fact and return the fact handle in <code>identity</code> mode</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert(p1);

ksession.getFactHandle(p1);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example code to insert a fact and return the fact handle in <code>equality</code> mode</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert(p1);

ksession.getFactHandle(p1);

// Alternate option:
ksession.getFactHandle(new Person("John", 45));</code></pre>
</div>
</div>
<div class="paragraph">
<p>To set the fact equality mode, use one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the system property <code>drools.equalityBehavior</code> to <code>identity</code> (default) or <code>equality</code>.</p>
</li>
<li>
<p>Set the equality mode while creating the KIE base programmatically:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(EqualityBehaviorOption.EQUALITY);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>Set the equality mode in the KIE module descriptor file (<code>kmodule.xml</code>) for a specific Drools project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" equalsBehavior="equality" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="execution-control-con_decision-engine"><a class="anchor" href="#execution-control-con_decision-engine"></a><a class="link" href="#execution-control-con_decision-engine">3.3. Execution control in the Drools engine</a></h3>
<div class="paragraph">
<p>When new rule data enters the working memory of the Drools engine, rules may become fully matched and eligible for execution. A single working memory action can result in multiple eligible rule executions. When a rule is fully matched, the Drools engine creates an activation instance, referencing the rule and the matched facts, and adds the activation onto the Drools engine agenda. The agenda controls the execution order of these rule activations using a conflict resolution strategy.</p>
</div>
<div class="paragraph">
<p>After the first call of <code>fireAllRules()</code> in the Java application, the Drools engine cycles repeatedly through two phases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Agenda evaluation.</strong> In this phase, the Drools engine selects all rules that can be executed. If no executable rules exist, the execution cycle ends. If an executable rule is found, the Drools engine registers the activation in the agenda and then moves on to the working memory actions phase to perform rule consequence actions.</p>
</li>
<li>
<p><strong>Working memory actions.</strong> In this phase, the Drools engine performs the rule consequence actions (the <code>then</code> portion of each rule) for all activated rules previously registered in the agenda. After all the consequence actions are complete or the main Java application process calls <code>fireAllRules()</code> again, the Drools engine returns to the agenda evaluation phase to reassess rules.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/Two_Phase.png" alt="Two Phase">
</div>
<div class="title">Figure 34. Two-phase execution process in the Drools engine</div>
</div>
<div class="paragraph">
<p>When multiple rules exist on the agenda, the execution of one rule may cause another rule to be removed from the agenda. To avoid this, you can define how and when rules are executed in the Drools engine. Some common methods for defining rule execution order are by using rule salience, agenda groups, activation groups, or rule units for DRL rule sets.</p>
</div>
<div class="sect3">
<h4 id="_salience_for_rules"><a class="anchor" href="#_salience_for_rules"></a><a class="link" href="#_salience_for_rules">3.3.1. Salience for rules</a></h4>
<div class="paragraph">
<p>Each rule has an integer <code>salience</code> attribute that determines the order of execution. Rules with a higher salience value are given higher priority when ordered in the activation queue. The default salience value for rules is zero, but the salience can be negative or positive.</p>
</div>
<div class="paragraph">
<p>For example, the following sample DRL rules are listed in the Drools engine stack in the order shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "RuleA"
salience 95
when
    $fact : MyFact( field1 == true )
then
    System.out.println("Rule2 : " + $fact);
    update($fact);
end

rule "RuleB"
salience 100
when
   $fact : MyFact( field1 == false )
then
   System.out.println("Rule1 : " + $fact);
   $fact.setField1(true);
   update($fact);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>RuleB</code> rule is listed second, but it has a higher salience value than the <code>RuleA</code> rule and is therefore executed first.</p>
</div>
</div>
<div class="sect3">
<h4 id="_agenda_groups_for_rules"><a class="anchor" href="#_agenda_groups_for_rules"></a><a class="link" href="#_agenda_groups_for_rules">3.3.2. Agenda groups for rules</a></h4>
<div class="paragraph">
<p>An agenda group is a set of rules bound together by the same <code>agenda-group</code> rule attribute. Agenda groups partition rules on the Drools engine agenda. At any one time, only one group has a <em>focus</em> that gives that group of rules priority for execution before rules in other agenda groups. You determine the focus with a <code>setFocus()</code> call for the agenda group. You can also define rules with an <code>auto-focus</code> attribute so that the next time the rule is activated, the focus is automatically given to the entire agenda group to which the rule is assigned.</p>
</div>
<div class="paragraph">
<p>Each time the <code>setFocus()</code> call is made in a Java application, the Drools engine adds the specified agenda group to the top of the rule stack. The default agenda group <code>"MAIN"</code> contains all rules that do not belong to a specified agenda group and is executed first in the stack unless another group has the focus.</p>
</div>
<div class="paragraph">
<p>For example, the following sample DRL rules belong to specified agenda groups and are listed in the Drools engine stack in the order shown:</p>
</div>
<div class="listingblock">
<div class="title">Sample DRL rules for banking application</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Increase balance for credits"
  agenda-group "calculation"
when
  ap : AccountPeriod()
  acc : Account( $accountNo : accountNo )
  CashFlow( type == CREDIT,
            accountNo == $accountNo,
            date &gt;= ap.start &amp;&amp; &lt;= ap.end,
            $amount : amount )
then
  acc.balance  += $amount;
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Print balance for AccountPeriod"
  agenda-group "report"
when
  ap : AccountPeriod()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, the rules in the <code>"report"</code> agenda group must always be executed first and the rules in the <code>"calculation"</code> agenda group must always be executed second. Any remaining rules in other agenda groups can then be executed. Therefore, the <code>"report"</code> and <code>"calculation"</code> groups must receive the focus to be executed in that order, before other rules can be executed:</p>
</div>
<div class="listingblock">
<div class="title">Set the focus for the order of agenda group execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Agenda agenda = ksession.getAgenda();
agenda.getAgendaGroup( "report" ).setFocus();
agenda.getAgendaGroup( "calculation" ).setFocus();
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>clear()</code> method to cancel all the activations generated by the rules belonging to a given agenda group before each has had a chance to be executed:</p>
</div>
<div class="listingblock">
<div class="title">Cancel all other rule activations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getAgenda().getAgendaGroup( "Group A" ).clear();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_activation_groups_for_rules"><a class="anchor" href="#_activation_groups_for_rules"></a><a class="link" href="#_activation_groups_for_rules">3.3.3. Activation groups for rules</a></h4>
<div class="paragraph">
<p>An activation group is a set of rules bound together by the same <code>activation-group</code> rule attribute. In this group, only one rule can be executed. After conditions are met for a rule in that group to be executed, all other pending rule executions from that activation group are removed from the agenda.</p>
</div>
<div class="paragraph">
<p>For example, the following sample DRL rules belong to the specified activation group and are listed in the Drools engine stack in the order shown:</p>
</div>
<div class="listingblock">
<div class="title">Sample DRL rules for banking</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Print balance for AccountPeriod1"
  activation-group "report"
when
  ap : AccountPeriod1()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Print balance for AccountPeriod2"
  activation-group "report"
when
  ap : AccountPeriod2()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, if the first rule in the <code>"report"</code> activation group is executed, the second rule in the group and all other executable rules on the agenda are removed from the agenda.</p>
</div>
</div>
<div class="sect3">
<h4 id="rule-execution-modes-con_decision-engine"><a class="anchor" href="#rule-execution-modes-con_decision-engine"></a><a class="link" href="#rule-execution-modes-con_decision-engine">3.3.4. Rule execution modes and thread safety in the Drools engine</a></h4>
<div class="paragraph">
<p>The Drools engine supports the following rule execution modes that determine how and when the Drools engine executes rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Passive mode</strong>: (Default) The Drools engine evaluates rules when a user or an application explicitly calls <code>fireAllRules()</code>. Passive mode in the Drools engine is best for applications that require direct control over rule evaluation and execution, or for complex event processing (CEP) applications that use the pseudo clock implementation in the Drools engine.</p>
<div class="listingblock">
<div class="title">Example CEP application code with the Drools engine in passive mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("pseudo") );
KieSession session = kbase.newKieSession( conf, null );
SessionPseudoClock clock = session.getSessionClock();

session.insert( tick1 );
session.fireAllRules();

clock.advanceTime(1, TimeUnit.SECONDS);
session.insert( tick2 );
session.fireAllRules();

clock.advanceTime(1, TimeUnit.SECONDS);
session.insert( tick3 );
session.fireAllRules();

session.dispose();</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Active mode</strong>: If a user or application calls <code>fireUntilHalt()</code>, the Drools engine starts in active mode and evaluates rules continually until the user or application explicitly calls <code>halt()</code>. Active mode in the Drools engine is best for applications that delegate control of rule evaluation and execution to the Drools engine, or for complex event processing (CEP) applications that use the real-time clock implementation in the Drools engine. Active mode is also optimal for CEP applications that use active queries.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example CEP application code with the Drools engine in active mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("realtime") );
KieSession session = kbase.newKieSession( conf, null );

new Thread( new Runnable() {
  @Override
  public void run() {
      session.fireUntilHalt();
  }
} ).start();

session.insert( tick1 );

... Thread.sleep( 1000L ); ...

session.insert( tick2 );

... Thread.sleep( 1000L ); ...

session.insert( tick3 );

session.halt();
session.dispose();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example calls <code>fireUntilHalt()</code> from a dedicated execution thread to prevent the current thread from being blocked indefinitely while the Drools engine continues evaluating rules. The dedicated thread also enables you to call <code>halt()</code> at a later stage in the application code.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although you should avoid using both <code>fireAllRules()</code> and <code>fireUntilHalt()</code> calls, especially from different threads, the Drools engine can handle such situations safely using thread-safety logic and an internal state machine. If a <code>fireAllRules()</code> call is in progress and you call <code>fireUntilHalt()</code>, the Drools engine continues to run in passive mode until the <code>fireAllRules()</code> operation is complete and then starts in active mode in response to the <code>fireUntilHalt()</code> call. However, if the Drools engine is running in active mode following a <code>fireUntilHalt()</code> call and you call <code>fireAllRules()</code>, the <code>fireAllRules()</code> call is ignored and the Drools engine continues to run in active mode until you call <code>halt()</code>.
For more details about thread-safety and the internal state machine, see <a href="#_improved_multi_threading_behaviour">Improved multi-threading behaviour</a>.</p>
</div>
<div class="paragraph">
<p>For added thread safety in active mode, the Drools engine supports a <code>submit()</code> method that you can use to group and perform operations on a KIE session in a thread-safe, atomic action:</p>
</div>
<div class="listingblock">
<div class="title">Example application code with <code>submit()</code> method to perform atomic operations in active mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession session = ...;

new Thread( new Runnable() {
  @Override
  public void run() {
      session.fireUntilHalt();
  }
} ).start();

final FactHandle fh = session.insert( fact_a );

... Thread.sleep( 1000L ); ...

session.submit( new KieSession.AtomicAction() {
  @Override
  public void execute( KieSession kieSession ) {
    fact_a.setField("value");
    kieSession.update( fh, fact_a );
    kieSession.insert( fact_1 );
    kieSession.insert( fact_2 );
    kieSession.insert( fact_3 );
  }
} );

... Thread.sleep( 1000L ); ...

session.insert( fact_z );

session.halt();
session.dispose();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thread safety and atomic operations are also helpful from a client-side perspective. For example, you might need to insert more than one fact at a given time, but require the Drools engine to consider the insertions as an atomic operation and to wait until all the insertions are complete before evaluating the rules again.</p>
</div>
</div>
<div class="sect3">
<h4 id="fact-propagation-modes-con_decision-engine"><a class="anchor" href="#fact-propagation-modes-con_decision-engine"></a><a class="link" href="#fact-propagation-modes-con_decision-engine">3.3.5. Fact propagation modes in the Drools engine</a></h4>
<div class="paragraph">
<p>The Drools engine supports the following fact propagation modes that determine how the Drools engine progresses inserted facts through the engine network in preparation for rule execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lazy</strong>: (Default) Facts are propagated in batch collections at rule execution, not in real time as the facts are individually inserted by a user or application. As a result, the order in which the facts are ultimately propagated through the Drools engine may be different from the order in which the facts were individually inserted.</p>
</li>
<li>
<p><strong>Immediate</strong>: Facts are propagated immediately in the order that they are inserted by a user or application.</p>
</li>
<li>
<p><strong>Eager</strong>: Facts are propagated lazily (in batch collections), but before rule execution. The Drools engine uses this propagation behavior for rules that have the <code>no-loop</code> or <code>lock-on-active</code> attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, the Phreak rule algorithm in the Drools engine uses lazy fact propagation for improved rule evaluation overall. However, in few cases, this lazy propagation behavior can alter the expected result of certain rule executions that may require immediate or eager propagation.</p>
</div>
<div class="paragraph">
<p>For example, the following rule uses a specified query with a <code>?</code> prefix to invoke the query in pull-only or passive fashion:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with a passive query</div>
<div class="content">
<pre class="highlightjs highlight"><code>query Q (Integer i)
    String( this == i.toString() )
end

rule "Rule"
  when
    $i : Integer()
    ?Q( $i; )
  then
    System.out.println( $i );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, the rule should be executed only when a <code>String</code> that satisfies the query is inserted before the <code>Integer</code>, such as in the following example commands:</p>
</div>
<div class="listingblock">
<div class="title">Example commands that should trigger the rule execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = ...
ksession.insert("1");
ksession.insert(1);
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, due to the default lazy propagation behavior in Phreak, the Drools engine does not detect the insertion sequence of the two facts in this case, so this rule is executed regardless of <code>String</code> and <code>Integer</code> insertion order. For this example, immediate propagation is required for the expected rule evaluation.</p>
</div>
<div class="paragraph">
<p>To alter the Drools engine propagation mode to achieve the expected rule evaluation in this case, you can add the <code>@Propagation(&lt;type&gt;)</code> tag to your rule and set <code>&lt;type&gt;</code> to <code>LAZY</code>, <code>IMMEDIATE</code>, or <code>EAGER</code>.</p>
</div>
<div class="paragraph">
<p>In the same example rule, the immediate propagation annotation enables the rule to be evaluated only when a <code>String</code> that satisfies the query is inserted before the <code>Integer</code>, as expected:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with a passive query and specified propagation mode</div>
<div class="content">
<pre class="highlightjs highlight"><code>query Q (Integer i)
    String( this == i.toString() )
end

rule "Rule" @Propagation(IMMEDIATE)
  when
    $i : Integer()
    ?Q( $i; )
  then
    System.out.println( $i );
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="agenda-filters-con_decision-engine"><a class="anchor" href="#agenda-filters-con_decision-engine"></a><a class="link" href="#agenda-filters-con_decision-engine">3.3.6. Agenda evaluation filters</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./UserGuide/AgendaFilter.png" alt="AgendaFilter">
</div>
<div class="title">Figure 35. AgendaFilters</div>
</div>
<div class="paragraph">
<p>The Drools engine supports an <code>AgendaFilter</code> object in the filter interface that you can use to allow or deny the evaluation of specified rules during agenda evaluation. You can specify an agenda filter as part of a <code>fireAllRules()</code> call.</p>
</div>
<div class="paragraph">
<p>The following example code permits only rules ending with the string <code>"Test"</code> to be evaluated and executed. All other rules are filtered out of the Drools engine agenda.</p>
</div>
<div class="listingblock">
<div class="title">Example agenda filter definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.fireAllRules( new RuleNameEndsWithAgendaFilter( "Test" ) );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rule-units-con_decision-engine"><a class="anchor" href="#drl-rule-units-con_decision-engine"></a><a class="link" href="#drl-rule-units-con_decision-engine">3.3.7. Rule units in DRL rule sets</a></h4>
<div class="paragraph">
<p>Rule units are groups of data sources, global variables, and DRL rules that function together for a specific purpose. You can use rule units to partition a rule set into smaller units, bind different data sources to those units, and then execute the individual unit. Rule units are an enhanced alternative to rule-grouping DRL attributes such as rule agenda groups or activation groups for execution control.</p>
</div>
<div class="paragraph">
<p>Rule units are helpful when you want to coordinate rule execution so that the complete execution of one rule unit triggers the start of another rule unit and so on. For example, assume that you have a set of rules for data enrichment, another set of rules that processes that data, and another set of rules that extract the output from the processed data. If you add these rule sets into three distinct rule units, you can coordinate those rule units so that complete execution of the first unit triggers the start of the second unit and the complete execution of the second unit triggers the start of third unit.</p>
</div>
<div class="paragraph">
<p>To define a rule unit, implement the <code>RuleUnit</code> interface as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    private int adultAge;
    private DataSource&lt;Person&gt; persons;

    public AdultUnit( ) { }

    public AdultUnit( DataSource&lt;Person&gt; persons, int age ) {
        this.persons = persons;
        this.age = age;
    }

    // A data source of `Persons` in this rule unit:
    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    // A global variable in this rule unit:
    public int getAdultAge() {
        return adultAge;
    }

    // Life-cycle methods:
    @Override
    public void onStart() {
        System.out.println("AdultUnit started.");
    }

    @Override
    public void onEnd() {
        System.out.println("AdultUnit ended.");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>persons</code> is a source of facts of type <code>Person</code>. A rule unit data source is a source of the data processed by a given rule unit and represents the entry point that the Drools engine uses to evaluate the rule unit. The <code>adultAge</code> global variable is accessible from all the rules belonging to this rule unit. The last two methods are part of the rule unit life cycle and are invoked by the Drools engine.</p>
</div>
<div class="paragraph">
<p>The Drools engine supports the following optional life-cycle methods for rule units:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Rule unit life-cycle methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Method</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Invoked when</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onStart()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution starts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onEnd()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution ends</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onSuspend()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution is suspended (used only with <code>runUntilHalt()</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onResume()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution is resumed (used only with <code>runUntilHalt()</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onYield(RuleUnit other)</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The consequence of a rule in the rule unit triggers the execution of a different rule unit</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can add one or more rules to a rule unit. By default, all the rules in a DRL file are automatically associated with a rule unit that follows the naming convention of the DRL file name. If the DRL file is in the same package and has the same name as a class that implements the <code>RuleUnit</code> interface, then all of the rules in that DRL file implicitly belong to that rule unit. For example, all the rules in the <code>AdultUnit.drl</code> file in the <code>org.mypackage.myunit</code> package are automatically part of the rule unit <code>org.mypackage.myunit.AdultUnit</code>.</p>
</div>
<div class="paragraph">
<p>To override this naming convention and explicitly declare the rule unit that the rules in a DRL file belong to, use the <code>unit</code> keyword in the DRL file. The <code>unit</code> declaration must immediately follow the package declaration and contain the name of the class in that package that the rules in the DRL file are part of.</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit declaration in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : Person(age &gt;= adultAge) from persons
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not mix rules with and without a rule unit in the same KIE base. Mixing two rule paradigms in a KIE base results in a compilation error.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also rewrite the same pattern in a more convenient way using OOPath notation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit declaration in a DRL file that uses OOPath notation</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : /persons[age &gt;= adultAge]
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OOPath is an object-oriented syntax extension of XPath that is designed for browsing graphs of objects in DRL rule condition constraints. OOPath uses the compact notation from XPath for navigating through related elements while handling collections and filtering constraints, and is specifically useful for graphs of objects.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, any matching facts in the rule conditions are retrieved from the <code>persons</code> data source defined in the <code>DataSource</code> definition in the rule unit class. The rule condition and action use the <code>adultAge</code> variable in the same way that a global variable is defined at the DRL file level.</p>
</div>
<div class="paragraph">
<p>To execute one or more rule units defined in a KIE base, create a new <code>RuleUnitExecutor</code> class bound to the KIE base, create the rule unit from the relevant data source, and run the rule unit executer:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Create a `RuleUnitExecutor` class and bind it to the KIE base:
KieBase kbase = kieContainer.getKieBase();
RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

// Create the `AdultUnit` rule unit using the `persons` data source and run the executor:
RuleUnit adultUnit = new AdultUnit(persons, 18);
executor.run( adultUnit );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rules are executed by the <code>RuleUnitExecutor</code> class. The <code>RuleUnitExecutor</code> class creates KIE sessions and adds the required <code>DataSource</code> objects to those sessions, and then executes the rules based on the <code>RuleUnit</code> that is passed as a parameter to the <code>run()</code> method.</p>
</div>
<div class="paragraph">
<p>The example execution code produces the following output when the relevant <code>Person</code> facts are inserted in the <code>persons</code> data source:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution output</div>
<div class="content">
<pre class="highlightjs highlight"><code>org.mypackage.myunit.AdultUnit started.
Jane is adult and greater than 18
John is adult and greater than 18
org.mypackage.myunit.AdultUnit ended.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of explicitly creating the rule unit instance, you can register the rule unit variables in the executor and pass to the executor the rule unit class that you want to run, and then the executor creates an instance of the rule unit. You can then set the <code>DataSource</code> definition and other variables as needed before running the rule unit.</p>
</div>
<div class="listingblock">
<div class="title">Alternate rule unit execution option with registered variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "persons", persons );
        .bindVariable( "adultAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name that you pass to the <code>RuleUnitExecutor.bindVariable()</code> method is used at run time to bind the variable to the field of the rule unit class with the same name. In the previous example, the <code>RuleUnitExecutor</code> inserts into the new rule unit the data source bound to the <code>"persons"</code> name and inserts the value <code>18</code> bound to the String <code>"adultAge"</code> into the fields with the corresponding names inside the <code>AdultUnit</code> class.</p>
</div>
<div class="paragraph">
<p>To override this default variable-binding behavior, use the <code>@UnitVar</code> annotation to explicitly define a logical binding name for each field of the rule unit class. For example, the field bindings in the following class are redefined with alternative names:</p>
</div>
<div class="listingblock">
<div class="title">Example code to modify variable binding names with <code>@UnitVar</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    @UnitVar("minAge")
    private int adultAge = 18;

    @UnitVar("data")
    private DataSource&lt;Person&gt; persons;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then bind the variables to the executor using those alternative names and run the rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution with modified variable names</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "data", persons );
        .bindVariable( "minAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can execute a rule unit in <em>passive mode</em> by using the <code>run()</code> method (equivalent to invoking <code>fireAllRules()</code> on a KIE session)
or in <em>active mode</em> using the <code>runUntilHalt()</code> method (equivalent to invoking <code>fireUntilHalt()</code> on a KIE session). By default, the Drools engine runs in <em>passive mode</em> and evaluates rule units only when a user or an application explicitly calls <code>run()</code> (or <code>fireAllRules()</code> for standard rules). If a user or application calls <code>runUntilHalt()</code> for rule units (or <code>fireUntilHalt()</code> for standard rules), the Drools engine starts in <em>active mode</em> and evaluates rule units continually until the user or application explicitly calls <code>halt()</code>.</p>
</div>
<div class="paragraph">
<p>If you use the <code>runUntilHalt()</code> method, invoke the method on a separate execution thread to avoid blocking the main thread:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution with <code>runUntilHalt()</code> on a separate thread</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">new Thread( () -&gt; executor.runUntilHalt( adultUnit ) ).start();</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_data_sources_for_rule_units"><a class="anchor" href="#_data_sources_for_rule_units"></a><a class="link" href="#_data_sources_for_rule_units">3.3.7.1. Data sources for rule units</a></h5>
<div class="paragraph">
<p>A rule unit data source is a source of the data processed by a given rule unit and represents the entry point that the Drools engine uses to evaluate the rule unit. A rule unit can have zero or more data sources and each <code>DataSource</code> definition declared inside a rule unit can correspond to a different entry point into the rule unit executor. Multiple rule units can share a single data source, but each rule unit must use different entry points through which the same objects are inserted.</p>
</div>
<div class="paragraph">
<p>You can create a <code>DataSource</code> definition with a fixed set of data in a rule unit class, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example data source definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = DataSource.create( new Person( "John", 42 ),
                                                new Person( "Jane", 44 ),
                                                new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because a data source represents the entry point of the rule unit, you can insert, update, or delete facts in a rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example code to insert, modify, and delete a fact in a rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Insert a fact:
Person john = new Person( "John", 42 );
FactHandle johnFh = persons.insert( john );

// Modify the fact and optionally specify modified properties (for property reactivity):
john.setAge( 43 );
persons.update( johnFh, john, "age" );

// Delete the fact:
persons.delete( johnFh );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_execution_control"><a class="anchor" href="#_rule_unit_execution_control"></a><a class="link" href="#_rule_unit_execution_control">3.3.7.2. Rule unit execution control</a></h5>
<div class="paragraph">
<p>Rule units are helpful when you want to coordinate rule execution so that the execution of one rule unit triggers the start of another rule unit and so on.</p>
</div>
<div class="paragraph">
<p>To facilitate rule unit execution control, the Drools engine supports the following rule unit methods that you can use in DRL rule actions to coordinate the execution of rule units:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.run()</code>: Triggers the execution of a specified rule unit class. This method imperatively interrupts the execution of the rule unit and activates the other specified rule unit.</p>
</li>
<li>
<p><code>drools.guard()</code>: Prevents (guards) a specified rule unit class from being executed until the associated rule condition is met. This method declaratively schedules the execution of the other specified rule unit. When the Drools engine produces at least one match for the condition in the guarding rule, the guarded rule unit is considered active. A rule unit can contain multiple guarding rules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example of the <code>drools.run()</code> method, consider the following DRL rules that each belong to a specified rule unit. The <code>NotAdult</code> rule uses the <code>drools.run( AdultUnit.class )</code> method to trigger the execution of the <code>AdultUnit</code> rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rules with controlled execution using <code>drools.run()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    Person(age &gt;= 18, $name : name) from persons
  then
    System.out.println($name + " is adult");
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit NotAdultUnit

rule NotAdult
  when
    $p : Person(age &lt; 18, $name : name) from persons
  then
    System.out.println($name + " is NOT adult");
    modify($p) { setAge(18); }
    drools.run( AdultUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example also uses a <code>RuleUnitExecutor</code> class created from the KIE base that was built from these rules and a <code>DataSource</code> definition of <code>persons</code> bound to it:</p>
</div>
<div class="listingblock">
<div class="title">Example rule executor and data source definitions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Jane", 44 ),
                                                     new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the example creates the <code>DataSource</code> definition directly from the <code>RuleUnitExecutor</code> class and binds it to the <code>"persons"</code> variable in a single statement.</p>
</div>
<div class="paragraph">
<p>The example execution code produces the following output when the relevant <code>Person</code> facts are inserted in the <code>persons</code> data source:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution output</div>
<div class="content">
<pre class="highlightjs highlight"><code>Sally is NOT adult
John is adult
Jane is adult
Sally is adult</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>NotAdult</code> rule detects a match when evaluating the person <code>"Sally"</code>, who is under 18 years old. The rule then modifies
her age to <code>18</code> and uses the <code>drools.run( AdultUnit.class )</code> method to trigger the execution of the <code>AdultUnit</code> rule unit. The <code>AdultUnit</code> rule unit contains a rule that can now be executed for all of the 3 <code>persons</code> in the <code>DataSource</code> definition.</p>
</div>
<div class="paragraph">
<p>As an example of the <code>drools.guard()</code> method, consider the following <code>BoxOffice</code> class and <code>BoxOfficeUnit</code> rule unit class:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>BoxOffice</code> class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOffice {
    private boolean open;

    public BoxOffice( boolean open ) {
        this.open = open;
    }

    public boolean isOpen() {
        return open;
    }

    public void setOpen( boolean open ) {
        this.open = open;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>BoxOfficeUnit</code> rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOfficeUnit implements RuleUnit {
    private DataSource&lt;BoxOffice&gt; boxOffices;

    public DataSource&lt;BoxOffice&gt; getBoxOffices() {
        return boxOffices;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example also uses the following <code>TicketIssuerUnit</code> rule unit class to keep selling box office tickets for the event as long as at least one box office is open. This rule unit uses <code>DataSource</code> definitions of <code>persons</code> and <code>tickets</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>TicketIssuerUnit</code> rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TicketIssuerUnit implements RuleUnit {
    private DataSource&lt;Person&gt; persons;
    private DataSource&lt;AdultTicket&gt; tickets;

    private List&lt;String&gt; results;

    public TicketIssuerUnit() { }

    public TicketIssuerUnit( DataSource&lt;Person&gt; persons, DataSource&lt;AdultTicket&gt; tickets ) {
        this.persons = persons;
        this.tickets = tickets;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public DataSource&lt;AdultTicket&gt; getTickets() {
        return tickets;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BoxOfficeUnit</code> rule unit contains a <code>BoxOfficeIsOpen</code> DRL rule that uses the <code>drools.guard( TicketIssuerUnit.class )</code> method to guard the execution of the <code>TicketIssuerUnit</code> rule unit that distributes the event tickets, as shown in the following DRL rule examples:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rules with controlled execution using <code>drools.guard()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit TicketIssuerUnit;

rule IssueAdultTicket when
    $p: /persons[ age &gt;= 18 ]
then
    tickets.insert(new AdultTicket($p));
end
rule RegisterAdultTicket when
    $t: /tickets
then
    results.add( $t.getPerson().getName() );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit BoxOfficeUnit;

rule BoxOfficeIsOpen
  when
    $box: /boxOffices[ open ]
  then
    drools.guard( TicketIssuerUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, so long as at least one box office is <code>open</code>, the guarded <code>TicketIssuerUnit</code> rule unit is active and distributes event tickets. When no more box offices are in <code>open</code> state, the guarded <code>TicketIssuerUnit</code> rule unit is prevented from being executed.</p>
</div>
<div class="paragraph">
<p>The following example class illustrates a more complete box office scenario:</p>
</div>
<div class="listingblock">
<div class="title">Example class for the box office scenario</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = executor.newDataSource( "persons" );
DataSource&lt;BoxOffice&gt; boxOffices = executor.newDataSource( "boxOffices" );
DataSource&lt;AdultTicket&gt; tickets = executor.newDataSource( "tickets" );

List&lt;String&gt; list = new ArrayList&lt;&gt;();
executor.bindVariable( "results", list );

// Two box offices are open:
BoxOffice office1 = new BoxOffice(true);
FactHandle officeFH1 = boxOffices.insert( office1 );
BoxOffice office2 = new BoxOffice(true);
FactHandle officeFH2 = boxOffices.insert( office2 );

persons.insert(new Person("John", 40));

// Execute `BoxOfficeIsOpen` rule, run `TicketIssuerUnit` rule unit, and execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "John", list.get(0) );
list.clear();

persons.insert(new Person("Matteo", 30));

// Execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Matteo", list.get(0) );
list.clear();

// One box office is closed, the other is open:
office1.setOpen(false);
boxOffices.update(officeFH1, office1);
persons.insert(new Person("Mark", 35));
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Mark", list.get(0) );
list.clear();

// All box offices are closed:
office2.setOpen(false);
boxOffices.update(officeFH2, office2); // Guarding rule is no longer true.
persons.insert(new Person("Edson", 35));
executor.run(BoxOfficeUnit.class); // No execution

assertEquals( 0, list.size() );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_identity_conflicts"><a class="anchor" href="#_rule_unit_identity_conflicts"></a><a class="link" href="#_rule_unit_identity_conflicts">3.3.7.3. Rule unit identity conflicts</a></h5>
<div class="paragraph">
<p>In rule unit execution scenarios with guarded rule units, a rule can guard multiple rule units and at the same time a rule unit can be guarded and then activated by multiple rules. For these two-way guarding scenarios, rule units must have a clearly defined identity to avoid identity conflicts.</p>
</div>
<div class="paragraph">
<p>By default, the identity of a rule unit is the rule unit class name and is treated as a singleton class by the <code>RuleUnitExecutor</code>. This identification behavior is encoded in the <code>getUnitIdentity()</code> default method of the <code>RuleUnit</code> interface:</p>
</div>
<div class="listingblock">
<div class="title">Default identity method in the <code>RuleUnit</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">default Identity getUnitIdentity() {
    return new Identity( getClass() );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In some cases, you may need to override this default identification behavior to avoid conflicting identities between rule units.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>RuleUnit</code> class contains a <code>DataSource</code> definition that accepts any kind of object:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>Unit0</code> rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Unit0 implements RuleUnit {
    private DataSource&lt;Object&gt; input;

    public DataSource&lt;Object&gt; getInput() {
        return input;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule unit contains the following DRL rule that guards another rule unit based on two conditions (in OOPath notation):</p>
</div>
<div class="listingblock">
<div class="title">Example <code>GuardAgeCheck</code> DRL rule in the rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit Unit0

rule GuardAgeCheck
  when
    $i: /input#Integer
    $s: /input#String
  then
    drools.guard( new AgeCheckUnit($i) );
    drools.guard( new AgeCheckUnit($s.length()) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The guarded <code>AgeCheckUnit</code> rule unit verifies the age of a set of <code>persons</code>. The <code>AgeCheckUnit</code> contains a <code>DataSource</code> definition of the <code>persons</code> to check, a <code>minAge</code> variable that it verifies against, and a <code>List</code> for gathering the results:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>AgeCheckUnit</code> rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {
    private final int minAge;
    private DataSource&lt;Person&gt; persons;
    private List&lt;String&gt; results;

    public AgeCheckUnit( int minAge ) {
        this.minAge = minAge;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public int getMinAge() {
        return minAge;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AgeCheckUnit</code> rule unit contains the following DRL rule that performs the verification of the <code>persons</code> in the data source:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>CheckAge</code> DRL rule in the rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AgeCheckUnit

rule CheckAge
  when
    $p : /persons{ age &gt; minAge }
  then
    results.add($p.getName() + "&gt;" + minAge);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example creates a <code>RuleUnitExecutor</code> class, binds the class to the KIE base that contains these two rule units, and creates
the two <code>DataSource</code> definitions for the same rule units:</p>
</div>
<div class="listingblock">
<div class="title">Example executor and data source definitions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

DataSource&lt;Object&gt; input = executor.newDataSource( "input" );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Sally", 4 ) );

List&lt;String&gt; results = new ArrayList&lt;&gt;();
executor.bindVariable( "results", results );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now insert some objects into the input data source and execute the <code>Unit0</code> rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution with inserted objects</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ds.insert("test");
ds.insert(3);
ds.insert(4);
executor.run(Unit0.class);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example results list from the execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule unit named <code>AgeCheckUnit</code> is considered a singleton class and then executed only once, with the <code>minAge</code>
variable set to <code>3</code>. Both the String <code>"test"</code> and the Integer <code>4</code> inserted into the input data source can also trigger a second execution with the <code>minAge</code> variable set to <code>4</code>. However, the second execution does not occur because another rule unit with the same identity has already been evaluated.</p>
</div>
<div class="paragraph">
<p>To resolve this rule unit identity conflict, override the <code>getUnitIdentity()</code> method in the <code>AgeCheckUnit</code> class to include also the <code>minAge</code> variable in the rule unit identity:</p>
</div>
<div class="listingblock">
<div class="title">Modified <code>AgeCheckUnit</code> rule unit to override the <code>getUnitIdentity()</code> method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {

    ...

    @Override
    public Identity getUnitIdentity() {
        return new Identity(getClass(), minAge);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this override in place, the previous example rule unit execution produces the following output:</p>
</div>
<div class="listingblock">
<div class="title">Example results list from executing the modified rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[John&gt;4, Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule units with <code>minAge</code> set to <code>3</code> and <code>4</code> are now considered two different rule units and both are executed.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="phreak-algorithm-con_decision-engine"><a class="anchor" href="#phreak-algorithm-con_decision-engine"></a><a class="link" href="#phreak-algorithm-con_decision-engine">3.4. Phreak rule algorithm in the Drools engine</a></h3>
<div class="paragraph">
<p>The Drools engine in Drools uses the Phreak algorithm for rule evaluation. Phreak evolved from the Rete algorithm, including the enhanced Rete algorithm ReteOO that was introduced in previous versions of Drools for object-oriented systems. Overall, Phreak is more scalable than Rete and ReteOO, and is faster in large systems.</p>
</div>
<div class="paragraph">
<p>While Rete is considered eager (immediate rule evaluation) and data oriented, Phreak is considered lazy (delayed rule evaluation) and goal oriented. The Rete algorithm performs many actions during the insert, update, and delete actions in order to find partial matches for all rules. This eagerness of the Rete algorithm during rule matching requires a lot of time before eventually executing rules, especially in large systems. With Phreak, this partial matching of rules is delayed deliberately to handle large amounts of data more efficiently.</p>
</div>
<div class="paragraph">
<p>The Phreak algorithm adds the following set of enhancements to previous Rete algorithms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Three layers of contextual memory: Node, segment, and rule memory types</p>
</li>
<li>
<p>Rule-based, segment-based, and node-based linking</p>
</li>
<li>
<p>Lazy (delayed) rule evaluation</p>
</li>
<li>
<p>Stack-based evaluations with pause and resume</p>
</li>
<li>
<p>Isolated rule evaluation</p>
</li>
<li>
<p>Set-oriented propagations</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="phreak-rule-evaluation-con_decision-engine"><a class="anchor" href="#phreak-rule-evaluation-con_decision-engine"></a><a class="link" href="#phreak-rule-evaluation-con_decision-engine">3.4.1. Rule evaluation in Phreak</a></h4>
<div class="paragraph">
<p>When the Drools engine starts, all rules are considered to be <em>unlinked</em> from pattern-matching data that can trigger the rules. At this stage, the Phreak algorithm in the Drools engine does not evaluate the rules. The <code>insert</code>, <code>update</code>, and <code>delete</code> actions are queued, and Phreak uses a heuristic, based on the rule most likely to result in execution, to calculate and select the next rule for evaluation. When all the required input values are populated for a rule, the rule is considered to be <em>linked</em> to the relevant pattern-matching data. Phreak then creates a goal that represents this rule and places the goal into a priority queue that is ordered by rule salience. Only the rule for which the goal was created is evaluated, and other potential rule evaluations are delayed. While individual rules are evaluated, node sharing is still achieved through the process of segmentation.</p>
</div>
<div class="paragraph">
<p>Unlike the tuple-oriented Rete, the Phreak propagation is collection oriented. For the rule that is being evaluated, the Drools engine accesses the first node and processes all queued insert, update, and delete actions. The results are added to a set, and the set is propagated to the child node. In the child node, all queued insert, update, and delete actions are processed, adding the results to the same set. The set is then propagated to the next child node and the same process repeats until it reaches the terminal node. This cycle creates a batch process effect that can provide performance advantages for certain rule constructs.</p>
</div>
<div class="paragraph">
<p>The linking and unlinking of rules happens through a layered bit-mask system, based on network segmentation. When the rule network is built, segments are created for rule network nodes that are shared by the same set of rules. A rule is composed of a path of segments. In case a rule does not share any node with any other rule, it becomes a single segment.</p>
</div>
<div class="paragraph">
<p>A bit-mask offset is assigned to each node in the segment. Another bit mask is assigned to each segment in the path of the rule according to these requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If at least one input for a node exists, the node bit is set to the <code>on</code> state.</p>
</li>
<li>
<p>If each node in a segment has the bit set to the <code>on</code> state, the segment bit is also set to the <code>on</code> state.</p>
</li>
<li>
<p>If any node bit is set to the <code>off</code> state, the segment is also set to the <code>off</code> state.</p>
</li>
<li>
<p>If each segment in the path of the rule is set to the <code>on</code> state, the rule is considered linked, and a goal is created to schedule the rule for evaluation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same bit-mask technique is used to track modified nodes, segments, and rules. This tracking ability enables an already linked rule to be unscheduled from evaluation if it has been modified since the evaluation goal for it was created. As a result, no rules can ever evaluate partial matches.</p>
</div>
<div class="paragraph">
<p>This process of rule evaluation is possible in Phreak because, as opposed to a single unit of memory in Rete, Phreak has three layers of contextual memory with node, segment, and rule memory types. This layering enables much more contextual understanding during the evaluation of a rule.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/LayeredMemory.png" alt="LayeredMemory">
</div>
<div class="title">Figure 36. Phreak three-layered memory system</div>
</div>
<div class="paragraph">
<p>The following examples illustrate how rules are organized and evaluated in this three-layered memory system in Phreak.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> A single rule (R1) with three patterns: A, B and C. The rule forms a single segment, with bits 1, 2, and 4 for the nodes. The single segment has a bit offset of 1.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/segment1.png" alt="segment1">
</div>
<div class="title">Figure 37. Example 1: Single rule</div>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> Rule R2 is added and shares pattern A.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/segment2.png" alt="segment2">
</div>
<div class="title">Figure 38. Example 2: Two rules with pattern sharing</div>
</div>
<div class="paragraph">
<p>Pattern A is placed in its own segment, resulting in two segments for each rule. Those two segments form a path for their respective rules. The first segment is shared by both paths. When pattern A is linked, the segment becomes linked. The segment then iterates over each path that the segment is shared by, setting the bit 1 to <code>on</code>. If patterns B and C are later turned on, the second segment for path R1 is linked, and this causes bit 2 to be turned on for R1. With bit 1 and bit 2 turned on for R1, the rule is now linked and a goal is created to schedule the rule for later evaluation and execution.</p>
</div>
<div class="paragraph">
<p>When a rule is evaluated, the segments enable the results of the matching to be shared. Each segment has a staging memory to queue all inserts, updates, and deletes for that segment. When R1 is evaluated, the rule processes pattern A, and this results in a set of tuples. The algorithm detects a segmentation split, creates peered tuples for each insert, update, and delete in the set, and adds them to the R2 staging memory. Those tuples are then merged with any existing staged tuples and are executed when R2 is eventually evaluated.</p>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong> Rules R3 and R4 are added and share patterns A and B.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/segment3.png" alt="segment3">
</div>
<div class="title">Figure 39. Example 3: Three rules with pattern sharing</div>
</div>
<div class="paragraph">
<p>Rules R3 and R4 have three segments and R1 has two segments. Patterns A and B are shared by R1, R3, and R4, while pattern D is shared by R3 and R4.</p>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong> A single rule (R1) with a subnetwork and no pattern sharing.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/segment4.png" alt="segment4">
</div>
<div class="title">Figure 40. Example 4: Single rule with a subnetwork and no pattern sharing</div>
</div>
<div class="paragraph">
<p>Subnetworks are formed when a <code>Not</code>, <code>Exists</code>, or <code>Accumulate</code> node contains more than one element. In this example, the element <code>B not( C )</code> forms the subnetwork. The element <code>not( C )</code> is a single element that does not require a subnetwork and is therefore merged inside of the <code>Not</code> node. The subnetwork uses a dedicated segment. Rule R1 still has a path of two segments and the subnetwork forms another inner path. When the subnetwork is linked, it is also linked in the outer segment.</p>
</div>
<div class="paragraph">
<p><strong>Example 5:</strong> Rule R1 with a subnetwork that is shared by rule R2.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./HybridReasoning/segment5.png" alt="segment5">
</div>
<div class="title">Figure 41. Example 5: Two rules, one with a subnetwork and pattern sharing</div>
</div>
<div class="paragraph">
<p>The subnetwork nodes in a rule can be shared by another rule that does not have a subnetwork. This sharing causes the subnetwork segment to be split into two segments.</p>
</div>
<div class="paragraph">
<p>Constrained <code>Not</code> nodes and <code>Accumulate</code> nodes can never unlink a segment, and are always considered to have their bits turned on.</p>
</div>
<div class="paragraph">
<p>The Phreak evaluation algorithm is stack based instead of method-recursion based. Rule evaluation can be paused and resumed at any time when a <code>StackEntry</code> is used to represent the node currently being evaluated.</p>
</div>
<div class="paragraph">
<p>When a rule evaluation reaches a subnetwork, a <code>StackEntry</code> object is created for the outer path segment and the subnetwork segment. The subnetwork segment is evaluated first, and when the set reaches the end of the subnetwork path, the segment is merged into a staging list for the outer node that the segment feeds into. The previous <code>StackEntry</code> object is then resumed and can now process the results of the subnetwork. This process has the added benefit, especially for <code>Accumulate</code> nodes, that all work is completed in a batch, before propagating to the child node.</p>
</div>
<div class="paragraph">
<p>The same stack system is used for efficient backward chaining. When a rule evaluation reaches a query node, the evaluation is paused and the query is added to the stack. The query is then evaluated to produce a result set, which is saved in a memory location for the resumed <code>StackEntry</code> object to pick up and propagate to the child node. If the query itself called other queries, the process repeats, while the current query is paused and a new evaluation is set up for the current query node.</p>
</div>
<div class="sect4">
<h5 id="forward-and-backward-chaining-con_decision-engine"><a class="anchor" href="#forward-and-backward-chaining-con_decision-engine"></a><a class="link" href="#forward-and-backward-chaining-con_decision-engine">3.4.1.1. Rule evaluation with forward and backward chaining</a></h5>
<div class="paragraph">
<p>The Drools engine in Drools is a hybrid reasoning system that uses both forward chaining and backward chaining to evaluate rules. A forward-chaining rule system is a data-driven system that starts with a fact in the working memory of the Drools engine and reacts to changes to that fact. When objects are inserted into working memory, any rule conditions that become true as a result of the change are scheduled for execution by the agenda.</p>
</div>
<div class="paragraph">
<p>In contrast, a backward-chaining rule system is a goal-driven system that starts with a conclusion that the Drools engine attempts to satisfy, often using recursion. If the system cannot reach the conclusion or goal, it searches for subgoals, which are conclusions that complete part of the current goal. The system continues this process until either the initial conclusion is satisfied or all subgoals are satisfied.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates how the Drools engine evaluates rules using forward chaining overall with a backward-chaining segment in the logic flow:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/BackwardChaining/RuleEvaluation.png" alt="RuleEvaluation">
</div>
<div class="title">Figure 42. Rule evaluation logic using forward and backward chaining</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rule-base-configuration-con_decision-engine"><a class="anchor" href="#rule-base-configuration-con_decision-engine"></a><a class="link" href="#rule-base-configuration-con_decision-engine">3.4.2. Rule base configuration</a></h4>
<div class="paragraph">
<p>Drools contains a <code>RuleBaseConfiguration.java</code> object that you can use to configure exception handler settings, multithreaded execution, and sequential mode in the Drools engine.</p>
</div>
<div class="paragraph">
<p>For the rule base configuration options,
see the Drools <a href="https://github.com/kiegroup/drools/blob/7.26.x/drools-core/src/main/java/org/drools/core/RuleBaseConfiguration.java">RuleBaseConfiguration.java</a> page on GitHub.</p>
</div>
<div class="paragraph">
<p>The following rule base configuration options are available for the Drools engine:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">drools.consequenceExceptionHandler</dt>
<dd>
<p>When configured, this system property defines the class that manages the exceptions thrown by rule consequences. You can use this property to specify a custom exception handler for rule evaluation in the Drools engine.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default value: <code>org.drools.core.runtime.rule.impl.DefaultConsequenceExceptionHandler</code></p>
</div>
<div class="paragraph">
<p>You can specify the custom exception handler using one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the exception handler in a system property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.consequenceExceptionHandler=org.drools.core.runtime.rule.impl.MyCustomConsequenceExceptionHandler</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the exception handler while creating the KIE base programmatically:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration(); kieBaseConf.setOption(ConsequenceExceptionHandlerOption.get(MyCustomConsequenceExceptionHandler.class));
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">drools.multithreadEvaluation</dt>
<dd>
<p>When enabled, this system property enables the Drools engine to evaluate rules in parallel by dividing the Phreak rule network into independent partitions. You can use this property to increase the speed of rule evaluation for specific rule bases.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default value: <code>false</code></p>
</div>
<div class="paragraph">
<p>You can enable multithreaded evaluation using one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable the multithreaded evaluation system property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.multithreadEvaluation=true</code></pre>
</div>
</div>
</li>
<li>
<p>Enable multithreaded evaluation while creating the KIE base programmatically:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(MultithreadEvaluationOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rules that use queries, salience, or agenda groups are currently not supported by the parallel Drools engine. If these rule elements are present in the KIE base, the compiler emits a warning and automatically switches back to single-threaded evaluation. However, in some cases, the Drools engine might not detect the unsupported rule elements and rules might be evaluated incorrectly. For example, the Drools engine might not detect when rules rely on implicit salience given by rule ordering inside the DRL file, resulting in incorrect evaluation due to the unsupported salience attribute.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">drools.sequential</dt>
<dd>
<p>When enabled, this system property enables sequential mode in the Drools engine. In sequential mode, the Drools engine evaluates rules one time in the order that they are listed in the Drools engine agenda without regard to changes in the working memory. This means that the Drools engine ignores any <code>insert</code>, <code>modify</code>, or <code>update</code> statements in rules and executes rules in a single sequence. As a result, rule execution may be faster in sequential mode, but important updates may not be applied to your rules. You can use this property if you use stateless KIE sessions and you do not want the execution of rules to influence subsequent rules in the agenda. Sequential mode applies to stateless KIE sessions only.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default value: <code>false</code></p>
</div>
<div class="paragraph">
<p>You can enable sequential mode using one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable the sequential mode system property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.sequential=true</code></pre>
</div>
</div>
</li>
<li>
<p>Enable sequential mode while creating the KIE base programmatically:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(SequentialOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>Enable sequential mode in the KIE module descriptor file (<code>kmodule.xml</code>) for a specific Drools project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" sequential="true" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="phreak-sequential-mode-con_decision-engine"><a class="anchor" href="#phreak-sequential-mode-con_decision-engine"></a><a class="link" href="#phreak-sequential-mode-con_decision-engine">3.4.3. Sequential mode in Phreak</a></h4>
<div class="paragraph">
<p>Sequential mode is an advanced rule base configuration in the Drools engine, supported by Phreak, that enables the Drools engine to evaluate rules one time in the order that they are listed in the Drools engine agenda without regard to changes in the working memory. In sequential mode, the Drools engine ignores any <code>insert</code>, <code>modify</code>, or <code>update</code> statements in rules and executes rules in a single sequence. As a result, rule execution may be faster in sequential mode, but important updates may not be applied to your rules.</p>
</div>
<div class="paragraph">
<p>Sequential mode applies to only stateless KIE sessions because stateful KIE sessions inherently use data from previously invoked KIE sessions. If you use a stateless KIE session and you want the execution of rules to influence subsequent rules in the agenda, then do not enable sequential mode. Sequential mode is disabled by default in the Drools engine.</p>
</div>
<div class="paragraph">
<p>To enable sequential mode, use one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the system property <code>drools.sequential</code> to <code>true</code>.</p>
</li>
<li>
<p>Enable sequential mode while creating the KIE base programmatically:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(SequentialOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>Enable sequential mode in the KIE module descriptor file (<code>kmodule.xml</code>) for a specific Drools project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" sequential="true" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure sequential mode to use a dynamic agenda, use one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the system property <code>drools.sequential.agenda</code> to <code>dynamic</code>.</p>
</li>
<li>
<p>Set the sequential agenda option while creating the KIE base programmatically:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(SequentialAgendaOption.DYNAMIC);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you enable sequential mode, the Drools engine evaluates rules in the following way:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Rules are ordered by salience and position in the rule set.</p>
</li>
<li>
<p>An element for each possible rule match is created. The element position indicates the execution order.</p>
</li>
<li>
<p>Node memory is disabled, with the exception of the right-input object memory.</p>
</li>
<li>
<p>The left-input adapter node propagation is disconnected and the object with the node is referenced in a <code>Command</code> object. The <code>Command</code> object is added to a list in the working memory for later execution.</p>
</li>
<li>
<p>All objects are asserted, and then the list of <code>Command</code> objects is checked and executed.</p>
</li>
<li>
<p>All matches that result from executing the list are added to elements based on the sequence number of the rule.</p>
</li>
<li>
<p>The elements that contain matches are executed in a sequence. If you set a maximum number of rule executions, the Drools engine activates no more than that number of rules in the agenda for execution.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In sequential mode, the <code>LeftInputAdapterNode</code> node creates a <code>Command</code> object and adds it to a list in the working memory of the Drools engine. This <code>Command</code> object contains references to the <code>LeftInputAdapterNode</code> node and the propagated object. These references stop any left-input propagations at insertion time so that the right-input propagation never needs to attempt to join the left inputs. The references also avoid the need for the left-input memory.</p>
</div>
<div class="paragraph">
<p>All nodes have their memory turned off, including the left-input tuple memory, but excluding the right-input object memory. After all the assertions are finished and the right-input memory of all the objects is populated, the Drools engine iterates over the list of <code>LeftInputAdatperNode</code> <code>Command</code> objects. The objects propagate down the network, attempting to join the right-input objects, but they are not retained in the left input.</p>
</div>
<div class="paragraph">
<p>The agenda with a priority queue to schedule the tuples is replaced by an element for each rule. The sequence number of the <code>RuleTerminalNode</code> node indicates the element where to place the match. After all <code>Command</code> objects have finished, the elements are checked and existing matches are executed. To improve performance, the first and the last populated cell in the elements are retained.</p>
</div>
<div class="paragraph">
<p>When the network is constructed, each <code>RuleTerminalNode</code> node receives a sequence number based on its salience number and the order in which it was added to the network.</p>
</div>
<div class="paragraph">
<p>The right-input node memories are typically hash maps for fast object deletion. Because object deletions are not supported, Phreak uses an object list when the values of the object are not indexed. For a large number of objects, indexed hash maps provide a performance increase. If an object has only a few instances, Phreak uses an object list instead of an index.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cep-con_decision-engine"><a class="anchor" href="#cep-con_decision-engine"></a><a class="link" href="#cep-con_decision-engine">3.5. Complex event processing (CEP)</a></h3>
<div class="paragraph">
<p>In Drools, an event is a record of a significant change of state in the application domain at a point in time. Depending on how the domain is modeled, the change of state may be represented by a single event, multiple atomic events, or hierarchies of correlated events. From a complex event processing (CEP) perspective, an event is a type of fact or object that occurs at a specific point in time, and a business rule is a definition of how to react to the data from that fact or object. For example, in a stock broker application, a change in security prices, a change in ownership from seller to buyer, or a change in an account holder&#8217;s balance are all considered to be events because a change has occurred in the state of the application domain at a given time.</p>
</div>
<div class="paragraph">
<p>The Drools engine in Drools uses complex event processing (CEP) to detect and process multiple events within a collection of events, to uncover relationships that exist between events, and to infer new data from the events and their relationships.</p>
</div>
<div class="paragraph">
<p>CEP use cases share several requirements and goals with business rule use cases.</p>
</div>
<div class="paragraph">
<p>From a business perspective, business rule definitions are often defined based on the occurrence of scenarios triggered by events. In the following examples, events form the basis of business rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In an algorithmic trading application, a rule performs an action if the security price increases by X percent above the day opening price. The price increases are denoted by events on a stock trading application.</p>
</li>
<li>
<p>In a monitoring application, a rule performs an action if the temperature in the server room increases X degrees in Y minutes. The sensor readings are denoted by events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From a technical perspective, business rule evaluation and CEP have the following key similarities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Both business rule evaluation and CEP require seamless integration with the enterprise infrastructure and applications. This is particularly important with life-cycle management, auditing, and security.</p>
</li>
<li>
<p>Both business rule evaluation and CEP have functional requirements such as pattern matching, and non-functional requirements such as response time limits and query-rule explanations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CEP scenarios have the following key characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scenarios usually process large numbers of events, but only a small percentage of the events are relevant.</p>
</li>
<li>
<p>Events are usually immutable and represent a record of change in state.</p>
</li>
<li>
<p>Rules and queries run against events and must react to detected event patterns.</p>
</li>
<li>
<p>Related events usually have a strong temporal relationship.</p>
</li>
<li>
<p>Individual events are not prioritized. The CEP system prioritizes patterns of related events and the relationships between them.</p>
</li>
<li>
<p>Events usually need to be composed and aggregated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given these common CEP scenario characteristics, the CEP system in Drools supports the following features and functions to optimize event processing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Event processing with proper semantics</p>
</li>
<li>
<p>Event detection, correlation, aggregation, and composition</p>
</li>
<li>
<p>Event stream processing</p>
</li>
<li>
<p>Temporal constraints to model the temporal relationships between events</p>
</li>
<li>
<p>Sliding windows of significant events</p>
</li>
<li>
<p>Session-scoped unified clock</p>
</li>
<li>
<p>Required volumes of events for CEP use cases</p>
</li>
<li>
<p>Reactive rules</p>
</li>
<li>
<p>Adapters for event input into the Drools engine (pipeline)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="cep-events-con_decision-engine"><a class="anchor" href="#cep-events-con_decision-engine"></a><a class="link" href="#cep-events-con_decision-engine">3.5.1. Events in complex event processing</a></h4>
<div class="paragraph">
<p>In Drools, an event is a record of a significant change of state in the application domain at a point in time. Depending on how the domain is modeled, the change of state may be represented by a single event, multiple atomic events, or hierarchies of correlated events. From a complex event processing (CEP) perspective, an event is a type of fact or object that occurs at a specific point in time, and a business rule is a definition of how to react to the data from that fact or object. For example, in a stock broker application, a change in security prices, a change in ownership from seller to buyer, or a change in an account holder&#8217;s balance are all considered to be events because a change has occurred in the state of the application domain at a given time.</p>
</div>
<div class="paragraph">
<p>Events have the following key characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Are immutable:</strong> An event is a record of change that has occurred at some time in the past and cannot be changed.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Drools engine does not enforce immutability on the Java objects that represent events. This behavior makes event data enrichment possible. Your application should be able to populate unpopulated event attributes, and these attributes are used by the Drools engine to enrich the event with inferred data. However, you should not change event attributes that have already been populated.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Have strong temporal constraints:</strong> Rules involving events usually require the correlation of multiple events that occur at different points in time relative to each other.</p>
</li>
<li>
<p><strong>Have managed life cycles:</strong> Because events are immutable and have temporal constraints, they are usually only relevant for a specified period of time. This means that the Drools engine can automatically manage the life cycle of events.</p>
</li>
<li>
<p><strong>Can use sliding windows:</strong> You can define sliding windows of time or length with events. A sliding time window is a specified period of time during which events can be processed. A sliding length window is a specified number of events that can be processed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cep-events-proc_decision-engine"><a class="anchor" href="#cep-events-proc_decision-engine"></a><a class="link" href="#cep-events-proc_decision-engine">3.5.2. Declaring facts as events</a></h4>
<div class="paragraph">
<p>You can declare facts as events in your Java class or DRL rule file so that the Drools engine handles the facts as events during complex event processing. You can declare the facts as interval-based events or point-in-time events. Interval-based events have a duration time and persist in the working memory of the Drools engine until their duration time has lapsed. Point-in-time events have no duration and are essentially interval-based events with a duration of zero.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>For the relevant fact type in your Java class or DRL rule file, enter the <code>@role( event )</code> metadata tag and parameter. The <code>@role</code> metadata tag accepts the following two values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fact</code>: (Default) Declares the type as a regular fact</p>
</li>
<li>
<p><code>event</code>: Declares the type as an event</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following snippet declares that the <code>StockPoint</code> fact type in a stock broker application must be handled as an event:</p>
</div>
<div class="listingblock">
<div class="title">Declare fact type as an event</div>
<div class="content">
<pre class="highlightjs highlight"><code>import some.package.StockPoint

declare StockPoint
  @role( event )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>StockPoint</code> is a fact type declared in the DRL rule file instead of in a pre-existing class, you can declare the event in-line in your application code:</p>
</div>
<div class="listingblock">
<div class="title">Declare fact type in-line and assign it to event role</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare StockPoint
  @role( event )

  datetime : java.util.Date
  symbol : String
  price : double
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-declarations-metadata-tags-ref_decision-engine"><a class="anchor" href="#drl-declarations-metadata-tags-ref_decision-engine"></a><a class="link" href="#drl-declarations-metadata-tags-ref_decision-engine">3.5.3. Metadata tags for events</a></h4>
<div class="paragraph">
<p>The Drools engine uses the following metadata tags for events that are inserted into the working memory of the Drools engine. You can change the default metadata tag values in your Java class or DRL rule file as needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The examples in this section that refer to the <code>VoiceCall</code> class assume that the sample application domain model includes the following class details:</p>
</div>
<div class="listingblock">
<div class="title">VoiceCall fact class in an example Telecom domain model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class VoiceCall {
  private String  originNumber;
  private String  destinationNumber;
  private Date    callDateTime;
  private long    callDuration;  // in milliseconds

  // Constructors, getters, and setters
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@role</dt>
<dd>
<p>This tag determines whether a given fact type is handled as a regular fact or an event in the Drools engine during complex event processing.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: <code>fact</code></p>
</div>
<div class="paragraph">
<p>Supported parameters: <code>fact</code>, <code>event</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@role( fact | event )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall as event type</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@timestamp</dt>
<dd>
<p>This tag is automatically assigned to every event in the Drools engine. By default, the time is provided by the session clock and assigned to the event when it is inserted into the working memory of the Drools engine. You can specify a custom time stamp attribute instead of the default time stamp added by the session clock.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: The time added by the Drools engine session clock</p>
</div>
<div class="paragraph">
<p>Supported parameters: Session clock time or custom time stamp attribute</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@timestamp( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall timestamp attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@duration</dt>
<dd>
<p>This tag determines the duration time for events in the Drools engine. Events can be interval-based events or point-in-time events. Interval-based events have a duration time and persist in the working memory of the Drools engine until their duration time has lapsed. Point-in-time events have no duration and are essentially interval-based events with a duration of zero. By default, every event in the Drools engine has a duration of zero. You can specify a custom duration attribute instead of the default.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null (zero)</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom duration attribute</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@duration( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall duration attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@expires</dt>
<dd>
<p>This tag determines the time duration before an event expires in the working memory of the Drools engine. By default, an event expires when the event can no longer match and activate any of the current rules. You can define an amount of time after which an event should expire. This tag definition also overrides the implicit expiration offset calculated from temporal constraints and sliding windows in the KIE base. This tag is available only when the Drools engine is running in stream mode.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null (event expires after event can no longer match and activate rules)</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom <code>timeOffset</code> attribute in the format <code>[<mark>#d][#h][#m][#s][</mark>[ms]]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@expires( &lt;timeOffset&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare expiration offset for VoiceCall events</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
  @expires( 1h35m )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="cep-modes-con_decision-engine"><a class="anchor" href="#cep-modes-con_decision-engine"></a><a class="link" href="#cep-modes-con_decision-engine">3.5.4. Event processing modes in the Drools engine</a></h4>
<div class="paragraph">
<p>The Drools engine runs in either cloud mode or stream mode. In cloud mode, the Drools engine processes facts as facts with no temporal constraints, independent of time, and in no particular order. In stream mode, the Drools engine processes facts as events with strong temporal constraints, in real time or near real time. Stream mode uses synchronization to make event processing possible in Drools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cloud mode</dt>
<dd>
<p>Cloud mode is the default operating mode of the Drools engine. In cloud mode, the Drools engine treats events as an unordered cloud. Events still have time stamps, but the Drools engine running in cloud mode cannot draw relevance from the time stamp because cloud mode ignores the present time. This mode uses the rule constraints to find the matching tuples to activate and execute rules.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Cloud mode does not impose any kind of additional requirements on facts. However, because the Drools engine in this mode has no concept of time, it cannot use temporal features such as sliding windows or automatic life-cycle management. In cloud mode, events must be explicitly retracted when they are no longer needed.</p>
</div>
<div class="paragraph">
<p>The following requirements are not imposed in cloud mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No clock synchronization because the Drools engine has no notion of time</p>
</li>
<li>
<p>No ordering of events because the Drools engine processes events as an unordered cloud, against which the Drools engine match rules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify cloud mode either by setting the system property in the relevant configuration files or by using the Java client API:</p>
</div>
<div class="listingblock">
<div class="title">Set cloud mode using system property</div>
<div class="content">
<pre class="highlightjs highlight"><code>drools.eventProcessingMode=cloud</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Set cloud mode using Java client API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.conf.EventProcessingOption;
import org.kie.api.KieBaseConfiguration;
import org.kie.api.KieServices.Factory;

KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();

config.setOption(EventProcessingOption.CLOUD);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify cloud mode using the <code>eventProcessingMode="&lt;mode&gt;"</code> KIE base attribute in the KIE module descriptor file (<code>kmodule.xml</code>) for a specific Drools project:</p>
</div>
<div class="listingblock">
<div class="title">Set cloud mode using project <code>kmodule.xml</code> file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" eventProcessingMode="cloud" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Stream mode</dt>
<dd>
<p>Stream mode enables the Drools engine to process events chronologically and in real time as they are inserted into the Drools engine. In stream mode, the Drools engine synchronizes streams of events (so that events in different streams can be processed in chronological order), implements sliding windows of time or length, and enables automatic life-cycle management.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The following requirements apply to stream mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Events in each stream must be ordered chronologically.</p>
</li>
<li>
<p>A session clock must be present to synchronize event streams.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Your application does not need to enforce ordering events between streams, but using event streams that have not been synchronized may cause unexpected results.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can specify stream mode either by setting the system property in the relevant configuration files or by using the Java client API:</p>
</div>
<div class="listingblock">
<div class="title">Set stream mode using system property</div>
<div class="content">
<pre class="highlightjs highlight"><code>drools.eventProcessingMode=stream</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Set stream mode using Java client API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.conf.EventProcessingOption;
import org.kie.api.KieBaseConfiguration;
import org.kie.api.KieServices.Factory;

KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();

config.setOption(EventProcessingOption.STREAM);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify stream mode using the <code>eventProcessingMode="&lt;mode&gt;"</code> KIE base attribute in the KIE module descriptor file (<code>kmodule.xml</code>) for a specific Drools project:</p>
</div>
<div class="listingblock">
<div class="title">Set stream mode using project <code>kmodule.xml</code> file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" eventProcessingMode="stream" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="cep-negative-patterns_decision-engine"><a class="anchor" href="#cep-negative-patterns_decision-engine"></a><a class="link" href="#cep-negative-patterns_decision-engine">3.5.4.1. Negative patterns in Drools engine stream mode</a></h5>
<div class="paragraph">
<p>A negative pattern is a pattern for conditions that are not met. For example, the following DRL rule activates a fire alarm if a fire is detected and the sprinkler is not activated:</p>
</div>
<div class="listingblock">
<div class="title">Fire alarm rule with a negative pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm"
when
  $f : FireDetected()
  not(SprinklerActivated())
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In cloud mode, the Drools engine assumes all facts (regular facts and events) are known in advance and evaluates negative patterns immediately. In stream mode, the Drools engine can support temporal constraints on facts to wait for a set time before activating a rule.</p>
</div>
<div class="paragraph">
<p>The same example rule in stream mode activates the fire alarm as usual, but applies a 10-second delay.</p>
</div>
<div class="listingblock">
<div class="title">Fire alarm rule with a negative pattern and time delay (stream mode only)</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm"
when
  $f : FireDetected()
  not(SprinklerActivated(this after[0s,10s] $f))
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following modified fire alarm rule expects one <code>Heartbeat</code> event to occur every 10 seconds. If the expected event does not occur, the rule is executed. This rule uses the same type of object in both the first pattern and in the negative pattern. The negative pattern has the temporal constraint to wait 0 to 10 seconds before executing and excludes the <code>Heartbeat</code> event bound to <code>$h</code> so that the rule can be executed. The bound event <code>$h</code> must be explicitly excluded in order for the rule to be executed because the temporal constraint <code>[0s, &#8230;&#8203;]</code> does not inherently exclude that event from being matched again.</p>
</div>
<div class="listingblock">
<div class="title">Fire alarm rule excluding a bound event in a negative pattern (stream mode only)</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm"
when
  $h: Heartbeat() from entry-point "MonitoringStream"
  not(Heartbeat(this != $h, this after[0s,10s] $h) from entry-point "MonitoringStream")
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-change-listeners-con_decision-engine"><a class="anchor" href="#property-change-listeners-con_decision-engine"></a><a class="link" href="#property-change-listeners-con_decision-engine">3.5.5. Property-change settings and listeners for fact types</a></h4>
<div class="paragraph">
<p>By default, the Drools engine does not re-evaluate all fact patterns for fact types each time a rule is triggered, but instead reacts only to modified properties that are constrained or bound inside a given pattern. For example, if a rule calls <code>modify()</code> as part of the rule actions but the action does not generate new data in the KIE base, the Drools engine does not automatically re-evaluate all fact patterns because no data was modified. This property reactivity behavior prevents unwanted recursions in the KIE base and results in more efficient rule evaluation. This behavior also means that you do not always need to use the <code>no-loop</code> rule attribute to avoid infinite recursion.</p>
</div>
<div class="paragraph">
<p>You can modify or disable this property reactivity behavior with the following <code>KnowledgeBuilderConfiguration</code> options, and then use a property-change setting in your Java class or DRL files to fine-tune property reactivity as needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ALWAYS</code>: (Default) All types are property reactive, but you can disable property reactivity for a specific type by using the <code>@classReactive</code> property-change setting.</p>
</li>
<li>
<p><code>ALLOWED</code>: No types are property reactive, but you can enable property reactivity for a specific type by using the <code>@propertyReactive</code> property-change setting.</p>
</li>
<li>
<p><code>DISABLED</code>: No types are property reactive. All property-change listeners are ignored.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example property reactivity setting in KnowledgeBuilderConfiguration</div>
<div class="content">
<pre class="highlightjs highlight"><code>KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
config.setOption(PropertySpecificOption.ALLOWED);
KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can update the <code>drools.propertySpecific</code> system property in the <code>standalone.xml</code> file of your Drools distribution:</p>
</div>
<div class="listingblock">
<div class="title">Example property reactivity setting in system properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  ...
  &lt;property name="drools.propertySpecific" value="ALLOWED"/&gt;
  ...
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Drools engine supports the following property-change settings and listeners for fact classes or declared DRL fact types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@classReactive</dt>
<dd>
<p>If property reactivity is set to <code>ALWAYS</code> in the Drools engine (all types are property reactive), this tag disables the default property reactivity behavior for a specific Java class or a declared DRL fact type. You can use this tag if you want the Drools engine to re-evaluate all fact patterns for the specified fact type each time the rule is triggered, instead of reacting only to modified properties that are constrained or bound inside a given pattern.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example: Disable default property reactivity in a DRL type declaration</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @classReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Disable default property reactivity in a Java class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@classReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyReactive</dt>
<dd>
<p>If property reactivity is set to <code>ALLOWED</code> in the Drools engine (no types are property reactive unless specified), this tag enables property reactivity for a specific Java class or a declared DRL fact type. You can use this tag if you want the Drools engine to react only to modified properties that are constrained or bound inside a given pattern for the specified fact type, instead of re-evaluating all fact patterns for the fact each time the rule is triggered.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example: Enable property reactivity in a DRL type declaration (when reactivity is disabled globally)</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @propertyReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Enable property reactivity in a Java class (when reactivity is disabled globally)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@propertyReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@watch</dt>
<dd>
<p>This tag enables property reactivity for additional properties that you specify in-line in fact patterns in DRL rules. This tag is supported only if property reactivity is set to <code>ALWAYS</code> in the Drools engine, or if property reactivity is set to <code>ALLOWED</code> and the relevant fact type uses the <code>@propertyReactive</code> tag. You can use this tag in DRL rules to add or exclude specific properties in fact property reactivity logic.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: None</p>
</div>
<div class="paragraph">
<p>Supported parameters: Property name, <code>*</code> (all), <code>!</code> (not), <code>!*</code> (no properties)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;factPattern&gt; @watch ( &lt;property&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Enable or disable property reactivity in fact patterns</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Listens for changes in both `firstName` (inferred) and `lastName`:
Person(firstName == $expectedFirstName) @watch( lastName )

// Listens for changes in all properties of the `Person` fact:
Person(firstName == $expectedFirstName) @watch( * )

// Listens for changes in `lastName` and explicitly excludes changes in `firstName`:
Person(firstName == $expectedFirstName) @watch( lastName, !firstName )

// Listens for changes in all properties of the `Person` fact except `age`:
Person(firstName == $expectedFirstName) @watch( *, !age )

// Excludes changes in all properties of the `Person` fact (equivalent to using `@classReactivity` tag):
Person(firstName == $expectedFirstName) @watch( !* )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Drools engine generates a compilation error if you use the <code>@watch</code> tag for properties in a fact type that uses the <code>@classReactive</code> tag (disables property reactivity) or when property reactivity is set to <code>ALLOWED</code> in the Drools engine and the relevant fact type does not use the <code>@propertyReactive</code> tag. Compilation errors also arise if you duplicate properties in listener annotations, such as <code>@watch( firstName, ! firstName )</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyChangeSupport</dt>
<dd>
<p>For facts that implement support for property changes as defined in the <a href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans Specification</a>, this tag enables the Drools engine to monitor changes in the fact properties.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example: Declare property change support in JavaBeans object</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    @propertyChangeSupport
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="cep-temporal-operators_decision-engine"><a class="anchor" href="#cep-temporal-operators_decision-engine"></a><a class="link" href="#cep-temporal-operators_decision-engine">3.5.6. Temporal operators for events</a></h4>
<div class="paragraph">
<p>In stream mode, the Drools engine supports the following temporal operators for events that are inserted into the working memory of the Drools engine. You can use these operators to define the temporal reasoning behavior of the events that you declare in your Java class or DRL rule file. Temporal operators are not supported when the Drools engine is running in cloud mode.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>after</code></p>
</li>
<li>
<p><code>before</code></p>
</li>
<li>
<p><code>coincides</code></p>
</li>
<li>
<p><code>during</code></p>
</li>
<li>
<p><code>includes</code></p>
</li>
<li>
<p><code>finishes</code></p>
</li>
<li>
<p><code>finished by</code></p>
</li>
<li>
<p><code>meets</code></p>
</li>
<li>
<p><code>met by</code></p>
</li>
<li>
<p><code>overlaps</code></p>
</li>
<li>
<p><code>overlapped by</code></p>
</li>
<li>
<p><code>starts</code></p>
</li>
<li>
<p><code>started by</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">after</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This operator specifies if the current event occurs after the correlated event. This operator can also define an amount of time after which the current event can follow the correlated event, or a delimiting time range during which the current event can follow the correlated event.</p>
</div>
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> starts between 3 minutes and 30 seconds and 4 minutes after <code>$eventB</code> finishes. If <code>$eventA</code> starts earlier than 3 minutes and 30 seconds after <code>$eventB</code> finishes, or later than 4 minutes after <code>$eventB</code> finishes, then the pattern is not matched.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this after[3m30s, 4m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>3m30s &lt;= $eventA.startTimestamp - $eventB.endTimeStamp &lt;= 4m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>after</code> operator supports up to two parameter values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If two values are defined, the interval starts on the first value (3 minutes and 30 seconds in the example) and ends on the second value (4 minutes in the example).</p>
</li>
<li>
<p>If only one value is defined, the interval starts on the provided value and runs indefinitely with no end time.</p>
</li>
<li>
<p>If no value is defined, the interval starts at 1 millisecond and runs indefinitely with no end time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>after</code> operator also supports negative time ranges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this after[-3m30s, -2m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the first value is greater than the second value, the Drools engine automatically reverses them. For example, the following two patterns are interpreted by the Drools engine in the same way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this after[-3m30s, -2m] $eventB)
$eventA : EventA(this after[-2m, -3m30s] $eventB)</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">before</dt>
<dd>
<p>This operator specifies if the current event occurs before the correlated event. This operator can also define an amount of time before which the current event can precede the correlated event, or a delimiting time range during which the current event can precede the correlated event.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> finishes between 3 minutes and 30 seconds and 4 minutes before <code>$eventB</code> starts. If <code>$eventA</code> finishes earlier than 3 minutes and 30 seconds before <code>$eventB</code> starts, or later than 4 minutes before <code>$eventB</code> starts, then the pattern is not matched.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this before[3m30s, 4m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>3m30s &lt;= $eventB.startTimestamp - $eventA.endTimeStamp &lt;= 4m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>before</code> operator supports up to two parameter values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If two values are defined, the interval starts on the first value (3 minutes and 30 seconds in the example) and ends on the second value (4 minutes in the example).</p>
</li>
<li>
<p>If only one value is defined, the interval starts on the provided value and runs indefinitely with no end time.</p>
</li>
<li>
<p>If no value is defined, the interval starts at 1 millisecond and runs indefinitely with no end time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>before</code> operator also supports negative time ranges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this before[-3m30s, -2m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the first value is greater than the second value, the Drools engine automatically reverses them. For example, the following two patterns are interpreted by the Drools engine in the same way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this before[-3m30s, -2m] $eventB)
$eventA : EventA(this before[-2m, -3m30s] $eventB)</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">coincides</dt>
<dd>
<p>This operator specifies if the two events occur at the same time, with the same start and end times.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if both the start and end time stamps of <code>$eventA</code> and <code>$eventB</code> are identical:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this coincides $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>coincides</code> operator supports up to two parameter values for the distance between the event start and end times, if they are not identical:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If only one parameter is given, the parameter is used to set the threshold for both the start and end times of both events.</p>
</li>
<li>
<p>If two parameters are given, the first is used as a threshold for the start time and the second is used as a threshold for the end time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following pattern uses start and end time thresholds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this coincides[15s, 10s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pattern matches if the following conditions are met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.startTimestamp) &lt;= 15s
&amp;&amp;
abs($eventA.endTimestamp - $eventB.endTimestamp) &lt;= 10s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Drools engine does not support negative intervals for the <code>coincides</code> operator. If you use negative intervals, the Drools engine generates an error.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">during</dt>
<dd>
<p>This operator specifies if the current event occurs within the time frame of when the correlated event starts and ends. The current event must start after the correlated event starts and must end before the correlated event ends. (With the <code>coincides</code> operator, the start and end times are the same or nearly the same.)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> starts after <code>$eventB</code> starts and ends before <code>$eventB</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this during $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventB.startTimestamp &lt; $eventA.startTimestamp &lt;= $eventA.endTimestamp &lt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>during</code> operator supports one, two, or four optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one value is defined, this value is the maximum distance between the start times of the two events and the maximum distance between the end times of the two events.</p>
</li>
<li>
<p>If two values are defined, these values are a threshold between which the current event start time and end time must occur in relation to the correlated event start and end times.</p>
<div class="paragraph">
<p>For example, if the values are <code>5s</code> and <code>10s</code>, the current event must start between 5 and 10 seconds after the correlated event starts and must end between 5 and 10 seconds before the correlated event ends.</p>
</div>
</li>
<li>
<p>If four values are defined, the first and second values are the minimum and maximum distances between the start times of the events, and the third and fourth values are the minimum and maximum distances between the end times of the two events.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">includes</dt>
<dd>
<p>This operator specifies if the correlated event occurs within the time frame of when the current event occurs. The correlated event must start after the current event starts and must end before the current event ends. (The behavior of this operator is the reverse of the <code>during</code> operator behavior.)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventB</code> starts after <code>$eventA</code> starts and ends before <code>$eventA</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this includes $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp &lt; $eventB.startTimestamp &lt;= $eventB.endTimestamp &lt; $eventA.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>includes</code> operator supports one, two, or four optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one value is defined, this value is the maximum distance between the start times of the two events and the maximum distance between the end times of the two events.</p>
</li>
<li>
<p>If two values are defined, these values are a threshold between which the correlated event start time and end time must occur in relation to the current event start and end times.</p>
<div class="paragraph">
<p>For example, if the values are <code>5s</code> and <code>10s</code>, the correlated event must start between 5 and 10 seconds after the current event starts and must end between 5 and 10 seconds before the current event ends.</p>
</div>
</li>
<li>
<p>If four values are defined, the first and second values are the minimum and maximum distances between the start times of the events, and the third and fourth values are the minimum and maximum distances between the end times of the two events.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">finishes</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This operator specifies if the current event starts after the correlated event but both events end at the same time.</p>
</div>
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> starts after <code>$eventB</code> starts and ends at the same time when <code>$eventB</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishes $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventB.startTimestamp &lt; $eventA.startTimestamp
&amp;&amp;
$eventA.endTimestamp == $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>finishes</code> operator supports one optional parameter that sets the maximum time allowed between the end times of the two events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishes[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pattern matches if these conditions are met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventB.startTimestamp &lt; $eventA.startTimestamp
&amp;&amp;
abs($eventA.endTimestamp - $eventB.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Drools engine does not support negative intervals for the <code>finishes</code> operator. If you use negative intervals, the Drools engine generates an error.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">finished by</dt>
<dd>
<p>This operator specifies if the correlated event starts after the current event but both events end at the same time. (The behavior of this operator is the reverse of the <code>finishes</code> operator behavior.)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventB</code> starts after <code>$eventA</code> starts and ends at the same time when <code>$eventA</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishedby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp &lt; $eventB.startTimestamp
&amp;&amp;
$eventA.endTimestamp == $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>finished by</code> operator supports one optional parameter that sets the maximum time allowed between the end times of the two events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishedby[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pattern matches if these conditions are met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp &lt; $eventB.startTimestamp
&amp;&amp;
abs($eventA.endTimestamp - $eventB.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Drools engine does not support negative intervals for the <code>finished by</code> operator. If you use negative intervals, the Drools engine generates an error.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">meets</dt>
<dd>
<p>This operator specifies if the current event ends at the same time when the correlated event starts.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> ends at the same time when <code>$eventB</code> starts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this meets $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventB.startTimestamp - $eventA.endTimestamp) == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>meets</code> operator supports one optional parameter that sets the maximum time allowed between the end time of the current event and the start time of the correlated event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this meets[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pattern matches if these conditions are met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventB.startTimestamp - $eventA.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Drools engine does not support negative intervals for the <code>meets</code> operator. If you use negative intervals, the Drools engine generates an error.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">met by</dt>
<dd>
<p>This operator specifies if the correlated event ends at the same time when the current event starts. (The behavior of this operator is the reverse of the <code>meets</code> operator behavior.)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventB</code> ends at the same time when <code>$eventA</code> starts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this metby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.endTimestamp) == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>met by</code> operator supports one optional parameter that sets the maximum distance between the end time of the correlated event and the start time of the current event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this metby[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pattern matches if these conditions are met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Drools engine does not support negative intervals for the <code>met by</code> operator. If you use negative intervals, the Drools engine generates an error.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">overlaps</dt>
<dd>
<p>This operator specifies if the current event starts before the correlated event starts and it ends during the time frame that the correlated event occurs. The current event must end between the start and end times of the correlated event.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> starts before <code>$eventB</code> starts and then ends while <code>$eventB</code> occurs, before <code>$eventB</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this overlaps $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>overlaps</code> operator supports up to two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one parameter is defined, the value is the maximum distance between the start time of the correlated event and the end time of the current event.</p>
</li>
<li>
<p>If two parameters are defined, the values are the minimum distance (first value) and the maximum distance (second value) between the start time of the correlated event and the end time of the current event.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">overlapped by</dt>
<dd>
<p>This operator specifies if the correlated event starts before the current event starts and it ends during the time frame that the current event occurs. The correlated event must end between the start and end times of the current event. (The behavior of this operator is the reverse of the <code>overlaps</code> operator behavior.)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventB</code> starts before <code>$eventA</code> starts and then ends while <code>$eventA</code> occurs, before <code>$eventA</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this overlappedby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>overlapped by</code> operator supports up to two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one parameter is defined, the value is the maximum distance between the start time of the current event and the end time of the correlated event.</p>
</li>
<li>
<p>If two parameters are defined, the values are the minimum distance (first value) and the maximum distance (second value) between the start time of the current event and the end time of the correlated event.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">starts</dt>
<dd>
<p>This operator specifies if the two events start at the same time but the current event ends before the correlated event ends.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> and <code>$eventB</code> start at the same time, and <code>$eventA</code> ends before <code>$eventB</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this starts $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp == $eventB.startTimestamp
&amp;&amp;
$eventA.endTimestamp &lt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>starts</code> operator supports one optional parameter that sets the maximum distance between the start times of the two events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this starts[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pattern matches if these conditions are met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.startTimestamp) &lt;= 5s
&amp;&amp;
$eventA.endTimestamp &lt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Drools engine does not support negative intervals for the <code>starts</code> operator. If you use negative intervals, the Drools engine generates an error.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">started by</dt>
<dd>
<p>This operator specifies if the two events start at the same time but the correlated event ends before the current event ends. (The behavior of this operator is the reverse of the <code>starts</code> operator behavior.)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following pattern matches if <code>$eventA</code> and <code>$eventB</code> start at the same time, and <code>$eventB</code> ends before <code>$eventA</code> ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this startedby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this operator in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp == $eventB.startTimestamp
&amp;&amp;
$eventA.endTimestamp &gt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>started by</code> operator supports one optional parameter that sets the maximum distance between the start times of the two events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA( this starts[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pattern matches if these conditions are met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs( $eventA.startTimestamp - $eventB.startTimestamp ) &lt;= 5s
&amp;&amp;
$eventA.endTimestamp &gt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Drools engine does not support negative intervals for the <code>started by</code> operator. If you use negative intervals, the Drools engine generates an error.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cep-clock-ref_decision-engine"><a class="anchor" href="#cep-clock-ref_decision-engine"></a><a class="link" href="#cep-clock-ref_decision-engine">3.5.7. Session clock implementations in the Drools engine</a></h4>
<div class="paragraph">
<p>During complex event processing, events in the Drools engine may have temporal constraints and therefore require a session clock that provides the current time. For example, if a rule needs to determine the average price of a given stock over the last 60 minutes, the Drools engine must be able to compare the stock price event time stamp with the current time in the session clock.</p>
</div>
<div class="paragraph">
<p>The Drools engine supports a real-time clock and a pseudo clock. You can use one or both clock types depending on the scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rules testing:</strong> Testing requires a controlled environment, and when the tests include rules with temporal constraints, you must be able to control the input rules and facts and the flow of time.</p>
</li>
<li>
<p><strong>Regular execution:</strong> The Drools engine reacts to events in real time and therefore requires a real-time clock.</p>
</li>
<li>
<p><strong>Special environments:</strong> Specific environments may have specific time control requirements. For example, clustered environments may require clock synchronization or Java Enterprise Edition (JEE) environments may require a clock provided by the application server.</p>
</li>
<li>
<p><strong>Rules replay or simulation:</strong> In order to replay or simulate scenarios, the application must be able to control the flow of time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider your environment requirements as you decide whether to use a real-time clock or pseudo clock in the Drools engine.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Real-time clock</dt>
<dd>
<p>The real-time clock is the default clock implementation in the Drools engine and uses the system clock to determine the current time for time stamps. To configure the Drools engine to use the real-time clock, set the KIE session configuration parameter to <code>realtime</code>:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Configure real-time clock in KIE session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.KieServices.Factory;
import org.kie.api.runtime.conf.ClockTypeOption;
import org.kie.api.runtime.KieSessionConfiguration;

KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();

config.setOption(ClockTypeOption.get("realtime"));</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Pseudo clock</dt>
<dd>
<p>The pseudo clock implementation in the Drools engine is helpful for testing temporal rules and it can be controlled by the application. To configure the Drools engine to use the pseudo clock, set the KIE session configuration parameter to <code>pseudo</code>:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Configure pseudo clock in KIE session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.conf.ClockTypeOption;
import org.kie.api.runtime.KieSessionConfiguration;
import org.kie.api.KieServices.Factory;

KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();

config.setOption(ClockTypeOption.get("pseudo"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use additional configurations and fact handlers to control the pseudo clock:</p>
</div>
<div class="listingblock">
<div class="title">Control pseudo clock behavior in KIE session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.concurrent.TimeUnit;

import org.kie.api.runtime.KieSessionConfiguration;
import org.kie.api.KieServices.Factory;
import org.kie.api.runtime.KieSession;
import org.drools.core.time.SessionPseudoClock;
import org.kie.api.runtime.rule.FactHandle;
import org.kie.api.runtime.conf.ClockTypeOption;

KieSessionConfiguration conf = KieServices.Factory.get().newKieSessionConfiguration();

conf.setOption( ClockTypeOption.get("pseudo"));
KieSession session = kbase.newKieSession(conf, null);

SessionPseudoClock clock = session.getSessionClock();

// While inserting facts, advance the clock as necessary.
FactHandle handle1 = session.insert(tick1);
clock.advanceTime(10, TimeUnit.SECONDS);

FactHandle handle2 = session.insert(tick2);
clock.advanceTime(30, TimeUnit.SECONDS);

FactHandle handle3 = session.insert(tick3);</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="cep-event-streams-con_decision-engine"><a class="anchor" href="#cep-event-streams-con_decision-engine"></a><a class="link" href="#cep-event-streams-con_decision-engine">3.5.8. Event streams and entry points</a></h4>
<div class="paragraph">
<p>The Drools engine can process high volumes of events in the form of event streams. In DRL rule declarations, a stream is also known as an <em>entry point</em>. When you declare an entry point in a DRL rule or Java application, the Drools engine, at compile time, identifies and creates the proper internal structures to use data from only that entry point to evaluate that rule.</p>
</div>
<div class="paragraph">
<p>Facts from one entry point, or stream, can join facts from any other entry point in addition to facts already in the working memory of the Drools engine. Facts always remain associated with the entry point through which they entered the Drools engine. Facts of the same type can enter the Drools engine through several entry points, but facts that enter the Drools engine through entry point A can never match a pattern from entry point B.</p>
</div>
<div class="paragraph">
<p>Event streams have the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Events in the stream are ordered by time stamp. The time stamps may have different semantics for different streams, but they are always ordered internally.</p>
</li>
<li>
<p>Event streams usually have a high volume of events.</p>
</li>
<li>
<p>Atomic events in streams are usually not useful individually, only collectively in a stream.</p>
</li>
<li>
<p>Event streams can be homogeneous and contain a single type of event, or heterogeneous and contain events of different types.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="cep-event-streams-proc_decision-engine"><a class="anchor" href="#cep-event-streams-proc_decision-engine"></a><a class="link" href="#cep-event-streams-proc_decision-engine">3.5.8.1. Declaring entry points for rule data</a></h5>
<div class="paragraph">
<p>You can declare an entry point (event stream) for events so that the Drools engine uses data from only that entry point to evaluate the rules. You can declare an entry point either implicitly by referencing it in DRL rules or explicitly in your Java application.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Use one of the following methods to declare the entry point:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the DRL rule file, specify <code>from entry-point "&lt;name&gt;"</code> for the inserted fact:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Authorize withdrawal rule with "ATM Stream" entry point</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Authorize withdrawal"
when
  WithdrawRequest($ai : accountId, $am : amount) from entry-point "ATM Stream"
  CheckingAccount(accountId == $ai, balance &gt; $am)
then
  // Authorize withdrawal.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Apply fee rule with "Branch Stream" entry point</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply fee on withdraws on branches"
when
  WithdrawRequest($ai : accountId, processed == true) from entry-point "Branch Stream"
  CheckingAccount(accountId == $ai)
then
  // Apply a $2 fee on the account.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both example DRL rules from a banking application insert the event <code>WithdrawalRequest</code> with the fact <code>CheckingAccount</code>, but from different entry points. At run time, the Drools engine evaluates the <code>Authorize withdrawal</code> rule using data from only the <code>"ATM Stream"</code> entry point, and evaluates the <code>Apply fee</code> rule using data from only the <code>"Branch Stream"</code> entry point. Any events inserted into the <code>"ATM Stream"</code> can never match patterns for the <code>"Apply fee"</code> rule, and any events inserted into the <code>"Branch Stream"</code> can never match patterns for the <code>"Authorize withdrawal rule"</code>.</p>
</div>
</div>
</div>
</li>
<li>
<p>In the Java application code, use the <code>getEntryPoint()</code> method to specify and obtain an <code>EntryPoint</code> object and insert facts into that entry point accordingly:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Java application code with EntryPoint object and inserted facts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.KieSession;
import org.kie.api.runtime.rule.EntryPoint;

// Create your KIE base and KIE session as usual.
KieSession session = ...

// Create a reference to the entry point.
EntryPoint atmStream = session.getEntryPoint("ATM Stream");

// Start inserting your facts into the entry point.
atmStream.insert(aWithdrawRequest);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any DRL rules that specify <code>from entry-point "ATM Stream"</code> are then evaluated based on the data in this entry point only.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cep-sliding-windows-con_decision-engine"><a class="anchor" href="#cep-sliding-windows-con_decision-engine"></a><a class="link" href="#cep-sliding-windows-con_decision-engine">3.5.9. Sliding windows of time or length</a></h4>
<div class="paragraph">
<p>In stream mode, the Drools engine can process events from a specified sliding window of time or length. A sliding time window is a specified period of time during which events can be processed. A sliding length window is a specified number of events that can be processed. When you declare a sliding window in a DRL rule or Java application, the Drools engine, at compile time, identifies and creates the proper internal structures to use data from only that sliding window to evaluate that rule.</p>
</div>
<div class="paragraph">
<p>For example, the following DRL rule snippets instruct the Drools engine to process only the stock points from the last 2 minutes (sliding time window) or to process only the last 10 stock points (sliding length window):</p>
</div>
<div class="listingblock">
<div class="title">Process stock points from the last 2 minutes (sliding time window)</div>
<div class="content">
<pre class="highlightjs highlight"><code>StockPoint() over window:time(2m)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Process the last 10 stock points (sliding length window)</div>
<div class="content">
<pre class="highlightjs highlight"><code>StockPoint() over window:length(10)</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="cep-sliding-windows-proc_decision-engine"><a class="anchor" href="#cep-sliding-windows-proc_decision-engine"></a><a class="link" href="#cep-sliding-windows-proc_decision-engine">3.5.9.1. Declaring sliding windows for rule data</a></h5>
<div class="paragraph">
<p>You can declare a sliding window of time (flow of time) or length (number of occurrences) for events so that the Drools engine uses data from only that window to evaluate the rules.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the DRL rule file, specify <code>over window:&lt;time_or_length&gt;(&lt;value&gt;)</code> for the inserted fact.</p>
</div>
<div class="paragraph">
<p>For example, the following two DRL rules activate a fire alarm based on an average temperature. However, the first rule uses a sliding time window to calculate the average over the last 10 minutes while the second rule uses a sliding length window to calculate the average over the last one hundred temperature readings.</p>
</div>
<div class="listingblock">
<div class="title">Average temperature over sliding time window</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm if temperature rises above threshold"
when
  TemperatureThreshold($max : max)
  Number(doubleValue &gt; $max) from accumulate(
    SensorReading($temp : temperature) over window:time(10m),
    average($temp))
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Average temperature over sliding length window</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm if temperature rises above threshold"
when
  TemperatureThreshold($max : max)
  Number(doubleValue &gt; $max) from accumulate(
    SensorReading($temp : temperature) over window:length(100),
    average($temp))
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Drools engine discards any <code>SensorReading</code> events that are more than 10 minutes old or that are not part of the last one hundred readings, and continues recalculating the average as the minutes or readings "slide" forward in real time.</p>
</div>
<div class="paragraph">
<p>The Drools engine does not automatically remove outdated events from the KIE session because other rules without sliding window declarations might depend on those events. The Drools engine stores events in the KIE session until the events expire either by explicit rule declarations or by implicit reasoning within the Drools engine based on inferred data in the KIE base.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cep-memory-management-con_decision-engine"><a class="anchor" href="#cep-memory-management-con_decision-engine"></a><a class="link" href="#cep-memory-management-con_decision-engine">3.5.10. Memory management for events</a></h4>
<div class="paragraph">
<p>In stream mode, the Drools engine uses automatic memory management to maintain events that are stored in KIE sessions. The Drools engine can retract from a KIE session any events that no longer match any rule due to their temporal constraints and release any resources held by the retracted events.</p>
</div>
<div class="paragraph">
<p>The Drools engine uses either explicit or inferred expiration to retract outdated events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Explicit expiration:</strong> The Drools engine removes events that are explicitly set to expire in rules that declare the <code>@expires</code> tag:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">DRL rule snippet with explicit expiration</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare StockPoint
  @expires( 30m )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example rule sets any <code>StockPoint</code> events to expire after 30 minutes and to be removed from the KIE session if no other rules use the events.</p>
</div>
</div>
</div>
</li>
<li>
<p><strong>Inferred expiration:</strong> The Drools engine can calculate the expiration offset for a given event implicitly by analyzing the temporal constraints in the rules:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">DRL rule with temporal constraints</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Correlate orders"
when
  $bo : BuyOrder($id : id)
  $ae : AckOrder(id == $id, this after[0,10s] $bo)
then
  // Perform an action.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example rule, the Drools engine automatically calculates that whenever a <code>BuyOrder</code> event occurs, the Drools engine needs to store the event for up to 10 seconds and wait for the matching <code>AckOrder</code> event. After 10 seconds, the Drools engine infers the expiration and removes the event from the KIE session. An <code>AckOrder</code> event can only match an existing <code>BuyOrder</code> event, so the Drools engine infers the expiration if no match occurs and removes the event immediately.</p>
</div>
<div class="paragraph">
<p>The Drools engine analyzes the entire KIE base to find the offset for every event type and to ensure that no other rules use the events that are pending removal. Whenever an implicit expiration clashes with an explicit expiration value, the Drools engine uses the greater time frame of the two to store the event longer.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="engine-queries-con_decision-engine"><a class="anchor" href="#engine-queries-con_decision-engine"></a><a class="link" href="#engine-queries-con_decision-engine">3.6. Drools engine queries and live queries</a></h3>
<div class="paragraph">
<p>You can use queries with the Drools engine to retrieve fact sets based on fact patterns as they are used in rules. The patterns might also use optional parameters.</p>
</div>
<div class="paragraph">
<p>To use queries with the Drools engine, you add the query definitions in DRL files and then obtain the matching results in your application code. While a query iterates over a result collection, you can use any identifier that is bound to the query to access the corresponding fact or fact field by calling the <code>get()</code> method with the binding variable name as the argument. If the binding refers to a fact object, you can retrieve the fact handle by calling <code>getFactHandle()</code> with the variable name as the parameter.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./UserGuide/QueryResults.png" alt="QueryResults">
</div>
<div class="title">Figure 43. QueryResults</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./UserGuide/QueryResultsRow.png" alt="QueryResultsRow">
</div>
<div class="title">Figure 44. QueryResultsRow</div>
</div>
<div class="listingblock">
<div class="title">Example query definition in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>query "people under the age of 21"
    $person : Person( age &lt; 21 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example application code to obtain and iterate over query results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age of 21" );

System.out.println( "These people are under the age of 21:" );

for ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( "person" );
    System.out.println( person.getName() + "\n" );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Invoking queries and processing the results by iterating over the returned set can be difficult when you are monitoring changes over time. To alleviate this difficulty with ongoing queries, Drools provides <em>live queries</em>, which use an attached listener for change events instead of returning an iterable result set. Live queries remain open by creating a view and publishing change events for the contents of this view.</p>
</div>
<div class="paragraph">
<p>To activate a live query, start your query with parameters and monitor changes in the resulting view. You can use the <code>dispose()</code> method to terminate the query and discontinue this reactive scenario.</p>
</div>
<div class="listingblock">
<div class="title">Example query definition in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>query colors(String $color1, String $color2)
    TShirt(mainColor = $color1, secondColor = $color2, $price: manufactureCost)
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example application code with an event listener and a live query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final List updated = new ArrayList();
final List removed = new ArrayList();
final List added = new ArrayList();

ViewChangedEventListener listener = new ViewChangedEventListener() {
 public void rowUpdated(Row row) {
  updated.add( row.get( "$price" ) );
 }

 public void rowRemoved(Row row) {
  removed.add( row.get( "$price" ) );
 }

 public void rowAdded(Row row) {
  added.add( row.get( "$price" ) );
 }
};

// Open the live query:
LiveQuery query = ksession.openLiveQuery( "colors",
                                          new Object[] { "red", "blue" },
                                          listener );
...
...

// Terminate the live query:
query.dispose()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more live query examples, see <a href="http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html">Glazed Lists examples for Drools Live Queries</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="engine-event-listeners-con_decision-engine"><a class="anchor" href="#engine-event-listeners-con_decision-engine"></a><a class="link" href="#engine-event-listeners-con_decision-engine">3.7. Drools engine event listeners and debug logging</a></h3>
<div class="paragraph">
<p>In Drools, you can add or remove listeners for Drools engine events, such as fact insertions and rule executions. With Drools engine event listeners, you can be notified of Drools engine activity and separate your logging and auditing work from the core of your application.</p>
</div>
<div class="paragraph">
<p>The Drools engine supports the following default event listeners for the agenda and working memory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AgendaEventListener</code></p>
</li>
<li>
<p><code>WorkingMemoryEventListener</code></p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./UserGuide/WorkingMemoryEventManager.png" alt="WorkingMemoryEventManager">
</div>
<div class="title">Figure 45. WorkingMemoryEventManager</div>
</div>
<div class="paragraph">
<p>For each event listener, the Drools engine also supports the following specific events that you can specify to be monitored:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MatchCreatedEvent</code></p>
</li>
<li>
<p><code>MatchCancelledEvent</code></p>
</li>
<li>
<p><code>BeforeMatchFiredEvent</code></p>
</li>
<li>
<p><code>AfterMatchFiredEvent</code></p>
</li>
<li>
<p><code>AgendaGroupPushedEvent</code></p>
</li>
<li>
<p><code>AgendaGroupPoppedEvent</code></p>
</li>
<li>
<p><code>ObjectInsertEvent</code></p>
</li>
<li>
<p><code>ObjectDeletedEvent</code></p>
</li>
<li>
<p><code>ObjectUpdatedEvent</code></p>
</li>
<li>
<p><code>ProcessCompletedEvent</code></p>
</li>
<li>
<p><code>ProcessNodeLeftEvent</code></p>
</li>
<li>
<p><code>ProcessNodeTriggeredEvent</code></p>
</li>
<li>
<p><code>ProcessStartEvent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following code uses a <code>DefaultAgendaEventListener</code> listener attached to a KIE session and specifies the <code>AfterMatchFiredEvent</code> event to be monitored. The code prints pattern matches after the rules are executed (fired):</p>
</div>
<div class="listingblock">
<div class="title">Example code to monitor and print <code>AfterMatchFiredEvent</code> events in the agenda</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DefaultAgendaEventListener() {
   public void afterMatchFired(AfterMatchFiredEvent event) {
       super.afterMatchFired( event );
       System.out.println( event );
   }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Drools engine also supports the following agenda and working memory event listeners for debug logging:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DebugAgendaEventListener</code></p>
</li>
<li>
<p><code>DebugRuleRuntimeEventListener</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These event listeners implement the same supported event-listener methods and include a debug print statement by default. You can add a specific supported event to be monitored and documented, or monitor all agenda or working memory activity.</p>
</div>
<div class="paragraph">
<p>For example, the following code uses the <code>DebugRuleRuntimeEventListener</code> event listener to monitor and print all working memory events:</p>
</div>
<div class="listingblock">
<div class="title">Example code to monitor and print all working memory events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DebugRuleRuntimeEventListener() );</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="logging-proc_decision-engine"><a class="anchor" href="#logging-proc_decision-engine"></a><a class="link" href="#logging-proc_decision-engine">3.7.1. Configuring a logging utility in the Drools engine</a></h4>
<div class="paragraph">
<p>The Drools engine uses the Java logging API SLF4J for system logging. You can use one of the following logging utilities with the Drools engine to investigate Drools engine activity, such as for troubleshooting or data gathering:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logback</p>
</li>
<li>
<p>Apache Commons Logging</p>
</li>
<li>
<p>Apache Log4j</p>
</li>
<li>
<p><code>java.util.logging</code> package</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>For the logging utility that you want to use, add the relevant dependency to your Maven project or save the relevant XML configuration file in the <code>org.drools</code> package of your Drools distribution:</p>
</div>
<div class="listingblock">
<div class="title">Example Maven dependency for Logback</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example logback.xml configuration file in org.drools package</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
  &lt;logger name="org.drools" level="debug"/&gt;
  ...
&lt;configuration&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example log4j.xml configuration file in org.drools package</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"&gt;
  &lt;category name="org.drools"&gt;
    &lt;priority value="debug" /&gt;
  &lt;/category&gt;
  ...
&lt;/log4j:configuration&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are developing for an ultra light environment, use the <code>slf4j-nop</code> or <code>slf4j-simple</code> logger.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performance-tuning-decision-engine-ref_decision-engine"><a class="anchor" href="#performance-tuning-decision-engine-ref_decision-engine"></a><a class="link" href="#performance-tuning-decision-engine-ref_decision-engine">3.8. Performance tuning considerations with the Drools engine</a></h3>
<div class="paragraph">
<p>The following key concepts or suggested practices can help you optimize Drools engine performance. These concepts are summarized in this section as a convenience and are explained in more detail in the cross-referenced documentation, where applicable. This section will expand or change as needed with new releases of Drools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Use sequential mode for stateless KIE sessions that do not require important Drools engine updates</dt>
<dd>
<p>Sequential mode is an advanced rule base configuration in the Drools engine that enables the Drools engine to evaluate rules one time in the order that they are listed in the Drools engine agenda without regard to changes in the working memory. As a result, rule execution may be faster in sequential mode, but important updates may not be applied to your rules. Sequential mode applies to stateless KIE sessions only.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To enable sequential mode, set the system property <code>drools.sequential</code> to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>For more information about sequential mode or other options for enabling it, see <a href="#phreak-sequential-mode-con_decision-engine">Sequential mode in Phreak</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Use simple operations with event listeners</dt>
<dd>
<p>Limit the number of event listeners and the type of operations they perform. Use event listeners for simple operations, such as debug logging and setting properties. Complicated operations, such as network calls, in listeners can impede rule execution. After you finish working with a KIE session, remove the attached event listeners so that the session can be cleaned, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example event listener removed after use</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Listener listener = ...;
StatelessKnowledgeSession ksession = createSession();
try {
    ksession.insert(fact);
    ksession.fireAllRules();
    ...
} finally {
    if (session != null) {
        ksession.detachListener(listener);
        ksession.dispose();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information about built-in event listeners and debug logging in the Drools engine, see <a href="#engine-event-listeners-con_decision-engine">Drools engine event listeners and debug logging</a>.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_droolslanguagereferencechapter"><a class="anchor" href="#_droolslanguagereferencechapter"></a><a class="link" href="#_droolslanguagereferencechapter">4. Rule Language Reference</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="drl-rules-con_drl-rules"><a class="anchor" href="#drl-rules-con_drl-rules"></a><a class="link" href="#drl-rules-con_drl-rules">4.1. DRL (Drools Rule Language) rules</a></h3>
<div class="paragraph">
<p>DRL (Drools Rule Language) rules are business rules that you define directly in <code>.drl</code> text files. These DRL files are the source in which all other rule assets in Business Central are ultimately rendered. You can create and manage DRL files within the Business Central interface, or create them externally as part of a Maven or Java project using Red Hat CodeReady Studio or another integrated development environment (IDE). A DRL file can contain one or more rules that define at a minimum the rule conditions (<code>when</code>) and actions (<code>then</code>). The DRL designer in Business Central provides syntax highlighting for Java, DRL, and XML.</p>
</div>
<div class="paragraph">
<p>DRL files consist of the following components:</p>
</div>
<div class="listingblock">
<div class="title">Components in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>package

import

function  // Optional

query  // Optional

declare   // Optional

global   // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example DRL rule determines the age limit in a loan application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example rule for loan application age limit</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  salience 15
  agenda-group "applicationGroup"
  when
    $application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>A DRL file can contain single or multiple rules, queries, and functions, and can define resource declarations such as imports, globals, and attributes that are assigned and used by your rules and queries. The DRL package must be listed at the top of a DRL file and the rules are typically listed last. All other DRL components can follow any order.</p>
</div>
<div class="paragraph">
<p>Each rule must have a unique name within the rule package. If you use the same rule name more than once in any DRL file in the package, the rules fail to compile. Always enclose rule names with double quotation marks (<code>rule "rule name"</code>) to  prevent possible compilation errors, especially if you use spaces in rule names.</p>
</div>
<div class="paragraph">
<p>All data objects related to a DRL rule must be in the same project package as the DRL file in Business Central. Assets in the same package are imported by default. Existing assets in other packages can be imported with the DRL rule.</p>
</div>
<div class="sect3">
<h4 id="drl-packages-con_drl-rules"><a class="anchor" href="#drl-packages-con_drl-rules"></a><a class="link" href="#drl-packages-con_drl-rules">4.1.1. Packages in DRL</a></h4>
<div class="paragraph">
<p>A package is a folder of related assets in Drools, such as data objects, DRL files, decision tables, and other asset types. A package also serves as a unique namespace for each group of rules. A single rule base can contain multiple packages. You typically store all the rules for a package in the same file as the package declaration so that the package is self-contained. However, you can import objects from other packages that you want to use in the rules.</p>
</div>
<div class="paragraph">
<p>The following example is a package name and namespace for a DRL file in a mortgage application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example package definition in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mortgages;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following railroad diagram shows all the components that may make up a package:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/package.png" alt="package">
</div>
<div class="title">Figure 46. Package</div>
</div>
<div class="paragraph">
<p>Note that a package <em>must</em> have a namespace and be declared using standard Java conventions for package names; i.e., no spaces, unlike rule names which allow spaces.
In terms of the order of elements, they can appear in any order in the rule file, with the exception of the <code>package</code> statement, which must be at the top of the file.
In all cases, the semicolons are optional.</p>
</div>
<div class="paragraph">
<p>Notice that any rule attribute (as described the section Rule Attributes) may also be written at package level, superseding the attribute&#8217;s default value.
The modified default may still be replaced by an attribute setting within a rule.</p>
</div>
</div>
<div class="sect3">
<h4 id="drl-imports-con_drl-rules"><a class="anchor" href="#drl-imports-con_drl-rules"></a><a class="link" href="#drl-imports-con_drl-rules">4.1.2. Import statements in DRL</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/import.png" alt="import">
</div>
<div class="title">Figure 47. Import</div>
</div>
<div class="paragraph">
<p>Similar to import statements in Java, imports in DRL files identify the fully qualified paths and type names for any objects that you want to use in the rules. You specify the package and data object in the format <code>packageName.objectName</code>, with multiple imports on separate lines. The Drools engine automatically imports classes from the Java package with the same name as the DRL package and from the package <code>java.lang</code>.</p>
</div>
<div class="paragraph">
<p>The following example is an import statement for a loan application object in a mortgage application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example import statement in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.mortgages.LoanApplication;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-functions-con_drl-rules"><a class="anchor" href="#drl-functions-con_drl-rules"></a><a class="link" href="#drl-functions-con_drl-rules">4.1.3. Functions in DRL</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/function.png" alt="function">
</div>
<div class="title">Figure 48. Function</div>
</div>
<div class="paragraph">
<p>Functions in DRL files put semantic code in your rule source file instead of in Java classes. Functions are especially useful if an action (<code>then</code>) part of a rule is used repeatedly and only the parameters differ for each rule. Above the rules in the DRL file, you can declare the function or import a static method from a helper class as a function, and then use the function by name in an action (<code>then</code>) part of the rule.</p>
</div>
<div class="paragraph">
<p>The following examples illustrate a function that is either declared or imported in a DRL file:</p>
</div>
<div class="listingblock">
<div class="title">Example function declaration with a rule (option 1)</div>
<div class="content">
<pre class="highlightjs highlight"><code>function String hello(String applicantName) {
    return "Hello " + applicantName + "!";
}

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example function import with a rule (option 2)</div>
<div class="content">
<pre class="highlightjs highlight"><code>import function my.package.applicant.hello;

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-queries-con_drl-rules"><a class="anchor" href="#drl-queries-con_drl-rules"></a><a class="link" href="#drl-queries-con_drl-rules">4.1.4. Queries in DRL</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/query.png" alt="query">
</div>
<div class="title">Figure 49. Query</div>
</div>
<div class="paragraph">
<p>Queries in DRL files search the working memory of the Drools engine for facts related to the rules in the DRL file. You add the query definitions in DRL files and then obtain the matching results in your application code. Queries search for a set of defined conditions and do not require <code>when</code> or <code>then</code> specifications. Query names are global to the KIE base and therefore must be unique among all other rule queries in the project. To return the results of a query, you construct a <code>QueryResults</code> definition using <code>ksession.getQueryResults("name")</code>, where <code>"name"</code> is the query name. This returns a list of query results, which enable you to retrieve the objects that matched the query. You define the query and query results parameters above the rules in the DRL file.</p>
</div>
<div class="paragraph">
<p>The following example is a query definition in a DRL file for underage applicants in a mortgage application decision service, with the accompanying application code:</p>
</div>
<div class="listingblock">
<div class="title">Example query definition in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>query "people under the age of 21"
    $person : Person( age &lt; 21 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example application code to obtain query results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age  of 21" );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also iterate over the returned <code>QueryResults</code> using a standard <code>for</code> loop. Each element is a <code>QueryResultsRow</code> that you can use to access each of the columns in the tuple.</p>
</div>
<div class="listingblock">
<div class="title">Example application code to obtain and iterate over query results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age of 21" );

System.out.println( "These people are under the age of 21:" );

for ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( "person" );
    System.out.println( person.getName() + "\n" );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Support for positional syntax has been added for more compact code.
By default the declared type order in the type declaration matches the argument position.
But it possible to override these using the @position annotation.
This allows patterns to be used with positional arguments, instead of the more verbose named arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Cheese
    name : String @position(1)
    shop : String @position(2)
    price : int @position(0)
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The @Position annotation, in the org.drools.definition.type package, can be used to annotate original pojos on the classpath.
Currently only fields on classes can be annotated.
Inheritance of classes is supported, but not interfaces or methods.
The isContainedIn query below demonstrates the use of positional arguments in a pattern; <code>Location(x, y;)</code> instead of <code>Location( thing == x, location == y).</code></p>
</div>
<div class="paragraph">
<p>Queries can now call other queries, this combined with optional query arguments provides derivation query style backward chaining.
Positional and named syntax is supported for arguments.
It is also possible to mix both positional and named, but positional must come first, separated by a semi colon.
Literal expressions can be passed as query arguments, but at this stage you cannot mix expressions with variables.
Here is an example of a query that calls another query.
Note that 'z' here will always be an 'out' variable.
The '?' symbol means the query is pull only, once the results are returned you will not receive further results as the underlying data changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Location
    thing : String
    location : String
end

query isContainedIn( String x, String y )
    Location(x, y;)
    or
    ( Location(z, y;) and ?isContainedIn(x, z;) )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>As previously mentioned you can use live "open" queries to reactively receive changes over time from the query results, as the underlying data it queries against changes.
Notice the "look" rule calls the query without using '?'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query isContainedIn( String x, String y )
    Location(x, y;)
    or
    ( Location(z, y;) and isContainedIn(x, z;) )
end

rule look when
    Person( $l : likes )
    isContainedIn( $l, 'office'; )
then
   insertLogical( $l 'is in the office' );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools supports unification for derivation queries, in short this means that arguments are optional.
It is possible to call queries from Java leaving arguments unspecified using the static field org.drools.core.runtime.rule.Variable.v - note you must use 'v' and not an alternative instance of Variable.
These are referred to as 'out' arguments.
Note that the query itself does not declare at compile time whether an argument is in or an out, this can be defined purely at runtime on each use.
The following example will return all objects contained in the office.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>results = ksession.getQueryResults( "isContainedIn", new Object[] {  Variable.v, "office" } );
l = new ArrayList&lt;List&lt;String&gt;&gt;();
for ( QueryResultsRow r : results ) {
    l.add( Arrays.asList( new String[] { (String) r.get( "x" ), (String) r.get( "y" ) } ) );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The algorithm uses stacks to handle recursion, so the method stack will not blow up.</p>
</div>
<div class="paragraph">
<p>It is also possible to use as input argument for a query both the field of a fact as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query contains(String $s, String $c)
    $s := String( this.contains( $c ) )
end

rule PersonNamesWithA when
    $p : Person()
    contains( $p.name, "a"; )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>and more in general any kind of valid expression like in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query checkLength(String $s, int $l)
    $s := String( length == $l )
end

rule CheckPersonNameLength when
    $i : Integer()
    $p : Person()
    checkLength( $p.name, 1 + $i + $p.age; )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is not yet supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List and Map unification</p>
</li>
<li>
<p>Expression unification - pred( X, X + 1, X * Y / 7 )</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="drl-declarations-con_drl-rules"><a class="anchor" href="#drl-declarations-con_drl-rules"></a><a class="link" href="#drl-declarations-con_drl-rules">4.1.5. Type declarations and metadata in DRL</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/type_declaration.png" alt="type declaration">
</div>
<div class="title">Figure 50. Type declaration</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/meta_data.png" alt="meta data">
</div>
<div class="title">Figure 51. Metadata</div>
</div>
<div class="paragraph">
<p>Declarations in DRL files define new fact types or metadata for fact types to be used by rules in the DRL file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>New fact types:</strong> The default fact type in the <code>java.lang</code> package of Drools is <code>Object</code>, but you can declare other types in DRL files as needed. Declaring fact types in DRL files enables you to define a new fact model directly in the Drools engine, without creating models in a lower-level language like Java. You can also declare a new type when a domain model is already built and you want to complement this model with additional entities that are used mainly during the reasoning process.</p>
</li>
<li>
<p><strong>Metadata for fact types:</strong> You can associate metadata in the format <code>@key(value)</code> with new or existing facts. Metadata can be any kind of data that is not represented by the fact attributes and is consistent among all instances of that fact type. The metadata can be queried at run time by the Drools engine and used in the reasoning process.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="drl-declarations-without-metadata-con_drl-rules"><a class="anchor" href="#drl-declarations-without-metadata-con_drl-rules"></a><a class="link" href="#drl-declarations-without-metadata-con_drl-rules">4.1.5.1. Type declarations without metadata in DRL</a></h5>
<div class="paragraph">
<p>A declaration of a new fact does not require any metadata, but must include a list of attributes or fields. If a type declaration does not include identifying attributes, the Drools engine searches for an existing fact class in the classpath and raises an error if the class is missing.</p>
</div>
<div class="paragraph">
<p>The following example is a declaration of a new fact type <code>Person</code> with no metadata in a DRL file:</p>
</div>
<div class="listingblock">
<div class="title">Example declaration of a new fact type with a rule</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  name : String
  dateOfBirth : java.util.Date
  address : Address
end

rule "Using a declared type"
  when
    $p : Person( name == "James" )
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    insert( mark );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the new fact type <code>Person</code> has the three attributes <code>name</code>, <code>dateOfBirth</code>, and <code>address</code>. Each attribute has a type that can be any valid Java type, including another class that you create or a fact type that you previously declared. The <code>dateOfBirth</code> attribute has the type <code>java.util.Date</code>, from the Java API, and the <code>address</code> attribute has the previously defined fact type <code>Address</code>.</p>
</div>
<div class="paragraph">
<p>To avoid writing the fully qualified name of a class every time you declare it, you can define the full class name as part of the <code>import</code> clause:</p>
</div>
<div class="listingblock">
<div class="title">Example type declaration with the fully qualified class name in the import</div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.Date

declare Person
    name : String
    dateOfBirth : Date
    address : Address
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you declare a new fact type, the Drools engine generates at compile time a Java class representing the fact type. The generated Java class is a one-to-one JavaBeans mapping of the type definition.</p>
</div>
<div class="paragraph">
<p>For example, the following Java class is generated from the example <code>Person</code> type declaration:</p>
</div>
<div class="listingblock">
<div class="title">Generated Java class for the Person fact type declaration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Person implements Serializable {
    private String name;
    private java.util.Date dateOfBirth;
    private Address address;

    // Empty constructor
    public Person() {...}

    // Constructor with all fields
    public Person( String name, Date dateOfBirth, Address address ) {...}

    // If keys are defined, constructor with keys
    public Person( ...keys... ) {...}

    // Getters and setters
    // `equals` and `hashCode`
    // `toString`
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use the generated class in your rules like any other fact, as illustrated in the previous rule example with the <code>Person</code> type declaration:</p>
</div>
<div class="listingblock">
<div class="title">Example rule that uses the declared Person fact type</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Using a declared type"
  when
    $p : Person( name == "James" )
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    insert( mark );
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-enumerative-con_drl-rules"><a class="anchor" href="#drl-declarations-enumerative-con_drl-rules"></a><a class="link" href="#drl-declarations-enumerative-con_drl-rules">4.1.5.2. Enumerative type declarations in DRL</a></h5>
<div class="paragraph">
<p>DRL supports the declaration of enumerative types in the format <code>declare enum &lt;factType&gt;</code>, followed by a comma-separated list of values ending with a semicolon. You can then use the enumerative list in the rules in the DRL file.</p>
</div>
<div class="paragraph">
<p>For example, the following enumerative type declaration defines days of the week for an employee scheduling rule:</p>
</div>
<div class="listingblock">
<div class="title">Example enumerative type declaration with a scheduling rule</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare enum DaysOfWeek
   SUN("Sunday"),MON("Monday"),TUE("Tuesday"),WED("Wednesday"),THU("Thursday"),FRI("Friday"),SAT("Saturday");

   fullName : String
end

rule "Using a declared Enum"
when
   $emp : Employee( dayOff == DaysOfWeek.MONDAY )
then
   ...
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-extended-con_drl-rules"><a class="anchor" href="#drl-declarations-extended-con_drl-rules"></a><a class="link" href="#drl-declarations-extended-con_drl-rules">4.1.5.3. Extended type declarations in DRL</a></h5>
<div class="paragraph">
<p>DRL supports type declaration inheritance in the format <code>declare &lt;factType1&gt; extends &lt;factType2&gt;</code>. To extend a type declared in Java by a subtype declared in DRL, you repeat the parent type in a declaration statement without any fields.</p>
</div>
<div class="paragraph">
<p>For example, the following type declarations extend a <code>Student</code> type from a top-level <code>Person</code> type, and a <code>LongTermStudent</code> type from the <code>Student</code> subtype:</p>
</div>
<div class="listingblock">
<div class="title">Example extended type declarations</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.people.Person

declare Person end

declare Student extends Person
    school : String
end

declare LongTermStudent extends Student
    years : int
    course : String
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-with-metadata-con_drl-rules"><a class="anchor" href="#drl-declarations-with-metadata-con_drl-rules"></a><a class="link" href="#drl-declarations-with-metadata-con_drl-rules">4.1.5.4. Type declarations with metadata in DRL</a></h5>
<div class="paragraph">
<p>You can associate metadata in the format <code>@key(value)</code> (the value is optional) with fact types or fact attributes. Metadata can be any kind of data that is not represented by the fact attributes and is consistent among all instances of that fact type. The metadata can be queried at run time by the Drools engine and used in the reasoning process. Any metadata that you declare before the attributes of a fact type are assigned to the fact type, while metadata that you declare after an attribute are assigned to that particular attribute.</p>
</div>
<div class="paragraph">
<p>In the following example, the two metadata attributes <code>@author</code> and <code>@dateOfCreation</code> are declared for the <code>Person</code> fact type, and the two metadata items <code>@key</code> and <code>@maxLength</code> are declared for the <code>name</code> attribute. The <code>@key</code> metadata attribute has no required value, so the parentheses and the value are omitted.</p>
</div>
<div class="listingblock">
<div class="title">Example metadata declaration for fact types and attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.Date

declare Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )

    name : String @key @maxLength( 30 )
    dateOfBirth : Date
    address : Address
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For declarations of metadata attributes for existing types, you can identify the fully qualified class name as part of the <code>import</code> clause for all declarations or as part of the individual <code>declare</code> clause:</p>
</div>
<div class="listingblock">
<div class="title">Example metadata declaration for an imported type</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.examples.Person

declare Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example metadata declaration for a declared type</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare org.drools.examples.Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-metadata-tags-ref_drl-rules"><a class="anchor" href="#drl-declarations-metadata-tags-ref_drl-rules"></a><a class="link" href="#drl-declarations-metadata-tags-ref_drl-rules">4.1.5.5. Metadata tags for fact type and attribute declarations in DRL</a></h5>
<div class="paragraph">
<p>Although you can define custom metadata attributes in DRL declarations, the Drools engine also supports the following predefined metadata tags for declarations of fact types or fact type attributes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The examples in this section that refer to the <code>VoiceCall</code> class assume that the sample application domain model includes the following class details:</p>
</div>
<div class="listingblock">
<div class="title">VoiceCall fact class in an example Telecom domain model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class VoiceCall {
  private String  originNumber;
  private String  destinationNumber;
  private Date    callDateTime;
  private long    callDuration;  // in milliseconds

  // Constructors, getters, and setters
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@role</dt>
<dd>
<p>This tag determines whether a given fact type is handled as a regular fact or an event in the Drools engine during complex event processing.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: <code>fact</code></p>
</div>
<div class="paragraph">
<p>Supported parameters: <code>fact</code>, <code>event</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@role( fact | event )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall as event type</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@timestamp</dt>
<dd>
<p>This tag is automatically assigned to every event in the Drools engine. By default, the time is provided by the session clock and assigned to the event when it is inserted into the working memory of the Drools engine. You can specify a custom time stamp attribute instead of the default time stamp added by the session clock.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: The time added by the Drools engine session clock</p>
</div>
<div class="paragraph">
<p>Supported parameters: Session clock time or custom time stamp attribute</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@timestamp( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall timestamp attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@duration</dt>
<dd>
<p>This tag determines the duration time for events in the Drools engine. Events can be interval-based events or point-in-time events. Interval-based events have a duration time and persist in the working memory of the Drools engine until their duration time has lapsed. Point-in-time events have no duration and are essentially interval-based events with a duration of zero. By default, every event in the Drools engine has a duration of zero. You can specify a custom duration attribute instead of the default.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null (zero)</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom duration attribute</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@duration( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall duration attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@expires</dt>
<dd>
<p>This tag determines the time duration before an event expires in the working memory of the Drools engine. By default, an event expires when the event can no longer match and activate any of the current rules. You can define an amount of time after which an event should expire. This tag definition also overrides the implicit expiration offset calculated from temporal constraints and sliding windows in the KIE base. This tag is available only when the Drools engine is running in stream mode.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null (event expires after event can no longer match and activate rules)</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom <code>timeOffset</code> attribute in the format <code>[<mark>#d][#h][#m][#s][</mark>[ms]]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@expires( &lt;timeOffset&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare expiration offset for VoiceCall events</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
  @expires( 1h35m )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@typesafe</dt>
<dd>
<p>This tab determines whether a given fact type is compiled with or without type safety. By default, all type declarations are compiled with type safety enabled. You can override this behavior to type-unsafe evaluation, where all constraints are generated as MVEL constraints and executed dynamically. This is useful when dealing with collections that do not have any generics or mixed type collections.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: <code>true</code></p>
</div>
<div class="paragraph">
<p>Supported parameters: <code>true</code>, <code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@typesafe( &lt;boolean&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall for type-unsafe evaluation</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( fact )
  @typesafe( false )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@serialVersionUID</dt>
<dd>
<p>This tag defines an identifying <code>serialVersionUID</code> value for a serializable class in a fact declaration. If a serializable class does not explicitly declare a <code>serialVersionUID</code>, the serialization run time calculates a default <code>serialVersionUID</code> value for that class based on various aspects of the class, as described in the <a href="https://docs.oracle.com/javase/10/docs/specs/serialization/index.html">Java Object Serialization Specification</a>. However, for optimal deserialization results and for greater compatibility with serialized KIE sessions, set the <code>serialVersionUID</code> as needed in the relevant class or in your DRL declarations.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom <code>serialVersionUID</code> integer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@serialVersionUID( &lt;integer&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare serialVersionUID for a VoiceCall class</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @serialVersionUID( 42 )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@key</dt>
<dd>
<p>This tag enables a fact type attribute to be used as a key identifier for the fact type. The generated class can then implement the <code>equals()</code> and <code>hashCode()</code> methods to determine if two instances of the type are equal to each other. The Drools engine can also generate a constructor using all the key attributes as parameters.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: None</p>
</div>
<div class="paragraph">
<p>Supported parameters: None</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;attributeDefinition&gt; @key</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare Person type attributes as keys</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    firstName : String @key
    lastName : String @key
    age : int
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, the Drools engine checks the <code>firstName</code> and <code>lastName</code> attributes to determine if two instances of <code>Person</code> are equal to each other, but it does not check the <code>age</code> attribute. The Drools engine also implicitly generates three constructors: one without parameters, one with the <code>@key</code> fields, and one with all fields:</p>
</div>
<div class="listingblock">
<div class="title">Example constructors from the key declarations</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person() // Empty constructor

Person( String firstName, String lastName )

Person( String firstName, String lastName, int age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then create instances of the type based on the key constructors, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example instance using the key constructor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person person = new Person( "John", "Doe" );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@position</dt>
<dd>
<p>This tag determines the position of a declared fact type attribute or field in a positional argument, overriding the default declared order of attributes. You can use this tag to modify positional constraints in patterns while maintaining a consistent format in your type declarations and positional arguments. You can use this tag only for fields in classes on the classpath. If some fields in a single class use this tag and some do not, the attributes without this tag are positioned last, in the declared order. Inheritance of classes is supported, but not interfaces of methods.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: None</p>
</div>
<div class="paragraph">
<p>Supported parameters: Any integer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;attributeDefinition&gt; @position ( &lt;integer&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare a fact type and override declared order</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    firstName : String @position( 1 )
    lastName : String @position( 0 )
    age : int @position( 2 )
    occupation: String
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the attributes are prioritized in positional arguments in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>lastName</code></p>
</li>
<li>
<p><code>firstName</code></p>
</li>
<li>
<p><code>age</code></p>
</li>
<li>
<p><code>occupation</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In positional arguments, you do not need to specify the field name because the position maps to a known named field. For example, the argument <code>Person( lastName == "Doe" )</code> is the same as <code>Person( "Doe"; )</code>, where the <code>lastName</code> field has the highest position annotation in the DRL declaration. The semicolon <code>;</code> indicates that everything before it is a positional argument. You can mix positional and named arguments on a pattern by using the semicolon to separate them. Any variables in a positional argument that have not yet been bound are bound to the field that maps to that position.</p>
</div>
<div class="paragraph">
<p>The following example patterns illustrate different ways of constructing positional and named arguments. The patterns have two constraints and a binding, and the semicolon differentiates the positional section from the named argument section. Variables and literals and expressions using only literals are supported in positional arguments, but not variables alone.</p>
</div>
<div class="listingblock">
<div class="title">Example patterns with positional and named arguments</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( "Doe", "John", $a; )

Person( "Doe", "John"; $a : age )

Person( "Doe"; firstName == "John", $a : age )

Person( lastName == "Doe"; firstName == "John", $a : age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Positional arguments can be classified as <em>input arguments</em> or <em>output arguments</em>. Input arguments contain a previously declared binding and constrain against that binding using unification. Output arguments generate the declaration and bind it to the field represented by the positional argument when the binding does not yet exist.</p>
</div>
<div class="paragraph">
<p>In extended type declarations, use caution when defining <code>@position</code> annotations because the attribute positions are inherited in subtypes. This inheritance can result in a mixed attribute order that can be confusing in some cases. Two fields can have the same <code>@position</code> value and consecutive values do not need to be declared. If a position is repeated, the conflict is solved using inheritance, where position values in the parent type have precedence, and then using the declaration order from the first to last declaration.</p>
</div>
<div class="paragraph">
<p>For example, the following extended type declarations result in mixed positional priorities:</p>
</div>
<div class="listingblock">
<div class="title">Example extended fact type with mixed position annotations</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    firstName : String @position( 1 )
    lastName : String @position( 0 )
    age : int @position( 2 )
    occupation: String
end

declare Student extends Person
    degree : String @position( 1 )
    school : String @position( 0 )
    graduationDate : Date
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the attributes are prioritized in positional arguments in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>lastName</code> (position 0 in the parent type)</p>
</li>
<li>
<p><code>school</code> (position 0 in the subtype)</p>
</li>
<li>
<p><code>firstName</code> (position 1 in the parent type)</p>
</li>
<li>
<p><code>degree</code> (position 1 in the subtype)</p>
</li>
<li>
<p><code>age</code> (position 2 in the parent type)</p>
</li>
<li>
<p><code>occupation</code> (first field with no position annotation)</p>
</li>
<li>
<p><code>graduationDate</code> (second field with no position annotation)</p>
</li>
</ol>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="property-change-listeners-con_drl-rules"><a class="anchor" href="#property-change-listeners-con_drl-rules"></a><a class="link" href="#property-change-listeners-con_drl-rules">4.1.5.6. Property-change settings and listeners for fact types</a></h5>
<div class="paragraph">
<p>By default, the Drools engine does not re-evaluate all fact patterns for fact types each time a rule is triggered, but instead reacts only to modified properties that are constrained or bound inside a given pattern. For example, if a rule calls <code>modify()</code> as part of the rule actions but the action does not generate new data in the KIE base, the Drools engine does not automatically re-evaluate all fact patterns because no data was modified. This property reactivity behavior prevents unwanted recursions in the KIE base and results in more efficient rule evaluation. This behavior also means that you do not always need to use the <code>no-loop</code> rule attribute to avoid infinite recursion.</p>
</div>
<div class="paragraph">
<p>You can modify or disable this property reactivity behavior with the following <code>KnowledgeBuilderConfiguration</code> options, and then use a property-change setting in your Java class or DRL files to fine-tune property reactivity as needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ALWAYS</code>: (Default) All types are property reactive, but you can disable property reactivity for a specific type by using the <code>@classReactive</code> property-change setting.</p>
</li>
<li>
<p><code>ALLOWED</code>: No types are property reactive, but you can enable property reactivity for a specific type by using the <code>@propertyReactive</code> property-change setting.</p>
</li>
<li>
<p><code>DISABLED</code>: No types are property reactive. All property-change listeners are ignored.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example property reactivity setting in KnowledgeBuilderConfiguration</div>
<div class="content">
<pre class="highlightjs highlight"><code>KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
config.setOption(PropertySpecificOption.ALLOWED);
KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can update the <code>drools.propertySpecific</code> system property in the <code>standalone.xml</code> file of your Drools distribution:</p>
</div>
<div class="listingblock">
<div class="title">Example property reactivity setting in system properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  ...
  &lt;property name="drools.propertySpecific" value="ALLOWED"/&gt;
  ...
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Drools engine supports the following property-change settings and listeners for fact classes or declared DRL fact types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@classReactive</dt>
<dd>
<p>If property reactivity is set to <code>ALWAYS</code> in the Drools engine (all types are property reactive), this tag disables the default property reactivity behavior for a specific Java class or a declared DRL fact type. You can use this tag if you want the Drools engine to re-evaluate all fact patterns for the specified fact type each time the rule is triggered, instead of reacting only to modified properties that are constrained or bound inside a given pattern.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example: Disable default property reactivity in a DRL type declaration</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @classReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Disable default property reactivity in a Java class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@classReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyReactive</dt>
<dd>
<p>If property reactivity is set to <code>ALLOWED</code> in the Drools engine (no types are property reactive unless specified), this tag enables property reactivity for a specific Java class or a declared DRL fact type. You can use this tag if you want the Drools engine to react only to modified properties that are constrained or bound inside a given pattern for the specified fact type, instead of re-evaluating all fact patterns for the fact each time the rule is triggered.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example: Enable property reactivity in a DRL type declaration (when reactivity is disabled globally)</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @propertyReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Enable property reactivity in a Java class (when reactivity is disabled globally)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@propertyReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@watch</dt>
<dd>
<p>This tag enables property reactivity for additional properties that you specify in-line in fact patterns in DRL rules. This tag is supported only if property reactivity is set to <code>ALWAYS</code> in the Drools engine, or if property reactivity is set to <code>ALLOWED</code> and the relevant fact type uses the <code>@propertyReactive</code> tag. You can use this tag in DRL rules to add or exclude specific properties in fact property reactivity logic.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: None</p>
</div>
<div class="paragraph">
<p>Supported parameters: Property name, <code>*</code> (all), <code>!</code> (not), <code>!*</code> (no properties)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;factPattern&gt; @watch ( &lt;property&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Enable or disable property reactivity in fact patterns</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Listens for changes in both `firstName` (inferred) and `lastName`:
Person(firstName == $expectedFirstName) @watch( lastName )

// Listens for changes in all properties of the `Person` fact:
Person(firstName == $expectedFirstName) @watch( * )

// Listens for changes in `lastName` and explicitly excludes changes in `firstName`:
Person(firstName == $expectedFirstName) @watch( lastName, !firstName )

// Listens for changes in all properties of the `Person` fact except `age`:
Person(firstName == $expectedFirstName) @watch( *, !age )

// Excludes changes in all properties of the `Person` fact (equivalent to using `@classReactivity` tag):
Person(firstName == $expectedFirstName) @watch( !* )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Drools engine generates a compilation error if you use the <code>@watch</code> tag for properties in a fact type that uses the <code>@classReactive</code> tag (disables property reactivity) or when property reactivity is set to <code>ALLOWED</code> in the Drools engine and the relevant fact type does not use the <code>@propertyReactive</code> tag. Compilation errors also arise if you duplicate properties in listener annotations, such as <code>@watch( firstName, ! firstName )</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyChangeSupport</dt>
<dd>
<p>For facts that implement support for property changes as defined in the <a href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans Specification</a>, this tag enables the Drools engine to monitor changes in the fact properties.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example: Declare property change support in JavaBeans object</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    @propertyChangeSupport
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-access-con_drl-rules"><a class="anchor" href="#drl-declarations-access-con_drl-rules"></a><a class="link" href="#drl-declarations-access-con_drl-rules">4.1.5.7. Access to DRL declared types in application code</a></h5>
<div class="paragraph">
<p>Declared types in DRL are typically used within the DRL files while Java models are typically used when the model is shared between rules and applications. Because declared types are generated at KIE base compile time, an application cannot access them until application run time. In some cases, an application needs to access and handle facts directly from the declared types, especially when the application wraps the Drools engine and provides higher-level, domain-specific user interfaces for rules management.</p>
</div>
<div class="paragraph">
<p>To handle declared types directly from the application code, you can use the <code>org.drools.definition.type.FactType</code> API in Drools. Through this API, you can instantiate, read, and write fields in the declared fact types.</p>
</div>
<div class="paragraph">
<p>The following example code modifies a <code>Person</code> fact type directly from an application:</p>
</div>
<div class="listingblock">
<div class="title">Example application code to handle a declared fact type through the FactType API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Date;

import org.kie.api.definition.type.FactType;
import org.kie.api.KieBase;
import org.kie.api.runtime.KieSession;

...

// Get a reference to a KIE base with the declared type:
KieBase kbase = ...

// Get the declared fact type:
FactType personType = kbase.getFactType("org.drools.examples", "Person");

// Create instances:
Object bob = personType.newInstance();

// Set attribute values:
personType.set(bob, "name", "Bob" );
personType.set(bob, "dateOfBirth", new Date());
personType.set(bob, "address", new Address("King's Road","London","404"));

// Insert the fact into a KIE session:
KieSession ksession = ...
ksession.insert(bob);
ksession.fireAllRules();

// Read attributes:
String name = (String) personType.get(bob, "name");
Date date = (Date) personType.get(bob, "dateOfBirth");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API also includes other helpful methods, such as setting all the attributes at once, reading values from a <code>Map</code> collection, or reading all attributes at once into a <code>Map</code> collection.</p>
</div>
<div class="paragraph">
<p>Although the API behavior is similar to Java reflection, the API does not use reflection and relies on more performant accessors that are implemented with generated bytecode.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-globals-con_drl-rules"><a class="anchor" href="#drl-globals-con_drl-rules"></a><a class="link" href="#drl-globals-con_drl-rules">4.1.6. Global variables in DRL</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/global.png" alt="global">
</div>
<div class="title">Figure 52. Global</div>
</div>
<div class="paragraph">
<p>Global variables in DRL files typically provide data or services for the rules, such as application services used in rule consequences, and return data from rules, such as logs or values added in rule consequences. You set the global value in the working memory of the Drools engine through a KIE session configuration or REST operation, declare the global variable above the rules in the DRL file, and then use it in an action (<code>then</code>) part of the rule. For multiple global variables, use separate lines in the DRL file.</p>
</div>
<div class="paragraph">
<p>The following example illustrates a global variable list configuration for the Drools engine and the corresponding global variable definition in the DRL file:</p>
</div>
<div class="listingblock">
<div class="title">Example global list configuration for the Drools engine</div>
<div class="content">
<pre class="highlightjs highlight"><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
KieSession kieSession = kiebase.newKieSession();
kieSession.setGlobal( "myGlobalList", list );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example global variable definition with a rule</div>
<div class="content">
<pre class="highlightjs highlight"><code>global java.util.List myGlobalList;

rule "Using a global"
  when
    // Empty
  then
    myGlobalList.add( "My global list" );
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use global variables to establish conditions in rules unless a global variable has a constant immutable value. Global variables are not inserted into the working memory of the Drools engine, so the Drools engine cannot track value changes of variables.</p>
</div>
<div class="paragraph">
<p>Do not use global variables to share data between rules. Rules always reason and react to the working memory state, so if you want to pass data from rule to rule, assert the data as facts into the working memory of the Drools engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A use case for a global variable might be an instance of an email service. In your integration code that is calling the Drools engine, you obtain your <code>emailService</code> object and then set it in the working memory of the Drools engine. In the DRL file, you declare that you have a global of type <code>emailService</code> and give it the name <code>"email"</code>, and then in your rule consequences, you can use actions such as <code>email.sendSMS(number, message)</code>.</p>
</div>
<div class="paragraph">
<p>If you declare global variables with the same identifier in multiple packages, then you must set all the packages with the same type so that they all reference the same global value.</p>
</div>
</div>
<div class="sect3">
<h4 id="rules-attributes-ref_drl-rules"><a class="anchor" href="#rules-attributes-ref_drl-rules"></a><a class="link" href="#rules-attributes-ref_drl-rules">4.1.7. Rule attributes in DRL</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="rule attributes">
</div>
<div class="title">Figure 53. Rule attributes</div>
</div>
<div class="paragraph">
<p>Rule attributes are additional specifications that you can add to business rules to modify rule behavior.
In DRL files, you typically define rule attributes above the rule conditions and actions, with multiple attributes on separate lines, in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "rule_name"
    // Attribute
    // Attribute
    when
        // Conditions
    then
        // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table lists the names and supported values of the attributes that you can assign to rules:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Rule attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">An integer defining the priority of the rule. Rules with a higher salience value are given higher priority when ordered in the activation queue.</p>
<p class="tableblock">Example: <code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value. When the option is selected, the rule is enabled. When the option is not selected, the rule is disabled.</p>
<p class="tableblock">Example: <code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code>date-effective</code> attribute.</p>
<p class="tableblock">Example: <code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code>date-expires</code> attribute.</p>
<p class="tableblock">Example: <code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value. When the option is selected, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition. When the condition is not selected, the rule can be looped in these circumstances.</p>
<p class="tableblock">Example: <code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an agenda group to which you want to assign the rule. Agenda groups allow you to partition the agenda to provide more execution control over groups of rules. Only rules in an agenda group that has acquired a focus are able to be activated.</p>
<p class="tableblock">Example: <code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an activation (or XOR) group to which you want to assign the rule. In activation groups, only one rule can be activated. The first rule to fire will cancel all pending activations of all rules in the activation group.</p>
<p class="tableblock">Example: <code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.</p>
<p class="tableblock">Example: <code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling the rule.</p>
<p class="tableblock">Example: <code>timer ( cron:* 0/15 * * * ? )</code>  (every 15 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A <a href="http://www.quartz-scheduler.org/">Quartz</a> calendar definition for scheduling the rule.</p>
<p class="tableblock">Example: <code>calendars "* * 0-7,18-23 ? * *"</code>  (exclude non-business hours)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within agenda groups. When the option is selected, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.</p>
<p class="tableblock">Example: <code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within rule flow groups or agenda groups. When the option is selected, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code>no-loop</code> attribute, because the activation of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.</p>
<p class="tableblock">Example: <code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying a rule flow group. In rule flow groups, rules can fire only when the group is activated by the associated rule flow.</p>
<p class="tableblock">Example: <code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying either <code>JAVA</code> or <code>MVEL</code> as the language to be used for code expressions in the rule. By default, the rule uses the dialect specified at the package level. Any dialect specified here overrides the package dialect setting for the rule.</p>
<p class="tableblock">Example: <code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="drl-timers-calendars-con_drl-rules"><a class="anchor" href="#drl-timers-calendars-con_drl-rules"></a><a class="link" href="#drl-timers-calendars-con_drl-rules">4.1.7.1. Timer and calendar rule attributes in DRL</a></h5>
<div class="paragraph">
<p>Timers and calendars are DRL rule attributes that enable you to apply scheduling and timing constraints to your DRL rules. These attributes require additional configurations depending on the use case.</p>
</div>
<div class="paragraph">
<p>The <code>timer</code> attribute in DRL rules is a string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling a rule and supports the following formats:</p>
</div>
<div class="listingblock">
<div class="title">Timer attribute formats</div>
<div class="content">
<pre class="highlightjs highlight"><code>timer ( int: &lt;initial delay&gt; &lt;repeat interval&gt; )

timer ( cron: &lt;cron expression&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example interval timer attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Run after a 30-second delay
timer ( int: 30s )

// Run every 5 minutes after a 30-second delay each time
timer ( int: 30s 5m )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example cron timer attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Run every 15 minutes
timer ( cron:* 0/15 * * * ? )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interval timers follow the semantics of <code>java.util.Timer</code> objects, with an initial delay and an optional repeat interval. Cron timers follow standard Unix cron expressions.</p>
</div>
<div class="paragraph">
<p>The following example DRL rule uses a cron timer to send an SMS text message every 15 minutes:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rule with a cron timer</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Send SMS message every 15 minutes"
  timer ( cron:* 0/15 * * * ? )
  when
    $a : Alarm( on == true )
  then
    channels[ "sms" ].insert( new Sms( $a.mobileNumber, "The alarm is still on." );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generally, a rule that is controlled by a timer becomes active when the rule is triggered and the rule consequence is executed repeatedly, according to the timer settings. The execution stops when the rule condition no longer matches incoming facts. However, the way the Drools engine handles rules with timers depends on whether the Drools engine is in <em>active mode</em> or in <em>passive mode</em>.</p>
</div>
<div class="paragraph">
<p>By default, the Drools engine runs in <em>passive mode</em> and evaluates rules, according to the defined timer settings, when a user or an application explicitly calls <code>fireAllRules()</code>. Conversely, if a user or application calls <code>fireUntilHalt()</code>, the Drools engine starts in <em>active mode</em> and evaluates rules continually until the user or application explicitly calls <code>halt()</code>.</p>
</div>
<div class="paragraph">
<p>When the Drools engine is in active mode, rule consequences are executed even after control returns from a call to <code>fireUntilHalt()</code> and the Drools engine remains <em>reactive</em> to any changes made to the working memory. For example, removing a fact that was involved in triggering the timer rule execution causes the repeated execution to terminate, and inserting a fact so that some rule matches causes that rule to be executed. However, the Drools engine is not continually <em>active</em>, but is active only after a rule is executed. Therefore, the Drools engine does not react to asynchronous fact insertions until the next execution of a timer-controlled rule. Disposing a KIE session terminates all timer activity.</p>
</div>
<div class="paragraph">
<p>When the Drools engine is in passive mode, rule consequences of timed rules are evaluated only when <code>fireAllRules()</code> is invoked again. However, you can change the default timer-execution behavior in passive mode by configuring the KIE session with a <code>TimedRuleExecutionOption</code> option, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">KIE session configuration to automatically execute timed rules in passive mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExecutionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can additionally set a <code>FILTERED</code> specification on the <code>TimedRuleExecutionOption</code> option that enables you to define a
callback to filter those rules, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">KIE session configuration to filter which timed rules are automatically executed</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( new TimedRuleExecutionOption.FILTERED(new TimedRuleExecutionFilter() {
    public boolean accept(Rule[] rules) {
        return rules[0].getName().equals("MyRule");
    }
}) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>For interval timers, you can also use an expression timer with <code>expr</code> instead of <code>int</code> to define both the delay and interval as an expression instead of a fixed value.</p>
</div>
<div class="paragraph">
<p>The following example DRL file declares a fact type with a delay and period that are then used in the subsequent rule with an expression timer:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with an expression timer</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Bean
  delay   : String = "30s"
  period  : long = 60000
end

rule "Expression timer"
  timer ( expr: $d, $p )
  when
    Bean( $d : delay, $p : period )
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expressions, such as <code>$d</code> and <code>$p</code> in this example, can use any variable defined in the pattern-matching part of the rule. The variable can be any <code>String</code> value that can be parsed into a time duration or any numeric value that is internally converted in a <code>long</code> value for a duration in milliseconds.</p>
</div>
<div class="paragraph">
<p>Both interval and expression timers can use the following optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>start</code> and <code>end</code>: A <code>Date</code> or a <code>String</code> representing a <code>Date</code> or a <code>long</code> value. The value can also be a <code>Number</code> that is transformed into a Java <code>Date</code> in the format <code>new Date( ((Number) n).longValue() )</code>.</p>
</li>
<li>
<p><code>repeat-limit</code>: An integer that defines the maximum number of repetitions allowed by the timer. If both the <code>end</code> and the <code>repeat-limit</code> parameters are set, the timer stops when the first of the two is reached.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example timer attribute with optional <code>start</code>, <code>end</code>, and <code>repeat-limit</code> parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer (int: 30s 1h; start=3-JAN-2020, end=4-JAN-2020, repeat-limit=50)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule is scheduled for every hour, after a delay of 30 seconds each hour, beginning on 3 January 2020 and ending either on 4 January 2020 or when the cycle repeats 50 times.</p>
</div>
<div class="paragraph">
<p>If the system is paused (for example, the session is serialized and then later deserialized), the rule is scheduled only one time to recover from missing activations regardless of how many activations were missed during the pause, and then the rule is subsequently scheduled again to continue in sync with the timer setting.</p>
</div>
<div class="paragraph">
<p>The <code>calendar</code> attribute in DRL rules is a <a href="http://www.quartz-scheduler.org/">Quartz</a> calendar definition for scheduling a rule and supports the following format:</p>
</div>
<div class="listingblock">
<div class="title">Calendar attribute format</div>
<div class="content">
<pre class="highlightjs highlight"><code>calendars "&lt;definition or registered name&gt;"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example calendar attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Exclude non-business hours
calendars "* * 0-7,18-23 ? * *"

// Weekdays only, as registered in the KIE session
calendars "weekday"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can adapt a Quartz calendar based on the Quartz calendar API and then register the calendar in the KIE session, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Adapting a Quartz Calendar</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Calendar weekDayCal = QuartzHelper.quartzCalendarAdapter(org.quartz.Calendar quartzCal)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Registering the calendar in the KIE session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getCalendars().set( "weekday", weekDayCal );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use calendars with standard rules and with rules that use timers. The calendar attribute can contain one or more comma-separated calendar names written as <code>String</code> literals.</p>
</div>
<div class="paragraph">
<p>The following example rules use both calendars and timers to schedule the rules:</p>
</div>
<div class="listingblock">
<div class="title">Example rules with calendars and timers</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Weekdays are high priority"
  calendars "weekday"
  timer ( int:0 1h )
  when
    Alarm()
  then
    send( "priority high - we have an alarm" );
end

rule "Weekends are low priority"
  calendars "weekend"
  timer ( int:0 4h )
  when
    Alarm()
  then
    send( "priority low - we have an alarm" );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-WHEN-con_drl-rules"><a class="anchor" href="#drl-rules-WHEN-con_drl-rules"></a><a class="link" href="#drl-rules-WHEN-con_drl-rules">4.1.8. Rule conditions in DRL (WHEN)</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/rule.png" alt="rule">
</div>
<div class="title">Figure 54. Rule</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/lhs.png" alt="lhs">
</div>
<div class="title">Figure 55. Conditional element in a rule</div>
</div>
<div class="paragraph">
<p>The <code>when</code> part of a DRL rule (also known as the <em>Left Hand Side (LHS)</em> of the rule) contains the conditions that must be met to execute an action. Conditions consist of a series of stated <em>patterns</em> and <em>constraints</em>, with optional <em>bindings</em> and supported rule condition elements (keywords), based on the available data objects in the package. For example, if a bank requires loan applicants to have over 21 years of age, then the <code>when</code> condition of an <code>"Underage"</code> rule would be <code>Applicant( age &lt; 21 )</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
DRL uses <code>when</code> instead of <code>if</code> because <code>if</code> is typically part of a procedural execution flow during which a condition is checked at a specific point in time. In contrast, <code>when</code> indicates that the condition evaluation is not limited to a specific evaluation sequence or point in time, but instead occurs continually at any time. Whenever the condition is met, the actions are executed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the <code>when</code> section is empty, then the conditions are considered to be true and the actions in the <code>then</code> section are executed the first time a <code>fireAllRules()</code> call is made in the Drools engine. This is useful if you want to use rules to set up the Drools engine state.</p>
</div>
<div class="paragraph">
<p>The following example rule uses empty conditions to insert a fact every time the rule is executed:</p>
</div>
<div class="listingblock">
<div class="title">Example rule without conditions</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Always insert applicant"
  when
    // Empty
  then   // Actions to be executed once
    insert( new Applicant() );
end

// The rule is internally rewritten in the following way:

rule "Always insert applicant"
  when
    eval( true )
  then
    insert( new Applicant() );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>If rule conditions use multiple patterns with no defined keyword conjunctions (such as <code>and</code>, <code>or</code>, or <code>not</code>), the default conjunction is <code>and</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example rule without keyword conjunctions</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  when
    application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    // Actions
end

// The rule is internally rewritten in the following way:

rule "Underage"
  when
    application : LoanApplication()
    and Applicant( age &lt; 21 )
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_patterns_and_constraints"><a class="anchor" href="#_patterns_and_constraints"></a><a class="link" href="#_patterns_and_constraints">4.1.8.1. Patterns and constraints</a></h5>
<div class="paragraph">
<p>A <em>pattern</em> in a DRL rule condition is the segment to be matched by the Drools engine. A pattern can potentially match each fact that is inserted into the working memory of the Drools engine. A pattern can also contain <em>constraints</em> to further define the facts to be matched.</p>
</div>
<div class="paragraph">
<p>The railroad diagram below shows the syntax for this:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Pattern.png" alt="Pattern">
</div>
<div class="title">Figure 56. Pattern</div>
</div>
<div class="paragraph">
<p>In the simplest form, with no constraints, a pattern matches a fact of the given type. In the following example, the type is <code>Person</code>, so the pattern will match against all <code>Person</code> objects in the working memory of the Drools engine:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern for a single fact type</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type does not need to be the actual class of some fact object. Patterns can refer to superclasses or even interfaces, potentially matching facts from many different classes. For example, the following pattern matches all objects in the working memory of the Drools engine:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern for all objects</div>
<div class="content">
<pre class="highlightjs highlight"><code>Object() // Matches all objects in the working memory</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parentheses of a pattern enclose the constraints, such as the following constraint on the person&#8217;s age:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with a constraint</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <em>constraint</em> is an expression that returns <code>true</code> or <code>false</code>. Pattern constraints in DRL are essentially Java expressions with some enhancements, such as property access, and some differences, such as <code>equals()</code> and <code>!equals()</code> semantics for <code>==</code> and <code>!=</code> (instead of the usual <code>same</code> and <code>not same</code> semantics).</p>
</div>
<div class="paragraph">
<p>Any JavaBeans property can be accessed directly from pattern constraints. A bean property is exposed internally using a standard JavaBeans getter that takes no arguments and returns something. For example, the <code>age</code> property is written as <code>age</code> in DRL instead of the getter <code>getAge()</code>:</p>
</div>
<div class="listingblock">
<div class="title">DRL constraint syntax with JavaBeans properties</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )

// This is the same as the following getter format:

Person( getAge() == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools uses the standard JDK <code>Introspector</code> class to achieve this mapping, so it follows the standard JavaBeans specification. For optimal Drools engine performance, use the property access format, such as <code>age</code>, instead of using getters explicitly, such as <code>getAge()</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use property accessors to change the state of the object in a way that might affect the rules because the Drools engine caches the results of the match between invocations for higher efficiency.</p>
</div>
<div class="paragraph">
<p>For example, do not use property accessors in the following ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public int getAge() {
    age++; // Do not do this.
    return age;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public int getAge() {
    Date now = DateUtil.now(); // Do not do this.
    return DateUtil.differenceInYears(now, birthday);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of following the second example, insert a fact that wraps the current date in the working memory and update that fact between <code>fireAllRules()</code> as needed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, if the getter of a property cannot be found, the compiler uses the property name as a fallback method name, without arguments:</p>
</div>
<div class="listingblock">
<div class="title">Fallback method if object is not found</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )

// If `Person.getAge()` does not exist, the compiler uses the following syntax:

Person( age() == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also nest access properties in patterns, as shown in the following example. Nested properties are indexed by the Drools engine.</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with nested property access</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( address.houseNumber == 50 )

// This is the same as the following format:

Person( getAddress().getHouseNumber() == 50 )</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In stateful KIE sessions, use nested accessors carefully because the working memory of the Drools engine is not aware of any of the nested values and does not detect when they change. Either consider the nested values immutable while any of their parent references are inserted into the working memory, or, if you want to modify a nested value, mark all of the outer facts as updated. In the previous example, when the <code>houseNumber</code> property changes, any <code>Person</code> with that <code>Address</code> must be marked as updated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use any Java expression that returns a <code>boolean</code> value as a constraint inside the parentheses of a pattern. Java expressions can be mixed with other expression enhancements, such as property access:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with a constraint using property access and Java expression</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can change the evaluation priority by using parentheses, as in any logical or mathematical expression:</p>
</div>
<div class="listingblock">
<div class="title">Example evaluation order of constraints</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age &gt; 100 &amp;&amp; ( age % 10 == 0 ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also reuse Java methods in constraints, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example constraints with reused Java methods</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( Math.round( weight / ( height * height ) ) &lt; 25.0 )</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use constraints to change the state of the object in a way that might affect the rules because the Drools engine caches the results of the match between invocations for higher efficiency. Any method that is executed on a fact in the rule conditions must be a read-only method. Also, the state of a fact should not change between rule invocations unless those facts are marked as updated in the working memory on every change.</p>
</div>
<div class="paragraph">
<p>For example, do not use a pattern constraint in the following ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person( incrementAndGetAge() == 10 ) // Do not do this.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person( System.currentTimeMillis() % 1000 == 0 ) // Do not do this.</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Standard Java operator precedence applies to constraint operators in DRL, and DRL operators follow standard Java semantics except for the <code>==</code> and <code>!=</code> operators.</p>
</div>
<div class="paragraph">
<p>The <code>==</code> operator uses null-safe <code>equals()</code> semantics instead of the usual <code>same</code> semantics. For example, the pattern <code>Person( firstName == "John" )</code> is similar to <code>java.util.Objects.equals(person.getFirstName(), "John")</code>, and because <code>"John"</code> is not null, the pattern is also similar to <code>"John".equals(person.getFirstName())</code>.</p>
</div>
<div class="paragraph">
<p>The <code>!=</code> operator uses null-safe <code>!equals()</code> semantics instead of the usual <code>not same</code> semantics. For example, the pattern <code>Person( firstName != "John" )</code> is similar to <code>!java.util.Objects.equals(person.getFirstName(), "John")</code>.</p>
</div>
<div class="paragraph">
<p>If the field and the value of a constraint are of different types, the Drools engine uses type coercion to resolve the conflict and reduce compilation errors. For instance, if <code>"ten"</code> is provided as a string in a numeric evaluator, a compilation error occurs, whereas <code>"10"</code> is coerced to a numeric 10. In coercion, the field type always takes precedence over the value type:</p>
</div>
<div class="listingblock">
<div class="title">Example constraint with a value that is coerced</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == "10" ) // "10" is coerced to 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>For groups of constraints, you can use a delimiting comma <code>,</code> to use implicit <code>and</code> connective semantics:</p>
</div>
<div class="listingblock">
<div class="title">Example patterns with multiple constraints</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Person is at least 50 years old and weighs at least 80 kilograms:
Person( age &gt; 50, weight &gt; 80 )

// Person is at least 50 years old, weighs at least 80 kilograms, and is taller than 2 meters:
Person( age &gt; 50, weight &gt; 80, height &gt; 2 )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although the <code>&amp;&amp;</code> and <code>,</code> operators have the same semantics, they are resolved with different priorities. The <code>&amp;&amp;</code> operator precedes the <code>||</code> operator, and both the <code>&amp;&amp;</code> and <code>||</code> operators together precede the <code>,</code> operator. Use the comma operator at the top-level constraint for optimal Drools engine performance and human readability.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You cannot embed a comma operator in a composite constraint expression, such as in parentheses:</p>
</div>
<div class="listingblock">
<div class="title">Example of misused comma in composite constraint expression</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Do not use the following format:
Person( ( age &gt; 50, weight &gt; 80 ) || height &gt; 2 )

// Use the following format instead:
Person( ( age &gt; 50 &amp;&amp; weight &gt; 80 ) || height &gt; 2 )</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bound_variables_in_patterns_and_constraints"><a class="anchor" href="#_bound_variables_in_patterns_and_constraints"></a><a class="link" href="#_bound_variables_in_patterns_and_constraints">4.1.8.2. Bound variables in patterns and constraints</a></h5>
<div class="paragraph">
<p>You can bind variables to patterns and constraints to refer to matched objects in other portions of a rule. Bound variables can help you define rules more efficiently or more consistently with how you annotate facts in your data model. To differentiate more easily between variables and fields in a rule, use the standard format <code>$variable</code> for variables, especially in complex rules. This convention is helpful but not required in DRL.</p>
</div>
<div class="paragraph">
<p>For example, the following DRL rule uses the variable <code>$p</code> for a pattern with the <code>Person</code> fact:</p>
</div>
<div class="listingblock">
<div class="title">Pattern with a bound variable</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "simple rule"
  when
    $p : Person()
  then
    System.out.println( "Person " + $p );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can also bind variables to properties in pattern constraints, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// Two persons of the same age:
Person( $firstAge : age ) // Binding
Person( age == $firstAge ) // Constraint expression</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you separate constraint bindings and constraint expressions for clearer and more efficient rule definitions. Although mixed bindings and expressions are supported, they can complicate patterns and affect evaluation efficiency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// Do not use the following format:
Person( $age : age * 2 &lt; 100 )

// Use the following format instead:
Person( age * 2 &lt; 100, $age : age )</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Drools engine does not support bindings to the same declaration, but does support <em>unification</em> of arguments across several properties. While positional arguments are always processed with unification, the unification symbol <code>:=</code> exists for named arguments.</p>
</div>
<div class="paragraph">
<p>The following example patterns unify the <code>age</code> property across two <code>Person</code> facts:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with unification</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( $age := age )
Person( $age := age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unification declares a binding for the first occurrence and constrains to the same value of the bound field for sequence occurrences.</p>
</div>
</div>
<div class="sect4">
<h5 id="_nested_constraints_and_inline_casts"><a class="anchor" href="#_nested_constraints_and_inline_casts"></a><a class="link" href="#_nested_constraints_and_inline_casts">4.1.8.3. Nested constraints and inline casts</a></h5>
<div class="paragraph">
<p>In some cases, you might need to access multiple properties of a nested object, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern to access multiple properties</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( name == "mark", address.city == "london", address.country == "uk" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can group these property accessors to nested objects with the syntax <code>.( &lt;constraints&gt; )</code> for more readable rules, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with grouped constraints</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( name == "mark", address.( city == "london", country == "uk") )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The period prefix <code>.</code> differentiates the nested object constraints from a method call.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you work with nested objects in patterns, you can use the syntax <code>&lt;type&gt;#&lt;subtype&gt;</code> to cast to a subtype and make the getters from the parent type available to the subtype. You can use either the object name or fully qualified class name, and you can cast to one or multiple subtypes, as shown in the following examples:</p>
</div>
<div class="listingblock">
<div class="title">Example patterns with inline casting to a subtype</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Inline casting with subtype name:
Person( name == "mark", address#LongAddress.country == "uk" )

// Inline casting with fully qualified class name:
Person( name == "mark", address#org.domain.LongAddress.country == "uk" )

// Multiple inline casts:
Person( name == "mark", address#LongAddress.country#DetailedCountry.population &gt; 10000000 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>These example patterns cast <code>Address</code> to <code>LongAddress</code>, and additionally to <code>DetailedCountry</code> in the last example, making the parent getters available to the subtypes in each case.</p>
</div>
<div class="paragraph">
<p>You can use the <code>instanceof</code> operator to infer the results of the specified type in subsequent uses of that field with the pattern, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person( name == "mark", address instanceof LongAddress, address.country == "uk" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an inline cast is not possible (for example, if <code>instanceof</code> returns <code>false</code>), the evaluation is considered <code>false</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_date_literal_in_constraints"><a class="anchor" href="#_date_literal_in_constraints"></a><a class="link" href="#_date_literal_in_constraints">4.1.8.4. Date literal in constraints</a></h5>
<div class="paragraph">
<p>By default, the Drools engine supports the date format <code>dd-mmm-yyyy</code>. You can customize the date format, including a time format mask if needed, by providing an alternative format mask with the system property <code>drools.dateformat="dd-mmm-yyyy hh:mm"</code>. You can also customize the date format by changing the language locale with the <code>drools.defaultlanguage</code> and <code>drools.defaultcountry</code> system properties (for example, the locale of Thailand is set as <code>drools.defaultlanguage=th</code> and <code>drools.defaultcountry=TH</code>).</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with a date literal restriction</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( bornBefore &lt; "27-Oct-2009" )</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_auto_boxing_and_primitive_types"><a class="anchor" href="#_auto_boxing_and_primitive_types"></a><a class="link" href="#_auto_boxing_and_primitive_types">4.1.8.5. Auto-boxing and primitive types</a></h5>
<div class="paragraph">
<p>Drools attempts to preserve numbers in their primitive or object wrapper form, so a variable bound to an int primitive when used in a code block or expression will no longer need manual unboxing; unlike early Drools versions where all primitives were autoboxed, requiring manual unboxing.
A variable bound to an object wrapper will remain as an object; the existing JDK 1.5 and JDK 5 rules to handle auto-boxing and unboxing apply in this case.
When evaluating field constraints, the system attempts to coerce one of the values into a comparable format; so a primitive is comparable to an object wrapper.</p>
</div>
</div>
<div class="sect4">
<h5 id="drl-operators-ref_drl-rules"><a class="anchor" href="#drl-operators-ref_drl-rules"></a><a class="link" href="#drl-operators-ref_drl-rules">4.1.8.6. Supported operators in DRL pattern constraints</a></h5>
<div class="paragraph">
<p>DRL supports standard Java semantics for operators in pattern constraints, with some exceptions and with some additional operators that are unique in DRL. The following list summarizes the operators that are handled differently in DRL constraints than in standard Java semantics or that are unique in DRL constraints.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>.()</code>, <code>#</code></dt>
<dd>
<p>Use the <code>.()</code> operator to group property accessors to nested objects, and use the <code>#</code> operator to cast to a subtype in nested objects. Casting to a subtype makes the getters from the parent type available to the subtype. You can use either the object name or fully qualified class name, and you can cast to one or multiple subtypes.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example patterns with nested objects</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Ungrouped property accessors:
Person( name == "mark", address.city == "london", address.country == "uk" )

// Grouped property accessors:
Person( name == "mark", address.( city == "london", country == "uk") )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The period prefix <code>.</code> differentiates the nested object constraints from a method call.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example patterns with inline casting to a subtype</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Inline casting with subtype name:
Person( name == "mark", address#LongAddress.country == "uk" )

// Inline casting with fully qualified class name:
Person( name == "mark", address#org.domain.LongAddress.country == "uk" )

// Multiple inline casts:
Person( name == "mark", address#LongAddress.country#DetailedCountry.population &gt; 10000000 )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>!.</code></dt>
<dd>
<p>Use this operator to dereference a property in a null-safe way. The value to the left of the <code>!.</code> operator must be not null (interpreted as <code>!= null</code>) in order to give a positive result for pattern matching.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint with null-safe dereferencing</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( $streetName : address!.street )

// This is internally rewritten in the following way:

Person( address != null, $streetName : address.street )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>[]</code></dt>
<dd>
<p>Use this operator to access a <code>List</code> value by index or a <code>Map</code> value by key.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>List</code> and <code>Map</code> access</div>
<div class="content">
<pre class="highlightjs highlight"><code>// The following format is the same as `childList(0).getAge() == 18`:
Person(childList[0].age == 18)

// The following format is the same as `credentialMap.get("jdoe").isValid()`:
Person(credentialMap["jdoe"].valid)</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code></dt>
<dd>
<p>Use these operators on properties with natural ordering. For example, for <code>Date</code> fields, the <code>&lt;</code> operator means <em>before</em>, and for <code>String</code> fields, the operator means <em>alphabetically before</em>. These properties apply only to comparable properties.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>before</code> operator</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( birthDate &lt; $otherBirthDate )

Person( firstName &lt; $otherFirstName )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>==</code>, <code>!=</code></dt>
<dd>
<p>Use these operators as <code>equals()</code> and <code>!equals()</code> methods in constraints, instead of the usual <code>same</code> and <code>not same</code> semantics.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint with null-safe equality</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( firstName == "John" )

// This is similar to the following formats:

java.util.Objects.equals(person.getFirstName(), "John")
"John".equals(person.getFirstName())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example constraint with null-safe not equality</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( firstName != "John" )

// This is similar to the following format:

!java.util.Objects.equals(person.getFirstName(), "John")</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>&amp;&amp;</code>, <code>||</code></dt>
<dd>
<p>Use these operators to create an abbreviated combined relation condition that adds more than one restriction on a field. You can group constraints with parentheses <code>()</code> to create a recursive syntax pattern.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with abbreviated combined relation</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Simple abbreviated combined relation condition using a single `&amp;&amp;`:
Person(age &gt; 30 &amp;&amp; &lt; 40)

// Complex abbreviated combined relation using groupings:
Person(age ((&gt; 30 &amp;&amp; &lt; 40) || (&gt; 20 &amp;&amp; &lt; 25)))

// Mixing abbreviated combined relation with constraint connectives:
Person(age &gt; 30 &amp;&amp; &lt; 40 || location == "london")</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/abbreviatedCombinedRelationCondition.png" alt="abbreviatedCombinedRelationCondition">
</div>
<div class="title">Figure 57. Abbreviated combined relation condition</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/abbreviatedCombinedRelationConditionGroup.png" alt="abbreviatedCombinedRelationConditionGroup">
</div>
<div class="title">Figure 58. Abbreviated combined relation condition withparentheses</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>matches</code>, <code>not matches</code></dt>
<dd>
<p>Use these operators to indicate that a field matches or does not match a specified Java regular expression. Typically, the regular expression is a <code>String</code> literal, but variables that resolve to a valid regular expression are also supported. These operators apply only to <code>String</code> properties. If you use <code>matches</code> against a <code>null</code> value, the resulting evaluation is always <code>false</code>. If you use <code>not matches</code> against a <code>null</code> value, the resulting evaluation is always <code>true</code>. As in Java, regular expressions that you write as <code>String</code> literals must use a double backslash <code>\\</code> to escape.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint to match or not match a regular expression</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( country matches "(USA)?\\S*UK" )

Person( country not matches "(USA)?\\S*UK" )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>contains</code>, <code>not contains</code></dt>
<dd>
<p>Use these operators to verify whether a field that is an <code>Array</code> or a <code>Collection</code> contains or does not contain a specified value. These operators apply to <code>Array</code> or <code>Collection</code> properties, but you can also use these operators in place of <code>String.contains()</code> and <code>!String.contains()</code> constraints checks.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>contains</code> and <code>not contains</code> for a Collection</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Collection with a specified field:
FamilyTree( countries contains "UK" )

FamilyTree( countries not contains "UK" )


// Collection with a variable:
FamilyTree( countries contains $var )

FamilyTree( countries not contains $var )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example constraints with <code>contains</code> and <code>not contains</code> for a String literal</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Sting literal with a specified field:
Person( fullName contains "Jr" )

Person( fullName not contains "Jr" )


// String literal with a variable:
Person( fullName contains $var )

Person( fullName not contains $var )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backward compatibility, the <code>excludes</code> operator is a supported synonym for <code>not contains</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>memberOf</code>, <code>not memberOf</code></dt>
<dd>
<p>Use these operators to verify whether a field is a member of or is not a member of an <code>Array</code> or a <code>Collection</code> that is defined as a variable. The <code>Array</code> or <code>Collection</code> must be a variable.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>memberOf</code> and <code>not memberOf</code> with a Collection</div>
<div class="content">
<pre class="highlightjs highlight"><code>FamilyTree( person memberOf $europeanDescendants )

FamilyTree( person not memberOf $europeanDescendants )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>soundslike</code></dt>
<dd>
<p>Use this operator to verify whether a word has almost the same sound, using English pronunciation, as the given value (similar to the <code>matches</code> operator). This operator uses the Soundex algorithm.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint with <code>soundslike</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>// Match firstName "Jon" or "John":
Person( firstName soundslike "John" )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>str</code></dt>
<dd>
<p>Use this operator to verify whether a field that is a <code>String</code> starts with or ends with a specified value. You can also use this operator to verify the length of the <code>String</code>.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>str</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>// Verify what the String starts with:
Message( routingValue str[startsWith] "R1" )

// Verify what the String ends with:
Message( routingValue str[endsWith] "R2" )

// Verify the length of the String:
Message( routingValue str[length] 17 )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>in</code>, <code>notin</code></dt>
<dd>
<p>Use these operators to specify more than one possible value to match in a constraint (compound value restriction). This functionality of compound value restriction is supported only in the <code>in</code> and <code>not in</code> operators. The second operand of these operators must be a comma-separated list of values enclosed in parentheses. You can provide values as variables, literals, return values, or qualified identifiers. These operators are internally rewritten as a list of multiple restrictions using the operators <code>==</code> or <code>!=</code>.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/compoundValueRestriction.png" alt="compoundValueRestriction">
</div>
<div class="title">Figure 59. compoundValueRestriction</div>
</div>
<div class="listingblock">
<div class="title">Example constraints with <code>in</code> and <code>notin</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( $color : favoriteColor )
Color( type in ( "red", "blue", $color ) )

Person( $color : favoriteColor )
Color( type notin ( "red", "blue", $color ) )</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-operator-precedence-ref_drl-rules"><a class="anchor" href="#drl-operator-precedence-ref_drl-rules"></a><a class="link" href="#drl-operator-precedence-ref_drl-rules">4.1.8.7. Operator precedence in DRL pattern constraints</a></h5>
<div class="paragraph">
<p>DRL supports standard Java operator precedence for applicable constraint operators, with some exceptions and with some additional operators that are unique in DRL. The following table lists DRL operator precedence where applicable, from highest to lowest precedence:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Operator precedence in DRL pattern constraints</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Operator type</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Operators</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Nested or null-safe property access</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>.()</code>, <code>!.</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>List</code> or <code>Map</code> access</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Constraint binding</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>:</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Multiplicative</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>*</code>, <code>/%</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Additive</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>+</code>, <code>-</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Shift</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>&gt;&gt;</code>, <code>&gt;&gt;&gt;</code>, <code>&lt;&lt;</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Relational</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>instanceof</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Equality</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>== !=</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Uses <code>equals()</code> and <code>!equals()</code> semantics, not standard Java <code>same</code> and <code>not same</code> semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Non-short-circuiting <code>AND</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Non-short-circuiting exclusive <code>OR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Non-short-circuiting inclusive <code>OR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Logical <code>AND</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Logical <code>OR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Ternary</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>? :</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Comma-separated <code>AND</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>,</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="drl-rules-WHEN-elements-ref_drl-rules"><a class="anchor" href="#drl-rules-WHEN-elements-ref_drl-rules"></a><a class="link" href="#drl-rules-WHEN-elements-ref_drl-rules">4.1.8.8. Supported rule condition elements in DRL (keywords)</a></h5>
<div class="paragraph">
<p>DRL supports the following rule condition elements (keywords) that you can use with the patterns that you define in DRL rule conditions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>and</code></dt>
<dd>
<p>Use this to group conditional components into a logical conjunction. Infix and prefix <code>and</code> are supported. You can group patterns explicitly with parentheses <code>()</code>. By default, all listed patterns are combined with <code>and</code> when no conjunction is specified.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/infixAnd.png" alt="infixAnd">
</div>
<div class="title">Figure 60. infixAnd</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/prefixAnd.png" alt="prefixAnd">
</div>
<div class="title">Figure 61. prefixAnd</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>and</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>//Infix `and`:
Color( colorType : type ) and Person( favoriteColor == colorType )

//Infix `and` with grouping:
(Color( colorType : type ) and (Person( favoriteColor == colorType ) or Person( favoriteColor == colorType ))

// Prefix `and`:
(and Color( colorType : type ) Person( favoriteColor == colorType ))

// Default implicit `and`:
Color( colorType : type )
Person( favoriteColor == colorType )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use a leading declaration binding with the <code>and</code> keyword (as you can with <code>or</code>, for example). A declaration can only reference a single fact at a time, and if you use a declaration binding with <code>and</code>, then when <code>and</code> is satisfied, it matches both facts and results in an error.</p>
</div>
<div class="listingblock">
<div class="title">Example misuse of <code>and</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>// Causes compile error:
$person : (Person( name == "Romeo" ) and Person( name == "Juliet"))</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>or</code></dt>
<dd>
<p>Use this to group conditional components into a logical disjunction. Infix and prefix <code>or</code> are supported. You can group patterns explicitly with parentheses <code>()</code>. You can also use pattern binding with <code>or</code>, but each pattern must be bound separately.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/infixOr.png" alt="infixOr">
</div>
<div class="title">Figure 62. infixOr</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/prefixOr.png" alt="prefixOr">
</div>
<div class="title">Figure 63. prefixOr</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>or</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>//Infix `or`:
Color( colorType : type ) or Person( favoriteColor == colorType )

//Infix `or` with grouping:
(Color( colorType : type ) or (Person( favoriteColor == colorType ) and Person( favoriteColor == colorType ))

// Prefix `or`:
(or Color( colorType : type ) Person( favoriteColor == colorType ))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>or</code> and pattern binding</div>
<div class="content">
<pre class="highlightjs highlight"><code>pensioner : (Person( sex == "f", age &gt; 60 ) or Person( sex == "m", age &gt; 65 ))

(or pensioner : Person( sex == "f", age &gt; 60 )
    pensioner : Person( sex == "m", age &gt; 65 ))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the <code>or</code> condition element is different from the connective <code>||</code> operator for constraints and restrictions in field constraints. The Drools engine does not directly interpret the <code>or</code> element but uses logical transformations to rewrite a rule with <code>or</code> as a number of sub-rules. This process ultimately results in a rule that has a single <code>or</code> as the root node and one sub-rule for each of its condition elements. Each sub-rule is activated and executed like any normal rule, with no special behavior or interaction between the sub-rules.</p>
</div>
<div class="paragraph">
<p>Therefore, consider the <code>or</code> condition element a shortcut for generating two or more similar rules that, in turn, can create multiple activations when two or more terms of the disjunction are true.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>exists</code></dt>
<dd>
<p>Use this to specify facts and constraints that must exist. This option is triggered on only the first match, not subsequent matches. If you use this element with multiple patterns, enclose the patterns with parentheses <code>()</code>.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/exists.png" alt="exists">
</div>
<div class="title">Figure 64. Exists</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>exists</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>exists Person( firstName == "John")

exists (Person( firstName == "John", age == 42 ))

exists (Person( firstName == "John" ) and
        Person( lastName == "Doe" ))</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>not</code></dt>
<dd>
<p>Use this to specify facts and constraints that must not exist. If you use this element with multiple patterns, enclose the patterns with parentheses <code>()</code>.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/not.png" alt="not">
</div>
<div class="title">Figure 65. Not</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>not</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>not Person( firstName == "John")

not (Person( firstName == "John", age == 42 ))

not (Person( firstName == "John" ) and
     Person( lastName == "Doe" ))</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>forall</code></dt>
<dd>
<p>Use this to verify whether all facts that match the first pattern match all the remaining patterns. When a <code>forall</code> construct is satisfied, the rule evaluates to <code>true</code>. This element is a scope delimiter, so it can use any previously bound variable, but no variable bound inside of it is available for use outside of it.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/forall.png" alt="forall">
</div>
<div class="title">Figure 66. Forall</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "All full-time employees have red ID badges"
  when
    forall( $emp : Employee( type == "fulltime" )
                   Employee( this == $emp, badgeColor = "red" ) )
  then
    // True, all full-time employees have red ID badges.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule selects all <code>Employee</code> objects whose type is <code>"fulltime"</code>. For each fact that matches this pattern, the rule evaluates the patterns that follow (badge color) and if they match, the rule evaluates to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>To state that all facts of a given type in the working memory of the Drools engine must match a set of constraints, you can use <code>forall</code> with a single pattern for simplicity.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code> and a single pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "All full-time employees have red ID badges"
  when
    forall( Employee( badgeColor = "red" ) )
  then
    // True, all full-time employees have red ID badges.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>forall</code> constructs with multiple patterns or nest them with other condition elements, such as inside a <code>not</code> element construct.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code> and multiple patterns</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "All employees have health and dental care programs"
  when
    forall( $emp : Employee()
            HealthCare( employee == $emp )
            DentalCare( employee == $emp )
          )
  then
    // True, all employees have health and dental care.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code> and <code>not</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Not all employees have health and dental care"
  when
    not ( forall( $emp : Employee()
                  HealthCare( employee == $emp )
                  DentalCare( employee == $emp ) )
        )
  then
    // True, not all employees have health and dental care.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The format <code>forall( p1 p2 p3 &#8230;&#8203;)</code> is equivalent to <code>not( p1 and not( and p2 p3 &#8230;&#8203; ) )</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>from</code></dt>
<dd>
<p>Use this to specify a data source for a pattern. This enables the Drools engine to reason over data that is not in the working memory. The data source can be a sub-field on a bound variable or the result of a method call. The expression used to define the object source is any expression that follows regular MVEL syntax. Therefore, the <code>from</code> element enables you to easily use object property navigation, execute method calls, and access maps and collection elements.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/from.png" alt="from">
</div>
<div class="title">Figure 67. from</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> and pattern binding</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Validate zipcode"
  when
    Person( $personAddress : address )
    Address( zipcode == "23920W" ) from $personAddress
  then
    // Zip code is okay.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> and a graph notation</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Validate zipcode"
  when
    $p : Person()
    $a : Address( zipcode == "23920W" ) from $p.address
  then
    // Zip code is okay.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> to iterate over all objects</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply 10% discount to all items over US$ 100 in an order"
  when
    $order : Order()
    $item  : OrderItem( value &gt; 100 ) from $order.items
  then
    // Apply discount to `$item`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For large collections of objects, instead of adding an object with a large graph that the Drools engine must iterate over frequently, add the collection directly to the KIE session and then join the collection in the condition, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  $order : Order()
  OrderItem( value &gt; 100, order == $order )</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> and <code>lock-on-active</code> rule attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Assign people in North Carolina (NC) to sales region 1"
  ruleflow-group "test"
  lock-on-active true
  when
    $p : Person()
    $a : Address( state == "NC" ) from $p.address
  then
    modify ($p) {} // Assign the person to sales region 1.
end

rule "Apply a discount to people in the city of Raleigh"
  ruleflow-group "test"
  lock-on-active true
  when
    $p : Person()
    $a : Address( city == "Raleigh" ) from $p.address
  then
    modify ($p) {} // Apply discount to the person.
end</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using <code>from</code> with <code>lock-on-active</code> rule attribute can result in rules not being executed. You can address this issue in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid using the <code>from</code> element when you can insert all facts into the working memory of the Drools engine or use nested object references in your constraint expressions.</p>
</li>
<li>
<p>Place the variable used in the <code>modify()</code> block as the last sentence in your rule condition.</p>
</li>
<li>
<p>Avoid using the <code>lock-on-active</code> rule attribute when you can explicitly manage how rules within the same ruleflow group place activations on one another.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The pattern that contains a <code>from</code> clause cannot be followed by another pattern starting with a parenthesis. The reason for this restriction is that the DRL parser reads the <code>from</code> expression as <code>"from $l (String() or Number())"</code> and it cannot differentiate this expression from a function call. The simplest workaround to this is to wrap the <code>from</code> clause in parentheses, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rules with <code>from</code> used incorrectly and correctly</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Do not use `from` in this way:
rule R
  when
    $l : List()
    String() from $l
    (String() or Number())
  then
    // Actions
end

// Use `from` in this way instead:
rule R
  when
    $l : List()
    (String() from $l)
    (String() or Number())
  then
    // Actions
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>entry-point</code></dt>
<dd>
<p>Use this to define an entry point, or <em>event stream</em>, corresponding to a data source for the pattern. This element is typically used with the <code>from</code> condition element. You can declare an entry point for events so that the Drools engine uses data from only that entry point to evaluate the rules. You can declare an entry point either implicitly by referencing it in DRL rules or explicitly in your Java application.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with <code>from entry-point</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Authorize withdrawal"
  when
    WithdrawRequest( $ai : accountId, $am : amount ) from entry-point "ATM Stream"
    CheckingAccount( accountId == $ai, balance &gt; $am )
  then
    // Authorize withdrawal.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java application code with EntryPoint object and inserted facts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.KieSession;
import org.kie.api.runtime.rule.EntryPoint;

// Create your KIE base and KIE session as usual:
KieSession session = ...

// Create a reference to the entry point:
EntryPoint atmStream = session.getEntryPoint("ATM Stream");

// Start inserting your facts into the entry point:
atmStream.insert(aWithdrawRequest);</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>collect</code></dt>
<dd>
<p>Use this to define a collection of objects that the rule can use as part of the condition. The rule obtains the collection either from a specified source or from the working memory of the Drools engine. The result pattern of the <code>collect</code> element can be any concrete class that implements the <code>java.util.Collection</code> interface and provides a default no-arg public constructor. You can use Java collections like <code>List</code>, <code>LinkedList</code>, and <code>HashSet</code>, or your own class. If variables are bound before the <code>collect</code> element in a condition, you can use the variables to constrain both your source and result patterns. However, any binding made inside the <code>collect</code> element is not available for use outside of it.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/collect.png" alt="collect">
</div>
<div class="title">Figure 68. Collect</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>collect</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.List

rule "Raise priority when system has more than three pending alarms"
  when
    $system : System()
    $alarms : List( size &gt;= 3 )
              from collect( Alarm( system == $system, status == 'pending' ) )
  then
    // Raise priority because `$system` has three or more `$alarms` pending.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule assesses all pending alarms in the working memory of the Drools engine for each given system and groups them in a <code>List</code>. If three or more alarms are found for a given system, the rule is executed.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>collect</code> element with nested <code>from</code> elements, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>collect</code> and nested <code>from</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.LinkedList;

rule "Send a message to all parents"
  when
    $town : Town( name == 'Paris' )
    $mothers : LinkedList()
               from collect( Person( children &gt; 0 )
                             from $town.getPeople()
                           )
  then
    // Send a message to all parents.
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code></dt>
<dd>
<p>Use this to iterate over a collection of objects, execute custom actions for each of the elements, and return one or more result objects (if the constraints evaluate to <code>true</code>). This element is a more flexible and powerful form of the <code>collect</code> condition element. You can use predefined functions in your <code>accumulate</code> conditions or implement custom functions as needed. You can also use the abbreviation <code>acc</code> for <code>accumulate</code> in rule conditions.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use the following format to define <code>accumulate</code> conditions in rules:</p>
</div>
<div class="listingblock">
<div class="title">Preferred format for <code>accumulate</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>accumulate( &lt;source pattern&gt;; &lt;functions&gt; [;&lt;constraints&gt;] )</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/accumulate.png" alt="accumulate">
</div>
<div class="title">Figure 69. Accumulate</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although the Drools engine supports alternate formats for the <code>accumulate</code> element for backward compatibility, this format is preferred for optimal performance in rules and applications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Drools engine supports the following predefined <code>accumulate</code> functions. These functions accept any expression as input.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>average</code></p>
</li>
<li>
<p><code>min</code></p>
</li>
<li>
<p><code>max</code></p>
</li>
<li>
<p><code>count</code></p>
</li>
<li>
<p><code>sum</code></p>
</li>
<li>
<p><code>collectList</code></p>
</li>
<li>
<p><code>collectSet</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example rule, <code>min</code>, <code>max</code>, and <code>average</code> are <code>accumulate</code> functions that calculate the minimum, maximum, and average temperature values over all the readings for each sensor:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>accumulate</code> to calculate temperature values</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Raise alarm"
  when
    $s : Sensor()
    accumulate( Reading( sensor == $s, $temp : temperature );
                $min : min( $temp ),
                $max : max( $temp ),
                $avg : average( $temp );
                $min &lt; 20, $avg &gt; 70 )
  then
    // Raise the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example rule uses the <code>average</code> function with <code>accumulate</code> to calculate the average profit for all items in an order:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>accumulate</code> to calculate average profit</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Average profit"
  when
    $order : Order()
    accumulate( OrderItem( order == $order, $cost : cost, $price : price );
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$order` is `$avgProfit`.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use custom, domain-specific functions in <code>accumulate</code> conditions, create a Java class that implements the <code>org.kie.api.runtime.rule.AccumulateFunction</code> interface. For example, the following Java class defines a custom implementation of an <code>AverageData</code> function:</p>
</div>
<div class="listingblock">
<div class="title">Example Java class with custom implementation of <code>average</code> function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// An implementation of an accumulator capable of calculating average values

public class AverageAccumulateFunction implements org.kie.api.runtime.rule.AccumulateFunction&lt;AverageAccumulateFunction.AverageData&gt; {

    public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {

    }

    public void writeExternal(ObjectOutput out) throws IOException {

    }

    public static class AverageData implements Externalizable {
        public int    count = 0;
        public double total = 0;

        public AverageData() {}

        public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
            count   = in.readInt();
            total   = in.readDouble();
        }

        public void writeExternal(ObjectOutput out) throws IOException {
            out.writeInt(count);
            out.writeDouble(total);
        }

    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#createContext()
     */
    public AverageData createContext() {
        return new AverageData();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#init(java.io.Serializable)
     */
    public void init(AverageData context) {
        context.count = 0;
        context.total = 0;
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#accumulate(java.io.Serializable, java.lang.Object)
     */
    public void accumulate(AverageData context,
                           Object value) {
        context.count++;
        context.total += ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#reverse(java.io.Serializable, java.lang.Object)
     */
    public void reverse(AverageData context, Object value) {
        context.count--;
        context.total -= ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResult(java.io.Serializable)
     */
    public Object getResult(AverageData context) {
        return new Double( context.count == 0 ? 0 : context.total / context.count );
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#supportsReverse()
     */
    public boolean supportsReverse() {
        return true;
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResultType()
     */
    public Class&lt; ? &gt; getResultType() {
        return Number.class;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the custom function in a DRL rule, import the function using the <code>import accumulate</code> statement:</p>
</div>
<div class="listingblock">
<div class="title">Format to import a custom function</div>
<div class="content">
<pre class="highlightjs highlight"><code>import accumulate &lt;class_name&gt; &lt;function_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with the imported <code>average</code> function</div>
<div class="content">
<pre class="highlightjs highlight"><code>import accumulate AverageAccumulateFunction.AverageData average

rule "Average profit"
  when
    $order : Order()
    accumulate( OrderItem( order == $order, $cost : cost, $price : price );
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$order` is `$avgProfit`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For backward compatibility, the Drools engine also supports the configuration of <code>accumulate</code> functions through configuration files and system properties, but this is a deprecated method. To configure the <code>average</code> function from the previous example using the configuration file or system property, set a property as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.accumulate.function.average = AverageAccumulateFunction.AverageData</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>drools.accumulate.function</code> is a required prefix, <code>average</code> is how the function is used in the DRL files, and <code>AverageAccumulateFunction.AverageData</code> is the fully qualified name of the class that implements the function behavior.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code> alternate syntax for a single function with return type</dt>
<dd>
<p>The accumulate syntax evolved over time with the goal of becoming more compact and expressive.
Nevertheless, Drools still supports previous syntaxes for backward compatibility purposes.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In case the rule is using a single accumulate function on a given accumulate, the author may add a pattern for the result object and use the "from" keyword to link it to the accumulate result.</p>
</div>
<div class="paragraph">
<p>Example: a rule to apply a 10% discount on orders over $100 could be written in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 )
             from accumulate( OrderItem( order == $order, $value : value ),
                              sum( $value ) )
then
    // apply discount to $order
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the accumulate element is using only one function (sum), and so, the rules author opted to explicitly write a pattern for the result type of the accumulate function (Number) and write the constraints inside it.
There are no problems in using this syntax over the compact syntax presented before, except that is is a bit more verbose.
Also note that it is not allowed to use both the return type and the functions binding in the same accumulate statement.</p>
</div>
<div class="paragraph">
<p>Compile-time checks are performed in order to ensure the pattern used with the "<code>from</code>" keyword is  assignable from the result of the accumulate function used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With this syntax, the "<code>from</code>" binds to the single result returned by the accumulate function, and it does not iterate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example, "<code>$total</code>" is bound to the result returned by the accumulate sum() function.</p>
</div>
<div class="paragraph">
<p>As another example however, if the result of the accumulate function is a collection, "<code>from</code>" still binds to the single result and it does not iterate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Person names"
when
  $x : Object() from accumulate(MyPerson( $val : name );
                                collectList( $val ) )
then
  // $x is a List
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bound "<code>$x : Object()</code>" is the List itself, returned by the collectList accumulate function used.</p>
</div>
<div class="paragraph">
<p>This is an important distinction to highlight, as the "<code>from</code>" keyword can also be used separately of accumulate, to iterate over the elements of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Iterate the numbers"
when
    $xs : List()
    $x : Integer() from $xs
then
  // $x matches and binds to each Integer in the collection
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this syntax is still supported for backward compatibility purposes, for this and other reasons we encourage rule authors to make use instead of the preferred <code>accumulate</code> syntax (described previously), to avoid any potential pitfalls.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code> with inline custom code</dt>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of accumulate with inline custom code is not a good practice for several reasons, including difficulties on maintaining and testing rules that use them, as well as the inability of reusing that code.
Implementing your own accumulate functions is very simple and straightforward, they are easy to unit test and to use.
This form of accumulate is supported for backward compatibility only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Another possible syntax for the <code>accumulate</code> is to define inline custom code, instead of using accumulate functions.
As noted on the previous warned, this is discouraged though for the stated reasons.</p>
</div>
<div class="paragraph">
<p>The general syntax of the <code>accumulate</code> CE with inline custom code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;result pattern&gt; from accumulate( &lt;source pattern&gt;,
                                  init( &lt;init code&gt; ),
                                  action( &lt;action code&gt; ),
                                  reverse( &lt;reverse code&gt; ),
                                  result( &lt;result expression&gt; ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The meaning of each of the elements is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>&lt;source pattern&gt;</em>: the source pattern is a regular pattern that the Drools engine will try to match against each of the source objects.</p>
</li>
<li>
<p><em>&lt;init code&gt;</em>: this is a semantic block of code in the selected dialect that will be executed once for each tuple, before iterating over the source objects.</p>
</li>
<li>
<p><em>&lt;action code&gt;</em>: this is a semantic block of code in the selected dialect that will be executed for each of the source objects.</p>
</li>
<li>
<p><em>&lt;reverse code&gt;</em>: this is an optional semantic block of code in the selected dialect that if present will be executed for each source object that no longer matches the source pattern. The objective of this code block is to undo any calculation done in the <em>&lt;action code&gt;</em> block, so that the Drools engine can do decremental calculation when a source object is modified or deleted, hugely improving performance of these operations.</p>
</li>
<li>
<p><em>&lt;result expression&gt;</em>: this is a semantic expression in the selected dialect that is executed after all source objects are iterated.</p>
</li>
<li>
<p><em>&lt;result pattern&gt;</em>: this is a regular pattern that the Drools engine tries to match against the object returned from the <em>&lt;result expression&gt;</em>. If it matches, the <code>accumulate</code> conditional element evaluates to <em>true</em> and the Drools engine proceeds with the evaluation of the next CE in the rule. If it does not matches, the <code>accumulate</code> CE evaluates to <em>false</em> and the Drools engine stops evaluating CEs for that rule.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is easier to understand if we look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 )
             from accumulate( OrderItem( order == $order, $value : value ),
                              init( double total = 0; ),
                              action( total += $value; ),
                              reverse( total -= $value; ),
                              result( total ) )
then
    // apply discount to $order
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, for each <code>Order</code> in the Working Memory, the Drools engine will execute the <em>init
          code</em> initializing the total variable to zero.
Then it will iterate over all <code>OrderItem</code> objects for that order, executing the <em>action</em> for each one (in the example, it will sum the value of all items into the total variable). After iterating over all <code>OrderItem</code> objects, it will return the value corresponding to the <em>result
          expression</em> (in the above example, the value of variable <code>total</code>). Finally, the Drools engine will try to match the result with the <code>Number</code> pattern, and if the double value is greater than 100, the rule will fire.</p>
</div>
<div class="paragraph">
<p>The example used Java as the semantic dialect, and as such, note that the usage of the semicolon as statement delimiter is mandatory in the init, action and reverse code blocks.
The result is an expression and, as such, it does not admit ';'. If the user uses any other dialect, he must comply to that dialect&#8217;s specific syntax.</p>
</div>
<div class="paragraph">
<p>As mentioned before, the <em>reverse code</em> is optional, but it is strongly recommended that the user writes it in order to benefit from the <em>improved performance on update
          and delete</em>.</p>
</div>
<div class="paragraph">
<p>The <code>accumulate</code> CE can be used to execute any action on source objects.
The following example instantiates and populates a custom object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Accumulate using custom objects"
when
    $person   : Person( $likes : likes )
    $cheesery : Cheesery( totalAmount &gt; 100 )
                from accumulate( $cheese : Cheese( type == $likes ),
                                 init( Cheesery cheesery = new Cheesery(); ),
                                 action( cheesery.addCheese( $cheese ); ),
                                 reverse( cheesery.removeCheese( $cheese ); ),
                                 result( cheesery ) );
then
    // do something
end</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>eval</code></dt>
<dd>
<p>The conditional element <code>eval</code> is essentially a catch-all which allows any semantic code (that returns a primitive boolean) to be executed.
This code can refer to variables that were bound in the conditions of the rule and functions in the rule package.
Overuse of <code>eval</code> reduces the declarativeness of your rules and can result in a poorly performing Drools engine.
While <code>eval</code> can be used anywhere in the patterns, it is typically added as the last conditional element in the conditions of a rule.</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/eval.png" alt="eval">
</div>
<div class="title">Figure 70. Eval</div>
</div>
<div class="paragraph">
<p>Instances of <code>eval</code> cannot be indexed and thus are not as efficient as Field Constraints.
However this makes them ideal for being used when functions return values that change over time, which is not allowed within Field Constraints.</p>
</div>
<div class="paragraph">
<p>For those who are familiar with Drools 2.x lineage, the old Drools parameter and condition tags are equivalent to binding a variable to an appropriate type, and then using it in an <code>eval</code> node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>p1 : Parameter()
p2 : Parameter()
eval( p1.getList().containsKey( p2.getItem() ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>p1 : Parameter()
p2 : Parameter()
// call function isValid in the LHS
eval( isValid( p1, p2 ) )</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-oopath-con_drl-rules"><a class="anchor" href="#drl-rules-oopath-con_drl-rules"></a><a class="link" href="#drl-rules-oopath-con_drl-rules">4.1.8.9. OOPath syntax with graphs of objects in DRL rule conditions</a></h5>
<div class="paragraph">
<p>OOPath is an object-oriented syntax extension of XPath that is designed for browsing graphs of objects in DRL rule condition constraints. OOPath uses the compact notation from XPath for navigating through related elements while handling collections and filtering constraints, and is specifically useful for graphs of objects.</p>
</div>
<div class="paragraph">
<p>When the field of a fact is a collection, you can use the <code>from</code> condition element (keyword) to bind and reason over all the items in that collection one by one. If you need to browse a graph of objects in the rule condition constraints, the extensive use of the <code>from</code> condition element results in a verbose and repetitive syntax, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule that browses a graph of objects with <code>from</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam"
  when
    $student: Student( $plan: plan )
    $exam: Exam( course == "Big Data" ) from $plan.exams
    $grade: Grade() from $exam.grades
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the domain model contains a <code>Student</code> object with a <code>Plan</code> of study. The <code>Plan</code> can have zero or more <code>Exam</code> instances and an <code>Exam</code> can have zero or more <code>Grade</code> instances. Only the root object of the graph, the <code>Student</code> in this case, needs to be in the working memory of the Drools engine for this rule setup to function.</p>
</div>
<div class="paragraph">
<p>As a more efficient alternative to using extensive <code>from</code> statements, you can use the abbreviated OOPath syntax, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule that browses a graph of objects with OOPath syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam"
  when
    Student( $grade: /plan/exams[course == "Big Data"]/grades )
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Formally, the core grammar of an OOPath expression is defined in extended Backus-Naur form (EBNF) notation in the following way:</p>
</div>
<div class="listingblock">
<div class="title">EBNF notation for OOPath expressions</div>
<div class="content">
<pre class="highlightjs highlight"><code>OOPExpr = [ID ( ":" | ":=" )] ( "/" | "?/" ) OOPSegment { ( "/" | "?/" | "." ) OOPSegment } ;
OOPSegment = ID ["#" ID] ["[" ( Number | Constraints ) "]"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice, an OOPath expression has the following features and capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starts with a forward slash <code>/</code> or with a question mark and forward slash <code>?/</code> if it is a non-reactive OOPath expression (described later in this section).</p>
</li>
<li>
<p>Can dereference a single property of an object with the period <code>.</code> operator.</p>
</li>
<li>
<p>Can dereference multiple properties of an object with the forward slash <code>/</code> operator. If a collection is returned, the expression iterates over the values in the collection.</p>
</li>
<li>
<p>Can filter out traversed objects that do not satisfy one or more constraints. The constraints are written as predicate expressions between square brackets, as shown in the following example:</p>
<div class="listingblock">
<div class="title">Constraints as a predicate expression</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[ course == "Big Data" ]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>Can downcast a traversed object to a subclass of the class declared in the generic collection. Subsequent constraints can also safely access the properties declared only in that subclass, as shown in the following example. Objects that are not instances of the class specified in this inline cast are automatically filtered out.</p>
<div class="listingblock">
<div class="title">Constraints with downcast objects</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams#AdvancedExam[ course == "Big Data", level &gt; 3 ]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>Can backreference an object of the graph that was traversed before the currently iterated graph. For example, the following OOPath expression matches only the grades that are above the average for the passed exam:</p>
<div class="listingblock">
<div class="title">Constraints with backreferenced object</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams/grades[ result &gt; ../averageResult ] )</code></pre>
</div>
</div>
</li>
<li>
<p>Can recursively be another OOPath expression, as shown in the following example:</p>
<div class="listingblock">
<div class="title">Recursive constraint expression</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $exam: /plan/exams[ /grades[ result &gt; 20 ] ] )</code></pre>
</div>
</div>
</li>
<li>
<p>Can access objects by their index between square brackets <code>[]</code>, as shown in the following example. To adhere to Java convention, OOPath indexes are 0-based, while XPath indexes are 1-based.</p>
<div class="listingblock">
<div class="title">Constraints with access to objects by index</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[0]/grades )</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>OOPath expressions can be reactive or non-reactive. The Drools engine does not react to updates involving a deeply nested object that is traversed during the evaluation of an OOPath expression.</p>
</div>
<div class="paragraph">
<p>To make these objects reactive to changes, modify the objects to extend the class <code>org.drools.core.phreak.ReactiveObject</code>. After you modify an object to extend the <code>ReactiveObject</code> class, the domain object invokes the inherited method <code>notifyModification</code> to notify the Drools engine when one of the fields has been updated, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example object method to notify the Drools engine that an exam has been moved to a different course</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setCourse(String course) {
        this.course = course;
        notifyModification(this);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the following corresponding OOPath expression, when an exam is moved to a different course, the rule is re-executed and the list of grades matching the rule is recomputed:</p>
</div>
<div class="listingblock">
<div class="title">Example OOPath expression from "Big Data" rule</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[ course == "Big Data" ]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>?/</code> separator instead of the <code>/</code> separator to disable reactivity in only one sub-portion of an OOPath expression, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example OOPath expression that is partially non-reactive</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[ course == "Big Data" ]?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this example, the Drools engine reacts to a change made to an exam or if an exam is added to the plan, but not if a new grade is added to an existing exam.</p>
</div>
<div class="paragraph">
<p>If an OOPath portion is non-reactive, all remaining portions of the OOPath expression also become non-reactive. For example, the following OOPath expression is completely non-reactive:</p>
</div>
<div class="listingblock">
<div class="title">Example OOPath expression that is completely non-reactive</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: ?/plan/exams[ course == "Big Data" ]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this reason, you cannot use the <code>?/</code> separator more than once in the same OOPath expression. For example, the following expression causes a compilation error:</p>
</div>
<div class="listingblock">
<div class="title">Example OOPath expression with duplicate non-reactivity markers</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan?/exams[ course == "Big Data" ]?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another alternative for enabling OOPath expression reactivity is to use the dedicated implementations for <code>List</code> and <code>Set</code> interfaces in Drools. These implementations are the <code>ReactiveList</code> and <code>ReactiveSet</code> classes. A <code>ReactiveCollection</code> class is also available. The implementations also provide reactive support for performing mutable operations through the <code>Iterator</code> and <code>ListIterator</code> classes.</p>
</div>
<div class="paragraph">
<p>The following example class uses these classes to configure OOPath expression reactivity:</p>
</div>
<div class="listingblock">
<div class="title">Example Java class to configure OOPath expression reactivity</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School extends AbstractReactiveObject {
    private String name;
    private final List&lt;Child&gt; children = new ReactiveList&lt;Child&gt;(); <i class="conum" data-value="1"></i><b>(1)</b>

    public void setName(String name) {
        this.name = name;
        notifyModification(); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    public void addChild(Child child) {
        children.add(child); <i class="conum" data-value="3"></i><b>(3)</b>
        // No need to call `notifyModification()` here
    }
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Uses the <code>ReactiveList</code> instance for reactive support over the standard Java <code>List</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the required <code>notifyModification()</code> method for when a field is changed in reactive support.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>children</code> field is a <code>ReactiveList</code> instance, so the <code>notifyModification()</code> method call is not required. The notification is handled automatically, like all other mutating operations performed over the <code>children</code> field.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-WHEN-elements-diagrams-ref_drl-rules"><a class="anchor" href="#drl-rules-WHEN-elements-diagrams-ref_drl-rules"></a><a class="link" href="#drl-rules-WHEN-elements-diagrams-ref_drl-rules">4.1.8.10. Railroad diagrams for rule condition elements in DRL</a></h5>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AccumulateAction.png" alt="AccumulateAction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AccumulateClause.png" alt="AccumulateClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AccumulateFunction.png" alt="AccumulateFunction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AccumulateInit.png" alt="AccumulateInit">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AccumulateResult.png" alt="AccumulateResult">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AccumulateReverse.png" alt="AccumulateReverse">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AccumulateSteps.png" alt="AccumulateSteps">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Accumulations.png" alt="Accumulations">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AdditiveExpr.png" alt="AdditiveExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Annotation.png" alt="Annotation">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Arguments.png" alt="Arguments">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ArrayCreatorRest.png" alt="ArrayCreatorRest">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ArrayInitializer.png" alt="ArrayInitializer">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/AssignmentOperator.png" alt="AssignmentOperator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/BindingPattern.png" alt="BindingPattern">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Block.png" alt="Block">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/BooleanLiteral.png" alt="BooleanLiteral">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/CompilationUnit.png" alt="CompilationUnit">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalAnd.png" alt="ConditionalAnd">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalElementAccumulate.png" alt="ConditionalElementAccumulate">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalElementEval.png" alt="ConditionalElementEval">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalElementExists.png" alt="ConditionalElementExists">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalElementForall.png" alt="ConditionalElementForall">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalElementNot.png" alt="ConditionalElementNot">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalElement.png" alt="ConditionalElement">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalExpr.png" alt="ConditionalExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalOrExpr.png" alt="ConditionalOrExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ConditionalOr.png" alt="ConditionalOr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Constraints.png" alt="Constraints">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/CreatedName.png" alt="CreatedName">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Creator.png" alt="Creator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Definition.png" alt="Definition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Digit.png" alt="Digit">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ExplicitGenericInvocationSuffix.png" alt="ExplicitGenericInvocationSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ExplicitGenericInvocation.png" alt="ExplicitGenericInvocation">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Exponent.png" alt="Exponent">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ExpressionList.png" alt="ExpressionList">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Expression.png" alt="Expression">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Field.png" alt="Field">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Fraction.png" alt="Fraction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/FromAccumulateClause.png" alt="FromAccumulateClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/FromClause.png" alt="FromClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/FromCollectClause.png" alt="FromCollectClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/FunctionDefinition.png" alt="FunctionDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/GlobalDefinition.png" alt="GlobalDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/IdentifierSuffix.png" alt="IdentifierSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ImportDefinition.png" alt="ImportDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/InExpr.png" alt="InExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/InlineListExpr.png" alt="InlineListExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/InlineMapExpr.png" alt="InlineMapExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/InnerCreator.png" alt="InnerCreator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/InstanceOfExpr.png" alt="InstanceOfExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/IntLiteral.png" alt="IntLiteral">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Literal.png" alt="Literal">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ModifyStatement.png" alt="ModifyStatement">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/NonWildcardTypeArguments.png" alt="NonWildcardTypeArguments">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/OrRestriction.png" alt="OrRestriction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/OverClause.png" alt="OverClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Parameters.png" alt="Parameters">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Pattern.png" alt="Pattern">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Placeholders.png" alt="Placeholders">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Primary.png" alt="Primary">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/PrimitiveType.png" alt="PrimitiveType">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/QualifiedName.png" alt="QualifiedName">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/QueryDefinition.png" alt="QueryDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/QueryOptions.png" alt="QueryOptions">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RealLiteral.png" alt="RealLiteral">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RealTypeSuffix.png" alt="RealTypeSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RelationalExpr.png" alt="RelationalExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RelationalOperator.png" alt="RelationalOperator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RhsStatement.png" alt="RhsStatement">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RuleAttributes.png" alt="RuleAttributes">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RuleAttribute.png" alt="RuleAttribute">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RuleDefinition.png" alt="RuleDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/RuleOptions.png" alt="RuleOptions">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Selector.png" alt="Selector">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ShiftExpr.png" alt="ShiftExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/SingleRestriction.png" alt="SingleRestriction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/SourcePattern.png" alt="SourcePattern">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/StringId.png" alt="StringId">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/SuperSuffix.png" alt="SuperSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/ThenPart.png" alt="ThenPart">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/TypeArguments.png" alt="TypeArguments">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/TypeArgument.png" alt="TypeArgument">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/TypeDefinition.png" alt="TypeDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/TypeOptions.png" alt="TypeOptions">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Type.png" alt="Type">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/UnaryExprNotPlusMinus.png" alt="UnaryExprNotPlusMinus">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/UnaryExpr.png" alt="UnaryExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/Value.png" alt="Value">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/VariableInitializer.png" alt="VariableInitializer">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/WhenPart.png" alt="WhenPart">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-THEN-con_drl-rules"><a class="anchor" href="#drl-rules-THEN-con_drl-rules"></a><a class="link" href="#drl-rules-THEN-con_drl-rules">4.1.9. Rule actions in DRL (THEN)</a></h4>
<div class="paragraph">
<p>The <code>then</code> part of the rule (also known as the <em>Right Hand Side (RHS)</em> of the rule) contains the actions to be performed when the conditional part of the rule has been met. Actions consist of one or more <em>methods</em> that execute consequences based on the rule conditions and on available data objects in the package. For example, if a bank requires loan applicants to have over 21 years of age (with a rule condition <code>Applicant( age &lt; 21 )</code>) and a loan applicant is under 21 years old, the <code>then</code> action of an <code>"Underage"</code> rule would be <code>setApproved( false )</code>, declining the loan because the applicant is under age.</p>
</div>
<div class="paragraph">
<p>The main purpose of rule actions is to to insert, delete, or modify data in the working memory of the Drools engine. Effective rule actions are small, declarative, and readable. If you need to use imperative or conditional code in rule actions, then divide the rule into multiple smaller and more declarative rules.</p>
</div>
<div class="listingblock">
<div class="title">Example rule for loan application age limit</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  when
    application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    application.setApproved( false );
    application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-methods-ref_drl-rules"><a class="anchor" href="#drl-rules-THEN-methods-ref_drl-rules"></a><a class="link" href="#drl-rules-THEN-methods-ref_drl-rules">4.1.9.1. Supported rule action methods in DRL</a></h5>
<div class="paragraph">
<p>DRL supports the following rule action methods that you can use in DRL rule actions. You can use these methods to modify the working memory of the Drools engine without having to first reference a working memory instance. These methods act as shortcuts to the methods provided by the <code>KnowledgeHelper</code> class in your Drools distribution.</p>
</div>
<div class="paragraph">
<p>For all rule action methods,
see the Drools <a href="https://github.com/kiegroup/drools/blob/7.26.x/drools-core/src/main/java/org/drools/core/spi/KnowledgeHelper.java">KnowledgeHelper.java</a> page on GitHub.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>set</code></dt>
<dd>
<p>Use this to set the value of a field.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>set&lt;field&gt; ( &lt;value&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to set the values of a loan application approval</div>
<div class="content">
<pre class="highlightjs highlight"><code>$application.setApproved ( false );
$application.setExplanation( "has been bankrupt" );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>modify</code></dt>
<dd>
<p>Use this to specify fields to be modified for a fact and to notify the Drools engine of the change. This method provides a structured approach to fact updates. It combines the <code>update</code> operation with setter calls to change object fields.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>modify ( &lt;fact-expression&gt; ) {
    &lt;expression&gt;,
    &lt;expression&gt;,
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to modify a loan application amount and approval</div>
<div class="content">
<pre class="highlightjs highlight"><code>modify( LoanApplication ) {
        setAmount( 100 ),
        setApproved ( true )
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>update</code></dt>
<dd>
<p>Use this to specify fields and the entire related fact to be updated and to notify the Drools engine of the change. After a fact has changed, you must call <code>update</code> before changing another fact that might be affected by the updated values. To avoid this added step, use the <code>modify</code> method instead.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>update ( &lt;object, &lt;handle&gt; )  // Informs the Drools engine that an object has changed

update ( &lt;object&gt; )  // Causes `KieSession` to search for a fact handle of the object</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to update a loan application amount and approval</div>
<div class="content">
<pre class="highlightjs highlight"><code>LoanApplication.setAmount( 100 );
update( LoanApplication );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you provide property-change listeners, you do not need to call this method when an object changes. For more information about property-change listeners, see
<a href="#property-change-listeners-con_decision-engine">Property-change settings and listeners for fact types</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>insert</code></dt>
<dd>
<p>Use this to insert a <code>new</code> fact into the working memory of the Drools engine and to define resulting fields and values as needed for the fact.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insert( new &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to insert a new loan applicant object</div>
<div class="content">
<pre class="highlightjs highlight"><code>insert( new Applicant() );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>insertLogical</code></dt>
<dd>
<p>Use this to insert a <code>new</code> fact logically into the Drools engine. The Drools engine is responsible for logical decisions on insertions and retractions of facts. After regular or stated insertions, facts must be retracted explicitly. After logical insertions, the facts that were inserted are automatically retracted when the conditions in the rules that inserted the facts are no longer true.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insertLogical( new &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to logically insert a new loan applicant object</div>
<div class="content">
<pre class="highlightjs highlight"><code>insertLogical( new Applicant() );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>delete</code></dt>
<dd>
<p>Use this to remove an object from the Drools engine. The keyword <code>retract</code> is also supported in DRL and executes the same action, but <code>delete</code> is typically preferred in DRL code for consistency with the keyword <code>insert</code>.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>delete( &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to delete a loan applicant object</div>
<div class="content">
<pre class="highlightjs highlight"><code>delete( Applicant );</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-methods-variables-ref_drl-rules"><a class="anchor" href="#drl-rules-THEN-methods-variables-ref_drl-rules"></a><a class="link" href="#drl-rules-THEN-methods-variables-ref_drl-rules">4.1.9.2. Other rule action methods from <code>drools</code> and <code>kcontext</code> variables</a></h5>
<div class="paragraph">
<p>In addition to the standard rule action methods, the Drools engine supports methods in conjunction with the predefined <code>drools</code> and <code>kcontext</code> variables that you can also use in rule actions.</p>
</div>
<div class="paragraph">
<p>You can use the <code>drools</code> variable to call methods from the <code>KnowledgeHelper</code> class in your Drools distribution, which is also the class that the standard rule action methods are based on. For all <code>drools</code> rule action options,
see the Drools <a href="https://github.com/kiegroup/drools/blob/7.26.x/drools-core/src/main/java/org/drools/core/spi/KnowledgeHelper.java">KnowledgeHelper.java</a> page on GitHub.</p>
</div>
<div class="paragraph">
<p>The following examples are common methods that you can use with the <code>drools</code> variable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.halt()</code>: Terminates rule execution if a user or application has previously called <code>fireUntilHalt()</code>. When a user or application calls <code>fireUntilHalt()</code>, the Drools engine starts in <em>active mode</em> and evaluates rules continually until the user or application explicitly calls <code>halt()</code>. Otherwise, by default, the Drools engine runs in <em>passive mode</em> and evaluates rules only when a user or an application explicitly calls <code>fireAllRules()</code>.</p>
</li>
<li>
<p><code>drools.getWorkingMemory()</code>: Returns the <code>WorkingMemory</code> object.</p>
</li>
<li>
<p><code>drools.setFocus( "&lt;agenda_group&gt;" )</code>: Sets the focus to a specified agenda group to which the rule belongs.</p>
</li>
<li>
<p><code>drools.getRule().getName()</code>: Returns the name of the rule.</p>
</li>
<li>
<p><code>drools.getTuple()</code>, <code>drools.getActivation()</code>: Returns the <code>Tuple</code> that matches the currently executing rule and then delivers the corresponding <code>Activation</code>. These calls are useful for logging and debugging purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the <code>kcontext</code> variable with the <code>getKieRuntime()</code> method to call other methods from the <code>KieContext</code> class and, by extension, the <code>RuleContext</code> class in your Drools distribution. The full Knowledge Runtime API is exposed through the <code>kcontext</code> variable and provides extensive rule action methods. For all <code>kcontext</code> rule action options,
see the Drools <a href="https://github.com/kiegroup/droolsjbpm-knowledge/blob/7.26.x/kie-api/src/main/java/org/kie/api/runtime/rule/RuleContext.java">RuleContext.java</a> page on GitHub.</p>
</div>
<div class="paragraph">
<p>The following examples are common methods that you can use with the <code>kcontext.getKieRuntime()</code> variable-method combination:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kcontext.getKieRuntime().halt()</code>: Terminates rule execution if a user or application has previously called <code>fireUntilHalt()</code>. This method is equivalent to the <code>drools.halt()</code> method. When a user or application calls <code>fireUntilHalt()</code>, the Drools engine starts in <em>active mode</em> and evaluates rules continually until the user or application explicitly calls <code>halt()</code>. Otherwise, by default, the Drools engine runs in <em>passive mode</em> and evaluates rules only when a user or an application explicitly calls <code>fireAllRules()</code>.</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().getAgenda()</code>: Returns a reference to the KIE session <code>Agenda</code>, and in turn provides access to rule activation groups, rule agenda groups, and ruleflow groups.</p>
<div class="listingblock">
<div class="title">Example call to access agenda group "CleanUp" and set the focus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">kcontext.getKieRuntime().getAgenda().getAgendaGroup( "CleanUp" ).setFocus();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example is equivalent to <code>drools.setFocus( "CleanUp" )</code>.</p>
</div>
</li>
<li>
<p><code>kcontext.getKieRuntime().getQueryResults(&lt;string&gt; query)</code>: Runs a query and returns the results. This method is equivalent to <code>drools.getKieRuntime().getQueryResults()</code>.</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().getKieBase()</code>: Returns the <code>KieBase</code> object. The KIE base is the source of all the knowledge in your rule system and the originator of the current KIE session.</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().setGlobal()</code>, <code>~.getGlobal()</code>, <code>~.getGlobals()</code>: Sets or retrieves global variables.</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().getEnvironment()</code>: Returns the runtime <code>Environment</code>, similar to your operating system environment.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-advanced-con_drl-rules"><a class="anchor" href="#drl-rules-THEN-advanced-con_drl-rules"></a><a class="link" href="#drl-rules-THEN-advanced-con_drl-rules">4.1.9.3. Advanced rule actions with conditional and named consequences</a></h5>
<div class="paragraph">
<p>In general, effective rule actions are small, declarative, and readable. However, in some cases, the limitation of having a single consequence for each rule can be challenging and lead to verbose and repetitive rule syntax, as shown in the following example rules:</p>
</div>
<div class="listingblock">
<div class="title">Example rules with verbose and repetitive syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give 10% discount to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
  then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>A partial solution to the repetition is to make the second rule extend the first rule, as shown in the following modified example:</p>
</div>
<div class="listingblock">
<div class="title">Partially enhanced example rules with an extended condition</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give 10% discount to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
  then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
    extends "Give 10% discount to customers older than 60"
  when
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a more efficient alternative, you can consolidate the two rules into a single rule with modified conditions and labelled corresponding rule actions, as shown in the following consolidated example:</p>
</div>
<div class="listingblock">
<div class="title">Consolidated example rule with conditional and named consequences</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give 10% discount and free parking to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
    do[giveDiscount]
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
  then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example rule uses two actions: the usual default action and another action named <code>giveDiscount</code>. The <code>giveDiscount</code> action is activated in the condition with the keyword <code>do</code> when a customer older than 60 years old is found in the KIE base, regardless of whether or not the customer owns a car.</p>
</div>
<div class="paragraph">
<p>You can configure the activation of a named consequence with an additional condition, such as the <code>if</code> statement in the following example. The condition in the <code>if</code> statement is always evaluated on the pattern that immediately precedes it.</p>
</div>
<div class="listingblock">
<div class="title">Consolidated example rule with an additional condition</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give free parking to customers older than 60 and 10% discount to golden ones among them"
  when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount]
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
  then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also evaluate different rule conditions using a nested <code>if</code> and <code>else if</code> construct, as shown in the following more complex example:</p>
</div>
<div class="listingblock">
<div class="title">Consolidated example rule with more complex conditions</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give free parking and 10% discount to over 60 Golden customer and 5% to Silver ones"
  when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount10]
    else if ( type == "Silver" ) break[giveDiscount5]
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
  then[giveDiscount10]
    modify($customer) { setDiscount( 0.1 ) };
  then[giveDiscount5]
    modify($customer) { setDiscount( 0.05 ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example rule gives a 10% discount and free parking to Golden customers over 60, but only a 5% discount without free parking to Silver customers. The rule activates the consequence named <code>giveDiscount5</code> with the keyword <code>break</code> instead of <code>do</code>. The keyword <code>do</code> schedules a consequence in the Drools engine agenda, enabling the remaining part of the rule conditions to continue being evaluated, while <code>break</code> blocks any further condition evaluation. If a named consequence does not correspond to any condition with <code>do</code> but is activated with <code>break</code>, the rule fails to compile because the conditional part of the rule is never reached.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-comments-con_drl-rules"><a class="anchor" href="#drl-rules-comments-con_drl-rules"></a><a class="link" href="#drl-rules-comments-con_drl-rules">4.1.10. Comments in DRL files</a></h4>
<div class="paragraph">
<p>DRL supports single-line comments prefixed with a double forward slash <code>//</code> and multi-line comments enclosed with a forward slash and asterisk <code>/* &#8230;&#8203; */</code>. You can use DRL comments to annotate rules or any related components in DRL files. DRL comments are ignored by the Drools engine when the DRL file is processed.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with comments</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  // This is a single-line comment.
  when
    $application : LoanApplication()  // This is an in-line comment.
    Applicant( age &lt; 21 )
  then
    /* This is a multi-line comment
    in the rule actions. */
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/multi_line_comment.png" alt="multi line comment">
</div>
<div class="title">Figure 71. Multi-line comment</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The hash symbol <code>#</code> is not supported for DRL comments.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-errors-ref_drl-rules"><a class="anchor" href="#drl-rules-errors-ref_drl-rules"></a><a class="link" href="#drl-rules-errors-ref_drl-rules">4.1.11. Error messages for DRL troubleshooting</a></h4>
<div class="paragraph">
<p>Drools provides standardized messages for DRL errors to help you troubleshoot and resolve problems in your DRL files. The error messages use the following format:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/error_message.png" alt="error message">
</div>
<div class="title">Figure 72. Error message format for DRL file problems</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>1st Block:</strong> Error code</p>
</li>
<li>
<p><strong>2nd Block:</strong> Line and column in the DRL source where the error occurred</p>
</li>
<li>
<p><strong>3rd Block:</strong> Description of the problem</p>
</li>
<li>
<p><strong>4th Block:</strong> Component in the DRL source (rule, function, query) where the error occurred</p>
</li>
<li>
<p><strong>5th Block:</strong> Pattern in the DRL source where the error occurred (if applicable)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools supports the following standardized error messages:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">101: no viable alternative</dt>
<dd>
<p>Indicates that the parser reached a decision point but could not identify an alternative.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with incorrect spelling</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "simple rule"
2:   when
3:     exists Person()
4:     exits Student()  // Must be `exists`
5:   then
6: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 101] Line 4:4 no viable alternative at input 'exits' in rule "simple rule"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule without a rule name</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: package org.drools.examples;
2: rule    // Must be `rule "rule name"` (or `rule rule_name` if no spacing)
3:   when
4:     Object()
5:   then
6:     System.out.println("A RHS");
7: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 101] Line 3:2 no viable alternative at input 'when'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the parser encountered the keyword <code>when</code> but expected the rule name, so it flags <code>when</code> as the incorrect expected token.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with incorrect syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "simple rule"
2:   when
3:     Student( name == "Andy )  // Must be `"Andy"`
4:   then
5: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 101] Line 0:-1 no viable alternative at input '&lt;eof&gt;' in rule "simple rule" in pattern Student</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A line and column value of <code>0:-1</code> means the parser reached the end of the source file (<code>&lt;eof&gt;</code>) but encountered incomplete constructs, usually due to missing quotation marks <code>"&#8230;&#8203;"</code>, apostrophes <code>'&#8230;&#8203;'</code>, or parentheses <code>(&#8230;&#8203;)</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">102: mismatched input</dt>
<dd>
<p>Indicates that the parser expected a particular symbol that is missing at the current input position.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with an incomplete rule statement</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule simple_rule
2:   when
3:     $p : Person(
        // Must be a complete rule statement</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 102] Line 0:-1 mismatched input '&lt;eof&gt;' expecting ')' in rule "simple rule" in pattern Person</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A line and column value of <code>0:-1</code> means the parser reached the end of the source file (<code>&lt;eof&gt;</code>) but encountered incomplete constructs, usually due to missing quotation marks <code>"&#8230;&#8203;"</code>, apostrophes <code>'&#8230;&#8203;'</code>, or parentheses <code>(&#8230;&#8203;)</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example rule with incorrect syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: package org.drools.examples;
2:
3: rule "Wrong syntax"
4:   when
5:     not( Car( ( type == "tesla", price == 10000 ) || ( type == "kia", price == 1000 ) ) from $carList )
       // Must use `&amp;&amp;` operators instead of commas `,`
6:   then
7:     System.out.println("OK");
8: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error messages</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 102] Line 5:36 mismatched input ',' expecting ')' in rule "Wrong syntax" in pattern Car
[ERR 101] Line 5:57 no viable alternative at input 'type' in rule "Wrong syntax"
[ERR 102] Line 5:106 mismatched input ')' expecting 'then' in rule "Wrong syntax"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the syntactic problem results in multiple error messages related to each other. The single solution of replacing the commas <code>,</code> with <code>&amp;&amp;</code> operators resolves all errors. If you encounter multiple errors, resolve one at a time in case errors are consequences of previous errors.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">103: failed predicate</dt>
<dd>
<p>Indicates that a validating semantic predicate evaluated to <code>false</code>. These semantic predicates are typically used to identify component keywords in DRL files, such as <code>declare</code>, <code>rule</code>, <code>exists</code>, <code>not</code>, and others.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with an invalid keyword</div>
<div class="content">
<pre class="highlightjs highlight"><code> 1: package nesting;
 2:
 3: import org.drools.compiler.Person
 4: import org.drools.compiler.Address
 5:
 6: Some text  // Must be a valid DRL keyword
 7:
 8: rule "test something"
 9:   when
10:     $p: Person( name=="Michael" )
11:   then
12:     $p.name = "other";
13:     System.out.println(p.name);
14: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 103] Line 6:0 rule 'rule_key' failed predicate: {(validateIdentifierKey(DroolsSoftKeywords.RULE))}? in rule</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Some text</code> line is invalid because it does not begin with or is not a part of a DRL keyword construct, so the parser fails to validate the rest of the DRL file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This error is similar to <code>102: mismatched input</code>, but usually involves DRL keywords.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">104: trailing semi-colon not allowed</dt>
<dd>
<p>Indicates that an <code>eval()</code> clause in a rule condition uses a semicolon <code>;</code> but must not use one.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with <code>eval()</code> and trailing semicolon</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "simple rule"
2:   when
3:     eval( abc(); )  // Must not use semicolon `;`
4:   then
5: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 104] Line 3:4 trailing semi-colon not allowed in rule "simple rule"</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">105: did not match anything</dt>
<dd>
<p>Indicates that the parser reached a sub-rule in the grammar that must match an alternative at least once, but the sub-rule did not match anything. The parser has entered a branch with no way out.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with invalid text in an empty condition</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "empty condition"
2:   when
3:     None  // Must remove `None` if condition is empty
4:   then
5:      insert( new Person() );
6: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 105] Line 2:2 required (...)+ loop did not match anything at input 'WHEN' in rule "empty condition"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the condition is intended to be empty but the word <code>None</code> is used. This error is resolved by removing <code>None</code>, which is not a valid DRL keyword, data type, or pattern construct.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="drl-rule-units-con_drl-rules"><a class="anchor" href="#drl-rule-units-con_drl-rules"></a><a class="link" href="#drl-rule-units-con_drl-rules">4.1.12. Rule units in DRL rule sets</a></h4>
<div class="paragraph">
<p>Rule units are groups of data sources, global variables, and DRL rules that function together for a specific purpose. You can use rule units to partition a rule set into smaller units, bind different data sources to those units, and then execute the individual unit. Rule units are an enhanced alternative to rule-grouping DRL attributes such as rule agenda groups or activation groups for execution control.</p>
</div>
<div class="paragraph">
<p>Rule units are helpful when you want to coordinate rule execution so that the complete execution of one rule unit triggers the start of another rule unit and so on. For example, assume that you have a set of rules for data enrichment, another set of rules that processes that data, and another set of rules that extract the output from the processed data. If you add these rule sets into three distinct rule units, you can coordinate those rule units so that complete execution of the first unit triggers the start of the second unit and the complete execution of the second unit triggers the start of third unit.</p>
</div>
<div class="paragraph">
<p>To define a rule unit, implement the <code>RuleUnit</code> interface as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    private int adultAge;
    private DataSource&lt;Person&gt; persons;

    public AdultUnit( ) { }

    public AdultUnit( DataSource&lt;Person&gt; persons, int age ) {
        this.persons = persons;
        this.age = age;
    }

    // A data source of `Persons` in this rule unit:
    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    // A global variable in this rule unit:
    public int getAdultAge() {
        return adultAge;
    }

    // Life-cycle methods:
    @Override
    public void onStart() {
        System.out.println("AdultUnit started.");
    }

    @Override
    public void onEnd() {
        System.out.println("AdultUnit ended.");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>persons</code> is a source of facts of type <code>Person</code>. A rule unit data source is a source of the data processed by a given rule unit and represents the entry point that the Drools engine uses to evaluate the rule unit. The <code>adultAge</code> global variable is accessible from all the rules belonging to this rule unit. The last two methods are part of the rule unit life cycle and are invoked by the Drools engine.</p>
</div>
<div class="paragraph">
<p>The Drools engine supports the following optional life-cycle methods for rule units:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Rule unit life-cycle methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Method</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Invoked when</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onStart()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution starts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onEnd()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution ends</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onSuspend()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution is suspended (used only with <code>runUntilHalt()</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onResume()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Rule unit execution is resumed (used only with <code>runUntilHalt()</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>onYield(RuleUnit other)</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The consequence of a rule in the rule unit triggers the execution of a different rule unit</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can add one or more rules to a rule unit. By default, all the rules in a DRL file are automatically associated with a rule unit that follows the naming convention of the DRL file name. If the DRL file is in the same package and has the same name as a class that implements the <code>RuleUnit</code> interface, then all of the rules in that DRL file implicitly belong to that rule unit. For example, all the rules in the <code>AdultUnit.drl</code> file in the <code>org.mypackage.myunit</code> package are automatically part of the rule unit <code>org.mypackage.myunit.AdultUnit</code>.</p>
</div>
<div class="paragraph">
<p>To override this naming convention and explicitly declare the rule unit that the rules in a DRL file belong to, use the <code>unit</code> keyword in the DRL file. The <code>unit</code> declaration must immediately follow the package declaration and contain the name of the class in that package that the rules in the DRL file are part of.</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit declaration in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : Person(age &gt;= adultAge) from persons
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not mix rules with and without a rule unit in the same KIE base. Mixing two rule paradigms in a KIE base results in a compilation error.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also rewrite the same pattern in a more convenient way using OOPath notation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit declaration in a DRL file that uses OOPath notation</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : /persons[age &gt;= adultAge]
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OOPath is an object-oriented syntax extension of XPath that is designed for browsing graphs of objects in DRL rule condition constraints. OOPath uses the compact notation from XPath for navigating through related elements while handling collections and filtering constraints, and is specifically useful for graphs of objects.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, any matching facts in the rule conditions are retrieved from the <code>persons</code> data source defined in the <code>DataSource</code> definition in the rule unit class. The rule condition and action use the <code>adultAge</code> variable in the same way that a global variable is defined at the DRL file level.</p>
</div>
<div class="paragraph">
<p>To execute one or more rule units defined in a KIE base, create a new <code>RuleUnitExecutor</code> class bound to the KIE base, create the rule unit from the relevant data source, and run the rule unit executer:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Create a `RuleUnitExecutor` class and bind it to the KIE base:
KieBase kbase = kieContainer.getKieBase();
RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

// Create the `AdultUnit` rule unit using the `persons` data source and run the executor:
RuleUnit adultUnit = new AdultUnit(persons, 18);
executor.run( adultUnit );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rules are executed by the <code>RuleUnitExecutor</code> class. The <code>RuleUnitExecutor</code> class creates KIE sessions and adds the required <code>DataSource</code> objects to those sessions, and then executes the rules based on the <code>RuleUnit</code> that is passed as a parameter to the <code>run()</code> method.</p>
</div>
<div class="paragraph">
<p>The example execution code produces the following output when the relevant <code>Person</code> facts are inserted in the <code>persons</code> data source:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution output</div>
<div class="content">
<pre class="highlightjs highlight"><code>org.mypackage.myunit.AdultUnit started.
Jane is adult and greater than 18
John is adult and greater than 18
org.mypackage.myunit.AdultUnit ended.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of explicitly creating the rule unit instance, you can register the rule unit variables in the executor and pass to the executor the rule unit class that you want to run, and then the executor creates an instance of the rule unit. You can then set the <code>DataSource</code> definition and other variables as needed before running the rule unit.</p>
</div>
<div class="listingblock">
<div class="title">Alternate rule unit execution option with registered variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "persons", persons );
        .bindVariable( "adultAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name that you pass to the <code>RuleUnitExecutor.bindVariable()</code> method is used at run time to bind the variable to the field of the rule unit class with the same name. In the previous example, the <code>RuleUnitExecutor</code> inserts into the new rule unit the data source bound to the <code>"persons"</code> name and inserts the value <code>18</code> bound to the String <code>"adultAge"</code> into the fields with the corresponding names inside the <code>AdultUnit</code> class.</p>
</div>
<div class="paragraph">
<p>To override this default variable-binding behavior, use the <code>@UnitVar</code> annotation to explicitly define a logical binding name for each field of the rule unit class. For example, the field bindings in the following class are redefined with alternative names:</p>
</div>
<div class="listingblock">
<div class="title">Example code to modify variable binding names with <code>@UnitVar</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    @UnitVar("minAge")
    private int adultAge = 18;

    @UnitVar("data")
    private DataSource&lt;Person&gt; persons;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then bind the variables to the executor using those alternative names and run the rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution with modified variable names</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "data", persons );
        .bindVariable( "minAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can execute a rule unit in <em>passive mode</em> by using the <code>run()</code> method (equivalent to invoking <code>fireAllRules()</code> on a KIE session)
or in <em>active mode</em> using the <code>runUntilHalt()</code> method (equivalent to invoking <code>fireUntilHalt()</code> on a KIE session). By default, the Drools engine runs in <em>passive mode</em> and evaluates rule units only when a user or an application explicitly calls <code>run()</code> (or <code>fireAllRules()</code> for standard rules). If a user or application calls <code>runUntilHalt()</code> for rule units (or <code>fireUntilHalt()</code> for standard rules), the Drools engine starts in <em>active mode</em> and evaluates rule units continually until the user or application explicitly calls <code>halt()</code>.</p>
</div>
<div class="paragraph">
<p>If you use the <code>runUntilHalt()</code> method, invoke the method on a separate execution thread to avoid blocking the main thread:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution with <code>runUntilHalt()</code> on a separate thread</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">new Thread( () -&gt; executor.runUntilHalt( adultUnit ) ).start();</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_data_sources_for_rule_units_2"><a class="anchor" href="#_data_sources_for_rule_units_2"></a><a class="link" href="#_data_sources_for_rule_units_2">4.1.12.1. Data sources for rule units</a></h5>
<div class="paragraph">
<p>A rule unit data source is a source of the data processed by a given rule unit and represents the entry point that the Drools engine uses to evaluate the rule unit. A rule unit can have zero or more data sources and each <code>DataSource</code> definition declared inside a rule unit can correspond to a different entry point into the rule unit executor. Multiple rule units can share a single data source, but each rule unit must use different entry points through which the same objects are inserted.</p>
</div>
<div class="paragraph">
<p>You can create a <code>DataSource</code> definition with a fixed set of data in a rule unit class, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example data source definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = DataSource.create( new Person( "John", 42 ),
                                                new Person( "Jane", 44 ),
                                                new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because a data source represents the entry point of the rule unit, you can insert, update, or delete facts in a rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example code to insert, modify, and delete a fact in a rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Insert a fact:
Person john = new Person( "John", 42 );
FactHandle johnFh = persons.insert( john );

// Modify the fact and optionally specify modified properties (for property reactivity):
john.setAge( 43 );
persons.update( johnFh, john, "age" );

// Delete the fact:
persons.delete( johnFh );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_execution_control_2"><a class="anchor" href="#_rule_unit_execution_control_2"></a><a class="link" href="#_rule_unit_execution_control_2">4.1.12.2. Rule unit execution control</a></h5>
<div class="paragraph">
<p>Rule units are helpful when you want to coordinate rule execution so that the execution of one rule unit triggers the start of another rule unit and so on.</p>
</div>
<div class="paragraph">
<p>To facilitate rule unit execution control, the Drools engine supports the following rule unit methods that you can use in DRL rule actions to coordinate the execution of rule units:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.run()</code>: Triggers the execution of a specified rule unit class. This method imperatively interrupts the execution of the rule unit and activates the other specified rule unit.</p>
</li>
<li>
<p><code>drools.guard()</code>: Prevents (guards) a specified rule unit class from being executed until the associated rule condition is met. This method declaratively schedules the execution of the other specified rule unit. When the Drools engine produces at least one match for the condition in the guarding rule, the guarded rule unit is considered active. A rule unit can contain multiple guarding rules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example of the <code>drools.run()</code> method, consider the following DRL rules that each belong to a specified rule unit. The <code>NotAdult</code> rule uses the <code>drools.run( AdultUnit.class )</code> method to trigger the execution of the <code>AdultUnit</code> rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rules with controlled execution using <code>drools.run()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    Person(age &gt;= 18, $name : name) from persons
  then
    System.out.println($name + " is adult");
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit NotAdultUnit

rule NotAdult
  when
    $p : Person(age &lt; 18, $name : name) from persons
  then
    System.out.println($name + " is NOT adult");
    modify($p) { setAge(18); }
    drools.run( AdultUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example also uses a <code>RuleUnitExecutor</code> class created from the KIE base that was built from these rules and a <code>DataSource</code> definition of <code>persons</code> bound to it:</p>
</div>
<div class="listingblock">
<div class="title">Example rule executor and data source definitions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Jane", 44 ),
                                                     new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the example creates the <code>DataSource</code> definition directly from the <code>RuleUnitExecutor</code> class and binds it to the <code>"persons"</code> variable in a single statement.</p>
</div>
<div class="paragraph">
<p>The example execution code produces the following output when the relevant <code>Person</code> facts are inserted in the <code>persons</code> data source:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution output</div>
<div class="content">
<pre class="highlightjs highlight"><code>Sally is NOT adult
John is adult
Jane is adult
Sally is adult</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>NotAdult</code> rule detects a match when evaluating the person <code>"Sally"</code>, who is under 18 years old. The rule then modifies
her age to <code>18</code> and uses the <code>drools.run( AdultUnit.class )</code> method to trigger the execution of the <code>AdultUnit</code> rule unit. The <code>AdultUnit</code> rule unit contains a rule that can now be executed for all of the 3 <code>persons</code> in the <code>DataSource</code> definition.</p>
</div>
<div class="paragraph">
<p>As an example of the <code>drools.guard()</code> method, consider the following <code>BoxOffice</code> class and <code>BoxOfficeUnit</code> rule unit class:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>BoxOffice</code> class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOffice {
    private boolean open;

    public BoxOffice( boolean open ) {
        this.open = open;
    }

    public boolean isOpen() {
        return open;
    }

    public void setOpen( boolean open ) {
        this.open = open;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>BoxOfficeUnit</code> rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOfficeUnit implements RuleUnit {
    private DataSource&lt;BoxOffice&gt; boxOffices;

    public DataSource&lt;BoxOffice&gt; getBoxOffices() {
        return boxOffices;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example also uses the following <code>TicketIssuerUnit</code> rule unit class to keep selling box office tickets for the event as long as at least one box office is open. This rule unit uses <code>DataSource</code> definitions of <code>persons</code> and <code>tickets</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>TicketIssuerUnit</code> rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TicketIssuerUnit implements RuleUnit {
    private DataSource&lt;Person&gt; persons;
    private DataSource&lt;AdultTicket&gt; tickets;

    private List&lt;String&gt; results;

    public TicketIssuerUnit() { }

    public TicketIssuerUnit( DataSource&lt;Person&gt; persons, DataSource&lt;AdultTicket&gt; tickets ) {
        this.persons = persons;
        this.tickets = tickets;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public DataSource&lt;AdultTicket&gt; getTickets() {
        return tickets;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BoxOfficeUnit</code> rule unit contains a <code>BoxOfficeIsOpen</code> DRL rule that uses the <code>drools.guard( TicketIssuerUnit.class )</code> method to guard the execution of the <code>TicketIssuerUnit</code> rule unit that distributes the event tickets, as shown in the following DRL rule examples:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rules with controlled execution using <code>drools.guard()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit TicketIssuerUnit;

rule IssueAdultTicket when
    $p: /persons[ age &gt;= 18 ]
then
    tickets.insert(new AdultTicket($p));
end
rule RegisterAdultTicket when
    $t: /tickets
then
    results.add( $t.getPerson().getName() );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit BoxOfficeUnit;

rule BoxOfficeIsOpen
  when
    $box: /boxOffices[ open ]
  then
    drools.guard( TicketIssuerUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, so long as at least one box office is <code>open</code>, the guarded <code>TicketIssuerUnit</code> rule unit is active and distributes event tickets. When no more box offices are in <code>open</code> state, the guarded <code>TicketIssuerUnit</code> rule unit is prevented from being executed.</p>
</div>
<div class="paragraph">
<p>The following example class illustrates a more complete box office scenario:</p>
</div>
<div class="listingblock">
<div class="title">Example class for the box office scenario</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = executor.newDataSource( "persons" );
DataSource&lt;BoxOffice&gt; boxOffices = executor.newDataSource( "boxOffices" );
DataSource&lt;AdultTicket&gt; tickets = executor.newDataSource( "tickets" );

List&lt;String&gt; list = new ArrayList&lt;&gt;();
executor.bindVariable( "results", list );

// Two box offices are open:
BoxOffice office1 = new BoxOffice(true);
FactHandle officeFH1 = boxOffices.insert( office1 );
BoxOffice office2 = new BoxOffice(true);
FactHandle officeFH2 = boxOffices.insert( office2 );

persons.insert(new Person("John", 40));

// Execute `BoxOfficeIsOpen` rule, run `TicketIssuerUnit` rule unit, and execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "John", list.get(0) );
list.clear();

persons.insert(new Person("Matteo", 30));

// Execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Matteo", list.get(0) );
list.clear();

// One box office is closed, the other is open:
office1.setOpen(false);
boxOffices.update(officeFH1, office1);
persons.insert(new Person("Mark", 35));
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Mark", list.get(0) );
list.clear();

// All box offices are closed:
office2.setOpen(false);
boxOffices.update(officeFH2, office2); // Guarding rule is no longer true.
persons.insert(new Person("Edson", 35));
executor.run(BoxOfficeUnit.class); // No execution

assertEquals( 0, list.size() );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_identity_conflicts_2"><a class="anchor" href="#_rule_unit_identity_conflicts_2"></a><a class="link" href="#_rule_unit_identity_conflicts_2">4.1.12.3. Rule unit identity conflicts</a></h5>
<div class="paragraph">
<p>In rule unit execution scenarios with guarded rule units, a rule can guard multiple rule units and at the same time a rule unit can be guarded and then activated by multiple rules. For these two-way guarding scenarios, rule units must have a clearly defined identity to avoid identity conflicts.</p>
</div>
<div class="paragraph">
<p>By default, the identity of a rule unit is the rule unit class name and is treated as a singleton class by the <code>RuleUnitExecutor</code>. This identification behavior is encoded in the <code>getUnitIdentity()</code> default method of the <code>RuleUnit</code> interface:</p>
</div>
<div class="listingblock">
<div class="title">Default identity method in the <code>RuleUnit</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">default Identity getUnitIdentity() {
    return new Identity( getClass() );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In some cases, you may need to override this default identification behavior to avoid conflicting identities between rule units.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>RuleUnit</code> class contains a <code>DataSource</code> definition that accepts any kind of object:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>Unit0</code> rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Unit0 implements RuleUnit {
    private DataSource&lt;Object&gt; input;

    public DataSource&lt;Object&gt; getInput() {
        return input;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule unit contains the following DRL rule that guards another rule unit based on two conditions (in OOPath notation):</p>
</div>
<div class="listingblock">
<div class="title">Example <code>GuardAgeCheck</code> DRL rule in the rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit Unit0

rule GuardAgeCheck
  when
    $i: /input#Integer
    $s: /input#String
  then
    drools.guard( new AgeCheckUnit($i) );
    drools.guard( new AgeCheckUnit($s.length()) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The guarded <code>AgeCheckUnit</code> rule unit verifies the age of a set of <code>persons</code>. The <code>AgeCheckUnit</code> contains a <code>DataSource</code> definition of the <code>persons</code> to check, a <code>minAge</code> variable that it verifies against, and a <code>List</code> for gathering the results:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>AgeCheckUnit</code> rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {
    private final int minAge;
    private DataSource&lt;Person&gt; persons;
    private List&lt;String&gt; results;

    public AgeCheckUnit( int minAge ) {
        this.minAge = minAge;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public int getMinAge() {
        return minAge;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AgeCheckUnit</code> rule unit contains the following DRL rule that performs the verification of the <code>persons</code> in the data source:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>CheckAge</code> DRL rule in the rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AgeCheckUnit

rule CheckAge
  when
    $p : /persons{ age &gt; minAge }
  then
    results.add($p.getName() + "&gt;" + minAge);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example creates a <code>RuleUnitExecutor</code> class, binds the class to the KIE base that contains these two rule units, and creates
the two <code>DataSource</code> definitions for the same rule units:</p>
</div>
<div class="listingblock">
<div class="title">Example executor and data source definitions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

DataSource&lt;Object&gt; input = executor.newDataSource( "input" );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Sally", 4 ) );

List&lt;String&gt; results = new ArrayList&lt;&gt;();
executor.bindVariable( "results", results );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now insert some objects into the input data source and execute the <code>Unit0</code> rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example rule unit execution with inserted objects</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ds.insert("test");
ds.insert(3);
ds.insert(4);
executor.run(Unit0.class);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example results list from the execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule unit named <code>AgeCheckUnit</code> is considered a singleton class and then executed only once, with the <code>minAge</code>
variable set to <code>3</code>. Both the String <code>"test"</code> and the Integer <code>4</code> inserted into the input data source can also trigger a second execution with the <code>minAge</code> variable set to <code>4</code>. However, the second execution does not occur because another rule unit with the same identity has already been evaluated.</p>
</div>
<div class="paragraph">
<p>To resolve this rule unit identity conflict, override the <code>getUnitIdentity()</code> method in the <code>AgeCheckUnit</code> class to include also the <code>minAge</code> variable in the rule unit identity:</p>
</div>
<div class="listingblock">
<div class="title">Modified <code>AgeCheckUnit</code> rule unit to override the <code>getUnitIdentity()</code> method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {

    ...

    @Override
    public Identity getUnitIdentity() {
        return new Identity(getClass(), minAge);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this override in place, the previous example rule unit execution produces the following output:</p>
</div>
<div class="listingblock">
<div class="title">Example results list from executing the modified rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[John&gt;4, Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule units with <code>minAge</code> set to <code>3</code> and <code>4</code> are now considered two different rule units and both are executed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="performance-tuning-drl-ref_drl-rules"><a class="anchor" href="#performance-tuning-drl-ref_drl-rules"></a><a class="link" href="#performance-tuning-drl-ref_drl-rules">4.1.13. Performance tuning considerations with DRL</a></h4>
<div class="paragraph">
<p>The following key concepts or suggested practices can help you optimize DRL rules and Drools engine performance. These concepts are summarized in this section as a convenience and are explained in more detail in the cross-referenced documentation, where applicable. This section will expand or change as needed with new releases of Drools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Define the property and value of pattern constraints from left to right</dt>
<dd>
<p>In DRL pattern constraints, ensure that the fact property name is on the left side of the operator and that the value (constant or a variable) is on the right side. The property name must always be the key in the index and not the value. For example, write <code>Person( firstName == "John" )</code> instead of <code>Person( "John" == firstName )</code>. Defining the constraint property and value from right to left can hinder Drools engine performance.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For more information about DRL patterns and constraints, see <a href="#drl-rules-WHEN-con_drl-rules">Rule conditions in DRL (WHEN)</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">List the most restrictive rule conditions first</dt>
<dd>
<p>For rules with multiple conditions, list the conditions from most to least restrictive so that the Drools engine can avoid assessing the entire set of conditions if the more restrictive conditions are not met.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following conditions are part of a travel-booking rule that applies a discount to travelers who book both a flight and a hotel together. In this scenario, customers rarely book hotels with flights to receive this discount, so the hotel condition is rarely met and the rule is rarely executed. Therefore, the first condition ordering is more efficient because it prevents the Drools engine from evaluating the flight condition frequently and unnecessarily when the hotel condition is not met.</p>
</div>
<div class="listingblock">
<div class="title">Preferred condition order: hotel and flight</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $h:hotel() // Rarely booked
  $f:flight()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Inefficient condition order: flight and hotel</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $f:flight()
  $h:hotel() // Rarely booked</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about DRL patterns and constraints, see <a href="#drl-rules-WHEN-con_drl-rules">Rule conditions in DRL (WHEN)</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Avoid iterating over large collections of objects with excessive <code>from</code> clauses</dt>
<dd>
<p>Avoid using the <code>from</code> condition element in DRL rules to iterate over large collections of objects, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example conditions with <code>from</code> clause</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $c: Company()
  $e : Employee ( salary &gt; 100000.00) from $c.employees</code></pre>
</div>
</div>
<div class="paragraph">
<p>In such cases, the Drools engine iterates over the large graph every time the rule condition is evaluated and impedes  rule evaluation.</p>
</div>
<div class="paragraph">
<p>Alternatively, instead of adding an object with a large graph that the Drools engine must iterate over frequently, add the collection directly to the KIE session and then join the collection in the condition, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example conditions without <code>from</code> clause</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $c: Company();
  Employee (salary &gt; 100000.00, company == $c)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the Drools engine iterates over the list only one time and can evaluate rules more efficiently.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>from</code> element or other DRL condition elements, see <a href="#drl-rules-WHEN-elements-ref_drl-rules">Supported rule condition elements in DRL (keywords)</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Use Drools engine event listeners instead of <code>System.out.println</code> statements in rules for debug logging</dt>
<dd>
<p>You can use <code>System.out.println</code> statements in your rule actions for debug logging and console output, but doing this for many rules can impede rule evaluation. As a more efficient alternative, use the built-in Drools engine event listeners when possible. If these listeners do not meet your requirements, use a system logging utility supported by the Drools engine, such as Logback, Apache Commons Logging, or Apache Log4j.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For more information about supported Drools engine event listeners and logging utilities, see
<a href="#engine-event-listeners-con_decision-engine">Drools engine event listeners and debug logging</a>.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_domain_specific_languages"><a class="anchor" href="#_domain_specific_languages"></a><a class="link" href="#_domain_specific_languages">4.2. Domain Specific Languages</a></h3>
<div class="paragraph">
<p>
Domain Specific Languages (or DSLs) are a way of creating a rule language that is dedicated to your problem domain.
A set of DSL definitions consists of transformations from DSL "sentences" to DRL constructs, which lets you use of all the underlying rule language and engine features.
Given a DSL, you write rules in DSL rule (or DSLR) files, which will be translated into DRL files.</p>
</div>
<div class="paragraph">
<p>DSL and DSLR files are plain text files, and you can use any text editor to create and modify them.
But there are also DSL and DSLR editors, both in the IDE as well as in the web based BRMS, and you can use those as well, although they may not provide you with the full DSL functionality.</p>
</div>
<div class="sect3">
<h4 id="_when_to_use_a_dsl"><a class="anchor" href="#_when_to_use_a_dsl"></a><a class="link" href="#_when_to_use_a_dsl">4.2.1. When to Use a DSL</a></h4>
<div class="paragraph">
<p>DSLs can serve as a layer of separation between rule authoring (and rule authors) and the technical intricacies resulting from the modelling of domain object and the Drools engine&#8217;s native language and methods.
If your rules need to be read and validated by domain experts (such as business analysts, for instance) who are not programmers, you should consider  using a DSL; it hides implementation details and focuses on the rule logic proper.
DSL sentences can also act as "templates" for conditional elements and consequence actions that are used repeatedly in your rules, possibly with minor variations.
You may define DSL sentences as being mapped to these repeated phrases, with parameters providing a means for accommodating those variations.</p>
</div>
<div class="paragraph">
<p>DSLs have no impact on the Drools engine at runtime, they are just a compile time feature, requiring a special parser and transformer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dsl_basics"><a class="anchor" href="#_dsl_basics"></a><a class="link" href="#_dsl_basics">4.2.2. DSL Basics</a></h4>
<div class="paragraph">
<p>The Drools DSL mechanism allows you to customise conditional expressions and consequence actions.
A global substitution mechanism ("keyword") is also available.</p>
</div>
<div class="exampleblock">
<div class="title">Example 64. Example  DSL mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when]Something is {colour}=Something(colour=="{colour}")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, <code>[when]</code> indicates the scope of the expression, i.e., whether it is valid for the LHS or the RHS of a rule.
The part after the bracketed keyword is the expression that you use in the rule; typically a natural language expression, but it doesn&#8217;t have to be.
The part to the right of the equal sign ("=") is the mapping of the expression into the rule language.
The form of this string depends on its destination, RHS or  LHS.
If it is for the LHS, then it ought to be a term according to the regular LHS syntax; if it is for the RHS then it might be a Java statement.</p>
</div>
<div class="paragraph">
<p>Whenever the DSL parser matches a line from the rule file written in the DSL with an expression in the DSL definition, it performs three steps of string manipulation.
First, it extracts the string values appearing where the expression contains variable names in braces (here: <code>{colour}</code>). Then, the values obtained from these captures are then interpolated wherever that name, again enclosed in braces, occurs on the right hand side of the mapping.
Finally, the interpolated string replaces whatever was matched by the entire expression in the line of the DSL rule file.</p>
</div>
<div class="paragraph">
<p>Note that the expressions (i.e., the strings on the left hand side of the equal sign) are used as regular expressions in a pattern matching operation against a line of the DSL rule file, matching all or part of a line.
This means you can use (for instance) a '?' to indicate that the preceding character is optional.
One good reason to use this is to overcome variations in natural language phrases of your DSL.
But, given that these expressions are regular expression patterns, this also means that all "magic" characters of Java&#8217;s pattern syntax have to be escaped with a preceding backslash ('\').</p>
</div>
<div class="paragraph">
<p>It is important to note that the compiler transforms DSL rule files line by line.
In the above example, all the text after "Something is " to the end of the line is captured as the replacement value for "{colour}", and this is used for interpolating the target string.
This may not be exactly what you want.
For instance, when you intend to merge different DSL expressions to generate a composite DRL pattern, you need to transform a DSLR line in several independent operations.
The best way to achieve this is to ensure that the captures are surrounded by characteristic text - words or  even single characters.
As a result, the matching operation done by the parser plucks out a substring from  somewhere within the line.
In the example below, quotes are used as  distinctive characters.
Note that the characters that surround the capture are not included during interpolation, just the contents between them.</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, use quotes for textual data that a rule editor may want to enter.
You can also enclose the capture with words to ensure that the text is correctly matched.
Both is illustrated by the following example.
Note that a single line such as <code>Something is "green" and
    another solid thing</code> is now correctly expanded.</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. Example with quotes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when]something is "{colour}"=Something(colour=="{colour}")
[when]another {state} thing=OtherThing(state=="{state})"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is a good idea to avoid punctuation (other than quotes or apostrophes) in your DSL expressions as much as possible.
The main reason is that punctuation is easy to forget for rule authors using your DSL.
Another reason is that parentheses, the period and the question mark are magic characters, requiring escaping in the DSL definition.</p>
</div>
<div class="paragraph">
<p>In a DSL mapping, the braces "{" and "}" should only be used to enclose a variable definition or reference, resulting in a capture.
If they should occur literally, either in the expression or within the replacement text on the right hand side, they must be escaped with a preceding backslash ("\"):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[then]do something= if (foo) \{ doSomething(); \}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If braces "{" and "}" should appear in the replacement string of a DSL definition, escape them with a backslash ('\').</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 66. Examples of DSL mapping entries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># This is a comment to be ignored.
[when]There is a person with name of "{name}"=Person(name=="{name}")
[when]Person is at least {age} years old and lives in "{location}"=
      Person(age &gt;= {age}, location=="{location}")
[then]Log "{message}"=System.out.println("{message}");
[when]And = and</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given the above DSL examples, the following examples show the expansion of various DSLR snippets:</p>
</div>
<div class="exampleblock">
<div class="title">Example 67. Examples of DSL expansions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>There is a person with name of "Kitty"
   ==&gt; Person(name="Kitty")
Person is at least 42 years old and lives in "Atlanta"
   ==&gt; Person(age &gt;= 42, location="Atlanta")
Log "boo"
   ==&gt; System.out.println("boo");
There is a person with name of "Bob" And Person is at least 30 years old and lives in "Utah"
   ==&gt; Person(name="Bob") and Person(age &gt;= 30, location="Utah")</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t forget that if you are capturing plain text from a DSL rule line and want to use it as a string literal in the expansion, you must provide the quotes on the right hand side of the mapping.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can chain DSL expressions together on one line, as long as it is clear to the parser where one ends and the next one begins and where the text representing a parameter ends.
(Otherwise you risk getting all the text until the end of the line as a parameter value.) The DSL expressions are tried, one after the other, according to their order in the DSL definition file.
After any match, all remaining DSL expressions are investigated, too.</p>
</div>
<div class="paragraph">
<p>The resulting DRL text may consist of more than one line.
Line ends are in the replacement text are written as <code>\n</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_constraints_to_facts"><a class="anchor" href="#_adding_constraints_to_facts"></a><a class="link" href="#_adding_constraints_to_facts">4.2.3. Adding Constraints to Facts</a></h4>
<div class="paragraph">
<p>A common requirement when writing rule conditions is to be able to add an arbitrary combination of constraints to a pattern.
Given that a fact type may have many fields, having to provide an individual DSL statement for each combination would be plain folly.</p>
</div>
<div class="paragraph">
<p>The DSL facility allows you to add constraints to a pattern by a simple convention: if your DSL expression starts with a hyphen (minus character, "-") it is assumed to be a field constraint and, consequently, is is added to the last pattern line preceding it.</p>
</div>
<div class="paragraph">
<p>For an example, lets take look at class <code>Cheese</code>, with the following fields: type, price, age and country.
We can express some LHS condition in normal DRL like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheese(age &lt; 5, price == 20, type=="stilton", country=="ch")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The DSL definitions given below result in three DSL phrases which may be used to create any combination of constraint involving these fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when]There is a Cheese with=Cheese()
[when]- age is less than {age}=age&lt;{age}
[when]- type is '{type}'=type=='{type}'
[when]- country equal to '{country}'=country=='{country}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then write rules with conditions like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>There is a Cheese with
        - age is less than 42
        - type is 'stilton'</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The parser will pick up a line beginning with "-" and add it as a constraint to  the preceding pattern, inserting a comma when it is required.
For the preceding example, the resulting DRL is:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheese(age&lt;42, type=='stilton')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Combining all numeric fields with all relational operators (according to the DSL expression "age is less than&#8230;&#8203;" in the preceding example) produces an unwieldy amount of DSL entries.
But you can define DSL phrases for the various operators and even a generic expression that handles any field constraint, as shown below.
(Notice that the expression definition contains a regular expression in addition to the variable name.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when][]is less than or equal to=&lt;=
[when][]is less than=&lt;
[when][]is greater than or equal to=&gt;=
[when][]is greater than=&gt;
[when][]is equal to===
[when][]equals===
[when][]There is a Cheese with=Cheese()
[when][]- {field:\w*} {operator} {value:\d*}={field} {operator} {value}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given these DSL definitions, you can write rules with conditions such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>There is a Cheese with
   - age is less than 42
   - rating is greater than 50
   - type equals 'stilton'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this specific case, a phrase such as "is less than" is replaced by <code>&lt;</code>, and then the line matches the last DSL entry.
This removes the hyphen, but the final result is still added as a constraint to the preceding pattern.
After processing all of the lines, the resulting DRL text is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheese(age&lt;42, rating &gt; 50, type=='stilton')</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The order of the entries in the DSL is important if separate DSL expressions are intended to match the same line, one after the other.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_developing_a_dsl"><a class="anchor" href="#_developing_a_dsl"></a><a class="link" href="#_developing_a_dsl">4.2.4. Developing a DSL</a></h4>
<div class="paragraph">
<p>A good way to get started is to write representative samples of the rules your application requires, and to test them as you develop.
This will provide you with a stable framework of conditional elements and their constraints.
Rules, both in DRL and in DSLR, refer to entities according to the data model representing the application data that should be subject to the reasoning process defined in rules.
Notice that writing rules is generally easier if most of the data model&#8217;s types are facts.</p>
</div>
<div class="paragraph">
<p>Given an initial set of rules, it should be possible to identify recurring or similar code snippets and to mark variable parts as parameters.
This provides reliable leads as to what might be a handy DSL entry.
Also, make sure you have a full grasp of the jargon the  domain experts are using, and base your DSL phrases on this vocabulary.</p>
</div>
<div class="paragraph">
<p>You may postpone implementation decisions concerning conditions and actions during this first design phase by leaving certain conditional elements and actions in their DRL form by prefixing a line with a greater sign ("&gt;"). (This is also handy for inserting debugging statements.)</p>
</div>
<div class="paragraph">
<p>During the next development phase, you should find that the DSL configuration stabilizes pretty quickly.
New rules can be written by reusing the existing DSL definitions, or by adding a parameter to an existing condition or consequence entry.</p>
</div>
<div class="paragraph">
<p>Try to keep the number of DSL entries small.
Using parameters lets you apply the same DSL sentence for similar rule patterns or constraints.
But do not exaggerate: authors using the DSL should still be able to identify DSL phrases by some fixed text.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dsl_and_dslr_reference"><a class="anchor" href="#_dsl_and_dslr_reference"></a><a class="link" href="#_dsl_and_dslr_reference">4.2.5. DSL and DSLR Reference</a></h4>
<div class="paragraph">
<p>A DSL file is a text file in a line-oriented format.
Its entries are used for transforming a DSLR file into a file according to DRL syntax.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A line starting with "<mark>" or "//" (with or without preceding white space) is treated as a comment. A comment line starting with "</mark>/" is scanned for words requesting a debug option, see below.</p>
</li>
<li>
<p>Any line starting with an opening bracket ("[") is assumed to be the first line of a DSL entry definition.</p>
</li>
<li>
<p>Any other line is appended to the preceding DSL entry definition, with the line end replaced by a space.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A DSL entry consists of the following four parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A scope definition, written as one of the keywords "when" or "condition", "then" or "consequence", "*" and "keyword", enclosed in brackets ("[" and "]"). This indicates whether the DSL entry is valid for the condition or the consequence of a rule, or both. A scope indication of "keyword" means that the entry has global significance, i.e., it is recognized anywhere in a DSLR file.</p>
</li>
<li>
<p>A type definition, written as a Java class name, enclosed in brackets. This part is optional unless the next part begins with an opening bracket. An empty pair of brackets is valid, too.</p>
</li>
<li>
<p>A DSL expression consists of a (Java) regular expression, with any number of embedded <em>variable definitions,</em> terminated by an equal sign ("="). A variable definition is enclosed in braces ("{" and "}"). It consists of a variable name and two optional attachments, separated by colons (":"). If there is one attachment, it is a regular expression for matching text that is to be assigned to the variable; if there are two attachments, the first one is a hint for the GUI editor and the second one the regular expression.</p>
<div class="paragraph">
<p>Note that all characters that are "magic" in regular expressions must be escaped with a preceding backslash ("\") if they should occur literally within the expression.</p>
</div>
</li>
<li>
<p>The remaining part of the line after the delimiting equal sign is the replacement text for any DSLR text matching the regular expression. It may contain variable references, i.e., a variable name enclosed in braces. Optionally, the variable name may be followed by an exclamation mark ("!") and a transformation function, see below.</p>
<div class="paragraph">
<p>Note that braces ("{" and "}") must be escaped with a preceding backslash ("\") if they should occur literally within the replacement string.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debugging of DSL expansion can be turned on, selectively, by using a comment line starting with "#/" which may contain one or more words from the table presented below.
The resulting output is written to standard output.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Debug options for DSL expansion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Word</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Prints the resulting DRL text, with line numbers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">steps</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Prints each expansion step of condition and consequence
            lines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">keyword</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "keyword".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">when</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "when" or "*".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">then</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "then" or "*".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">usage</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Displays a usage statistic of all DSL entries.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below are some sample DSL definitions, with comments describing the language features they illustrate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Comment: DSL examples

#/ debug: display result and usage

# keyword definition: replaces "regula" by "rule"
[keyword][]regula=rule

# conditional element: "T" or "t", "a" or "an", convert matched word
[when][][Tt]here is an? {entity:\w+}=
        ${entity!lc}: {entity!ucfirst} ()

# consequence statement: convert matched word, literal braces
[then][]update {entity:\w+}=modify( ${entity!lc} )\{ \}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation of a DSLR file proceeds as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The text is read into memory.</p>
</li>
<li>
<p>Each of the "keyword" entries is applied to the entire text. First, the regular expression from the keyword definition is modified by replacing white space sequences with a pattern matching any number of white space characters, and by replacing variable definitions with a capture made from the regular expression provided with the definition, or with the default (".*?"). Then, the DSLR text is searched exhaustively for occurrences of strings matching the modified regular expression. Substrings of a matching string corresponding to variable captures are extracted and replace variable references in the corresponding replacement text, and this text replaces the matching string in the DSLR text.</p>
</li>
<li>
<p>Sections of the DSLR text between "when" and "then", and "then" and "end", respectively, are located and processed in a uniform manner, line by line, as described below.</p>
<div class="paragraph">
<p>For a line, each DSL entry pertaining to the line&#8217;s section is taken in turn, in the order it appears in the DSL file.
Its regular expression part is modified: white space is replaced by a pattern matching any number of white space characters; variable definitions with a regular expression are replaced by a capture with this regular expression, its default being ".*?". If the resulting regular expression matches all or part of the line, the matched part is replaced by the suitably modified replacement text.</p>
</div>
<div class="paragraph">
<p>Modification of the replacement text is done by replacing variable references with the text corresponding to the regular expression capture.
This text may be modified according to the string transformation function given in the variable reference; see below for details.</p>
</div>
<div class="paragraph">
<p>If there is a variable reference naming a variable that is not defined in the same entry, the expander substitutes a value bound to a variable of that name, provided it was defined in one of the preceding lines of the current rule.</p>
</div>
</li>
<li>
<p>If a DSLR line in a condition is written with a leading hyphen, the expanded result is inserted into the last line, which should contain a pattern CE, i.e., a type name followed by a pair of parentheses. if this pair is empty, the expanded line (which should contain a valid constraint) is simply inserted, otherwise a comma (",") is inserted beforehand.</p>
<div class="paragraph">
<p>If a DSLR line in a consequence is written with a leading hyphen, the expanded result is inserted into the last line, which should contain a "modify" statement, ending in a pair of braces ("{" and "}"). If this pair is empty, the expanded line (which should contain a valid method call) is simply inserted, otherwise a comma (",") is inserted beforehand.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is currently <em>not</em> possible to use a line with a leading hyphen to insert text into other conditional element forms (e.g., "accumulate") or it may only work for the first insertion (e.g., "eval").</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All string transformation functions are described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. String transformation functions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">uc</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Converts all letters to upper case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">lc</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Converts all letters to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ucfirst</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Converts the first letter to upper case, and
            all other letters to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">num</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Extracts all digits and "-" from the string. If the
            last two digits in the original string are preceded by "." or
            ",", a decimal period is inserted in the corresponding position.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><em>a</em>?<em>b</em>/<em>c</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Compares the string with string <em>a</em>, and if they
            are equal, replaces it with <em>b</em>, otherwise with
            <em>c</em>. But <em>c</em> can be another triplet
            <em>a</em>, <em>b</em>, <em>c</em>, so
            that the entire structure is, in fact, a translation table.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following DSL examples show how to use string transformation functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># definitions for conditions
[when][]There is an? {entity}=${entity!lc}: {entity!ucfirst}()
[when][]- with an? {attr} greater than {amount}={attr} &lt;= {amount!num}
[when][]- with a {what} {attr}={attr} {what!positive?&gt;0/negative?%lt;0/zero?==0/ERROR}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A file containing a DSL definition has to be put under the resources folder or any of its subfolders like any other drools artifact.
It must have the extension <code>.dsl</code>, or alternatively be marked with type <code>ResourceType.DSL</code>.
when programmatically added to a <code>KieFileSystem</code>.
For a file using DSL definition, the extension <code>.dslr</code> should be used, while it can be added to a <code>KieFileSystem</code> with type <code>ResourceType.DSLR</code>.</p>
</div>
<div class="paragraph">
<p>For parsing and expanding a DSLR file the DSL configuration is read and supplied to the parser.
Thus, the parser can "recognize" the DSL expressions and transform them into native rule language expressions.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drools.DMN"><a class="anchor" href="#drools.DMN"></a><a class="link" href="#drools.DMN">5. Decision Model and Notation (DMN)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dmn-con_dmn-models"><a class="anchor" href="#dmn-con_dmn-models"></a><a class="link" href="#dmn-con_dmn-models">5.1. Decision Model and Notation (DMN)</a></h3>
<div class="paragraph">
<p>Decision Model and Notation (DMN) is a standard established by the Object Management Group (OMG) for describing and modeling operational decisions. DMN defines an XML schema that enables DMN models to be shared between DMN-compliant platforms and across organizations so that business analysts and business rules developers can collaborate in designing and implementing DMN decision services. The DMN standard is similar to and can be used together with the Business Process Model and Notation (BPMN) standard for designing and modeling business processes.</p>
</div>
<div class="paragraph">
<p>For more information about the background and applications of DMN, see the OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.</p>
</div>
<div class="sect3">
<h4 id="dmn-conformance-levels-con_dmn-models"><a class="anchor" href="#dmn-conformance-levels-con_dmn-models"></a><a class="link" href="#dmn-conformance-levels-con_dmn-models">5.1.1. DMN conformance levels</a></h4>
<div class="paragraph">
<p>The DMN specification defines three incremental levels of conformance in a software implementation. A product that claims compliance at one level must also be compliant with any preceding levels. For example, a conformance level 3 implementation must also include the supported components in conformance levels 1 and 2. For the formal definitions of each conformance level, see the OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.</p>
</div>
<div class="paragraph">
<p>The following list summarizes the three DMN conformance levels:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Conformance level 1</dt>
<dd>
<p>A DMN conformance level 1 implementation supports decision requirement diagrams (DRDs), decision logic, and decision tables, but decision models are not executable. Any language can be used to define the expressions, including natural, unstructured languages.</p>
</dd>
<dt class="hdlist1">Conformance level 2</dt>
<dd>
<p>A DMN conformance level 2 implementation includes the requirements in conformance level 1, and supports Simplified Friendly Enough Expression Language (S-FEEL) expressions and fully executable decision models.</p>
</dd>
<dt class="hdlist1">Conformance level 3</dt>
<dd>
<p>A DMN conformance level 3 implementation includes the requirements in conformance levels 1 and 2, and supports Friendly Enough Expression Language (FEEL) expressions, the full set of boxed expressions, and fully executable decision models.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Drools provides design and runtime support for DMN 1.2 models at conformance level 3, and runtime-only support for DMN 1.1 models at conformance level 3. You can design your DMN models directly in Business Central or import existing DMN models into your Drools projects for deployment and execution. Any DMN 1.1 models that you import into Business Central, open in the DMN designer, and save are converted to DMN 1.2 models.</p>
</div>
</div>
<div class="sect3">
<h4 id="dmn-drd-components-ref_dmn-models"><a class="anchor" href="#dmn-drd-components-ref_dmn-models"></a><a class="link" href="#dmn-drd-components-ref_dmn-models">5.1.2. DMN decision requirements diagram (DRD) components</a></h4>
<div class="paragraph">
<p>A decision requirements diagram (DRD) is a visual representation of your DMN model. This diagram consists of one or more decision requirements graphs (DRGs) that represent a particular domain of an overall DRD. The DRGs trace business decisions using decision nodes, business knowledge models, sources of business knowledge, input data, and decision services.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the components in a DRD:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. DRD components</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2" style="background-color: #ffffff;">Component</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Notation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5" style="background-color: #ffffff;"><p class="tableblock">Elements</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Node where one or more input elements determine an output based on defined decision logic.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-node.png" alt="dmn decision node">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Business knowledge model</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Reusable function with one or more decision elements. Decisions that have the same logic but depend on different sub-input data or sub-decisions use business knowledge models to determine which procedure to follow.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-node.png" alt="dmn bkm node">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Knowledge source</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">External authorities, documents, committees, or policies that regulate a decision or business knowledge model. Knowledge sources are references to real-world factors rather than executable business rules.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-node.png" alt="dmn knowledge source node">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Input data</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Information used in a decision node or a business knowledge model. Input data usually includes business-level concepts or objects relevant to the business, such as loan applicant data used in a lending strategy.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-data-node.png" alt="dmn input data node">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision service</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="paragraph">
<p>Top-level decision containing a set of reusable decisions published as a service for invocation. A decision service can be invoked from an external application or a BPMN business process.</p>
</div></div></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-service-node.png" alt="dmn decision service node">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3" style="background-color: #ffffff;"><p class="tableblock">Requirement connectors</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Information requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Connection from an input data node or decision node to another decision node that requires the information.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-info-connector.png" alt="dmn info connector">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Knowledge requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Connection from a business knowledge model to a decision node or to another business knowledge model that invokes the decision logic.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-connector.png" alt="dmn knowledge connector">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Authority requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Connection from an input data node or a decision node to a dependent knowledge source or from a knowledge source to a decision node, business knowledge model, or another knowledge source.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-authority-connector.png" alt="dmn authority connector">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color: #ffffff;"><p class="tableblock">Artifacts</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Text annotation</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Explanatory note associated with an input data node, decision node, business knowledge model, or knowledge source.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-annotation-node.png" alt="dmn annotation node">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Association</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Connection from an input data node, decision node, business knowledge model, or knowledge source to a text annotation.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-association-connector.png" alt="dmn association connector">
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table summarizes the permitted connectors between DRD elements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. DRD connector rules</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Starts from</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Connects to</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Connection type</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Information requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-to-decision.png" alt="dmn decision to decision">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color: #ffffff;"><p class="tableblock">Business knowledge model</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color: #ffffff;"><p class="tableblock">Knowledge requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-to-decision.png" alt="dmn bkm to decision">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Business knowledge model</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-to-bkm.png" alt="dmn bkm to bkm">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color: #ffffff;"><div class="content"><div class="paragraph">
<p>Decision service</p>
</div></div></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color: #ffffff;"><p class="tableblock">Knowledge requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-service-to-decision.png" alt="dmn decision service to decision">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Business knowledge model</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-service-to-bkm.png" alt="dmn decision service to bkm">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color: #ffffff;"><p class="tableblock">Input data</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Information requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-to-decision.png" alt="dmn input to decision">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Knowledge source</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Authority requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-to-knowledge-source.png" alt="dmn input to knowledge source">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3" style="background-color: #ffffff;"><p class="tableblock">Knowledge source</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" rowspan="3" style="background-color: #ffffff;"><p class="tableblock">Authority requirement</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-decision.png" alt="dmn knowledge source to decision">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Business knowledge model</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-bkm.png" alt="dmn knowledge source to bkm">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Knowledge source</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-knowledge-source.png" alt="dmn knowledge source to knowledge source">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Decision</p></td>
<td class="tableblock halign-left valign-top" rowspan="4" style="background-color: #ffffff;"><p class="tableblock">Text annotation</p></td>
<td class="tableblock halign-left valign-top" rowspan="4" style="background-color: #ffffff;"><p class="tableblock">Association</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-to-annotation.png" alt="dmn decision to annotation">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Business knowledge model</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-to-annotation.png" alt="dmn bkm to annotation">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Knowledge source</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-annotation.png" alt="dmn knowledge source to annotation">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Input data</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-to-annotation.png" alt="dmn input to annotation">
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example DRD illustrates some of these DMN components in practice:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd.png" alt="dmn example drd">
</div>
<div class="title">Figure 73. Example DRD: Loan prequalification</div>
</div>
<div class="paragraph">
<p>The following example DRD illustrates DMN components that are part of a reusable decision service:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd3.png" alt="dmn example drd3" width="90%">
</div>
<div class="title">Figure 74. Example DRD: Phone call handling as a decision service</div>
</div>
<div class="paragraph">
<p>In a DMN decision service node, the decision nodes in the bottom segment incorporate input data from outside of the decision service to arrive at a final decision in the top segment of the decision service node. The resulting top-level decisions from the decision service are then implemented in any subsequent decisions or business knowledge requirements of the DMN model. You can reuse DMN decision services in other DMN models to apply the same decision logic with different input data and different outgoing connections.</p>
</div>
</div>
<div class="sect3">
<h4 id="dmn-feel-con_dmn-models"><a class="anchor" href="#dmn-feel-con_dmn-models"></a><a class="link" href="#dmn-feel-con_dmn-models">5.1.3. Rule expressions in FEEL</a></h4>
<div class="paragraph">
<p>Friendly Enough Expression Language (FEEL) is an expression language defined by the Object Management Group (OMG) DMN specification. FEEL expressions define the logic of a decision in a DMN model. FEEL is designed to facilitate both decision modeling and execution by assigning semantics to the decision model constructs. FEEL expressions in decision requirements diagrams (DRDs) occupy table cells in boxed expressions for decision nodes and business knowledge models.</p>
</div>
<div class="paragraph">
<p>For more information about FEEL in DMN, see the OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.</p>
</div>
<div class="sect4">
<h5 id="dmn-names-con_dmn-models"><a class="anchor" href="#dmn-names-con_dmn-models"></a><a class="link" href="#dmn-names-con_dmn-models">5.1.3.1. Variable and function names in FEEL</a></h5>
<div class="paragraph">
<p>Unlike many traditional expression languages, Friendly Enough Expression Language (FEEL) supports spaces and a few special characters as part of variable and function names. A FEEL name must start with a <code>letter</code>, <code>?</code>, or <code>_</code> element. The unicode letter characters are also allowed. Variable names cannot start with a language keyword, such as <code>and</code>, <code>true</code>, or <code>every</code>. The remaining characters in a variable name can be any of the starting characters, as well as <code>digits</code>, white spaces, and special characters such as <code>+</code>, <code>-</code>, <code>/</code>, <code>*</code>, <code>'</code>, and <code>.</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following names are all valid FEEL names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Age</p>
</li>
<li>
<p>Birth Date</p>
</li>
<li>
<p>Flight 234 pre-check procedure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Several limitations apply to variable and function names in FEEL:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Ambiguity</dt>
<dd>
<p>The use of spaces, keywords, and other special characters as part of names can make FEEL ambiguous. The ambiguities are resolved in the context of the expression, matching names from left to right. The parser resolves the variable name as the longest name matched in scope. You can use <code>( )</code> to disambiguate names if necessary.</p>
</dd>
<dt class="hdlist1">Spaces in names</dt>
<dd>
<p>The DMN specification limits the use of spaces in FEEL names. According to the DMN specification, names can contain multiple spaces but not two consecutive spaces.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In order to make the language easier to use and avoid common errors due to spaces, Drools removes the limitation on the use of consecutive spaces. Drools supports variable names with any number of consecutive spaces, but normalizes them into a single space. For example, the variable references <code>First Name</code> with one space and <code>First  Name</code> with two spaces are both acceptable in Drools.</p>
</div>
<div class="paragraph">
<p>Drools also normalizes the use of other white spaces, like the non-breakable white space that is common in web pages, tabs, and line breaks. From a Drools FEEL engine perspective, all of these characters are normalized into a single white space before processing.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">The keyword <code>in</code></dt>
<dd>
<p>The keyword <code>in</code> is the only keyword in the language that cannot be used as part of a variable name. Although the specifications allow the use of keywords in the middle of variable names, the use of <code>in</code> in variable names conflicts with the grammar definition of <code>for</code>, <code>every</code> and <code>some</code> expression constructs.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="dmn-data-types-ref_dmn-models"><a class="anchor" href="#dmn-data-types-ref_dmn-models"></a><a class="link" href="#dmn-data-types-ref_dmn-models">5.1.3.2. Data types in FEEL</a></h5>
<div class="paragraph">
<p>Friendly Enough Expression Language (FEEL) supports the following data types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Numbers</p>
</li>
<li>
<p>Strings</p>
</li>
<li>
<p>Boolean values</p>
</li>
<li>
<p>Dates</p>
</li>
<li>
<p>Time</p>
</li>
<li>
<p>Date and time</p>
</li>
<li>
<p>Days and time duration</p>
</li>
<li>
<p>Years and months duration</p>
</li>
<li>
<p>Functions</p>
</li>
<li>
<p>Contexts</p>
</li>
<li>
<p>Ranges (or intervals)</p>
</li>
<li>
<p>Lists</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The DMN specification currently does not provide an explicit way of declaring a variable as a <code>function</code>, <code>context</code>, <code>range</code>, or <code>list</code>, but Drools extends the DMN built-in types to support variables of these types.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following list describes each data type:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Numbers</dt>
<dd>
<p>Numbers in FEEL are based on the <a href="http://ieeexplore.ieee.org/document/4610935/">IEEE 754-2008</a> Decimal 128 format, with 34 digits of precision. Internally, numbers are represented in Java as <a href="https://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html"><code>BigDecimals</code></a> with <code>MathContext DECIMAL128</code>. FEEL supports only one number data type, so the same type is used to represent both integers and floating
point numbers.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>FEEL numbers use a dot (<code>.</code>) as a decimal separator. FEEL does not support <code>-INF</code>, <code>+INF</code>, or <code>NaN</code>. FEEL uses
<code>null</code> to represent invalid numbers.</p>
</div>
<div class="paragraph">
<p>Drools extends the DMN specification and supports additional number notations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Scientific:</strong> You can use scientific notation with the suffix <code>e&lt;exp&gt;</code> or <code>E&lt;exp&gt;</code>. For example, <code>1.2e3</code> is the same as writing the
expression <code>1.2*10**3</code>, but is a literal instead of an expression.</p>
</li>
<li>
<p><strong>Hexadecimal:</strong> You can use hexadecimal numbers with the prefix <code>0x</code>. For example, <code>0xff</code> is the same as the decimal
number <code>255</code>. Both uppercase and lowercase letters are supported. For example, <code>0XFF</code> is the same as <code>0xff</code>.</p>
</li>
<li>
<p><strong>Type suffixes:</strong> You can use the type suffixes <code>f</code>, <code>F</code>, <code>d</code>, <code>D</code>, <code>l</code>, and <code>L</code>. These suffixes are ignored.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Strings</dt>
<dd>
<p>Strings in FEEL are any sequence of characters delimited by double quotation marks.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"John Doe"</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Boolean values</dt>
<dd>
<p>FEEL uses three-valued boolean logic, so a boolean logic expression may have values <code>true</code>, <code>false</code>, or <code>null</code>.</p>
</dd>
<dt class="hdlist1">Dates</dt>
<dd>
<p>Date literals are not supported in FEEL, but you can use the built-in <code>date()</code> function to construct date values. Date strings in FEEL follow the format defined in the <a href="https://www.w3.org/TR/xmlschema-2/#date">XML Schema Part 2: Datatypes</a> document. The format is <code>"YYYY-MM-DD"</code> where <code>YYYY</code> is the year with four digits, <code>MM</code> is the number of the month with
two digits, and <code>DD</code> is the number of the day.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date( "2017-06-23" )</pre>
</div>
</div>
<div class="paragraph">
<p>Date objects have time equal to <code>"00:00:00"</code>, which is midnight. The dates are considered to be local, without a timezone.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Time</dt>
<dd>
<p>Time literals are not supported in FEEL, but you can use the built-in <code>time()</code> function to construct time values. Time strings in FEEL follow the format defined in the <a href="https://www.w3.org/TR/xmlschema-2/#time">XML Schema Part 2: Datatypes</a> document. The format is <code>"hh:mm:ss[.uuu][(+-)hh:mm]"</code> where <code>hh</code> is the hour of the day (from <code>00</code> to <code>23</code>), <code>mm</code> is the minutes in the hour, and <code>ss</code> is the number of seconds in the minute. Optionally, the string may define the number of milliseconds (<code>uuu</code>) within the second and contain a positive (<code>+</code>) or negative (<code>-</code>) offset from UTC time to define its timezone. Instead of using an offset, you can use the letter <code>z</code> to represent the UTC time, which is the same as an offset of <code>-00:00</code>. If no offset is defined, the time is considered to be local.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>time( "04:25:12" )
time( "14:10:00+02:00" )
time( "22:35:40.345-05:00" )
time( "15:00:30z" )</pre>
</div>
</div>
<div class="paragraph">
<p>Time values that define an offset or a timezone cannot be compared to local times that do not define an offset or a timezone.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Date and time</dt>
<dd>
<p>Date and time literals are not supported in FEEL, but you can use the built-in <code>date and time()</code> function to construct date and time values. Date and time strings in FEEL follow the format defined in the <a href="https://www.w3.org/TR/xmlschema-2/#dateTime">XML Schema Part 2: Datatypes</a> document. The format is <code>"&lt;date&gt;T&lt;time&gt;"</code>, where <code>&lt;date&gt;</code> and <code>&lt;time&gt;</code> follow the prescribed XML schema formatting, conjoined by <code>T</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date and time( "2017-10-22T23:59:00" )
date and time( "2017-06-13T14:10:00+02:00" )
date and time( "2017-02-05T22:35:40.345-05:00" )
date and time( "2017-06-13T15:00:30z" )</pre>
</div>
</div>
<div class="paragraph">
<p>Date and time values that define an offset or a timezone cannot be compared to local date and time values
that do not define an offset or a timezone.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your implementation of the DMN specification does not support spaces in the XML schema, use the keyword <code>dateTime</code> as a synonym of <code>date and time</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Days and time duration</dt>
<dd>
<p>Days and time duration literals are not supported in FEEL, but you can use the built-in <code>duration()</code> function to construct days and time duration values. Days and time duration strings in FEEL follow the format defined in the <a href="https://www.w3.org/TR/xmlschema-2/#duration">XML Schema Part 2: Datatypes</a> document, but are restricted to only days, hours, minutes and seconds. Months and years are not supported.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>duration( "P1DT23H12M30S" )
duration( "P23D" )
duration( "PT12H" )
duration( "PT35M" )</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your implementation of the DMN specification does not support spaces in the XML schema, use the keyword <code>dayTimeDuration</code> as a synonym of <code>days and time duration</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Years and months duration</dt>
<dd>
<p>Years and months duration literals are not supported in FEEL, but you can use the built-in <code>duration()</code> function to construct days and time duration values. Years and months duration strings in FEEL follow the format defined in the <a href="https://www.w3.org/TR/xmlschema-2/#duration">XML Schema Part 2: Datatypes</a> document, but are restricted to only years and months. Days, hours, minutes, or seconds are not supported.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>duration( "P3Y5M" )
duration( "P2Y" )
duration( "P10M" )
duration( "P25M" )</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your implementation of the DMN specification does not support spaces in the XML schema, use the keyword <code>yearMonthDuration</code> as a synonym of <code>years and months duration</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Functions</dt>
<dd>
<p>FEEL has <code>function</code> literals (or anonymous functions) that you can use to create functions. The DMN specification currently does not provide an explicit way of declaring a variable as a <code>function</code>, but Drools extends the DMN built-in types to support variables of functions.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>function(a, b) a + b</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the FEEL expression creates a function that adds the parameters <code>a</code> and <code>b</code> and returns the result.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Contexts</dt>
<dd>
<p>FEEL has <code>context</code> literals that you can use to create contexts. A <code>context</code> in FEEL is a list of key and value pairs,
similar to maps in languages like Java. The DMN specification currently does not provide an explicit way of declaring a variable as a <code>context</code>, but Drools extends the DMN built-in types to support variables of contexts.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{ x : 5, y : 3 }</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the expression creates a context with two entries, <code>x</code> and <code>y</code>, representing a coordinate in a chart.</p>
</div>
<div class="paragraph">
<p>In DMN 1.2, another way to create contexts is to create an item definition that contains the list of keys as attributes, and then declare the variable as having that item definition type.</p>
</div>
<div class="paragraph">
<p>The Drools DMN API supports DMN <code>ItemDefinition</code> structural types in a <code>DMNContext</code> represented in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User-defined Java type: Must be a valid JavaBeans object defining properties and getters for each of the components in the DMN <code>ItemDefinition</code>. If necessary, you can also use the <code>@FEELProperty</code> annotation for those getters representing a component name which would result in an invalid Java identifier.</p>
</li>
<li>
<p><code>java.util.Map</code> interface: The map needs to define the appropriate entries, with the keys corresponding to the component name in the DMN <code>ItemDefinition</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Ranges (or intervals)</dt>
<dd>
<p>FEEL has <code>range</code> literals that you can use to create ranges or intervals. A <code>range</code> in FEEL is a value that defines a lower and an upper bound, where either can be open or closed. The DMN specification currently does not provide an explicit way of declaring a variable as a <code>range</code>, but Drools extends the DMN built-in types to support variables of ranges.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The syntax of a range is defined in the following formats:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>range          := interval_start endpoint '..' endpoint interval_end
interval_start := open_start | closed_start
open_start     := '(' | ']'
closed_start   := '['
interval_end   := open_end | closed_end
open_end       := ')' | '['
closed_end     := ']'
endpoint       := expression</pre>
</div>
</div>
<div class="paragraph">
<p>The expression for the endpoint must return a comparable value, and the lower bound endpoint must be lower than the
upper bound endpoint.</p>
</div>
<div class="paragraph">
<p>For example, the following literal expression defines an interval between <code>1</code> and <code>10</code>, including the boundaries (a closed interval on both endpoints):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ 1 .. 10 ]</pre>
</div>
</div>
<div class="paragraph">
<p>The following literal expression defines an interval between 1 hour and 12 hours, including the lower boundary (a closed interval), but excluding the upper boundary (an open interval):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ duration("PT1H") .. duration("PT12H") ]</pre>
</div>
</div>
<div class="paragraph">
<p>You can use ranges in decision tables to test for ranges of values, or use ranges in simple literal expressions. For example, the following literal expression returns <code>true</code> if the value of a variable <code>x</code> is between <code>0</code> and <code>100</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x in [ 1 .. 100 ]</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Lists</dt>
<dd>
<p>FEEL has <code>list</code> literals that you can use to create lists of items. A <code>list</code> in FEEL is represented by a comma-separated list of values enclosed in square brackets. The DMN specification currently does not provide an explicit way of declaring a variable as a <code>list</code>, but Drools extends the DMN built-in types to support variables of lists.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ 2, 3, 4, 5 ]</pre>
</div>
</div>
<div class="paragraph">
<p>All lists in FEEL contain elements of the same type and are immutable. Elements in a list can be accessed by index, where the first element is <code>1</code>. Negative indexes can access elements starting from the end of the list so that <code>-1</code> is the last element.</p>
</div>
<div class="paragraph">
<p>For example, the following expression returns the second element of a list <code>x</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x[2]</pre>
</div>
</div>
<div class="paragraph">
<p>The following expression returns the second-to-last element of a list <code>x</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x[-2]</pre>
</div>
</div>
<div class="paragraph">
<p>Elements in a list can also be counted by the function <code>count</code>, which uses the list of elements as the parameter.</p>
</div>
<div class="paragraph">
<p>For example, the following expression returns <code>4</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>count([ 2, 3, 4, 5 ])</pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-boxed-expressions-con_dmn-models"><a class="anchor" href="#dmn-boxed-expressions-con_dmn-models"></a><a class="link" href="#dmn-boxed-expressions-con_dmn-models">5.1.4. DMN decision logic in boxed expressions</a></h4>
<div class="paragraph">
<p>Boxed expressions in DMN are tables that you use to define the underlying logic of decision nodes and business knowledge models in a decision requirements diagram (DRD) or decision requirements graph (DRG). Some boxed expressions can contain other boxed expressions, but the top-level boxed expression corresponds to the decision logic of a single DRD artifact. While DRDs with one or more DRGs represent the flow of a DMN decision model, boxed expressions define the actual decision logic of individual nodes. DRDs and boxed expressions together form a complete and functional DMN decision model.</p>
</div>
<div class="paragraph">
<p>The following are the types of DMN boxed expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decision tables</p>
</li>
<li>
<p>Literal expressions</p>
</li>
<li>
<p>Contexts</p>
</li>
<li>
<p>Relations</p>
</li>
<li>
<p>Functions</p>
</li>
<li>
<p>Invocations</p>
</li>
<li>
<p>Lists</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Drools does not provide boxed list expressions in Business Central, but supports a FEEL <code>list</code> data type that you can use in boxed literal expressions. For more information about the <code>list</code> data type and other FEEL data types in Drools, see <a href="#dmn-data-types-ref_dmn-models">Data types in FEEL</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All Friendly Enough Expression Language (FEEL) expressions that you use in your boxed expressions must conform to the FEEL syntax requirements in the OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.</p>
</div>
<div class="sect4">
<h5 id="dmn-decision-tables-con_dmn-models"><a class="anchor" href="#dmn-decision-tables-con_dmn-models"></a><a class="link" href="#dmn-decision-tables-con_dmn-models">5.1.4.1. DMN decision tables</a></h5>
<div class="paragraph">
<p>A decision table in DMN is a visual representation of one or more business rules in a tabular format. You use decision tables to define rules for a decision node that applies those rules at a given point in the decision model. Each rule consists of a single row in the table, and includes columns that define the conditions (input) and outcome (output) for that particular row. The definition of each row is precise enough to derive the outcome using the values of the conditions. Input and output values can be FEEL expressions or defined data type values.</p>
</div>
<div class="paragraph">
<p>For example, the following decision table determines credit score ratings based on a defined range of a loan applicant&#8217;s credit score:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example.png" alt="dmn decision table example">
</div>
<div class="title">Figure 75. Decision table for credit score rating</div>
</div>
<div class="paragraph">
<p>The following decision table determines the next step in a lending strategy for applicants depending on applicant loan eligibility and the bureau call type:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example2.png" alt="dmn decision table example2">
</div>
<div class="title">Figure 76. Decision table for lending strategy</div>
</div>
<div class="paragraph">
<p>The following decision table determines applicant qualification for a loan as the concluding decision node in a loan prequalification decision model:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example3.png" alt="dmn decision table example3">
</div>
<div class="title">Figure 77. Decision table for loan prequalification</div>
</div>
<div class="paragraph">
<p>Decision tables are a popular way of modeling rules and decision logic, and are used in many methodologies (such as DMN) and implementation frameworks (such as Drools).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Drools supports both DMN decision tables and Drools-native decision tables, but they are different types of assets with different syntax requirements and are not interchangeable. For more information about Drools-native decision tables in Drools, see
<a href="#decision-tables-con_decision-tables">Spreadsheet decision tables</a>.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="dmn-decision-tables-hit-policies-con_dmn-models"><a class="anchor" href="#dmn-decision-tables-hit-policies-con_dmn-models"></a><a class="link" href="#dmn-decision-tables-hit-policies-con_dmn-models">Hit policies in DMN decision tables</a></h6>
<div class="paragraph">
<p>Hit policies determine how to reach an outcome when multiple rules in a decision table match the provided input values. For example, if one rule in a decision table applies a sales discount to military personnel and another rule applies a discount to students, then when a customer is both a student and in the military, the decision table hit policy must indicate whether to apply one discount or the other (<strong>Unique</strong>, <strong>First</strong>) or both discounts (<strong>Collect Sum</strong>). You specify the single character of the hit policy (<strong>U</strong>, <strong>F</strong>, <strong>C+</strong>) in the upper-left corner of the decision table.</p>
</div>
<div class="paragraph">
<p>The following decision table hit policies are supported in DMN:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unique (U):</strong> Permits only one rule to match. Any overlap raises an error.</p>
</li>
<li>
<p><strong>Any (A):</strong> Permits multiple rules to match, but they must all have the same output. If multiple matching rules do not have the same output, an error is raised.</p>
</li>
<li>
<p><strong>Priority (P):</strong> Permits multiple rules to match, with different outputs. The output that comes first in the output values list is selected.</p>
</li>
<li>
<p><strong>First (F):</strong> Uses the first match in rule order.</p>
</li>
<li>
<p><strong>Collect (C+, C&gt;, C&lt;, C#):</strong> Aggregates output from multiple rules based on an aggregation function.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Collect ( C ):</strong> Aggregates values in an arbitrary list.</p>
</li>
<li>
<p><strong>Collect Sum (C+):</strong> Outputs the sum of all collected values. Values must be numeric.</p>
</li>
<li>
<p><strong>Collect Min (C&lt;):</strong> Outputs the minimum value among the matches. The resulting values must be comparable, such as numbers, dates, or text (lexicographic order).</p>
</li>
<li>
<p><strong>Collect Max (C&gt;):</strong> Outputs the maximum value among the matches. The resulting values must be comparable, such as numbers, dates or text (lexicographic order).</p>
</li>
<li>
<p><strong>Collect Count (C#):</strong> Outputs the number of matching rules.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-literal-expressions-con_dmn-models"><a class="anchor" href="#dmn-literal-expressions-con_dmn-models"></a><a class="link" href="#dmn-literal-expressions-con_dmn-models">5.1.4.2. Boxed literal expressions</a></h5>
<div class="paragraph">
<p>A boxed literal expression in DMN is a literal FEEL expression as text in a table cell, typically with a labeled column and an assigned data type. You use boxed literal expressions to define simple or complex node logic or decision data directly in FEEL for a particular node in a decision. Literal FEEL expressions must conform to FEEL syntax requirements in the OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.</p>
</div>
<div class="paragraph">
<p>For example, the following boxed literal expression defines the minimum acceptable PITI calculation (principal, interest, taxes, and insurance) in a lending decision, where <code>acceptable rate</code> is a variable defined in the DMN model:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-literal-expression-example2.png" alt="dmn literal expression example2">
</div>
<div class="title">Figure 78. Boxed literal expression for minimum PITI value</div>
</div>
<div class="paragraph">
<p>The following boxed literal expression sorts a list of possible dating candidates (soul mates) in an online dating application based on their score on criteria such as age, location, and interests:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-literal-expression-example3b.png" alt="dmn literal expression example3b">
</div>
<div class="title">Figure 79. Boxed literal expression for matching online dating candidates</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-context-expressions-con_dmn-models"><a class="anchor" href="#dmn-context-expressions-con_dmn-models"></a><a class="link" href="#dmn-context-expressions-con_dmn-models">5.1.4.3. Boxed context expressions</a></h5>
<div class="paragraph">
<p>A boxed context expression in DMN is a set of variable names and values with a result value. Each name-value pair is a context entry. You use context expressions to represent data definitions in decision logic and set a value for a desired decision element within the DMN decision model. A value in a boxed context expression can be a data type value or FEEL expression, or can contain a nested sub-expression of any type, such as a decision table, a literal expression, or another context expression.</p>
</div>
<div class="paragraph">
<p>For example, the following boxed context expression defines the factors for sorting delayed passengers in a flight-rebooking decision model, based on defined data types (<code>tPassengerTable</code>, <code>tFlightNumberList</code>):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example.png" alt="dmn context expression example">
</div>
<div class="title">Figure 80. Boxed context expression for flight passenger waiting list</div>
</div>
<div class="paragraph">
<p>The following boxed context expression defines the factors that determine whether a loan applicant can meet minimum mortgage payments based on principal, interest, taxes, and insurance (PITI), represented as a front-end ratio calculation with a sub-context expression:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example2.png" alt="dmn context expression example2">
</div>
<div class="title">Figure 81. Boxed context expression for front-end client PITI ratio</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-relation-expressions-con_dmn-models"><a class="anchor" href="#dmn-relation-expressions-con_dmn-models"></a><a class="link" href="#dmn-relation-expressions-con_dmn-models">5.1.4.4. Boxed relation expressions</a></h5>
<div class="paragraph">
<p>A boxed relation expression in DMN is a traditional data table with information about given entities, listed as rows. You use boxed relation tables to define decision data for relevant entities in a decision at a particular node. Boxed relation expressions are similar to context expressions in that they set variable names and values, but relation expressions contain no result value and list all variable values based on a single defined variable in each column.</p>
</div>
<div class="paragraph">
<p>For example, the following boxed relation expression provides information about employees in an employee rostering decision:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-relation-expression-example.png" alt="dmn relation expression example">
</div>
<div class="title">Figure 82. Boxed relation expression with employee information</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-function-expressions-con_dmn-models"><a class="anchor" href="#dmn-function-expressions-con_dmn-models"></a><a class="link" href="#dmn-function-expressions-con_dmn-models">5.1.4.5. Boxed function expressions</a></h5>
<div class="paragraph">
<p>A boxed function expression in DMN is a parameterized boxed expression containing a literal FEEL expression, a nested context expression of an external JAVA or PMML function, or a nested boxed expression of any type. By default, all business knowledge models are defined as boxed function expressions. You use boxed function expressions to call functions on your decision logic and to define all business knowledge models.</p>
</div>
<div class="paragraph">
<p>For example, the following boxed function expression determines airline flight capacity in a flight-rebooking decision model:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example.png" alt="dmn function expression example">
</div>
<div class="title">Figure 83. Boxed function expression for flight capacity</div>
</div>
<div class="paragraph">
<p>The following boxed function expression contains a basic Java function as a context expression for determining absolute value in a decision model calculation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example2.png" alt="dmn function expression example2">
</div>
<div class="title">Figure 84. Boxed function expression for absolute value</div>
</div>
<div class="paragraph">
<p>The following boxed function expression determines a monthly mortgage installment as a business knowledge model in a lending decision, with the function value defined as a nested context expression:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example3.png" alt="dmn function expression example3">
</div>
<div class="title">Figure 85. Boxed function expression for installment calculation in business knowledge model</div>
</div>
<div class="paragraph">
<p>The following boxed function expression uses a PMML model included in the DMN file to define the minimum acceptable PITI calculation (principal, interest, taxes, and insurance) in a lending decision:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example5.png" alt="dmn function expression example5">
</div>
<div class="title">Figure 86. Boxed function expression with an included PMML model in business knowledge model</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-invocation-expressions-con_dmn-models"><a class="anchor" href="#dmn-invocation-expressions-con_dmn-models"></a><a class="link" href="#dmn-invocation-expressions-con_dmn-models">5.1.4.6. Boxed invocation expressions</a></h5>
<div class="paragraph">
<p>A boxed invocation expression in DMN is a boxed expression that invokes a business knowledge model. A boxed invocation expression contains the name of the business knowledge model to be invoked and a list of parameter bindings. Each binding is represented by two boxed expressions on a row: The box on the left contains the name of a parameter and the box on the right contains the binding expression whose value is assigned to the parameter to evaluate the invoked business knowledge model. You use boxed invocations to invoke at a particular decision node a business knowledge model defined in the decision model.</p>
</div>
<div class="paragraph">
<p>For example, the following boxed invocation expression invokes a <code>Reassign Next Passenger</code> business knowledge model as the concluding decision node in a flight-rebooking decision model:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-invocation-example.png" alt="dmn invocation example">
</div>
<div class="title">Figure 87. Boxed invocation expression to reassign flight passengers</div>
</div>
<div class="paragraph">
<p>The following boxed invocation expression invokes an <code>InstallmentCalculation</code> business knowledge model to calculate a monthly installment amount for a loan before proceeding to affordability decisions:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-invocation-example2.png" alt="dmn invocation example2">
</div>
<div class="title">Figure 88. Boxed invocation expression for required monthly installment</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-model-example-ref_dmn-models"><a class="anchor" href="#dmn-model-example-ref_dmn-models"></a><a class="link" href="#dmn-model-example-ref_dmn-models">5.1.5. DMN model example</a></h4>
<div class="paragraph">
<p>The following is a real-world DMN model example that demonstrates how you can use decision modeling to reach a decision based on input data, circumstances, and company guidelines. In this scenario, a flight from San Diego to New York is canceled, requiring the affected airline to find alternate arrangements for its inconvenienced passengers.</p>
</div>
<div class="paragraph">
<p>First, the airline collects the information necessary to determine how best to get the travelers to their destinations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Input data</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>List of flights</p>
</li>
<li>
<p>List of passengers</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Decisions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Prioritize the passengers who will get seats on a new flight</p>
</li>
<li>
<p>Determine which flights those passengers will be offered</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Business knowledge models</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The company process for determining passenger priority</p>
</li>
<li>
<p>Any flights that have space available</p>
</li>
<li>
<p>Company rules for determining how best to reassign inconvenienced passengers</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The airline then uses the DMN standard to model its decision process in the following decision requirements diagram (DRD) for determining the best rebooking solution:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-passenger-rebooking-drd.png" alt="dmn passenger rebooking drd">
</div>
<div class="title">Figure 89. DRD for flight rebooking</div>
</div>
<div class="paragraph">
<p>Similar to flowcharts, DRDs use shapes to represent the different elements in a process. Ovals contain the two necessary input data, rectangles contain the decision points in the model, and rectangles with clipped corners (business knowledge models) contain reusable logic that can be repeatedly invoked.</p>
</div>
<div class="paragraph">
<p>The DRD draws logic for each element from boxed expressions that provide variable definitions using FEEL expressions or data type values.</p>
</div>
<div class="paragraph">
<p>Some boxed expressions are basic, such as the following decision for establishing a prioritized waiting list:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example.png" alt="dmn context expression example">
</div>
<div class="title">Figure 90. Boxed context expression example for prioritized wait list</div>
</div>
<div class="paragraph">
<p>Some boxed expressions are more complex with greater detail and calculation, such as the following business knowledge model for reassigning the next delayed passenger:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-reassign-passenger.png" alt="dmn reassign passenger">
</div>
<div class="title">Figure 91. Boxed function expression for passenger reassignment</div>
</div>
<div class="paragraph">
<p>The following is the DMN source file for this decision model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dmn:definitions xmlns="https://www.drools.org/kie-dmn/Flight-rebooking" xmlns:dmn="http://www.omg.org/spec/DMN/20151101/dmn.xsd" xmlns:feel="http://www.omg.org/spec/FEEL/20140401" id="_0019_flight_rebooking" name="0019-flight-rebooking" namespace="https://www.drools.org/kie-dmn/Flight-rebooking"&gt;
  &lt;dmn:itemDefinition id="_tFlight" name="tFlight"&gt;
    &lt;dmn:itemComponent id="_tFlight_Flight" name="Flight Number"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_From" name="From"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_To" name="To"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Dep" name="Departure"&gt;
      &lt;dmn:typeRef&gt;feel:dateTime&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Arr" name="Arrival"&gt;
      &lt;dmn:typeRef&gt;feel:dateTime&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Capacity" name="Capacity"&gt;
      &lt;dmn:typeRef&gt;feel:number&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Status" name="Status"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tFlightTable" isCollection="true" name="tFlightTable"&gt;
    &lt;dmn:typeRef&gt;tFlight&lt;/dmn:typeRef&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tPassenger" name="tPassenger"&gt;
    &lt;dmn:itemComponent id="_tPassenger_Name" name="Name"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tPassenger_Status" name="Status"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tPassenger_Miles" name="Miles"&gt;
      &lt;dmn:typeRef&gt;feel:number&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tPassenger_Flight" name="Flight Number"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tPassengerTable" isCollection="true" name="tPassengerTable"&gt;
    &lt;dmn:typeRef&gt;tPassenger&lt;/dmn:typeRef&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tFlightNumberList" isCollection="true" name="tFlightNumberList"&gt;
    &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:inputData id="i_Flight_List" name="Flight List"&gt;
    &lt;dmn:variable name="Flight List" typeRef="tFlightTable"/&gt;
  &lt;/dmn:inputData&gt;
  &lt;dmn:inputData id="i_Passenger_List" name="Passenger List"&gt;
    &lt;dmn:variable name="Passenger List" typeRef="tPassengerTable"/&gt;
  &lt;/dmn:inputData&gt;
  &lt;dmn:decision name="Prioritized Waiting List" id="d_PrioritizedWaitingList"&gt;
    &lt;dmn:variable name="Prioritized Waiting List" typeRef="tPassengerTable"/&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredInput href="#i_Passenger_List"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredInput href="#i_Flight_List"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:knowledgeRequirement&gt;
      &lt;dmn:requiredKnowledge href="#b_PassengerPriority"/&gt;
    &lt;/dmn:knowledgeRequirement&gt;
    &lt;dmn:context&gt;
      &lt;dmn:contextEntry&gt;
        &lt;dmn:variable name="Cancelled Flights" typeRef="tFlightNumberList"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Flight List[ Status = "cancelled" ].Flight Number&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:contextEntry&gt;
      &lt;dmn:contextEntry&gt;
        &lt;dmn:variable name="Waiting List" typeRef="tPassengerTable"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Passenger List[ list contains( Cancelled Flights, Flight Number ) ]&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:contextEntry&gt;
      &lt;dmn:contextEntry&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;sort( Waiting List, passenger priority )&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:contextEntry&gt;
    &lt;/dmn:context&gt;
  &lt;/dmn:decision&gt;
  &lt;dmn:decision name="Rebooked Passengers" id="d_RebookedPassengers"&gt;
    &lt;dmn:variable name="Rebooked Passengers" typeRef="tPassengerTable"/&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredDecision href="#d_PrioritizedWaitingList"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredInput href="#i_Flight_List"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:knowledgeRequirement&gt;
      &lt;dmn:requiredKnowledge href="#b_ReassignNextPassenger"/&gt;
    &lt;/dmn:knowledgeRequirement&gt;
    &lt;dmn:invocation&gt;
      &lt;dmn:literalExpression&gt;
        &lt;dmn:text&gt;reassign next passenger&lt;/dmn:text&gt;
      &lt;/dmn:literalExpression&gt;
      &lt;dmn:binding&gt;
        &lt;dmn:parameter name="Waiting List"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Prioritized Waiting List&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:binding&gt;
      &lt;dmn:binding&gt;
        &lt;dmn:parameter name="Reassigned Passengers List"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;[]&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:binding&gt;
      &lt;dmn:binding&gt;
        &lt;dmn:parameter name="Flights"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Flight List&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:binding&gt;
    &lt;/dmn:invocation&gt;
  &lt;/dmn:decision&gt;
  &lt;dmn:businessKnowledgeModel id="b_PassengerPriority" name="passenger priority"&gt;
    &lt;dmn:encapsulatedLogic&gt;
      &lt;dmn:formalParameter name="Passenger1" typeRef="tPassenger"/&gt;
      &lt;dmn:formalParameter name="Passenger2" typeRef="tPassenger"/&gt;
      &lt;dmn:decisionTable hitPolicy="UNIQUE"&gt;
        &lt;dmn:input id="b_Passenger_Priority_dt_i_P1_Status" label="Passenger1.Status"&gt;
          &lt;dmn:inputExpression typeRef="feel:string"&gt;
            &lt;dmn:text&gt;Passenger1.Status&lt;/dmn:text&gt;
          &lt;/dmn:inputExpression&gt;
          &lt;dmn:inputValues&gt;
            &lt;dmn:text&gt;"gold", "silver", "bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputValues&gt;
        &lt;/dmn:input&gt;
        &lt;dmn:input id="b_Passenger_Priority_dt_i_P2_Status" label="Passenger2.Status"&gt;
          &lt;dmn:inputExpression typeRef="feel:string"&gt;
            &lt;dmn:text&gt;Passenger2.Status&lt;/dmn:text&gt;
          &lt;/dmn:inputExpression&gt;
          &lt;dmn:inputValues&gt;
            &lt;dmn:text&gt;"gold", "silver", "bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputValues&gt;
        &lt;/dmn:input&gt;
        &lt;dmn:input id="b_Passenger_Priority_dt_i_P1_Miles" label="Passenger1.Miles"&gt;
          &lt;dmn:inputExpression typeRef="feel:string"&gt;
            &lt;dmn:text&gt;Passenger1.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputExpression&gt;
        &lt;/dmn:input&gt;
        &lt;dmn:output id="b_Status_Priority_dt_o" label="Passenger1 has priority"&gt;
          &lt;dmn:outputValues&gt;
            &lt;dmn:text&gt;true, false&lt;/dmn:text&gt;
          &lt;/dmn:outputValues&gt;
          &lt;dmn:defaultOutputEntry&gt;
            &lt;dmn:text&gt;false&lt;/dmn:text&gt;
          &lt;/dmn:defaultOutputEntry&gt;
        &lt;/dmn:output&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r1"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r1_i1"&gt;
            &lt;dmn:text&gt;"gold"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r1_i2"&gt;
            &lt;dmn:text&gt;"gold"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r1_i3"&gt;
            &lt;dmn:text&gt;&gt;= Passenger2.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r1_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r2"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r2_i1"&gt;
            &lt;dmn:text&gt;"gold"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r2_i2"&gt;
            &lt;dmn:text&gt;"silver","bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r2_i3"&gt;
            &lt;dmn:text&gt;-&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r2_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r3"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r3_i1"&gt;
            &lt;dmn:text&gt;"silver"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r3_i2"&gt;
            &lt;dmn:text&gt;"silver"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r3_i3"&gt;
            &lt;dmn:text&gt;&gt;= Passenger2.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r3_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r4"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r4_i1"&gt;
            &lt;dmn:text&gt;"silver"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r4_i2"&gt;
            &lt;dmn:text&gt;"bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r4_i3"&gt;
            &lt;dmn:text&gt;-&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r4_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r5"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r5_i1"&gt;
            &lt;dmn:text&gt;"bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r5_i2"&gt;
            &lt;dmn:text&gt;"bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r5_i3"&gt;
            &lt;dmn:text&gt;&gt;= Passenger2.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r5_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
      &lt;/dmn:decisionTable&gt;
    &lt;/dmn:encapsulatedLogic&gt;
    &lt;dmn:variable name="passenger priority" typeRef="feel:boolean"/&gt;
  &lt;/dmn:businessKnowledgeModel&gt;
  &lt;dmn:businessKnowledgeModel id="b_ReassignNextPassenger" name="reassign next passenger"&gt;
    &lt;dmn:encapsulatedLogic&gt;
      &lt;dmn:formalParameter name="Waiting List" typeRef="tPassengerTable"/&gt;
      &lt;dmn:formalParameter name="Reassigned Passengers List" typeRef="tPassengerTable"/&gt;
      &lt;dmn:formalParameter name="Flights" typeRef="tFlightTable"/&gt;
      &lt;dmn:context&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Next Passenger" typeRef="tPassenger"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;Waiting List[1]&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Original Flight" typeRef="tFlight"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;Flights[ Flight Number = Next Passenger.Flight Number ][1]&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Best Alternate Flight" typeRef="tFlight"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;Flights[ From = Original Flight.From and To = Original Flight.To and Departure &gt; Original Flight.Departure and Status = "scheduled" and has capacity( item, Reassigned Passengers List ) ][1]&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Reassigned Passenger" typeRef="tPassenger"/&gt;
          &lt;dmn:context&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Name" typeRef="feel:string"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Next Passenger.Name&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Status" typeRef="feel:string"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Next Passenger.Status&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Miles" typeRef="feel:number"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Next Passenger.Miles&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Flight Number" typeRef="feel:string"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Best Alternate Flight.Flight Number&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
          &lt;/dmn:context&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Remaining Waiting List" typeRef="tPassengerTable"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;remove( Waiting List, 1 )&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Updated Reassigned Passengers List" typeRef="tPassengerTable"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;append( Reassigned Passengers List, Reassigned Passenger )&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;if count( Remaining Waiting List ) &gt; 0 then reassign next passenger( Remaining Waiting List, Updated Reassigned Passengers List, Flights ) else Updated Reassigned Passengers List&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
      &lt;/dmn:context&gt;
    &lt;/dmn:encapsulatedLogic&gt;
    &lt;dmn:variable name="reassign next passenger" typeRef="tPassengerTable"/&gt;
    &lt;dmn:knowledgeRequirement&gt;
      &lt;dmn:requiredKnowledge href="#b_HasCapacity"/&gt;
    &lt;/dmn:knowledgeRequirement&gt;
  &lt;/dmn:businessKnowledgeModel&gt;
  &lt;dmn:businessKnowledgeModel id="b_HasCapacity" name="has capacity"&gt;
    &lt;dmn:encapsulatedLogic&gt;
      &lt;dmn:formalParameter name="flight" typeRef="tFlight"/&gt;
      &lt;dmn:formalParameter name="rebooked list" typeRef="tPassengerTable"/&gt;
      &lt;dmn:literalExpression&gt;
        &lt;dmn:text&gt;flight.Capacity &gt; count( rebooked list[ Flight Number = flight.Flight Number ] )&lt;/dmn:text&gt;
      &lt;/dmn:literalExpression&gt;
    &lt;/dmn:encapsulatedLogic&gt;
    &lt;dmn:variable name="has capacity" typeRef="feel:boolean"/&gt;
  &lt;/dmn:businessKnowledgeModel&gt;
&lt;/dmn:definitions&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dmn-support-con_dmn-models"><a class="anchor" href="#dmn-support-con_dmn-models"></a><a class="link" href="#dmn-support-con_dmn-models">5.2. DMN support in Drools</a></h3>
<div class="paragraph">
<p>Drools provides design and runtime support for DMN 1.2 models at conformance level 3, and runtime-only support for DMN 1.1 models at conformance level 3. You can integrate DMN models with your Drools decision services in several ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Design your DMN models directly in Business Central using the DMN designer.</p>
</li>
<li>
<p>Import DMN files into your project in Business Central (<strong>Menu &#8594; Design &#8594; Projects &#8594; Import Asset</strong>). Any DMN 1.1 models that you import into Business Central, open in the DMN designer, and save are converted to DMN 1.2 models.</p>
</li>
<li>
<p>Package DMN files as part of your project knowledge JAR (KJAR) file without Business Central.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to all DMN conformance level 3 requirements, Drools also includes enhancements and fixes to FEEL and DMN model components to optimize the experience of implementing DMN decision services with Drools. From a platform perspective, DMN models are like any other business asset in Drools, such as DRL files or spreadsheet decision tables, that you can include in your Drools project and deploy to KIE Server in order to start your DMN decision services.</p>
</div>
<div class="paragraph">
<p>For more information about including external DMN files with your Drools project packaging and deployment method, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
<div class="sect3">
<h4 id="dmn-feel-enhancements-ref_dmn-models"><a class="anchor" href="#dmn-feel-enhancements-ref_dmn-models"></a><a class="link" href="#dmn-feel-enhancements-ref_dmn-models">5.2.1. FEEL enhancements in Drools</a></h4>
<div class="paragraph">
<p>Drools includes the following enhancements and other changes to FEEL in the current DMN implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Space Sensitivity</em>: This DMN implementation of the FEEL language is space insensitive. The goal is to avoid non-deterministic behavior based on the context and differences in behavior based on invisible characters, such as white spaces. This means that for this implementation, a variable named <code>first name</code> with one space is exactly the same as <code>first  name</code> with two spaces in it.</p>
</li>
<li>
<p><em>List functions <code>or()</code> and <code>and()</code> </em>: The specification defines two list functions named <code>or()</code> and <code>and()</code>. However,
according to the FEEL grammar, these are not valid function names, as <code>and</code> and <code>or</code> are reserved keywords.
 This implementation renames these functions to <code>any()</code> and <code>all()</code> respectively, in anticipation for DMN 1.2.</p>
</li>
<li>
<p><em>Keyword <code>in</code> cannot be used in variable names</em>: The specification defines that any keyword can be reused as part
of a variable name, but the ambiguities caused with the <code>for &#8230;&#8203; in &#8230;&#8203; return</code> loop prevent the reuse of the <code>in</code>
keyword. All other keywords are supported as part of variable names.</p>
</li>
<li>
<p><em>Keywords are not supported in attributes of anonymous types</em>: FEEL is not a strongly typed language and the parser must resolve ambiguity in name parts of an attribute of an anonymous type. The parser supports reusable keywords as part of a variable name defined in the scope, but the parser does not support keywords in attributes of an anonymous type. For example, <code>for item in Order.items return Federal Tax for Item( item )</code> is a valid and supported FEEL expression, where a function named <code>Federal Tax for Item(&#8230;&#8203;)</code> can be defined and invoked correctly in the scope. However, the expression <code>for i in [ {x and y : true, n : 1}, {x and y : false, n: 2} ] return i.x and y</code> is not supported because anonymous types are defined in the iteration context of the <code>for</code> expression and the parser cannot resolve the ambiguity.</p>
</li>
<li>
<p><em>Support for date and time literals on ranges</em>: According to the grammar rules #8, #18, #19, #34 and #62, <code>date
and time</code> literals are supported in ranges (pages 110-111). Chapter 10.3.2.7 on page 114, on the other hand, contradicts
the grammar and says they are not supported. This implementation chose to follow the grammar and support <code>date and
time</code> literals on ranges, as well as extend the specification to support any arbitrary expression (see extensions below).</p>
</li>
<li>
<p><em>Invalid time syntax</em>: Chapter 10.3.2.3.4 on page 112 and bullet point about <code>time</code> on page 131 both state that
the <code>time</code> string lexical representation follows the XML Schema Datatypes specification as well as ISO 8601. According
to the XML Schema specification (<a href="https://www.w3.org/TR/xmlschema-2/#time" class="bare">https://www.w3.org/TR/xmlschema-2/#time</a>), the lexical representation of a time follows
the pattern <code>hh:mm:ss.sss</code> without any leading character. The DMN specification uses a leading "T" in several examples,
that we understand is a typo and not in accordance with the standard.</p>
</li>
<li>
<p><em>Support for scientific and hexadecimal notations</em>: This implementation supports scientific and hexadecimal
notation for numbers. For example, <code>1.2e5</code> (scientific notation), <code>0xD5</code> (hexadecimal notation).</p>
</li>
<li>
<p><em>Support for expressions as end points in ranges</em>: This implementation supports expressions as endpoints
for ranges. For example, <code>[date("2016-11-24")..date("2016-11-27")]</code></p>
</li>
<li>
<p><em>Support for additional types</em>: The specification only defines the following as basic types of the language:</p>
<div class="ulist">
<ul>
<li>
<p>number</p>
</li>
<li>
<p>string</p>
</li>
<li>
<p>boolean</p>
</li>
<li>
<p>days and time duration</p>
</li>
<li>
<p>years and month duration</p>
</li>
<li>
<p>time</p>
</li>
<li>
<p>date and time</p>
<div class="paragraph">
<p>For completeness and orthogonality, this implementation also supports the following types:</p>
</div>
</li>
<li>
<p>context</p>
</li>
<li>
<p>list</p>
</li>
<li>
<p>range</p>
</li>
<li>
<p>function</p>
</li>
<li>
<p>unary test</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Support for unary tests</em>: For completeness and orthogonality, unary tests are supported
as first class citizens in the language. They are functions with an implicit single
parameter and can be invoked in the same way as functions. For example,</p>
<div class="listingblock">
<div class="title">UnaryTestAsFunction.feel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  {
      is minor : &lt; 18,
      Bob is minor : is minor( bob.age )
  }</code></pre>
</div>
</div>
</li>
<li>
<p><em>Support for additional built-in functions</em>: The following additional functions are supported:</p>
<div class="ulist">
<ul>
<li>
<p><code>now()</code> : Returns the current local date and time.</p>
</li>
<li>
<p><code>today()</code> : Returns the current local date.</p>
</li>
<li>
<p><code>decision table()</code> : Returns a decision table function, although the specification mentions a decision table.
The function on page 114 is not implementable as defined.</p>
</li>
<li>
<p><code>string( mask, p&#8230;&#8203; )</code> : Returns a string formatted as per the mask. See Java String.format() for
details on the mask syntax. For example, <code>string( "%4.2f", 7.1298 )</code> returns the string <code>"7.12"</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Support for additional date and time arithmetics</em>: Subtracting two dates returns a day and time duration with the number of days between the two
dates, ignoring daylight savings. For example,</p>
<div class="listingblock">
<div class="title">DateArithmetic.feel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">date( "2017-05-12" ) - date( "2017-04-25" ) = duration( "P17D" )</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dmn-model-enhancements-ref_dmn-models"><a class="anchor" href="#dmn-model-enhancements-ref_dmn-models"></a><a class="link" href="#dmn-model-enhancements-ref_dmn-models">5.2.2. DMN model enhancements in Drools</a></h4>
<div class="paragraph">
<p>Drools includes the following enhancements to DMN model support in the current DMN implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Support for types with spaces on names</em>: The DMN XML schema defines type refs such as QNames. The QNames do not allow spaces. Therefore, it is not possible to use types like FEEL <code>date and time</code>,   <code>days and time duration</code> or <code>years and months duration</code>. This implementation does parse such typerefs as strings and allows type names with spaces. However, in order to comply with the XML schema, it also adds the following aliases to such types that can be used instead:</p>
<div class="ulist">
<ul>
<li>
<p><code>date and time</code> = <code>dateTime</code></p>
</li>
<li>
<p><code>days and time duration</code> = <code>duration</code> or <code>dayTimeDuration</code></p>
</li>
<li>
<p><code>years and months duration</code> = <code>duration</code> or <code>yearMonthDuration</code></p>
<div class="paragraph">
<p>Note that, for the "duration" types, the user can simply use <code>duration</code> and the Drools engine will infer the proper duration, either <code>days and time duration</code> or <code>years and months duration</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>Lists support heterogeneous element types</em>: Currently this implementation supports lists with heterogeneous element types. This is an experimental extension and does limit the functionality of some functions and filters. This decision will be re-evaluated in the future.</p>
</li>
<li>
<p><em>TypeRef link between Decision Tables and Item Definitions</em>: On decision tables/input clause, if no values list is defined, the Drools engine automatically checks the type reference and applies the allowed values check if it is defined.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dmn-properties-ref_dmn-models"><a class="anchor" href="#dmn-properties-ref_dmn-models"></a><a class="link" href="#dmn-properties-ref_dmn-models">5.2.3. Configurable DMN properties in Drools</a></h4>
<div class="paragraph">
<p>Drools provides the following DMN properties that you can configure when you execute your DMN models on KIE Server or on your client application:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">org.kie.dmn.strictConformance</dt>
<dd>
<p>When enabled, this property disables by default any extensions or profiles provided beyond the DMN standard, such as some helper functions or enhanced features of DMN 1.2 backported into DMN 1.1. You can use this property to configure the Drools engine to support only pure DMN features, such as when running the <a href="https://dmn-tck.github.io/tck/">DMN Technology Compatibility Kit</a> (TCK).</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default value: <code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.strictConformance=true</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.runtime.typecheck</dt>
<dd>
<p>When enabled, this property enables verification of actual values conforming to their declared types in the DMN model, as input or output of DRD elements. You can use this property to verify whether data supplied to the DMN model or produced by the DMN model is compliant with what is specified in the model.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default value: <code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.runtime.typecheck=true</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.decisionservice.coercesingleton</dt>
<dd>
<p>By default, this property makes the result of a decision service defining a single output decision be the single value of the output decision value. When disabled, this property makes the result of a decision service defining a single output decision be a <code>context</code> with the single entry for that decision. You can use this property to adjust your decision service outputs according to your project requirements.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default value: <code>true</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.decisionservice.coercesingleton=false</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.profiles.$PROFILE_NAME</dt>
<dd>
<p>When valorized with a Java fully qualified name, this property loads a DMN profile onto the Drools engine at start time. You can use this property to implement a predefined DMN profile with supported features different from or beyond the DMN standard. For example, if you are creating DMN models using the Signavio DMN modeller, use this property to implement features from the Signavio DMN profile into your DMN decision service.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>-Dorg.kie.dmn.profiles.signavio=org.kie.dmn.signavio.KieDMNSignavioProfile</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.compiler.execmodel</dt>
<dd>
<p>When enabled, this property enables DMN decision table logic to be compiled into executable rule models during run time. You can use this property to evaluate DMN decision table logic more efficiently. This property is helpful when the executable model compilation was not originally performed during project compile time. Enabling this property may result in added compile time during the first evaluation by the Drools engine, but subsequent compilations are more efficient.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default value: <code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.compiler.execmodel=true</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dmn-model-creating-proc_dmn-models"><a class="anchor" href="#dmn-model-creating-proc_dmn-models"></a><a class="link" href="#dmn-model-creating-proc_dmn-models">5.3. Creating and editing DMN models in Business Central</a></h3>
<div class="paragraph">
<p>You can use the DMN designer in Business Central to design DMN decision requirements diagrams (DRDs) and define decision logic for a complete and functional DMN decision model. Drools provides design and runtime support for DMN 1.2 models at conformance level 3, and includes enhancements and fixes to FEEL and DMN model components to optimize the experience of implementing DMN decision services with Drools. Drools also provides runtime-only support for DMN 1.1 models at conformance level 3, but any DMN 1.1 models that you import into Business Central, open in the DMN designer, and save are converted to DMN 1.2 models.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Create or import a DMN file in your Business Central project.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To create a DMN file, click <strong>Add Asset</strong> &#8594; <strong>DMN</strong>, enter an informative DMN model name, select the appropriate <strong>Package</strong>, and click <strong>Ok</strong>.</p>
</div>
<div class="paragraph">
<p>To import an existing DMN file, click <strong>Import Asset</strong>, enter the DMN model name, select the appropriate <strong>Package</strong>, select the DMN file to upload, and click <strong>Ok</strong>.</p>
</div>
<div class="paragraph">
<p>The new DMN file is now listed in the <strong>DMN</strong> panel of the <strong>Project Explorer</strong>, and the DMN decision requirements diagram (DRD) canvas appears.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you imported a DMN file that does not contain layout information, the imported decision requirements diagram (DRD) is formatted automatically in the DMN designer. Click <strong>Save</strong> in the DMN designer to save the DRD layout.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Begin adding components to your new or imported DMN decision requirements diagram (DRD) by clicking and dragging one of the DMN nodes from the left toolbar:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-drag-decision-node.png" alt="dmn drag decision node">
</div>
<div class="title">Figure 92. Adding DRD components</div>
</div>
<div class="paragraph">
<p>The following DRD components are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Decision</strong>: Use this node for a DMN decision, where one or more input elements determine an output based on defined decision logic.</p>
</li>
<li>
<p><strong>Business knowledge model</strong>: Use this node for reusable functions with one or more decision elements. Decisions that have the same logic but depend on different sub-input data or sub-decisions use business knowledge models to determine which procedure to follow.</p>
</li>
<li>
<p><strong>Knowledge source</strong>: Use this node for external authorities, documents, committees, or policies that regulate a decision or business knowledge model. Knowledge sources are references to real-world factors rather than executable business rules.</p>
</li>
<li>
<p><strong>Input data</strong>: Use this node for information used in a decision node or a business knowledge model. Input data usually includes business-level concepts or objects relevant to the business, such as loan applicant data used in a lending strategy.</p>
</li>
<li>
<p><strong>Text annotation</strong>: Use this node for explanatory notes associated with an input data node, decision node, business knowledge model, or knowledge source.</p>
</li>
<li>
<p><strong>Decision service</strong>: Use this node to enclose a set of reusable decisions implemented as a decision service for invocation. A decision service can be used in other DMN models and can be invoked from an external application or a BPMN business process.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>In the DMN designer canvas, double-click the new DRD node to enter an informative node name.</p>
</li>
<li>
<p>If the node is a decision or business knowledge model, select the node to display the node options and click the <strong>Edit</strong> icon to open the DMN boxed expression designer to define the decision logic for the node:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-edit.png" alt="dmn decision edit">
</div>
<div class="title">Figure 93. Opening a new decision node boxed expression</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-edit.png" alt="dmn bkm edit">
</div>
<div class="title">Figure 94. Opening a new business knowledge model boxed expression</div>
</div>
<div class="paragraph">
<p>By default, all business knowledge models are defined as boxed function expressions containing a literal FEEL expression, a nested context expression of an external JAVA or PMML function, or a nested boxed expression of any type.</p>
</div>
<div class="paragraph">
<p>For decision nodes, you click the undefined table to select the type of boxed expression you want to use, such as a boxed literal expression, boxed context expression, decision table, or other DMN boxed expression.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-boxed-expression-options.png" alt="dmn decision boxed expression options">
</div>
<div class="title">Figure 95. Selecting the logic type for a decision node</div>
</div>
<div class="paragraph">
<p>For business knowledge models, you click the top-left function cell to select the function type, or right-click the function value cell, select <strong>Clear</strong>, and select a boxed expression of another type.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-define.png" alt="dmn bkm define">
</div>
<div class="title">Figure 96. Selecting the function or other logic type for a business knowledge model</div>
</div>
</div>
</div>
</li>
<li>
<p>In the selected boxed expression designer for either a decision node (any expression type) or business knowledge model (function expression), click the applicable table cells to define the table name, variable data types, variable names and values, function parameters and bindings, or FEEL expressions to include in the decision logic.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You can right-click cells for additional actions where applicable, such as inserting or removing table rows and columns or clearing table contents.</p>
</div>
<div class="paragraph">
<p>The following is an example decision table for a decision node that determines credit score ratings based on a defined range of a loan applicant&#8217;s credit score:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example1a.png" alt="dmn decision table example1a">
</div>
<div class="title">Figure 97. Decision node decision table for credit score rating</div>
</div>
<div class="paragraph">
<p>The following is an example boxed function expression for a business knowledge model that calculates mortgage payments based on principal, interest, taxes, and insurance (PITI) as a literal expression:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example4.png" alt="dmn function expression example4">
</div>
<div class="title">Figure 98. Business knowledge model function for PITI calculation</div>
</div>
</div>
</div>
</li>
<li>
<p>After you define the decision logic for the selected node, click <strong>Back to "&lt;MODEL_NAME&gt;"</strong> to return to the DRD view.</p>
</li>
<li>
<p>For the selected DRD node, use the available connection options to create and connect to the next node in the DRD, or click and drag a new node onto the DRD canvas from the left toolbar.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The node type determines which connection options are supported. For example, an <strong>Input data</strong> node can connect to a decision node, knowledge source, or text annotation using the applicable connection type, whereas a <strong>Knowledge source</strong> node can connect to any DRD element. A <strong>Decision</strong> node can connect only to another decision or a text annotation.</p>
</div>
<div class="paragraph">
<p>The following connection types are available, depending on the node type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Information requirement</strong>: Use this connection from an input data node or decision node to another decision node that requires the information.</p>
</li>
<li>
<p><strong>Knowledge requirement</strong>: Use this connection from a business knowledge model to a decision node or to another business knowledge model that invokes the decision logic.</p>
</li>
<li>
<p><strong>Authority requirement</strong>: Use this connection from an input data node or a decision node to a dependent knowledge source or from a knowledge source to a decision node, business knowledge model, or another knowledge source.</p>
</li>
<li>
<p><strong>Association</strong>: Use this connection from an input data node, decision node, business knowledge model, or knowledge source to a text annotation.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-connection-example.png" alt="dmn input connection example">
</div>
<div class="title">Figure 99. Connecting credit score input to the credit score rating decision</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-connection-example2.png" alt="dmn input connection example2">
</div>
</div>
</div>
</div>
</li>
<li>
<p>Continue adding and defining the remaining DRD components of your decision model. Periodically click <strong>Save</strong> in the DMN designer to save your work.</p>
</li>
<li>
<p>After you add and define all components of the DRD, click <strong>Save</strong> to save and validate the completed DRD.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The following is an example DRD for a loan prequalification decision model:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd.png" alt="dmn example drd">
</div>
<div class="title">Figure 100. Completed DRD for loan prequalification</div>
</div>
<div class="paragraph">
<p>The following is an example DRD for a phone call handling decision model using a reusable decision service:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd3.png" alt="dmn example drd3" width="90%">
</div>
<div class="title">Figure 101. Completed DRD for phone call handling with a decision service</div>
</div>
<div class="paragraph">
<p>In a DMN decision service node, the decision nodes in the bottom segment incorporate input data from outside of the decision service to arrive at a final decision in the top segment of the decision service node. The resulting top-level decisions from the decision service are then implemented in any subsequent decisions or business knowledge requirements of the DMN model. You can reuse DMN decision services in other DMN models to apply the same decision logic with different input data and different outgoing connections.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="dmn-logic-defining-proc_dmn-models"><a class="anchor" href="#dmn-logic-defining-proc_dmn-models"></a><a class="link" href="#dmn-logic-defining-proc_dmn-models">5.3.1. Defining DMN decision logic in boxed expressions in Business Central</a></h4>
<div class="paragraph">
<p>Boxed expressions in DMN are tables that you use to define the underlying logic of decision nodes and business knowledge models in a decision requirements diagram (DRD) or decision requirements graph (DRG). Some boxed expressions can contain other boxed expressions, but the top-level boxed expression corresponds to the decision logic of a single DRD artifact. While DRDs with one or more DRGs represent the flow of a DMN decision model, boxed expressions define the actual decision logic of individual nodes. DRDs and boxed expressions together form a complete and functional DMN decision model.</p>
</div>
<div class="paragraph">
<p>You can use the DMN designer in Business Central to define decision logic for your DRD components using built-in boxed expressions.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A DMN file is created or imported in Business Central.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong>, click the project name, and select the DMN file you want to modify.</p>
</li>
<li>
<p>In the DMN designer canvas, select a decision node or business knowledge model node that you want to define and click the <strong>Edit</strong> icon to open the DMN boxed expression designer:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-edit.png" alt="dmn decision edit">
</div>
<div class="title">Figure 102. Opening a new decision node boxed expression</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-edit.png" alt="dmn bkm edit">
</div>
<div class="title">Figure 103. Opening a new business knowledge model boxed expression</div>
</div>
<div class="paragraph">
<p>By default, all business knowledge models are defined as boxed function expressions containing a literal FEEL expression, a nested context expression of an external JAVA or PMML function, or a nested boxed expression of any type.</p>
</div>
<div class="paragraph">
<p>For decision nodes, you click the undefined table to select the type of boxed expression you want to use, such as a boxed literal expression, boxed context expression, decision table, or other DMN boxed expression.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-boxed-expression-options.png" alt="dmn decision boxed expression options">
</div>
<div class="title">Figure 104. Selecting the logic type for a decision node</div>
</div>
<div class="paragraph">
<p>For business knowledge model nodes, you click the top-left function cell to select the function type, or right-click the function value cell, select <strong>Clear</strong>, and select a boxed expression of another type.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-define.png" alt="dmn bkm define">
</div>
<div class="title">Figure 105. Selecting the function or other logic type for a business knowledge model</div>
</div>
</div>
</div>
</li>
<li>
<p>For this example, use a decision node and select <strong>Decision Table</strong> as the boxed expression type.</p>
<div class="paragraph">
<p>A decision table in DMN is a visual representation of one or more rules in a tabular format. Each rule consists of a single row in the table, and includes columns that define the conditions (input) and outcome (output) for that particular row.</p>
</div>
</li>
<li>
<p>Click the input column header to define the name and data type for the input condition. For example, name the input column <strong>Credit Score.FICO</strong> with a <code>number</code> data type. This column specifies numeric credit score values or ranges of loan applicants.</p>
</li>
<li>
<p>Click the output column header to define the name and data type for the output values. For example, name the output column <strong>Credit Score Rating</strong> and next to the <strong>Data Type</strong> option, click <strong>Manage</strong> to go to the <strong>Data Types</strong> page where you can create a custom data type with score ratings as constraints.</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types.png" alt="dmn manage data types">
</div>
<div class="title">Figure 106. Managing data types for a column header value</div>
</div>
</li>
<li>
<p>On the <strong>Data Types</strong> page, click <strong>Add</strong> and create a <strong>Credit_Score_Rating</strong> data type as a <code>string</code>:</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-add.png" alt="dmn custom data type add">
</div>
<div class="title">Figure 107. Adding a new data type</div>
</div>
</li>
<li>
<p>Click <strong>Constraints</strong>, select <strong>Enumeration</strong> from the drop-down options, and add the following constraints:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>"Excellent"</code></p>
</li>
<li>
<p><code>"Good"</code></p>
</li>
<li>
<p><code>"Fair"</code></p>
</li>
<li>
<p><code>"Poor"</code></p>
</li>
<li>
<p><code>"Bad"</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-constraints.png" alt="dmn custom data type constraints">
</div>
<div class="title">Figure 108. Adding constraints to the new data type</div>
</div>
<div class="paragraph">
<p>For information about constraint types and syntax requirements for the specified data type, see the <a href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.</p>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save the constraints and click <strong>Save</strong> to save the data type.</p>
</li>
<li>
<p>Return to the <strong>Credit Score Rating</strong> decision table, click the <strong>Credit Score Rating</strong> column header, and set the data type to this new custom data type.</p>
</li>
<li>
<p>Use the <strong>Credit Score.FICO</strong> input column to define credit score values or ranges of values, and use the <strong>Credit Score Rating</strong> column to specify one of the corresponding ratings you defined in the <strong>Credit_Score_Rating</strong> data type.</p>
<div class="paragraph">
<p>Right-click any value cell to insert or delete rows (rules) or columns (clauses).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example1a.png" alt="dmn decision table example1a">
</div>
<div class="title">Figure 109. Decision node decision table for credit score rating</div>
</div>
</li>
<li>
<p>After you define all rules, click the top-left corner of the decision table to define the rule <strong>Hit Policy</strong> and <strong>Builtin Aggregator</strong> (for <strong>COLLECT</strong> hit policy only).</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The hit policy determines how to reach an outcome when multiple rules in a decision table match the provided input values. The built-in aggregator determines how to aggregate rule values when you use the <strong>COLLECT</strong> hit policy.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-hit-policies.png" alt="dmn hit policies">
</div>
<div class="title">Figure 110. Defining the decision table hit policy</div>
</div>
<div class="paragraph">
<p>The following example is a more complex decision table that determines applicant qualification for a loan as the concluding decision node in the same loan prequalification decision model:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example3.png" alt="dmn decision table example3">
</div>
<div class="title">Figure 111. Decision table for loan prequalification</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For boxed expression types other than decision tables, you follow these guidelines similarly to navigate the boxed expression tables and define variables and parameters for decision logic, but according to the requirements of the boxed expression type. Some boxed expressions, such as boxed literal expressions, can be single-column tables, while other boxed expressions, such as function, context, and invocation expressions, can be multi-column tables with nested boxed expressions of other types.</p>
</div>
<div class="paragraph">
<p>For example, the following boxed context expression defines the parameters that determine whether a loan applicant can meet minimum mortgage payments based on principal, interest, taxes, and insurance (PITI), represented as a front-end ratio calculation with a sub-context expression:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example2.png" alt="dmn context expression example2">
</div>
<div class="title">Figure 112. Boxed context expression for front-end client PITI ratio</div>
</div>
<div class="paragraph">
<p>The following boxed function expression determines a monthly mortgage installment as a business knowledge model in a lending decision, with the function value defined as a nested context expression:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example3.png" alt="dmn function expression example3">
</div>
<div class="title">Figure 113. Boxed function expression for installment calculation in business knowledge model</div>
</div>
<div class="paragraph">
<p>For more information and examples of each boxed expression type, see <a href="#dmn-boxed-expressions-con_dmn-models">DMN decision logic in boxed expressions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="dmn-data-types-defining-proc_dmn-models"><a class="anchor" href="#dmn-data-types-defining-proc_dmn-models"></a><a class="link" href="#dmn-data-types-defining-proc_dmn-models">5.3.2. Creating custom data types for DMN boxed expressions in Business Central</a></h4>
<div class="paragraph">
<p>In DMN boxed expressions in Business Central, data types determine the structure of the data that you use within an associated table, column, or field in the boxed expression. You can use default DMN data types (such as String, Number, Boolean) or you can create custom data types to specify additional fields and constraints that you want to implement for the boxed expression values.</p>
</div>
<div class="paragraph">
<p>Custom data types that you create for a boxed expression can be simple or structured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Simple</strong> data types have only a name and a type assignment. Example: <code>Age (number)</code>.</p>
</li>
<li>
<p><strong>Structured</strong> data types contain multiple fields associated with a parent data type. Example: A single type <code>Person</code> containing the fields <code>Name (string)</code>, <code>Age (number)</code>, <code>Email (string)</code>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A DMN file is created or imported in Business Central.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong>, click the project name, and select the DMN file you want to modify.</p>
</li>
<li>
<p>In the DMN designer canvas, select a decision node or business knowledge model for which you want to define the data types and click the <strong>Edit</strong> icon to open the DMN boxed expression designer.</p>
</li>
<li>
<p>If the boxed expression is for a decision node that is not yet defined, click the undefined table to select the type of boxed expression you want to use, such as a boxed literal expression, boxed context expression, decision table, or other DMN boxed expression.</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-boxed-expression-options.png" alt="dmn decision boxed expression options">
</div>
<div class="title">Figure 114. Selecting the logic type for a decision node</div>
</div>
</li>
<li>
<p>Click the cell for the table header, column header, or parameter field (depending on the boxed expression type) for which you want to define the data type and click <strong>Manage</strong> to go to the <strong>Data Types</strong> page where you can create a custom data type.</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types.png" alt="dmn manage data types">
</div>
<div class="title">Figure 115. Managing data types for a column header value</div>
</div>
<div class="paragraph">
<p>You can also set and manage custom data types for a specified decision node or business knowledge model node by selecting the <strong>Diagram properties</strong> icon in the upper-right corner of the DMN designer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types1a.png" alt="dmn manage data types1a">
</div>
<div class="title">Figure 116. Managing data types in diagram properties</div>
</div>
<div class="paragraph">
<p>The data type that you define for a specified cell in a boxed expression determines the structure of the data that you use within that associated table, column, or field in the boxed expression.</p>
</div>
<div class="paragraph">
<p>In this example, an output column <strong>Credit Score Rating</strong> for a DMN decision table defines a set of custom credit score ratings based on an applicant&#8217;s credit score.</p>
</div>
</div>
</div>
</li>
<li>
<p>On the <strong>Data Types</strong> page, click <strong>Add</strong> and create a <strong>Credit_Score_Rating</strong> data type as a <code>string</code>:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-add.png" alt="dmn custom data type add">
</div>
<div class="title">Figure 117. Adding a new data type</div>
</div>
<div class="paragraph">
<p>If the data type requires a list of items, enable the <strong>List</strong> setting.</p>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong>Constraints</strong>, select <strong>Enumeration</strong> from the drop-down options, and add the following constraints:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>"Excellent"</code></p>
</li>
<li>
<p><code>"Good"</code></p>
</li>
<li>
<p><code>"Fair"</code></p>
</li>
<li>
<p><code>"Poor"</code></p>
</li>
<li>
<p><code>"Bad"</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-constraints.png" alt="dmn custom data type constraints">
</div>
<div class="title">Figure 118. Adding constraints to the new data type</div>
</div>
<div class="paragraph">
<p>For information about constraint types and syntax requirements for the specified data type, see the <a href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.</p>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save the constraints and click <strong>Save</strong> to save the data type.</p>
</li>
<li>
<p>Return to the <strong>Credit Score Rating</strong> decision table, click the <strong>Credit Score Rating</strong> column header, set the data type to this new custom data type, and define the rule values for that column with the rating constraints that you specified.</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example1a.png" alt="dmn decision table example1a">
</div>
<div class="title">Figure 119. Decision table for credit score rating</div>
</div>
<div class="paragraph">
<p>In the DMN decision model for this scenario, the <strong>Credit Score Rating</strong> decision flows into the following <strong>Loan Prequalification</strong> decision that also requires custom data types:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-blank.png" alt="dmn manage data types blank">
</div>
<div class="title">Figure 120. Decision table for loan prequalification</div>
</div>
</div>
</div>
</li>
<li>
<p>Continuing with this example, return to the <strong>Data Types</strong> window, click <strong>Add</strong>, and create a <strong>Loan_Qualification</strong> data type as a <code>Structure</code> with no constraints.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When you save the new structured data type, the first sub-field appears so that you can begin defining nested data fields in this parent data type. You can use these sub-fields in association with the parent structured data type in boxed expressions, such as nested column headers in decision tables or nested table parameters in context or function expressions.</p>
</div>
<div class="paragraph">
<p>For additional sub-fields, next to the <strong>Loan_Qualification</strong> data type, select the settings icon (three vertical dots) and select <strong>Insert nested field</strong>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured.png" alt="dmn manage data types structured">
</div>
<div class="title">Figure 121. Adding a new structured data type with nested fields</div>
</div>
</div>
</div>
</li>
<li>
<p>For this example, under the structured <strong>Loan_Qualification</strong> data type, add a <strong>Qualification</strong> field with <code>"Qualified"</code> and <code>"Not Qualified"</code> enumeration constraints, and a <strong>Reason</strong> field with no constraints. Add also a simple <strong>Back_End_Ratio</strong> and a <strong>Front_End_Ratio</strong> data type, both with <code>"Sufficient"</code> and <code>"Insufficient"</code> enumeration constraints.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Click <strong>Save</strong> for each data type that you create.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured2.png" alt="dmn manage data types structured2">
</div>
<div class="title">Figure 122. Adding nested data types with constraints</div>
</div>
</div>
</div>
</li>
<li>
<p>Return to the decision table and, for each column, click the column header cell, set the data type to the new corresponding custom data type, and define the rule values as needed for the column with the constraints that you specified, if applicable.</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example3.png" alt="dmn decision table example3">
</div>
<div class="title">Figure 123. Decision table for loan prequalification</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For boxed expression types other than decision tables, you follow these guidelines similarly to navigate the boxed expression tables and define custom data types as needed.</p>
</div>
<div class="paragraph">
<p>For example, the following boxed function expression uses custom <code>tCandidate</code> and <code>tProfile</code> structured data types to associate data for online dating compatibility:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured3.png" alt="dmn manage data types structured3">
</div>
<div class="title">Figure 124. Boxed function expression for online dating compatibility</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured3a.png" alt="dmn manage data types structured3a">
</div>
<div class="title">Figure 125. Custom data type definitions for online dating compatibility</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured3b.png" alt="dmn manage data types structured3b">
</div>
<div class="title">Figure 126. Parameter definitions with custom data types for online dating compatibility</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-included-models-con_dmn-models"><a class="anchor" href="#dmn-included-models-con_dmn-models"></a><a class="link" href="#dmn-included-models-con_dmn-models">5.3.3. Included models in DMN files in Business Central</a></h4>
<div class="paragraph">
<p>In the DMN designer in Business Central, you can use the <strong>Included Models</strong> tab to include other DMN models and Predictive Model Markup Language (PMML) models from your project in a specified DMN file. When you include a DMN model within another DMN file, you can use all of the nodes and logic from both models in the same decision requirements diagram (DRD). When you include a PMML model within a DMN file, you can invoke that PMML model as a boxed function expression for a DMN decision node or business knowledge model node.</p>
</div>
<div class="paragraph">
<p>You cannot include DMN or PMML models from other projects in Business Central.</p>
</div>
<div class="sect4">
<h5 id="dmn-included-models-dmn-proc_dmn-models"><a class="anchor" href="#dmn-included-models-dmn-proc_dmn-models"></a><a class="link" href="#dmn-included-models-dmn-proc_dmn-models">5.3.3.1. Including other DMN models within a DMN file in Business Central</a></h5>
<div class="paragraph">
<p>In Business Central, you can include other DMN models from your project in a specified DMN file. When you include a DMN model within another DMN file, you can use all of the nodes and logic from both models in the same decision requirements diagram (DRD), but you cannot edit the nodes from the included model. To edit nodes from included models, you must update the source file for the included model directly. If you update the source file for an included DMN model, open the DMN file where the DMN model is included (or close an re-open) to verify the changes.</p>
</div>
<div class="paragraph">
<p>You cannot include DMN models from other projects in Business Central.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The DMN models are created or imported (as <code>.dmn</code> files) in the same project in Business Central as the DMN file in which you want to include the models.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong>, click the project name, and select the DMN file you want to modify.</p>
</li>
<li>
<p>In the DMN designer, click the <strong>Included Models</strong> tab.</p>
</li>
<li>
<p>Click <strong>Include Model</strong>, select a DMN model from your project in the <strong>Models</strong> list, enter a unique name for the included model, and click <strong>Include</strong>:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model.png" alt="dmn include model">
</div>
<div class="title">Figure 127. Including a DMN model</div>
</div>
<div class="paragraph">
<p>The DMN model is added to this DMN file, and all DRD nodes from the included model are listed under <strong>Decision Components</strong> in the <strong>Decision Navigator</strong> view:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-list.png" alt="dmn include model list">
</div>
<div class="title">Figure 128. DMN file with decision components from the included DMN model</div>
</div>
<div class="paragraph">
<p>All data types from the included model are also listed in the <strong>Data Types</strong> tab for the DMN file:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-data-types.png" alt="dmn include model data types">
</div>
<div class="title">Figure 129. DMN file with data types from the included DMN model</div>
</div>
</div>
</div>
</li>
<li>
<p>In the <strong>Model</strong> tab of the DMN designer, click and drag the included DRD components onto the canvas to begin implementing them in your DRD:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-drd.png" alt="dmn include model drd">
</div>
<div class="title">Figure 130. Adding DRD components from the included DMN model</div>
</div>
<div class="paragraph">
<p>To edit DRD nodes or data types from included models, you must update the source file for the included model directly. If you update the source file for an included DMN model, open the DMN file where the DMN model is included (or close an re-open) to verify the changes.</p>
</div>
<div class="paragraph">
<p>To edit the included model name or to remove the included model from the DMN file, use the <strong>Included Models</strong> tab in the DMN designer.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When you remove an included model, any nodes from that included model that are currently used in the DRD are also removed.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="dmn-included-models-pmml-proc_dmn-models"><a class="anchor" href="#dmn-included-models-pmml-proc_dmn-models"></a><a class="link" href="#dmn-included-models-pmml-proc_dmn-models">5.3.3.2. Including PMML models within a DMN file in Business Central</a></h5>
<div class="paragraph">
<p>In Business Central, you can include Predictive Model Markup Language (PMML) models from your project in a specified DMN file. When you include a PMML model within a DMN file, you can invoke that PMML model as a boxed function expression for a DMN decision node or business knowledge model node. If you update the source file for an included PMML model, you must remove and re-include the PMML model in the DMN file to apply the source changes.</p>
</div>
<div class="paragraph">
<p>You cannot include PMML models from other projects in Business Central.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The PMML models are imported (as <code>.pmml</code> files) in the same project in Business Central as the DMN file in which you want to include the models.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your DMN project, add the following dependencies to the project <code>pom.xml</code> file to enable PMML evaluation:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the PMML compiler --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;kie-pmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;

&lt;!-- Alternative dependencies for JPMML Evaluator, override `kie-pmml` dependency --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-dmn-jpmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jpmml&lt;/groupId&gt;
  &lt;artifactId&gt;pmml-evaluator&lt;/artifactId&gt;
  &lt;version&gt;1.4.9&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jpmml&lt;/groupId&gt;
  &lt;artifactId&gt;pmml-evaluator-extension&lt;/artifactId&gt;
  &lt;version&gt;1.4.9&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To access the project <code>pom.xml</code> file in Business Central, you can select any existing asset in the project and then in the <strong>Project Explorer</strong> menu on the left side of the screen, click the <strong>Customize View</strong> gear icon and select <strong>Repository View</strong> &#8594; <strong>pom.xml</strong>.</p>
</div>
<div class="paragraph">
<p>If you want to use the full PMML specification implementation with the Java Evaluator API for PMML (JPMML), use the alternative set of JPMML dependencies in your DMN project. If the JPMML dependencies and the standard <code>kie-pmml</code> dependency are both present, the <code>kie-pmml</code> dependency is disabled. For information about JPMML licensing terms, see <a href="https://openscoring.io/">Openscoring.io</a>.</p>
</div>
</div>
</div>
</li>
<li>
<p>If you added the JPMML dependencies in your DMN project to use the JPMML Evaluator, download the following JAR files and add them to the <code>~/kie-server.war/WEB-INF/lib</code> and <code>~/business-central.war/WEB-INF/lib</code> directories in your Drools distribution:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://mvnrepository.com/artifact/org.kie/kie-dmn-jpmml/7.26.0.Final">KIE JPMML Integration 7.26.0.Final</a> JAR file from the online Maven repository</p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/org.jpmml/pmml-evaluator/1.4.9">JPMML Evaluator 1.4.9</a> JAR file from the online Maven repository</p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/org.jpmml/pmml-evaluator-extension/1.4.9">JPMML Evaluator Extensions 1.4.9</a> JAR file from the online Maven repository</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>These artifacts are required to enable JPMML evaluation in KIE Server and Business Central.</p>
</div>
</div>
</div>
</li>
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong>, click the project name, and select the DMN file you want to modify.</p>
</li>
<li>
<p>In the DMN designer, click the <strong>Included Models</strong> tab.</p>
</li>
<li>
<p>Click <strong>Include Model</strong>, select a PMML model from your project in the <strong>Models</strong> list, enter a unique name for the included model, and click <strong>Include</strong>:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-pmml.png" alt="dmn include model pmml">
</div>
<div class="title">Figure 131. Including a PMML model</div>
</div>
<div class="paragraph">
<p>The PMML model is added to this DMN file:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-list-pmml.png" alt="dmn include model list pmml">
</div>
<div class="title">Figure 132. DMN file with included PMML model</div>
</div>
</div>
</div>
</li>
<li>
<p>In the <strong>Model</strong> tab of the DMN designer, select or create the decision node or business knowledge model node in which you want to invoke the PMML model and click the <strong>Edit</strong> icon to open the DMN boxed expression designer:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-edit.png" alt="dmn decision edit">
</div>
<div class="title">Figure 133. Opening a new decision node boxed expression</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-edit.png" alt="dmn bkm edit">
</div>
<div class="title">Figure 134. Opening a new business knowledge model boxed expression</div>
</div>
</div>
</div>
</li>
<li>
<p>Set the expression type to <strong>Function</strong> (default for business knowledge model nodes), click the top-left function cell, and select <strong>PMML</strong>.</p>
</li>
<li>
<p>In the <strong>document</strong> and <strong>model</strong> rows in the table, double-click the undefined cells to specify the included PMML document and the relevant PMML model within that document:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-expression-pmml.png" alt="dmn include model expression pmml">
</div>
<div class="title">Figure 135. Adding a PMML model in a DMN business knowledge model</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example5.png" alt="dmn function expression example5">
</div>
<div class="title">Figure 136. Example PMML definition in a DMN business knowledge model</div>
</div>
<div class="paragraph">
<p>If you update the source file for an included PMML model, you must remove and re-include the PMML model in the DMN file to apply the source changes.</p>
</div>
<div class="paragraph">
<p>To edit the included model name or to remove the included model from the DMN file, use the <strong>Included Models</strong> tab in the DMN designer.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-documentation-con_dmn-models"><a class="anchor" href="#dmn-documentation-con_dmn-models"></a><a class="link" href="#dmn-documentation-con_dmn-models">5.3.4. DMN model documentation in Business Central</a></h4>
<div class="paragraph">
<p>In the DMN designer in Business Central, you can use the <strong>Documentation</strong> tab to generate a report of your DMN model that you can print or download as an HTML file for offline use. The DMN model report contains all decision requirements diagrams (DRDs), data types, and boxed expressions in your DMN model. You can use this report to share your DMN model details or as part of your internal reporting workflow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-documentation.png" alt="dmn documentation">
</div>
<div class="title">Figure 137. Example DMN model report</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-designer-nav-ref_dmn-models"><a class="anchor" href="#dmn-designer-nav-ref_dmn-models"></a><a class="link" href="#dmn-designer-nav-ref_dmn-models">5.3.5. DMN designer navigation and properties in Business Central</a></h4>
<div class="paragraph">
<p>The DMN designer in Business Central provides the following additional features to help you navigate through the components and properties of decision requirements diagrams (DRDs).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DMN file and diagram views</dt>
<dd>
<p>In the upper-left corner of the DMN designer, select the <strong>Project Explorer</strong> view to navigate between all DMN and other files or select the <strong>Decision Navigator</strong> view to navigate between the decision components, graphs, and boxed expressions of a selected DRD:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-project-view.png" alt="dmn designer project view">
</div>
<div class="title">Figure 138. Project Explorer view</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-nav-view.png" alt="dmn designer nav view">
</div>
<div class="title">Figure 139. Decision Navigator view</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-nav-view2.png" alt="dmn designer nav view2">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The DRD components from any DMN models included in the DMN file (in the <strong>Included Models</strong> tab) are also listed in the <strong>Decision Components</strong> panel for the DMN file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the upper-right corner of the DMN designer, select the <strong>Explore diagram</strong> icon to view an elevated preview of the selected DRD and to navigate between the nodes of the selected DRD:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-preview.png" alt="dmn designer preview">
</div>
<div class="title">Figure 140. Explore diagram view</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">DRD properties and design</dt>
<dd>
<p>In the upper-right corner of the DMN designer, select the <strong>Diagram properties</strong> icon to modify the identifying information, data types, and appearance of a selected DRD, DRD node, or boxed expression cell:</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-properties.png" alt="dmn designer properties">
</div>
<div class="title">Figure 141. DRD node properties</div>
</div>
<div class="paragraph">
<p>To view the properties of the entire DRD, click the DRD canvas background instead of a specific node.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">DRD search</dt>
<dd>
<p>In the upper-right corner of the DMN designer, use the search bar to search for text that appears in your DRD. The search feature is especially helpful in complex DRDs with many nodes:</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-search.png" alt="dmn designer search">
</div>
<div class="title">Figure 142. DRD search</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dmn-execution-con"><a class="anchor" href="#dmn-execution-con"></a><a class="link" href="#dmn-execution-con">5.4. DMN model execution</a></h3>
<div class="paragraph">
<p>You can create or import DMN files in your Drools project using Business Central or package the DMN files as part of your project knowledge JAR (KJAR) file without Business Central. After you implement your DMN files in your Drools project, you can execute the DMN decision service by deploying the KIE container that contains it to KIE Server for remote access
or by manipulating the KIE container directly as a dependency of the calling application. Other options for creating and deploying DMN knowledge packages are also available, and most are similar for all types of knowledge assets, such as DRL files or process definitions.</p>
</div>
<div class="paragraph">
<p>For information about including external DMN assets with your project packaging and deployment method, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
<div class="sect3">
<h4 id="dmn-execution-embedded-proc"><a class="anchor" href="#dmn-execution-embedded-proc"></a><a class="link" href="#dmn-execution-embedded-proc">5.4.1. Embedding a DMN call directly in a Java application</a></h4>
<div class="paragraph">
<p>A KIE container is local when the knowledge assets are either embedded directly into the calling program or are physically pulled in using Maven dependencies for the KJAR. You typically embed knowledge assets directly into a project if there is a tight relationship between the version of the code and the version of the DMN definition. Any changes to the decision take effect after you have intentionally updated and redeployed the application. A benefit of this approach is that proper operation does not rely on any external dependencies to the run time, which can be a limitation of locked-down environments.</p>
</div>
<div class="paragraph">
<p>Using Maven dependencies enables further flexibility because the specific version of the decision can dynamically change, (for example, by using a system property), and it can be periodically scanned for updates and automatically updated. This introduces an external dependency on the deploy time of the service, but executes the decision locally, reducing reliance on an external service being available during run time.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and configured, including a known user name and credentials for a user with the <code>kie-server</code> role. For installation options, see
<a href="#_installationandsetup">Installation and Setup (Core and IDE)</a>.</p>
</li>
<li>
<p>You have built the DMN project as a KJAR artifact and deployed it to KIE Server. Ideally, you have built the DMN project as an executable model for more efficient execution:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about project packaging and deployment and executable models, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your client application, add the following dependencies to the relevant classpath of your Java project:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the DMN runtime API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-dmn-core&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required if not using classpath KIE container --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;version&gt;</code> is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005).</p>
</div>
</div>
</div>
</li>
<li>
<p>Create a KIE container from <code>classpath</code> or <code>ReleaseId</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "my-kjar", "1.0.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternative option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kieContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</li>
<li>
<p>Obtain <code>DMNRuntime</code> from the KIE container and a reference to the DMN model to be evaluated, by using the model <code>namespace</code> and <code>modelName</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNRuntime dmnRuntime = KieRuntimeFactory.of(kieContainer.getKieBase()).get(DMNRuntime.class);

String namespace = "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a";
String modelName = "dmn-movieticket-ageclassification";

DMNModel dmnModel = dmnRuntime.getModel(namespace, modelName);</code></pre>
</div>
</div>
</li>
<li>
<p>Execute the decision services for the desired model:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNContext dmnContext = dmnRuntime.newContext();  <i class="conum" data-value="1"></i><b>(1)</b>

for (Integer age : Arrays.asList(1,12,13,64,65,66)) {
    dmnContext.set("Age", age);  <i class="conum" data-value="2"></i><b>(2)</b>
    DMNResult dmnResult =
        dmnRuntime.evaluateAll(dmnModel, dmnContext);  <i class="conum" data-value="3"></i><b>(3)</b>

    for (DMNDecisionResult dr : dmnResult.getDecisionResults()) {  <i class="conum" data-value="4"></i><b>(4)</b>
        log.info("Age: " + age + ", " +
                 "Decision: '" + dr.getDecisionName() + "', " +
                 "Result: " + dr.getResult());
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instantiate a new DMN Context to be the input for the model evaluation. Note that this example is looping through the Age Classification decision multiple times.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assign input variables for the input DMN context.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Evaluate all DMN decisions defined in the DMN model.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Each evaluation may result in one or more results, creating the loop.</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This example prints the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Age 1 Decision 'AgeClassification' : Child
Age 12 Decision 'AgeClassification' : Child
Age 13 Decision 'AgeClassification' : Adult
Age 64 Decision 'AgeClassification' : Adult
Age 65 Decision 'AgeClassification' : Senior
Age 66 Decision 'AgeClassification' : Senior</pre>
</div>
</div>
<div class="paragraph">
<p>If the DMN model was not previously compiled as an executable model for more efficient execution, you can enable the following property when you execute your DMN models:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.compiler.execmodel=true</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="dmn-execution-remote-java-proc"><a class="anchor" href="#dmn-execution-remote-java-proc"></a><a class="link" href="#dmn-execution-remote-java-proc">5.4.2. Executing a DMN service using the KIE Server Java client API</a></h4>
<div class="paragraph">
<p>The KIE Server Java client API provides a lightweight approach to invoking a remote DMN service either through the REST or JMS interfaces of KIE Server. This approach reduces the number of runtime dependencies necessary to interact with a KIE base. Decoupling the calling code from the decision definition also increases flexibility by enabling them to iterate independently at the appropriate pace.</p>
</div>
<div class="paragraph">
<p>For more information about the KIE Server Java client API, see
<a href="#kie-server-java-api-con_kie-apis">KIE Server Java client API for KIE containers and business assets</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and configured, including a known user name and credentials for a user with the <code>kie-server</code> role. For installation options, see
<a href="#_installationandsetup">Installation and Setup (Core and IDE)</a>.</p>
</li>
<li>
<p>You have built the DMN project as a KJAR artifact and deployed it to KIE Server. Ideally, you have built the DMN project as an executable model for more efficient execution:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about project packaging and deployment and executable models, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
</div>
</div>
</li>
<li>
<p>You have the ID of the KIE container containing the DMN model. If more than one model is present, you must also know the model namespace and model name of the relevant model.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your client application, add the following dependency to the relevant classpath of your Java project:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the KIE Server Java client API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;version&gt;</code> is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005).</p>
</div>
</div>
</div>
</li>
<li>
<p>Instantiate a <code>KieServicesClient</code> instance with the appropriate connection information.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServicesConfiguration conf =
    KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD); <i class="conum" data-value="1"></i><b>(1)</b>

conf.setMarshallingFormat(MarshallingFormat.JSON);  <i class="conum" data-value="2"></i><b>(2)</b>

KieServicesClient kieServicesClient = KieServicesFactory.newKieServicesClient(conf);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The connection information:
<div class="ulist">
<ul>
<li>
<p>Example URL: <code>http://localhost:8080/kie-server/services/rest/server</code></p>
</li>
<li>
<p>The credentials should reference a user with the <code>kie-server</code> role.</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Marshalling format is an instance of <code>org.kie.server.api.marshalling.MarshallingFormat</code>. It controls whether the messages will be JSON or XML. Options for Marshalling format are JSON, JAXB, or XSTREAM.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Obtain a <code>DMNServicesClient</code> from the KIE server Java client connected to the related KIE Server by invoking the method <code>getServicesClient()</code> on the KIE server Java client instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNServicesClient dmnClient = kieServicesClient.getServicesClient(DMNServicesClient.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>dmnClient</code> can now execute decision services on KIE Server.</p>
</div>
</li>
<li>
<p>Execute the decision services for the desired model.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">for (Integer age : Arrays.asList(1,12,13,64,65,66)) {
    DMNContext dmnContext = dmnClient.newContext(); <i class="conum" data-value="1"></i><b>(1)</b>
    dmnContext.set("Age", age);  <i class="conum" data-value="2"></i><b>(2)</b>
    ServiceResponse&lt;DMNResult&gt; serverResp =   <i class="conum" data-value="3"></i><b>(3)</b>
        dmnClient.evaluateAll($kieContainerId,
                              $modelNamespace,
                              $modelName,
                              dmnContext);

    DMNResult dmnResult = serverResp.getResult();  <i class="conum" data-value="4"></i><b>(4)</b>
    for (DMNDecisionResult dr : dmnResult.getDecisionResults()) {
        log.info("Age: " + age + ", " +
                 "Decision: '" + dr.getDecisionName() + "', " +
                 "Result: " + dr.getResult());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instantiate a new DMN Context to be the input for the model evaluation. Note that this example is looping through the Age Classification decision multiple times.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assign input variables for the input DMN Context.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Evaluate all the DMN Decisions defined in the DMN model:
<div class="ulist">
<ul>
<li>
<p><code>$kieContainerId</code> is the ID of the container where the KJAR containing the DMN model is deployed</p>
</li>
<li>
<p><code>$modelNamespace</code> is the namespace for the model.</p>
</li>
<li>
<p><code>$modelName</code> is the name for the model.</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The DMN Result object is available from the server response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this point, the <code>dmnResult</code> contains all the decision results from the evaluated DMN model.</p>
</div>
<div class="paragraph">
<p>You can also execute only a specific DMN decision in the model by using alternative methods of the <code>DMNServicesClient</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the KIE container only contains one DMN model, you can omit <code>$modelNamespace</code> and <code>$modelName</code> because the KIE Server API selects it by default.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="dmn-execution-rest-proc"><a class="anchor" href="#dmn-execution-rest-proc"></a><a class="link" href="#dmn-execution-rest-proc">5.4.3. Executing a DMN service using the KIE Server REST API</a></h4>
<div class="paragraph">
<p>Directly interacting with the REST endpoints of KIE Server provides the most separation between the calling code and the decision logic definition. The calling code is completely free of direct dependencies, and you can implement it in an entirely different development platform such as <code>Node.js</code> or <code>.NET</code>. The examples in this section demonstrate Nix-style curl commands but provide relevant information to adapt to any REST client.</p>
</div>
<div class="paragraph">
<p>For more information about the KIE Server REST API, see
<a href="#kie-server-rest-api-con_kie-apis">KIE Server REST API for KIE containers and business assets</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and configured, including a known user name and credentials for a user with the <code>kie-server</code> role. For installation options, see
<a href="#_installationandsetup">Installation and Setup (Core and IDE)</a>.</p>
</li>
<li>
<p>You have built the DMN project as a KJAR artifact and deployed it to KIE Server. Ideally, you have built the DMN project as an executable model for more efficient execution:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about project packaging and deployment and executable models, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
</div>
</div>
</li>
<li>
<p>You have the ID of the KIE container containing the DMN model. If more than one model is present, you must also know the model namespace and model name of the relevant model.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Determine the base URL for accessing the KIE Server REST API endpoints. This requires knowing the following values (with the default local deployment values as an example):</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Host (<code>localhost</code>)</p>
</li>
<li>
<p>Port (<code>8080</code>)</p>
</li>
<li>
<p>Root context (<code>kie-server</code>)</p>
</li>
<li>
<p>Base REST path (<code>services/rest/</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example base URL in local deployment:</p>
</div>
<div class="paragraph">
<p><code>http://localhost:8080/kie-server/services/rest/</code></p>
</div>
</div>
</div>
</li>
<li>
<p>Determine user authentication requirements.</p>
<div class="paragraph">
<p>When users are defined directly in the KIE Server configuration, HTTP Basic authentication is used and requires the user name and password. Successful requests require that the user have the <code>kie-server</code> role.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to add credentials to a curl request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u username:password &lt;request&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If KIE Server is configured with Red Hat Single Sign-On, the request must include a bearer token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">curl -H "Authorization: bearer $TOKEN" &lt;request&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the format of the request and response. The REST API endpoints work with both JSON and XML formats and are set using request headers:</p>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code>curl -H "accept: application/json" -H "content-type: application/json"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code>curl -H "accept: application/xml" -H "content-type: application/xml"</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) Query the container for a list of deployed decision models:</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>[GET]</strong> <code>server/containers/{containerId}/dmn</code></p>
</div>
<div class="paragraph">
<p>Example curl request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u krisv:krisv -H "accept: application/xml" -X GET "http://localhost:8080/kie-server/services/rest/server/containers/MovieDMNContainer/dmn"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sample XML output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;response type="SUCCESS" msg="OK models successfully retrieved from container 'MovieDMNContainer'"&gt;
    &lt;dmn-model-info-list&gt;
        &lt;model&gt;
            &lt;model-namespace&gt;http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a&lt;/model-namespace&gt;
            &lt;model-name&gt;dmn-movieticket-ageclassification&lt;/model-name&gt;
            &lt;model-id&gt;_99&lt;/model-id&gt;
            &lt;decisions&gt;
                &lt;dmn-decision-info&gt;
                    &lt;decision-id&gt;_3&lt;/decision-id&gt;
                    &lt;decision-name&gt;AgeClassification&lt;/decision-name&gt;
                &lt;/dmn-decision-info&gt;
            &lt;/decisions&gt;
        &lt;/model&gt;
    &lt;/dmn-model-info-list&gt;
&lt;/response&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sample JSON output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type" : "SUCCESS",
  "msg" : "OK models successfully retrieved from container 'MovieDMNContainer'",
  "result" : {
    "dmn-model-info-list" : {
      "models" : [ {
        "model-namespace" : "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a",
        "model-name" : "dmn-movieticket-ageclassification",
        "model-id" : "_99",
        "decisions" : [ {
          "decision-id" : "_3",
          "decision-name" : "AgeClassification"
        } ]
      } ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the model:</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>[POST]</strong> <code>server/containers/{containerId}/dmn</code></p>
</div>
<div class="paragraph">
<p>Example curl request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u krisv:krisv -H "accept: application/json" -H "content-type: application/json" -X POST "http://localhost:8080/kie-server/services/rest/server/containers/MovieDMNContainer/dmn" -d "{ \"model-namespace\" : \"http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a\", \"model-name\" : \"dmn-movieticket-ageclassification\", \"decision-name\" : [ ], \"decision-id\" : [ ], \"dmn-context\" : {\"Age\" : 66}}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example JSON request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "model-namespace" : "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a",
  "model-name" : "dmn-movieticket-ageclassification",
  "decision-name" : [ ],
  "decision-id" : [ ],
  "dmn-context" : {"Age" : 66}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example XML request (JAXB format):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;dmn-evaluation-context&gt;
    &lt;model-namespace&gt;http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a&lt;/model-namespace&gt;
    &lt;model-name&gt;dmn-movieticket-ageclassification&lt;/model-name&gt;
    &lt;dmn-context xsi:type="jaxbListWrapper" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
        &lt;type&gt;MAP&lt;/type&gt;
        &lt;element xsi:type="jaxbStringObjectPair" key="Age"&gt;
            &lt;value xsi:type="xs:int" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;66&lt;/value&gt;
        &lt;/element&gt;
    &lt;/dmn-context&gt;
&lt;/dmn-evaluation-context&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Regardless of the request format, the request requires the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Model namespace</p>
</li>
<li>
<p>Model name</p>
</li>
<li>
<p>Context object containing input values</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example JSON response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type" : "SUCCESS",
  "msg" : "OK from container 'MovieDMNContainer'",
  "result" : {
    "dmn-evaluation-result" : {
      "messages" : [ ],
      "model-namespace" : "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a",
      "model-name" : "dmn-movieticket-ageclassification",
      "decision-name" : [ ],
      "dmn-context" : {
        "Age" : 66,
        "AgeClassification" : "Senior"
      },
      "decision-results" : {
        "_3" : {
          "messages" : [ ],
          "decision-id" : "_3",
          "decision-name" : "AgeClassification",
          "result" : "Senior",
          "status" : "SUCCEEDED"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example XML (JAXB format) response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;response type="SUCCESS" msg="OK from container 'MovieDMNContainer'"&gt;
      &lt;dmn-evaluation-result&gt;
            &lt;model-namespace&gt;http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a&lt;/model-namespace&gt;
            &lt;model-name&gt;dmn-movieticket-ageclassification&lt;/model-name&gt;
            &lt;dmn-context xsi:type="jaxbListWrapper" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                  &lt;type&gt;MAP&lt;/type&gt;
                  &lt;element xsi:type="jaxbStringObjectPair" key="Age"&gt;
                        &lt;value xsi:type="xs:int" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;66&lt;/value&gt;
                  &lt;/element&gt;
                  &lt;element xsi:type="jaxbStringObjectPair" key="AgeClassification"&gt;
                        &lt;value xsi:type="xs:string" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;Senior&lt;/value&gt;
                  &lt;/element&gt;
            &lt;/dmn-context&gt;
            &lt;messages/&gt;
            &lt;decisionResults&gt;
                  &lt;entry&gt;
                        &lt;key&gt;_3&lt;/key&gt;
                        &lt;value&gt;
                              &lt;decision-id&gt;_3&lt;/decision-id&gt;
                              &lt;decision-name&gt;AgeClassification&lt;/decision-name&gt;
                              &lt;result xsi:type="xs:string" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;Senior&lt;/result&gt;
                              &lt;messages/&gt;
                              &lt;status&gt;SUCCEEDED&lt;/status&gt;
                        &lt;/value&gt;
                  &lt;/entry&gt;
            &lt;/decisionResults&gt;
      &lt;/dmn-evaluation-result&gt;
&lt;/response&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drools.PMML"><a class="anchor" href="#drools.PMML"></a><a class="link" href="#drools.PMML">6. Predictive Model Markup Language (PMML)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="pmml-con_pmml-models"><a class="anchor" href="#pmml-con_pmml-models"></a><a class="link" href="#pmml-con_pmml-models">6.1. Predictive Model Markup Language (PMML)</a></h3>
<div class="paragraph">
<p>Predictive Model Markup Language (PMML) is an XML-based standard established by the Data Mining Group (DMG) for defining statistical and data-mining models. PMML models can be shared between PMML-compliant platforms and across organizations so that business analysts and developers are unified in designing, analyzing, and implementing PMML-based assets and services.</p>
</div>
<div class="paragraph">
<p>For more information about the background and applications of PMML, see the DMG <a href="http://dmg.org/pmml/pmml-v4-2-1.html">PMML specification</a>.</p>
</div>
<div class="sect3">
<h4 id="pmml-conformance-con_pmml-models"><a class="anchor" href="#pmml-conformance-con_pmml-models"></a><a class="link" href="#pmml-conformance-con_pmml-models">6.1.1. PMML conformance levels</a></h4>
<div class="paragraph">
<p>The PMML specification defines producer and consumer conformance levels in a software implementation to ensure that PMML models are created and integrated reliably. For the formal definitions of each conformance level, see the DMG <a href="http://dmg.org/pmml/v4-2-1/Conformance.html">PMML conformance</a> page.</p>
</div>
<div class="paragraph">
<p>The following list summarizes the PMML conformance levels:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Producer conformance</dt>
<dd>
<p>A tool or application is producer conforming if it generates valid PMML documents for at least one type of model. Satisfying PMML producer conformance requirements ensures that a model definition document is syntactically correct and defines a model instance that is consistent with semantic criteria that are defined in model specifications.</p>
</dd>
<dt class="hdlist1">Consumer conformance</dt>
<dd>
<p>An application is consumer conforming if it accepts valid PMML documents for at least one type of model. Satisfying consumer conformance requirements ensures that a PMML model created according to producer conformance can be integrated and used as defined. For example, if an application is consumer conforming for Regression model types, then valid PMML documents defining models of this type produced by different conforming producers would be interchangeable in the application.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Drools includes consumer conformance support for the following PMML 4.2.1 model types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Regression.html">Regression models</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Scorecard.html">Scorecard models</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/TreeModel.html">Tree models</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/MultipleModels.html#xsdElement_MiningModel">Mining models</a> (with sub-types <code>modelChain</code>, <code>selectAll</code>, and <code>selectFirst</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a list of all PMML model types, including those not supported in Drools, see the DMG <a href="http://dmg.org/pmml/v4-2-1/GeneralStructure.html">PMML specification</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pmml-examples-ref_pmml-models"><a class="anchor" href="#pmml-examples-ref_pmml-models"></a><a class="link" href="#pmml-examples-ref_pmml-models">6.2. PMML model examples</a></h3>
<div class="paragraph">
<p>PMML defines an <a href="http://dmg.org/pmml/v4-2-1/pmml-4-2.xsd">XML schema</a> that enables PMML models to be used between different PMML-compliant platforms. The PMML specification enables multiple software platforms to work with the same file for authoring, testing, and production execution, assuming producer and consumer conformance are met.</p>
</div>
<div class="paragraph">
<p>The following are examples of PMML Regression, Scorecard, Tree, and Mining models. These examples illustrate the supported types of models that you can integrate with your decision services in Drools.</p>
</div>
<div class="paragraph">
<p>For more PMML examples, see the DMG <a href="http://dmg.org/pmml/pmml_examples/index.html">PMML Sample Files</a> page.</p>
</div>
<div class="listingblock">
<div class="title">Example PMML Regression model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header copyright="JBoss"/&gt;
  &lt;DataDictionary numberOfFields="5"&gt;
    &lt;DataField dataType="double" name="fld1" optype="continuous"/&gt;
    &lt;DataField dataType="double" name="fld2" optype="continuous"/&gt;
    &lt;DataField dataType="string" name="fld3" optype="categorical"&gt;
      &lt;Value value="x"/&gt;
      &lt;Value value="y"/&gt;
    &lt;/DataField&gt;
    &lt;DataField dataType="double" name="fld4" optype="continuous"/&gt;
    &lt;DataField dataType="double" name="fld5" optype="continuous"/&gt;
  &lt;/DataDictionary&gt;
  &lt;RegressionModel algorithmName="linearRegression" functionName="regression" modelName="LinReg" normalizationMethod="logit" targetFieldName="fld4"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="fld1"/&gt;
      &lt;MiningField name="fld2"/&gt;
      &lt;MiningField name="fld3"/&gt;
      &lt;MiningField name="fld4" usageType="predicted"/&gt;
      &lt;MiningField name="fld5" usageType="target"/&gt;
    &lt;/MiningSchema&gt;
    &lt;RegressionTable intercept="0.5"&gt;
      &lt;NumericPredictor coefficient="5" exponent="2" name="fld1"/&gt;
      &lt;NumericPredictor coefficient="2" exponent="1" name="fld2"/&gt;
      &lt;CategoricalPredictor coefficient="-3" name="fld3" value="x"/&gt;
      &lt;CategoricalPredictor coefficient="3" name="fld3" value="y"/&gt;
      &lt;PredictorTerm coefficient="0.4"&gt;
        &lt;FieldRef field="fld1"/&gt;
        &lt;FieldRef field="fld2"/&gt;
      &lt;/PredictorTerm&gt;
    &lt;/RegressionTable&gt;
  &lt;/RegressionModel&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example PMML Scorecard model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header copyright="JBoss"/&gt;
  &lt;DataDictionary numberOfFields="4"&gt;
    &lt;DataField name="param1" optype="continuous" dataType="double"/&gt;
    &lt;DataField name="param2" optype="continuous" dataType="double"/&gt;
    &lt;DataField name="overallScore" optype="continuous" dataType="double" /&gt;
    &lt;DataField name="finalscore" optype="continuous" dataType="double" /&gt;
  &lt;/DataDictionary&gt;
  &lt;Scorecard modelName="ScorecardCompoundPredicate" useReasonCodes="true" isScorable="true" functionName="regression"    baselineScore="15" initialScore="0.8" reasonCodeAlgorithm="pointsAbove"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="param1" usageType="active" invalidValueTreatment="asMissing"&gt;
      &lt;/MiningField&gt;
      &lt;MiningField name="param2" usageType="active" invalidValueTreatment="asMissing"&gt;
      &lt;/MiningField&gt;
      &lt;MiningField name="overallScore" usageType="target"/&gt;
      &lt;MiningField name="finalscore" usageType="predicted"/&gt;
    &lt;/MiningSchema&gt;
    &lt;Characteristics&gt;
      &lt;Characteristic name="ch1" baselineScore="50" reasonCode="reasonCh1"&gt;
        &lt;Attribute partialScore="20"&gt;
          &lt;SimplePredicate field="param1" operator="lessThan" value="20"/&gt;
        &lt;/Attribute&gt;
        &lt;Attribute partialScore="100"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="param1" operator="greaterOrEqual" value="20"/&gt;
            &lt;SimplePredicate field="param2" operator="lessOrEqual" value="25"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
        &lt;Attribute partialScore="200"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="param1" operator="greaterOrEqual" value="20"/&gt;
            &lt;SimplePredicate field="param2" operator="greaterThan" value="25"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
      &lt;/Characteristic&gt;
      &lt;Characteristic name="ch2" reasonCode="reasonCh2"&gt;
        &lt;Attribute partialScore="10"&gt;
          &lt;CompoundPredicate booleanOperator="or"&gt;
            &lt;SimplePredicate field="param2" operator="lessOrEqual" value="-5"/&gt;
            &lt;SimplePredicate field="param2" operator="greaterOrEqual" value="50"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
        &lt;Attribute partialScore="20"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="param2" operator="greaterThan" value="-5"/&gt;
            &lt;SimplePredicate field="param2" operator="lessThan" value="50"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
      &lt;/Characteristic&gt;
    &lt;/Characteristics&gt;
  &lt;/Scorecard&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example PMML Tree model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header copyright="JBOSS"/&gt;
  &lt;DataDictionary numberOfFields="5"&gt;
    &lt;DataField dataType="double" name="fld1" optype="continuous"/&gt;
    &lt;DataField dataType="double" name="fld2" optype="continuous"/&gt;
    &lt;DataField dataType="string" name="fld3" optype="categorical"&gt;
      &lt;Value value="true"/&gt;
      &lt;Value value="false"/&gt;
    &lt;/DataField&gt;
    &lt;DataField dataType="string" name="fld4" optype="categorical"&gt;
      &lt;Value value="optA"/&gt;
      &lt;Value value="optB"/&gt;
      &lt;Value value="optC"/&gt;
    &lt;/DataField&gt;
    &lt;DataField dataType="string" name="fld5" optype="categorical"&gt;
      &lt;Value value="tgtX"/&gt;
      &lt;Value value="tgtY"/&gt;
      &lt;Value value="tgtZ"/&gt;
    &lt;/DataField&gt;
  &lt;/DataDictionary&gt;
  &lt;TreeModel functionName="classification" modelName="TreeTest"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="fld1"/&gt;
      &lt;MiningField name="fld2"/&gt;
      &lt;MiningField name="fld3"/&gt;
      &lt;MiningField name="fld4"/&gt;
      &lt;MiningField name="fld5" usageType="predicted"/&gt;
    &lt;/MiningSchema&gt;
    &lt;Node score="tgtX"&gt;
      &lt;True/&gt;
      &lt;Node score="tgtX"&gt;
        &lt;SimplePredicate field="fld4" operator="equal" value="optA"/&gt;
        &lt;Node score="tgtX"&gt;
          &lt;CompoundPredicate booleanOperator="surrogate"&gt;
            &lt;SimplePredicate field="fld1" operator="lessThan" value="30.0"/&gt;
            &lt;SimplePredicate field="fld2" operator="greaterThan" value="20.0"/&gt;
          &lt;/CompoundPredicate&gt;
          &lt;Node score="tgtX"&gt;
            &lt;SimplePredicate field="fld2" operator="lessThan" value="40.0"/&gt;
          &lt;/Node&gt;
          &lt;Node score="tgtZ"&gt;
            &lt;SimplePredicate field="fld2" operator="greaterOrEqual" value="10.0"/&gt;
          &lt;/Node&gt;
        &lt;/Node&gt;
        &lt;Node score="tgtZ"&gt;
          &lt;CompoundPredicate booleanOperator="or"&gt;
            &lt;SimplePredicate field="fld1" operator="greaterOrEqual" value="60.0"/&gt;
            &lt;SimplePredicate field="fld1" operator="lessOrEqual" value="70.0"/&gt;
          &lt;/CompoundPredicate&gt;
          &lt;Node score="tgtZ"&gt;
            &lt;SimpleSetPredicate booleanOperator="isNotIn" field="fld4"&gt;
              &lt;Array type="string"&gt;optA optB&lt;/Array&gt;
            &lt;/SimpleSetPredicate&gt;
          &lt;/Node&gt;
        &lt;/Node&gt;
      &lt;/Node&gt;
      &lt;Node score="tgtY"&gt;
        &lt;CompoundPredicate booleanOperator="or"&gt;
          &lt;SimplePredicate field="fld4" operator="equal" value="optA"/&gt;
          &lt;SimplePredicate field="fld4" operator="equal" value="optC"/&gt;
        &lt;/CompoundPredicate&gt;
        &lt;Node score="tgtY"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="fld1" operator="greaterThan" value="10.0"/&gt;
            &lt;SimplePredicate field="fld1" operator="lessThan" value="50.0"/&gt;
            &lt;SimplePredicate field="fld4" operator="equal" value="optA"/&gt;
            &lt;SimplePredicate field="fld2" operator="lessThan" value="100.0"/&gt;
            &lt;SimplePredicate field="fld3" operator="equal" value="false"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Node&gt;
        &lt;Node score="tgtZ"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="fld4" operator="equal" value="optC"/&gt;
            &lt;SimplePredicate field="fld2" operator="lessThan" value="30.0"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Node&gt;
      &lt;/Node&gt;
    &lt;/Node&gt;
  &lt;/TreeModel&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example PMML Mining model (modelChain)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header&gt;
    &lt;Application name="Drools-PMML" version="7.0.0-SNAPSHOT" /&gt;
  &lt;/Header&gt;
  &lt;DataDictionary numberOfFields="7"&gt;
    &lt;DataField name="age" optype="continuous" dataType="double" /&gt;
    &lt;DataField name="occupation" optype="categorical" dataType="string"&gt;
      &lt;Value value="SKYDIVER" /&gt;
      &lt;Value value="ASTRONAUT" /&gt;
      &lt;Value value="PROGRAMMER" /&gt;
      &lt;Value value="TEACHER" /&gt;
      &lt;Value value="INSTRUCTOR" /&gt;
    &lt;/DataField&gt;
    &lt;DataField name="residenceState" optype="categorical" dataType="string"&gt;
      &lt;Value value="AP" /&gt;
      &lt;Value value="KN" /&gt;
      &lt;Value value="TN" /&gt;
    &lt;/DataField&gt;
    &lt;DataField name="validLicense" optype="categorical" dataType="boolean" /&gt;
    &lt;DataField name="overallScore" optype="continuous" dataType="double" /&gt;
    &lt;DataField name="grade" optype="categorical" dataType="string"&gt;
      &lt;Value value="A" /&gt;
      &lt;Value value="B" /&gt;
      &lt;Value value="C" /&gt;
      &lt;Value value="D" /&gt;
      &lt;Value value="F" /&gt;
    &lt;/DataField&gt;
    &lt;DataField name="qualificationLevel" optype="categorical" dataType="string"&gt;
      &lt;Value value="Unqualified" /&gt;
      &lt;Value value="Barely" /&gt;
      &lt;Value value="Well" /&gt;
      &lt;Value value="Over" /&gt;
    &lt;/DataField&gt;
  &lt;/DataDictionary&gt;
  &lt;MiningModel modelName="SampleModelChainMine" functionName="classification"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="age" /&gt;
      &lt;MiningField name="occupation" /&gt;
      &lt;MiningField name="residenceState" /&gt;
      &lt;MiningField name="validLicense" /&gt;
      &lt;MiningField name="overallScore" /&gt;
      &lt;MiningField name="qualificationLevel" usageType="target"/&gt;
    &lt;/MiningSchema&gt;
    &lt;Segmentation multipleModelMethod="modelChain"&gt;
      &lt;Segment id="1"&gt;
        &lt;True /&gt;
        &lt;Scorecard modelName="Sample Score 1" useReasonCodes="true" isScorable="true" functionName="regression"               baselineScore="0.0" initialScore="0.345"&gt;
          &lt;MiningSchema&gt;
            &lt;MiningField name="age" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="occupation" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="residenceState" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="validLicense" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="overallScore" usageType="predicted" /&gt;
          &lt;/MiningSchema&gt;
          &lt;Output&gt;
            &lt;OutputField name="calculatedScore" displayName="Final Score" dataType="double" feature="predictedValue"                     targetField="overallScore" /&gt;
          &lt;/Output&gt;
          &lt;Characteristics&gt;
            &lt;Characteristic name="AgeScore" baselineScore="0.0" reasonCode="ABZ"&gt;
              &lt;Extension name="cellRef" value="$B$8" /&gt;
              &lt;Attribute partialScore="10.0"&gt;
                &lt;Extension name="cellRef" value="$C$10" /&gt;
                &lt;SimplePredicate field="age" operator="lessOrEqual" value="5" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="30.0" reasonCode="CX1"&gt;
                &lt;Extension name="cellRef" value="$C$11" /&gt;
                &lt;CompoundPredicate booleanOperator="and"&gt;
                  &lt;SimplePredicate field="age" operator="greaterOrEqual" value="5" /&gt;
                  &lt;SimplePredicate field="age" operator="lessThan" value="12" /&gt;
                &lt;/CompoundPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="40.0" reasonCode="CX2"&gt;
                &lt;Extension name="cellRef" value="$C$12" /&gt;
                &lt;CompoundPredicate booleanOperator="and"&gt;
                  &lt;SimplePredicate field="age" operator="greaterOrEqual" value="13" /&gt;
                  &lt;SimplePredicate field="age" operator="lessThan" value="44" /&gt;
                &lt;/CompoundPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="25.0"&gt;
                &lt;Extension name="cellRef" value="$C$13" /&gt;
                &lt;SimplePredicate field="age" operator="greaterOrEqual" value="45" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
            &lt;Characteristic name="OccupationScore" baselineScore="0.0"&gt;
              &lt;Extension name="cellRef" value="$B$16" /&gt;
              &lt;Attribute partialScore="-10.0" reasonCode="CX2"&gt;
                &lt;Extension name="description" value="skydiving is a risky occupation" /&gt;
                &lt;Extension name="cellRef" value="$C$18" /&gt;
                &lt;SimpleSetPredicate field="occupation" booleanOperator="isIn"&gt;
                  &lt;Array n="2" type="string"&gt;SKYDIVER ASTRONAUT&lt;/Array&gt;
                &lt;/SimpleSetPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="10.0"&gt;
                &lt;Extension name="cellRef" value="$C$19" /&gt;
                &lt;SimpleSetPredicate field="occupation" booleanOperator="isIn"&gt;
                  &lt;Array n="2" type="string"&gt;TEACHER INSTRUCTOR&lt;/Array&gt;
                &lt;/SimpleSetPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="5.0"&gt;
                &lt;Extension name="cellRef" value="$C$20" /&gt;
                &lt;SimplePredicate field="occupation" operator="equal" value="PROGRAMMER" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
            &lt;Characteristic name="ResidenceStateScore" baselineScore="0.0" reasonCode="RES"&gt;
              &lt;Extension name="cellRef" value="$B$22" /&gt;
              &lt;Attribute partialScore="-10.0"&gt;
                &lt;Extension name="cellRef" value="$C$24" /&gt;
                &lt;SimplePredicate field="residenceState" operator="equal" value="AP" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="10.0"&gt;
                &lt;Extension name="cellRef" value="$C$25" /&gt;
                &lt;SimplePredicate field="residenceState" operator="equal" value="KN" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="5.0"&gt;
                &lt;Extension name="cellRef" value="$C$26" /&gt;
                &lt;SimplePredicate field="residenceState" operator="equal" value="TN" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
            &lt;Characteristic name="ValidLicenseScore" baselineScore="0.0"&gt;
              &lt;Extension name="cellRef" value="$B$28" /&gt;
              &lt;Attribute partialScore="1.0" reasonCode="LX00"&gt;
                &lt;Extension name="cellRef" value="$C$30" /&gt;
                &lt;SimplePredicate field="validLicense" operator="equal" value="true" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="-1.0" reasonCode="LX00"&gt;
                &lt;Extension name="cellRef" value="$C$31" /&gt;
                &lt;SimplePredicate field="validLicense" operator="equal" value="false" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
          &lt;/Characteristics&gt;
        &lt;/Scorecard&gt;
      &lt;/Segment&gt;
      &lt;Segment id="2"&gt;
        &lt;True /&gt;
        &lt;TreeModel modelName="SampleTree" functionName="classification" missingValueStrategy="lastPrediction" noTrueChildStrategy="returnLastPrediction"&gt;
          &lt;MiningSchema&gt;
            &lt;MiningField name="age" usageType="active" /&gt;
            &lt;MiningField name="validLicense" usageType="active" /&gt;
            &lt;MiningField name="calculatedScore" usageType="active" /&gt;
            &lt;MiningField name="qualificationLevel" usageType="predicted" /&gt;
          &lt;/MiningSchema&gt;
          &lt;Output&gt;
            &lt;OutputField name="qualification" displayName="Qualification Level" dataType="string" feature="predictedValue"                     targetField="qualificationLevel" /&gt;
          &lt;/Output&gt;
          &lt;Node score="Well" id="1"&gt;
            &lt;True/&gt;
            &lt;Node score="Barely" id="2"&gt;
              &lt;CompoundPredicate booleanOperator="and"&gt;
                &lt;SimplePredicate field="age" operator="greaterOrEqual" value="16" /&gt;
                &lt;SimplePredicate field="validLicense" operator="equal" value="true" /&gt;
              &lt;/CompoundPredicate&gt;
              &lt;Node score="Barely" id="3"&gt;
                &lt;SimplePredicate field="calculatedScore" operator="lessOrEqual" value="50.0" /&gt;
              &lt;/Node&gt;
              &lt;Node score="Well" id="4"&gt;
                &lt;CompoundPredicate booleanOperator="and"&gt;
                  &lt;SimplePredicate field="calculatedScore" operator="greaterThan" value="50.0" /&gt;
                  &lt;SimplePredicate field="calculatedScore" operator="lessOrEqual" value="60.0" /&gt;
                &lt;/CompoundPredicate&gt;
              &lt;/Node&gt;
              &lt;Node score="Over" id="5"&gt;
                &lt;SimplePredicate field="calculatedScore" operator="greaterThan" value="60.0" /&gt;
              &lt;/Node&gt;
            &lt;/Node&gt;
            &lt;Node score="Unqualified" id="6"&gt;
              &lt;CompoundPredicate booleanOperator="surrogate"&gt;
                &lt;SimplePredicate field="age" operator="lessThan" value="16" /&gt;
                &lt;SimplePredicate field="calculatedScore" operator="lessOrEqual" value="40.0" /&gt;
                &lt;True /&gt;
              &lt;/CompoundPredicate&gt;
            &lt;/Node&gt;
          &lt;/Node&gt;
        &lt;/TreeModel&gt;
      &lt;/Segment&gt;
    &lt;/Segmentation&gt;
  &lt;/MiningModel&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pmml-support-con_pmml-models"><a class="anchor" href="#pmml-support-con_pmml-models"></a><a class="link" href="#pmml-support-con_pmml-models">6.3. PMML support in Drools</a></h3>
<div class="paragraph">
<p>Drools includes consumer conformance support for the following PMML 4.2.1 model types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Regression.html">Regression models</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Scorecard.html">Scorecard models</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/TreeModel.html">Tree models</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/MultipleModels.html#xsdElement_MiningModel">Mining models</a> (with sub-types <code>modelChain</code>, <code>selectAll</code>, and <code>selectFirst</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a list of all PMML model types, including those not supported in Drools, see the DMG <a href="http://dmg.org/pmml/v4-2-1/GeneralStructure.html">PMML specification</a>.</p>
</div>
<div class="paragraph">
<p>Drools does not include a built-in PMML model editor, but you can use an XML or PMML-specific authoring tool to create PMML models and then integrate the PMML models in your decision services in Drools. You can import PMML files into your project in Business Central (<strong>Menu &#8594; Design &#8594; Projects &#8594; Import Asset</strong>) or package the PMML files as part of your project knowledge JAR (KJAR) file without Business Central.</p>
</div>
<div class="paragraph">
<p>When you add a PMML file to a project in Drools, multiple assets are generated. Each type of PMML model generates a different set of assets, but all PMML model types generate at least the following set of assets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A DRL file that contains all of the rules associated with your PMML model</p>
</li>
<li>
<p>At least two Java classes:</p>
<div class="ulist">
<ul>
<li>
<p>A data class that is used as the default object type for the model type</p>
</li>
<li>
<p>A <code>RuleUnit</code> class that is used to manage data sources and rule execution</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a PMML file has <code>MiningModel</code> as the root model, multiple instances of each of these files are generated.</p>
</div>
<div class="paragraph">
<p>For more information about including assets such as PMML files with your project packaging and deployment method, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
<div class="sect3">
<h4 id="pmml-naming-conventions-ref_pmml-models"><a class="anchor" href="#pmml-naming-conventions-ref_pmml-models"></a><a class="link" href="#pmml-naming-conventions-ref_pmml-models">6.3.1. PMML naming conventions in Drools</a></h4>
<div class="paragraph">
<p>The following are naming conventions for generated PMML packages, classes, and rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no package name is given in a PMML model file, then the default package name <code>org.kie.pmml.pmml_4_2</code> is prefixed to the model name for the generated rules in the format <code>"org.kie.pmml.pmml_4_2"+modelName</code>.</p>
</li>
<li>
<p>The package name for the generated <code>RuleUnit</code> Java class is the same as the package name for the generated rules.</p>
</li>
<li>
<p>The name of the generated <code>RuleUnit</code> Java class is the model name with <code>RuleUnit</code> added to it in the format <code>modelName+"RuleUnit"</code>.</p>
</li>
<li>
<p>Each PMML model has at least one data class that is generated. The package name for these classes is <code>org.kie.pmml.pmml_4_2.model</code>.</p>
</li>
<li>
<p>The names of generated data classes are determined by the model type, prefixed with the model name:</p>
<div class="ulist">
<ul>
<li>
<p>Regression models: One data class named <code>modelName+"RegressionData"</code></p>
</li>
<li>
<p>Scorecard models: One data class named <code>modelName+"ScoreCardData"</code></p>
</li>
<li>
<p>Tree models: Two data classes, the first named <code>modelName+"TreeNode"</code> and the second named <code>modelName+"TreeToken"</code></p>
</li>
<li>
<p>Mining models: One data class named <code>modelName+"MiningModelData"</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The mining model also generates all of the rules and classes that are within each of its segments.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pmml-extensions-ref_pmml-models"><a class="anchor" href="#pmml-extensions-ref_pmml-models"></a><a class="link" href="#pmml-extensions-ref_pmml-models">6.3.2. PMML extensions in Drools</a></h4>
<div class="paragraph">
<p>The PMML specification supports <code>Extension</code> elements that extend the content of a PMML model. You can use extensions at almost every level of a PMML model definition, and as the first and last child in the main element of a model for maximum flexibility. For more information about PMML extensions, see the DMG PMML <a href="http://dmg.org/pmml/v4-2-1/GeneralStructure.html#xsdElement_Extension">Extension Mechanism</a>.</p>
</div>
<div class="paragraph">
<p>To optimize PMML integration, Drools supports the following additional PMML extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>modelPackage</code>: Designates a package name for the generated rules and Java classes. Include this extension in the <code>Header</code> section of the PMML model file.</p>
</li>
<li>
<p><code>adapter</code>: Designates the type of construct (<code>bean</code> or <code>trait</code>) that is used to contain input and output data for rules. Insert this extension in the <code>MiningSchema</code> or <code>Output</code> section (or both) of the PMML model file.</p>
</li>
<li>
<p><code>externalClass</code>: Used in conjunction with the <code>adapter</code> extension in defining a <code>MiningField</code> or <code>OutputField</code>. This extension contains a class with an attribute name that matches the name of the <code>MiningField</code> or <code>OutputField</code> element.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pmml-invocation-options-con_pmml-models"><a class="anchor" href="#pmml-invocation-options-con_pmml-models"></a><a class="link" href="#pmml-invocation-options-con_pmml-models">6.4. PMML model execution</a></h3>
<div class="paragraph">
<p>You can import PMML files into your Drools project using Business Central (<strong>Menu &#8594; Design &#8594; Projects &#8594; Import Asset</strong>) or package the PMML files as part of your project knowledge JAR (KJAR) file without Business Central. After you implement your PMML files in your Drools project, you can execute the PMML-based decision service by embedding PMML calls directly in your Java application or by sending an <code>ApplyPmmlModelCommand</code> command to a configured KIE Server.</p>
</div>
<div class="paragraph">
<p>For more information about including PMML assets with your project packaging and deployment method, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also include a PMML model as part of a Decision Model and Notation (DMN) service in Business Central. When you include a PMML model within a DMN file, you can invoke that PMML model as a boxed function expression for a DMN decision node or business knowledge model node. For more information about including PMML models in a DMN service, see <a href="https://access.redhat.com/documentation/en-us/drools/7.5/html-single/designing_a_decision_service_using_dmn_models#dmn-included-models-pmml-proc_dmn-models"><em>Designing a decision service using DMN models</em></a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="pmml-invocation-embedded-proc_pmml-models"><a class="anchor" href="#pmml-invocation-embedded-proc_pmml-models"></a><a class="link" href="#pmml-invocation-embedded-proc_pmml-models">6.4.1. Embedding a PMML call directly in a Java application</a></h4>
<div class="paragraph">
<p>A KIE container is local when the knowledge assets are either embedded directly into the calling program or are physically pulled in using Maven dependencies for the KJAR. You typically embed knowledge assets directly into a project if there is a tight relationship between the version of the code and the version of the PMML definition. Any changes to the decision take effect after you have intentionally updated and redeployed the application. A benefit of this approach is that proper operation does not rely on any external dependencies to the run time, which can be a limitation of locked-down environments.</p>
</div>
<div class="paragraph">
<p>Using Maven dependencies enables further flexibility because the specific version of the decision can dynamically change (for example, by using a system property), and it can be periodically scanned for updates and automatically updated. This introduces an external dependency on the deploy time of the service, but executes the decision locally, reducing reliance on an external service being available during run time.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A KJAR containing the PMML model to execute has been created. For more information about project packaging, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your client application, add the following dependencies to the relevant classpath of your Java project:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the PMML compiler --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;kie-pmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required for the KIE public API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependencies&gt;

&lt;!-- Required if not using classpath KIE container --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;version&gt;</code> is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005).</p>
</div>
</div>
</div>
</li>
<li>
<p>Create a KIE container from <code>classpath</code> or <code>ReleaseId</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "my-kjar", "1.0.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternative option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kieContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</li>
<li>
<p>Create an instance of the <code>PMMLRequestData</code> class, which applies your PMML model to a set of data:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PMMLRequestData {
    private String correlationId; <i class="conum" data-value="1"></i><b>(1)</b>
    private String modelName; <i class="conum" data-value="2"></i><b>(2)</b>
    private String source; <i class="conum" data-value="3"></i><b>(3)</b>
    private List&lt;ParameterInfo&lt;?&gt;&gt; requestParams; <i class="conum" data-value="4"></i><b>(4)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Identifies data that is associated with a particular request or result</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the model that should be applied to the request data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Used by internally generated <code>PMMLRequestData</code> objects to identify the segment that generated the request</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The default mechanism for sending input data points</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Create an instance of the <code>PMML4Result</code> class, which holds the output information that is the result of applying the PMML-based rules to the input data:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PMML4Result {
    private String correlationId;
    private String segmentationId; <i class="conum" data-value="1"></i><b>(1)</b>
    private String segmentId; <i class="conum" data-value="2"></i><b>(2)</b>
    private int segmentIndex; <i class="conum" data-value="3"></i><b>(3)</b>
    private String resultCode; <i class="conum" data-value="4"></i><b>(4)</b>
    private Map&lt;String, Object&gt; resultVariables; <i class="conum" data-value="5"></i><b>(5)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Used when the model type is <code>MiningModel</code>. The <code>segmentationId</code> is used to differentiate between multiple segmentations.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Used in conjunction with the <code>segmentationId</code> to identify which segment generated the results.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Used to maintain the order of segments.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Used to determine whether the model was successfully applied, where <code>OK</code> indicates success.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Contains the name of a resultant variable and its associated value.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to the normal getter methods, the <code>PMML4Result</code> class also supports the following methods for directly retrieving the values for result variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public &lt;T&gt; Optional&lt;T&gt; getResultValue(String objName, String objField, Class&lt;T&gt; clazz, Object...params)

public Object getResultValue(String objName, String objField, Object...params)</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create an instance of the <code>ParameterInfo</code> class, which serves as a wrapper for basic data type objects used as part of the <code>PMMLRequestData</code> class:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ParameterInfo&lt;T&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    private String correlationId;
    private String name; <i class="conum" data-value="2"></i><b>(2)</b>
    private String capitalizedName;
    private Class&lt;T&gt; type; <i class="conum" data-value="3"></i><b>(3)</b>
    private T value; <i class="conum" data-value="4"></i><b>(4)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The parameterized class to handle many different types</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the variable that is expected as input for the model</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The class that is the actual type of the variable</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The actual value of the variable</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Execute the PMML model based on the required PMML class instances that you have created:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void executeModel(KieBase kbase,
                         Map&lt;String,Object&gt; variables,
                         String modelName,
                         String correlationId,
                         String modelPkgName) {
    RuleUnitExecutor executor = RuleUnitExecutor.create().bind(kbase);
    PMMLRequestData request = new PMMLRequestData(correlationId, modelName);
    PMML4Result resultHolder = new PMML4Result(correlationId);
    variables.entrySet().forEach( es -&gt; {
        request.addRequestParam(es.getKey(), es.getValue());
    });

    DataSource&lt;PMMLRequestData&gt; requestData = executor.newDataSource("request");
    DataSource&lt;PMML4Result&gt; resultData = executor.newDataSource("results");
    DataSource&lt;PMMLData&gt; internalData = executor.newDataSource("pmmlData");

    requestData.insert(request);
    resultData.insert(resultHolder);

    List&lt;String&gt; possiblePackageNames = calculatePossiblePackageNames(modelName,
                                                                    modelPkgName);
    Class&lt;? extends RuleUnit&gt; ruleUnitClass = getStartingRuleUnit("RuleUnitIndicator",
                                                                (InternalKnowledgeBase)kbase,
                                                                possiblePackageNames);

    if (ruleUnitClass != null) {
        executor.run(ruleUnitClass);
        if ( "OK".equals(resultHolder.getResultCode()) ) {
          // extract result variables here
        }
    }
}

protected Class&lt;? extends RuleUnit&gt; getStartingRuleUnit(String startingRule, InternalKnowledgeBase ikb, List&lt;String&gt; possiblePackages) {
    RuleUnitRegistry unitRegistry = ikb.getRuleUnitRegistry();
    Map&lt;String,InternalKnowledgePackage&gt; pkgs = ikb.getPackagesMap();
    RuleImpl ruleImpl = null;
    for (String pkgName: possiblePackages) {
      if (pkgs.containsKey(pkgName)) {
          InternalKnowledgePackage pkg = pkgs.get(pkgName);
          ruleImpl = pkg.getRule(startingRule);
          if (ruleImpl != null) {
              RuleUnitDescr descr = unitRegistry.getRuleUnitFor(ruleImpl).orElse(null);
              if (descr != null) {
                  return descr.getRuleUnitClass();
              }
          }
      }
    }
    return null;
}

protected List&lt;String&gt; calculatePossiblePackageNames(String modelId, String...knownPackageNames) {
    List&lt;String&gt; packageNames = new ArrayList&lt;&gt;();
    String javaModelId = modelId.replaceAll("\\s","");
    if (knownPackageNames != null &amp;&amp; knownPackageNames.length &gt; 0) {
        for (String knownPkgName: knownPackageNames) {
            packageNames.add(knownPkgName + "." + javaModelId);
        }
    }
    String basePkgName = PMML4UnitImpl.DEFAULT_ROOT_PACKAGE+"."+javaModelId;
    packageNames.add(basePkgName);
    return packageNames;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rules are executed by the <code>RuleUnitExecutor</code> class. The <code>RuleUnitExecutor</code> class creates KIE sessions and adds the required <code>DataSource</code> objects to those sessions, and then executes the rules based on the <code>RuleUnit</code> that is passed as a parameter to the <code>run()</code> method. The <code>calculatePossiblePackageNames</code> and the <code>getStartingRuleUnit</code> methods determine the fully qualified name of the <code>RuleUnit</code> class that is passed to the <code>run()</code> method.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To facilitate your PMML model execution, you can also use a <code>PMML4ExecutionHelper</code> class supported in Drools. For more information about the PMML helper class, see <a href="#pmml-invocation-helper-classes-ref_pmml-models">PMML execution helper class</a>.</p>
</div>
<div class="sect4">
<h5 id="pmml-invocation-helper-classes-ref_pmml-models"><a class="anchor" href="#pmml-invocation-helper-classes-ref_pmml-models"></a><a class="link" href="#pmml-invocation-helper-classes-ref_pmml-models">6.4.1.1. PMML execution helper class</a></h5>
<div class="paragraph">
<p>Drools provides a <code>PMML4ExecutionHelper</code> class that helps create the <code>PMMLRequestData</code> class required for PMML model execution and that helps execute rules using the <code>RuleUnitExecutor</code> class.</p>
</div>
<div class="paragraph">
<p>The following are examples of a PMML model execution without and with the <code>PMML4ExecutionHelper</code> class, as a comparison:</p>
</div>
<div class="listingblock">
<div class="title">Example PMML model execution without using <code>PMML4ExecutionHelper</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void executeModel(KieBase kbase,
                         Map&lt;String,Object&gt; variables,
                         String modelName,
                         String correlationId,
                         String modelPkgName) {
    RuleUnitExecutor executor = RuleUnitExecutor.create().bind(kbase);
    PMMLRequestData request = new PMMLRequestData(correlationId, modelName);
    PMML4Result resultHolder = new PMML4Result(correlationId);
    variables.entrySet().forEach( es -&gt; {
        request.addRequestParam(es.getKey(), es.getValue());
    });

    DataSource&lt;PMMLRequestData&gt; requestData = executor.newDataSource("request");
    DataSource&lt;PMML4Result&gt; resultData = executor.newDataSource("results");
    DataSource&lt;PMMLData&gt; internalData = executor.newDataSource("pmmlData");

    requestData.insert(request);
    resultData.insert(resultHolder);

    List&lt;String&gt; possiblePackageNames = calculatePossiblePackageNames(modelName,
                                                                    modelPkgName);
    Class&lt;? extends RuleUnit&gt; ruleUnitClass = getStartingRuleUnit("RuleUnitIndicator",
                                                                (InternalKnowledgeBase)kbase,
                                                                possiblePackageNames);

    if (ruleUnitClass != null) {
        executor.run(ruleUnitClass);
        if ( "OK".equals(resultHolder.getResultCode()) ) {
          // extract result variables here
        }
    }
}

protected Class&lt;? extends RuleUnit&gt; getStartingRuleUnit(String startingRule, InternalKnowledgeBase ikb, List&lt;String&gt; possiblePackages) {
    RuleUnitRegistry unitRegistry = ikb.getRuleUnitRegistry();
    Map&lt;String,InternalKnowledgePackage&gt; pkgs = ikb.getPackagesMap();
    RuleImpl ruleImpl = null;
    for (String pkgName: possiblePackages) {
      if (pkgs.containsKey(pkgName)) {
          InternalKnowledgePackage pkg = pkgs.get(pkgName);
          ruleImpl = pkg.getRule(startingRule);
          if (ruleImpl != null) {
              RuleUnitDescr descr = unitRegistry.getRuleUnitFor(ruleImpl).orElse(null);
              if (descr != null) {
                  return descr.getRuleUnitClass();
              }
          }
      }
    }
    return null;
}

protected List&lt;String&gt; calculatePossiblePackageNames(String modelId, String...knownPackageNames) {
    List&lt;String&gt; packageNames = new ArrayList&lt;&gt;();
    String javaModelId = modelId.replaceAll("\\s","");
    if (knownPackageNames != null &amp;&amp; knownPackageNames.length &gt; 0) {
        for (String knownPkgName: knownPackageNames) {
            packageNames.add(knownPkgName + "." + javaModelId);
        }
    }
    String basePkgName = PMML4UnitImpl.DEFAULT_ROOT_PACKAGE+"."+javaModelId;
    packageNames.add(basePkgName);
    return packageNames;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example PMML model execution using <code>PMML4ExecutionHelper</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void executeModel(KieBase kbase,
                         Map&lt;String,Object&gt; variables,
                         String modelName,
                         String modelPkgName,
                         String correlationId) {
   PMML4ExecutionHelper helper = PMML4ExecutionHelperFactory.getExecutionHelper(modelName, kbase);
   helper.addPossiblePackageName(modelPkgName);

   PMMLRequestData request = new PMMLRequestData(correlationId, modelName);
   variables.entrySet().forEach(entry -&gt; {
     request.addRequestParam(entry.getKey(), entry.getValue);
   });

   PMML4Result resultHolder = helper.submitRequest(request);
   if ("OK".equals(resultHolder.getResultCode)) {
     // extract result variables here
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you use the <code>PMML4ExecutionHelper</code>, you do not need to specify the possible package names nor the <code>RuleUnit</code> class as you would in a typical PMML model execution.</p>
</div>
<div class="paragraph">
<p>To construct a <code>PMML4ExecutionHelper</code> class, you use the <code>PMML4ExecutionHelperFactory</code> class to determine how instances of <code>PMML4ExecutionHelper</code> are retrieved.</p>
</div>
<div class="paragraph">
<p>The following are the available <code>PMML4ExecutionHelperFactory</code> class methods for constructing a <code>PMML4ExecutionHelper</code> class:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PMML4ExecutionHelperFactory methods for PMML assets in a KIE base</dt>
<dd>
<p>Use these methods when PMML assets have already been compiled and are being used from an existing KIE base:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName, KieBase kbase)

public static PMML4ExecutionHelper getExecutionHelper(String modelName, KieBase kbase, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">PMML4ExecutionHelperFactory methods for PMML assets on the project classpath</dt>
<dd>
<p>Use these methods when PMML assets are on the project classpath. The <code>classPath</code> argument is the project classpath location of the PMML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName,  String classPath, KieBaseConfiguration kieBaseConf)

public static PMML4ExecutionHelper getExecutionHelper(String modelName,String classPath, KieBaseConfiguration kieBaseConf, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">PMML4ExecutionHelperFactory methods for PMML assets in a byte array</dt>
<dd>
<p>Use these methods when PMML assets are in the form of a byte array:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName, byte[] content, KieBaseConfiguration kieBaseConf)

public static PMML4ExecutionHelper getExecutionHelper(String modelName, byte[] content, KieBaseConfiguration kieBaseConf, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">PMML4ExecutionHelperFactory methods for PMML assets in a <code>Resource</code></dt>
<dd>
<p>Use these methods when PMML assets are in the form of an <code>org.kie.api.io.Resource</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName, Resource resource, KieBaseConfiguration kieBaseConf)

public static PMML4ExecutionHelper getExecutionHelper(String modelName, Resource resource, KieBaseConfiguration kieBaseConf, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The classpath, byte array, and resource <code>PMML4ExecutionHelperFactory</code> methods create a KIE container for the generated rules and Java classes. The container is used as the source of the KIE base that the <code>RuleUnitExecutor</code> uses. The container is not persisted. The <code>PMML4ExecutionHelperFactory</code> method for PMML assets that are already in a KIE base does not create a KIE container in this way.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pmml-invocation-kie-server-proc_pmml-models"><a class="anchor" href="#pmml-invocation-kie-server-proc_pmml-models"></a><a class="link" href="#pmml-invocation-kie-server-proc_pmml-models">6.4.2. Executing a PMML model using KIE Server</a></h4>
<div class="paragraph">
<p>You can execute PMML models that have been deployed to KIE Server by sending the <code>ApplyPmmlModelCommand</code> command to the configured KIE Server. When you use this command, a <code>PMMLRequestData</code> object is sent to the KIE Server and a <code>PMML4Result</code> result object is received as a reply. You can send PMML requests to KIE Server through the KIE Server REST API from a configured Java class or directly from a REST client.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and configured, including a known user name and credentials for a user with the <code>kie-server</code> role. For installation options, see
<a href="#_installationandsetup">Installation and Setup (Core and IDE)</a>.</p>
</li>
<li>
<p>A KIE container is deployed in KIE Server in the form of a KJAR that includes the PMML model. For more information about project packaging, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</li>
<li>
<p>You have the container ID of the KIE container containing the PMML model.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your client application, add the following dependencies to the relevant classpath of your Java project:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the PMML compiler --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;kie-pmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required for the KIE public API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependencies&gt;

&lt;!-- Required for the KIE Server Java client API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required if not using classpath KIE container --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;version&gt;</code> is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005).</p>
</div>
</div>
</div>
</li>
<li>
<p>Create a KIE container from <code>classpath</code> or <code>ReleaseId</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "my-kjar", "1.0.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternative option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kieContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</li>
<li>
<p>Create a class for sending requests to KIE Server and receiving responses:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ApplyScorecardModel {
  private static final ReleaseId releaseId =
          new ReleaseId("org.acme","my-kjar","1.0.0");
  private static final String containerId = "SampleModelContainer";
  private static KieCommands commandFactory;
  private static ClassLoader kjarClassLoader; <i class="conum" data-value="1"></i><b>(1)</b>
  private RuleServicesClient serviceClient; <i class="conum" data-value="2"></i><b>(2)</b>

  // Attributes specific to your class instance
  private String rankedFirstCode;
  private Double score;

  // Initialization of non-final static attributes
  static {
    commandFactory = KieServices.Factory.get().getCommands();

    // Specifications for kjarClassLoader, if used
    KieMavenRepository kmp = KieMavenRepository.getMavenRepository();
    File artifactFile = kmp.resolveArtifact(releaseId).getFile();
    if (artifactFile != null) {
      URL urls[] = new URL[1];
      try {
        urls[0] = artifactFile.toURI().toURL();
        classLoader = new KieURLClassLoader(urls,PMML4Result.class.getClassLoader());
      } catch (MalformedURLException e) {
        logger.error("Error getting classLoader for "+containerId);
        logger.error(e.getMessage());
      }
    } else {
      logger.warn("Did not find the artifact file for "+releaseId.toString());
    }
  }

  public ApplyScorecardModel(KieServicesConfiguration kieConfig) {
    KieServicesClient clientFactory = KieServicesFactory.newKieServicesClient(kieConfig);
    serviceClient = clientFactory.getServicesClient(RuleServicesClient.class);
  }
  ...
  // Getters and setters
  ...

  // Method for executing the PMML model on KIE Server
  public void applyModel(String occupation, int age) {
    PMMLRequestData input = new PMMLRequestData("1234","SampleModelName"); <i class="conum" data-value="3"></i><b>(3)</b>
    input.addRequestParam(new ParameterInfo("1234","occupation",String.class,occupation));
    input.addRequestParam(new ParameterInfo("1234","age",Integer.class,age));

    CommandFactoryServiceImpl cf = (CommandFactoryServiceImpl)commandFactory;
    ApplyPmmlModelCommand command = (ApplyPmmlModelCommand) cf.newApplyPmmlModel(request); <i class="conum" data-value="4"></i><b>(4)</b>

    ServiceResponse&lt;ExecutionResults&gt; results =
        ruleClient.executeCommandsWithResults(CONTAINER_ID, command); <i class="conum" data-value="5"></i><b>(5)</b>

    if (results != null) {  <i class="conum" data-value="6"></i><b>(6)</b>
      PMML4Result resultHolder = (PMML4Result)results.getResult().getValue("results");
      if (resultHolder != null &amp;&amp; "OK".equals(resultHolder.getResultCode())) {
        this.score = resultHolder.getResultValue("ScoreCard","score",Double.class).get();
        Map&lt;String,Object&gt; rankingMap =
             (Map&lt;String,Object&gt;)resultHolder.getResultValue("ScoreCard","ranking");
        if (rankingMap != null &amp;&amp; !rankingMap.isEmpty()) {
          this.rankedFirstCode = rankingMap.keySet().iterator().next();
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the class loader if you did not include the KJAR in your client project dependencies</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Identifies the service client as defined in the configuration settings, including KIE Server REST API access credentials</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Initializes a <code>PMMLRequestData</code> object</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creates an instance of the <code>ApplyPmmlModelCommand</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Sends the command using the service client</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Retrieves the results of the executed PMML model</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Execute the class instance to send the PMML invocation request to KIE Server.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Alternatively, you can use JMS and REST interfaces to send the <code>ApplyPmmlModelCommand</code> command to KIE Server. For REST requests, you use the <code>ApplyPmmlModelCommand</code> command as a <code>POST</code> request to <code>http://SERVER:PORT/kie-server/services/rest/server/containers/instances/{containerId}</code> in JSON, JAXB, or XStream request format.</p>
</div>
<div class="listingblock">
<div class="title">Example POST endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code>http://localhost:8080/kie-server/services/rest/server/containers/instances/SampleModelContainer</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "apply-pmml-model-command": {
        "outIdentifier": null,
        "packageName": null,
        "hasMining": false,
        "requestData": {
          "correlationId": "123",
          "modelName": "SimpleScorecard",
          "source": null,
          "requestParams": [
            {
              "correlationId": "123",
              "name": "param1",
              "type": "java.lang.Double",
              "value": "10.0"
            },
            {
              "correlationId": "123",
              "name": "param2",
              "type": "java.lang.Double",
              "value": "15.0"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example curl request with endpoint and body</div>
<div class="content">
<pre class="highlightjs highlight"><code>curl -X POST "http://localhost:8080/kie-server/services/rest/server/containers/instances/SampleModelContainer" -H "accept: application/json" -H "content-type: application/json" -d "{ \"commands\": [ { \"apply-pmml-model-command\": { \"outIdentifier\": null, \"packageName\": null, \"hasMining\": false, \"requestData\": { \"correlationId\": \"123\", \"modelName\": \"SimpleScorecard\", \"source\": null, \"requestParams\": [ { \"correlationId\": \"123\", \"name\": \"param1\", \"type\": \"java.lang.Double\", \"value\": \"10.0\" }, { \"correlationId\": \"123\", \"name\": \"param2\", \"type\": \"java.lang.Double\", \"value\": \"15.0\" } ] } } } ]}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example JSON response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "results" : [ {
    "value" : {"org.kie.api.pmml.DoubleFieldOutput":{
  "value" : 40.8,
  "correlationId" : "123",
  "segmentationId" : null,
  "segmentId" : null,
  "name" : "OverallScore",
  "displayValue" : "OverallScore",
  "weight" : 1.0
}},
    "key" : "OverallScore"
  }, {
    "value" : {"org.kie.api.pmml.PMML4Result":{
  "resultVariables" : {
    "OverallScore" : {
      "value" : 40.8,
      "correlationId" : "123",
      "segmentationId" : null,
      "segmentId" : null,
      "name" : "OverallScore",
      "displayValue" : "OverallScore",
      "weight" : 1.0
    },
    "ScoreCard" : {
      "modelName" : "SimpleScorecard",
      "score" : 40.8,
      "holder" : {
        "modelName" : "SimpleScorecard",
        "correlationId" : "123",
        "voverallScore" : null,
        "moverallScore" : true,
        "vparam1" : 10.0,
        "mparam1" : false,
        "vparam2" : 15.0,
        "mparam2" : false
      },
      "enableRC" : true,
      "pointsBelow" : true,
      "ranking" : {
        "reasonCh1" : 5.0,
        "reasonCh2" : -6.0
      }
    }
  },
  "correlationId" : "123",
  "segmentationId" : null,
  "segmentId" : null,
  "segmentIndex" : 0,
  "resultCode" : "OK",
  "resultObjectName" : null
}},
    "key" : "results"
  } ],
  "facts" : [ ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_experimentalfeatureschapter"><a class="anchor" href="#_experimentalfeatureschapter"></a><a class="link" href="#_experimentalfeatureschapter">7. Experimental Features</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_declarative_agenda"><a class="anchor" href="#_declarative_agenda"></a><a class="link" href="#_declarative_agenda">7.1. Declarative Agenda</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Declarative Agenda is experimental, and all aspects are highly likely to change in the future.
@Eager and @Direct are temporary annotations to control the behaviour of rules, which will also change as Declarative Agenda evolves.
Annotations instead of attributes where chosen, to reflect their experimental nature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The declarative agenda allows to use rules to control which other rules can fire and when.
While this will add a lot more overhead than the simple use of salience, the advantage is it is declarative and thus more readable and maintainable and should allow more use cases to be achieved in a simpler fashion.</p>
</div>
<div class="paragraph">
<p>This feature is off by default and must be explicitly enabled, that is because it is considered highly experimental for the moment and will be subject to change, but can be activated on a given KieBase by adding the declarativeAgenda='enabled' attribute in the corresponding kbase tag of the kmodule.xml file as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 68. Enabling the Declarative Agenda</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.drools.org/xsd/kmodule"&gt;
      &lt;kbase name="DeclarativeKBase" declarativeAgenda="enabled"&gt;
      &lt;ksession name="KSession"&gt;
      &lt;/kbase&gt;
      &lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The basic idea is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All rule&#8217;s Matches are inserted into WorkingMemory as facts. So you can now do pattern matching against a Match. The rule&#8217;s metadata and declarations are available as fields on the Match object.</p>
</li>
<li>
<p>You can use the kcontext.blockMatch( Match match ) for the current rule to block the selected match. Only when that rule becomes false will the match be eligible for firing. If it is already eligible for firing and is later blocked, it will be removed from the agenda until it is unblocked.</p>
</li>
<li>
<p>A match may have multiple blockers and a count is kept. All blockers must became false for the counter to reach zero to enable the Match to be eligible for firing.</p>
</li>
<li>
<p>kcontext.unblockAllMatches( Match match ) is an over-ride rule that will remove all blockers regardless</p>
</li>
<li>
<p>An activation may also be cancelled, so it never fires with cancelMatch</p>
</li>
<li>
<p>An unblocked Match is added to the Agenda and obeys normal salience, agenda groups, ruleflow groups etc.</p>
</li>
<li>
<p>The @Direct annotations allows a rule to fire as soon as it&#8217;s matched, this is to be used for rules that block/unblock matches, it is not desirable for these rules to have side effects that impact else where.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 69. New RuleContext methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>void blockMatch(Match match);
      void unblockAllMatches(Match match);
      void cancelMatch(Match match);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here is a basic example that will block all matches from rules that have metadata @department('sales'). They will stay blocked until the blockerAllSalesRules rule becomes false, i.e.
"go2" is retracted.</p>
</div>
<div class="exampleblock">
<div class="title">Example 70. Block rules based on rule metadata</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule rule1 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule2 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule blockerAllSalesRules @Direct @Eager when
      $s : String( this == 'go2' )
      $i : Match( department == 'sales' )
      then
      list.add( $i.rule.name + ':' + $s  );
      kcontext.blockMatch( $i );
      end</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Further than annotate the blocking rule with @Direct, it is also necessary to annotate all the rules that could be potentially blocked by it with @Eager.
This is because, since the Match has to be evaluated by the pattern matching of the blocking rule, the potentially blocked ones cannot be evaluated lazily, otherwise won&#8217;t be any Match to be evaluated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example shows how you can use active property to count the number of active or inactive (already fired) matches.</p>
</div>
<div class="exampleblock">
<div class="title">Example 71. Count the number of active/inactive Matches</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule rule1 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule2 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule3 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule countActivateInActive @Direct @Eager when
      $s : String( this == 'go2' )
      $active : Number( this == 1 ) from accumulate( $a : Match( department == 'sales', active == true ), count( $a ) )
      $inActive : Number( this == 2 ) from  accumulate( $a : Match( department == 'sales', active == false ), count( $a ) )
      then
      kcontext.halt( );
      end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_traits"><a class="anchor" href="#_traits"></a><a class="link" href="#_traits">7.2. Traits</a></h3>
<div class="paragraph">
<p>WARNING : this feature is still experimental and subject to changes</p>
</div>
<div class="paragraph">
<p>The same fact may have multiple dynamic types which do not fit naturally in a class hierarchy.
Traits allow to model this very common scenario.
A trait is an interface that can be applied (and eventually removed) to an individual object at runtime.
To create a trait rather than a traditional bean, one has to declare them explicitly as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare trait GoldenCustomer
    // fields will map to getters/setters
    code     : String
    balance  : long
    discount : int
    maxExpense : long
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>At runtime, this declaration results in an interface, which can be used to write patterns, but can not be instantiated directly.
In order to apply a trait to an object, we provide the new don keyword, which can be used as simply as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $c : Customer()
then
    GoldenCustomer gc = don( $c, GoldenCustomer.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>when a core object dons a trait, a proxy class is created on the fly (one such class will be generated lazily for each core/trait class combination). The proxy instance, which wraps the core object and implements the trait interface, is inserted automatically and will possibly activate other rules.
An immediate advantage of declaring and using interfaces, getting the implementation proxy for free from the Drools engine, is that multiple inheritance hierarchies can be exploited when writing rules.
The core classes, however, need not implement any of those interfaces statically, also facilitating the use of legacy classes as cores.
In fact, any object can don a trait, provided that they are declared as @Traitable.
Notice that this annotation used to be optional, but now is mandatory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.core.factmodel.traits.Traitable;
declare Customer
    @Traitable
    code    : String
    balance : long
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only connection between core classes and trait interfaces is at the proxy level: a trait is not specifically tied to a core class.
This means that the same trait can be applied to totally different objects.
For this reason, the trait does not transparently expose the fields of its core object.
So, when writing a rule using a trait interface, only the fields of the interface will be available, as usual.
However, any field in the interface that corresponds to a core object field, will be mapped by the proxy class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $o: OrderItem( $p : price, $code : custCode )
    $c: GoldenCustomer( code == $code, $a : balance, $d: discount )
then
    $c.setBalance( $a - $p*$d );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the code and balance would be read from the underlying Customer object.
Likewise, the setAccount will modify the underlying object, preserving a strongly typed access to the data structures.
A hard field must have the same name and type both in the core class and all donned interfaces.
The name is used to establish the mapping: if two fields have the same name, then they must also have the same declared type.
The annotation @org.drools.core.factmodel.traits.Alias allows to relax this restriction.
If an @Alias is provided, its value string will be used to resolve mappings instead of the original field name.
@Alias can be applied both to traits and core beans.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.core.factmodel.traits.*;
declare trait GoldenCustomer
    balance : long @Alias( "org.acme.foo.accountBalance" )
end

declare Person
    @Traitable
    name : String
    savings : long @Alias( "org.acme.foo.accountBalance" )
end

when
    GoldenCustomer( balance &amp;gt; 1000 ) // will react to new Person( 2000 )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>More work is being done on relaxing this constraint (see the experimental section on "logical" traits later). Now, one might wonder what happens when a core class does NOT provide the implementation for a field defined in an interface.
We call hard fields those trait fields which are also core fields and thus readily available, while we define soft those fields which are NOT provided by the core class.
Hidden fields, instead, are fields in the core class not exposed by the interface.</p>
</div>
<div class="paragraph">
<p>So, while hard field management is intuitive, there remains the problem of soft and hidden fields.
Hidden fields are normally only accessible using the core class directly.
However, the "fields" Map can be used on a trait interface to access a hidden field.
If the field can&#8217;t be resolved, null will be returned.
Notice that this feature is likely to change in the future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $sc : GoldenCustomer( fields[ "age" ] &gt; 18 )  // age is declared by the underlying core class, but not by GoldenCustomer
then</code></pre>
</div>
</div>
<div class="paragraph">
<p>Soft fields, instead, are stored in a Map-like data structure that is specific to each core object and referenced by the proxy(es), so that they are effectively shared even when an object dons multiple traits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $sc : GoldenCustomer( $c : code, // hard getter
                          $maxExpense : maxExpense &gt; 1000 // soft getter
    )
then
    $sc.setDiscount( ... ); // soft setter
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>A core object also holds a reference to all its proxies, so that it is possible to track which type(s) have been added to an object, using a sort of dynamic "instanceof" operator, which we called isA.
The operator can accept a String, a class literal or a list of class literals.
In the latter case, the constraint is satisfied only if all the traits have been donned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$sc : GoldenCustomer( $maxExpense : maxExpense &gt; 1000,
                      this isA "SeniorCustomer", this isA [ NationalCustomer.class, OnlineCustomer.class ]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, the business logic may require that a trait is removed from a wrapped object.
To this end, we provide two options.
The first is a "logical don", which will result in a logical insertion of the proxy resulting from the traiting operation.
The TMS will ensure that the trait is removed when its logical support is removed in the first place.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>then
    don( $x, // core object
         Customer.class, // trait class
         true // optional flag for logical insertion
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second is the use of the "shed" keyword, which causes the removal of any type that is a subtype (or equivalent) of the one passed as an argument.
Notice that, as of version 5.5, shed would only allow to remove a single specific trait.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>then
    Thing t = shed( $x, GoldenCustomer.class ) // also removes any trait that</code></pre>
</div>
</div>
<div class="paragraph">
<p>This operation returns another proxy implementing the org.drools.core.factmodel.traits.Thing interface, where the getFields() and getCore() methods are defined.
Internally, in fact, all declared traits are generated to extend this interface (in addition to any others specified).      This allows to preserve the wrapper with the soft fields which would otherwise be lost.</p>
</div>
<div class="paragraph">
<p>A trait and its proxies are also correlated in another way.
Starting from version 5.6, whenever a core object is "modified", its proxies are "modified" automatically as well, to allow trait-based patterns to react to potential changes in hard fields.
Likewise, whenever a trait proxy (matched by a trait pattern) is modified, the modification is propagated to the core class and the other traits.
Moreover, whenever a don operation is performed, the core object is also modified automatically, to reevaluate any "isA" operation which may be triggered.</p>
</div>
<div class="paragraph">
<p>Potentially, this may result in a high number of modifications, impacting performance (and correctness) heavily.
So two solutions are currently implemented.
First, whenever a core object is modified, only the most specific traits (in the sense of inheritance between trait interfaces) are updated and an internal blocking mechanism is in place to ensure that each potentially matching pattern is evaluated once and only once.
So, in the following situation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare trait GoldenCustomer end
declare trait NationalGoldenCustomer extends GoldenCustomer end
declare trait SeniorGoldenCustomer extends GoldenCustomer end</code></pre>
</div>
</div>
<div class="paragraph">
<p>a modification of an object that is both a GoldenCustomer, a NationalGoldenCustomer and a SeniorGoldenCustomer wold cause only the latter two proxies to be actually modified.
The first would match any pattern for GoldenCustomer and NationalGoldenCustomer; the latter would instead be prevented from rematching GoldenCustomer, but would be allowed to match SeniorGoldenCustomer patterns.
It is not necessary, instead, to modify the GoldenCustomer proxy since it is already covered by at least one other more specific trait.</p>
</div>
<div class="paragraph">
<p>The second method, up to the user, is to mark traits as @PropertyReactive.
Property reactivity is trait-enabled and takes into account the trait field mappings, so to block unnecessary propagations.</p>
</div>
<div class="sect3">
<h4 id="_cascading_traits"><a class="anchor" href="#_cascading_traits"></a><a class="link" href="#_cascading_traits">7.2.1. Cascading traits</a></h4>
<div class="paragraph">
<p><strong>WARNING</strong> : This feature is extremely experimental and subject to changes</p>
</div>
<div class="paragraph">
<p>Normally, a hard field must be exposed with its original type by all traits donned by an object, to prevent situations such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @Traitable
  name : String
  id : String
end

declare trait Customer
  id : String
end

declare trait Patient
  id : long  // Person can't don Patient, or an exception will be thrown
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should a Person don both Customer and Patient, the type of the hard field id would be ambiguous.
However, consider the following example, where GoldenCustomers refer their best friends so that they become Customers as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @Traitable( logical=true )
  bestFriend : Person
end

declare trait Customer end

declare trait GoldenCustomer extends Customer
  refers : Customer @Alias( "bestFriend" )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aside from the @Alias, a Person-as-GoldenCustomer&#8217;s best friend might be compatible with the requirements of the trait GoldenCustomer, provided that they are some kind of Customer themselves.
Marking a Person as "logically traitable" - i.e.
adding the annotation @Traitable( logical = true ) - will instruct the Drools engine to try and preserve the logical consistency rather than throwing an exception due to a hard field with different type declarations (Person vs Customer). The following operations would then work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person p1 = new Person();
Person p2 = new Person();
p1.setBestFriend( p2 );
...
Customer c2 = don( p2, Customer.class );
...
GoldenCustomer gc1 = don( p1, GoldenCustomer.class );
...
p1.getBestFriend(); // returns p2
gc1.getRefers(); // returns c2, a Customer proxy wrapping p2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that, by the time p1 becomes GoldenCustomer, p2 must have already become a Customer themselves, otherwise a runtime exception will be thrown since the very definition of GoldenCustomer would have been violated.</p>
</div>
<div class="paragraph">
<p>In some cases, however, one might want to infer, rather than verify, that p2 is a Customer by virtue that p1 is a GoldenCustomer.
This modality can be enabled by marking Customer as "logical", using the annotation @org.drools.core.factmodel.traits.Trait( logical = true ). In this case, should p2 not be a Customer by the time that p1 becomes a GoldenCustomer, it will be automatically don the trait Customer to preserve the logical integrity of the system.</p>
</div>
<div class="paragraph">
<p>Notice that the annotation on the core class enables the dynamic type management for its fields, whereas the annotation on the traits determines whether they will be enforced as integrity constraints or cascaded dynamically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.factmodel.traits.*;

declare trait Customer
    @Trait( logical = true )
end</code></pre>
</div>
</div>
<h1 id="_drools_integration" class="discrete">Drools Integration</h1>
<div class="paragraph">
<p>Integration Documentation</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.commands"><a class="anchor" href="#_ch.commands"></a><a class="link" href="#_ch.commands">8. Drools commands</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="runtime-commands-con_kie-apis"><a class="anchor" href="#runtime-commands-con_kie-apis"></a><a class="link" href="#runtime-commands-con_kie-apis">8.1. Runtime commands in Drools</a></h3>
<div class="paragraph">
<p>Drools supports runtime commands that you can send to KIE Server for asset-related operations, such as executing all rules or inserting or retracting objects in a KIE session. The full list of supported runtime commands is located in the <code>org.drools.core.command.runtime</code> package in your Drools instance.</p>
</div>
<div class="paragraph">
<p>In the KIE Server REST API, you use the global <code>org.drools.core.command.runtime</code> commands or the rule-specific <code>org.drools.core.command.runtime.rule</code> commands as the request body for <code>POST</code> requests to <code>http://SERVER:PORT/kie-server/services/rest/server/containers/instances/{containerId}</code>. For more information about using the KIE Server REST API, see <a href="#kie-server-rest-api-con_kie-apis">KIE Server REST API for KIE containers and business assets</a>.</p>
</div>
<div class="paragraph">
<p>In the KIE Server Java client API, you can embed these commands in your Java application along with the relevant Java client. For example, for rule-related commands, you use the <code>RuleServicesClient</code> Java client with the embedded commands. For more information about using the KIE Server Java client API, see <a href="#kie-server-java-api-con_kie-apis">KIE Server Java client API for KIE containers and business assets</a>.</p>
</div>
<div class="sect3">
<h4 id="runtime-commands-samples-ref_kie-apis"><a class="anchor" href="#runtime-commands-samples-ref_kie-apis"></a><a class="link" href="#runtime-commands-samples-ref_kie-apis">8.1.1. Sample runtime commands in Drools</a></h4>
<div class="paragraph">
<p>The following are sample runtime commands that you can use with the KIE Server REST API or Java client API for asset-related operations in KIE Server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BatchExecutionCommand</code></p>
</li>
<li>
<p><code>InsertObjectCommand</code></p>
</li>
<li>
<p><code>RetractCommand</code></p>
</li>
<li>
<p><code>ModifyCommand</code></p>
</li>
<li>
<p><code>GetObjectCommand</code></p>
</li>
<li>
<p><code>GetObjectsCommand</code></p>
</li>
<li>
<p><code>InsertElementsCommand</code></p>
</li>
<li>
<p><code>FireAllRulesCommand</code></p>
</li>
<li>
<p><code>QueryCommand</code></p>
</li>
<li>
<p><code>SetGlobalCommand</code></p>
</li>
<li>
<p><code>GetGlobalCommand</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the full list of supported runtime commands, see the <code>org.drools.core.command.runtime</code> package in your Drools instance.</p>
</div>
<div class="paragraph">
<p>Each command in this section includes a REST request body example (JSON) for the KIE Server REST API and an embedded Java command example for the KIE Server Java client API. The Java examples use an object <code>org.drools.compiler.test.Person</code> with the fields <code>name</code> (String) and <code>age</code> (Integer).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">BatchExecutionCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Contains multiple commands to be executed together.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>commands</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">List of commands to be executed.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>lookup</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Sets the KIE session ID on which the commands will be executed. For stateless KIE sessions, this attribute is required. For stateful KIE sessions, this attribute is optional and if not specified, the default KIE session is used.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required for stateless KIE session, optional for stateful KIE session</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
KIE session IDs are in the <code>kmodule.xml</code> file of your Drools project. To view or add a KIE session ID in Business Central to use with the <code>lookup</code> command attribute, navigate to the relevant project in Business Central and go to project <strong>Settings</strong> &#8594; <strong>KIE bases</strong> &#8594; <strong>KIE sessions</strong>. If no KIE bases exist, click <strong>Add KIE base</strong> &#8594; <strong>KIE sessions</strong> to define the new KIE base and KIE sessions.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "lookup": "ksession1",
  "commands": [ {
      "insert": {
        "object": {
          "org.drools.compiler.test.Person": {
            "name": "john",
            "age": 25
          }
        }
      }
    },
    {
      "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");

InsertObjectCommand insertObjectCommand = new InsertObjectCommand(new Person("john", 25));
FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();

command.getCommands().add(insertObjectCommand);
command.getCommands().add(fireAllRulesCommand);

ksession.execute(command);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Inserts an object into the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The object to be inserted</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID of the <code>FactHandle</code> created from the object insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Boolean to determine whether the object must be returned in the execution results (default: <code>true</code>)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Entry point for the insertion</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "insert": {
        "entry-point": "my stream",
        "object": {
          "org.drools.compiler.test.Person": {
            "age": 25,
            "name": "john"
          }
        },
        "out-identifier": "john",
        "return-object": false
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Command insertObjectCommand =
  CommandFactory.newInsert(new Person("john", 25), "john", false, null);

ksession.execute(insertObjectCommand);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">RetractCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retracts an object from the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The <code>FactHandle</code> associated with the object to be retracted</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "retract": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command: Use <code>FactHandleFromString</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand();
retractCommand.setFactHandleFromString("123:234:345:456:567");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command: Use <code>FactHandle</code> from inserted object</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand(factHandle);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">ModifyCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Modifies a previously inserted object in the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The <code>FactHandle</code> associated with the object to be modified</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>setters</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">List of setters for object modifications</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "modify": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "setters": {
          "accessor": "age",
          "value": 25
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ModifyCommand modifyCommand = new ModifyCommand(factHandle);

List&lt;Setter&gt; setters = new ArrayList&lt;Setter&gt;();
setters.add(new SetterImpl("age", "25"));

modifyCommand.setSetters(setters);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retrieves an object from a KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The <code>FactHandle</code> associated with the object to be retrieved</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID of the <code>FactHandle</code> created from the object insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-object": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "out-identifier": "john"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectCommand getObjectCommand = new GetObjectCommand();
getObjectCommand.setFactHandleFromString("123:234:345:456:567");
getObjectCommand.setOutIdentifier("john");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "john"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retrieves all objects from the KIE session as a collection.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>object-filter</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Filter for the objects returned from the KIE session</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Identifier to be used in the execution results</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-objects": {
        "out-identifier": "objects"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectsCommand getObjectsCommand = new GetObjectsCommand();
getObjectsCommand.setOutIdentifier("objects");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": [
                {
                  "org.apache.xerces.dom.ElementNSImpl": "&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;\n&lt;object xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"person\"&gt;&lt;age&gt;25&lt;/age&gt;&lt;name&gt;john&lt;/name&gt;\n &lt;\/object&gt;"
                },
                {
                  "org.drools.compiler.test.Person": {
                    "name": "john",
                    "age": 25
                  }
                }
              ],
              "key": "objects"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertElementsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Inserts a list of objects into the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>objects</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The list of objects to be inserted into the KIE session</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID of the <code>FactHandle</code> created from the object insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Boolean to determine whether the object must be returned in the execution results. Default value: <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Entry point for the insertion</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
    "insert-elements": {
        "objects": [
            {
                "containedObject": {
                    "@class": "org.drools.compiler.test.Person",
                    "age": 25,
                    "name": "john"
                }
            },
            {
                "containedObject": {
                    "@class": "Person",
                    "age": 35,
                    "name": "sarah"
                }
            }
        ]
    }
  }
]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Object&gt; objects = new ArrayList&lt;Object&gt;();
objects.add(new Person("john", 25));
objects.add(new Person("sarah", 35));

Command insertElementsCommand = CommandFactory.newInsertElements(objects);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            },
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720266:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "sarah"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">FireAllRulesCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Executes all rules in the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Maximum number of rules to be executed. The default is <code>-1</code> and does not put any restriction on execution.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID to be used for retrieving the number of fired rules in execution results.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>agenda-filter</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Agenda Filter to be used for rule execution.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();
fireAllRulesCommand.setMax(10);
fireAllRulesCommand.setOutIdentifier("firedActivations");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">QueryCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Executes a query defined in the KIE base.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Query name.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID of the query results. The query results are added in the execution results with this identifier.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>arguments</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">List of objects to be passed as a query parameter.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "query": {
        "name": "persons",
        "arguments": [],
        "out-identifier": "persons"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryCommand queryCommand = new QueryCommand();
queryCommand.setName("persons");
queryCommand.setOutIdentifier("persons");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.drools.core.runtime.rule.impl.FlatQueryResults": {
              "idFactHandleMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.drools.core.common.DisconnectedFactHandle": {
                            "id": 1,
                            "identityHashCode": 1809949690,
                            "objectHashCode": 1809949690,
                            "recency": 1,
                            "object": {
                              "org.kie.server.testing.Person": {
                                "fullname": "John Doe",
                                "age": 47
                              }
                            },
                            "entryPointId": "DEFAULT",
                            "traitType": "NON_TRAIT",
                            "external-form": "0:1:1809949690:1809949690:1:DEFAULT:NON_TRAIT:org.kie.server.testing.Person"
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "idResultMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.kie.server.testing.Person": {
                            "fullname": "John Doe",
                            "age": 47
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "identifiers": {
                "type": "SET",
                "componentType": null,
                "element": [
                  "$person"
                ]
              }
            }
          },
          "key": "persons"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">SetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Sets an object to a global state.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID of the global variable defined in the KIE base</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Object to be set into the global variable</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Boolean to exclude the global variable you set from the execution results</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID of the global execution result</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "set-global": {
        "identifier": "helper",
        "object": {
          "org.kie.server.testing.Person": {
            "fullname": "kyle",
            "age": 30
          }
        },
        "out-identifier": "output"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SetGlobalCommand setGlobalCommand = new SetGlobalCommand();
setGlobalCommand.setIdentifier("helper");
setGlobalCommand.setObject(new Person("kyle", 30));
setGlobalCommand.setOut(true);
setGlobalCommand.setOutIdentifier("output");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.kie.server.testing.Person": {
              "fullname": "kyle",
              "age": 30
            }
          },
          "key": "output"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retrieves a previously defined global object.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID of the global variable defined in the KIE base</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID to be used in the execution results</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-global": {
        "identifier": "helper",
        "out-identifier": "helperOutput"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetGlobalCommand getGlobalCommand = new GetGlobalCommand();
getGlobalCommand.setIdentifier("helper");
getGlobalCommand.setOutIdentifier("helperOutput");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "helperOutput"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cdichapter"><a class="anchor" href="#_cdichapter"></a><a class="link" href="#_cdichapter">9. CDI</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a><a class="link" href="#_introduction_2">9.1. Introduction</a></h3>
<div class="paragraph">
<p><a href="http://www.cdi-spec.org">CDI</a>, Contexts and Dependency Injection, is Java specification that provides declarative controls and structures to an application.
KIE can use it to automatically instantiate and bind things, without the need to use the programmatic API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotations"><a class="anchor" href="#_annotations"></a><a class="link" href="#_annotations">9.2. Annotations</a></h3>
<div class="paragraph">
<p>@KContainer, @KBase and @KSession all support an optional 'name' attribute.
CDI typically does "getOrCreate" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instance for that name will be identity equals.</p>
</div>
<div class="sect3">
<h4 id="_kreleaseid"><a class="anchor" href="#_kreleaseid"></a><a class="link" href="#_kreleaseid">9.2.1. @KReleaseId</a></h4>
<div class="paragraph">
<p>Used to bind an instance to a specific version of a KieModule.
If kie-ci is on the classpath this will resolve dependencies automatically, downloading from remote repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kcontainer"><a class="anchor" href="#_kcontainer"></a><a class="link" href="#_kcontainer">9.2.2. @KContainer</a></h4>
<div class="paragraph">
<p>@KContainer is optional as it can be detected and added by the use of @Inject and variable type inferrence.</p>
</div>
<div class="listingblock">
<div class="title">Injects Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects named KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KContainer(name = "kc1")
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kbase"><a class="anchor" href="#_kbase"></a><a class="link" href="#_kbase">9.2.3. @KBase</a></h4>
<div class="paragraph">
<p>@KBase is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieBase kbase1v10;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession(value="kbase1", name="kb1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb1;

@Inject
@KSession(value="kbase1", name="kb2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb2;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ksession_for_kiesession"><a class="anchor" href="#_ksession_for_kiesession"></a><a class="link" href="#_ksession_for_kiesession">9.2.4. @KSession for KieSession</a></h4>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1' KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks1

@Inject
@KSession(value="ksession1", name="ks2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ksession_for_statelesskiesession"><a class="anchor" href="#_ksession_for_statelesskiesession"></a><a class="link" href="#_ksession_for_statelesskiesession">9.2.5. @KSession for StatelessKieSession</a></h4>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private StatelessKieSession ksessionv10;

@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private StatelessKieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1&#8217;StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks1

@Inject
@KSession(value="ksession1", name="ks2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks2</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_example_comparison"><a class="anchor" href="#_api_example_comparison"></a><a class="link" href="#_api_example_comparison">9.3. API Example Comparison</a></h3>
<div class="paragraph">
<p>CDI can inject instances into fields, or even pass them as arguments.
In this example field injection is used.</p>
</div>
<div class="listingblock">
<div class="title">CDI example for a named KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
KieSession kSession;

public void go(PrintStream out) {
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is less code and more declarative than the API approach.</p>
</div>
<div class="listingblock">
<div class="title">API equivalent example for a named KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void go(PrintStream out) {
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();

    KieSession kSession = kContainer.newKieSession("ksession1");
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.spring"><a class="anchor" href="#_ch.kie.spring"></a><a class="link" href="#_ch.kie.spring">10. Integration with Spring</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_important_changes_for_drools_6_0"><a class="anchor" href="#_important_changes_for_drools_6_0"></a><a class="link" href="#_important_changes_for_drools_6_0">10.1. Important Changes for Drools 6.0</a></h3>
<div class="paragraph">
<p>Drools Spring integration has undergone a complete makeover inline with the changes for Drools 6.0.
The following are some of the major changes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The recommended prefix for the Drools Spring has changed from 'drools:' to 'kie:'</p>
</li>
<li>
<p>New Top Level Tags in 6.0</p>
<div class="ulist">
<ul>
<li>
<p>kie:kmodule</p>
</li>
<li>
<p>kie:import (from version 6.2)</p>
</li>
<li>
<p>kie:releaseId (from version 6.2)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The following tags are no longer valid as top level tags.</p>
<div class="ulist">
<ul>
<li>
<p>kie:kbase - A child of the <em>kie:kmodule</em> tag.</p>
</li>
<li>
<p>kie:ksession - A child of the <em>kie:kbase</em> tag.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Removed Tags from previous versions Drools 5.x</p>
<div class="ulist">
<ul>
<li>
<p>drools:resources</p>
</li>
<li>
<p>drools:resource</p>
</li>
<li>
<p>drools:grid</p>
</li>
<li>
<p>drools:grid-node</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_drools_expert"><a class="anchor" href="#_integration_with_drools_expert"></a><a class="link" href="#_integration_with_drools_expert">10.2. Integration with Drools Expert</a></h3>
<div class="paragraph">
<p>In this section we will explain the <em>kie</em> namespace.</p>
</div>
<div class="sect3">
<h4 id="_kiemodule"><a class="anchor" href="#_kiemodule"></a><a class="link" href="#_kiemodule">10.2.1. KieModule</a></h4>
<div class="paragraph">
<p>The <em>&lt;kie:kmodule&gt;</em> defines a collection of KieBase and associated KieSession&#8217;s.
The <em>kmodule</em> tag has one MANDATORY parameter 'id'.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Bean&#8217;s <em>id</em> is the name to be
              referenced from other beans. Standard Spring ID semantics
              apply.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>kmodule</em> tag can contain only the following tags as children.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie:kbase</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the documentation of kmodule.xml in the Drools Expert documentation for detailed explanation of the need for kmodule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_3"><a class="anchor" href="#_kiebase_3"></a><a class="link" href="#_kiebase_3">10.2.2. KieBase</a></h4>
<div class="sect4">
<h5 id="_kiekbases_parameters_as_attributes"><a class="anchor" href="#_kiekbases_parameters_as_attributes"></a><a class="link" href="#_kiekbases_parameters_as_attributes">10.2.2.1. &lt;kie:kbase&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Name of the KieBase</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Comma separated list of resource packages to be
                included in this kbase</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">kbase names to be included. All resources from the
                corresponding kbase are included in this kbase.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Boolean (TRUE/FALSE). Default kbase, if not provided,
                it is assumed to be FALSE</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Event Processing Mode. Valid options are STREAM,
                CLOUD</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">equalsBehavior</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Valid options are IDENTITY, EQUALITY</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">declarativeAgenda</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Valid options are enabled, disabled, true,
                false</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_a_kbase_tag_can_contain_only_the_followingtags_as_children"><a class="anchor" href="#_a_kbase_tag_can_contain_only_the_followingtags_as_children"></a><a class="link" href="#_a_kbase_tag_can_contain_only_the_followingtags_as_children">10.2.2.2. A <em>kbase</em> tag can contain only the followingtags as children.</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:ksession</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_kiekbases_definition_example"><a class="anchor" href="#_kiekbases_definition_example"></a><a class="link" href="#_kiekbases_definition_example">10.2.2.3. &lt;kie:kbase&gt;'s definition example</a></h5>
<div class="paragraph">
<p>A kmodule can contain multiple (1..n) kbase elements.</p>
</div>
<div class="exampleblock">
<div class="title">Example 72. kbase definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample_module"&gt;
   &lt;kie:kbase name="kbase1" packages="org.drools.spring.sample"&gt;
     ...
   &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_bean_scope_for_kiebase_and_kiesession"><a class="anchor" href="#_spring_bean_scope_for_kiebase_and_kiesession"></a><a class="link" href="#_spring_bean_scope_for_kiebase_and_kiesession">10.2.2.4. Spring Bean Scope (for KieBase and KieSession)</a></h5>
<div class="paragraph">
<p>When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
For example, To force Spring to produce a new bean instance each time one is needed, you should declare the bean&#8217;s scope attribute to be 'prototype'. Similar way if you want Spring to return the same bean instance each time one is needed, you should declare the bean&#8217;s scope attribute to be 'singleton'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_important_note"><a class="anchor" href="#_important_note"></a><a class="link" href="#_important_note">10.2.3. IMPORTANT NOTE</a></h4>
<div class="paragraph">
<p>For proper initialization of the kmodule objects (kbase/ksession), it is mandatory for a bean of type <code>org.kie.spring.KModuleBeanFactoryPostProcessor</code> or <code>org.kie.spring.annotations.KModuleAnnotationPostProcessor</code> be defined.</p>
</div>
<div class="exampleblock">
<div class="title">Example 73. Regular kie-spring post processorbean definition</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 74. kie-spring post processorbean definition when annotations are used</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePostProcessor"
          class="org.kie.spring.annotations.KModuleAnnotationPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Without the org.kie.spring.KModuleBeanFactoryPostProcessor or org.kie.spring.annotations.KModuleAnnotationPostProcessor bean definition, the kie-spring integration will fail to work.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions"><a class="anchor" href="#_kiesessions"></a><a class="link" href="#_kiesessions">10.2.4. KieSessions</a></h4>
<div class="paragraph">
<p>&lt;kie:ksession&gt; element defines KieSessions.
The same tag is used to define both Stateful (<em>org.kie.api.runtime.KieSession</em>) and Stateless (<em>org.kie.api.runtime.StatelessKieSession</em>) sessions.</p>
</div>
<div class="sect4">
<h5 id="_kieksessions_parameters_as_attributes"><a class="anchor" href="#_kieksessions_parameters_as_attributes"></a><a class="link" href="#_kieksessions_parameters_as_attributes">10.2.4.1. &lt;kie:ksession&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ksession&#8217;s name.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">is the session <em>stateful</em> or
                <em>stateless?</em>. If this attribute is empty or
                missing, the session is assumed to be of type
                Stateful.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Is this the default session?</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">REALTIME or PSEUDO</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">listeners-ref</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Specifies the reference to the event listeners group
                (see <a href="#_kie_grouping_listeners">'Defining a Group
                of listeners'</a> section below).</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 75. ksession definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample-kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample3" packages="drl_kiesample3"&gt;
    &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;kie:ksession name="ksession2"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_bean_scope_for_kiebase_and_kiesession_2"><a class="anchor" href="#_spring_bean_scope_for_kiebase_and_kiesession_2"></a><a class="link" href="#_spring_bean_scope_for_kiebase_and_kiesession_2">10.2.4.2. Spring Bean Scope (for KieBase and KieSession)</a></h5>
<div class="paragraph">
<p>When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
For example, To force Spring to produce a new bean instance each time one is needed, you should declare the bean&#8217;s scope attribute to be 'prototype'. Similar way if you want Spring to return the same bean instance each time one is needed, you should declare the bean&#8217;s scope attribute to be 'singleton'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiereleaseid"><a class="anchor" href="#_kiereleaseid"></a><a class="link" href="#_kiereleaseid">10.2.5. Kie:ReleaseId</a></h4>
<div class="sect4">
<h5 id="_kiereleaseids_parameters_as_attributes"><a class="anchor" href="#_kiereleaseids_parameters_as_attributes"></a><a class="link" href="#_kiereleaseids_parameters_as_attributes">10.2.5.1. &lt;kie:releaseId&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Bean&#8217;s <em>id</em> is the name to be
                  referenced from other beans. Standard Spring ID semantics
                  apply.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">groupId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">artifactId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">version from Maven GAV</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 76. releaseId definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:releaseId id="beanId" groupId="org.kie.spring"
            artifactId="named-artifactId" version="1.0.0-SNAPSHOT"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kieimport"><a class="anchor" href="#_kieimport"></a><a class="link" href="#_kieimport">10.2.6. Kie:Import</a></h4>
<div class="paragraph">
<p>Starting with version 6.2, kie-spring allows for importing of kie objects from kjars found on the classpath.
Two modes of importing the kie objects are currently supported.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">releaseId</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Reference to a Bean ID. Standard Spring ID semantics
                apply.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">enableScanner</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Enable Scanner. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">scannerInterval</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Scanning Interval in milli seconds. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_global_import"><a class="anchor" href="#_global_import"></a><a class="link" href="#_global_import">10.2.6.1. Global Import</a></h5>
<div class="paragraph">
<p>The <em>import</em> tag will force the automatic scan of all the jars on the classpath, initialize the Kie Objects (Kbase/KSessions) and import these objects into the spring context.</p>
</div>
<div class="listingblock">
<div class="title">Global Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specific_import_releaseid"><a class="anchor" href="#_specific_import_releaseid"></a><a class="link" href="#_specific_import_releaseid">10.2.6.2. Specific Import - ReleaseId</a></h5>
<div class="paragraph">
<p>Using the <em>releaseId-ref</em> attribute on the import tag will initialize the specific Kie Objects (Kbase/KSessions) and import these objects into the spring context.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"/&gt;
&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kie Scanning feature can be enabled for KieBase&#8217;s imported with a specific releaseId.
This feature is currently not available for global imports.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId - Enable Scanner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"
            enableScanner="true" scannerInterval="1000"/&gt;

&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the scanner is defined and enabled, an implicit <em>KieScanner</em> object is created and inserted into the spring context.
It can be retrieved from the spring context.</p>
</div>
<div class="listingblock">
<div class="title">Retrieving the KieScanner from Spring Context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// the implicit name would be releaseId#scanner
KieScanner releaseIdScanner = context.getBean("namedKieSession#scanner", KieScanner.class);
releaseIdScanner.scanNow();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>kie-ci must be available on the classpath for the releaseId importing feature to work.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_annotations_2"><a class="anchor" href="#_annotations_2"></a><a class="link" href="#_annotations_2">10.2.7. Annotations</a></h4>
<div class="paragraph">
<p>@KContainer, @KBase and @KSession all support an optional 'name' attribute.
Spring typically does "get" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instance for that name will be identity equals.</p>
</div>
<div class="sect4">
<h5 id="_kreleaseid_2"><a class="anchor" href="#_kreleaseid_2"></a><a class="link" href="#_kreleaseid_2">10.2.7.1. @KReleaseId</a></h5>
<div class="paragraph">
<p>Used to bind an instance to a specific version of a KieModule.
If kie-ci is on the classpath this will resolve dependencies automatically, downloading from remote repositories.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kcontainer_2"><a class="anchor" href="#_kcontainer_2"></a><a class="link" href="#_kcontainer_2">10.2.7.2. @KContainer</a></h5>
<div class="listingblock">
<div class="title">Injects Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KContainer
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KContainer
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects named KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KContainer(name = "kc1")
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kbase_2"><a class="anchor" href="#_kbase_2"></a><a class="link" href="#_kbase_2">10.2.7.3. @KBase</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the spring xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieBase kbase1v11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.ksession1' KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession11kb2;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksession11kb2;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_kiesession_2"><a class="anchor" href="#_ksession_for_kiesession_2"></a><a class="link" href="#_ksession_for_kiesession_2">10.2.7.4. @KSession for KieSession</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml or spring xml file</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1' KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks1

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_statelesskiesession_2"><a class="anchor" href="#_ksession_for_statelesskiesession_2"></a><a class="link" href="#_ksession_for_statelesskiesession_2">10.2.7.5. @KSession for StatelessKieSession</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml or spring xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private StatelessKieSession ksessionv10;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private StatelessKieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks1

@KSession(value="ksession1", name="ks2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_important_note_2"><a class="anchor" href="#_important_note_2"></a><a class="link" href="#_important_note_2">10.2.7.6. IMPORTANT NOTE</a></h5>
<div class="paragraph">
<p>When annotations are used, For proper initialization of the kmodule objects (kbase/ksession), it is mandatory for either a bean of type <code>org.kie.spring.annotations.KModuleAnnotationPostProcessor</code> be defined</p>
</div>
<div class="exampleblock">
<div class="title">Example 77. kie-spring annotations post processor bean definition</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePostProcessor"
            class="org.kie.spring.annotations.KModuleAnnotationPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 78. kie-spring annotations - Component Scanning</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;context:component-scan base-package="org.kie.spring.annotations"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The post processor is different when annotations are used.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners"><a class="anchor" href="#_event_listeners"></a><a class="link" href="#_event_listeners">10.2.8. Event Listeners</a></h4>
<div class="paragraph">
<p>Drools supports adding 3 types of listeners to KieSessions - <em>AgendaListener</em>, <em>WorkingMemoryListener</em>, <em>ProcessEventListener</em></p>
</div>
<div class="paragraph">
<p>The kie-spring module allows you to configure these listeners to KieSessions using XML tags.
These tags have identical names as the actual listener interfaces i.e., &lt;kie:agendaEventListener&#8230;&#8203;.&gt;, &lt;kie:ruleRuntimeEventListener&#8230;&#8203;.&gt; and &lt;kie:processEventListener&#8230;&#8203;.&gt;.</p>
</div>
<div class="paragraph">
<p>kie-spring provides features to define the listeners as standalone (individual) listeners and also to define them as a group.</p>
</div>
<div class="sect4">
<h5 id="_defining_stand_alone_listeners"><a class="anchor" href="#_defining_stand_alone_listeners"></a><a class="link" href="#_defining_stand_alone_listeners">10.2.8.1. Defining Stand alone Listeners:</a></h5>

</div>
<div class="sect4">
<h5 id="_attributes"><a class="anchor" href="#_attributes"></a><a class="link" href="#_attributes">10.2.8.2. Attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ref</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A reference to another declared bean.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 79. Listener configuration example - using a bean:ref.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_nested_elements"><a class="anchor" href="#_nested_elements"></a><a class="link" href="#_nested_elements">10.2.8.3. Nested Elements:</a></h5>
<div class="ulist">
<ul>
<li>
<p>bean</p>
<div class="ulist">
<ul>
<li>
<p>class = String</p>
</li>
<li>
<p>name = String (optional)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 80. Listener configuration example - using nested bean.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
   &lt;kie:ksession name="ksession1"&gt;
	  &lt;kie:agendaEventListener&gt;
      &lt;bean class="mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_empty_tag_declaration_with_no_ref_and_without_a_nestedbean"><a class="anchor" href="#_empty_tag_declaration_with_no_ref_and_without_a_nestedbean"></a><a class="link" href="#_empty_tag_declaration_with_no_ref_and_without_a_nestedbean">10.2.8.4. Empty Tag : Declaration with no 'ref' and without a nestedbean</a></h5>
<div class="paragraph">
<p>When a listener is defined without a reference to a implementing bean and does not contain a nested bean, <em>&lt;drools:ruleRuntimeEventListener/&gt;</em> the underlying implementation adds the Debug version of the listener defined in the API.</p>
</div>
<div class="paragraph">
<p>The debug listeners print the corresponding Event toString message to _System.err. _</p>
</div>
<div class="exampleblock">
<div class="title">Example 81. Listener configuration example - defaulting to the debugversions provided by the Knowledge-API .</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
 &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener /&gt;
      &lt;kie:processEventListener /&gt;
      &lt;kie:ruleRuntimeEventListener /&gt;
    &lt;/kie:ksession&gt;
 &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mix_and_match_of_different_declaration_styles"><a class="anchor" href="#_mix_and_match_of_different_declaration_styles"></a><a class="link" href="#_mix_and_match_of_different_declaration_styles">10.2.8.5. Mix and Match of different declaration styles</a></h5>
<div class="paragraph">
<p>The drools-spring module allows you to mix and match the different declarative styles within the same KieSession.
The below sample provides more clarity.</p>
</div>
<div class="exampleblock">
<div class="title">Example 82. Listener configuration example - mix and match of&#8217;ref'/nested-bean/empty styles.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener&gt;
          &lt;bean class="org.kie.spring.mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_multiple_listeners_of_the_same_type"><a class="anchor" href="#_defining_multiple_listeners_of_the_same_type"></a><a class="link" href="#_defining_multiple_listeners_of_the_same_type">10.2.8.6. Defining multiple listeners of the same type</a></h5>
<div class="paragraph">
<p>It is also valid to define multiple beans of the same event listener types for a KieSession.</p>
</div>
<div class="exampleblock">
<div class="title">Example 83. Listener configuration example - multiple listeners of the same type.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:agendaEventListener&gt;
          &lt;bean class="org.kie.spring.mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_grouping_listeners"><a class="anchor" href="#_kie_grouping_listeners"></a><a class="link" href="#_kie_grouping_listeners">10.2.8.7. Defining a Group of listeners:</a></h5>
<div class="paragraph">
<p>drools-spring allows for grouping of listeners.
This is particularly useful when you define a set of listeners and want to attach them to multiple sessions.
The grouping feature is also very useful, when we define a set of listeners for 'testing' and then want to switch them for 'production' use.</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes_2"><a class="anchor" href="#_attributes_2"></a><a class="link" href="#_attributes_2">10.2.8.8. Attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Unique identifier</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_nested_elements_2"><a class="anchor" href="#_nested_elements_2"></a><a class="link" href="#_nested_elements_2">10.2.8.9. Nested Elements:</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:agendaEventListener&#8230;&#8203;</p>
</li>
<li>
<p>kie:ruleRuntimeEventListener&#8230;&#8203;</p>
</li>
<li>
<p>kie:processEventListener&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above mentioned child elements can be declared in any order.
Only one declaration of each type is allowed in a group.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_example"><a class="anchor" href="#_example"></a><a class="link" href="#_example">10.2.8.10. Example:</a></h5>
<div class="exampleblock">
<div class="title">Example 84. Group of listeners - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="statelessWithGroupedListeners" type="stateless"
             listeners-ref="debugListeners"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

  &lt;kie:eventListeners id="debugListeners"&gt;
  &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
  &lt;kie:processEventListener ref="mock-process-listener"/&gt;
  &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
&lt;/kie:eventListeners&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loggers"><a class="anchor" href="#_loggers"></a><a class="link" href="#_loggers">10.2.9. Loggers</a></h4>
<div class="paragraph">
<p>Drools supports adding 2 types of loggers to KieSessions - <em>ConsoleLogger</em>, <em>FileLogger.</em></p>
</div>
<div class="paragraph">
<p>The kie-spring module allows you to configure these loggers to KieSessions using XML tags.
These tags have identical names as the actual logger interfaces i.e., &lt;kie:consoleLogger&#8230;&#8203;.&gt; and &lt;kie:fileLogger&#8230;&#8203;.&gt;.</p>
</div>
<div class="sect4">
<h5 id="_defining_a_console_logger"><a class="anchor" href="#_defining_a_console_logger"></a><a class="link" href="#_defining_a_console_logger">10.2.9.1. Defining a console logger:</a></h5>
<div class="paragraph">
<p>A console logger can be attached to a KieSession by using the <em>&lt;kie:consoleLogger/&gt;</em> tag.
This tag has no attributes and must be present directly under a &lt;kie:ksession&#8230;&#8203;.&gt; element.</p>
</div>
<div class="exampleblock">
<div class="title">Example 85. Defining a console logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:consoleLogger/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_a_file_logger"><a class="anchor" href="#_defining_a_file_logger"></a><a class="link" href="#_defining_a_file_logger">10.2.9.2. Defining a file logger:</a></h5>
<div class="paragraph">
<p>A file logger can be attached to a KieSession by using the <em>&lt;kie:fileLogger/&gt;</em> tag.
This tag has the following attributes and must be present directly under a &lt;kie:ksession&#8230;&#8203;.&gt; element.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Unique identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Path to the actual file on the disk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">threaded</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Defaults to false. Valid values are 'true' or
                'false'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">interval</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Integer. Specifies the interval for flushing the
                contents from memory to the disk.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 86. Defining a file logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log2"
                          threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_closing_a_filelogger"><a class="anchor" href="#_closing_a_filelogger"></a><a class="link" href="#_closing_a_filelogger">10.2.9.3. Closing a FileLogger</a></h5>
<div class="paragraph">
<p>To prevent leaks, it is advised to close the _&lt;kie:fileLogger &#8230;&#8203;&gt; _ programmatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoggerAdaptor adaptor = (LoggerAdaptor) context.getBean("fl_logger");
adaptor.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_defining_batch_commands"><a class="anchor" href="#_defining_batch_commands"></a><a class="link" href="#_defining_batch_commands">10.2.10. Defining Batch Commands</a></h4>
<div class="paragraph">
<p>A <em>&lt;kie:batch&gt;</em> element can be used to define a set of batch commands for a given ksession. This tag has no attributes and must be present directly under a &lt;kie:ksession&#8230;&#8203;.&gt; element.
The commands supported are</p>
</div>
<div class="ulist">
<div class="title">Initialization Batch Commands</div>
<ul>
<li>
<p>insert-object</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>set-global</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>reg = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-all-rules</p>
<div class="ulist">
<ul>
<li>
<p>max : n</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-until-halt</p>
</li>
<li>
<p>start-process</p>
<div class="ulist">
<ul>
<li>
<p>parameter</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>signal-event</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>event-type = String (required)</p>
</li>
<li>
<p>process-instance-id =n (optional)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 87. Batch commands - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"&gt;
      &lt;kie:batch&gt;
        &lt;kie:insert-object ref="person2"/&gt;
        &lt;kie:set-global identifier="persons" ref="personsList"/&gt;
        &lt;kie:fire-all-rules max="10"/&gt;
      &lt;/kie:batch&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_persistence"><a class="anchor" href="#_persistence"></a><a class="link" href="#_persistence">10.2.11. Persistence</a></h4>
<div class="ulist">
<div class="title">Persistence Configuration Options</div>
<ul>
<li>
<p>jpa-persistence</p>
<div class="ulist">
<ul>
<li>
<p>transaction-manager</p>
<div class="ulist">
<ul>
<li>
<p>ref = String</p>
</li>
</ul>
</div>
</li>
<li>
<p>entity-manager-factory</p>
<div class="ulist">
<ul>
<li>
<p>ref = String</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 88. ksession JPA configuration example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kstore id="kstore" /&gt; &lt;!-- provides KnowledgeStoreService implementation --&gt;

&lt;bean id="myEmf"
       class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
   &lt;property name="dataSource" ref="ds" /&gt;
   &lt;property name="persistenceUnitName"
       value="org.drools.persistence.jpa.local" /&gt;
&lt;/bean&gt;

&lt;bean id="txManager" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
   &lt;property name="entityManagerFactory" ref="myEmf" /&gt;
&lt;/bean&gt;

&lt;kie:kmodule id="persistence_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="jpaSingleSessionCommandService"&gt;
      &lt;kie:configuration&gt;
         &lt;kie:jpa-persistence&gt;
           &lt;kie:transaction-manager ref="txManager"/&gt;
           &lt;kie:entity-manager-factory ref="myEmf"/&gt;
         &lt;/kie:jpa-persistence&gt;
      &lt;/kie:configuration&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_leveraging_other_spring_features"><a class="anchor" href="#_leveraging_other_spring_features"></a><a class="link" href="#_leveraging_other_spring_features">10.2.12. Leveraging Other Spring Features</a></h4>
<div class="paragraph">
<p>This section provides details on leveraging other standard spring features when integrating with Drools Expert.</p>
</div>
<div class="sect4">
<h5 id="_using_spring_expressions_spel"><a class="anchor" href="#_using_spring_expressions_spel"></a><a class="link" href="#_using_spring_expressions_spel">10.2.12.1. Using Spring Expressions (Spel)</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="#{packageRepository.packages}"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
      class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;

&lt;bean id="packageRepository" class="sample.package.class.PackageRepo"&gt;
  &lt;property name="packages" value="drl_kiesample3"&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl" file="#{ systemProperties['java.io.tmpdir'] }/log2"
            threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
            class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_spring_profiles"><a class="anchor" href="#_using_spring_profiles"></a><a class="link" href="#_using_spring_profiles">10.2.12.2. Using Spring Profiles</a></h5>
<div class="paragraph">
<p>Spring 3.1 introduces a new profile attribute to the beans element of the spring-beans schema.
This attribute acts as a switch when enabling and disabling profiles in different environments.
One potential use of this attribute can be to have the same kbase defined with debug loggers in 'dev' environment and without loggers in 'prod' environment.</p>
</div>
<div class="paragraph">
<p>The below code snippet illustrates the concept of 'profiles'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:kie="http://drools.org/schema/kie-spring"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"&gt;
  &lt;beans profile="development"&gt;
    &lt;kie:kmodule id="test-kmodule"&gt;
      &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
        &lt;kie:ksession name="ksession1" type="stateless"&gt;
            &lt;kie:consoleLogger /&gt;
        &lt;/kie:ksession&gt;
      &lt;/kie:kbase&gt;
    &lt;/kie:kmodule&gt;
    ...
  &lt;/beans&gt;

  &lt;beans profile="production"&gt;
    &lt;kie:kmodule id="test-kmodule"&gt;
      &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
        &lt;kie:ksession name="ksession1" type="stateless"/&gt;
      &lt;/kie:kbase&gt;
    &lt;/kie:kmodule&gt;
    ...
  &lt;/beans&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown above, the Spring XML contains the definition of the profiles.
While loading the <em>ApplicationContext</em> you have to tell Spring which profile you&#8217;re loading.</p>
</div>
<div class="paragraph">
<p>There are several ways of selecting your profile and the most useful is by using the "spring.profiles.active" system property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>System.setProperty("spring.profiles.active", "development");
ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously, it is not a good practice to hard code things as shown above and the recommended practice is to keep the system properties definitions independent of the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dspring.profiles.active="development"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The profiles can also be loaded and enabled programmatically</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...
GenericXmlApplicationContext ctx = new GenericXmlApplicationContext("beans.xml");
ConfigurableEnvironment env = ctx.getEnvironment();
env.setActiveProfiles("development");
ctx.refresh();
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_jbpm_human_task"><a class="anchor" href="#_integration_with_jbpm_human_task"></a><a class="link" href="#_integration_with_jbpm_human_task">10.3. Integration with jBPM Human Task</a></h3>
<div class="paragraph">
<p>This chapter describes the infrastructure used when configuring a human task server with Spring as well as a little bit about the infrastructure used when doing this.</p>
</div>
<div class="sect3">
<h4 id="_how_to_configure_spring_with_jbpm_human_task"><a class="anchor" href="#_how_to_configure_spring_with_jbpm_human_task"></a><a class="link" href="#_how_to_configure_spring_with_jbpm_human_task">10.3.1. How to configure Spring with jBPM Human task</a></h4>
<div class="paragraph">
<p>The jBPM human task server can be configured to use Spring persistence. The following is a dependency graph for a configuration that uses local transactions and Spring&#8217;s thread-safe EntityManager proxy:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Spring/ht-spring-deps.png" alt="ht spring deps">
</div>
<div class="title">Figure 143. Spring Human Task integration injection dependencies</div>
</div>
<div class="paragraph">
<p>A <code>TaskService</code> instance is dependent on two other bean types: a drools <code>SystemEventListener</code> bean as well as a <code>TaskSessionSpringFactoryImpl</code> bean.
The <code>TaskSessionSpringFactoryImpl</code> bean is howerver <em>not</em> injected into the <code>TaskService</code> bean because this would cause a circular dependency.
To solve this problem, when the <code>TaskService</code> bean is injected into the <code>TaskSessionSpringFactoryImpl</code> bean, the setter method used secretly injects the <code>TaskSessionSpringFactoryImpl</code> instance back into the <code>TaskService</code> bean and initializes the <code>TaskService</code> bean as well.</p>
</div>
<div class="paragraph">
<p>The <code>TaskSessionSpringFactoryImpl</code> bean is responsible for creating all the internal instances in human task that deal with transactions and persistence context management.
Besides a <code>TaskService</code> instance, this bean also requires a transaction manager and a persistence context to be injected.
Specifically, it requires an instance of a <code>HumanTaskSpringTransactionManager</code> bean (as a transaction manager) and an instance of a <code>SharedEntityManagerBean</code> bean (as a persistence context instance).</p>
</div>
<div class="paragraph">
<p>We also use some of the standard Spring beans in order to configure persistence: there&#8217;s a bean to hold the <code>EntityManagerFactory</code> instance as well as the <code>SharedEntityManagerBean</code> instance.
The <code>SharedEntityManagerBean</code> provides a shared, thread-safe proxy for the actual <code>EntityManager</code>.</p>
</div>
<div class="paragraph">
<p>The <code>HumanTaskSpringTransactionManager</code> bean serves as a wrapper around the Spring transaction manager, in this case the <code>JpaTransactionManager</code>.
An instance of a <code>JpaTransactionManager</code> bean is also instantiated because of this.</p>
</div>
<div class="exampleblock">
<div class="title">Example 89. Configuring Human Task with Spring</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jbpm="http://drools.org/schema/drools-spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://drools.org/schema/drools-spring org/drools/container/spring/drools-spring-1.2.0.xsd"&gt;

  &lt;!-- persistence &amp; transactions--&gt;
  &lt;bean id="htEmf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
    &lt;property name="persistenceUnitName" value="org.jbpm.task" /&gt;
  &lt;/bean&gt;

  &lt;bean id="htEm" class="org.springframework.orm.jpa.support.SharedEntityManagerBean"&gt;
    &lt;property name="entityManagerFactory" ref="htEmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="jpaTxMgr" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
    &lt;property name="entityManagerFactory" ref="htEmf" /&gt;
    &lt;!-- this must be true if using the SharedEntityManagerBean, and false otherwise --&gt;
    &lt;property name="nestedTransactionAllowed" value="true"/&gt;
  &lt;/bean&gt;

  &lt;bean id="htTxMgr" class="org.drools.container.spring.beans.persistence.HumanTaskSpringTransactionManager"&gt;
    &lt;constructor-arg ref="jpaTxMgr" /&gt;
  &lt;/bean&gt;

  &lt;!-- human-task beans --&gt;

  &lt;bean id="systemEventListener" class="org.drools.SystemEventListenerFactory" factory-method="getSystemEventListener" /&gt;

  &lt;bean id="taskService" class="org.jbpm.task.service.TaskService" &gt;
    &lt;property name="systemEventListener" ref="systemEventListener" /&gt;
  &lt;/bean&gt;

  &lt;bean id="springTaskSessionFactory" class="org.jbpm.task.service.persistence.TaskSessionSpringFactoryImpl"
        init-method="initialize" depends-on="taskService" &gt;
    &lt;!-- if using the SharedEntityManagerBean, make sure to enable nested transactions --&gt;
    &lt;property name="entityManager" ref="htEm" /&gt;
    &lt;property name="transactionManager" ref="htTxMgr" /&gt;
    &lt;property name="useJTA" value="false" /&gt;
    &lt;property name="taskService" ref="taskService" /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using the <code>SharedEntityManagerBean</code> instance, it&#8217;s important to configure the Spring transaction manager to use nested transactions.
This is because the <code>SharedEntityManagerBean</code> is a <em>transactional</em> persistence context and will close the persistence context after every operation.
However, the human task server needs to be able to access (persisted) entities after operations.
Nested transactions allow us to still have access to entities that otherwise would have been detached and are no longer accessible, especially when using an ORM framework that uses lazy-initialization of entities.</p>
</div>
<div class="paragraph">
<p>Also, while the <code>TaskSessionSpringFactoryImpl</code> bean takes an &#8220;useJTA&#8221;
 parameter, at the moment, JTA transactions with Spring have not yet been fully tested.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.blueprint"><a class="anchor" href="#_ch.kie.blueprint"></a><a class="link" href="#_ch.kie.blueprint">11. Integration with Aries Blueprint</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_integration_with_drools_expert_2"><a class="anchor" href="#_integration_with_drools_expert_2"></a><a class="link" href="#_integration_with_drools_expert_2">11.1. Integration with Drools Expert</a></h3>
<div class="paragraph">
<p>In this section we will explain the <em>kie</em> namespace.</p>
</div>
<div class="sect3">
<h4 id="_kiemodule_2"><a class="anchor" href="#_kiemodule_2"></a><a class="link" href="#_kiemodule_2">11.1.1. KieModule</a></h4>
<div class="paragraph">
<p>The <em>&lt;kie:kmodule&gt;</em> defines a collection of KieBase and associated KieSession&#8217;s.
The <em>kmodule</em> tag has one MANDATORY parameter 'id'.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Bean&#8217;s <em>id</em> is the name to be
              referenced from other beans. Standard Blueprint ID semantics
              applies.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>kmodule</em> tag can contain only the following tags as children.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie:kbase</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the documentation of kmodule.xml in the Drools Expert documentation for detailed explanation of the need for kmodule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_4"><a class="anchor" href="#_kiebase_4"></a><a class="link" href="#_kiebase_4">11.1.2. KieBase</a></h4>
<div class="sect4">
<h5 id="_kiekbases_parameters_as_attributes_2"><a class="anchor" href="#_kiekbases_parameters_as_attributes_2"></a><a class="link" href="#_kiekbases_parameters_as_attributes_2">11.1.2.1. &lt;kie:kbase&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Name of the KieBase</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Comma separated list of resource packages to be
                included in this kbase</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">kbase names to be included. All resources from the
                corresponding kbase are included in this kbase.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Boolean (TRUE/FALSE). Default kbase, if not provided,
                it is assumed to be FALSE</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Event Processing Mode. Valid options are STREAM,
                CLOUD</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">equalsBehavior</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Valid options are IDENTITY, EQUALITY</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_a_kbase_tag_can_contain_only_the_following_tags_as_children"><a class="anchor" href="#_a_kbase_tag_can_contain_only_the_following_tags_as_children"></a><a class="link" href="#_a_kbase_tag_can_contain_only_the_following_tags_as_children">11.1.2.2. A <em>kbase</em> tag can contain only the following tags as children.</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:ksession</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_kiekbases_definition_example_2"><a class="anchor" href="#_kiekbases_definition_example_2"></a><a class="link" href="#_kiekbases_definition_example_2">11.1.2.3. &lt;kie:kbase&gt;'s definition example</a></h5>
<div class="paragraph">
<p>A kmodule can contain multiple (1..n) kbase elements.</p>
</div>
<div class="exampleblock">
<div class="title">Example 90. kbase definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample_module"&gt;
   &lt;kie:kbase name="kbase1" packages="org.drools.blueprint.sample"&gt;
     ...
   &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_blueprint_bean_scope_for_kiebase_and_kiesession"><a class="anchor" href="#_blueprint_bean_scope_for_kiebase_and_kiesession"></a><a class="link" href="#_blueprint_bean_scope_for_kiebase_and_kiesession">11.1.2.4. Blueprint Bean Scope (for KieBase and KieSession)</a></h5>
<div class="paragraph">
<p>When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
For example, To force Blueprint to produce a new bean instance each time one is needed, you should declare the bean&#8217;s scope attribute to be 'prototype'. Similar way if you want Blueprint to return the same bean instance each time one is needed, you should declare the bean&#8217;s scope attribute to be 'singleton'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions_2"><a class="anchor" href="#_kiesessions_2"></a><a class="link" href="#_kiesessions_2">11.1.3. KieSessions</a></h4>
<div class="paragraph">
<p>&lt;kie:ksession&gt; element defines KieSessions.
The same tag is used to define both Stateful (<em>org.kie.api.runtime.KieSession</em>) and Stateless (<em>org.kie.api.runtime.StatelessKieSession</em>) sessions.</p>
</div>
<div class="sect4">
<h5 id="_kieksessions_parameters_as_attributes_2"><a class="anchor" href="#_kieksessions_parameters_as_attributes_2"></a><a class="link" href="#_kieksessions_parameters_as_attributes_2">11.1.3.1. &lt;kie:ksession&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ksession&#8217;s name.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">is the session <em>stateful</em> or
                <em>stateless?</em>. If this attribute is empty or
                missing, the session is assumed to be of type
                Stateful.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Is this the default session?</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">REALTIME or PSEUDO</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">listeners-ref</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Specifies the reference to the event listeners group
                (see <a href="#_kie_grouping_listeners">'Defining a Group
                of listeners'</a> section below).</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 91. ksession definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample-kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample3" packages="drl_kiesample3"&gt;
    &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;kie:ksession name="ksession2"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiereleaseid_2"><a class="anchor" href="#_kiereleaseid_2"></a><a class="link" href="#_kiereleaseid_2">11.1.4. Kie:ReleaseId</a></h4>
<div class="sect4">
<h5 id="_kiereleaseids_parameters_as_attributes_2"><a class="anchor" href="#_kiereleaseids_parameters_as_attributes_2"></a><a class="link" href="#_kiereleaseids_parameters_as_attributes_2">11.1.4.1. &lt;kie:releaseId&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Bean&#8217;s <em>id</em> is the name to be
                  referenced from other beans. Standard Blueprint ID semantics
                  applies.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">groupId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">artifactId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">version from Maven GAV</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 92. releaseId definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:releaseId id="beanId" groupId="org.kie.blueprint"
            artifactId="named-artifactId" version="1.0.0-SNAPSHOT"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kieimport_2"><a class="anchor" href="#_kieimport_2"></a><a class="link" href="#_kieimport_2">11.1.5. Kie:Import</a></h4>
<div class="paragraph">
<p>Starting with version 6.5, kie-aries-blueprint allows for importing of kie objects from kjars found on the classpath.
Two modes of importing the kie objects are currently supported.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">releaseId</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Reference to a Bean ID. Standard Blueprint ID semantics
                applies.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">enableScanner</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Enable Scanner. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">scannerInterval</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Scanning Interval in milli seconds. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_global_import_2"><a class="anchor" href="#_global_import_2"></a><a class="link" href="#_global_import_2">11.1.5.1. Global Import</a></h5>
<div class="paragraph">
<p>The <em>import</em> tag will force the automatic scan of all the jars on the classpath, initialize the Kie Objects (Kbase/KSessions) and import these objects into the blueprint context.</p>
</div>
<div class="listingblock">
<div class="title">Global Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specific_import_releaseid_2"><a class="anchor" href="#_specific_import_releaseid_2"></a><a class="link" href="#_specific_import_releaseid_2">11.1.5.2. Specific Import - ReleaseId</a></h5>
<div class="paragraph">
<p>Using the <em>releaseId-ref</em> attribute on the import tag will initialize the specific Kie Objects (Kbase/KSessions) and import these objects into the blueprint context.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"/&gt;
&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kie Scanning feature can be enabled for KieBase&#8217;s imported with a specific releaseId.
This feature is currently not available for global imports.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId - Enable Scanner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"
            enableScanner="true" scannerInterval="1000"/&gt;

&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the scanner is defined and enabled, an implicit <em>KieScanner</em> object is created and inserted into the blueprint container.
It can be programmatically retrieved from the blueprint container using the <em>-scanner</em> suffix.</p>
</div>
<div class="listingblock">
<div class="title">Retrieving the KieScanner from Blueprint Container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// the implicit name would be releaseId-scanner
KieScanner releaseIdScanner = (KieScanner)container.getComponentInstance("namedKieSession-scanner");
releaseIdScanner.scanNow();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>kie-ci must be available on the classpath for the releaseId importing feature to work.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners_2"><a class="anchor" href="#_event_listeners_2"></a><a class="link" href="#_event_listeners_2">11.1.6. Event Listeners</a></h4>
<div class="paragraph">
<p>Drools supports adding 3 types of listeners to KieSessions - <em>AgendaListener</em>, <em>WorkingMemoryListener</em>, <em>ProcessEventListener</em></p>
</div>
<div class="paragraph">
<p>The kie-aries-blueprint module allows you to configure these listeners to KieSessions using XML tags.
These tags have identical names as the actual listener interfaces i.e., &lt;kie:agendaEventListener&#8230;&#8203;.&gt;, &lt;kie:ruleRuntimeEventListener&#8230;&#8203;.&gt; and &lt;kie:processEventListener&#8230;&#8203;.&gt;.</p>
</div>
<div class="paragraph">
<p>kie-aries-blueprint provides features to define the listeners as standalone (individual) listeners and also to define them as a group.</p>
</div>
<div class="sect4">
<h5 id="_defining_stand_alone_listeners_2"><a class="anchor" href="#_defining_stand_alone_listeners_2"></a><a class="link" href="#_defining_stand_alone_listeners_2">11.1.6.1. Defining Stand alone Listeners:</a></h5>

</div>
<div class="sect4">
<h5 id="_attributes_3"><a class="anchor" href="#_attributes_3"></a><a class="link" href="#_attributes_3">11.1.6.2. Attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ref</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A reference to another declared bean.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 93. Listener configuration example - using a bean:ref.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_multiple_listeners_of_the_same_type_2"><a class="anchor" href="#_defining_multiple_listeners_of_the_same_type_2"></a><a class="link" href="#_defining_multiple_listeners_of_the_same_type_2">11.1.6.3. Defining multiple listeners of the same type</a></h5>
<div class="paragraph">
<p>It is also valid to define multiple beans of the same event listener types for a KieSession.</p>
</div>
<div class="exampleblock">
<div class="title">Example 94. Listener configuration example - multiple listeners of the same type.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener1" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-agenda-listener2" class="mocks.MockAgendaEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener1"/&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener2"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_grouping_listeners"><a class="anchor" href="#_kie_grouping_listeners"></a><a class="link" href="#_kie_grouping_listeners">11.1.6.4. Defining a Group of listeners:</a></h5>
<div class="paragraph">
<p>kie-aries-blueprinty allows for grouping of listeners.
This is particularly useful when you define a set of listeners and want to attach them to multiple sessions.
The grouping feature is also very useful, when we define a set of listeners for 'testing' and then want to switch them for 'production' use.</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes_4"><a class="anchor" href="#_attributes_4"></a><a class="link" href="#_attributes_4">11.1.6.5. Attributes:</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Unique identifier</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_nested_elements_3"><a class="anchor" href="#_nested_elements_3"></a><a class="link" href="#_nested_elements_3">11.1.6.6. Nested Elements:</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:agendaEventListener&#8230;&#8203;</p>
</li>
<li>
<p>kie:ruleRuntimeEventListener&#8230;&#8203;</p>
</li>
<li>
<p>kie:processEventListener&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above mentioned child elements can be declared in any order.
Only one declaration of each type is allowed in a group.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_example_2"><a class="anchor" href="#_example_2"></a><a class="link" href="#_example_2">11.1.6.7. Example:</a></h5>
<div class="exampleblock">
<div class="title">Example 95. Group of listeners - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="statelessWithGroupedListeners" type="stateless"
             listeners-ref="debugListeners"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

  &lt;kie:eventListeners id="debugListeners"&gt;
  &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
  &lt;kie:processEventListener ref="mock-process-listener"/&gt;
  &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
&lt;/kie:eventListeners&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loggers_2"><a class="anchor" href="#_loggers_2"></a><a class="link" href="#_loggers_2">11.1.7. Loggers</a></h4>
<div class="paragraph">
<p>Drools supports adding 2 types of loggers to KieSessions - <em>ConsoleLogger</em>, <em>FileLogger.</em></p>
</div>
<div class="paragraph">
<p>The kie-aries-blueprint module allows you to configure these loggers to KieSessions using XML tags.
These tags have identical names as the actual logger interfaces i.e., &lt;kie:consoleLogger&#8230;&#8203;.&gt; and &lt;kie:fileLogger&#8230;&#8203;.&gt;.</p>
</div>
<div class="sect4">
<h5 id="_defining_a_console_logger_2"><a class="anchor" href="#_defining_a_console_logger_2"></a><a class="link" href="#_defining_a_console_logger_2">11.1.7.1. Defining a console logger:</a></h5>
<div class="paragraph">
<p>A console logger can be attached to a KieSession by using the <em>&lt;kie:consoleLogger/&gt;</em> tag.
This tag has no attributes and must be present directly under a &lt;kie:ksession&#8230;&#8203;.&gt; element.</p>
</div>
<div class="exampleblock">
<div class="title">Example 96. Defining a console logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:consoleLogger/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_a_file_logger_2"><a class="anchor" href="#_defining_a_file_logger_2"></a><a class="link" href="#_defining_a_file_logger_2">11.1.7.2. Defining a file logger:</a></h5>
<div class="paragraph">
<p>A file logger can be attached to a KieSession by using the <em>&lt;kie:fileLogger/&gt;</em> tag.
This tag has the following attributes and must be present directly under a &lt;kie:ksession&#8230;&#8203;.&gt; element.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Required</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Unique identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Path to the actual file on the disk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">threaded</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Defaults to false. Valid values are 'true' or
                'false'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">interval</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Integer. Specifies the interval for flushing the
                contents from memory to the disk.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 97. Defining a file logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log2"
                          threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_closing_a_filelogger_2"><a class="anchor" href="#_closing_a_filelogger_2"></a><a class="link" href="#_closing_a_filelogger_2">11.1.7.3. Closing a FileLogger</a></h5>
<div class="paragraph">
<p>To prevent leaks, it is advised to close the <em>&lt;kie:fileLogger &#8230;&#8203;&gt;</em> programmatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoggerAdaptor adaptor = (LoggerAdaptor) container.getComponentInstance("fl_logger");
adaptor.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_defining_batch_commands_2"><a class="anchor" href="#_defining_batch_commands_2"></a><a class="link" href="#_defining_batch_commands_2">11.1.8. Defining Batch Commands</a></h4>
<div class="paragraph">
<p>A <em>&lt;kie:batch&gt;</em> element can be used to define a set of batch commands for a given ksession. This tag has no attributes and must be present directly under a &lt;kie:ksession&#8230;&#8203;.&gt; element.
The commands supported are</p>
</div>
<div class="ulist">
<div class="title">Initialization Batch Commands</div>
<ul>
<li>
<p>insert-object</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>set-global</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>reg = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-all-rules</p>
<div class="ulist">
<ul>
<li>
<p>max : n</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-until-halt</p>
</li>
<li>
<p>start-process</p>
<div class="ulist">
<ul>
<li>
<p>parameter</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>signal-event</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>event-type = String (required)</p>
</li>
<li>
<p>process-instance-id =n (optional)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 98. Batch commands - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"&gt;
      &lt;kie:batch&gt;
        &lt;kie:insert-object ref="person2"/&gt;
        &lt;kie:set-global identifier="persons" ref="personsList"/&gt;
        &lt;kie:fire-all-rules max="10"/&gt;
      &lt;/kie:batch&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.android"><a class="anchor" href="#_ch.kie.android"></a><a class="link" href="#_ch.kie.android">12. Android Integration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_integration_with_drools_expert_3"><a class="anchor" href="#_integration_with_drools_expert_3"></a><a class="link" href="#_integration_with_drools_expert_3">12.1. Integration with Drools Expert</a></h3>
<div class="paragraph">
<p>Drools Android integration comes in two flavors, with or without the <em>drools-compiler</em> dependency.
Without the drools-compiler dependency the KIE bases are pre-serialized at buildtime using the kie-maven-plugin.
They can be then deserialized using the API, or directly injected using Roboguice.
When using the drools-compiler dependency there are two options: (1) standard KieContainer API or (2) CDI-like injection with Roboguice.</p>
</div>
<div class="sect3">
<h4 id="_pre_serialized_rules"><a class="anchor" href="#_pre_serialized_rules"></a><a class="link" href="#_pre_serialized_rules">12.1.1. Pre-serialized Rules</a></h4>
<div class="paragraph">
<p>It is possible to use Drools without the drools-compiler dependency, which results in a smaller apk, by pre-serializing the compiled KIE bases during build-time and then de-serializing them at runtime.</p>
</div>
<div class="sect4">
<h5 id="_maven_configuration"><a class="anchor" href="#_maven_configuration"></a><a class="link" href="#_maven_configuration">12.1.1.1. Maven Configuration</a></h5>
<div class="paragraph">
<p>The KieBase must be serialized during build time using <em>kie-maven-plugin</em>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 99. Pre-serialized KieBase Maven pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-android&lt;/artifactId&gt;
    &lt;exclusions&gt;
     &lt;exclusion&gt;
       &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
       &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-core&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;configuration&gt;
        &lt;kiebases&gt;
        &lt;kiebase&gt;HelloKB&lt;/kiebase&gt;
        &lt;/kiebases&gt;
        &lt;resDirectory&gt;${basedir}/src/main/res/raw&lt;/resDirectory&gt;
      &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;touch&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;touch&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;initialize&lt;/phase&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;compile-kbase&lt;/id&gt;
              &lt;goals&gt;
                &lt;goal&gt;build&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;phase&gt;compile&lt;/phase&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;serialize&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;serialize&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;compile&lt;/phase&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
     &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_loading_the_kiebase"><a class="anchor" href="#_loading_the_kiebase"></a><a class="link" href="#_loading_the_kiebase">12.1.1.2. Loading the KieBase</a></h5>
<div class="paragraph">
<p>The KieBase must be de-serialized before creating the sessions.</p>
</div>
<div class="listingblock">
<div class="title">Loading serialized KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private class LoadKieBaseTask extends AsyncTask&lt;InputStream, Void, KieBase&gt; {
   @Override
   protected KieBase doInBackground(InputStream... params) {
      try {
         logger.debug("Loading KIE base");
         final KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
         kbase.addKnowledgePackages((List&lt;KnowledgePackage&gt;) DroolsStreamUtils.streamIn(params[0]));
         return kbase;
      }catch(Exception e) {
         logger.error("Drools exception", e);
         return null;
      }
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiecontainer_api_with_drools_compiler_dependency"><a class="anchor" href="#_kiecontainer_api_with_drools_compiler_dependency"></a><a class="link" href="#_kiecontainer_api_with_drools_compiler_dependency">12.1.2. KieContainer API with drools-compiler dependency</a></h4>
<div class="paragraph">
<p>With the drools-compiler dependency standard KieContainer API can be used.
This comes at a cost of a larger apk.
To avoid the 65K limit, multidex (or proguard) can be used.</p>
</div>
<div class="sect4">
<h5 id="_maven_configuration_with_drools_compiler_and_multidex"><a class="anchor" href="#_maven_configuration_with_drools_compiler_and_multidex"></a><a class="link" href="#_maven_configuration_with_drools_compiler_and_multidex">12.1.2.1. Maven Configuration with drools-compiler and multidex</a></h5>
<div class="paragraph">
<p>The kie-maven-plugin must be configured to build the kiebase.
Multidex must be used to allow for the increased dependencies.
There are also some settings for merging various Drools XML files within the apk.</p>
</div>
<div class="exampleblock">
<div class="title">Example 100. pom.xml with drools-compiler and multidex</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-android&lt;/artifactId&gt;
    &lt;exclusions&gt;
      &lt;exclusion&gt;
        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;exclusions&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
         &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;xmlpull&lt;/groupId&gt;
         &lt;artifactId&gt;xmlpull&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;xpp3&lt;/groupId&gt;
         &lt;artifactId&gt;xpp3_min&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
         &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.eclipse.jdt.core.compiler&lt;/groupId&gt;
         &lt;artifactId&gt;ecj&lt;/artifactId&gt;
      &lt;/exclusion&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;compile-kbase&lt;/id&gt;
          &lt;goals&gt;
            &lt;goal&gt;build&lt;/goal&gt;
          &lt;/goals&gt;
          &lt;phase&gt;compile&lt;/phase&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;com.simpligility.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;android-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;4.2.1&lt;/version&gt;
      &lt;extensions&gt;true&lt;/extensions&gt;
      &lt;configuration&gt;
        &lt;sdk&gt;
          &lt;platform&gt;21&lt;/platform&gt;
        &lt;/sdk&gt;
        &lt;dex&gt;
          &lt;coreLibrary&gt;true&lt;/coreLibrary&gt;
          &lt;jvmArguments&gt;&lt;jvmArgument&gt;-Xmx2048m&lt;/jvmArgument&gt;&lt;/jvmArguments&gt;
          &lt;multiDex&gt;true&lt;/multiDex&gt;
          &lt;mainDexList&gt;maindex.txt&lt;/mainDexList&gt;
        &lt;/dex&gt;
        &lt;extractDuplicates&gt;true&lt;/extractDuplicates&gt;
        &lt;apk&gt;
          &lt;metaInf&gt;
            &lt;includes&gt;
              &lt;include&gt;services/**&lt;/include&gt;
              &lt;include&gt;kmodule.*&lt;/include&gt;
              &lt;include&gt;HelloKB/**&lt;/include&gt;
              &lt;include&gt;drools**&lt;/include&gt;
              &lt;include&gt;maven/${project.groupId}/${project.artifactId}/**&lt;/include&gt;
            &lt;/includes&gt;
          &lt;/metaInf&gt;
        &lt;/apk&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_roboguice"><a class="anchor" href="#_integration_with_roboguice"></a><a class="link" href="#_integration_with_roboguice">12.2. Integration with Roboguice</a></h3>
<div class="sect3">
<h4 id="_pre_serialized_rules_with_roboguice"><a class="anchor" href="#_pre_serialized_rules_with_roboguice"></a><a class="link" href="#_pre_serialized_rules_with_roboguice">12.2.1. Pre-serialized Rules with Roboguice</a></h4>
<div class="paragraph">
<p>With Roboguice pre-serialized KIE bases can be injected using the @KBase annotation.</p>
</div>
<div class="sect4">
<h5 id="_annotations_3"><a class="anchor" href="#_annotations_3"></a><a class="link" href="#_annotations_3">12.2.1.1. Annotations</a></h5>
<div class="paragraph">
<p>@KBase supports an optional 'name' attribute.
CDI typically does "getOrCreate" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instances for that name will be identity equals.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kbase_3"><a class="anchor" href="#_kbase_3"></a><a class="link" href="#_kbase_3">12.2.1.2. @KBase</a></h5>
<div class="paragraph">
<p>The default argument maps to the value attribute and specifies the name of the KieBase from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects KieBase by name from pre-serialized resource</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase("kbase1")
private KieBase kbase;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_androidmanifest_xml_configuration"><a class="anchor" href="#_androidmanifest_xml_configuration"></a><a class="link" href="#_androidmanifest_xml_configuration">12.2.1.3. AndroidManifest.xml configuration</a></h5>
<div class="paragraph">
<p>The Roboguice module needs to be specified in the manifest.</p>
</div>
<div class="exampleblock">
<div class="title">Example 101. Roboguice manifest with pre-serialized KIE base</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;application
   android:largeHeap="true"
   android:allowBackup="true"
   android:icon="@drawable/ic_launcher"
   android:label="@string/app_name"
   android:theme="@style/AppTheme"&gt;
      &lt;meta-data
         android:name="roboguice.modules"
         android:value="org.drools.android.roboguice.DroolsModule"/&gt;
      &lt;activity
         android:label="@string/app_name"
         android:name="org.drools.examples.android.SplashActivity"&gt;
      &lt;intent-filter&gt;
         &lt;action android:name="android.intent.action.MAIN"/&gt;
         &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
      &lt;/intent-filter&gt;
   &lt;/activity&gt;
&lt;/application&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiecontainer_with_drools_compiler_dependency_and_roboguice"><a class="anchor" href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice"></a><a class="link" href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice">12.2.2. KieContainer with drools-compiler dependency and Roboguice</a></h4>
<div class="paragraph">
<p>With Roboguice and drools-compiler almost the full CDI syntax can be used to inject KieContainers, KieBases, and KieSessions.</p>
</div>
<div class="sect4">
<h5 id="_annotations_4"><a class="anchor" href="#_annotations_4"></a><a class="link" href="#_annotations_4">12.2.2.1. Annotations</a></h5>
<div class="paragraph">
<p>@KContainer, @KBase and @KSession all support an optional 'name' attribute.
CDI typically does "getOrCreate" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instance for that name will be identity equals.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kcontainer_3"><a class="anchor" href="#_kcontainer_3"></a><a class="link" href="#_kcontainer_3">12.2.2.2. @KContainer</a></h5>
<div class="listingblock">
<div class="title">Injects Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kbase_4"><a class="anchor" href="#_kbase_4"></a><a class="link" href="#_kbase_4">12.2.2.3. @KBase</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects KieBase by name from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KBase("kbase1")
private KieBase kbase;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_kiesession_3"><a class="anchor" href="#_ksession_for_kiesession_3"></a><a class="link" href="#_ksession_for_kiesession_3">12.2.2.4. @KSession for KieSession</a></h5>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects StatelessKieSession by name from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
private KieSession ksession;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_statelesskiesession_3"><a class="anchor" href="#_ksession_for_statelesskiesession_3"></a><a class="link" href="#_ksession_for_statelesskiesession_3">12.2.2.5. @KSession for StatelessKieSession</a></h5>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects StatelessKieSession by name from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
private StatelessKieSession ksession;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_androidmanifest_xml_configuration_2"><a class="anchor" href="#_androidmanifest_xml_configuration_2"></a><a class="link" href="#_androidmanifest_xml_configuration_2">12.2.2.6. AndroidManifest.xml configuration</a></h5>
<div class="paragraph">
<p>The Roboguice module needs to be specified in the manifest.</p>
</div>
<div class="exampleblock">
<div class="title">Example 102. Roboguice manifest configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;application
   android:largeHeap="true"
   android:allowBackup="true"
   android:icon="@drawable/ic_launcher"
   android:label="@string/app_name"
   android:theme="@style/AppTheme"&gt;
   &lt;meta-data
      android:name="roboguice.modules"
      android:value="org.drools.android.roboguice.DroolsContainerModule"/&gt;
   &lt;activity
      android:label="@string/app_name"
      android:name="org.drools.examples.android.SplashActivity"&gt;
      &lt;intent-filter&gt;
         &lt;action android:name="android.intent.action.MAIN"/&gt;
         &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
      &lt;/intent-filter&gt;
   &lt;/activity&gt;
&lt;/application&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.camel"><a class="anchor" href="#_ch.camel"></a><a class="link" href="#_ch.camel">13. Apache Camel Integration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_camel"><a class="anchor" href="#_camel"></a><a class="link" href="#_camel">13.1. Camel</a></h3>
<div class="paragraph">
<p>Camel provides a light weight bus framework for getting information into and out of Drools.</p>
</div>
<div class="paragraph">
<p>Drools introduces two elements to make easy integration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Drools Policy</p>
<div class="paragraph">
<p>Augments any JAXB or XStream data loaders.
For JAXB it adds drools related paths to the contextpath, for XStream it adds custom converters and aliases for Drools classes.
It also handles setting the ClassLoader to the targeted ksession.</p>
</div>
</li>
<li>
<p>Drools Endpoint</p>
<div class="paragraph">
<p>Executes the payload against the specified drools session</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools can be configured like any normal camel component, but notice the policy that wraps the drools related segments.
This will route all payloads to ksession1</p>
</div>
<div class="exampleblock">
<div class="title">Example 103. Drools Endpoint configured with the CXFRS producer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;
            &lt;to uri="kie:ksession1" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is possible to not specify the session in the drools endpoint uri, and instead "multiplex" based on an attribute or header.
In this example the policy will check either the header field "DroolsLookup" for the named session to execute and if that isn&#8217;t specified it&#8217;ll check the "lookup" attribute on the incoming payload.</p>
</div>
<div class="exampleblock">
<div class="title">Example 104. Drools Endpoint configured with the CXFRS producer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;
            &lt;to uri="kie:dynamic" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 105. Java Code to execute against Route from a Spring and CamelContext</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public class MyTest extends CamelSpringTestSupport {

    @Override
    protected AbstractXmlApplicationContext createApplicationContext() {
        return new ClassPathXmlApplicationContext("org/drools/camel/component/CxfRsSpring.xml");
    }

    public void test1() throws Exception {
        String cmd = "";
        cmd += "&lt;batch-execution lookup=\"ksession1\"&gt;\n";
        cmd += "  &lt;insert out-identifier=\"salaboy\"&gt;\n";
        cmd += "      &lt;org.drools.pipeline.camel.Person&gt;\n";
        cmd += "         &lt;name&gt;salaboy&lt;/name&gt;\n";
        cmd += "      &lt;/org.drools.pipeline.camel.Person&gt;\n";
        cmd += "   &lt;/insert&gt;\n";
        cmd += "   &lt;fire-all-rules/&gt;\n";
        cmd += "&lt;/batch-execution&gt;\n";

        Object object = this.context.createProducerTemplate().requestBody("direct://client", cmd);
        System.out.println( object );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following urls show sample script examples for jaxb, xstream and json marshalling using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/json.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/json.mvt?r=HEAD</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.server"><a class="anchor" href="#_ch.server"></a><a class="link" href="#_ch.server">14. Drools Camel Server</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a><a class="link" href="#_introduction_3">14.1. Introduction</a></h3>
<div class="paragraph">
<p>The drools camel server (drools-camel-server) module is a war which you can deploy to execute KnowledgeBases remotely for any sort of client application.
This is not limited to JVM application clients, but any technology that can use HTTP, through a REST interface.
This version of the execution server supports stateless and stateful sessions in a native way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment"><a class="anchor" href="#_deployment"></a><a class="link" href="#_deployment">14.2. Deployment</a></h3>
<div class="paragraph">
<p>Drools Camel Server is a war file, which can be deployed in a application server (such as JBoss AS). As the service is stateless, it is possible to have as many of these services deployed as you need to serve the client load.
Deploy on JBoss AS 4.x / Tomcat 6.x works out-of-the-box, instead some external dependencies must be added and the configuration must be changed to be deployed in JBoss AS 5</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">14.3. Configuration</a></h3>
<div class="paragraph">
<p>Inside the war file you will find a few XML configuration files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>beans.xml</p>
<div class="ulist">
<ul>
<li>
<p>Skeleton XML that imports knowledge-services.xml and camel-server.xml</p>
</li>
</ul>
</div>
</li>
<li>
<p>camel-server.xml</p>
<div class="ulist">
<ul>
<li>
<p>Configures CXF endpoints with Camel Routes</p>
</li>
<li>
<p>Came Routes pipeline messages to various configured knowledge services</p>
</li>
</ul>
</div>
</li>
<li>
<p>knowledge-services.xml</p>
<div class="ulist">
<ul>
<li>
<p>Various KIE bases and Sessions</p>
</li>
</ul>
</div>
</li>
<li>
<p>camel-client.xml</p>
<div class="ulist">
<ul>
<li>
<p>Sample camel client showing how to send and receive a message</p>
</li>
<li>
<p>Used by "out of the box" test.jsp</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_restcamel_services_configuration"><a class="anchor" href="#_restcamel_services_configuration"></a><a class="link" href="#_restcamel_services_configuration">14.3.1. REST/Camel Services configuration</a></h4>
<div class="paragraph">
<p>The next step is configure the services that are going to be exposed through drools-server.
You can modify this configuration in camel-server.xml file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:cxf="http://camel.apache.org/schema/cxf"
  xmlns:jaxrs="http://cxf.apache.org/jaxrs"
  xsi:schemaLocation="
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
  http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
  http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;

&lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
&lt;import resource="classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml"/&gt;
&lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt;

  &lt;!--
   !   If you are running on JBoss you will need to copy a camel-jboss.jar into the lib and set this ClassLoader configuration
   !  http://camel.apache.org/camel-jboss.html
   !   &lt;bean id="jbossResolver" class="org.apache.camel.jboss.JBossPackageScanClassResolver"/&gt;
   --&gt;

  &lt;!--
   !   Define the server end point.
   !   Copy and paste this element, changing id and the address, to expose services on different urls.
   !   Different Camel routes can handle different end point paths.
   --&gt;
  &lt;cxf:rsServer id="rsServer"
                address="/rest"
                serviceClass="org.kie.jax.rs.CommandExecutorImpl"&gt;
       &lt;cxf:providers&gt;
           &lt;bean class="org.kie.jax.rs.CommandMessageBodyReader"/&gt;
       &lt;/cxf:providers&gt;
  &lt;/cxf:rsServer&gt;

  &lt;cxf:cxfEndpoint id="soapServer"
            address="/soap"
             serviceName="ns:CommandExecutor"
             endpointName="ns:CommandExecutorPort"
          wsdlURL="soap.wsdl"
          xmlns:ns="http://soap.jax.drools.org/" &gt;
    &lt;cxf:properties&gt;
      &lt;entry key="dataFormat" value="MESSAGE"/&gt;
      &lt;entry key="defaultOperationName" value="execute"/&gt;
    &lt;/cxf:properties&gt;
  &lt;/cxf:cxfEndpoint&gt;

  &lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;
  &lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

  &lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
    &lt;!--
     ! Routes incoming messages from end point id="rsServer".
     ! Example route unmarshals the messages with xstream and executes against ksession1.
     ! Copy and paste this element, changing marshallers and the 'to' uri, to target different sessions, as needed.
     !--&gt;

    &lt;route&gt;
       &lt;from uri="cxfrs://bean://rsServer"/&gt;
       &lt;policy ref="kiePolicy"&gt;
         &lt;unmarshal ref="xstream" /&gt;
         &lt;to uri="kie:ksession1" /&gt;
         &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;

    &lt;route&gt;
      &lt;from uri="cxf://bean://soapServer"/&gt;
      &lt;policy ref="kiePolicy"&gt;
        &lt;unmarshal ref="xstream" /&gt;
        &lt;to uri="kie:ksession1" /&gt;
        &lt;marshal ref="xstream" /&gt;
      &lt;/policy&gt;
    &lt;/route&gt;

  &lt;/camelContext&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_restful_service_endpoint_creation"><a class="anchor" href="#_restful_service_endpoint_creation"></a><a class="link" href="#_restful_service_endpoint_creation">14.3.1.1. RESTful service endpoint creation</a></h5>
<div class="paragraph">
<p>In the next XML snippet code we are creating a RESTful (JAX-RS) endpoint bound to /kservice/rest address and using org.drools.jax.rs.CommandExecutorImpl as the service implementer.
This class is only used to instantiate the service endpoint because all the internal implementation is managed by Camel, and you can see in the source file that the exposed execute service must be never called.</p>
</div>
<div class="paragraph">
<p>Also a JAX-RS Provider is provided to determine if the message transported can be processed in this service endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cxf:rsServer id="rsServer"
              address="/rest"
              serviceClass="org.kie.jax.rs.CommandExecutorImpl"&gt;
     &lt;cxf:providers&gt;
         &lt;bean class="org.kie.jax.rs.CommandMessageBodyReader"/&gt;
     &lt;/cxf:providers&gt;
&lt;/cxf:rsServer&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ideally this configuration doesn&#8217;t need to be modified, at least the Service Class and the JAX-RS Provider, but you can add more endpoints associated to different addresses to use them in other Camel Routes.</p>
</div>
<div class="paragraph">
<p>After all this initial configuration, you can start config your own Knowledge Services.</p>
</div>
</div>
<div class="sect4">
<h5 id="_camel_kie_policy_context_creation"><a class="anchor" href="#_camel_kie_policy_context_creation"></a><a class="link" href="#_camel_kie_policy_context_creation">14.3.1.2. Camel Kie Policy &amp; Context creation</a></h5>
<div class="paragraph">
<p>KiePolicy is used to add Drools support in Camel, basically what it does is to add interceptors into the camel route to create Camel Processors on the fly and modify the internal navigation route.
If you want to have SOAP support you need to create your custom Drools Policy, but it&#8217;s going to be added in the next release.</p>
</div>
<div class="paragraph">
<p>But you don&#8217;t need to know more internal details, only instantiate this bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next is create the camel route that will have the responsibility to execute the commands sent through JAX-RS.
Basically we create a route definition associated with the JAX-RS definition as the data input, the camel policy to be used and inside the &#8220;execution route&#8221; or ProcessorDefinitions.
As you can see, we set XStream as the marshaller/unmarshaller and the drools execution route definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
      &lt;policy ref="kiePolicy"&gt;
        &lt;unmarshal ref="xstream" /&gt;
        &lt;to uri="kie:ksession1" /&gt;
        &lt;marshal ref="xstream" /&gt;
      &lt;/policy&gt;
   &lt;/route&gt;
   &lt;route&gt;
     &lt;from uri="cxf://bean://soapServer"/&gt;
     &lt;policy ref="kiePolicy"&gt;
       &lt;unmarshal ref="xstream" /&gt;
       &lt;to uri="kie:ksession1" /&gt;
       &lt;marshal ref="xstream" /&gt;
     &lt;/policy&gt;
   &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The drools endpoint creation has the next arguments</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;to uri="kie:{1}/{2}" /&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execution Node identifier that is registered in the CamelContext</p>
</li>
<li>
<p>KIE session identifier that was registered in the Execution Node with identifier {1}</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both parameters are configured in knowledge-services.xml file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_knowledge_services_configuration"><a class="anchor" href="#_knowledge_services_configuration"></a><a class="link" href="#_knowledge_services_configuration">14.3.1.3. Knowledge Services configuration</a></h5>
<div class="paragraph">
<p>The next step is create the KIE sessions that you are going to use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:kie="http://drools.org/schema/kie-spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                          http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"&gt;

  &lt;kie:kmodule id="drools-camel-server"&gt;
    &lt;kie:kbase name="kbase1" packages="org.drools.server"&gt;
      &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;/kie:kbase&gt;
  &lt;/kie:kmodule&gt;

  &lt;bean id="kiePostProcessor"
            class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The execution-node is a context for registered kbases and ksessions, here kbase1 and ksession1 are placed in the node1 context.
The kbase itself consists of two knowledge definitions, a DRL and an XSD.
The Spring documentation contains a lot more information on configuring these knowledge services.</p>
</div>
</div>
<div class="sect4">
<h5 id="_test"><a class="anchor" href="#_test"></a><a class="link" href="#_test">14.3.1.4. Test</a></h5>
<div class="paragraph">
<p>With drools-server war unzipped you should be able to see a test.jsp and run it.
This example just executes a simple "echo" type application.
It sends a message to the rule server that pre-appends the word "echo" to the front and sends it back.
By default the message is "Hello World", different messages can be passed using the url parameter msg - test.jsp?msg="My Custom Message".</p>
</div>
<div class="paragraph">
<p>Under the hood the jsp invokes the Test.java class, this then calls out to Camel which is where the meet happens.
The camel-client.xml defines the client with just a few lines of XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;
&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
  &lt;route&gt;
     &lt;from uri="direct://kservice/rest"/&gt;
     &lt;policy ref="kiePolicy"&gt;
       &lt;to uri="cxfrs://http://localhost:8080/drools-server/kservice/rest"/&gt;
     &lt;/policy&gt;
  &lt;/route&gt;
  &lt;route&gt;
    &lt;from uri="direct://kservice/soap"/&gt;
    &lt;policy ref="kiePolicy"&gt;
      &lt;to uri="cxfrs://http://localhost:8080/drools-server/kservice/soap"/&gt;
    &lt;/policy&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>"direct://kservice" is just a named hook, allowing Java to grab a reference and push data into it.
In this example the data is already in XML, so we don&#8217;t need to add any <code>DataFormat</code>s to do the marshalling.
The KiePolicy adds some smarts to the route and you&#8217;ll see it used on the server side too.
If JAXB or XStream were used, it would inject custom paths and converters, it can also set the ClassLoader too on the server side, on the client side it automatically unwraps the Response object.</p>
</div>
<div class="paragraph">
<p>The rule itself can be found here: test.drl.
Notice the type Message is declared part of the DRL and is thus not present on the Classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Message
   text : String
end


rule "echo"
when
   $m : Message();
then
   $m.text = "echo:" + $m.text;
end</code></pre>
</div>
</div>
<h1 id="_business_central" class="discrete">Business Central</h1>
<div class="paragraph">
<p>Business Central in Drools is built with the UberFire framework and uses the Guvnor plugin. Drools provides an
additional rich set of plugins for rule-authoring metaphors.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wb.workbench"><a class="anchor" href="#_wb.workbench"></a><a class="link" href="#_wb.workbench">15. Business Central (General)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wb.installation"><a class="anchor" href="#_wb.installation"></a><a class="link" href="#_wb.installation">15.1. Installation</a></h3>
<div class="sect3">
<h4 id="_wb.warinstallation"><a class="anchor" href="#_wb.warinstallation"></a><a class="link" href="#_wb.warinstallation">15.1.1. War installation</a></h4>
<div class="paragraph">
<p>Use the <code>war</code> from the Business Central distribution zip that corresponds to your application server.
The differences between these <code>war</code> files are mainly superficial.
For example, some JARs might be excluded if the application server already supplies them.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>eap7</code>: tailored for Red Hat JBoss Enterprise Application Platform 7</p>
</li>
<li>
<p><code>wildfly14</code>: tailored for Wildfly 14</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wb.workbenchdata"><a class="anchor" href="#_wb.workbenchdata"></a><a class="link" href="#_wb.workbenchdata">15.1.2. Business Central data</a></h4>
<div class="paragraph">
<p>Business Central stores its data, by default in the directory <code>$WORKING_DIRECTORY/.niogit</code>, for example <code>wildfly-14.0.1.Final/bin/.niogit</code>, but it can be overridden with the <a href="#_wb.systemproperties">system property</a><code>-Dorg.uberfire.nio.git.dir</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In production, make sure to back up the Business Central data directory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_wb.troubleshooting"><a class="anchor" href="#_wb.troubleshooting"></a><a class="link" href="#_wb.troubleshooting">15.1.3. Trouble shooting</a></h4>
<div class="sect4">
<h5 id="_wb.troubleshootingloadingspinner"><a class="anchor" href="#_wb.troubleshootingloadingspinner"></a><a class="link" href="#_wb.troubleshootingloadingspinner">15.1.3.1. Loading.. does not disappear and Business Central fails to show</a></h5>
<div class="paragraph">
<p>There have been reports that Firewalls in between the server and the browser can interfere with Server Sent Events (SSE) used by Business Central.</p>
</div>
<div class="paragraph">
<p>The issue results in the "Loading&#8230;&#8203;" spinner remaining visible and Business Central failing to materialize.</p>
</div>
<div class="paragraph">
<p>The workaround is to disable the Business Central&#8217;s use of Server Sent Events by adding file <code>/WEB-INF/classes/ErraiService.properties</code> to the exploded WAR containing the value <code>errai.bus.enable_sse_support=false</code>.
Re-package the WAR and re-deploy.</p>
</div>
<div class="paragraph">
<p>Some Users have also reported disabling Server Sent Events does not resolve the issue. The solution found to work is to configure the JVM to use a different Entropy Gathering Device on Linux for <code>SecureRandom</code>. This can be configured by setting System Property <code>java.security.egd</code> to <code>file:/dev/./urandom</code>. See <a href="http://stackoverflow.com/questions/33166198/kie-workbench-not-loading-after-login/39110177#39110177">this</a>  Stack Overflow post for details.</p>
</div>
<div class="paragraph">
<p>Please note however this affects the JVM&#8217;s random  number generation and may present other challenges where strong cryptography is required. Configure with caution.</p>
</div>
</div>
<div class="sect4">
<h5 id="_not_able_to_clone_business_central_git_repository_using_ssh_protocol"><a class="anchor" href="#_not_able_to_clone_business_central_git_repository_using_ssh_protocol"></a><a class="link" href="#_not_able_to_clone_business_central_git_repository_using_ssh_protocol">15.1.3.2. Not able to clone Business Central Git repository using ssh protocol.</a></h5>
<div class="paragraph">
<p>Git clients using ssh to interact with the Git server that is bundled with Business Central are authenticated and authorized to perform git commands by the security API that is part of the Uberfire backend server.  When using an LDAP security realm, some git clients were not being authorized as expected.  This was due to the fact that for non-web clients such as Git via ssh, the principal (i.e., user or group) name assigned to a user by the application server&#8217;s user registry is the more complex DN associated to that principal by LDAP. The logic of the Uberfire backend server looked for on exact match of roles allowed with the principal name returned and therefore failed.</p>
</div>
<div class="paragraph">
<p>It is now possible to control the role-principal matching via the system property</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-property hljs" data-lang="property">org.uberfire.ldap.regex.role_mapper</code></pre>
</div>
</div>
<div class="paragraph">
<p>which takes as its value a Regex pattern to be applied when matching LDAP principal to role names.  The pattern must contain the literal word variable 'role'.  During authorization the variable is replaced by each of the allow application roles.  If the pattern is matched the role is added to the user.</p>
</div>
<div class="paragraph">
<p>For instance, if the DN for the admin group in LDAP is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-property hljs" data-lang="property">DN: cn=admin,ou=groups,dc=example,dc=com</code></pre>
</div>
</div>
<div class="paragraph">
<p>and its intended role is admin, then setting <code>org.uberfire.ldap.regex.role_mapper</code> with value</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-regex hljs" data-lang="regex">cn[\\ ]*=[\\ ]*role</code></pre>
</div>
</div>
<div class="paragraph">
<p>will find a match on role 'admin'.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="business-central-system-properties-ref"><a class="anchor" href="#business-central-system-properties-ref"></a><a class="link" href="#business-central-system-properties-ref">15.2. Business Central system properties</a></h3>
<div class="paragraph">
<p>The Business Central system properties listed in this section are passed to <code>standalone*.xml</code> files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.uberfire.nio.git.dir</code>: Location of the KIE Server Git directory.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.dirname</code>: Name of the KIE Server Git directory. Default value: <code>.niogit</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.proxy.ssh.over.http</code>: Specifies whether SSH should use an HTTP proxy. Default value: <code>false</code>.</p>
</li>
<li>
<p><code>http.proxyHost</code>: Defines the host name of the HTTP proxy. Default value: <code>null</code>.</p>
</li>
<li>
<p><code>http.proxyPort</code>: Defines the host port (integer value) of the HTTP proxy. Default value: <code>null</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.proxy.ssh.over.https</code>: Specifies whether SSH should use an HTTPS proxy. Default value: <code>false</code>.</p>
</li>
<li>
<p><code>https.proxyHost</code>: Defines the host name of the HTTPS proxy. Default value: <code>null</code>.</p>
</li>
<li>
<p><code>https.proxyPort</code>: Defines the host port (integer value) of the HTTPS proxy. Default value: <code>null</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.enabled</code>: Enables or disables the HTTP daemon. Default value: <code>true</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.host</code>: If the HTTP daemon is enabled, it uses this property as the host identifier. This is an informative property that is used to display how to access the Git repository over HTTP.  The HTTP still relies on the servlet container. Default value: <code>localhost</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.hostname</code>: If the HTTP daemon is enabled, it uses this property as the host name identifier. This is an informative property that is used to display how to access the Git repository over HTTP.  The HTTP still relies on the servlet container. Default value: <code>localhost</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.port</code>: If the HTTP daemon is enabled, it uses this property as the port number. This is an informative property that is used to display how to access the Git repository over HTTP.  The HTTP still relies on the servlet container. Default value: <code>8080</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.enabled</code>: Enables or disables the HTTPS daemon. Default value: <code>false</code></p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.host</code>: If the HTTPS daemon is enabled, it uses this property as the host identifier. This is an informative property that is used to display how to access the Git repository over HTTPS.  The HTTPS still relies on the servlet container. Default value: <code>localhost</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.hostname</code>: If the HTTPS daemon is enabled, it uses this property as the host name identifier. This is an informative property that is used to display how to access the Git repository over HTTPS.  The HTTPS still relies on the servlet container. Default value: <code>localhost</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.port</code>: If the HTTPS daemon is enabled, it uses this property as the port number. This is an informative property that is used to display how to access the Git repository over HTTPS.  The HTTPS still relies on the servlet container. Default value: <code>8080</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.enabled</code>: Enables or disables the Git daemon. Default value: <code>true</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.host</code>: If the Git daemon is enabled, it uses this property as the local host identifier. Default value: <code>localhost</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.hostname</code>: If the Git daemon is enabled, it uses this property as the local host name identifier. Default value: <code>localhost</code></p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.port</code>: If the Git daemon is enabled, it uses this property as the port number. Default value: <code>9418</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.sslVerify</code>: Enables or disables SSL certificate checking for Git repositories. Default value: <code>true</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the default or assigned port is already in use, a new port is automatically selected. Ensure that the ports are available and check the log for more information.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.enabled</code>: Enables or disables the SSH daemon. Default value: <code>true</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.host</code>: If the SSH daemon enabled, it uses this property as the local host identifier. Default value: <code>localhost</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.hostname</code>: If the SSH daemon is enabled, it uses this property as local host name identifier. Default value: <code>localhost</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.port</code>: If the SSH daemon is enabled, it uses this property as the port number. Default value: <code>8001</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the default or assigned port is already in use, a new port is automatically selected. Ensure that the ports are available and check the log for more information.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.cert.dir</code>: Location of the <code>.security</code> directory where local certificates are stored. Default value: Working directory.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.passphrase</code>: Pass phrase used to access the public key store of your operating system when cloning git repositories with SCP style URLs. Example: <code>git@github.com:user/repository.git</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.algorithm</code>: Algorithm used by SSH. Default value: <code>RSA</code>.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.ciphers</code>: A comma-separated string of ciphers. The available ciphers are <code>aes128-ctr</code>, <code>aes192-ctr</code>, <code>aes256-ctr</code>, <code>arcfour128</code>, <code>arcfour256</code>, <code>aes192-cbc</code>, <code>aes256-cbc</code>. If the property is not used, all available ciphers are loaded.</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.macs</code>: A comma-separated string of message authentication codes (MACs). The available MACs are <code>hmac-md5</code>, <code>hmac-md5-96</code>, <code>hmac-sha1</code>, <code>hmac-sha1-96</code>, <code>hmac-sha2-256</code>, <code>hmac-sha2-512</code>. If the property is not used, all available MACs are loaded.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you plan to use RSA or any algorithm other than DSA, make sure you set up your application server to use the Bouncy Castle JCE library.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>org.uberfire.metadata.index.dir</code>: Place where the Lucene <code>.index</code> directory is stored. Default value: Working directory.</p>
</li>
<li>
<p><code>org.uberfire.ldap.regex.role_mapper</code>: Regex pattern used to map LDAP principal names to the application role name. Note that the variable role must be part of the pattern because it is substituted by the application role name when matching a principal value to a role name.</p>
</li>
<li>
<p><code>org.uberfire.sys.repo.monitor.disabled</code>: Disables the configuration monitor. Do not disable unless you are sure. Default value: <code>false</code>.</p>
</li>
<li>
<p><code>org.uberfire.secure.key</code>: Password used by password encryption. Default value: <code>org.uberfire.admin</code>.</p>
</li>
<li>
<p><code>org.uberfire.secure.alg</code>: Crypto algorithm used by password encryption. Default value: <code>PBEWithMD5AndDES</code>.</p>
</li>
<li>
<p><code>org.uberfire.domain</code>: Security-domain name used by uberfire. Default value: <code>ApplicationRealm</code>.</p>
</li>
<li>
<p><code>org.guvnor.m2repo.dir</code>: Place where the Maven repository folder is stored. Default value: <code>&lt;working-directory&gt;/repositories/kie</code>.</p>
</li>
<li>
<p><code>org.guvnor.project.gav.check.disabled</code>: Disables group ID, artifact ID, and version (GAV) checks. Default value: <code>false</code>.</p>
</li>
<li>
<p><code>org.kie.build.disable-project-explorer</code>: Disables automatic build of a selected project in Project Explorer. Default value: <code>false</code>.</p>
</li>
<li>
<p><code>org.kie.verification.disable-dtable-realtime-verification</code>: Disables the real-time validation and verification of decision tables. Default value: <code>false</code>.</p>
</li>
<li>
<p><code>org.kie.server.controller</code>: The URL is used to connect with the Drools controller. For example, <code>ws://localhost:8080/business-central/websocket/controller</code>.</p>
</li>
<li>
<p><code>org.kie.server.user</code>: User name used to connect with the KIE Server nodes from the Drools controller. This property is only required when using this Business Central installation as a Drools controller.</p>
</li>
<li>
<p><code>org.kie.server.pwd</code>: Password used to connect with the KIE Server nodes from the Drools controller. This property is only required when using this Business Central installation as a Drools controller.</p>
</li>
<li>
<p><code>kie.maven.offline.force</code>: Forces Maven to behave as offline. If true, disable online dependency resolution. Default value: <code>false</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use this property for Business Central only. If you share a runtime environment with any other component, isolate the configuration and apply it only to Business Central.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>org.uberfire.gzip.enable</code>: Enables or disables Gzip compression on GzipFilter. Default value: <code>true</code>.</p>
</li>
<li>
<p><code>org.kie.workbench.profile</code>: Selects the Business Central profile. Possible values are <code>FULL</code> or <code>PLANNER_AND_RULES</code>. A prefix <code>FULL_</code> will set the profile and hide the profile preferences from the admin preferences. Default value: <code>FULL</code></p>
</li>
<li>
<p><code>org.appformer.m2repo.url</code>: Business Central uses the default location of the Maven repository when looking for dependencies. It points to the Maven repository inside Business Central. For example, <code>http://localhost:8080/business-central/maven2</code>. Set this property before starting up Business Central. Default value: File path to the inner <code>m2</code> repository.</p>
</li>
<li>
<p><code>appformer.ssh.keystore</code>: Defines the custom SSH keystore to be used with Business Central by specifying a class name. If the property is not available, the default SSH keystore is used.</p>
</li>
<li>
<p><code>appformer.ssh.keys.storage.folder</code>: When using the default SSH keystore, this property defines the storage folder for the users SSH public keys. If the property is not available, the keys are stored in Business Central <code>.security</code> folder.</p>
</li>
<li>
<p><code>appformer.experimental.features</code>: Enables the Experimental Features Framework.</p>
</li>
<li>
<p><code>org.kie.demo</code>: Enables external clone of a demo application from GitHub.</p>
</li>
<li>
<p><code>org.kie.workbench.controller</code>: The URL is used to connect with the Drools controller. For example, <code>ws://localhost:8080/kie-server-controller/websocket/controller</code>.</p>
</li>
<li>
<p><code>org.kie.workbench.controller.user</code>: The user name is used to connect with the Drools controller. Default value: kieserver.</p>
</li>
<li>
<p><code>org.kie.workbench.controller.pwd</code>: The password is used to connect with the Drools controller. Default value: kieserver1!.</p>
</li>
<li>
<p><code>org.kie.workbench.controller.token</code>: The token string is used to connect with the Drools controller.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about how to use token based authentication, see <a href="#usingTokenBasedAuthentication">Using token based authentication</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>kie.keystore.keyStoreURL</code>: The URL is used to load a Java Cryptography Extension KeyStore (JCEKS). For example, <code>file:///home/kie/keystores/keystore.jceks.</code></p>
</li>
<li>
<p><code>kie.keystore.keyStorePwd</code>: The password is used for the JCEKS.</p>
</li>
<li>
<p><code>kie.keystore.key.ctrl.alias</code>: The alias of the key for default REST Drools controller.</p>
</li>
<li>
<p><code>kie.keystore.key.ctrl.pwd</code>: The password of an alias for default REST Drools controller.</p>
</li>
<li>
<p><code>org.jbpm.wb.forms.renderer.ext</code>: Switches the form rendering between Business Central and KIE Server. By default, the form rendering is done by Business Central. Default value: <code>false</code>.</p>
</li>
<li>
<p><code>org.jbpm.wb.forms.renderer.name</code>: This property allows to switch between Business Central and KIE Server rendered forms. Default value: <code>workbench</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_wb.quickstart"><a class="anchor" href="#_wb.quickstart"></a><a class="link" href="#_wb.quickstart">15.3. Quick Start</a></h3>
<div class="paragraph">
<p>These steps help you get started with minimum of effort.</p>
</div>
<div class="paragraph">
<p>They should not be a substitute for reading the documentation in full.</p>
</div>
<div class="sect3">
<h4 id="_wb.quickstartimportexamples"><a class="anchor" href="#_wb.quickstartimportexamples"></a><a class="link" href="#_wb.quickstartimportexamples">15.3.1. Importing examples</a></h4>
<div class="openblock">
<div class="title">Import Examples - Quick install examples</div>
<div class="content">
<div class="paragraph">
<p>If Business Central is empty you are shown an empty Space page. Clicking "Try Samples" button below will show the examples that are available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-example1.png" alt="QuickStart example1">
</div>
</div>
<div class="paragraph">
<p>Once "Try Samples" page opens, you can select one or more examples and click "Ok".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-example2.png" alt="QuickStart example2">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If Business Central already contains Projects the examples can be imported with the "Try Samples" button found from the menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-import-with-pre-existing-projects.png" alt="QuickStart import with pre existing projects">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartaddproject"><a class="anchor" href="#_wb.quickstartaddproject"></a><a class="link" href="#_wb.quickstartaddproject">15.3.2. Add Project</a></h4>
<div class="paragraph">
<p>Alternatively, to importing an example, a new empty project can be created from the Space page with "Add Project".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-example1.png" alt="QuickStart example1">
</div>
<div class="title">Figure 144. New Project button</div>
</div>
<div class="paragraph">
<p>Give the Project a name and optional description.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-new-project-wizard.png" alt="QuickStart new project wizard">
</div>
<div class="title">Figure 145. Giving Project a name</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartdefinedatamodel"><a class="anchor" href="#_wb.quickstartdefinedatamodel"></a><a class="link" href="#_wb.quickstartdefinedatamodel">15.3.3. Define Data Model</a></h4>
<div class="paragraph">
<p>After a Project has been created you need to define Types to be used by your rules.</p>
</div>
<div class="paragraph">
<p>Select "Data Object" from the "Add Asset" menu.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use types contained in existing JARs.</p>
</div>
<div class="paragraph">
<p>Please consult the full documentation for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-a-data-model.png" alt="QuickStart create a data model">
</div>
<div class="title">Figure 146. Creating "Data Object"</div>
</div>
<div class="paragraph">
<p>Set the name and select a package for the new type.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-data-object-popup.png" alt="QuickStart create data object popup">
</div>
<div class="title">Figure 147. Creating a new type</div>
</div>
<div class="paragraph">
<p>Click "+ add field" button and set a field name and type and click "Create" to create a field for the type.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-field.png" alt="QuickStart create field">
</div>
<div class="title">Figure 148. Click "Create" and add the field</div>
</div>
<div class="paragraph">
<p>Click "Save" to update the model.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-confirm-save.png" alt="QuickStart confirm save">
</div>
<div class="title">Figure 149. Clicking "Save"</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartdefinerule"><a class="anchor" href="#_wb.quickstartdefinerule"></a><a class="link" href="#_wb.quickstartdefinerule">15.3.4. Define Rule</a></h4>
<div class="paragraph">
<p>Select "DRL file" (for example) from the "Add Asset" menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-drl-file.png" alt="QuickStart create drl file">
</div>
<div class="title">Figure 150. Selecting "DRL file" from the "Add Asset" menu</div>
</div>
<div class="paragraph">
<p>Enter a file name for the new rule.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure you select the same package as the rule had. It is possible to have rules and data models in different packages, but let&#8217;s keep things simple for demo purposes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-new-rule-popup.png" alt="QuickStart new rule popup">
</div>
<div class="title">Figure 151. Entering a file name for rule</div>
</div>
<div class="paragraph">
<p>Enter a definition for the rule.</p>
</div>
<div class="paragraph">
<p>The definition process differs from asset type to asset type.</p>
</div>
<div class="paragraph">
<p>The full documentation has details about the different editors.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-writing-a-rule.png" alt="QuickStart writing a rule">
</div>
<div class="title">Figure 152. Defining a rule</div>
</div>
<div class="paragraph">
<p>Once the rule has been defined it will need to be saved in the same way we saved the model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartbuildanddeloy"><a class="anchor" href="#_wb.quickstartbuildanddeloy"></a><a class="link" href="#_wb.quickstartbuildanddeloy">15.3.5. Build and Deploy</a></h4>
<div class="paragraph">
<p>Once rules have been defined within a project; the project can be built and deployed to the Business Central&#8217;s Maven Artifact Repository.</p>
</div>
<div class="paragraph">
<p>To build a project select the "Build &amp; Deploy" from the Project Authoring.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-build-and-deploy.png" alt="QuickStart build and deploy">
</div>
<div class="title">Figure 153. Building a project</div>
</div>
<div class="paragraph">
<p>Click "Build &amp; Deploy" to build the project and deploy it to the Business Central&#8217;s Maven Artifact Repository.</p>
</div>
<div class="paragraph">
<p>When you select Build &amp; Deploy Business Central will deploy to any repositories defined in the Dependency Management section of the pom in your Business Central project.
You can edit the pom.xml file associated with your Business Central project under the Repository View of the project explorer.
Details on dependency management in maven can be found here : <a href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html" class="bare">http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html</a></p>
</div>
<div class="paragraph">
<p>If there are errors during the build process they will be reported in the "Messages" panel.</p>
</div>
<div class="paragraph">
<p>Now the project has been built and deployed; it can be referenced from your own projects as any other Maven Artifact.</p>
</div>
<div class="paragraph">
<p>The full documentation contains details about integrating projects with your own applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.configuration"><a class="anchor" href="#_wb.configuration"></a><a class="link" href="#_wb.configuration">15.4. Configuration</a></h3>
<div class="sect3">
<h4 id="_wb.usermanagement"><a class="anchor" href="#_wb.usermanagement"></a><a class="link" href="#_wb.usermanagement">15.4.1. Basic user management</a></h4>
<div class="paragraph">
<p>Business Central authenticates its users against the application server&#8217;s authentication and authorization (JAAS).</p>
</div>
<div class="paragraph">
<p>On JBoss EAP and WildFly, add a user with the script <code>$JBOSS_HOME/bin/add-user.sh</code> (or <code>.bat</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./add-user.sh
// Type: Application User
// Realm: empty (defaults to ApplicationRealm)
// Role: admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no need to restart the application server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.roles"><a class="anchor" href="#_wb.roles"></a><a class="link" href="#_wb.roles">15.4.2. Roles</a></h4>
<div class="paragraph">
<p>Business Central uses the following roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>admin</p>
</li>
<li>
<p>analyst</p>
</li>
<li>
<p>developer</p>
</li>
<li>
<p>manager</p>
</li>
<li>
<p>user</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_admin"><a class="anchor" href="#_admin"></a><a class="link" href="#_admin">15.4.2.1. Admin</a></h5>
<div class="paragraph">
<p>Administrates the BPMS system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manages users</p>
</li>
<li>
<p>Manages VFS Repositories</p>
</li>
<li>
<p>Has full access to make any changes necessary</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_developer"><a class="anchor" href="#_developer"></a><a class="link" href="#_developer">15.4.2.2. Developer</a></h5>
<div class="paragraph">
<p>Developer can do almost everything admin can do, except clone repositories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manages rules, models, process flows, forms and dashboards</p>
</li>
<li>
<p>Manages the asset repository</p>
</li>
<li>
<p>Can create, build and deploy projects</p>
</li>
<li>
<p>Can use the JBDS connection to view processes</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_analyst"><a class="anchor" href="#_analyst"></a><a class="link" href="#_analyst">15.4.2.3. Analyst</a></h5>
<div class="paragraph">
<p>Analyst is a weaker version of developer and does not have access to the asset repository or the ability to deploy projects.</p>
</div>
</div>
<div class="sect4">
<h5 id="_business_user"><a class="anchor" href="#_business_user"></a><a class="link" href="#_business_user">15.4.2.4. Business user</a></h5>
<div class="paragraph">
<p>Daily user of the system to take actions on business tasks that are required for the processes to continue forward.
Works primarily with the task lists.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Does process management</p>
</li>
<li>
<p>Handles tasks and dashboards</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_managerviewer_only_user"><a class="anchor" href="#_managerviewer_only_user"></a><a class="link" href="#_managerviewer_only_user">15.4.2.5. Manager/Viewer-only User</a></h5>
<div class="paragraph">
<p>Viewer of the system that is interested in statistics around the business processes and their performance, business indicators, and other reporting of the system and people who interact with the system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only has access to dashboards</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.introduction"><a class="anchor" href="#_wb.introduction"></a><a class="link" href="#_wb.introduction">15.5. Introduction</a></h3>
<div class="sect3">
<h4 id="_wb.loginandlogout"><a class="anchor" href="#_wb.loginandlogout"></a><a class="link" href="#_wb.loginandlogout">15.5.1. Log in and log out</a></h4>
<div class="paragraph">
<p>Create a user with the role <code>admin</code> and log in with those credentials.</p>
</div>
<div class="paragraph">
<p>After successfully logging in, the account username is displayed at the top right.
Click it to review the roles of the current account.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.homescreen"><a class="anchor" href="#_wb.homescreen"></a><a class="link" href="#_wb.homescreen">15.5.2. Home screen</a></h4>
<div class="paragraph">
<p>After logging in, the home screen shows.
The actual content of the home screen depends on the Business Central variant (Drools, jBPM, &#8230;&#8203;).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/General/home.png" alt="home">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.administrationoverview"><a class="anchor" href="#_wb.administrationoverview"></a><a class="link" href="#_wb.administrationoverview">15.5.3. Business Central overview</a></h4>
<div class="paragraph">
<p>Business Central is structured with Spaces and Projects:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/General/workbenchStructureOverview.png" alt="workbenchStructureOverview">
</div>
</div>
<div class="sect4">
<h5 id="_wb.space"><a class="anchor" href="#_wb.space"></a><a class="link" href="#_wb.space">15.5.3.1. Space</a></h5>
<div class="paragraph">
<p>Spaces are useful to model departments and divisions.</p>
</div>
<div class="paragraph">
<p>A Space can hold multiple Projects.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/General/Space.png" alt="Space">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.project"><a class="anchor" href="#_wb.project"></a><a class="link" href="#_wb.project">15.5.3.2. Project</a></h5>
<div class="paragraph">
<p>Projects are the place where assets are stored and each project belongs to a single Space.</p>
</div>
<div class="paragraph">
<p>Projects are in fact a Virtual File System based storage, that by default uses GIT as backend.
Such setup allows Business Central to work with multiple backends and, in the same time, take full advantage of backend specifics features like in GIT case versioning, branching and even external access.</p>
</div>
<div class="paragraph">
<p>A new Project can be created from scratch or cloned from an existing repository.</p>
</div>
<div class="paragraph">
<p>One of the biggest advantage of using GIT as backend is the ability to clone a repository from external and use your preferred tools to edit and build your assets.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Never</strong> clone your repositories directly from <a href="#_wb.systemproperties">.niogit</a> directory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.workbenchconcepts"><a class="anchor" href="#_wb.workbenchconcepts"></a><a class="link" href="#_wb.workbenchconcepts">15.5.4. Business Central user interface concepts</a></h4>
<div class="paragraph">
<p>Business Central consists of different logical entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Part</p>
<div class="paragraph">
<p>A Part is a screen or editor with which the user can interact to perform operations.</p>
</div>
<div class="paragraph">
<p>Example Parts are "Project Explorer", "Project Editor", "Guided Rule Editor" etc.</p>
</div>
</li>
<li>
<p>Page</p>
<div class="paragraph">
<p>A perspective is a logical grouping of related Panels and Parts. A perspective is usually named as <em>page</em>, since it is
a term far more familiar to end users whereas a perspective is more developer oriented. Notice however, Business Central
supports both developer created pages and those created by end users from the page builder (aka Content Management)
tooling but, generally speaking, <em>page</em> is used to refer both.</p>
</div>
<div class="paragraph">
<p>The user can switch between pages by clicking on one of the top-level menu items; such as "Home", "Authoring", "Deploy" etc.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.changinglayout"><a class="anchor" href="#_wb.changinglayout"></a><a class="link" href="#_wb.changinglayout">15.6. Changing the layout</a></h3>
<div class="sect3">
<h4 id="_wb.resizing"><a class="anchor" href="#_wb.resizing"></a><a class="link" href="#_wb.resizing">15.6.1. Resizing</a></h4>
<div class="paragraph">
<p>Move the mouse pointer over the panel splitter (a grey horizontal or vertical line in between panels).</p>
</div>
<div class="paragraph">
<p>The cursor will by changing indicate it is positioned correctly over the splitter.
Press and hold the left mouse button and drag the splitter to the required position; then release the left mouse button.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.authoring"><a class="anchor" href="#_wb.authoring"></a><a class="link" href="#_wb.authoring">15.7. Authoring (General)</a></h3>
<div class="sect3">
<h4 id="_wb.artifactrepository"><a class="anchor" href="#_wb.artifactrepository"></a><a class="link" href="#_wb.artifactrepository">15.7.1. Artifact Repository</a></h4>
<div class="paragraph">
<p>Projects often need external artifacts in their classpath in order to build, for example a domain model JARs.
The artifact repository holds those artifacts.</p>
</div>
<div class="paragraph">
<p>The Artifact Repository is a full blown Maven repository.
It follows the semantics of a Maven remote repository: all snapshots are timestamped.
But it is often stored on the local hard drive.</p>
</div>
<div class="paragraph">
<p>By default the artifact repository is stored under <code>$WORKING_DIRECTORY/repositories/kie</code>, but it can be overridden with the <a href="#_wb.systemproperties">system property</a><code>-Dorg.guvnor.m2repo.dir</code>.
There is only 1 Maven repository per installation.</p>
</div>
<div class="paragraph">
<p>The Artifact Repository screen shows a list of the artifacts in the Maven repository:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ArtifactRepository/mavenRepositoryExplorer.png" alt="mavenRepositoryExplorer">
</div>
</div>
<div class="paragraph">
<p>To add a new artifact to that Maven repository, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the upload button and select a JAR. If the JAR contains a POM file under <code>META-INF/maven</code> (which every JAR build by Maven has), no further information is needed. Otherwise, a groupId, artifactId and version need be given too.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ArtifactRepository/mavenRepositoryUpload.png" alt="mavenRepositoryUpload">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Using Maven, <code>mvn deploy</code> to that Maven repository. Refresh the list to make it show up.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This remote Maven repository is relatively simple.
It does not support proxying, mirroring, &#8230;&#8203; like Nexus or Archiva.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_wb.asseteditor"><a class="anchor" href="#_wb.asseteditor"></a><a class="link" href="#_wb.asseteditor">15.7.2. Asset Editor</a></h4>
<div class="paragraph">
<p>The Asset Editor is the principle component of the Business Central user interface.
It consists of two main views Editor and Overview.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The views</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/AssetEditor-edit.png" alt="AssetEditor edit">
</div>
<div class="title">Figure 154. The Asset Editor - Editor tab</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A : The editing area - exactly what form the editor takes depends on the Asset type. An asset can only be edited by one user at a time to avoid conflicts. When a user begins to edit an asset, a lock will automatically be acquired. This is indicated by a lock symbol appearing on the asset title bar as well as in the project explorer view (see <a href="#_wb.projectexplorer">Project Explorer</a> for details). If a user starts editing an already locked asset a pop-up notification will appear to inform the user that the asset can&#8217;t currently be edited, as it is being worked on by another user. Changes will be prevented until the editing user saves or closes the asset, or logs out of Business Central. Session timeouts will also cause locks to be released. Every user further has the option to force a lock release, if required (see the Metadata section below).</p>
</li>
<li>
<p>B : This menu bar contains various actions for the Asset; such as Save, Rename, Copy etc. Note that saving, renaming and deleting are deactivated if the asset is locked by a different user.</p>
</li>
<li>
<p>C : Different views for asset content or asset information.</p>
<div class="ulist">
<ul>
<li>
<p>Editor shows the main editor for the asset</p>
</li>
<li>
<p>Overview contains the metadata and conversation views for this editor. Explained in more detail below.</p>
</li>
<li>
<p>Source shows the asset in plain DRL. Note: This tab is only visible if the asset content can be generated into DRL.</p>
</li>
<li>
<p>Data Objects contains the model available for authoring. By default only Data Objects that reside within the same package as the asset are available for authoring. Data Objects outside of this package can be imported to become available for authoring the asset.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/AssetEditor-dataobjects.png" alt="AssetEditor dataobjects">
</div>
<div class="title">Figure 155. The Asset Editor - Data Objects tab</div>
</div>
</li>
<li>
<p>Overview</p>
<div class="ulist">
<ul>
<li>
<p>A : General information about the asset and the asset&#8217;s description.</p>
<div class="paragraph">
<p>"Type:" The format name of the type of Asset.</p>
</div>
<div class="paragraph">
<p>"Description:" Description for the asset.</p>
</div>
<div class="paragraph">
<p>"Used in projects:" Names the projects where this rule is used.</p>
</div>
<div class="paragraph">
<p>"Last Modified:" Who made the last change and when.</p>
</div>
<div class="paragraph">
<p>"Created on:" Who created the asset and when.</p>
</div>
</li>
<li>
<p>B : Version history for the asset. Selecting a version loads the selected version into this editor.</p>
</li>
<li>
<p>C : Meta data (from the "Dublin Core" standard)</p>
</li>
<li>
<p>D : Comments regarding the development of the Asset can be recorded here.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/Overview.png" alt="Overview">
</div>
<div class="title">Figure 156. The Asset Editor - Overview tab</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Metadata</p>
<div class="ulist">
<ul>
<li>
<p>A : Meta data:-</p>
<div class="paragraph">
<p>"Tags:" A tagging system for grouping the assets.</p>
</div>
<div class="paragraph">
<p>"Note:" A comment made when the Asset was last updated (i.e.
why a change was made)</p>
</div>
<div class="paragraph">
<p>"URI:" URI to the asset inside the Git repository.</p>
</div>
<div class="paragraph">
<p>"Subject/Type/External link/Source" : Other miscellaneous meta data for the Asset.</p>
</div>
<div class="paragraph">
<p>"Lock status" : Shows the lock status of the asset and, if locked, allows to force unlocking the asset.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/Metadata.png" alt="Metadata">
</div>
<div class="title">Figure 157. The Metadata tab</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Locking</p>
<div class="paragraph">
<p>Business Central supports pessimistic locking of assets.
When one User starts editing an asset it is locked to change by other Users.
The lock is held until a period of inactivity lapses, the Editor is closed or the application stopped and restarted.
Locks can also be forcibly removed on the MetaData section of the Overview tab.</p>
</div>
<div class="paragraph">
<p>A "padlock" icon is shown in the Editor&#8217;s title bar and beside the asset in the Project Explorer when an asset is locked.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/AssetEditor-locked.png" alt="AssetEditor locked">
</div>
<div class="title">Figure 158. The Asset Editor - Locked assets cannot be edited by other users</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wb.tagseditor"><a class="anchor" href="#_wb.tagseditor"></a><a class="link" href="#_wb.tagseditor">15.7.3. Tags Editor</a></h4>
<div class="paragraph">
<p>Tags allow assets to be labelled with any number of tags that you define.
These tags can be used to filter assets on the Project Explorer enabling "Tag filtering".</p>
</div>
<div class="sect4">
<h5 id="_wb.managingtags"><a class="anchor" href="#_wb.managingtags"></a><a class="link" href="#_wb.managingtags">15.7.3.1. Creating Tags</a></h5>
<div class="paragraph">
<p>To create tags you simply have to write them on the Tags input and press the "Add new Tag/s" button.
The Tag Editor allows creating tags one by one or writing more than one separated with a white space.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/TagsEditor/CreatingTags.png" alt="CreatingTags">
</div>
<div class="title">Figure 159. Creating Tags</div>
</div>
<div class="paragraph">
<p>Once you created new Tags they will appear over the Editor allowing you to remove them by pressing on them if you want.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/TagsEditor/ExistingTags.png" alt="ExistingTags">
</div>
<div class="title">Figure 160. Existing Tags</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.projectexplorer"><a class="anchor" href="#_wb.projectexplorer"></a><a class="link" href="#_wb.projectexplorer">15.7.4. Project Explorer</a></h4>
<div class="paragraph">
<p>The Project Explorer provides the ability to browse files inside the current Project. The Project Explorer can be accessed from the left side when an Asset Editor is open.</p>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerempty"><a class="anchor" href="#_wb.projectexplorerempty"></a><a class="link" href="#_wb.projectexplorerempty">15.7.4.1. Initial view</a></h5>
<div class="paragraph">
<p>If a file is currently being edited by another user, a lock symbol will be displayed in front of the file name.
The symbol is blue in case the lock is owned by the currently authenticated user, otherwise black.
Moving the mouse pointer over the lock symbol will display a tooltip providing the name of the user who is currently editing the file (and therefore owning the lock). To learn more about locking see <a href="#_wb.asseteditor">Asset Editor</a>
 for details.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Expanded.png" alt="ProjectExplorer Project Expanded">
</div>
<div class="title">Figure 161. Expanded asset group</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerswitchingview"><a class="anchor" href="#_wb.projectexplorerswitchingview"></a><a class="link" href="#_wb.projectexplorerswitchingview">15.7.4.2. Different views</a></h5>
<div class="paragraph">
<p>Project Explorer supports multiple views.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Project View</p>
<div class="paragraph">
<p>A simplified view of the underlying project structure.
Certain system files are hidden from view.</p>
</div>
</li>
<li>
<p>Repository View</p>
<div class="paragraph">
<p>A complete view of the underlying project structure including all files; either user-defined or system generated.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Views can be selected by clicking on the icon within the Project Explorer, as shown below.</p>
</div>
<div class="paragraph">
<p>Both Project and Repository Views can be further refined by selecting either "Show as Folders" or "Show as Links".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Switching-View.png" alt="ProjectExplorer Switching View">
</div>
<div class="title">Figure 162. Switching view</div>
</div>
<div class="sect5">
<h6 id="_wb.projectexplorertechnicalview"><a class="anchor" href="#_wb.projectexplorertechnicalview"></a><a class="link" href="#_wb.projectexplorertechnicalview">Repository View examples</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Repository-Folders.png" alt="ProjectExplorer Repository Folders">
</div>
<div class="title">Figure 163. Repository View - Folders</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Repository-Links.png" alt="ProjectExplorer Repository Links">
</div>
<div class="title">Figure 164. Repository View - Links</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerdownloads"><a class="anchor" href="#_wb.projectexplorerdownloads"></a><a class="link" href="#_wb.projectexplorerdownloads">15.7.4.3. Download Project or Repository</a></h5>
<div class="paragraph">
<p>Download Download and Download Repository make it possible to download the project or repository as a zip file.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Downloads.png" alt="ProjectExplorer Downloads">
</div>
<div class="title">Figure 165. Repository and Project Downloads</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerfilteringbytag"><a class="anchor" href="#_wb.projectexplorerfilteringbytag"></a><a class="link" href="#_wb.projectexplorerfilteringbytag">15.7.4.4. Filtering by Tag</a></h5>
<div class="paragraph">
<p>To make easy view the elements on packages that contain a lot of assets, is possible to enabling the Tag filter, whichs allows you to filter the assets by their tags.</p>
</div>
<div class="paragraph">
<p>To see how to add tags to an asset look at: <a href="#_wb.tagseditor">Tags Editor</a></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Enable.png" alt="ProjectExplorer Tag Filter Enable">
</div>
<div class="title">Figure 166. Enabling Filter by Tag</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Show.png" alt="ProjectExplorer Tag Filter Show">
</div>
<div class="title">Figure 167. Filter by Tag</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Working.png" alt="ProjectExplorer Tag Filter Working">
</div>
<div class="title">Figure 168. Filtering by Tag</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorercopyrenamedeleteactions"><a class="anchor" href="#_wb.projectexplorercopyrenamedeleteactions"></a><a class="link" href="#_wb.projectexplorercopyrenamedeleteactions">15.7.4.5. Copy, Rename, Delete and Download Actions</a></h5>
<div class="paragraph">
<p>Copy, rename and delete actions are available on Links mode, for packages in of Project View and for files and directories in Repository View. Download action is available for directories.
Download option downloads the selected the selected directory as a zip file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A : Copy</p>
</li>
<li>
<p>B : Rename</p>
</li>
<li>
<p>C : Delete</p>
</li>
<li>
<p>D : Download</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Links-Copy-Rename-Delete.png" alt="ProjectExplorer Project Links Copy Rename Delete">
</div>
<div class="title">Figure 169. Project View - Package actions</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Business Central roadmap includes a refactoring and an impact analyses tools, but currenctly doesn&#8217;t have it.
Until both tools are provided make sure that your changes (copy/rename/delete) on packages, files or directories doesn&#8217;t have a major impact on your project.</p>
</div>
<div class="paragraph">
<p>In cases that your change had an unexcepcted impact, Business Central enables you to restore your repository using the <a href="#_wb.vfsrepositoryeditor">Repository
        editor</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Files locked by other users as well as directories that contain such files cannot be renamed or deleted until the corresponding locks are released.
If that is the case the rename and delete symbols will be deactivated.
To learn more about locking see <a href="#_wb.asseteditor">Asset Editor</a>
 for details.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Delete-NotAllowed.png" alt="ProjectExplorer Delete NotAllowed">
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.projecteditor"><a class="anchor" href="#_wb.projecteditor"></a><a class="link" href="#_wb.projecteditor">15.7.5. Project Editor</a></h4>
<div class="paragraph">
<p>The Project Editor screen can be accessed from Project Explorer.
Project Editor shows the settings for the currently active project.</p>
</div>
<div class="paragraph">
<p>Unlike most of the Business Central editors, project  editor edits more than one file.
Showing everything that is needed for configuring the KIE project in one place.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/project_editor_menu.png" alt="project editor menu">
</div>
<div class="title">Figure 170. Project Screen and the different views</div>
</div>
<div class="sect4">
<h5 id="_build_deploy"><a class="anchor" href="#_build_deploy"></a><a class="link" href="#_build_deploy">15.7.5.1. Build &amp; Deploy</a></h5>
<div class="paragraph">
<p>Build &amp; Depoy builds the current project and deploys the KJAR into the Business Central internal Maven repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="_project_settings"><a class="anchor" href="#_project_settings"></a><a class="link" href="#_project_settings">15.7.5.2. Project Settings</a></h5>
<div class="paragraph">
<p>Project Settings edits the pom.xml file used by Maven.</p>
</div>
<div class="sect5">
<h6 id="_project_general_settings"><a class="anchor" href="#_project_general_settings"></a><a class="link" href="#_project_general_settings">Project General Settings</a></h6>
<div class="paragraph">
<p>General settings provide tools for project name and GAV-data (Group, Artifact, Version). GAV values are used as identifiers to differentiate projects and versions of the same project.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/general_settings.png" alt="general settings">
</div>
<div class="title">Figure 171. Project Settings</div>
</div>
</div>
<div class="sect5">
<h6 id="_dependencies"><a class="anchor" href="#_dependencies"></a><a class="link" href="#_dependencies">Dependencies</a></h6>
<div class="paragraph">
<p>The project may have any number of either internal or external dependencies.
Dependency is a project that has been built and deployed to a Maven repository.
Internal dependencies are projects built and deployed in the same Business Central as the project.
External dependencies are retrieved from repositories outside of the current Business Central.
Each dependency uses the GAV-values to specify the project name and version that is used by the project.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/dependencies.png" alt="dependencies">
</div>
<div class="title">Figure 172. Dependencies</div>
</div>
<div class="sect6">
<h7 id="_package_name_white_list"><a class="anchor" href="#_package_name_white_list"></a><a class="link" href="#_package_name_white_list">Package Name White List</a></h7>
<div class="paragraph">
<p>Classes and declared types in white listed packages show up as Data Objects that can be imported in assets.
The full list is stored in package-name-white-list file that is stored in each project root.</p>
</div>
<div class="paragraph">
<p>Package white list has three modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All packages included: Every package defined in this jar is white listed.</p>
</li>
<li>
<p>Packages not included: None of the packages listed in this jar are white listed.</p>
</li>
<li>
<p>Some packages included: Only part of the packages in the jar are white listed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_metadata"><a class="anchor" href="#_metadata"></a><a class="link" href="#_metadata">Metadata</a></h6>
<div class="paragraph">
<p>Metadata for the pom.xml file.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_base_settings"><a class="anchor" href="#_kie_base_settings"></a><a class="link" href="#_kie_base_settings">15.7.5.3. KIE base Settings</a></h5>
<div class="paragraph">
<p>KIE base Settings edits the kmodule.xml file used by Drools.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/kmodule.png" alt="kmodule">
</div>
<div class="title">Figure 173. KIE base Settings</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information about the KIE base properties, check the Drools Expert documentation for kmodule.xml.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_kie_bases_and_sessions"><a class="anchor" href="#_kie_bases_and_sessions"></a><a class="link" href="#_kie_bases_and_sessions">KIE bases and sessions</a></h6>
<div class="paragraph">
<p>KIE bases and sessions lists the KIE bases and the KIE sessions specified for the project.</p>
</div>
<div class="sect6">
<h7 id="_kie_base_list"><a class="anchor" href="#_kie_base_list"></a><a class="link" href="#_kie_base_list">KIE base list</a></h7>
<div class="paragraph">
<p>Lists all the KIE bases by name.
Only one KIE base can be set as default.</p>
</div>
</div>
<div class="sect6">
<h7 id="_kie_base_properties"><a class="anchor" href="#_kie_base_properties"></a><a class="link" href="#_kie_base_properties">KIE base properties</a></h7>
<div class="paragraph">
<p>KIE base can include other KIE bases.
The models, rules and any other content in the included KIE base will be visible and usable by the currently selected KIE base.</p>
</div>
<div class="paragraph">
<p>Rules and models are stored in packages.
The packages property specifies what packages are included into this KIE base.</p>
</div>
<div class="paragraph">
<p>Equals behavior is explained in the Drools Expert part of the documentation.</p>
</div>
<div class="paragraph">
<p>Event processing mode is explained in the Drools Fusion part of the documentation.</p>
</div>
</div>
<div class="sect6">
<h7 id="_kie_sessions"><a class="anchor" href="#_kie_sessions"></a><a class="link" href="#_kie_sessions">KIE sessions</a></h7>
<div class="paragraph">
<p>The table lists all the KIE sessions in the selected KIE base.
There can be only one default of each type.
The types are stateless and stateful.
Clicking the pen-icon opens a popup that shows more properties for the KIE session.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_metadata_2"><a class="anchor" href="#_metadata_2"></a><a class="link" href="#_metadata_2">Metadata</a></h6>
<div class="paragraph">
<p>Metadata for the kmodule.xml</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_imports"><a class="anchor" href="#_imports"></a><a class="link" href="#_imports">15.7.5.4. Imports</a></h5>
<div class="paragraph">
<p>Settings edits the <code>project.imports</code> file used by the Business Central editors.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/ExternalDataObjects.png" alt="ExternalDataObjects">
</div>
<div class="title">Figure 174. Imports</div>
</div>
<div class="sect5">
<h6 id="_external_data_objects"><a class="anchor" href="#_external_data_objects"></a><a class="link" href="#_external_data_objects">External Data Objects</a></h6>
<div class="paragraph">
<p>Data Objects provided by the Java Runtime environment may need to be registered to be available to rule authoring where such  Data Objects are not implicitly available as part of an existing Data Object defined within the Business Central or a Project dependency.
For example an Author may want to define a rule that checks for <code>java.util.ArrayList</code> in Working Memory.
If a domain Data  Object has a field of type <code>java.util.ArrayList</code> there is no need create a registraton.</p>
</div>
</div>
<div class="sect5">
<h6 id="_metadata_3"><a class="anchor" href="#_metadata_3"></a><a class="link" href="#_metadata_3">Metadata</a></h6>
<div class="paragraph">
<p>Metadata for the project.imports file.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_duplicate_gav_detection"><a class="anchor" href="#_duplicate_gav_detection"></a><a class="link" href="#_duplicate_gav_detection">15.7.5.5. Duplicate GAV detection</a></h5>
<div class="paragraph">
<p>When performing any of the following operations a check is now made against all Maven Repositories, resolved for the Project,  for whether the Project&#8217;s GroupId, ArtifactId and Version pre-exist.
If a clash is found the operation is prevented; although this can be overridden by Users with the <code>admin</code> role.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The feature can be disabled by setting the System Property <code>org.guvnor.project.gav.check.disabled</code> to <code>true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resolved repositories are those discovered in:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Project&#8217;s <code>POM<code></code>&lt;repositories&gt;</code> section (or any parent <code>POM</code>).</p>
</li>
<li>
<p>The Project&#8217;s <code>POM<code></code>&lt;distributionManagement&gt;</code> section.</p>
</li>
<li>
<p>Maven&#8217;s global <code>settings.xml</code> configuration file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Affected operations:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation of new Managed Repositories.</p>
</li>
<li>
<p>Saving a Project definition with the Project Editor.</p>
</li>
<li>
<p>Adding new Modules to a Managed Multi-Module Repository.</p>
</li>
<li>
<p>Saving the <code>pom.xml</code> file.</p>
</li>
<li>
<p>Build &amp; installing a Project with the Project Editor.</p>
</li>
<li>
<p>Build &amp; deploying a Project with the Project Editor.</p>
</li>
<li>
<p>Asset Management operations building, installing or deploying Projects.</p>
</li>
<li>
<p><code>REST</code> operations creating, installing or deploying Projects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users with the <code>Admin</code> role can override the list of Repositories checked using the "Repositories" settings in the Project Editor.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/validation-menu-item.png" alt="validation menu item">
</div>
<div class="title">Figure 175. Project Editor - Viewing resolved Repositories</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories2.png" alt="MavenRepositories2">
</div>
<div class="title">Figure 176. Project Editor - The list of resolved Repositories</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories3.png" alt="MavenRepositories3">
</div>
<div class="title">Figure 177. Duplicate GAV detected</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.validation"><a class="anchor" href="#_wb.validation"></a><a class="link" href="#_wb.validation">15.7.6. Validation</a></h4>
<div class="paragraph">
<p>Business Central provides a common and consistent service for users to understand whether files authored within the environment are valid.</p>
</div>
<div class="sect4">
<h5 id="_wb.problemspanel"><a class="anchor" href="#_wb.problemspanel"></a><a class="link" href="#_wb.problemspanel">15.7.6.1. Problem Panel</a></h5>
<div class="paragraph">
<p>The Problems Panel shows real-time validation results of assets within a Project.</p>
</div>
<div class="paragraph">
<p>When a Project is selected from the Project Explorer the Problems Panel will refresh with validation results of the chosen Project.</p>
</div>
<div class="paragraph">
<p>When files are created, saved or deleted the Problems Panel content will update to show either new validation errors, or remove existing if a file was deleted.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/Validation/workbench-problems-panel.png" alt="workbench problems panel">
</div>
<div class="title">Figure 178. The Problems Panel</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.ondemandvalidation"><a class="anchor" href="#_wb.ondemandvalidation"></a><a class="link" href="#_wb.ondemandvalidation">15.7.6.2. On demand validation</a></h5>
<div class="paragraph">
<p>It is not always desirable to save a file in order to determine whether it is in a valid state.</p>
</div>
<div class="paragraph">
<p>All of the file editors provide the ability to validate the content before it is saved.</p>
</div>
<div class="paragraph">
<p>Clicking on the 'Validate' button shows validation errors, if any.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/Validation/workbench-validation.png" alt="workbench validation">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datamodeller"><a class="anchor" href="#_wb.datamodeller"></a><a class="link" href="#_wb.datamodeller">15.7.7. Data Modeller</a></h4>
<div class="sect4">
<h5 id="_sect_datamodeler_firststeps"><a class="anchor" href="#_sect_datamodeler_firststeps"></a><a class="link" href="#_sect_datamodeler_firststeps">15.7.7.1. First steps to create a data model</a></h5>
<div class="paragraph">
<p>By default, a data model is always constrained to the context of a project.
For the purpose of this tutorial, we will assume that a correctly configured project already exists and the authoring page is open.</p>
</div>
<div class="paragraph">
<p>To start the creation of a data model inside a project, take the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the home panel, select the Desing page and select the given project.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/authoring.jpg" alt="authoring">
</div>
<div class="title">Figure 179. Go to authoring page and select a project</div>
</div>
</li>
<li>
<p>Open the Data Modeller tool by clicking on a Data Object file, or using the "Add Asset &#8594; Data Object" menu option. Set Data Object name to "PurchaseOrder" and click Ok.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/open_data_model.jpg" alt="open data model">
</div>
<div class="title">Figure 180. Click a Data Object</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This will start up the Data Modeller tool, which has the following general aspect:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/overview.png" alt="overview">
</div>
<div class="title">Figure 181. Data modeller overview</div>
</div>
<div class="paragraph">
<p>The "Editor" tab is divided into the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The new field section is dedicated to the creation of new fields, and is opened when the "add field" button is pressed.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/create-new-field.png" alt="create new field">
</div>
<div class="title">Figure 182. New field creation</div>
</div>
</li>
<li>
<p>The Data Object&#8217;s "field browser" section displays a list with the data object fields.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-field-browser.png" alt="data object field browser">
</div>
<div class="title">Figure 183. The Data Object&#8217;s field browser</div>
</div>
</li>
<li>
<p>The "Data Object / Field general properties" section. This is the rightmost section of the Data Modeller editor and visualizes the "Data Object" or "Field" general properties, depending on user selection.</p>
<div class="paragraph">
<p>Data Object general properties can be selected by clicking on the Data Object Selector.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-selector.png" alt="data object selector">
</div>
<div class="title">Figure 184. Data Object selector</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-general-properties.png" alt="data object general properties">
</div>
<div class="title">Figure 185. Data Object general properties</div>
</div>
<div class="paragraph">
<p>Field general properties can be selected by clicking on a field.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-selector.png" alt="field selector">
</div>
<div class="title">Figure 186. Field selector</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-general-properties.png" alt="field general properties">
</div>
<div class="title">Figure 187. Field general properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the right side of Business Central a new "Tool Bar" is provided that enables the selection of different context sensitive tool windows that will let the user do domain specific configurations. Currently four tool windows are provided for the following domains "Drools &amp; jBPM", "OptaPlanner", "Persistence" and "Advanced" configurations.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/tool-window-selector.png" alt="tool window selector">
</div>
<div class="title">Figure 188. Data modeller Tool Bar</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-drools-tool-window.png" alt="data object drools tool window">
</div>
<div class="title">Figure 189. Drools &amp; jBPM tool window</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-optaplanner-tool-window.png" alt="data object optaplanner tool window">
</div>
<div class="title">Figure 190. OptaPlanner tool window</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To see and use the OptaPlanner tool window, the user needs to have the role <code>plannermgmt</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-persistence-tool-window.png" alt="data object persistence tool window">
</div>
<div class="title">Figure 191. Persistence tool window</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-or-field-advanced-tool-window.png" alt="data object or field advanced tool window">
</div>
<div class="title">Figure 192. Advanced tool window</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The "Source" tab shows an editor that allows the visualization and modification of the generated java code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Round trip between the "Editor" and "Source" tabs is possible, and also source code preservation is provided. It means that not matter where the Java code was generated (e.g. Eclipse, Data modeller), the data modeller will only update the necessary code blocks to maintain the model updated.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/source-editor-tab.png" alt="source editor tab">
</div>
<div class="title">Figure 193. Source editor</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The "Overview" tab shows the standard metadata and version information as the other workbench editors.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_entities"><a class="anchor" href="#_sect_datamodeler_entities"></a><a class="link" href="#_sect_datamodeler_entities">15.7.7.2. Data Objects</a></h5>
<div class="paragraph">
<p>A data model consists of data objects which are a logical representation of some real-world data.
Such data objects have a fixed set of modeller (or application-owned) properties, such as its internal identifier, a label, description, package etc.
Besides those, a data object also has a variable set of user-defined fields, which are an abstraction of a real-world property of the type of data that this logical data object represents.</p>
</div>
<div class="paragraph">
<p>Creating a data object can be achieved using the Business Central "New Item - Data Object" menu option.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/create-new-data-object.png" alt="create new data object">
</div>
<div class="title">Figure 194. New Data Object menu option</div>
</div>
<div class="paragraph">
<p>Both resource name and location are mandatory parameters.
When the "Ok" button is pressed a new Java file will be created and a new editor instance will be opened for the file edition.
The optional "Persistable" attribute will add by default configurations on the data object in order to make it a JPA entity.
Use this option if your jBPM project needs to store data object&#8217;s information in a data base.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_propertyrelationships"><a class="anchor" href="#_sect_datamodeler_propertyrelationships"></a><a class="link" href="#_sect_datamodeler_propertyrelationships">15.7.7.3. Properties &amp; relationships</a></h5>
<div class="paragraph">
<p>Once the data object has been created, it now has to be completed by adding user-defined properties to its definition.
This can be achieved by pressing the "add field" button.
The "New Field" dialog will be opened and the new field can be created by pressing the "Create" button.
The "Create and continue" button will also add the new field to the Data Object, but won&#8217;t close the dialog.
In this way multiple fields can be created avoiding the popup opening multiple times.
The following fields can (or must) be filled out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field&#8217;s internal identifier (mandatory). The value of this field must be unique per data object, i.e. if the proposed identifier already exists within current data object, an error message will be displayed.</p>
</li>
<li>
<p>A label (optional): as with the data object definition, the user can define a user-friendly label for the data object field which is about to be created. This has no further implications on how fields from objects of this data object will be treated. If a label is defined, then this is how the field will be displayed throughout the data modeller tool.</p>
</li>
<li>
<p>A field type (mandatory): each data object field needs to be assigned with a type.</p>
<div class="paragraph">
<p>This type can be either of the following:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A 'primitive java object' type: these include most of the object equivalents of the standard Java primitive types, such as Boolean, Short, Float, etc, as well as String, Date, BigDecimal and BigInteger.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/create-field-with-primitive-type.png" alt="create field with primitive type">
</div>
<div class="title">Figure 195. Primitive object field types</div>
</div>
</li>
<li>
<p>A 'data object' type: any user defined data object automatically becomes a candidate to be defined as a field type of another data object, thus enabling the creation of relationships between them. A data object field can be created either in 'single' or in 'multiple' form, the latter implying that the field will be defined as a collection of this type, which will be indicated by selecting "List" checkbox.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/types_entity.jpg" alt="types entity">
</div>
<div class="title">Figure 196. Data object field types</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A 'primitive java' type: these include java primitive types byte, short, int, long, float, double, char and boolean.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/types_primitive.jpg" alt="types primitive">
</div>
<div class="title">Figure 197. Primitive field types</div>
</div>
<div class="paragraph">
<p>When finished introducing the initial information for a new field, clicking the 'Create' button will add the newly created field to the end of the data object&#8217;s fields table below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/new-field-was-created.png" alt="new field was created">
</div>
<div class="title">Figure 198. New field has been created</div>
</div>
<div class="paragraph">
<p>The new field will also automatically be selected in the data object&#8217;s field list, and its properties will be shown in the Field general properties editor.
Additionally the field properties will be loaded in the different tool windows, in this way the field will be ready for edition in whatever selected tool window.</p>
</div>
<div class="paragraph">
<p>At any time, any field (without restrictions) can be deleted from a data object definition by clicking on the corresponding 'x' icon in the data object&#8217;s fields table.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_additionaloptions"><a class="anchor" href="#_sect_datamodeler_additionaloptions"></a><a class="link" href="#_sect_datamodeler_additionaloptions">15.7.7.4. Additional options</a></h5>
<div class="paragraph">
<p>As stated before, both Data Objects as well as Fields require some of their initial properties to be set upon creation.
Additionally there are three domains of properties that can be configured for a given Data Object.
A domain is basically a set of properties related to a given business area.
Current available domains are, "Drools &amp; jBPM", "Persistence" and the "Advanced" domain.
To work on a given domain the user should select the corresponding "Tool window" (see below) on the right side toolbar.
Every tool window usually provides two editors, the "Data Object" level editor and the "Field" level editor, that will be shown depending on the last selected item, the Data Object or the Field.</p>
</div>
<div class="sect5">
<h6 id="_drools_jbpm_domain"><a class="anchor" href="#_drools_jbpm_domain"></a><a class="link" href="#_drools_jbpm_domain">Drools &amp; jBPM domain</a></h6>
<div class="paragraph">
<p>The Drools &amp; jBPM domain editors manages the set of Data Object or Field properties related to drools applications.</p>
</div>
<div class="sect6">
<h7 id="_drools_jbpm_object_editor"><a class="anchor" href="#_drools_jbpm_object_editor"></a><a class="link" href="#_drools_jbpm_object_editor">Drools &amp; jBPM object editor</a></h7>
<div class="paragraph">
<p>The Drools &amp; jBPM object editor manages the object level drools properties</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-drools-tool-window.png" alt="data object drools tool window">
</div>
<div class="title">Figure 199. The data object&#8217;s properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>TypeSafe: this property allows to enable/disable the type safe behaviour for current type. By default all type declarations are compiled with type safety enabled. (See Drools for more information on this matter).</p>
</li>
<li>
<p>ClassReactive: this property allows to mark this type to be treated as "Class Reactive" by the Drools engine. (See Drools for more information on this matter).</p>
</li>
<li>
<p>PropertyReactive: this property allows to mark this type to be treated as "Property Reactive" by the Drools engine. (See Drools for more information on this matter).</p>
</li>
<li>
<p>Role: this property allows to configure how the Drools engine should handle instances of this type: either as regular facts or as events. By default all types are handled as a regular fact, so for the time being the only value that can be set is "Event" to declare that this type should be handled as an event. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Timestamp: this property allows to configure the "timestamp" for an event, by selecting one of his attributes. If set the Drools engine will use the timestamp from the given attribute instead of reading it from the Session Clock. If not, the Drools engine will automatically assign a timestamp to the event. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Duration: this property allows to configure the "duration" for an event, by selecting one of his attributes. If set the Drools engine will use the duration from the given attribute instead of using the default event duration = 0. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Expires: this property allows to configure the "time offset" for an event expiration. If set, this value must be a temporal interval in the form: [<mark>d][#h][#m][#s][</mark>[ms]] Where [ ] means an optional parameter and # means a numeric value. e.g.: 1d2h, means one day and two hours. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Remotable: If checked this property makes the Data Object available to be used with jBPM remote services as REST, JMS and WS. (See jBPM for more information on this matter).</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_drools_jbpm_field_editor"><a class="anchor" href="#_drools_jbpm_field_editor"></a><a class="link" href="#_drools_jbpm_field_editor">Drools &amp; jBPM field editor</a></h7>
<div class="paragraph">
<p>The Drools &amp; jBPM object editor manages the field level drools properties</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-drools-tool-window.png" alt="field drools tool window">
</div>
<div class="title">Figure 200. The data object&#8217;s field properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Equals: checking this property for a Data Object field implies that it will be taken into account, at the code generation level, for the creation of both the equals() and hashCode() methods in the generated Java class. We will explain this in more detail in the following section.</p>
</li>
<li>
<p>Position: this field requires a zero or positive integer. When set, this field will be interpreted by the Drools engine as a positional argument (see the section below and also the Drools documentation for more information on this subject).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_persistence_domain"><a class="anchor" href="#_persistence_domain"></a><a class="link" href="#_persistence_domain">Persistence domain</a></h6>
<div class="paragraph">
<p>The Persistence domain editors manages the set of Data Object or Field properties related to persistence.</p>
</div>
<div class="sect6">
<h7 id="_persistence_domain_object_editor"><a class="anchor" href="#_persistence_domain_object_editor"></a><a class="link" href="#_persistence_domain_object_editor">Persistence domain object editor</a></h7>
<div class="paragraph">
<p>Persistence domain object editor manages the object level persistence properties</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-persistence-tool-window.png" alt="data object persistence tool window">
</div>
<div class="title">Figure 201. The data object&#8217;s properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistable: this property allows to configure current Data Object as persistable.</p>
</li>
<li>
<p>Table name: this property allows to set a user defined database table name for current Data Object.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_persistence_domain_field_editor"><a class="anchor" href="#_persistence_domain_field_editor"></a><a class="link" href="#_persistence_domain_field_editor">Persistence domain field editor</a></h7>
<div class="paragraph">
<p>The persistence domain field editor manages the field level persistence properties and is divided in three sections.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections.png" alt="field persistence tool window sections">
</div>
<div class="title">Figure 202. Persistence domain field editor sections</div>
</div>
<div class="sect7">
<h8 id="_identifier"><a class="anchor" href="#_identifier"></a><a class="link" href="#_identifier">Identifier:</a></h8>
<div class="paragraph">
<p>A persistable Data Object should have one and only one field defined as the Data Object identifier.
The identifier is typically a unique number that distinguishes a given Data Object instance from all other instances of the same class.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is Identifier: marks current field as the Data Object identifier. A persistable Data Object should have one and only one field marked as identifier, and it should be a base java type, like String, Integer, Long, etc. A field that references a Data Object, or is a multiple field can not be marked as identifier. And also composite identifiers are not supported in this version. When a persistable Data Object is created an identifier field is created by default with the properly initializations, it&#8217;s strongly recommended to use this identifier.</p>
</li>
<li>
<p>Generation Strategy: the generation strategy establishes how the identifier values will be automatically generated when the Data Object instances are created and stored in a database. (e.g. by the forms associated to jBPM processes human tasks.) When the by default Identifier field is created, the generation strategy will be also automatically set and it&#8217;s strongly recommended to use this configuration.</p>
</li>
<li>
<p>Sequence Generator: the generator represents the seed for the values that will be used by the Generation Strategy. When the by default Identifier field is created the Sequence Generator will be also automatically generated and properly configured to be used by the Generation Strategy.</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="_column_properties"><a class="anchor" href="#_column_properties"></a><a class="link" href="#_column_properties">Column Properties:</a></h8>
<div class="paragraph">
<p>The column properties section enables the customization of some properties of the database column that will store the field value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Column name: optional value that sets the database column name for the given field.</p>
</li>
<li>
<p>Unique: When checked the unique property establishes that current field value should be a unique key when stored in the database. (if not set the default value is false)</p>
</li>
<li>
<p>Nullable: When checked establishes that current field value can be null when stored in a database. (if not set the default value is true)</p>
</li>
<li>
<p>Insertable: When checked establishes that column will be included in SQL INSERT statements generated by the persistence provider. (if not set the default value is true)</p>
</li>
<li>
<p>Updatable: When checked establishes that the column will be included SQL UPDATE statements generated by the persistence provider. (if not set the default value is true)</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="_relationship_properties"><a class="anchor" href="#_relationship_properties"></a><a class="link" href="#_relationship_properties">Relationship Properties:</a></h8>
<div class="paragraph">
<p>When the field&#8217;s type is a Data Object type, or a list of a Data Object type a relationship type should be set in order to let the persistence provider to manage the relation.
Fortunately this relation type is automatically set when such kind of fields are added to an already marked as persistable Data Object.
The relationship type is set by the following popup.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections-relationship-dialog.png" alt="field persistence tool window sections relationship dialog">
</div>
<div class="title">Figure 203. Relationship configuration popup</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Relationship type: sets the type of relation from one of the following options:</p>
<div class="paragraph">
<p>One to one: typically used for 1:1 relations where "A is related to one instance of B", and B exists only when A exists.
e.g.
PurchaseOrder &#8594; PurchaseOrderHeader (a PurchaseOrderHeader exists only if the PurchaseOrder exists)</p>
</div>
<div class="paragraph">
<p>One to many: typically used for 1:N relations where "A is related to N instances of B", and the related instances of B exists only when A exists.
e.g.
PurchaseOrder &#8594; PurchaseOrderLine (a PurchaseOrderLine exists only if the PurchaseOrder exists)</p>
</div>
<div class="paragraph">
<p>Many to one: typically used for 1:1 relations where "A is related to one instance of B", and B can exist even without A.
e.g.
PurchaseOrder &#8594; Client (a Client can exist in the database even without an associated PurchaseOrder)</p>
</div>
<div class="paragraph">
<p>Many to many: typically used for N:N relations where "A can be related to N instances of B, and B can be related to M instances of A at the same time", and both B and A instances can exist in the database independently of the related instances.
e.g.
Course &#8594; Student.
(Course can be related to N Students, and a given Student can attend to M courses)</p>
</div>
<div class="paragraph">
<p>When a field of type "Data Object" is added to a given persistable Data Object, the "Many to One" relationship type is generated by default.</p>
</div>
<div class="paragraph">
<p>And when a field of type "list of Data Object" is added to a given persistable Data Object , the "One to Many" relationship is generated by default.</p>
</div>
</li>
<li>
<p>Cascade mode: Defines the set of cascadable operations that are propagated to the associated entity. The value cascade=ALL is equivalent to cascade={PERSIST, MERGE, REMOVE, REFRESH}. e.g. when A &#8594; B, and cascade "PERSIST or ALL" is set, if A is saved, then B will be also saved.</p>
<div class="paragraph">
<p>The by default cascade mode created by the data modeller is "ALL" and it&#8217;s strongly recommended to use this mode when Data Objects are being used by jBPM processes and forms.</p>
</div>
</li>
<li>
<p>Fetch mode: Defines how related data will be fetched from database at reading time.</p>
<div class="paragraph">
<p>EAGER: related data will be read at the same time.
e.g.
If A &#8594; B, when A is read from database B will be read at the same time.</p>
</div>
<div class="paragraph">
<p>LAZY: reading of related data will be delayed usually to the moment they are required.
e.g.
If PurchaseOrder &#8594; PurchaseOrderLine the lines reading will be postponed until a method "getLines()" is invoked on a PurchaseOrder instance.</p>
</div>
<div class="paragraph">
<p>The default fetch mode created by the data modeller is "EAGER" and it&#8217;s strongly recommended to use this mode when Data Objects are being used by jBPM processes and forms.</p>
</div>
</li>
<li>
<p>Optional: establishes if the right side member of a relationship can be null.</p>
</li>
<li>
<p>Mapped by: used for reverse relations.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_domain"><a class="anchor" href="#_advanced_domain"></a><a class="link" href="#_advanced_domain">Advanced domain</a></h6>
<div class="paragraph">
<p>The advanced domain enables the configuration of whatever parameter set by the other domains as well as the adding of arbitrary parameters.
As it will be shown in the code generation section every "Data Object / Field" parameter is represented by a java annotation.
The advanced mode enables the configuration of this annotations.</p>
</div>
<div class="sect6">
<h7 id="_advanced_domain_data_object_field_editor"><a class="anchor" href="#_advanced_domain_data_object_field_editor"></a><a class="link" href="#_advanced_domain_data_object_field_editor">Advanced domain Data Object / Field editor.</a></h7>
<div class="paragraph">
<p>The advanced domain editor has the same shape for both Data Object and Field.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-or-field-advanced-tool-window.png" alt="data object or field advanced tool window">
</div>
<div class="title">Figure 204. Advanced domain editor.</div>
</div>
<div class="paragraph">
<p>The following operations are available</p>
</div>
<div class="ulist">
<ul>
<li>
<p>delete: enables the deletion of a given Data Object or Field annotation.</p>
</li>
<li>
<p>clear: clears a given annotation parameter value.</p>
</li>
<li>
<p>edit: enables the edition of a given annotation parameter value.</p>
</li>
<li>
<p>add annotation: The add annotation button will start a wizard that will let the addition of whatever java annotation available in the project dependencies.</p>
<div class="paragraph">
<p>Add annotation wizard step #1: the first step of the wizard requires the entering of a fully qualified class name of an annotation, and by pressing the "search" button the annotation definition will be loaded into the wizard.
Additionally when the annotation definition is loaded, different wizard steps will be created in order to enable the completion of the different annotation parameters.
Required parameters will be marked with "*".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step1-annotation-loaded.png" alt="add annotation wizard step1 annotation loaded">
</div>
<div class="title">Figure 205. Annotation definition loaded into the wizard.</div>
</div>
<div class="paragraph">
<p>Whenever it&#8217;s possible the wizard will provide a suitable editor for the given parameters.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step2-enum-param-editor.png" alt="add annotation wizard step2 enum param editor">
</div>
<div class="title">Figure 206. Automatically generated enum values editor for an Enumeration annotation parameter.</div>
</div>
<div class="paragraph">
<p>A generic parameter editor will be provided when it&#8217;s not possible to calculate a customized editor</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step2-generic-param-editor.png" alt="add annotation wizard step2 generic param editor">
</div>
<div class="title">Figure 207. Generic annotation parameter editor</div>
</div>
<div class="paragraph">
<p>When all required parameters has been entered and validated, the finish button will be enabled and the wizard can be completed by adding the annotation to the given Data Object or Field.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_generatecode"><a class="anchor" href="#_sect_datamodeler_generatecode"></a><a class="link" href="#_sect_datamodeler_generatecode">15.7.7.5. Generate data model code.</a></h5>
<div class="paragraph">
<p>The data model in itself is merely a visual tool that allows the user to define high-level data structures, for them to interact with the Drools engine on the one hand, and the jBPM platform on the other.
In order for this to become possible, these high-level visual structures have to be transformed into low-level artifacts that can effectively be consumed by these platforms.
These artifacts are Java POJOs (Plain Old Java Objects), and they are generated every time the data model is saved, by pressing the "Save" button in the top Data Modeller Menu.
Additionally when the user round trip between the "Editor" and "Source" tab, the code is auto generated to maintain the consistency with the Editor view and vice versa.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/save_top.jpg" alt="save top">
</div>
<div class="title">Figure 208. Save the data model from the top menu</div>
</div>
<div class="paragraph">
<p>The resulting code is generated according to the following transformation rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data object&#8217;s identifier property will become the Java class&#8217;s name. It therefore needs to be a valid Java identifier.</p>
</li>
<li>
<p>The data object&#8217;s package property becomes the Java class&#8217;s package declaration.</p>
</li>
<li>
<p>The data object&#8217;s superclass property (if present) becomes the Java class&#8217;s extension declaration.</p>
</li>
<li>
<p>The data object&#8217;s label and description properties will translate into the Java annotations "@org.kie.api.definition.type.Label" and "@org.kie.api.definition.type.Description", respectively. These annotations are merely a way of preserving the associated information, and as yet are not processed any further.</p>
</li>
<li>
<p>The data object&#8217;s role property (if present) will be translated into the "@org.kie.api.definition.type.Role" Java annotation, that <em>IS</em> interpreted by the application platform, in the sense that it marks this Java class as a Drools Event Fact-Type.</p>
</li>
<li>
<p>The data object&#8217;s type safe property (if present) will be translated into the "@org.kie.api.definition.type.TypeSafe Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object&#8217;s class reactive property (if present) will be translated into the "@org.kie.api.definition.type.ClassReactive Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object&#8217;s property reactive property (if present) will be translated into the "@org.kie.api.definition.type.PropertyReactive Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object&#8217;s timestamp property (if present) will be translated into the "@org.kie.api.definition.type.Timestamp Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object&#8217;s duration property (if present) will be translated into the "@org.kie.api.definition.type.Duration Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object&#8217;s expires property (if present) will be translated into the "@org.kie.api.definition.type.Expires Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object&#8217;s remotable property (if present) will be translated into the "@org.kie.api.remote.Remotable Java annotation. (see jBPM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A standard Java default (or no parameter) constructor is generated, as well as a full parameter constructor, i.e.
a constructor that accepts as parameters a value for each of the data object&#8217;s user-defined fields.</p>
</div>
<div class="paragraph">
<p>The data object&#8217;s user-defined fields are translated into Java class fields, each one of them with its own getter and setter method, according to the following transformation rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data object field&#8217;s identifier will become the Java field identifier. It therefore needs to be a valid Java identifier.</p>
</li>
<li>
<p>The data object field&#8217;s type is directly translated into the Java class&#8217;s field type. In case the field was declared to be multiple (i.e. 'List'), then the generated field is of the "java.util.List" type.</p>
</li>
<li>
<p>The equals property: when it is set for a specific field, then this class property will be annotated with the "@org.kie.api.definition.type.Key" annotation, which is interpreted by the Drools engine, and it will 'participate' in the generated equals() method, which overwrites the equals() method of the Object class. The latter implies that if the field is a 'primitive' type, the equals method will simply compares its value with the value of the corresponding field in another instance of the class. If the field is a sub-entity or a collection type, then the equals method will make a method-call to the equals method of the corresponding data object&#8217;s Java class, or of the java.util.List standard Java class, respectively.</p>
<div class="paragraph">
<p>If the equals property is checked for <em>ANY</em> of the data object&#8217;s user defined fields, then this also implies that in addition to the default generated constructors another constructor is generated, accepting as parameters all of the fields that were marked with Equals.
Furthermore, generation of the equals() method also implies that also the Object class&#8217;s hashCode() method is overwritten, in such a manner that it will call the hashCode() methods of the corresponding Java class types (be it 'primitive' or user-defined types) for all the fields that were marked with Equals in the Data Model.</p>
</div>
</li>
<li>
<p>The position property: this field property is automatically set for all user-defined fields, starting from 0, and incrementing by 1 for each subsequent new field. However the user can freely changes the position among the fields. At code generation time this property is translated into the "@org.kie.api.definition.type.Position" annotation, which can be interpreted by the Drools engine. Also, the established property order determines the order of the constructor parameters in the generated Java class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, the generated Java class code for the Purchase Order data object, corresponding to its definition as shown in the following figure purchase_example.jpg is visualized in the figure at the bottom of this chapter.
Note that the two of the data object&#8217;s fields, namely 'header' and 'lines' were marked with Equals, and have been assigned with the positions 2 and 1, respectively).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/generate-purchase-example.png" alt="generate purchase example">
</div>
<div class="title">Figure 209. Purchase Order configuration</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    package org.jbpm.examples.purchases;

    /**
    * This class was automatically generated by the data modeler tool.
    */
    @org.kie.api.definition.type.Label("Purchase Order")
    @org.kie.api.definition.type.TypeSafe(true)
    @org.kie.api.definition.type.Role(org.kie.api.definition.type.Role.Type.EVENT)
    @org.kie.api.definition.type.Expires("2d")
    @org.kie.api.remote.Remotable
    public class PurchaseOrder implements java.io.Serializable
    {

    static final long serialVersionUID = 1L;

    @org.kie.api.definition.type.Label("Total")
    @org.kie.api.definition.type.Position(3)
    private java.lang.Double total;

    @org.kie.api.definition.type.Label("Description")
    @org.kie.api.definition.type.Position(0)
    private java.lang.String description;

    @org.kie.api.definition.type.Label("Lines")
    @org.kie.api.definition.type.Position(2)
    @org.kie.api.definition.type.Key
    private java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines;

    @org.kie.api.definition.type.Label("Header")
    @org.kie.api.definition.type.Position(1)
    @org.kie.api.definition.type.Key
    private org.jbpm.examples.purchases.PurchaseOrderHeader header;

    @org.kie.api.definition.type.Position(4)
    private java.lang.Boolean requiresCFOApproval;

    public PurchaseOrder()
    {
    }

    public java.lang.Double getTotal()
    {
    return this.total;
    }

    public void setTotal(java.lang.Double total)
    {
    this.total = total;
    }

    public java.lang.String getDescription()
    {
    return this.description;
    }

    public void setDescription(java.lang.String description)
    {
    this.description = description;
    }

    public java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; getLines()
    {
    return this.lines;
    }

    public void setLines(java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines)
    {
    this.lines = lines;
    }

    public org.jbpm.examples.purchases.PurchaseOrderHeader getHeader()
    {
    return this.header;
    }

    public void setHeader(org.jbpm.examples.purchases.PurchaseOrderHeader header)
    {
    this.header = header;
    }

    public java.lang.Boolean getRequiresCFOApproval()
    {
    return this.requiresCFOApproval;
    }

    public void setRequiresCFOApproval(java.lang.Boolean requiresCFOApproval)
    {
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(java.lang.Double total, java.lang.String description,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.lang.Boolean requiresCFOApproval)
    {
    this.total = total;
    this.description = description;
    this.lines = lines;
    this.header = header;
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(java.lang.String description,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    java.lang.Double total, java.lang.Boolean requiresCFOApproval)
    {
    this.description = description;
    this.header = header;
    this.lines = lines;
    this.total = total;
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header)
    {
    this.lines = lines;
    this.header = header;
    }

    @Override
    public boolean equals(Object o)
    {
    if (this == o)
    return true;
    if (o == null || getClass() != o.getClass())
    return false;
    org.jbpm.examples.purchases.PurchaseOrder that = (org.jbpm.examples.purchases.PurchaseOrder) o;
    if (lines != null ? !lines.equals(that.lines) : that.lines != null)
    return false;
    if (header != null ? !header.equals(that.header) : that.header != null)
    return false;
    return true;
    }

    @Override
    public int hashCode()
    {
    int result = 17;
    result = 31 * result + (lines != null ? lines.hashCode() : 0);
    result = 31 * result + (header != null ? header.hashCode() : 0);
    return result;
    }

    }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_externalmodels"><a class="anchor" href="#_sect_datamodeler_externalmodels"></a><a class="link" href="#_sect_datamodeler_externalmodels">15.7.7.6. Using external models</a></h5>
<div class="paragraph">
<p>Using an external model means the ability to use a set for already defined POJOs in current project context.
In order to make those POJOs available a dependency to the given JAR should be added.
Once the dependency has been added the external POJOs can be referenced from current project data model.</p>
</div>
<div class="paragraph">
<p>There are two ways to add a dependency to an external JAR file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency to a JAR file already installed in current local M2 repository (typically associated the user home).</p>
</li>
<li>
<p>Dependency to a JAR file installed in current Business Central "Guvnor M2 repository". (internal to the application)</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_dependency_to_a_jar_file_in_local_m2_repository"><a class="anchor" href="#_dependency_to_a_jar_file_in_local_m2_repository"></a><a class="link" href="#_dependency_to_a_jar_file_in_local_m2_repository">Dependency to a JAR file in local M2 repository</a></h6>
<div class="paragraph">
<p>To add a dependency to a JAR file in local M2 repository follow this steps.</p>
</div>
<div class="sect6">
<h7 id="_open_the_project_editor_for_current_project_and_select_the_dependencies_view"><a class="anchor" href="#_open_the_project_editor_for_current_project_and_select_the_dependencies_view"></a><a class="link" href="#_open_the_project_editor_for_current_project_and_select_the_dependencies_view">Open the Project Editor for current project and select the Dependencies view.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-1.png" alt="add dependency 1">
</div>
<div class="title">Figure 210. Project editor.</div>
</div>
</div>
<div class="sect6">
<h7 id="_click_the_add_button_to_add_a_new_dependency_line"><a class="anchor" href="#_click_the_add_button_to_add_a_new_dependency_line"></a><a class="link" href="#_click_the_add_button_to_add_a_new_dependency_line">Click the "Add" button to add a new dependency line.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-2.png" alt="add dependency 2">
</div>
<div class="title">Figure 211. New dependency line.</div>
</div>
</div>
<div class="sect6">
<h7 id="_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository"><a class="anchor" href="#_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository"></a><a class="link" href="#_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository">Complete the GAV for the JAR file already installed in local M2 repository.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-3.png" alt="add dependency 3">
</div>
<div class="title">Figure 212. Dependency line edition.</div>
</div>
</div>
<div class="sect6">
<h7 id="_save_the_project_to_update_its_dependencies"><a class="anchor" href="#_save_the_project_to_update_its_dependencies"></a><a class="link" href="#_save_the_project_to_update_its_dependencies">Save the project to update its dependencies.</a></h7>
<div class="paragraph">
<p>When project is saved the POJOs defined in the external file will be available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-4.png" alt="add dependency 4">
</div>
<div class="title">Figure 213. Save project.</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_dependency_to_a_jar_file_in_current_guvnor_m2_repository"><a class="anchor" href="#_dependency_to_a_jar_file_in_current_guvnor_m2_repository"></a><a class="link" href="#_dependency_to_a_jar_file_in_current_guvnor_m2_repository">Dependency to a JAR file in current "Guvnor M2 repository".</a></h6>
<div class="paragraph">
<p>To add a dependency to a JAR file in current "Guvnor M2 repository" follow this steps.</p>
</div>
<div class="sect6">
<h7 id="_open_the_maven_artifact_repository_editor"><a class="anchor" href="#_open_the_maven_artifact_repository_editor"></a><a class="link" href="#_open_the_maven_artifact_repository_editor">Open the Maven Artifact Repository editor.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-1.png" alt="add dependency guvnor m2 1">
</div>
<div class="title">Figure 214. Guvnor M2 Repository editor.</div>
</div>
</div>
<div class="sect6">
<h7 id="_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button"><a class="anchor" href="#_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button"></a><a class="link" href="#_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button">Browse your local file system and select the JAR file to be uploaded using the Browse button.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-2-2.png" alt="add dependency guvnor m2 2 2">
</div>
<div class="title">Figure 215. File browser.</div>
</div>
</div>
<div class="sect6">
<h7 id="_upload_the_file_using_the_upload_button"><a class="anchor" href="#_upload_the_file_using_the_upload_button"></a><a class="link" href="#_upload_the_file_using_the_upload_button">Upload the file using the Upload button.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-3.png" alt="add dependency guvnor m2 3">
</div>
<div class="title">Figure 216. File upload success.</div>
</div>
</div>
<div class="sect6">
<h7 id="_guvnor_m2_repository_files"><a class="anchor" href="#_guvnor_m2_repository_files"></a><a class="link" href="#_guvnor_m2_repository_files">Guvnor M2 repository files.</a></h7>
<div class="paragraph">
<p>Once the file has been loaded it will be displayed in the repository files list.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-4.png" alt="add dependency guvnor m2 4">
</div>
<div class="title">Figure 217. Files list.</div>
</div>
</div>
<div class="sect6">
<h7 id="_provide_a_gav_for_the_uploaded_file_optional"><a class="anchor" href="#_provide_a_gav_for_the_uploaded_file_optional"></a><a class="link" href="#_provide_a_gav_for_the_uploaded_file_optional">Provide a GAV for the uploaded file (optional).</a></h7>
<div class="paragraph">
<p>If the uploaded file is not a valid Maven JAR (don&#8217;t have a pom.xml file) the system will prompt the user in order to provide a GAV for the file to be installed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-not-gav-1.png" alt="add dependency guvnor m2 not gav 1">
</div>
<div class="title">Figure 218. Not valid POM.</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-not-gav-2.png" alt="add dependency guvnor m2 not gav 2">
</div>
<div class="title">Figure 219. Enter GAV manually.</div>
</div>
</div>
<div class="sect6">
<h7 id="_add_dependency_from_repository"><a class="anchor" href="#_add_dependency_from_repository"></a><a class="link" href="#_add_dependency_from_repository">Add dependency from repository.</a></h7>
<div class="paragraph">
<p>Open the project editor (see below) and click the "Add from repository" button to open the JAR selector to see all the installed JAR files in current "Guvnor M2 repository". When the desired file is selected the project should be saved in order to make the new dependency available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-5.png" alt="add dependency guvnor m2 5">
</div>
<div class="title">Figure 220. Select JAR from "Maven Artifact Repository".</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_the_external_objects"><a class="anchor" href="#_using_the_external_objects"></a><a class="link" href="#_using_the_external_objects">Using the external objects</a></h6>
<div class="paragraph">
<p>When a dependency to an external JAR has been set, the external POJOs can be used in the context of current project data model in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>External POJOs can be extended by current model data objects.</p>
</li>
<li>
<p>External POJOs can be used as field types for current model data objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following screenshot shows how external objects are prefixed with the string " -ext- " in order to be quickly identified.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-select-external-pojo.png" alt="add dependency select external pojo">
</div>
<div class="title">Figure 221. Identifying external objects.</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_roundtrip_and_concurrency"><a class="anchor" href="#_roundtrip_and_concurrency"></a><a class="link" href="#_roundtrip_and_concurrency">15.7.7.7. Roundtrip and concurrency</a></h5>
<div class="paragraph">
<p>Current version implements roundtrip and code preservation between Data modeller and Java source code.
No matter where the Java code was generated (e.g.
Eclipse, Data modeller), the data modeller will only create/delete/update the necessary code elements to maintain the model updated, i.e, fields, getter/setters, constructors, equals method and hashCode method.
Also whatever Type or Field annotation not managed by the Data Modeler will be preserved when the Java sources are updated by the Data modeller.</p>
</div>
<div class="paragraph">
<p>Aside from code preservation, like in the other Business Central editors, concurrent modification scenarios are still possible.
Common scenarios are when two different users are updating the model for the same project, e.g.
using the data modeller or executing a 'git push command' that modifies project sources.</p>
</div>
<div class="paragraph">
<p>From an application context&#8217;s perspective, we can basically identify two different main scenarios:</p>
</div>
<div class="sect5">
<h6 id="_no_changes_have_been_undertaken_through_the_application"><a class="anchor" href="#_no_changes_have_been_undertaken_through_the_application"></a><a class="link" href="#_no_changes_have_been_undertaken_through_the_application">No changes have been undertaken through the application</a></h6>
<div class="paragraph">
<p>In this scenario the application user has basically just been navigating through the data model, without making any changes to it.
Meanwhile, another user modifies the data model externally.</p>
</div>
<div class="paragraph">
<p>In this case, no immediate warning is issued to the application user.
However, as soon as the user tries to make any kind of change, such as add or remove data objects or properties, or change any of the existing ones, the following pop-up will be shown:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_reopen_ignore.jpg" alt="extchanges reopen ignore">
</div>
<div class="title">Figure 222. External changes warning</div>
</div>
<div class="paragraph">
<p>The user can choose to either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Re-open the data model, thus loading any external changes, and then perform the modification he was about to undertake, or</p>
</li>
<li>
<p>Ignore any external changes, and go ahead with the modification to the model. In this case, when trying to persist these changes, another pop-up warning will be shown:</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_forcesave_reopen.jpg" alt="extchanges forcesave reopen">
</div>
<div class="title">Figure 223. Force save / re-open</div>
</div>
<div class="paragraph">
<p>The "Force Save" option will effectively overwrite any external changes, while "Re-open" will discard any local changes and reload the model.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>"Force Save" overwrites any external changes!</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_changes_have_been_undertaken_through_the_application"><a class="anchor" href="#_changes_have_been_undertaken_through_the_application"></a><a class="link" href="#_changes_have_been_undertaken_through_the_application">Changes have been undertaken through the application</a></h6>
<div class="paragraph">
<p>The application user has made changes to the data model.
Meanwhile, another user simultaneously modifies the data model from outside the application context.</p>
</div>
<div class="paragraph">
<p>In this alternative scenario, immediately after the external user commits his changes to the asset repository (or e.g.
saves the model with the data modeller in a different session), a warning is issued to the application user:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_reopen_ignore.jpg" alt="extchanges reopen ignore">
</div>
<div class="title">Figure 224. External changes warning</div>
</div>
<div class="paragraph">
<p>As with the previous scenario, the user can choose to either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Re-open the data model, thus losing any modifications that were made through the application, or</p>
</li>
<li>
<p>Ignore any external changes, and continue working on the model.</p>
<div class="paragraph">
<p>One of the following possibilities can now occur:
** The user tries to persist the changes he made to the model by clicking the "Save" button in the data modeller top level menu. This leads to the following warning message:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_forcesave_reopen.jpg" alt="extchanges forcesave reopen">
</div>
<div class="title">Figure 225. Force save / re-open</div>
</div>
<div class="paragraph">
<p>The "Force Save" option will effectively overwrite any external changes, while "Re-open" will discard any local changes and reload the model.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datasets"><a class="anchor" href="#_wb.datasets"></a><a class="link" href="#_wb.datasets">15.7.8. Data Sets</a></h4>
<div class="paragraph">
<p>A <strong>data set</strong> is basically a set of columns populated with some rows, a matrix of data composed of timestamps, texts and numbers.
A data set can be stored in different systems: a database, an excel file, in memory or in a lot of other different systems.
On the other hand, a <strong>data set definition</strong> tells Business Central modules how such data can be accessed, read and parsed.</p>
</div>
<div class="paragraph">
<p>Notice, it&#8217;s very important to make crystal clear the difference between a data set and its definition since Business Central does not take care of storing any data, it just provides an standard way to define access to those data sets regardless where the data is stored.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take for instance the data stored in a remote database.
A valid data set could be, for example, an entire database table or the result of an SQL query.
In both cases, the database will return a bunch of columns and rows.
Now, imagine we want to get access to such data to feed some charts in a new Business Central page.
First thing is to create and register a data set definition in order to indicate the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>where the data set is stored,</p>
</li>
<li>
<p>how can be accessed, read and parsed and</p>
</li>
<li>
<p>what columns contains and of which type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter introduces the available Business Central tools for registering and handling data set definitions and how this definitions can be consumed in other Business Central modules like, for instance, the Page Editor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For simplicity sake we will be using the term <em>data set</em> to refer to the actual data set definitions as <em>Data set</em> and <em>Data set definition</em> can be considered synonyms under the data set authoring context.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_wb.datasetauthoringperspective"><a class="anchor" href="#_wb.datasetauthoringperspective"></a><a class="link" href="#_wb.datasetauthoringperspective">15.7.8.1. Data Set Authoring Page</a></h5>
<div class="paragraph">
<p>Everything related to the authoring of data sets can be found under the <em>Data Set Authoring</em> page which is accessible from the following top level menu entry: <em>Extensions&gt;Data Sets</em>, as shown in the following screenshot.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetAuthoringPerspective.png" alt="DataSetAuthoringPerspective">
</div>
<div class="title">Figure 226. Data Set Authoring Page</div>
</div>
<div class="paragraph">
<p>The center panel, shows a welcome screen, whilst the left panel contains the <em>Data Set Explorer</em> listing all the data sets available</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This page is only intended to Administrator users, since defining data sets can be considered a low level task.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetexplorer"><a class="anchor" href="#_wb.datasetexplorer"></a><a class="link" href="#_wb.datasetexplorer">15.7.8.2. Data Set Explorer</a></h5>
<div class="paragraph">
<p>The <em>Data Set Explorer</em> list the data sets present in the system.
Every time the user clicks on the data set it shows a brief summary alongside the following information:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetExplorer.png" alt="DataSetExplorer">
</div>
<div class="title">Figure 227. Data Set Explorer</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) A button for creating a new Data set</p>
</li>
<li>
<p>(2) The list of currently available Data sets</p>
</li>
<li>
<p>(3) An icon that represents the Data set&#8217;s provider type (Bean, SQL, CSV, etc)</p>
</li>
<li>
<p>(4) Details of current cache and refresh policy status</p>
</li>
<li>
<p>(5) Details of current size on backend (unit as rows) and current size on client side (unit in bytes)</p>
</li>
<li>
<p>(6) The button for editing the Data set. Once clicked the Data set editor screen is opened on the center panel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next sections explains how to create, edit and fine tune data set definitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetcreation"><a class="anchor" href="#_wb.datasetcreation"></a><a class="link" href="#_wb.datasetcreation">15.7.8.3. Data Set Creation</a></h5>
<div class="paragraph">
<p>Clicking on the <em>New Data Set</em> button opens a new screen from which the user is able to create a new data set definition in three steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Provider type selection</em></p>
<div class="paragraph">
<p>Specify the kind of the remote storage system (BEAN, SQL, CSV, ElasticSearch)</p>
</div>
</li>
<li>
<p><em>Provider configuration</em></p>
<div class="paragraph">
<p>Specify the attributes for being able to look up data from the remote system.
The configuration varies depending on the data provider type selected.</p>
</div>
</li>
<li>
<p><em>Data set columns &amp; filter</em></p>
<div class="paragraph">
<p>Live data preview, column types and initial filter configuration.</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationtypeselection"><a class="anchor" href="#_wb.datasetcreationtypeselection"></a><a class="link" href="#_wb.datasetcreationtypeselection">Step 1: Provider type selection</a></h6>
<div class="paragraph">
<p>Allows the user&#8217;s specify the type of data provider of the data set being created.</p>
</div>
<div class="paragraph">
<p>This screen lists all the current available data provider types and helper popovers with descriptions.
Each data provider is represented with a descriptive image:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefTypeSelection.png" alt="DataSetDefTypeSelection">
</div>
<div class="title">Figure 228. Provider type selection</div>
</div>
<div class="paragraph">
<p>Four types are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bean (Java class) - To generate a data set directly from Java</p>
</li>
<li>
<p>SQL - For getting data from any ANSI-SQL compliant database</p>
</li>
<li>
<p>CSV - To upload the contents of a remote or local CSV file</p>
</li>
<li>
<p>Elastic Search - To query and get documents stored on Elastic Search nodes as data sets</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a type is selected, click Next to continue with the next workflow step.</p>
</div>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationconfiguration"><a class="anchor" href="#_wb.datasetcreationconfiguration"></a><a class="link" href="#_wb.datasetcreationconfiguration">Step 2: Configuration</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefConfigScreen.png" alt="DataSetDefConfigScreen">
</div>
<div class="title">Figure 229. CSV Configuration</div>
</div>
<div class="paragraph">
<p>The provider type selected in the previous step will determine which configuration settings the system asks for.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefConfigTypes.png" alt="DataSetDefConfigTypes">
</div>
<div class="title">Figure 230. Configuration screen per data set type</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The UUID attribute is a read only field as it&#8217;s generated by the system.
It&#8217;s only intended for usage in API calls or specific operations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationpreview"><a class="anchor" href="#_wb.datasetcreationpreview"></a><a class="link" href="#_wb.datasetcreationpreview">Step 3: Data set columns and preview</a></h6>
<div class="paragraph">
<p>After clicking on the <em>Test</em> button (see previous step), the system executes a data set lookup test call in order to check if the remote system is up and the data is available.
If everything goes ok the user will see the following screen:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefLivePreview.png" alt="DataSetDefLivePreview">
</div>
<div class="title">Figure 231. Data set preview</div>
</div>
<div class="paragraph">
<p>This screen shows a live data preview along with the columns the user wants to be part of the resulting data set.
The user can also navigate through the data and apply some changes to the data set structure.
Once finished, we can click the <em>Save</em> button in order to register the new data set definition.</p>
</div>
<div class="paragraph">
<p>We can also change the configuration settings at any time just by going back to the configuration tab.
We can repeat the <em>Configuration&gt;Test&gt;Preview</em> cycle as many times as needed until we consider it&#8217;s ready to be saved.</p>
</div>
<div class="paragraph">
<p><strong>Columns</strong></p>
</div>
<div class="paragraph">
<p>In the <em>Columns</em> tab area the user can select what columns are part of the resulting data set definition.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefColumns.png" alt="DataSetDefColumns">
</div>
<div class="title">Figure 232. Data set columns</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) To add or remove columns. Select only those columns you want to be part of the resulting data set</p>
</li>
<li>
<p>(2) Use the drop down image selector to change the column type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A data set may only contain columns of any of the following 4 types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Label - For text values supporting group operations (similar to the SQL "group by" operator) which means you can perform data lookup calls and get one row per distinct value.</p>
</li>
<li>
<p>Text - For text values NOT supporting group operations. Typically for modeling large text columns such as abstracts, descriptions and the like.</p>
</li>
<li>
<p>Number - For numeric values. It does support aggregation functions on data lookup calls: sum, min, max, average, count, distinct.</p>
</li>
<li>
<p>Date - For date or timestamp values. It does support time based group operations by different time intervals: minute, hour, day, month, year, &#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No matter which remote system you want to retrieve data from, the resulting data set will always return a set of columns of one of the four types above.
There exists, by default, a mapping between the remote system column types and the data set types.
The user is able to modify the type for some columns, depending on the data provider and the column type of the remote system.
The system supports the following changes to column types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Label &lt;&gt; Text - Useful when we want to enable/disable the categorization (grouping) for the target column. For instance, imagine a database table called "document" containing a large text column called "abstract". As we do not want the system to treat such column as a "label" we might change its column type to "text". Doing so, we are optimizing the way the system handles the data set and</p>
</li>
<li>
<p>Number &lt;&gt; Label - Useful when we want to treat numeric columns as labels. This can be used for instance to indicate that a given numeric column is not a numeric value that can be used in aggregation functions. Despite its values are stored as numbers we want to handle the column as a "label". One example of such columns are: an item&#8217;s code, an appraisal id., &#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BEAN data sets do not support changing column types as it&#8217;s up to the developer to decide which are the concrete types for each column.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Filter</strong></p>
</div>
<div class="paragraph">
<p>A data set definition may define a filter.
The goal of the filter is to leave out rows the user does not consider necessary.
The filter feature works on any data provider type and it lets the user to apply filter operations on any of the data set columns available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefFilter.png" alt="DataSetDefFilter">
</div>
<div class="title">Figure 233. Data set filter</div>
</div>
<div class="paragraph">
<p>While adding or removing filter conditions and operations, the preview table on central area is updated with live data that reflects the current filter status.</p>
</div>
<div class="paragraph">
<p>There exists two strategies for filtering data sets and it&#8217;s also important to note that choosing between the two have important implications.
Imagine a dashboard with some charts feeding from a expense reports data set where such data set is built on top of an SQL table.
Imagine also we only want to retrieve the expense reports from the "London" office.
You may define a data set containing the filter "office=London" and then having several charts feeding from such data set.
This is the recommended approach.
Another option is to define a data set with no initial filter and then let the individual charts to specify their own filter.
It&#8217;s up to the user to decide on the best approach.</p>
</div>
<div class="paragraph">
<p>Depending on the case it might be better to define the filter at a data set level for reusing across other modules.
The decision may also have impact on the performance since a filtered cached data set will have far better performance than a lot of individual non-cached data set lookup requests.
(See the next section for more information about caching data sets).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice, for SQL data sets, the user can use both the filter feature introduced or, alternatively, just add custom filter criteria to the SQL sentence.
Although, the first approach is more appropriated for non technical users since they might not have the required SQL language skills.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetdefeditor"><a class="anchor" href="#_wb.datasetdefeditor"></a><a class="link" href="#_wb.datasetdefeditor">15.7.8.4. Data set editor</a></h5>
<div class="paragraph">
<p>To edit an existing data set definition go the data set explorer, expand the desired data set definition and click the <em>Edit</em> button.
This will cause a new editor panel to be opened and placed on the center of the screen, as shown in the next screenshot:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefEditor.png" alt="DataSetDefEditor">
</div>
<div class="title">Figure 234. Data set definition editor</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefEditorSelector.png" alt="DataSetDefEditorSelector">
</div>
<div class="title">Figure 235. Editor selector</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Save - To validate the current changes and store the data set definition.</p>
</li>
<li>
<p>Delete - To remove permanently from storage the data set definition. Any client module referencing the data set may be affected.</p>
</li>
<li>
<p>Validate - To check that all the required parameters exists and are correct, as well as to validate the data set can be retrieved with no issues.</p>
</li>
<li>
<p>Copy - To create a brand new definition as a copy of the current one.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Data set definitions are stored in the underlying GIT repository as JSON files.
Any action performed is registered in the repository logs so it is possible to audit the change log later on.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetadvancedsettings"><a class="anchor" href="#_wb.datasetadvancedsettings"></a><a class="link" href="#_wb.datasetadvancedsettings">15.7.8.5. Advanced settings</a></h5>
<div class="paragraph">
<p>In the <em>Advanced settings</em> tab area the user can specify caching and refresh settings.
Those are very important for making the most of the system capabilities thus improving the performance and having better application responsive levels.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefAdvanced.png" alt="DataSetDefAdvanced">
</div>
<div class="title">Figure 236. Advanced settings</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) To enable or disable the client cache and specify the maximum size (bytes).</p>
</li>
<li>
<p>(2) To enable or disable the backend cache and specify the maximum cache size (number of rows).</p>
</li>
<li>
<p>(3) To enable or disable automatic refresh for the Data set and the refresh period.</p>
</li>
<li>
<p>(4) To enable or disable the refresh on stale data setting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s dig into more details about the meaning of these settings.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetcachesettings"><a class="anchor" href="#_wb.datasetcachesettings"></a><a class="link" href="#_wb.datasetcachesettings">15.7.8.6. Caching</a></h5>
<div class="paragraph">
<p>The system provides caching mechanisms out-of-the-box for holding data sets and performing data operations using in-memory strategies.
The use of these features brings a lot of advantages, like reducing the network traffic, remote system payload, processing times etc.
On the other hand, it&#8217;s up to the user to fine tune properly the caching settings to avoid hitting performance issues.</p>
</div>
<div class="paragraph">
<p>Two cache levels are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client level</p>
</li>
<li>
<p>Backend level</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following diagram shows how caching is involved in any data set operation:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetCacheArchitecture.png" alt="DataSetCacheArchitecture">
</div>
<div class="title">Figure 237. Data set caching</div>
</div>
<div class="paragraph">
<p>Any data look up call produces a resulting data set, so the use of the caching techniques determines where the data lookup calls are executed and where the resulting data set is located.</p>
</div>
<div class="paragraph">
<p><strong>Client cache</strong></p>
</div>
<div class="paragraph">
<p>If ON then the data set involved in a look up operation is pushed into the web browser so that all the components that feed from this data set <strong>do not need to perform any requests to the backend</strong> since data set operations are resolved at a client side:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data set is stored in the web browser&#8217;s memory</p>
</li>
<li>
<p>The client components feed from the data set stored in the browser</p>
</li>
<li>
<p>Data set operations (grouping, aggregations, filters and sort) are processed within the web browser, by means of a Javascript data set operation engine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you know beforehand that your data set will remain small, you can enable the client cache.
It will reduce the number of backend requests, including the requests to the storage system.
On the other hand, if you consider that your data set will be quite big, disable the client cache so as to not hitting with browser issues such as slow performance or intermittent hangs.</p>
</div>
<div class="paragraph">
<p><strong>Backend cache</strong></p>
</div>
<div class="paragraph">
<p>Its goal is to provide a caching mechanism for data sets on backend side.</p>
</div>
<div class="paragraph">
<p>This feature allows to <strong>reduce the number of requests to the remote storage system</strong> , by holding the data set in memory and performing group, filter and sort operations using the in-memory Drools engine.</p>
</div>
<div class="paragraph">
<p>It&#8217;s useful for data sets that do not change very often and their size can be considered acceptable to be held and processed in memory.
It can be also helpful on low latency connectivity issues with the remote storage.
On the other hand, if your data set is going to be updated frequently, it&#8217;s better to disable the backend cache and perform the requests to the remote storage on each look up request, so the storage system is in charge of resolving the data set lookup request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BEAN and CSV data providers relies by default on the backend cache, as in both cases the data set must be always loaded into memory in order to resolve any data lookup operation using the in-memory Drools engine.
This is the reason why the backend settings are not visible in the Advanced settings tab.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetrefreshsettings"><a class="anchor" href="#_wb.datasetrefreshsettings"></a><a class="link" href="#_wb.datasetrefreshsettings">15.7.8.7. Refresh</a></h5>
<div class="paragraph">
<p>The refresh feature allows for the invalidation of any cached data when certain conditions are meet.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefRefreshSettings.png" alt="DataSetDefRefreshSettings">
</div>
<div class="title">Figure 238. Refresh settings</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) To enable or disable the refresh feature.</p>
</li>
<li>
<p>(2) To specify the refresh interval.</p>
</li>
<li>
<p>(3) To enable or disable data set invalidation when the data is outdated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data set refresh policy is tightly related to data set caching, detailed in previous section.
This invalidation mechanism determines the cache life-cycle.</p>
</div>
<div class="paragraph">
<p>Depending on the nature of the data there exist three main use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Source data changes predictable</strong> - Imagine a database being updated every night. In that case, the suggested configuration is to use a "refresh interval = 1 day" and disable "refresh on stale data". That way, the system will always invalidate the cached data set every day. This is the right configuration when we know in advance that the data is going to change.</p>
</li>
<li>
<p><strong>Source data changes unpredictable</strong> - On the other hand, if we do not know whether the database is updated every day, the suggested configuration is to use a "refresh interval = 1 day" and enable "refresh on stale data". If so the system, before invalidating any data, will check for modifications. On data modifications, the system will invalidate the current stale data set so that the cache is populated with fresh data on the next data set lookup call.</p>
</li>
<li>
<p><strong>Real time scenarios</strong> - In real time scenarios caching makes no sense as data is going to be updated constantly. In this kind of scenarios the data sent to the client has to be constantly updated, so rather than enabling the refresh settings (remember this settings affect the caching, and caching is not enabled) it&#8217;s up to the clients consuming the data set to decide when to refresh. When the client is a dashboard then it&#8217;s just a matter of modifying the refresh settings in the Displayer Editor configuration screen and set a proper refresh period, "refresh interval = 1 second" for example.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datasources"><a class="anchor" href="#_wb.datasources"></a><a class="link" href="#_wb.datasources">15.7.9. Data Source Management</a></h4>
<div class="paragraph">
<p>The data source management system provides the ability of defining data sources for accessing external databases.
This data sources can be later used by other Business Central components like the Data Sets.</p>
</div>
<div class="sect4">
<h5 id="_wb.databasedrivers"><a class="anchor" href="#_wb.databasedrivers"></a><a class="link" href="#_wb.databasedrivers">15.7.9.1. Database Drivers</a></h5>
<div class="paragraph">
<p>To be able to communicate with the target database a data source will need a database driver to access it.
This is why the system additionally provides the ability of defining database drivers for the data sources operation.
A database driver is basically a JDBC compliant driver. We will see them in the next topics.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceauthoringperspective"><a class="anchor" href="#_wb.datasourceauthoringperspective"></a><a class="link" href="#_wb.datasourceauthoringperspective">15.7.9.2. Data Source Authoring Page</a></h5>
<div class="paragraph">
<p>Everything related to the authoring of data sources and drivers can be found under the <em>Data Source Authoring</em> page accessible from the following top level menu entry: <em>Extensions&gt;Data Sources</em>, as shown in the following screenshot.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceManagementPerspective.png" alt="DataSourceManagementPerspective">
</div>
<div class="title">Figure 239. Data Source Authoring Page</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This page is only intended for Administrator users, since defining data sources can be considered a low level task.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceexplorer"><a class="anchor" href="#_wb.datasourceexplorer"></a><a class="link" href="#_wb.datasourceexplorer">15.7.9.3. Data Source Explorer</a></h5>
<div class="paragraph">
<p>The <em>Data Source Explorer</em> lists the data sources and drivers currently defined in the system, at the same time it provides the required actions for managing them.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceExplorer.png" alt="DataSourceExplorer">
</div>
<div class="title">Figure 240. Data Source Explorer</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) Action link for creating a new data source</p>
</li>
<li>
<p>(2) List of currently available data sources</p>
</li>
<li>
<p>(3) Action link for creating a new driver</p>
</li>
<li>
<p>(4) List of currently available drivers</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourcecreation"><a class="anchor" href="#_wb.datasourcecreation"></a><a class="link" href="#_wb.datasourcecreation">15.7.9.4. New Data Source Wizard</a></h5>
<div class="paragraph">
<p>Clicking on the <em>New Data Source</em> action link opens the New Data Source Wizard:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDataSourceWizard.png" alt="NewDataSourceWizard">
</div>
<div class="title">Figure 241. New Data Source Wizard</div>
</div>
<div class="paragraph">
<p>The following required parameters define a data source:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: A unique name for the data source definition.</p>
</li>
<li>
<p>Connection URL: A JDBC database connection url compliant with the selected driver type.
This is an example of a connection url for a PostgreSQL database: <em>jdbc:postgresql://localhost:5432/appformer</em>.</p>
</li>
<li>
<p>User: A user name in the target database.</p>
</li>
<li>
<p>Password: The corresponding user password.</p>
</li>
<li>
<p>Driver: Selects the JDBC driver to be used for connecting to the target database. <em>Note that the connection url format may vary depending on the driver, and different database vendors typically provides different drivers.</em></p>
</li>
<li>
<p>Test connection: Once clicked, the system will show a dialog similar to the one below showing the connection test status.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/TestConnectionSuccessful.png" alt="TestConnectionSuccessful">
</div>
<div class="title">Figure 242. Test Connection Status</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While not required, it&#8217;s recommended to use the test connection button to check the correctness of the data source parameters prior to finishing the data source creation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceeditor"><a class="anchor" href="#_wb.datasourceeditor"></a><a class="link" href="#_wb.datasourceeditor">15.7.9.5. Data Source Editor</a></h5>
<div class="paragraph">
<p>The <em>Data Source Editor</em> is opened by clicking on a data source item in the <em>Data Source Explorer</em>.</p>
</div>
<div class="paragraph">
<p>The following screenshot shows the <em>Data Source Editor</em> opened for the data source of the example above.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceEditor.png" alt="DataSourceEditor">
</div>
<div class="title">Figure 243. Data Source Editor</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Main Panel: The main panel basically lets you modify the data source configuration parameters.</p>
</li>
<li>
<p>Test connection: Tests the connection.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s a recommended practice to test the connection prior saving a modified data source.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourcecontent"><a class="anchor" href="#_wb.datasourcecontent"></a><a class="link" href="#_wb.datasourcecontent">15.7.9.6. Data Source Content Browser</a></h5>
<div class="paragraph">
<p>The data source content browser is opened by clicking on the <em>Browse Content</em> button, and enables the navigation through the database structure pointed by the data source.
The navigation is performed in three levels, <em>Schemas level</em>, <em>Current schema level</em> and <em>Current table level</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Schemas level: lists all the database schemas accessible by current data source.
Which schemas are listed depends on the database access rights granted to the user which was used in the connection configuration.
Similarly for the following item.</p>
</li>
<li>
<p>Current schema level: shows all the database tables for the selected schema.</p>
</li>
<li>
<p>Current table level: shows the table content for the selected table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following screenshots show the information shown at each level, for a user that realized the following navigation steps.
Selects the <em>"public"</em> schema &#8594; Selects the <em>"country"</em> table.</p>
</div>
<div class="paragraph">
<p><em>Schema Selection</em>:</p>
</div>
<div class="paragraph">
<p>Clicking on the <em>Open</em> button opens the <em>Current schema level</em> for the selected schema.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser1.png" alt="DataSourceContentBrowser1">
</div>
<div class="title">Figure 244. Database schemas</div>
</div>
<div class="paragraph">
<p><em>Table Selection</em>:</p>
</div>
<div class="paragraph">
<p>Clicking on the <em>Open</em> button opens the <em>Current table level</em> for the selected table.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser2.png" alt="DataSourceContentBrowser2">
</div>
<div class="title">Figure 245. Schema tables</div>
</div>
<div class="paragraph">
<p><em>Table information</em>:</p>
</div>
<div class="paragraph">
<p>The rows for the selected table are shown at this level.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser3.png" alt="DataSourceContentBrowser3">
</div>
<div class="title">Figure 246. Table rows</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.externaldatasources"><a class="anchor" href="#_wb.externaldatasources"></a><a class="link" href="#_wb.externaldatasources">15.7.9.7. External Data Sources</a></h5>
<div class="paragraph">
<p>External data sources are typically not defined in Business Central, instead they exist in current container and for some containers like Wildfly 11 or the JBoss EAP 7 servers they can still be listed in read only mode.
In this cases only the <em>Data Source Content Browser</em> is enabled.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/ExternalDataSources.png" alt="ExternalDataSources">
</div>
<div class="title">Figure 247. External Data Sources navigation</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.drivercreation"><a class="anchor" href="#_wb.drivercreation"></a><a class="link" href="#_wb.drivercreation">15.7.9.8. New Driver Wizard</a></h5>
<div class="paragraph">
<p>Clicking on the <em>New Driver</em> action link opens the New Driver Wizard:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDriverWizard.png" alt="NewDriverWizard">
</div>
<div class="title">Figure 248. New Driver Wizard</div>
</div>
<div class="paragraph">
<p>The following required parameters define a Driver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: A unique name for the driver definition.</p>
</li>
<li>
<p>Driver Class Name: The java fully qualified name for the class that implements the JDBC driver contract.</p>
</li>
<li>
<p>Group Id: The maven group id for the artifact that contains the JDBC driver implementation.</p>
</li>
<li>
<p>Artifact Id: The maven artifact id for the artifact that contains the JDBC driver implementation.</p>
</li>
<li>
<p>Version: The maven version for the artifact that contains the JDBC driver implementation.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some commercial database drivers (like Oracle) are not available in the maven central repository.
You can use those by first uploading them via <em>Artifact Repository</em> page and then continue with the driver configuration as for the drivers available in the maven central repository.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.drivereditor"><a class="anchor" href="#_wb.drivereditor"></a><a class="link" href="#_wb.drivereditor">15.7.9.9. Driver Editor</a></h5>
<div class="paragraph">
<p>The <em>Driver Editor</em> is opened by clicking on a driver item in the <em>Data Source Explorer</em>.</p>
</div>
<div class="paragraph">
<p>The following screenshot shows the <em>Driver Editor</em> opened for the driver of the example above.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DriverEditor.png" alt="DriverEditor">
</div>
<div class="title">Figure 249. Driver Editor</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Main Panel: The main panel basically lets you modify the driver configuration parameters.
See <em>New Driver Wizard</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_wb.bydefaultdrivers"><a class="anchor" href="#_wb.bydefaultdrivers"></a><a class="link" href="#_wb.bydefaultdrivers">15.7.9.10. By Default Drivers</a></h5>
<div class="paragraph">
<p>The system is shipped with a set of by default configured drivers for the most common used open source databases.
And they are aligned with the latest database versions supported by the Wildfly 11 and the JBoss EAP 7 servers.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DefaultDrivers.png" alt="DefaultDrivers">
</div>
<div class="title">Figure 250. By Default Drivers</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default drivers initialization can be enabled by setting the datasource.management.disableDefaultDrivers configuration property to false.
It can be set by configuring the proper value in the datasource-management.properties file, or by passing the system property  -Ddatasource.management.disableDefaultDrivers=false to the JVM.
For more information see Advanced Settings.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings"><a class="anchor" href="#_wb.advancedsettings"></a><a class="link" href="#_wb.advancedsettings">15.7.9.11. Advanced Settings</a></h5>
<div class="paragraph">
<p>The data source management system advanced settings can be found in the datasource-management.properties file in the WEB-INF/classes
directory of the given Business Central distribution file.</p>
</div>
<div class="paragraph">
<p>The data source management system has the ability of working with two different internal implementations for the data
sources and drivers. An implementation based on the Wildfly/EAP native data sources and drivers, and a container
independent implementation.
Wildfly/EAP Business Central distributions are configured by default for using the native Wildlfy/EAP
containers implementations, and Tomcat8 distributions are configured for using the container independent implementations.
This latter implementation can also be used for Wildfly/EAP containers.</p>
</div>
<div class="paragraph">
<p>The valid combinations are:</p>
</div>
<div class="paragraph">
<p>WildflyDataSourceProvider + WildflyDriverProvider<br>
or<br>
DBCPDataSourceProvider + DBCPDriverProvider</p>
</div>
<div class="paragraph">
<p>The datasource.management.wildfly.xxxxx  properties are only suited for the WildflyXXXProviders.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings.wildlfy"><a class="anchor" href="#_wb.advancedsettings.wildlfy"></a><a class="link" href="#_wb.advancedsettings.wildlfy">15.7.9.12. Advanced Settings for Business Central Wildlfy/EAP distributions</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Property name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">By default value</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.DataSourceProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">WildflyDataSourceProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.DriverProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">WildflyDriverProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.disableDefaultDrivers</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Set to false to enable the default database drivers initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.wildfly.host</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Name or ip address used for the Wildlfy server management interface binding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.wildfly.port</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">9990</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Port used for the Wildlfy server management interface binding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.wildfly.admin</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Administration user for connecting to the Wildfly server running current Business Central. In general it&#8217;s not necessary to set this value but might be needed in cases when the Wildlfy management interface is bound to an address different than localhost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.wildfly.password</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Administration user password for connecting to the Wildfly server running current Business Central. In general it&#8217;s not necessary to set this value but might be needed in cases when the Wildlfy management interface is bound to an address different than localhost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.wildfly.realm</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">ManagementRealm</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Realm for the administration user authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.wildfly.profile</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The profile name used for starting the Wildfly domain, e.g. default, full, full-ha, etc. This value must only by set when Business Central is running in clustering mode and the hosting Wildfly servers are configured by using domains. Do not set if the Wildlfy servers are running as standalone servers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.wildfly.serverGroup</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The server group to which current Wildfly server instance belongs, e.g. primary-server-group, etc. This value must only by set when Business Central is running in clustering mode and the hosting Wildfly servers are configured by using domains. Do not set if the Wildlfy servers are running as standalone servers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.DefChangeHandler</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">This value must only by set when Business Central is running in clustering mode. If the hosting Wildfly servers are configured by using domains the following value must be used <em>DomainModeChangeHandler</em> and the following value <em>StandaloneModeChangeHandler</em> must be used in cases when the hosting Wildlfy servers are running as standalone servers.
Clustering installations that uses the DBCPXXXProviders must be configured for using the <em>StandaloneModeChangeHandler</em>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The properties above can also be set by passing system properties to the JVM using the Java standard mechanism. e.g. -Ddatasource.management.wildfly.port=1234.
Values configured by using this mechanism will override the values configured in the datasource-management.properties file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings.tomcat"><a class="anchor" href="#_wb.advancedsettings.tomcat"></a><a class="link" href="#_wb.advancedsettings.tomcat">15.7.9.13. Advanced Settings for Tomcat distributions</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Property name</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">By default value</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.DataSourceProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">DBCPDataSourceProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">This is the only option available for Tomcat 8 distributions, see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.DriverProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">DBCPDriverProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">This is the only option available for Tomcat 8 distributions, see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.disableDefaultDrivers</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Set to false to enable the default database drivers initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">datasource.management.DefChangeHandler</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">This value must only by set when Business Central is running in clustering mode. Tomcat distributions only support the
<em>StandaloneModeChangeHandler</em> value.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The properties above can also be set by passing system properties to the JVM using the Java standard mechanism. e.g. -Ddatasource.management.wildfly.port=1234.
Values configured by using this mechanism will override the values configured in the datasource-management.properties file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.userandgroupmgmt"><a class="anchor" href="#_wb.userandgroupmgmt"></a><a class="link" href="#_wb.userandgroupmgmt">15.8. Security management</a></h3>
<div class="paragraph">
<p>This section describes how administrator users can manage the application&#8217;s users, groups and permissions using an intuitive and friendly user interface in order to
configure who can access the different resources and features available.</p>
</div>
<div class="sect3">
<h4 id="_basic_concepts"><a class="anchor" href="#_basic_concepts"></a><a class="link" href="#_basic_concepts">15.8.1. Basic concepts</a></h4>
<div class="sect4">
<h5 id="_introduction_to_business_central_users_groups_and_roles"><a class="anchor" href="#_introduction_to_business_central_users_groups_and_roles"></a><a class="link" href="#_introduction_to_business_central_users_groups_and_roles">15.8.1.1. Introduction to Business Central users, groups and roles</a></h5>
<div class="paragraph">
<p>The Business Central security domain defines three kind of entities: <em>user</em>, <em>group</em> and <em>role</em>.</p>
</div>
<div class="paragraph">
<p>The security entities are being registered in the domain by consuming some <em>realm</em>. The realm can be either the application server&#8217;s one (Wildfly, EAP, Tomcat) or any other of the supported types, for example, using some Keycloak remote server that performs handles the target realm.</p>
</div>
<div class="paragraph">
<p>On the other hand, it&#8217;s important to notice that each realm provides, or potentially provides, its own capabilities, semantics or structure on the security domain. These kind of differences on the security domain results on inconsistencies between different environments when moving into the Business Central security domain. This way there exist some conventions which are important to understand - how security entities are being declared and how the platform behaves behind that complexity,</p>
</div>
<div class="paragraph">
<p>The way Business Central integrates the security entities from an external realm corresponds to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>User</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A user, rather than attributes and any other kind of metadata, which can be different across domains, represents the same kind of entity in any of the supported security environments (Wildfly, EAP, Tomcat, Keycloak, etc), so the entity results in a user on Business Central as well</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Role</strong> / <strong>Group</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both role and group are security entities, but rather than a user, the semantics, the behaviors or the structure in the domain is not usually common across environments. As an example consider that exist domains which do not support both, or domains were the semantics for group or role differs.
As it results domain specific, the way the application behaves and figures out if an entity should be considered a group or a role, it&#8217;s by checking the application&#8217;s Role Registry. This way an entity will be considered an role in case it&#8217;s identifier is present in the application&#8217;s Role Registry, otherwise the entity will be considered as a group.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Role Registry</strong> is an application&#8217;s component that provides the set of roles in the Business Central security domain. It&#8217;s being populated by consuming the entities (<em>role-name</em>) declared in the <em>security-constraints</em> section on the application&#8217;s deployment descriptor (<em>web.xml</em>).
See source file <em>org.uberfire.ext.security.server.RolesRegistry</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It means that depending on the concrete environment&#8217;s configuration, some entity can be as a role, on the security environment consumed by Business Central, but it results a group in the Business Central security domain, or vice versa. It depends on the entity&#8217;s identifier by checking it it is present in the Role Registry.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A User can be assigned to multiple roles and groups, but it is mandatory to have at least, a single role assignment for being considered valid in the Business Central security domain.
It does not mean, for instance, that the user is able login, or able to consume remote services, because it depends on the concrete role/s assigned and how the roles and permissions are defined the application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_permissions"><a class="anchor" href="#_permissions"></a><a class="link" href="#_permissions">15.8.1.2. Permissions</a></h5>
<div class="paragraph">
<p>A permission is basically something the user can do within the application. Usually, an action related to a specific resource. For instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View a page</p>
</li>
<li>
<p>Save a project</p>
</li>
<li>
<p>View a repository</p>
</li>
<li>
<p>Delete a dashboard</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A permission can be granted or denied and it can be global or resource specific. For instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global: Create new pages</p>
</li>
<li>
<p>Specific: View the home page</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you can see, a permission is a <code>resource + action</code> pair. In the concrete case of a page we have: <em>read</em>, <em>update</em>, <em>delete</em> and <em>create</em> as the available actions. That means that there are four possible permissions that could be granted for pages.</p>
</div>
<div class="paragraph">
<p>Permissions do not necessarily need to be tied to a resource. Sometimes it is also necessary to protect access to specific features, like for instance "<em>generate a sales report</em>". That means, permissions can be used not only to protect access to resources but also to custom features within the application.</p>
</div>
</div>
<div class="sect4">
<h5 id="_authorization_policy"><a class="anchor" href="#_authorization_policy"></a><a class="link" href="#_authorization_policy">15.8.1.3. Authorization policy</a></h5>
<div class="paragraph">
<p>The set of permissions assigned to every role and/or group is called the authorization (or security) policy. Every application contains a single security policy which is used every time the system checks a permission.</p>
</div>
<div class="paragraph">
<p>The authorization policy file is stored in a file called <em>WEB-INF/classes/security-policy.properties</em> under the application&#8217;s WAR structure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no policy is defined then the authorization management features are disabled
and the application behaves as if all the resources &amp; features were granted by default.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example of a security policy file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Role "admin"
role.admin.permission.perspective.read=true
role.admin.permission.perspective.read.Dashboard=false

# Role "user"
role.user.permission.perspective.read=false
role.user.permission.perspective.read.Home=true
role.user.permission.perspective.read.Dashboard=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every entry defines a single permission which is assigned to a role/group. On application start up, the policy file is loaded and stored into memory.</p>
</div>
</div>
<div class="sect4">
<h5 id="_security_provider"><a class="anchor" href="#_security_provider"></a><a class="link" href="#_security_provider">15.8.1.4. Security provider</a></h5>
<div class="paragraph">
<p>A security environment is usually provided by the use of a <em>realm</em>.
Realms are used to restrict access to the different application&#8217;s resources.
So realms contains the information about the users, groups, roles, permissions and any other related information.</p>
</div>
<div class="paragraph">
<p>In most typical scenarios the application&#8217;s security is delegated to the container&#8217;s security mechanism, which consumes a given realm at same time.
It&#8217;s important to consider that there exist several realm implementations, for example Wildfly provides a realm based on the <em>application-users.properties</em>/<em>application-roles.properties</em> files, Tomcat provides a realm based on the <em>tomcat-users.xml</em> file, etc.
So there is no single security realm to rely on, it can be different in each installation.</p>
</div>
<div class="paragraph">
<p>Due to the potential different security environments that have to be supported, the security module provides a well defined API with some default built-in security providers.
A <strong>security provider</strong> is the formal name given to a concrete user and group management service implementation for a given realm.</p>
</div>
<div class="paragraph">
<p>The user &amp; group management features available will depend on the security provider configured.
If the built-in providers do not fit with the application&#8217;s security realm, it is easy to build and register your own provider.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installation_and_setup"><a class="anchor" href="#_installation_and_setup"></a><a class="link" href="#_installation_and_setup">15.8.2. Installation and setup</a></h4>
<div class="paragraph">
<p>At the time of this writing, the application provides two pre-installed security providers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Wildfly 11 / EAP 7 distribution</strong> - Both distributions use the <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-wildfly">Wildfly security provider</a> configured for the use of the default realm files <em>application-users.properties</em> and <em>application-roles.properties</em></p>
</li>
<li>
<p><strong>Tomcat distribution</strong> - It uses the <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-tomcat">Tomcat security provider</a> configured for the use of the default realm file <em>tomcat-users.xml</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider&#8217;s documentation</a> in order to apply the concrete settings for the target deployment environment.</p>
</div>
<div class="paragraph">
<p>On the other hand, when either using a custom security provider or using one of the availables, consider the following installation options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable the security management feature on an existing WAR distribution</p>
</li>
<li>
<p>Setup and installation in an existing or new project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>NOTE</em>: If no security provider is installed, there will be no available user interface for managing the security realm.
Once a security provider is installed and setup, the user and group management features are automatically enabled in the security management UI (see the <a href="#_usage">Usage</a> section below).</p>
</div>
<div class="sect4">
<h5 id="_enabling_user_group_management"><a class="anchor" href="#_enabling_user_group_management"></a><a class="link" href="#_enabling_user_group_management">15.8.2.1. Enabling user &amp; group management</a></h5>
<div class="paragraph">
<p>Given an existing WAR distribution, follow these steps in order to install and enable the user &amp; group management features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure the following libraries are present on <em>WEB-INF/lib</em>:</p>
<div class="ulist">
<ul>
<li>
<p>WEB-INF/lib/uberfire-security-management-api-?.jar</p>
</li>
<li>
<p>WEB-INF/lib/uberfire-security-management-backend-?.jar</p>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the security provider library to <em>WEB-INF/lib</em>:</p>
<div class="ulist">
<ul>
<li>
<p>Eg: WEB-INF/lib/uberfire-security-management-wildfly-?.jar</p>
</li>
<li>
<p>If the provider requires additional libraries, copy them as well (read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider&#8217;s documentation</a> for more information).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Replace the whole content of the <em>WEB-INF/classes/security-management.properties</em> file, or if not present, create it. The settings present on this file depend on the concrete implementation used. Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider&#8217;s documentation</a> for more information.</p>
</li>
<li>
<p>If deploying on Wildfly or EAP, check if the <em>WEB-INF/jboss-deployment-structure.xml </em>requires any update (read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider&#8217;s documentation</a> for more information).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_disabling_user_group_management"><a class="anchor" href="#_disabling_user_group_management"></a><a class="link" href="#_disabling_user_group_management">15.8.2.2. Disabling user &amp; group management</a></h5>
<div class="paragraph">
<p>The user &amp; groups management features can be disabled, and thus no services or user interface will be available, by means of either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uninstalling the security provider from the application</p>
<div class="paragraph">
<p>When no concrete security provider is installed, the user and group management features will be disabled and no services or user interface will be displayed to the user. This is the case for instance, in
<em>Weblogic</em> and <em>Websphere</em> installations as there is no a security provider implementation available at the time of this writing.</p>
</div>
</li>
<li>
<p>Removing or commenting the security management configuration file</p>
<div class="paragraph">
<p>Removing or commenting all the lines in the configuration file located at<em> WEB-INF/classes/security-management.properties</em> is another way to disable the user and group management features.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_upgrading_an_existing_installation"><a class="anchor" href="#_upgrading_an_existing_installation"></a><a class="link" href="#_upgrading_an_existing_installation">15.8.2.3. Upgrading an existing installation</a></h5>
<div class="paragraph">
<p>In versions prior to 7, the only way to grant access to resources like Organizational Units, Repositories or Projects was to indicate which roles were able to access a given instance. Those roles were stored in GIT as part of the instance persistent status. The CLI was the tool used to add/remove roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>remove-role-repo</strong>: remove role(s) from repository</p>
</li>
<li>
<p><strong>add-role-org-unit</strong>: add role(s) to organizational unit</p>
</li>
<li>
<p><strong>remove-role-org-unit</strong>: remove role(s) from organizational unit</p>
</li>
<li>
<p><strong>add-role-project</strong>: add role(s) to project</p>
</li>
<li>
<p><strong>remove-role-project</strong>: remove role(s) from project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As of version 7, the authorization policy is based on permissions. That means is no longer required to keep a list of roles per resource instance. What is required is to define proper permission entries into the active authorization policy using the security management UI (see the <a href="#_usage">Usage</a> section below).</p>
</div>
<div class="paragraph">
<p>The commands above are no longer required so they have been removed. Basically, what those commands did is to set what roles were able to read a specific item.</p>
</div>
<div class="paragraph">
<p>In order to guarantee backward compatibility with versions prior to 7, an automatic migration tool is bundled within the application, which converts the list of roles assigned to any organizational unit, repository or project into read permission entries of the security policy.</p>
</div>
<div class="paragraph">
<p>This tool is executed when the application start ups for the first time, during the security policy deployment. So existing customers, do not have to worry about it, as they will keep their security settings.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">15.8.3. Usage</a></h4>
<div class="paragraph">
<p>The Security Management page is available under the <em>Home</em> section in the top menu bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementMenuEntry.png" alt="SecurityManagementMenuEntry">
</div>
<div class="title">Figure 251. Link to the Security Management page</div>
</div>
<div class="paragraph">
<p>The next screenshot shows how this new page looks:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementHome.png" alt="SecurityManagementHome">
</div>
<div class="title">Figure 252. Security Management Home</div>
</div>
<div class="paragraph">
<p>This page supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List all the roles, groups and users available</p>
</li>
<li>
<p>Create &amp; delete users and groups</p>
</li>
<li>
<p>Edit users, assign roles or groups, and change user properties</p>
</li>
<li>
<p>Edit both roles &amp; groups security settings, which include:</p>
<div class="ulist">
<ul>
<li>
<p>The home page a user will be directed to after login</p>
</li>
<li>
<p>The permissions granted or denied to the different Business Central resources and features available</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of the above together provides a complete users and groups management subsystem as well as a permission configuration UI for protecting access to specific resources or features.</p>
</div>
<div class="paragraph">
<p>The next sections provide a deep insight into all these features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The user and group management related features can be entirely disabled. See the previous section
 <a href="#_disabling_user_group_management">Disabling user &amp; group management</a>. If that&#8217;s the case then both the <em>Groups and _Users</em> tabs will remain hidden from the user.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_user_management"><a class="anchor" href="#_user_management"></a><a class="link" href="#_user_management">15.8.3.1. User management</a></h5>
<div class="paragraph">
<p>By selecting the <em>Users</em> tab in the left sidebar, the application shows all the users present by default on the application&#8217;s security realm:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUsersExplorer.png" alt="SecurityManagementUsersExplorer">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for users</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to listing all the users, search is also allowed:</p>
</div>
<div class="paragraph">
<p>+
When specifying the search pattern in the search box the users listed will be reduced to only those that matches the search pattern.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUsersSearch.png" alt="SecurityManagementUsersSearch">
</div>
</div>
<div class="paragraph">
<p>+
Search patterns depend on the concrete security provider being used by the application.
Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider&#8217;s documentation</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Creating new users</strong></p>
<div class="paragraph">
<p>By clicking on the "<em>New user +</em>" anchor, a form is displayed on the screen&#8217;s right.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementNewUserForm.png" alt="SecurityManagementNewUserForm">
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a wizard like interface where the application asks for the new user name, a password as well as what roles/groups to assign.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Editing a user</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After clicking on a user in the left sidebar, the user editor is opened on the screen&#8217;s right.</p>
</div>
<div class="paragraph">
<p>For instance, the details screen for the <em>admin</em> user when using the Wildfly security provider looks like the following screenshot:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementViewUser.png" alt="SecurityManagementViewUser">
</div>
</div>
<div class="paragraph">
<p>Same screen but when using the Keycloak security provider looks as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementViewUserKC.png" alt="SecurityManagementViewUserKC">
</div>
</div>
<div class="paragraph">
<p>Note that when using the Keycloak provider, a new user attributes section is displayed, but it&#8217;s not present when using the Wildfly provider.
This is due to the fact that the information and actions available always depend on each provider&#8217;s capabilities as explained in the
<a href="#_security_provider_capabilities">Security provider capabilities</a> section below.</p>
</div>
<div class="paragraph">
<p>Next is the type of information handled in the user&#8217;s details screen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user name</p>
</li>
<li>
<p>The user&#8217;s attributes</p>
</li>
<li>
<p>The assigned groups</p>
</li>
<li>
<p>The assigned roles</p>
</li>
<li>
<p>The permissions granted or denied</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to <strong>update or delete an existing user</strong>, click the <em>Edit</em> button present near to the username in the user editor screen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementEditUser.png" alt="SecurityManagementEditUser">
</div>
</div>
<div class="paragraph">
<p>Once the editor is in edit mode, different operations can be done (provided the security provider supports them):</p>
</div>
<div class="paragraph">
<p>For instance, to modify the set of roles and groups assigned to the user or to change the user&#8217;s password as well.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Permissions summary</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Permissions</em> tab shows a summary of all the permissions assigned to this particular user. This is a very helpful view as it allows
administrator users to verify if a target user has the right permission levels according to the security settings of its roles and
groups.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUserPermissions.png" alt="SecurityManagementUserPermissions">
</div>
</div>
<div class="paragraph">
<p>Further details about how to assign permissions to roles and groups are in the <a href="#_security_settings_editor">Security Settings Editor</a> section below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Updating the user&#8217;s attributes</strong></p>
<div class="paragraph">
<p>User attributes can be added or deleted using the actions available in the attributes table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUserAttributes.png" alt="SecurityManagementUserAttributes">
</div>
</div>
</li>
<li>
<p><strong>Updating assigned groups</strong></p>
<div class="paragraph">
<p>From the <em>Groups</em> tab, a group selection popup is presented when clicking on the <em>Add to groups</em> button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementGroupsSelection.png" alt="SecurityManagementGroupsSelection">
</div>
</div>
<div class="paragraph">
<p>This popup screen allows the user to search and select or deselect the groups assigned to the user.</p>
</div>
</li>
<li>
<p><strong>Updating assigned roles</strong></p>
<div class="paragraph">
<p>From the <em>Roles</em> tab, a role selection popup is presented when clicking on <em>Add to roles</em> button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRolesSelection.png" alt="SecurityManagementRolesSelection">
</div>
</div>
<div class="paragraph">
<p>This popup screen allows the user to search and select or deselect the roles assigned to the user.</p>
</div>
</li>
<li>
<p><strong>Changing the user&#8217;s password</strong></p>
<div class="paragraph">
<p>A change password popup screen is presented when clicking on the <em>Change password</em> button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementChangePassword.png" alt="SecurityManagementChangePassword">
</div>
</div>
</li>
<li>
<p><strong>Deleting users</strong></p>
<div class="paragraph">
<p>The user currently being edited can be deleted from the realm by clicking on the <em>Delete</em> button.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementDeleteUser.png" alt="SecurityManagementDeleteUser">
</div>
</div>
<div class="sect5">
<h6 id="_security_provider_capabilities"><a class="anchor" href="#_security_provider_capabilities"></a><a class="link" href="#_security_provider_capabilities">Security provider capabilities</a></h6>
<div class="paragraph">
<p>Each security realm can provide support for different operations.
For example consider the use of a Wildfly&#8217;s realm based on properties files. The contents for the <em>applications-users.properties</em> is like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>admin=207b6e0cc556d7084b5e2db7d822555c
salaboy=d4af256e7007fea2e581d539e05edd1b
maciej=3c8609f5e0c908a8c361ca633ed23844
kris=0bfd0f47d4817f2557c91cbab38bb92d
katy=fd37b5d0b82ce027bfad677a54fbccee
john=afda4373c6021f3f5841cd6c0a027244
jack=984ba30e11dda7b9ed86ba7b73d01481
director=6b7f87a92b62bedd0a5a94c98bd83e21
user=c5568adea472163dfc00c19c6348a665
guest=b5d048a237bfd2874b6928e1f37ee15e
kiewb=78541b7b451d8012223f29ba5141bcc2
kieserver=16c6511893651c9b4b57e0c027a96075</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that it&#8217;s based on key-value pairs where the key is the <em>username</em>, and the value is the hashed value for the user&#8217;s <em>password</em>.
So a user is just represented by a key and its username, it does not have a name nor an address or any other meta information.</p>
</div>
<div class="paragraph">
<p>On the other hand, consider the use of a realm provided by a Keycloak server.
The user information is composed by more meta-data, such as the surname, address, etc, as in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementViewUserKC.png" alt="SecurityManagementViewUserKC">
</div>
</div>
<div class="paragraph">
<p>So the different services and client side components from the User and Group Management API are based on <em>capabilities</em>. <strong>Capabilities</strong> are used to expose or restrict the available functionality provided by the different services and client side components.
Examples of capabilities are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a user</p>
</li>
<li>
<p>Update a user</p>
</li>
<li>
<p>Delete a user</p>
</li>
<li>
<p>Update user&#8217;s attributes</p>
</li>
<li>
<p>Create a group</p>
</li>
<li>
<p>Update a group</p>
</li>
<li>
<p>Assign groups to a user</p>
</li>
<li>
<p>Assign roles to a user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each security provider must specify a set of capabilities supported. From the previous examples, it is noted that the Wildfly security provider does not support the attributes management capability - the user is only composed by the user name. On the other hand the Keycloak provider does support this capability.</p>
</div>
<div class="paragraph">
<p>The different views and user interface components rely on the capabilities supported by each provider, so if a capability is not supported by the provider in use, the UI does not
provide the views for the management of that capability. As an example, consider that a concrete provider does not support deleting users - the delete user button on the user interface
will be not available.</p>
</div>
<div class="paragraph">
<p>Please take a look at the concrete service provider documentation to check all the supported capabilities for each one, the default ones can be found <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_group_management"><a class="anchor" href="#_group_management"></a><a class="link" href="#_group_management">15.8.3.2. Group management</a></h5>
<div class="paragraph">
<p>By selecting the <em>Groups</em> tab in the left sidebar, the application shows all the groups present by default on the application&#8217;s security realm:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementGroupsExplorer.png" alt="SecurityManagementGroupsExplorer">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for groups</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to listing all the groups, search is also allowed:</p>
</div>
<div class="paragraph">
<p>+
When specifying the search pattern in the search box the groups listed will be reduced to only those that matches the search pattern.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementGroupsSearch.png" alt="SecurityManagementGroupsSearch">
</div>
</div>
<div class="paragraph">
<p>+
Search patterns depend on the concrete security provider being used by the application.
Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider&#8217;s documentation</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Creating new groups</strong></p>
<div class="paragraph">
<p>By clicking on the "<em>New group +</em>" anchor, a new screen will be presented on the center panel to perform a new group creation.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementNewGroup.png" alt="SecurityManagementNewGroup">
</div>
</div>
<div class="paragraph">
<p>After typing a name anc clicking <em>Save</em>, the next step is to assign users to it:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementNewGroupUserSelection.png" alt="SecurityManagementNewGroupUserSelection">
</div>
</div>
<div class="paragraph">
<p>+
Clicking on the "<em>Add selected users</em>" button finishes the group creation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Modifying a group</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After clicking on a group in the left sidebar, the security settings editor for the selected group instance is opened on the screen&#8217;s right. Further details at the
<a href="#_security_settings_editor">Security Settings Editor</a> section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Deleting groups</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To delete an existing group just click the <em>Delete</em> button.</p>
</div>
</div>
<div class="sect4">
<h5 id="_role_management"><a class="anchor" href="#_role_management"></a><a class="link" href="#_role_management">15.8.3.3. Role management</a></h5>
<div class="paragraph">
<p>By selecting the <em>Roles</em> tab in the left sidebar, the application shows all the application roles:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRolesExplorer.png" alt="SecurityManagementRolesExplorer">
</div>
</div>
<div class="paragraph">
<p>Unlike users and groups, roles can not be created nor deleted as they come from the application&#8217;s web.xml descriptor. After clicking on a role in the left sidebar, the role editor is opened on the screens
right, which is exactly the same security settings editor used for groups. Further details at the <a href="#_security_settings_editor">Security Settings Editor</a> section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementEditRole.png" alt="SecurityManagementEditRole">
</div>
</div>
<div class="paragraph">
<p>That means both role and group based permissions can be defined. The main diference between roles and group are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roles are an application defined resource. They are defined as &lt;security-role&gt; entries in the application&#8217;s web.xml descriptor.</p>
</li>
<li>
<p>Groups are dynamic and can be defined at runtime. The installed security provider determines where groups instances are stored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They can be used together without any trouble. Groups are recommended though as they are a more flexible than roles.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for roles</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to listing all the roles, search is also allowed:</p>
</div>
<div class="paragraph">
<p>+
When specifying the search pattern in the search box the roles listed will be reduced to only those that matches the search pattern.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRolesSearch.png" alt="SecurityManagementRolesSearch">
</div>
</div>
<div class="paragraph">
<p>+
Search patterns depend on the concrete security provider being used by the application.
Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider&#8217;s documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_settings_editor"><a class="anchor" href="#_security_settings_editor"></a><a class="link" href="#_security_settings_editor">15.8.4. Security Settings Editor</a></h4>
<div class="paragraph">
<p>This editor is used to set several security settings for both roles and groups.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementSecuritySettsEditor.png" alt="SecurityManagementSecuritySettsEditor">
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="sect4">
<h5 id="_home_page"><a class="anchor" href="#_home_page"></a><a class="link" href="#_home_page">15.8.4.1. Home page</a></h5>
<div class="paragraph">
<p>This is the page where the user is directed after login. This makes it possible to have different home pages for different users, since users can be assigned to
different roles or groups.</p>
</div>
</div>
<div class="sect4">
<h5 id="_priority"><a class="anchor" href="#_priority"></a><a class="link" href="#_priority">15.8.4.2. Priority</a></h5>
<div class="paragraph">
<p>It is used to determine what settings (home page, permissions, &#8230;&#8203;) have precedence for those users with more than one role or group assigned.</p>
</div>
<div class="paragraph">
<p>Without this setting, it won&#8217;t be possible to determine what role/group should take precedence. For instance, an administrative role has higher priority than a
non-administrative one. For users with both administrative and non-administrative roles granted, administrative privileges will always win, provided the administrative role&#8217;s
priority is greater than the other.</p>
</div>
</div>
<div class="sect4">
<h5 id="_permissions_2"><a class="anchor" href="#_permissions_2"></a><a class="link" href="#_permissions_2">15.8.4.3. Permissions</a></h5>
<div class="paragraph">
<p>Currently, Business Central support the following permission categories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Business Central: General Business Central permissions, not tied to any specific resource type.</p>
</li>
<li>
<p>Pages: If access to a page is denied then it will not be shown in any of application menus. Update, Delete and Create permissions change the behaviour of the page management plugin editor.</p>
</li>
<li>
<p>Organizational Units: Sets who can Create, Update or Delete organizational units from the Organizational Unit section at the Administration page. Sets also what organizational units are visible in the Project Explorer at the Project Authoring page.</p>
</li>
<li>
<p>Repositories: Sets who can Create, Update or Delete repositories from the Repositories section at the Administration page. Sets also what repositories are visible in the Project Explorer at the Project Authoring page.</p>
</li>
<li>
<p>Projects: In the Project Authoring page, sets who can Create, Update, Delete or Build projects from the Project Editor screen as well as what projects are visible in the Project Explorer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For pages, organizational units, repositories and projects it is possible to define global permissions and add single instance exceptions afterwards. For instance,
<em>Read</em> access can be granted to all the pages and deny access just to an individual page. This is called the <em>grant all deny a few</em> strategy.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementPerspectiveDenied.png" alt="SecurityManagementPerspectiveDenied">
</div>
</div>
<div class="paragraph">
<p>The opposite, <em>deny all grant a few</em> strategy is also supported:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementPerspectiveGranted.png" alt="SecurityManagementPerspectiveGranted">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the example above, the <em>Update</em> and <em>Delete</em> permissions are disabled as it does not make sense to define such permissions if the user is not even able to read
pages.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_policy_storage"><a class="anchor" href="#_security_policy_storage"></a><a class="link" href="#_security_policy_storage">15.8.5. Security Policy Storage</a></h4>
<div class="paragraph">
<p>The security policy is stored under the Business Central VFS. Most concrete, in a GIT repo called security.
The ACL table is stored in a file called security-policy.properties under the authz directory. Next is an example of the entries this file contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>role.admin.home=HomePage
role.admin.priority=0
role.admin.permission.perspective.read=true
role.admin.permission.perspective.create=true
role.admin.permission.perspective.delete=true
role.admin.permission.perspective.update=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every time the ACL is modified from the security settings UI the changes are stored into the GIT repo.</p>
</div>
<div class="paragraph">
<p>Initially, when the application is deployed for the first time there is no security policy stored in GIT. However, the application might need to set-up a default policy with the different access profiles for each of the application roles.</p>
</div>
<div class="paragraph">
<p>In order to support default policies the system allows for declaring a security policy as part of the webapps content. This can be done just by placing a security-policy.properties file under the webapps resource classpath (the WEB-INF/classes directory
inside the WAR archive is a valid one). On app start-up the following steps are executed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check if an active policy is already stored in GIT</p>
</li>
<li>
<p>If not, then check if a policy has been defined under the webapps classpath</p>
</li>
<li>
<p>If found, such policy is stored under GIT</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above is an auto-deploy mechanism which is used in Business Central to set-up its default security policy.</p>
</div>
<div class="paragraph">
<p>One slight variation of the deployment process is the ability to split the security-policy.properties file into small pieces so that it is possible, for example, to define one file
per role. The split files must start by the security-module- prefix, for instance: security-module-admin.properties. The deployment mechanism will read and deploy both the
"security-policy.properties" and all the optional security-module-?.properties found on the classpath.</p>
</div>
<div class="paragraph">
<p>Notice, despite using the split approach, the security-policy.properties must always be present as it is used as a marker file by the security subsystem in order to locate the other policy files.
This split mechanism allows for a better organization of the whole security policy.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.sshkeystore"><a class="anchor" href="#_wb.sshkeystore"></a><a class="link" href="#_wb.sshkeystore">15.9. SSH keystore</a></h3>
<div class="paragraph">
<p>This section provides an overview of the Business Central SSH keystore and includes a guide for platform users. It explains
how to use the Business Central SSH keystore to register and use it&#8217;s SSH public keys.</p>
</div>
<div class="sect3">
<h4 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a><a class="link" href="#_introduction_4">15.9.1. Introduction</a></h4>
<div class="paragraph">
<p>Business Central includes an SSH keystore service to provide proper SSH authentication for users.</p>
</div>
<div class="paragraph">
<p>It provides a configurable default SSH keystore, extensible APIs to allow custom implementations, support for
multiple SSH public keys formats, and a new UI available on the <strong>Admin</strong> page to enable users to register their SSH public keys.</p>
</div>
<div class="sect4">
<h5 id="_the_default_ssh_keystore"><a class="anchor" href="#_the_default_ssh_keystore"></a><a class="link" href="#_the_default_ssh_keystore">15.9.1.1. The default SSH keystore</a></h5>
<div class="paragraph">
<p>The default SSH keystore included with Business Central provides a file-based storage mechanism to store users' SSH public keys.</p>
</div>
<div class="paragraph">
<p>By default, it uses Business Central <code>.security</code> folder as a root path. It is possible to use a custom storage path
by setting the <code>appformer.ssh.keys.storage.folder</code> property to direct to a different folder.</p>
</div>
<div class="paragraph">
<p>The SSH public keys are stored in the <code>{securityFolderPath}/pkeys/{userName}/</code> folder structure.</p>
</div>
<div class="paragraph">
<p>Each SSH public key consists of a pair of files in the storage folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>{keyId}.pub</strong>: a file containing the SSH public key content. The file name determines the logic key ID on the system,
so do not modify the file name during runtime. For example</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDmak4Wu23RZ6XmN94bOsqecZxuTa4RRhhQmHmTZjMB7HM57/90u/B/gB/GhsPEu1nAXL0npY56tT/MPQ8vRm2C2W9A7CzN5+z5yyL3W01YZy3kzslk77CjULjfhrcfQSL3b2sPG5jv5E5/nyC/swSytucwT/PE7aXTS9H6cHIKUdYPzIt94SHoBxWRIK7PJi9d+eLB+hmDzvbVa1ezu5a8yu2kcHi6NxxfI5iRj2rsceDTp0imC1jMoC6ZDfBvZSxL9FXTMwFdNnmTlJveBtv9nAbnAvIWlilS0VOkdj1s3GxBxeZYAcKbcsK9sJzusptk5dxGsG2Z8vInaglN6OaOQ7b7tcomzCYYwviGQ9gRX8sGsVrw39gsDIGYP2tA4bRr7ecHnlNg1b0HCchA5+QCDk4Hbz1UrnHmPA2Lg9c3WGm2qedvQdVJXuS3mlwYOqL40aXPs6890PvFJUlpiVSznF50djPnwsMxJZEf1HdTXgZD1Bh54ogZf7czyUNfkNkE69yJDbTHjpQd0cKUQnu9tVxqmBzhX31yF4VcsMeADcf2Z8wlA3n4LZnC/GwonYlq5+G93zJpFOkPhme8c2XuPuCXF795lsxyJ8SB/AlwPJAhEtm0y0s0l1l4eWqxsDxkBOgN+ivU0czrVMssHJEJb4o0FLf7iHhOW56/iMdD9w== userName</code></pre>
</div>
</div>
</li>
<li>
<p><strong>.{keyId}.pub.meta</strong>: a file containing the key metadata in JSON format. If a key has no metadata, a new metadata file
is dynamically generated. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name":"Key",
    "creationDate":"Oct 10, 2018 10:10:50 PM",
    "lastTimeUsed":"Oct 11, 2018 12:11:23 PM"
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_using_a_custom_ssh_keystore"><a class="anchor" href="#_using_a_custom_ssh_keystore"></a><a class="link" href="#_using_a_custom_ssh_keystore">15.9.1.2. Using a custom SSH keystore</a></h5>
<div class="paragraph">
<p>It is possible to extend and customize the platform default SSH keystore to meet more specific requirements.</p>
</div>
<div class="paragraph">
<p>Use the system property <code>appformer.ssh.keystore</code> to specify the Java class name of the service to use. If the property
does not exist or it contains a wrong value, the default SSH keystore is loaded.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To create a custom implementation of the SSH keystore, your Java Class must implement the class <code>org.uberfire.ssh.service.backend.keystore.SSHKeyStore</code>
defined in the <code>uberfire-ssh-api</code> module.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_ssh_keystore"><a class="anchor" href="#_using_the_ssh_keystore"></a><a class="link" href="#_using_the_ssh_keystore">15.9.2. Using the SSH keystore</a></h4>
<div class="paragraph">
<p>This section describes how to use the SSH keystore to register your own keys and how to use them.</p>
</div>
<div class="sect4">
<h5 id="_the_ssh_keystore_ui"><a class="anchor" href="#_the_ssh_keystore_ui"></a><a class="link" href="#_the_ssh_keystore_ui">15.9.2.1. The SSH keystore UI</a></h5>
<div class="paragraph">
<p>The SSH keystore provides an intuitive UI to enable users to manage their SSH public keys on the system. It is accessible from
the <strong>Admin</strong> page by using the <strong>SSH Keys</strong> menu option.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh keystore menu">
</div>
<div class="title">Figure 253. SSH Keys Menu Option on Admin Page</div>
</div>
<div class="paragraph">
<p>After you click the <strong>SSH Keys</strong> menu option the SSH Keys Editor will open. the editor displays a table showing the user SSH public keys and
provides access to the main action buttons.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Add SSH Key</strong>: Used to add an SSH public key for the user.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-new.png" alt="ssh keystore editor new">
</div>
<div class="title">Figure 254. Adding new SSH public key</div>
</div>
</li>
<li>
<p><strong>Delete SSH Key</strong>: Used to remove an existing SSH public key</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-delete.png" alt="ssh keystore editor delete">
</div>
<div class="title">Figure 255. Deleting a SSH public key</div>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor.png" alt="ssh keystore editor">
</div>
<div class="title">Figure 256. SSH keystore UI</div>
</div>
</div>
<div class="sect4">
<h5 id="_adding_ssh_keys"><a class="anchor" href="#_adding_ssh_keys"></a><a class="link" href="#_adding_ssh_keys">15.9.2.2. Adding SSH keys</a></h5>
<div class="paragraph">
<p>This section  explains step by step how to add an SSH public key to the SSH keystore.</p>
</div>
<div class="sect5">
<h6 id="_creating_the_ssh_key_on_your_computer"><a class="anchor" href="#_creating_the_ssh_key_on_your_computer"></a><a class="link" href="#_creating_the_ssh_key_on_your_computer">Creating the SSH key on your computer</a></h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a terminal on your computer</p>
</li>
<li>
<p>Run the <code>ssh-keygen</code> command to create the key:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ssh-keygen -t rsa -b 4096 -C "&lt;your_user_login_here&gt;"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SSH key formats supported by the keystore are 'ssh-rsa', 'ssh-dss', 'ecdsa-sha2-nistp256', 'ecdsa-sha2-nistp384'
and 'ecdsa-sha2-nistp521'.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When prompted, press <strong>Enter</strong> and accept the default key file location.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Enter a file in which to save the key (/home/&lt;your_login_here&gt;/.ssh/id_rsa): [Press enter]</code></pre>
</div>
</div>
</li>
<li>
<p>When prompted, enter the pass phrase that you want to use.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Enter passphrase (empty for no passphrase): [Type a passphrase]
Enter same passphrase again: [Type passphrase again]</code></pre>
</div>
</div>
</li>
<li>
<p>Start the <code>ssh-agent</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">eval "$(ssh-agent -s)"
Agent pid &lt;any-number-here&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the new SSH private key to the <code>ssh-agent</code>. If you used a different key name, replace <code>id_rsa</code> with your key name</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ssh-add ~/.ssh/id_rsa</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_registering_your_ssh_public_key_with_the_ssh_keystore"><a class="anchor" href="#_registering_your_ssh_public_key_with_the_ssh_keystore"></a><a class="link" href="#_registering_your_ssh_public_key_with_the_ssh_keystore">Registering your SSH public key with the SSH keystore</a></h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Business Central, go to the gear icon next to your login to open the <strong>Admin</strong> page.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-gear.png" alt="ssh keystore editor gear">
</div>
<div class="title">Figure 257. Accessing the Admin Page</div>
</div>
</li>
<li>
<p>Open the SSH keystore UI by clicking the <strong>SSH Keys</strong> menu option.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh keystore menu">
</div>
<div class="title">Figure 258. SSH Keys Menu Option on Admin Page</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-empty.png" alt="ssh keystore editor empty">
</div>
<div class="title">Figure 259. SSH KeysStore UI Without keys</div>
</div>
</li>
<li>
<p>Copy the contents of your SSH Public key onto the clipboard. Use the <code>cat</code> command to display your key content. If you
used a different key name: replace <code>id_rsa</code> with your key name, and copy it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cat ~/.ssh/id_rsa.pub</code></pre>
</div>
</div>
</li>
<li>
<p>In the SSH keystore UI press the <strong>Add SSH Key</strong> button to open the <strong>New SSH public key</strong> form. Specify a name,
copy the key content into the key field and click <strong>Add SSH Key</strong> to register the key.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-new.png" alt="ssh keystore editor new">
</div>
<div class="title">Figure 260. Adding new SSH public key</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong> field cannot be empty, this field defines a meaningful name for the user to identify the key on the SSH public keys table.</p>
</li>
<li>
<p><strong>Key</strong> must be a valid SSH Public key, so it cannot be empty and the key format must be supported by the platform.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.embedding"><a class="anchor" href="#_wb.embedding"></a><a class="link" href="#_wb.embedding">15.10. Embedding Business Central in Your Application</a></h3>
<div class="paragraph">
<p>Apart from the individual perspectives (such as the Library or Content Management), Business Central provides a number of editors used for designing and managing assets in different formats. Within Business Central, each asset type has a corresponding editor.</p>
</div>
<div class="paragraph">
<p>Business Central provides the possibility to embed the perspectives and editors in the user&#8217;s application using the <strong>standalone mode</strong>. Without actually switching to Business Central, it is possible to display perspectives and edit various assets, such as rules, processes, or decision tables, in separate applications.</p>
</div>
<div class="paragraph">
<p>To embed a part of Business Central in an application, Business Central must be deployed and running on a web server or an application server. Then, in your application, include an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">HTML inline frame</a> with the proper HTTP query parameters as described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. HTTP query parameters for the standalone mode</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Parameter</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Values</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>standalone</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">This parameter must be included in each URL of a perspective or an editor that will be used in the standalone mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>perspective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>LibraryPerspective</code>, <code>ContentManagerPerspective</code>, or any custom-created page</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Used for specifying the perspective to be displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>header</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>UberfireBreadcrumbsContainer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Displays the breadcrumbs at the top of the page that can be used for navigating to the lists of spaces and projects within the Library. This parameter can be used only if <code>perspective=LibraryPerspective</code> is specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>default://master@MySpace/Shop/src/main/java/com/Product.java</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Specifies the path to the asset to be opened in a corresponding editor. The path must be specified in the format <code>default://<em>BRANCH</em>@<em>SPACE</em>/<em>PROJECT</em>/<em>PATH_TO_ASSET</em>/<em>ASSET_NAME</em>.<em>FILE_EXTENSION</em></code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 44. Usage examples</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">URL</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=LibraryPerspective" class="bare">http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=LibraryPerspective</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Opens the Library where it is possible to select a project to be managed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=LibraryPerspective&amp;header=UberfireBreadcrumbsContainer" class="bare">http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=LibraryPerspective&amp;header=UberfireBreadcrumbsContainer</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Opens the Library with the list of projects. The <code>header</code> parameter displays the breadcrumbs at the top of the page, which allow the user to switch between the spaces as well as the projects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;path=default://master@MySpace/Shop/src/main/java/com/Product.java" class="bare">http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;path=default://master@MySpace/Shop/src/main/java/com/Product.java</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Opens the editor of the specified asset.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=ContentManagerPerspective" class="bare">http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=ContentManagerPerspective</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Opens the Content Management perspective, where it is possible to create and manage custom pages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=MyCustomPage" class="bare">http://localhost:8080/business-central/kie-wb.jsp?standalone&amp;perspective=MyCustomPage</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Opens the specified custom page that has been created before using the Content Management perspective. The value of the <code>perspective</code> parameter must correspond to the actual name of the page.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_wb.execserverui"><a class="anchor" href="#_wb.execserverui"></a><a class="link" href="#_wb.execserverui">15.11. Execution Server Management UI</a></h3>
<div class="paragraph">
<p>The Execution Server Management UI allows users create and modify Server Templates and Containers, it also allows users manage Remote Servers.
This screen is available via Deploy &#8594; Rule Deployments menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/NewExecServerUI.png" alt="NewExecServerUI">
</div>
<div class="title">Figure 261. Execution Server Management</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The management UI is only available for KIE Managed Servers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_wb.execserveruitemplate"><a class="anchor" href="#_wb.execserveruitemplate"></a><a class="link" href="#_wb.execserveruitemplate">15.11.1. Server Templates</a></h4>
<div class="paragraph">
<p>Server templates are used to define a common configuration that can be used for multiple server, thus the name: Template.</p>
</div>
<div class="paragraph">
<p>Server Templates can be created directly from the management UI or it&#8217;s automatically create when a server connects to Drools controller and there isn&#8217;t a template definition for that remote server.
Server templates may have one or more capabilities, such capabilities can&#8217;t be modified, if you need modify the capabilities you&#8217;ll have to create a new template.
Here is the list of current capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rule (Drools)</p>
</li>
<li>
<p>Process (jBPM)</p>
</li>
<li>
<p>Planning (Optaplanner)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For Planner capability it&#8217;s mandatory to enable Rule&#8217;s capability too.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to create a new Server Template you have to click at New Server Template button and follow the wizard.
It&#8217;s also possible to create a container during Wizard, but for now let&#8217;s limit to just the template.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/NewServerTemplateWizard.png" alt="NewServerTemplateWizard">
</div>
<div class="title">Figure 262. New Server Template Wizard</div>
</div>
<div class="paragraph">
<p>Once created you&#8217;ll get the new Template listed on the left hand side, with the new Server Template highlighted.
On the right hand side you get the 2nd level navigation that lists Containers and Remote Servers that are related to selected Server Template.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/ServerTemplates.png" alt="ServerTemplates">
</div>
<div class="title">Figure 263. Server Templates</div>
</div>
<div class="paragraph">
<p>On top of the navigation is also possible to delete the current Server Template or create a copy of it.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/ServerTemplateActions.png" alt="ServerTemplateActions">
</div>
<div class="title">Figure 264. Server Template Actions</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.execserveruicontainer"><a class="anchor" href="#_wb.execserveruicontainer"></a><a class="link" href="#_wb.execserveruicontainer">15.11.2. Container</a></h4>
<div class="paragraph">
<p>A Container is a KIE Container configuration of the Server Template.
Click the Add Container button to create a new container for the current Server Template.</p>
</div>
<div class="paragraph">
<p>The search area can help users find an specific KJARs that they are looking for.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/NewContainerWizard.png" alt="NewContainerWizard">
</div>
<div class="title">Figure 265. New Container Wizard</div>
</div>
<div class="paragraph">
<p>For Server Templates that have Process capabilities enabled, the Wizard has a 2nd optional step where users can configure some process related behaviors.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/ProcessConfigNewContainerWizard.png" alt="ProcessConfigNewContainerWizard">
</div>
<div class="title">Figure 266. Process Configuration</div>
</div>
<div class="paragraph">
<p><strong>Kie Base Name</strong> determines which Kie Base of the deployed artifact will be used.</p>
</div>
<div class="paragraph">
<p><strong>Kie Session Name</strong> determines which Kie Session of the selected Kie Base will be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please notice that configurations on this tab takes effect only if the deployed project contains some business processeses. It is not enough if the server template has the extension for processes enabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once created the new Container will be displayed on the containers list just above the list of remote servers.
Just after created a container is by default Stopped which is the only state that allows users to remove it.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/NewContainer.png" alt="NewContainer">
</div>
<div class="title">Figure 267. Container</div>
</div>
<div class="paragraph">
<p>A Container has the following tabs available for management and/or configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Status</p>
</li>
<li>
<p>Version Configuration</p>
</li>
<li>
<p>Process Configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Status tab lists all the Remote Servers that are running the active Container.
Each Remote Server is rendered as a Card, which displays to users status and endpoint.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only started Containers are deployed to remote servers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/ContainerStatus.png" alt="ContainerStatus">
</div>
<div class="title">Figure 268. Status Container</div>
</div>
<div class="paragraph">
<p>For containers that do not have process capability the Version Configuration tab allows users to change the current version of the Container.
Users can upgrade manually to a specific version using the "Upgrade" button or enable/disable the Scanner.
It&#8217;s also possible to execute a Scan Now operation that will scan for new versions only once.</p>
</div>
<div class="paragraph">
<p>To redeploy SNAPSHOT kjars with your latest changes all existing containers with that version must first be removed.  Executing 'build and deploy' will then create a container with the latest SNAPSHOT kjar.
However, this is not possible for release versions.  Following maven release convensions if the GAV of a kjar is anthing but SNAPSHOT, the GAV will need to be updated to the newer release version and deployed to its own container.  The new release version can also be used to upgrade an existing container as describe previously provided the container does not have process capability.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/ContainerVersionConfiguration.png" alt="ContainerVersionConfiguration">
</div>
<div class="title">Figure 269. Version Configuration</div>
</div>
<div class="paragraph">
<p>Process Configuration is the same form that is displayed during New Container Wizard for Template Servers that have Process Capability.
If Template Server doesn&#8217;t have such capability, the action buttons will be disabled.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/ContainerProcessConfiguration.png" alt="ContainerProcessConfiguration">
</div>
<div class="title">Figure 270. Process Configuration</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.execserveruiremoteserver"><a class="anchor" href="#_wb.execserveruiremoteserver"></a><a class="link" href="#_wb.execserveruiremoteserver">15.11.3. Remote Server</a></h4>
<div class="paragraph">
<p>Remote Server is a Managed KIE Server instance running that has a Drools controller configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, Business Central comes with a Drools controller embedded.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The list of Remote Servers is displayed just under the list of Containers.
Once selected the screens reveals the Remote Server details and a list of cards, each card represents a running Container.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExecServer/RemoteServers.png" alt="RemoteServers">
</div>
<div class="title">Figure 271. Remote Servers</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.experimentalFeatures"><a class="anchor" href="#_wb.experimentalFeatures"></a><a class="link" href="#_wb.experimentalFeatures">15.12. Experimental Features Framework</a></h3>
<div class="paragraph">
<p>This section describes the <em>Experimental Features Framework</em> functionality and how to use it.</p>
</div>
<div class="sect3">
<h4 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a><a class="link" href="#_introduction_5">15.12.1. Introduction</a></h4>
<div class="paragraph">
<p>The <em>Experimental Features Framework</em> is a platform service that allows developers to deliver features which are still not
part of Business Central (for example, ongoing developments, tech previews, POCs&#8230;&#8203;) and expose these features to users to let them have a preview
of what is coming in the future.</p>
</div>
<div class="paragraph">
<p>The <em>Experimental Features Framework</em> provides the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New Editor UI, accessible on the <strong>Admin</strong> page, where users can enable and disable <em>Experimental Features</em>.</p>
</li>
<li>
<p>Support for user-level features (stored as system preferences for each user) and global features (only available to
<code>admin</code> users, in the editor)</p>
</li>
<li>
<p>Ability to dynamically handle the visibility for different <em>Experimental Resources</em> on Business Central.</p>
<div class="ulist">
<ul>
<li>
<p>Business Central Perspectives</p>
</li>
<li>
<p>Business Central Screens</p>
</li>
<li>
<p>Business Central Editors</p>
</li>
<li>
<p>Library Asset Types</p>
</li>
<li>
<p>Page Builder Layout Components</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_types_of_experimental_features"><a class="anchor" href="#_types_of_experimental_features"></a><a class="link" href="#_types_of_experimental_features">15.12.2. Types of <em>Experimental Features</em></a></h4>
<div class="paragraph">
<p>There are two types of <em>Experimental Features</em>, each with different scopes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>User</strong>: This type of feature can be enabled or disabled for any platform user, making the feature available for a single
user without affecting other users, storing the feature state as a user preference.</p>
</li>
<li>
<p><strong>Global</strong>: This type of feature is global for all users. Only users with administrator permissions user can enable them.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_experimental_features_editor"><a class="anchor" href="#_experimental_features_editor"></a><a class="link" href="#_experimental_features_editor">15.12.3. Experimental Features Editor</a></h4>
<div class="paragraph">
<p>The <em>Experimental Features Framework</em> provides an editor where users can configure the features that they want to use.
To open the editor, navigate to the <strong>Admin</strong> page and click the <strong>Experimental</strong> menu option.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-menu-option.png" alt="admin page experimental menu option">
</div>
<div class="title">Figure 272. Experimental Features Menu Option</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Experimental</strong> menu option only appears if the <em>Experimental Features Framework</em> is enabled and there are <em>Experimental
Features</em> installed on Business Central</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-editor-screen.png" alt="admin page experimental editor screen">
</div>
<div class="title">Figure 273. Experimental Features Editor</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The features and groups displayed on this documentation are examples.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Experimental Features Editor displays all the <em>Experimental Features</em> installed on Business Central. For a better user experience
these features are organized in collapsible groups. Click a label to expand or collapse a group.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-editor-feature-group.png" alt="admin page experimental editor feature group">
</div>
<div class="title">Figure 274. Experimental Features Group</div>
</div>
<div class="paragraph">
<p>Each row inside of the group corresponds to an experimental feature. Click toggle button to enable or disable the feature.</p>
</div>
<div class="paragraph">
<p>You can also enable or disable all group features by clicking the group&#8217;s *Enable all" / "Disable all" button.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-editor-feature-group-enable-all.png" alt="admin page experimental editor feature group enable all">
</div>
<div class="title">Figure 275. Enable all group features</div>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_the_experimental_features_framework"><a class="anchor" href="#_enabling_the_experimental_features_framework"></a><a class="link" href="#_enabling_the_experimental_features_framework">15.12.4. Enabling the Experimental Features Framework</a></h4>
<div class="paragraph">
<p>By default, the <em>Experimental Features Framework</em> is disabled. You can enable it by starting Business Central
and setting the system property <code>appformer.experimental.features=true</code>.</p>
</div>
<div class="paragraph">
<p>Any <em>Experimental Feature</em> present on Business Central will not be accessible to users while the <em>Experimental Features Framework</em>
is disabled.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.workbenchProfiles"><a class="anchor" href="#_wb.workbenchProfiles"></a><a class="link" href="#_wb.workbenchProfiles">15.13. Business Central profiles</a></h3>
<div class="paragraph">
<p>Starting on 7.15.0.Final, KIE Workbench is renamed to Business Central. Business Central contains all KIE Workbench features. To select between the set of available features, the concept of profiles is introduced. This chapter describes profiles and show how you can configure them in Business Central.</p>
</div>
<div class="sect3">
<h4 id="_introduction_6"><a class="anchor" href="#_introduction_6"></a><a class="link" href="#_introduction_6">15.13.1. Introduction</a></h4>
<div class="paragraph">
<p>When you start the Business Central application, all the features are available to you by default. To configure a set of features, you can select from a list of profile.</p>
</div>
<div class="paragraph">
<p>A profile is a set of features which contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Menus</p>
</li>
<li>
<p>Resources that it can handle</p>
</li>
<li>
<p>Specific home page</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Currently, we have two profiles:
* <strong>Full</strong>: All workbench features will be enabled (default);
* <strong>Planner and Rules</strong>: Only Optaplanner and Drools features will be available.</p>
</div>
</div>
<div class="sect3">
<h4 id="_selecting_a_profile"><a class="anchor" href="#_selecting_a_profile"></a><a class="link" href="#_selecting_a_profile">15.13.2. Selecting a profile</a></h4>
<div class="paragraph">
<p>Profiles can be selected on Administration page, by selecting the Profiles preference.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only admin users have access to the Profiles preference.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/WorkbenchProfiles/profiles-menu-option.png" alt="profiles menu option">
</div>
<div class="title">Figure 276. Profile Menu Option</div>
</div>
<div class="paragraph">
<p>It is also possible to select a profile using the system property <code>org.kie.workbench.profile</code>, which can have the values <code>FULL</code> (for <strong>Full</strong> profile) and <code>PLANNER_AND_RULES</code> (For <strong>Planner and Rules</strong> profile).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performance-tuning-business-central-ref_kie-apis"><a class="anchor" href="#performance-tuning-business-central-ref_kie-apis"></a><a class="link" href="#performance-tuning-business-central-ref_kie-apis">15.14. Performance tuning considerations with Business Central</a></h3>
<div class="paragraph">
<p>The following key concepts or suggested practices can help you optimize Business Central configuration and Drools performance. These concepts are summarized in this section as a convenience and are explained in more detail in the cross-referenced documentation, where applicable. This section will expand or change as needed with new releases of Drools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Ensure that development mode is enabled during development</dt>
<dd>
<p>You can set KIE Server or specific projects in Business Central to use <code>production</code> mode or <code>development</code> mode. By default, KIE Server and all new projects in Business Central are in development mode. This mode provides features that facilitate your development experience, such as flexible project deployment policies, and features that optimize KIE Server performance during development, such as disabled duplicate GAV detection. Use development mode until your Drools environment is established and completely ready for production mode.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For more information about configuring the environment mode or duplicate GAV detection, see the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_development_streamline_lifecycle">Development streamline lifecycle</a></p>
</li>
<li>
<p><a href="#_duplicate_gav_detection">Duplicate GAV detection</a></p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Disable verification and validation of complex guided decision tables</dt>
<dd>
<p>The decision table verification and validation feature of Business Central is enabled by default. This feature helps you validate your guided decision tables, but with complex guided decision tables, this feature can hinder Drools engine performance. You can disable this feature by setting the <code>org.kie.verification.disable-dtable-realtime-verification</code> system property value to <code>true</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For more information about guided decision table validation, see
<a href="#guided-decision-tables-validation-disable-proc">Disabling verification and validation of guided decision tables</a></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Disable automatic builds if you have many large projects</dt>
<dd>
<p>In Business Central, when you navigate between projects in the <strong>Project Explorer</strong> side panel, the selected project is built automatically so that the <strong>Alerts</strong> window is updated to show any build errors for the project. If you have large projects or frequently switch between many projects that are under active development, this feature can hinder Business Central and Drools engine performance.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To disable automatic project builds, set the <code>org.kie.build.disable-project-explorer</code> system property to <code>true</code>.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drools.AuthoringAssets"><a class="anchor" href="#drools.AuthoringAssets"></a><a class="link" href="#drools.AuthoringAssets">16. Authoring rule assets</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_drools.newpackage"><a class="anchor" href="#_drools.newpackage"></a><a class="link" href="#_drools.newpackage">16.1. Creating a package</a></h3>
<div class="paragraph">
<p>Configuring packages is generally something that is done once, and by someone with some experience with rules/models.
Generally speaking, very few people will need to configure packages, and once they are setup, they can be copied over and over if needed.
Package configuration is most definitely a technical task that requires the appropriate expertise.</p>
</div>
<div class="paragraph">
<p>All assets live in "packages" in Business Central - a package is like a folder (it also serves as a "namespace"). A home folder for rule assets to live in.
Rules in particular need to know what the fact model is, what the namespace is etc.</p>
</div>
<div class="paragraph">
<p>So while rules (and assets in general) can appear in any number of categories, they only live in one package.
If you think of Business Central as a file system, then each package is a folder, and the assets live in that folder - as one big happy list of files.</p>
</div>
<div class="paragraph">
<p>To create an empty package select "Package" from the "Add Asset" menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/newItemMenu.png" alt="newItemMenu">
</div>
<div class="title">Figure 277. New package</div>
</div>
<div class="sect3">
<h4 id="_empty_package"><a class="anchor" href="#_empty_package"></a><a class="link" href="#_empty_package">16.1.1. Empty package</a></h4>
<div class="paragraph">
<p>An empty package can be created by simply specifying a name.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/newItem-package.png" alt="newItem package">
</div>
<div class="title">Figure 278. New empty package</div>
</div>
<div class="paragraph">
<p>Once the Package has been created it will appear in the Project Explorer.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/newItem-package-project-explorer.png" alt="newItem package project explorer">
</div>
<div class="title">Figure 279. Project Explorer showing new Package</div>
</div>
</div>
<div class="sect3">
<h4 id="_copy_rename_and_delete_packages"><a class="anchor" href="#_copy_rename_and_delete_packages"></a><a class="link" href="#_copy_rename_and_delete_packages">16.1.2. Copy, rename, and delete packages</a></h4>
<div class="paragraph">
<p>As already mentioned on <a href="#_wb.projectexplorercopyrenamedeleteactions">Project Explorer</a> section, users can copy, rename or delete a package directly from Project Explorer.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guided-rules-con_kie-apis"><a class="anchor" href="#guided-rules-con_kie-apis"></a><a class="link" href="#guided-rules-con_kie-apis">16.2. Guided rules</a></h3>
<div class="paragraph">
<p>Guided rules are business rules that you create in a UI-based guided rules designer in Business Central that leads you through the rule-creation process. The guided rules designer provides fields and options for acceptable input based on the data objects for the rule being defined. The guided rules that you define are compiled into Drools Rule Language (DRL) rules as with all other rule assets.</p>
</div>
<div class="paragraph">
<p>All data objects related to a guided rule must be in the same project package as the guided rule. Assets in the same package are imported by default. After you create the necessary data objects and the guided rule, you can use the <strong>Data Objects</strong> tab of the guided rules designer to verify that all required data objects are listed or to import other existing data objects by adding a <strong>New item</strong>.</p>
</div>
<div class="sect3">
<h4 id="guided-rules-create-proc_kie-apis"><a class="anchor" href="#guided-rules-create-proc_kie-apis"></a><a class="link" href="#guided-rules-create-proc_kie-apis">16.2.1. Creating guided rules</a></h4>
<div class="paragraph">
<p>Guided rules enable you to define business rules in a structured format, based on the data objects associated with the rules. You can create and define guided rules individually for your project.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Guided Rule</strong>.</p>
</li>
<li>
<p>Enter an informative <strong>Guided Rule</strong> name and select the appropriate <strong>Package</strong>. The package that you specify must be the same package where the required data objects have been assigned or will be assigned.</p>
<div class="paragraph">
<p>You can also select <strong>Show declared DSL sentences</strong> if any domain specific language (DSL) assets have been defined in your project. These DSL assets will then become usable objects for conditions and actions that you define in the guided rules designer.</p>
</div>
</li>
<li>
<p>Click <strong>Ok</strong> to create the rule asset.</p>
<div class="paragraph">
<p>The new guided rule is now listed in the <strong>Guided Rules</strong> panel of the <strong>Project Explorer</strong>, or in the <strong>Guided Rules (with DSL)</strong> panel if you selected the <strong>Show declared DSL sentences</strong> option.</p>
</div>
</li>
<li>
<p>Click the <strong>Data Objects</strong> tab and confirm that all data objects required for your rules are listed. If not, click <strong>New item</strong> to import data objects from other packages, or
<a href="#_wb.datamodeller">create data objects</a>
within your package.</p>
</li>
<li>
<p>After all data objects are in place, return to the <strong>Model</strong> tab of the guided rules designer and use the buttons on the right side of the window to add and define the <strong>WHEN</strong> (condition) and <strong>THEN</strong> (action) sections of the rule, based on the available data objects.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/1140_01.png" alt="The guided rules designer">
</div>
<div class="title">Figure 280. The guided rules designer</div>
</div>
<div class="paragraph">
<p>The <strong>WHEN</strong> part of the rule contains the conditions that must be met to execute an action. For example, if a bank requires loan applicants to have over 21 years of age, then the <strong>WHEN</strong> condition of an <code>Underage</code> rule would be <code>Age | less than | 21</code>.</p>
</div>
<div class="paragraph">
<p>The <strong>THEN</strong> part of the rule contains the actions to be performed when the conditional part of the rule has been met. For example, when the loan applicant is under 21 years old, the <strong>THEN</strong> action would set <code>approved</code> to <code>false</code>, declining the loan because the applicant is under age.</p>
</div>
<div class="paragraph">
<p>You can also specify exceptions for more complex rules, such as if a bank may approve of an under-aged applicant when a guarantor is involved. In that case, you would create or import a <strong>guarantor</strong> data object and then add the field to the guided rule.</p>
</div>
</li>
<li>
<p>After you define all components of the rule, click <strong>Validate</strong> in the upper-right toolbar of the guided rules designer to validate the guided rule. If the rule validation fails, address any problems described in the error message, review all components in the rule, and try again to validate the rule until the rule passes.</p>
</li>
<li>
<p>Click <strong>Save</strong> in the guided rules designer to save your work.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="guided-rules-WHEN-proc_kie-apis"><a class="anchor" href="#guided-rules-WHEN-proc_kie-apis"></a><a class="link" href="#guided-rules-WHEN-proc_kie-apis">16.2.1.1. Adding WHEN conditions in guided rules</a></h5>
<div class="paragraph">
<p>The <strong>WHEN</strong> part of the rule contains the conditions that must be met to execute an action. For example, if a bank requires loan applicants to have over 21 years of age, then the <strong>WHEN</strong> condition of an <code>Underage</code> rule would be <code>Age | less than | 21</code>. You can set simple or complex conditions to determine how and when your rules are applied.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All data objects required for your rules have been created or imported and are listed in the <strong>Data Objects</strong> tab of the guided rules designer.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided rules designer, click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>) on the right side of the <code>WHEN</code> section.</p>
<div class="paragraph">
<p>The <strong>Add a condition to the rule</strong> window with the available condition elements opens.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5687.png" alt="Add a condition to the rule">
</div>
<div class="title">Figure 281. Add a condition to the rule</div>
</div>
<div class="paragraph">
<p>The list includes the data objects from the <strong>Data Objects</strong> tab of the guided rules designer, any DSL objects defined for the package (if you selected <strong>Show declared DSL sentences</strong> when you created this guided rule), and the following standard options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>The following does not exist:</strong> Use this to specify facts and constraints that must not exist.</p>
</li>
<li>
<p><strong>The following exists:</strong> Use this to specify facts and constraints that must exist. This option is triggered on only the first match, not subsequent matches.</p>
</li>
<li>
<p><strong>Any of the following are true:</strong> Use this to list any facts or constraints that must be true.</p>
</li>
<li>
<p><strong>From:</strong> Use this to define a <code>From</code> conditional element for the rule.</p>
</li>
<li>
<p><strong>From Accumulate:</strong> Use this to define an <code>Accumulate</code> conditional element for the rule.</p>
</li>
<li>
<p><strong>From Collect:</strong> Use this to define a <code>Collect</code> conditional element for the rule.</p>
</li>
<li>
<p><strong>From Entry Point:</strong> Use this to define an <code>Entry Point</code> for the pattern.</p>
</li>
<li>
<p><strong>Free form DRL:</strong> Use this to insert a free-form DRL field where you can define condition elements freely, without the guided rules designer.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose a condition element (for example, <strong>LoanApplication</strong>) and click <strong>Ok</strong>.</p>
</li>
<li>
<p>Click the condition element in the guided rules designer and use the <strong>Modify constraints for LoanApplication</strong> window to add a restriction on a field, apply multiple field constraints, add a new formula style expression, apply an expression editor, or set a variable name.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5689.png" alt="Modifying a condition">
</div>
<div class="title">Figure 282. Modify a condition</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A variable name enables you to identify a fact or field in other constructs within the guided rule. For example, you could set the variable of <code>LoanApplication</code> to <code>a</code> and then reference <code>a</code> in a separate <code>Bankruptcy</code> constraint that specifies which application the bankruptcy is based on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>a : LoanApplication()
Bankruptcy( application == a ).</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you select a constraint, the window closes automatically.</p>
</div>
</li>
<li>
<p>Choose an operator for the restriction (for example, <code>greater than</code>) from the drop-down menu next to the added restriction.</p>
</li>
<li>
<p>Click the edit icon (<span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span>) to define the field value. The field value can be a literal value, a formula, or a full MVEL expression.</p>
</li>
<li>
<p>To apply multiple field constraints, click the condition and in the <strong>Modify constraints for LoanApplication</strong> window, select <strong>All of(And)</strong> or <strong>Any of(Or)</strong> from the <strong>Multiple field constraint</strong> drop-down menu.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5688.png" alt="Modifying a condition">
</div>
<div class="title">Figure 283. Add multiple field constraints</div>
</div>
</li>
<li>
<p>Click the constraint in the guided rules designer and further define the field value.</p>
</li>
<li>
<p>After you define all condition components of the rule, click <strong>Validate</strong> in the upper-right toolbar of the guided rules designer to validate the guided rule conditions. If the rule validation fails, address any problems described in the error message, review all components in the rule, and try again to validate the rule until the rule passes.</p>
</li>
<li>
<p>Click <strong>Save</strong> in the guided rules designer to save your work.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guided-rules-THEN-proc_kie-apis"><a class="anchor" href="#guided-rules-THEN-proc_kie-apis"></a><a class="link" href="#guided-rules-THEN-proc_kie-apis">16.2.1.2. Adding THEN actions in guided rules</a></h5>
<div class="paragraph">
<p>The <strong>THEN</strong> part of the rule contains the actions to be performed when the <strong>WHEN</strong> condition of the rule has been met. For example, when a loan applicant is under 21 years old, the <strong>THEN</strong> action might set <code>approved</code> to <code>false</code>, declining the loan because the applicant is under age. You can set simple or complex actions to determine how and when your rules are applied.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All data objects required for your rules have been created or imported and are listed in the <strong>Data Objects</strong> tab of the guided rules designer.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided rules designer, click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>) on the right side of the <code>THEN</code> section.</p>
<div class="paragraph">
<p>The <strong>Add a new action</strong> window with the available action elements opens.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5695.png" alt="Add a new action to the rule">
</div>
<div class="title">Figure 284. Add a new action to the rule</div>
</div>
<div class="paragraph">
<p>The list includes insertion and modification options based on the data objects in the <strong>Data Objects</strong> tab of the guided rules designer, and on any DSL objects defined for the package (if you selected <strong>Show declared DSL sentences</strong> when you created this guided rule):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Change field values of:</strong> Use this to set the value of fields on a fact (such as <code>LoanApplication</code>) without notifying the Drools engine of the change.</p>
</li>
<li>
<p><strong>Delete:</strong> Use this to delete a fact.</p>
</li>
<li>
<p><strong>Modify:</strong> Use this to specify fields to be modified for a fact and to notify the Drools engine of the change.</p>
</li>
<li>
<p><strong>Insert fact:</strong> Use this to insert a fact and define resulting fields and values for the fact.</p>
</li>
<li>
<p><strong>Logically Insert fact:</strong> Use this to insert a fact logically into the Drools engine and define resulting fields and values for the fact. The Drools engine is responsible for logical decisions on insertions and retractions of facts. After regular or stated insertions, facts have to be retracted explicitly. After logical insertions, facts are automatically retracted when the conditions that originally asserted the facts are no longer true.</p>
</li>
<li>
<p><strong>Add free form DRL:</strong> Use this to insert a free-form DRL field where you can define condition elements freely, without the guided rules designer.</p>
</li>
<li>
<p><strong>Call method on:</strong> Use this to invoke a method from another fact.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose an action element (for example, <strong>Modify</strong>) and click <strong>Ok</strong>.</p>
</li>
<li>
<p>Click the action element in the guided rules designer and use the <strong>Add a field</strong> window to select a field.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5696.png" alt="Add a field">
</div>
<div class="title">Figure 285. Add a field</div>
</div>
<div class="paragraph">
<p>After you select a field, the window closes automatically.</p>
</div>
</li>
<li>
<p>Click the edit icon (<span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span>) to define the field value. The field value can be a literal value or a formula.</p>
</li>
<li>
<p>After you define all action components of the rule, click <strong>Validate</strong> in the upper-right toolbar of the guided rules designer to validate the guided rule actions. If the rule validation fails, address any problems described in the error message, review all components in the rule, and try again to validate the rule until the rule passes.</p>
</li>
<li>
<p>Click <strong>Save</strong> in the guided rules designer to save your work.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditordsl"><a class="anchor" href="#_drools.guidedruleeditordsl"></a><a class="link" href="#_drools.guidedruleeditordsl">16.2.2. Augmenting with DSL sentences</a></h4>
<div class="paragraph">
<p>If the package the rule is part of has a DSL configuration, when you add conditions or actions, then it will provide a list of "DSL Sentences" which you can choose from - when you choose one, it will add a row to the rule - where the DSL specifies values come from a user, then a edit box (text) will be shown (so it ends up looking a bit like a form). This is optional, and there is another DSL editor.
Please note that the DSL capabilities in this editor are slightly less than the full set of DSL features (basically you can do [when] and [then] sections of the DSL only - which is no different to drools 3 in effect).</p>
</div>
<div class="paragraph">
<p>The following diagram shows the DSL sentences in action in the guided editor:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDSL.png" alt="GuidedDSL">
</div>
<div class="title">Figure 286. DSL in guided editor</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-rules-options-proc_kie-apis"><a class="anchor" href="#guided-rules-options-proc_kie-apis"></a><a class="link" href="#guided-rules-options-proc_kie-apis">16.2.3. Adding other rule options</a></h4>
<div class="paragraph">
<p>You can also use the rule designer to add metadata within a rule, define additional rule attributes (such as <code>salience</code> and <code>no-loop</code>), and freeze areas of the rule to restrict modifications to conditions or actions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the rule designer, click <strong>(show options&#8230;&#8203;)</strong> under the <strong>THEN</strong> section.</p>
</li>
<li>
<p>Click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>) on the right side of the window to add options.</p>
</li>
<li>
<p>Select an option to be added to the rule:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Metadata:</strong> Enter a metadata label and click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>). Then enter any needed data in the field provided in the rule designer.</p>
</li>
<li>
<p><strong>Attribute:</strong> Select from the list of rule attributes. Then further define the value in the field or option displayed in the rule designer.</p>
</li>
<li>
<p><strong>Freeze areas for editing:</strong> Select <strong>Conditions</strong> or <strong>Actions</strong> to restrict the area from being modified in the rule designer.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/1141.png" alt="Additional rule options">
</div>
<div class="title">Figure 287. Rule options</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong> in the rule designer to save your work.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="rules-attributes-ref_kie-apis"><a class="anchor" href="#rules-attributes-ref_kie-apis"></a><a class="link" href="#rules-attributes-ref_kie-apis">16.2.3.1. Rule attributes</a></h5>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="rule attributes">
</div>
<div class="title">Figure 288. Rule attributes</div>
</div>
<div class="paragraph">
<p>Rule attributes are additional specifications that you can add to business rules to modify rule behavior.</p>
</div>
<div class="paragraph">
<p>The following table lists the names and supported values of the attributes that you can assign to rules:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 45. Rule attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">An integer defining the priority of the rule. Rules with a higher salience value are given higher priority when ordered in the activation queue.</p>
<p class="tableblock">Example: <code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value. When the option is selected, the rule is enabled. When the option is not selected, the rule is disabled.</p>
<p class="tableblock">Example: <code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code>date-effective</code> attribute.</p>
<p class="tableblock">Example: <code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code>date-expires</code> attribute.</p>
<p class="tableblock">Example: <code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value. When the option is selected, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition. When the condition is not selected, the rule can be looped in these circumstances.</p>
<p class="tableblock">Example: <code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an agenda group to which you want to assign the rule. Agenda groups allow you to partition the agenda to provide more execution control over groups of rules. Only rules in an agenda group that has acquired a focus are able to be activated.</p>
<p class="tableblock">Example: <code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an activation (or XOR) group to which you want to assign the rule. In activation groups, only one rule can be activated. The first rule to fire will cancel all pending activations of all rules in the activation group.</p>
<p class="tableblock">Example: <code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.</p>
<p class="tableblock">Example: <code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling the rule.</p>
<p class="tableblock">Example: <code>timer ( cron:* 0/15 * * * ? )</code>  (every 15 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A <a href="http://www.quartz-scheduler.org/">Quartz</a> calendar definition for scheduling the rule.</p>
<p class="tableblock">Example: <code>calendars "* * 0-7,18-23 ? * *"</code>  (exclude non-business hours)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within agenda groups. When the option is selected, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.</p>
<p class="tableblock">Example: <code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within rule flow groups or agenda groups. When the option is selected, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code>no-loop</code> attribute, because the activation of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.</p>
<p class="tableblock">Example: <code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying a rule flow group. In rule flow groups, rules can fire only when the group is activated by the associated rule flow.</p>
<p class="tableblock">Example: <code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying either <code>JAVA</code> or <code>MVEL</code> as the language to be used for code expressions in the rule. By default, the rule uses the dialect specified at the package level. Any dialect specified here overrides the package dialect setting for the rule.</p>
<p class="tableblock">Example: <code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditorcomplexexample"><a class="anchor" href="#_drools.guidedruleeditorcomplexexample"></a><a class="link" href="#_drools.guidedruleeditorcomplexexample">16.2.4. A more complex example:</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedComplex.png" alt="GuidedComplex">
</div>
<div class="title">Figure 289. A more complex BRL example</div>
</div>
<div class="paragraph">
<p>In the above example, you can see how to use a mixture of Conditional Elements, literal values, and formulas.
The rule has 4 "top level" Patterns and 1 Action.
The "top level" Patterns are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A Fact Pattern on Person. This Pattern contains two field constraints: one for birthDate field and the other one is a formula. Note that the value of the birthDate restriction is selected from a calendar. Another thing to note is that you can make calculations and use nested fields in the formula restriction (i.e. car.brand). Finally, we are setting a variable name ($p) to the Person Fact Type. You can then use this variable in other Patterns.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$p : Person( birthDate &lt; "19-Dec-1982" , eval( car.brand == "Ford" &amp;&amp; salary &gt; (2500 * 4.1) ))</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>A From Pattern. This condition will create a match for every Address whose street name is "Elm St." from the Person&#8217;s list of addresses. The left side of the from is a regular Fact Pattern and the right side is an Expression Builder that let us inspect variable&#8217;s fields.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be: <code>Address( street == "Elm St." ) from
          $p.addresses</code></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>A "Not Exist" Conditional Element. This condition will match when its content doesn&#8217;t create a match. In this case, its content is a regular Fact Pattern (on Person). In this Fact Pattern you can see how variables ($p) could be used inside a formula value.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be: <code>not Person( salary == ( $p.salary * 2 )
          )</code></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>A "From Accumulate" Conditional Element. This is maybe one of the most complex Patterns you can use. It consist in a Left Pattern (It must be a Fact Pattern. In this case is a Number Pattern. The Number is named $totalAddresses), a Source Pattern (Which could be a Fact Pattern, From, Collect or Accumulate conditional elements. In this case is an Address Pattern Restriction with a field restriction in its zip field) and a Formula Section where you can use any built-in or custom Accumulate Function (in this example a count() function is used). Basically, this Conditional Element will count the addresses having a zip code of 43240 from the Person&#8217;s list of addresses.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be: <code>$totalAddresses : Number() from accumulate ( $a : Address( zipCode == " 43240" ) from $p.addresses, count( $a ) )</code></p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guided-rule-templates-con"><a class="anchor" href="#guided-rule-templates-con"></a><a class="link" href="#guided-rule-templates-con">16.3. Guided rule templates</a></h3>
<div class="paragraph">
<p>Guided rule templates are business rule structures with placeholder values (template keys) that are interchanged with actual values defined in separate data tables. Each row of values defined in the corresponding data table for that template results in a rule. Guided rule templates are ideal when many rules have the same conditions, actions, and other attributes but differ in values of facts or constraints. In such cases, instead of creating many similar guided rules and defining values in each rule, you can create a guided rule template with the rule structure that applies to each rule and then define only the differing values in the data table.</p>
</div>
<div class="paragraph">
<p>The guided rule templates designer provides fields and options for acceptable template input based on the data objects for the rule template being defined, and a corresponding data table where you add template key values. After you create your guided rule template and add values in the corresponding data table, the rules you defined are compiled into Drools Rule Language (DRL) rules as with all other rule assets.</p>
</div>
<div class="paragraph">
<p>All data objects related to a guided rule template must be in the same project package as the guided rule template. Assets in the same package are imported by default. After you create the necessary data objects and the guided rule template, you can use the <strong>Data Objects</strong> tab of the guided rule templates designer to verify that all required data objects are listed or to import other existing data objects by adding a <strong>New item</strong>.</p>
</div>
<div class="sect3">
<h4 id="guided-rule-templates-create-proc"><a class="anchor" href="#guided-rule-templates-create-proc"></a><a class="link" href="#guided-rule-templates-create-proc">16.3.1. Creating guided rule templates</a></h4>
<div class="paragraph">
<p>You can use guided rule templates to define rule structures with placeholder values (template keys) that correspond to actual values defined in a data table. Guided rule templates are an efficient alternative to defining sets of many guided rules individually that use the same structure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Guided Rule Template</strong>.</p>
</li>
<li>
<p>Enter an informative <strong>Guided Rule Template</strong> name and select the appropriate <strong>Package</strong>. The package that you specify must be the same package where the required data objects have been assigned or will be assigned.</p>
</li>
<li>
<p>Click <strong>Ok</strong> to create the rule template.</p>
<div class="paragraph">
<p>The new guided rule template is now listed in the <strong>Guided Rule Templates</strong> panel of the <strong>Project Explorer</strong>.</p>
</div>
</li>
<li>
<p>Click the <strong>Data Objects</strong> tab and confirm that all data objects required for your rules are listed. If not, click <strong>New item</strong> to import data objects from other packages, or
<a href="#_wb.datamodeller">create data objects</a>
within your package.</p>
</li>
<li>
<p>After all data objects are in place, return to the <strong>Model</strong> tab and use the buttons on the right side of the window to add and define the <strong>WHEN</strong> (condition) and <strong>THEN</strong> (action) sections of the rule template, based on the available data objects. For the field values that vary per rule, use template keys in the format <code>$key</code> in the rule designer or in the format <code>@{key}</code> in free form DRL (if used).</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-template.png" alt="Sample guided rule template">
</div>
<div class="title">Figure 290. Sample guided rule template</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note on template keys</div>
<div class="paragraph">
<p>Template keys are fundamental in guided rule templates. Template keys are what enable field values in the templates to be interchanged with actual values that you define in the corresponding data table to generate different rules from the same template. You can use other value types, such as <strong>Literal</strong> or <strong>Formula</strong>, for values that are part of the rule structure of all rules based on that template. However, for any values that differ among the rules, use the <strong>Template key</strong> field type with a specified key. Without template keys in a guided rule template, the corresponding data table is not generated in the template designer and the template essentially functions as an individual guided rule.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>WHEN</strong> part of the rule template is the condition that must be met to execute an action. For example, if a telecommunications company charges customers based on the services they subscribe to (Internet, phone, and TV), then one of the <strong>WHEN</strong> conditions would be <code>internetService | equal to | $hasInternetService</code>. The template key <code>$hasInternetService</code> is interchanged with an actual Boolean value (<code>true</code> or <code>false</code>) defined in the data table for the template.</p>
</div>
<div class="paragraph">
<p>The <strong>THEN</strong> part of the rule template is the action to be performed when the conditional part of the rule has been met. For example, if a customer subscribes to only Internet service, a <strong>THEN</strong> action for <code>RecurringPayment</code> with a template key <code>$amount</code> would set the actual monthly amount to the integer value defined for Internet service charges in the data table.</p>
</div>
</li>
<li>
<p>After you define all components of the rule, click <strong>Save</strong> in the guided rule templates designer to save your work.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="guided-rule-templates-WHEN-proc"><a class="anchor" href="#guided-rule-templates-WHEN-proc"></a><a class="link" href="#guided-rule-templates-WHEN-proc">16.3.1.1. Adding WHEN conditions in guided rule templates</a></h5>
<div class="paragraph">
<p>The <strong>WHEN</strong> part of the rule contains the conditions that must be met to execute an action. For example, if a telecommunications company charges customers based on the services they subscribe to (Internet, phone, and TV), then one of the <strong>WHEN</strong> conditions would be <code>internetService | equal to | $hasInternetService</code>. The template key <code>$hasInternetService</code> is interchanged with an actual Boolean value (<code>true</code> or <code>false</code>) defined in the data table for the template.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All data objects required for your rules have been created or imported and are listed in the <strong>Data Objects</strong> tab of the guided rule templates designer.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided rule templates designer, click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>) on the right side of the <code>WHEN</code> section.</p>
<div class="paragraph">
<p>The <strong>Add a condition to the rule</strong> window with the available condition elements opens.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-add-condition.png" alt="Add a condition to the rule">
</div>
<div class="title">Figure 291. Add a condition to the rule</div>
</div>
<div class="paragraph">
<p>The list includes the data objects from the <strong>Data Objects</strong> tab of the guided rule templates designer, any DSL objects defined for the package, and the following standard options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>The following does not exist:</strong> Use this to specify facts and constraints that must not exist.</p>
</li>
<li>
<p><strong>The following exists:</strong> Use this to specify facts and constraints that must exist. This option is triggered on only the first match, not subsequent matches.</p>
</li>
<li>
<p><strong>Any of the following are true:</strong> Use this to list any facts or constraints that must be true.</p>
</li>
<li>
<p><strong>From:</strong> Use this to define a <code>From</code> conditional element for the rule.</p>
</li>
<li>
<p><strong>From Accumulate:</strong> Use this to define an <code>Accumulate</code> conditional element for the rule.</p>
</li>
<li>
<p><strong>From Collect:</strong> Use this to define a <code>Collect</code> conditional element for the rule.</p>
</li>
<li>
<p><strong>From Entry Point:</strong> Use this to define an <code>Entry Point</code> for the pattern.</p>
</li>
<li>
<p><strong>Free form DRL:</strong> Use this to insert a free-form DRL field where you can define condition elements freely, without the guided rules designer. For template keys in free form DRL, use the format <code>@{key}</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose a condition element (for example, <strong>Customer</strong>) and click <strong>Ok</strong>.</p>
</li>
<li>
<p>Click the condition element in the guided rule templates designer and use the <strong>Modify constraints for Customer</strong> window to add a restriction on a field, apply multiple field constraints, add a new formula style expression, apply an expression editor, or set a variable name.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-modify-condition.png" alt="Modifying a condition">
</div>
<div class="title">Figure 292. Modify a condition</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A variable name enables you to identify a fact or field in other constructs within the guided rule. For example, you could set the variable of <code>Customer</code> to <code>c</code> and then reference <code>c</code> in a separate <code>Applicant</code> constraint that specifies that the <code>Customer</code> is the <code>Applicant</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">c : Customer()
Applicant( this == c )</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you select a constraint, the window closes automatically.</p>
</div>
</li>
<li>
<p>Choose an operator for the restriction (for example, <code>equal to</code>) from the drop-down menu next to the added restriction.</p>
</li>
<li>
<p>Click the edit icon (<span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span>) to define the field value.</p>
</li>
<li>
<p>Select <strong>Template key</strong> and add a template key in the format <code>$key</code> if this value varies among the rules that are based on this template. This allows the field value to be interchanged with actual values that you define in the corresponding data table to generate different rules from the same template. For field values that do not vary among the rules and are part of the rule template, you can use any other value type.</p>
</li>
<li>
<p>To apply multiple field constraints, click the condition and in the <strong>Modify constraints for Customer</strong> window, select <strong>All of(And)</strong> or <strong>Any of(Or)</strong> from the <strong>Multiple field constraint</strong> drop-down menu.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-multiple-constraints.png" alt="Add multiple field constraints">
</div>
<div class="title">Figure 293. Add multiple field constraints</div>
</div>
</li>
<li>
<p>Click the constraint in the guided rule templates designer and further define the field values.</p>
</li>
<li>
<p>After you define all condition elements, click <strong>Save</strong> in the guided rule templates designer to save your work.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guided-rule-templates-THEN-proc"><a class="anchor" href="#guided-rule-templates-THEN-proc"></a><a class="link" href="#guided-rule-templates-THEN-proc">16.3.1.2. Adding THEN actions in guided rule templates</a></h5>
<div class="paragraph">
<p>The <strong>THEN</strong> part of the rule template is the action to be performed when the conditional part of the rule has been met. For example, if a customer subscribes to only Internet service, a <strong>THEN</strong> action for <code>RecurringPayment</code> with a template key <code>$amount</code> would set the actual monthly amount to the integer value defined for Internet service charges in the data table.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All data objects required for your rules have been created or imported and are listed in the <strong>Data Objects</strong> tab of the guided rule templates designer.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided rule templates designer, click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>) on the right side of the <code>THEN</code> section.</p>
<div class="paragraph">
<p>The <strong>Add a new action</strong> window with the available action elements opens.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-add-action.png" alt="Add a new action to the rule">
</div>
<div class="title">Figure 294. Add a new action to the rule</div>
</div>
<div class="paragraph">
<p>The list includes insertion and modification options based on the data objects in the <strong>Data Objects</strong> tab of the guided rule templates designer, and on any DSL objects defined for the package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Insert fact:</strong> Use this to insert a fact and define resulting fields and values for the fact.</p>
</li>
<li>
<p><strong>Logically Insert fact:</strong> Use this to insert a fact logically into the Drools engine and define resulting fields and values for the fact. The Drools engine is responsible for logical decisions on insertions and retractions of facts. After regular or stated insertions, facts have to be retracted explicitly. After logical insertions, facts are automatically retracted when the conditions that originally asserted the facts are no longer true.</p>
</li>
<li>
<p><strong>Add free form DRL:</strong> Use this to insert a free-form DRL field where you can define condition elements freely, without the guided rules designer. For template keys in free form DRL, use the format <code>@{key}</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose an action element (for example, <strong>Logically Insert fact RecurringPayment</strong>) and click <strong>Ok</strong>.</p>
</li>
<li>
<p>Click the action element in the guided rule templates designer and use the <strong>Add a field</strong> window to select a field.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-add-field.png" alt="Add a field">
</div>
<div class="title">Figure 295. Add a field</div>
</div>
<div class="paragraph">
<p>After you select a field, the window closes automatically.</p>
</div>
</li>
<li>
<p>Click the edit icon (<span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span>) to define the field value.</p>
</li>
<li>
<p>Select <strong>Template key</strong> and add a template key in the format <code>$key</code> if this value varies among the rules that are based on this template. This allows the field value to be interchanged with actual values that you define in the corresponding data table to generate different rules from the same template. For field values that do not vary among the rules and are part of the rule template, you can use any other value type.</p>
</li>
<li>
<p>After you define all action elements, click <strong>Save</strong> in the guided rule templates designer to save your work.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guided-rules-options-proc_kie-apis"><a class="anchor" href="#guided-rules-options-proc_kie-apis"></a><a class="link" href="#guided-rules-options-proc_kie-apis">16.3.1.3. Adding other rule options</a></h5>
<div class="paragraph">
<p>You can also use the rule designer to add metadata within a rule, define additional rule attributes (such as <code>salience</code> and <code>no-loop</code>), and freeze areas of the rule to restrict modifications to conditions or actions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the rule designer, click <strong>(show options&#8230;&#8203;)</strong> under the <strong>THEN</strong> section.</p>
</li>
<li>
<p>Click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>) on the right side of the window to add options.</p>
</li>
<li>
<p>Select an option to be added to the rule:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Metadata:</strong> Enter a metadata label and click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>). Then enter any needed data in the field provided in the rule designer.</p>
</li>
<li>
<p><strong>Attribute:</strong> Select from the list of rule attributes. Then further define the value in the field or option displayed in the rule designer.</p>
</li>
<li>
<p><strong>Freeze areas for editing:</strong> Select <strong>Conditions</strong> or <strong>Actions</strong> to restrict the area from being modified in the rule designer.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/1141.png" alt="Additional rule options">
</div>
<div class="title">Figure 296. Rule options</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong> in the rule designer to save your work.</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="rules-attributes-ref_kie-apis"><a class="anchor" href="#rules-attributes-ref_kie-apis"></a><a class="link" href="#rules-attributes-ref_kie-apis">Rule attributes</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="rule attributes">
</div>
<div class="title">Figure 297. Rule attributes</div>
</div>
<div class="paragraph">
<p>Rule attributes are additional specifications that you can add to business rules to modify rule behavior.</p>
</div>
<div class="paragraph">
<p>The following table lists the names and supported values of the attributes that you can assign to rules:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 46. Rule attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Attribute</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">An integer defining the priority of the rule. Rules with a higher salience value are given higher priority when ordered in the activation queue.</p>
<p class="tableblock">Example: <code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value. When the option is selected, the rule is enabled. When the option is not selected, the rule is disabled.</p>
<p class="tableblock">Example: <code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code>date-effective</code> attribute.</p>
<p class="tableblock">Example: <code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code>date-expires</code> attribute.</p>
<p class="tableblock">Example: <code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value. When the option is selected, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition. When the condition is not selected, the rule can be looped in these circumstances.</p>
<p class="tableblock">Example: <code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an agenda group to which you want to assign the rule. Agenda groups allow you to partition the agenda to provide more execution control over groups of rules. Only rules in an agenda group that has acquired a focus are able to be activated.</p>
<p class="tableblock">Example: <code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an activation (or XOR) group to which you want to assign the rule. In activation groups, only one rule can be activated. The first rule to fire will cancel all pending activations of all rules in the activation group.</p>
<p class="tableblock">Example: <code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.</p>
<p class="tableblock">Example: <code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling the rule.</p>
<p class="tableblock">Example: <code>timer ( cron:* 0/15 * * * ? )</code>  (every 15 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A <a href="http://www.quartz-scheduler.org/">Quartz</a> calendar definition for scheduling the rule.</p>
<p class="tableblock">Example: <code>calendars "* * 0-7,18-23 ? * *"</code>  (exclude non-business hours)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within agenda groups. When the option is selected, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.</p>
<p class="tableblock">Example: <code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within rule flow groups or agenda groups. When the option is selected, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code>no-loop</code> attribute, because the activation of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.</p>
<p class="tableblock">Example: <code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying a rule flow group. In rule flow groups, rules can fire only when the group is activated by the associated rule flow.</p>
<p class="tableblock">Example: <code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying either <code>JAVA</code> or <code>MVEL</code> as the language to be used for code expressions in the rule. By default, the rule uses the dialect specified at the package level. Any dialect specified here overrides the package dialect setting for the rule.</p>
<p class="tableblock">Example: <code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-rule-templates-tables-proc"><a class="anchor" href="#guided-rule-templates-tables-proc"></a><a class="link" href="#guided-rule-templates-tables-proc">16.3.2. Defining data tables for guided rule templates</a></h4>
<div class="paragraph">
<p>After you create a guided rule template and add template keys for field values, a data table is displayed in the <strong>Data</strong> table of the guided rule templates designer. Each column in the data table corresponds to a template key that you added in the guided rule template. Use this table to define values for each template key row by row. Each row of values that you define in the data table for that template results in a rule.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided rule templates designer, click the <strong>Data</strong> tab to view the data table. Each column in the data table corresponds to a template key that you added in the guided rule template.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you did not add any template keys to the rule template, then this data table does not appear and the template does not function as a genuine template but essentially as an individual guided rule. For this reason, template keys are fundamental in creating guided rule templates.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Add row</strong> and define the data values for each template key column to generate that rule (row).</p>
</li>
<li>
<p>Continue adding rows and defining data values for each rule that will be generated. You can click <strong>Add row</strong> for each new row, or click the plus icon (<span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span>) or minus icon to add or remove rows.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-data-table.png" alt="Sample data table for a guided rule template">
</div>
<div class="title">Figure 298. Sample data table for a guided rule template</div>
</div>
<div class="paragraph">
<p>To view the DRL code, click the <strong>Source</strong> tab in the guided rule templates designer.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "PaymentRules_6"
	when
		Customer( internetService == false ,
			phoneService == false ,
			TVService == true )
	then
		RecurringPayment fact0 = new RecurringPayment();
		fact0.setAmount( 5 );
		insertLogical( fact0 );
end

rule "PaymentRules_5"
	when
		Customer( internetService == false ,
			phoneService == true ,
			TVService == false )
	then
		RecurringPayment fact0 = new RecurringPayment();
		fact0.setAmount( 5 );
		insertLogical( fact0 );
end
...
//Other rules omitted for brevity.</code></pre>
</div>
</div>
</li>
<li>
<p>As a visual aid, click the grid icon in the upper-left corner of the data table to toggle cell merging on and off, if needed. Cells in the same column with identical values are merged into a single cell.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-cell-merging.png" alt="Merge cells in a data table">
</div>
<div class="title">Figure 299. Merge cells in a data table</div>
</div>
<div class="paragraph">
<p>You can then use the expand/collapse icon [+/-] in the upper-left corner of each newly merged cell to collapse the rows corresponding to the merged cell, or to re-expand the collapsed rows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-cell-merging-02.png" alt="Collapse merged cells">
</div>
<div class="title">Figure 300. Collapse merged cells</div>
</div>
</li>
<li>
<p>After you define the template key data for all rules and adjust the table display as needed, click <strong>Validate</strong> in the upper-right toolbar of the guided rule templates designer to validate the guided rule template. If the rule template validation fails, address any problems described in the error message, review all components in the rule template and data defined in the data table, and try again to validate the rule template until the rule template passes.</p>
</li>
<li>
<p>Click <strong>Save</strong> in the guided rule templates designer to save your work.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guided-decision-tables-con"><a class="anchor" href="#guided-decision-tables-con"></a><a class="link" href="#guided-decision-tables-con">16.4. Guided decision tables</a></h3>
<div class="paragraph">
<p>Guided decision tables are a wizard-led alternative to spreadsheet decision tables for defining business rules in a tabular format. With guided decision tables, you are led by a UI-based wizard in Business Central that helps you define rule attributes, metadata, conditions, and actions based on specified data objects in your project. After you create your guided decision tables, the rules you defined are compiled into Drools Rule Language (DRL) rules as with all other rule assets.</p>
</div>
<div class="paragraph">
<p>All data objects related to a guided decision table must be in the same project package as the guided decision table. Assets in the same package are imported by default. After you create the necessary data objects and the guided decision table, you can use the <strong>Data Objects</strong> tab of the guided decision tables designer to verify that all required data objects are listed or to import other existing data objects by adding a <strong>New item</strong>.</p>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-create-proc"><a class="anchor" href="#guided-decision-tables-create-proc"></a><a class="link" href="#guided-decision-tables-create-proc">16.4.1. Creating guided decision tables</a></h4>
<div class="paragraph">
<p>You can use guided decision tables to define rule attributes, metadata, conditions, and actions in a tabular format that can be added to your business rules project.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Guided Decision Table</strong>.</p>
</li>
<li>
<p>Enter an informative <strong>Guided Decision Table</strong> name and select the appropriate <strong>Package</strong>. The package that you specify must be the same package where the required data objects have been assigned or will be assigned.</p>
</li>
<li>
<p>Select <strong>Use Wizard</strong> to finish setting up the table in the wizard, or leave this option unselected to finish creating the table and specify remaining configurations in the guided decision tables designer.</p>
</li>
<li>
<p>Select the hit policy that you want your rows of rules in the table to conform to. For details, see <a href="#hit-policies-con">Hit policies for guided decision tables</a>.</p>
</li>
<li>
<p>Specify whether you want the <strong>Extended entry</strong> or <strong>Limited entry</strong> table. For details, see <a href="#guided-decision-tables-types-con">Types of guided decision tables</a>.</p>
</li>
<li>
<p>Click <strong>Ok</strong> to complete the setup. If you have selected <strong>Use Wizard</strong>, the Guided Decision Table wizard is displayed. If you did not select the <strong>Use Wizard</strong> option, this prompt does not appear and you are taken directly to the table designer.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following wizard setup is for a guided decision table in a loan application decision service:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/6326_1.png" alt="6326 1">
</div>
<div class="title">Figure 301. Create guided decision table</div>
</div>
</div>
</div>
</li>
<li>
<p>If you are using the wizard, add any available imports, fact patterns, constraints, and actions, and select whether table columns should expand. Click <strong>Finish</strong> to close the wizard and view the table designer.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/6328_1.png" alt="6328 1">
</div>
<div class="title">Figure 302. Guided Decision Table wizard</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the guided decision tables designer, you can add or edit columns and rows, and make other final adjustments.</p>
</div>
</div>
<div class="sect3">
<h4 id="hit-policies-con"><a class="anchor" href="#hit-policies-con"></a><a class="link" href="#hit-policies-con">16.4.2. Hit policies for guided decision tables</a></h4>
<div class="paragraph">
<p>Hit policies determine the order in which rules (rows) in a guided decision table are applied, whether top to bottom, per specified priority, or other options.</p>
</div>
<div class="paragraph">
<p>The following hit policies are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>None:</strong> (Default hit policy) Multiple rows can be executed and the verification warns about rows that conflict. Any decision tables that have been uploaded (using a non-guided decision table spreadsheet) will adopt this hit policy.</p>
</li>
<li>
<p><strong>Resolved Hit:</strong> Only one row at a time can be executed according to specified priority, regardless of list order (you can give row 10 priority over row 5, for example). This means you can keep the order of the rows you want for visual readability, but specify priority exceptions.</p>
</li>
<li>
<p><strong>Unique Hit:</strong> Only one row at a time can be executed, and each row must be unique, with no overlap of conditions being met. If more than one row is executed, then the verification produces a warning at development time.</p>
</li>
<li>
<p><strong>First Hit:</strong> Only one row at a time can be executed in the order listed in the table, top to bottom.</p>
</li>
<li>
<p><strong>Rule Order:</strong> Multiple rows can be executed and verification does not report conflicts between the rows since they are expected to happen.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/hit-policies-image_1.png" alt="hit policies image 1">
</div>
<div class="title">Figure 303. Available hit policies</div>
</div>
<div class="sect4">
<h5 id="hit-policies-examples-ref"><a class="anchor" href="#hit-policies-examples-ref"></a><a class="link" href="#hit-policies-examples-ref">16.4.2.1. Hit policy examples: Decision table for discounts on movie tickets</a></h5>
<div class="paragraph">
<p>The following is part of an example decision table for discounts on movie tickets based on customer age, student status, or military status, or all three.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 47. Example decision table for available discounts on movie tickets</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Row Number</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Discount Type</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Discount</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Senior citizen (age 60+)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Student</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Military</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example, the total discount to be applied in the end will vary depending on the hit policy specified for the table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>None/Rule Order:</strong> With both <strong>None</strong> and <strong>Rule Order</strong> hit policies, all applicable rules are incorporated, in this case allowing discounts to be stacked for each customer.</p>
<div class="paragraph">
<p>Example: A senior citizen who is also a student and a military veteran will receive all three discounts, totaling 30%.</p>
</div>
<div class="paragraph">
<p>Key difference: With <strong>None</strong>, warnings are created for multiple rows applied. With <strong>Rule Order</strong>, those warnings are not created.</p>
</div>
</li>
<li>
<p><strong>First Hit/Resolved Hit:</strong> With both <strong>First Hit</strong> and <strong>Resolved Hit</strong> policies, only one of the discounts can be applied.</p>
<div class="paragraph">
<p>For <strong>First Hit</strong>, the discount that is satisfied first in the list is applied and the others are ignored.</p>
</div>
<div class="paragraph">
<p>Example: A senior citizen who is also a student and a military veteran will receive only the senior citizen discount of 10%, since that is listed first in the table.</p>
</div>
<div class="paragraph">
<p>For <strong>Resolved Hit</strong>, a modified table is required. The discount that you assign a priority exception to in the table, regardless of listed order, will be applied first. To assign this exception, include a new column that specifies the priority of one discount (row) over others.</p>
</div>
<div class="paragraph">
<p>Example: If military discounts are prioritized higher than age or student discounts, despite the listed order, then a senior citizen who is also a student and a military veteran will receive only the military discount of 10%, regardless of age or student status.</p>
</div>
<div class="paragraph">
<p>Consider the following modified decision table that accommodates a <strong>Resolved Hit</strong> policy:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 48. Modified decision table that accommodates a <em>Resolved Hit</em> policy</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Row Number</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Discount Type</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Has Priority over Row</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Discount</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Senior citizen (age 60+)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Student</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Military</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this modified table, the military discount is essentially the new row 1 and therefore takes priority over both age and student discounts, and any other discounts added later. You do not need to specify priority over rows "1 and 2", only over row "1". This changes the row hit order to 3 &#8594; 1 &#8594; 2 &#8594; &#8230;&#8203; and so on as the table grows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The row order would be changed in the same way if you actually moved the military discount to row 1 and applied a <strong>First Hit</strong> policy to the table instead. However, if you want the rules listed in a certain way and applied differently, such as in an alphabetized table, the <strong>Resolved Hit</strong> policy is useful.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Key difference: With <strong>First Hit</strong>, rules are applied strictly in the listed order. With <strong>Resolved Hit</strong>, rules are applied in the listed order unless priority exceptions are specified.</p>
</div>
</li>
<li>
<p><strong>Unique Hit:</strong> A modified table is required. With a <strong>Unique Hit</strong> policy, rows must be created in a way that it is impossible to satisfy multiple rules at one time. However, you can still specify row-by-row whether to apply one rule or multiple. In this way, with a <strong>Unique Hit</strong> policy you can make decision tables more granular and prevent overlap warnings.</p>
<div class="paragraph">
<p>Consider the following modified decision table that accommodates a <strong>Unique Hit</strong> policy:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 49. Modified decision table that accommodates a <em>Unique Hit</em> policy</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Row Number</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Is Senior Citizen (age 65+)</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Is Student</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Is Military</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Discount</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">20%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">20%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">20%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">30%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this modified table, each row is unique, with no allowance of overlap, and any single discount or any combination of discounts is accommodated.</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guided-decision-tables-types-con"><a class="anchor" href="#guided-decision-tables-types-con"></a><a class="link" href="#guided-decision-tables-types-con">Types of guided decision tables</a></h6>
<div class="paragraph">
<p>Two types of decision tables are supported in Drools: Extended entry and Limited entry tables.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Extended entry:</strong> An Extended Entry decision table is one for which the column definitions specify Pattern, Field, and Operator but not value.
The values, or states, are themselves held in the body of the decision table.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-extended-entry.png" alt="Extended entry">
</div>
</div>
</li>
<li>
<p><strong>Limited entry:</strong> A Limited Entry decision table is one for which the column definitions specify value in addition to Pattern, Field, and Operator.
The decision table states, held in the body of the table, are boolean where a positive value (a marked check box) has the effect of meaning the column should apply, or be matched. A negative value (a cleared check box) means the column does not apply.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-limited-entry.png" alt="Limited entry">
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-columns-create-proc"><a class="anchor" href="#guided-decision-tables-columns-create-proc"></a><a class="link" href="#guided-decision-tables-columns-create-proc">16.4.3. Adding columns to guided decision tables</a></h4>
<div class="paragraph">
<p>After you have created the guided decision table, you can define and add various types of columns within the guided decision tables designer.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Any data objects that will be used for column parameters, such as Facts and Fields, have been created within the same package where the guided decision table is found, or have been imported from another package in <strong>Data Objects</strong> &#8594; <strong>New item</strong> of the guided decision tables designer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For descriptions of these column parameters, see the "Required column parameters" segments for each column type in <a href="#guided-decision-tables-columns-types-con">Types of columns in guided decision tables</a>.</p>
</div>
<div class="paragraph">
<p>For details about creating data objects, see
<a href="#_wb.datamodeller">Data Modeller</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided decision tables designer, click <strong>Columns</strong> &#8594; <strong>Insert Column</strong>.</p>
</li>
<li>
<p>Click <strong>Include advanced options</strong> to view the full list of column options.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-add_1.png" alt="View column options in the *Add a new column* window">
</div>
<div class="title">Figure 304. Add columns</div>
</div>
</li>
<li>
<p>Select the column type that you want to add, click <strong>Next</strong>, and follow the steps in the wizard to specify the data required to add the column.</p>
<div class="paragraph">
<p>For descriptions of each column type and required parameters for setup, see <a href="#guided-decision-tables-columns-types-con">Types of columns in guided decision tables</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Finish</strong> to add the configured column.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After all columns are added, you can begin adding rows of rules correlating to your columns to complete the decision table. For details, see <a href="#guided-decision-tables-rows-create-proc">Adding rows and defining rules in guided decision tables</a>.</p>
</div>
<div class="paragraph">
<p>The following is an example decision table for a loan application decision service:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-add_02.png" alt="Example of complete guided decision table">
</div>
<div class="title">Figure 305. Example of complete guided decision table</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-columns-types-con"><a class="anchor" href="#guided-decision-tables-columns-types-con"></a><a class="link" href="#guided-decision-tables-columns-types-con">16.4.4. Types of columns in guided decision tables</a></h4>
<div class="paragraph">
<p>The <strong>Add a new column</strong> wizard for guided decision tables provides the following column options. (Select <strong>Include advanced options</strong> to view all options.)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guided-decision-tables-columns-condition-con">Add a Condition</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-condition-BRL-con">Add a Condition BRL fragment</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-metadata-con">Add a Metadata column</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-action-BRL-con">Add an Action BRL fragment</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-attribute-con">Add an Attribute column</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-delete-fact-con">Delete an existing fact</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-work-item-con">Execute a Work Item</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-field-con">Set the value of a field</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-field-work-item-con">Set the value of a field with a Work Item result</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These column types and the parameters required for each in the <strong>Add a new column</strong> wizard are described in the sections that follow.</p>
</div>
<div id="required-data-objects" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">IMPORTANT: Required data objects for column parameters</div>
<div class="paragraph">
<p>Some of the column parameters described in this section, such as Fact Patterns and Fields, provide drop-down options consisting only of data objects already defined within the same package where the guided decision table is found. Available data objects for the package are listed in the <strong>Data Objects</strong> panel of the Project Explorer and in the <strong>Data Objects</strong> tab of the guided decision tables designer. You can create additional data objects within the package as needed, or import them from another package in <strong>Data Objects</strong> &#8594; <strong>New item</strong> of the guided decision tables designer. For details about creating data objects, see
<a href="#_wb.datamodeller">Data Modeller</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-condition-con"><a class="anchor" href="#guided-decision-tables-columns-condition-con"></a><a class="link" href="#guided-decision-tables-columns-condition-con">16.4.4.1. "Add a Condition"</a></h5>
<div class="paragraph">
<p>Conditions represent fact patterns defined in the left ("WHEN") portion of a rule. With this column option, you can define one or more condition columns that check for the presence or absence of data objects with certain field values, and that affect the action ("THEN") portion of the rule. You can define a binding for the fact in the condition table, or select one that has previously been defined. You can also choose to negate the pattern.</p>
</div>
<div class="listingblock">
<div class="title">Example rule conditions</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $i : IncomeSource( type == "Asset" ) // Binds the IncomeSource object to the $i variable
then
  ...
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  not IncomeSource( type == "Asset" ) // Negates matching pattern
then
  ...
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a binding is specified, you can define field constraints. If two or more columns are defined using the same fact pattern binding, the field constraints become composite field constraints on the same pattern. If you define multiple bindings for a single model class, each binding becomes a separate model class in the condition ("WHEN") side of the rule.</p>
</div>
<div class="paragraph">
<div class="title">Required column parameters</div>
<p>The following parameters are required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Pattern:</strong> Select from the list of fact patterns already used in conditions in your table or create a new fact pattern. A fact pattern is a combination of an available data object in the package (see the note on <a href="#required-data-objects">Required data objects</a> for details) and a model class binding that you specify. (Examples: <code>LoanApplication [application]</code> or <code>IncomeSource [income]</code> where the bracketed portion is the binding to the given fact type)</p>
</li>
<li>
<p><strong>Entry point:</strong> Define the entry point for the fact pattern, if applicable. An entry point is a gate or stream through which facts enter the Drools engine, if specified. (Examples: <code>Application Stream</code>, <code>Credit Check Stream</code>)</p>
</li>
<li>
<p><strong>Calculation type:</strong> Select one of the following calculation types:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Literal value:</strong> The value in the cell will be compared with the field using the operator.</p>
</li>
<li>
<p><strong>Formula:</strong> The expression in the cell will be evaluated and then compared with the field.</p>
</li>
<li>
<p><strong>Predicate:</strong> No field is needed; the expression will be evaluated to <code>true</code> or <code>false</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Field:</strong> Select a field from the previously specified fact pattern. The field options are defined in the fact file in the <strong>Data Objects</strong> panel of your project. (Examples: <code>amount</code> or <code>lengthYears</code> fields within the <code>LoanApplication</code> fact type)</p>
</li>
<li>
<p><strong>Binding (optional):</strong> Define a binding for the previously selected field, if needed. (Example: For pattern <code>LoanApplication [application]</code>, field <code>amount</code>, and operator <code>equal to</code>, if binding is set to <code>$amount</code>, the end condition will be <code>application : LoanAppplication($amount : amount == [value])</code>.)</p>
</li>
<li>
<p><strong>Operator:</strong> Select the operator to be applied to the fact pattern and field previously specified.</p>
</li>
<li>
<p><strong>Value list (optional):</strong> Enter a list of value options, delimited by a comma and space, to limit table input data for the condition ("WHEN") portion of the rule. When this value list is defined, the values will be provided in the table cells for that column as a drop-down list, from which users can select only one option. (Example list: <code>Monday, Wednesday, Friday</code> to specify only these three options)</p>
</li>
<li>
<p><strong>Default value (optional):</strong> Select one of the previously defined value options as the default value that will appear in the cell automatically in a new row. If the default value is not specified, the table cell will be blank by default. You can also select a default value from any previously configured data enumerations in the project, listed in the <strong>Enumeration Definitions</strong> panel of the Project Explorer. (You can create enumerations in <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> &#8594; <strong><em>[select project]</em></strong> &#8594; <strong>Add Asset</strong> &#8594; <strong>Enumeration</strong>.)</p>
</li>
<li>
<p><strong>Header (description):</strong> Add header text for the column.</p>
</li>
<li>
<p><strong>Hide column:</strong> Select this to hide the column, or clear this to display the column.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guided-decision-tables-any-other-add-proc"><a class="anchor" href="#guided-decision-tables-any-other-add-proc"></a><a class="link" href="#guided-decision-tables-any-other-add-proc">Inserting an <code>any other</code> value in condition column cells</a></h6>
<div class="paragraph">
<p>For simple condition columns in guided decision tables, you can apply an <code>any other</code> value to table cells within the column if the following parameters are set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Calculation type</strong> for the condition column has been set to <code>Literal value</code>.</p>
</li>
<li>
<p><strong>Operator</strong> has been set as equality <code>==</code> or inequality <code>!=</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>any other</code> value enables a rule to be defined for any other field values not explicitly defined in the rules already in the table. In the DRL source, <code>any other</code> is notated as <code>not in</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example rule condition with <code>not in</code> used for <code>any other</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  IncomeSource( type not in ("Asset", "Job") )
  ...
then
  ...
end</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select a cell of a condition column that uses the <code>==</code> or <code>!=</code> operator.</p>
</li>
<li>
<p>In the upper-right toolbar of the table designer, click <strong>Edit</strong> &#8594; <strong>Insert "any other" value</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-condition-BRL-con"><a class="anchor" href="#guided-decision-tables-columns-condition-BRL-con"></a><a class="link" href="#guided-decision-tables-columns-condition-BRL-con">16.4.4.2. "Add a Condition BRL fragment"</a></h5>
<div class="paragraph">
<p>A Business Rule Language (BRL) fragment is a section of a rule created using the guided rules designer. The condition BRL fragment is the "WHEN" portion of the rule, and the <a href="#guided-decision-tables-columns-action-BRL-con">action BRL fragment</a> is the "THEN" portion of the rule. With this column option, you can define a condition BRL fragment to be used in the left ("WHEN") side of a rule. Simpler column types can refer to Facts and Fact fields bound in the BRL fragment and vice-versa.</p>
</div>
<div class="paragraph">
<p>The following example is a condition BRL fragment for a loan application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-condition-BRL.png" alt="Condition BRL Fragment column for guided decision tables designer">
</div>
<div class="title">Figure 306. Add a condition BRL fragment with the embedded guided rules designer</div>
</div>
<div class="paragraph">
<p>You can also select <strong>Free form DRL</strong> from the list of condition options to define the condition BRL fragment without the embedded guided rules designer.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-condition-BRL-free.png" alt="Condition BRL Fragment column for guided decision tables designer" width="with free form DRL option">
</div>
<div class="title">Figure 307. Add a condition BRL fragment with free form DRL</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-condition-BRL-free-02.png" alt="Condition BRL Fragment column for guided decision tables designer" width="with free form DRL field">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Template keys</div>
<div class="paragraph">
<p>When you add a field for a condition BRL fragment, one of the value options is <strong>Template key</strong> (as opposed to <strong>Literal</strong> or <strong>Formula</strong>). Template keys are placeholder variables that are interchanged with a specified value when the guided decision table is generated, and form separate columns in the table for each template key value specified. While Literal and Formula values are static in a decision table, Template key values can be modified as needed.</p>
</div>
<div class="paragraph">
<p>In the embedded guided rules designer, you can add a template key value to a field by selecting the <strong>Template key</strong> field option and entering the value in the editor in the format <code>$key</code>. For example, <code>$age</code> creates an <code>$age</code> column in the decision table.</p>
</div>
<div class="paragraph">
<p>In free form DRL, you can add a template key value to facts in the format <code>@{key}</code>. For example, <code>Person( age &gt; @{age} )</code> creates an <code>$age</code> column in the decision table.</p>
</div>
<div class="paragraph">
<p>The data type is String for new columns added using template keys.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Required column parameters</div>
<p>The following parameters are required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rule Modeller:</strong> Define the condition BRL fragment ("WHEN" portion) for the rule.</p>
</li>
<li>
<p><strong>Header (description):</strong> Add header text for the column.</p>
</li>
<li>
<p><strong>Hide column:</strong> Select this to hide the column, or clear this to display the column.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-metadata-con"><a class="anchor" href="#guided-decision-tables-columns-metadata-con"></a><a class="link" href="#guided-decision-tables-columns-metadata-con">16.4.4.3. "Add a Metadata column"</a></h5>
<div class="paragraph">
<p>With this column option, you can define a metadata element as a column in your decision table. Each column represents the normal metadata annotation in DRL rules. By default, the metadata column is hidden. To display the column, click <strong>Edit Columns</strong> in the guided decision tables designer and clear the <strong>Hide column</strong> check box.</p>
</div>
<div class="paragraph">
<div class="title">Required column parameter</div>
<p>The following parameter is required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Metadata:</strong> Enter the name of the metadata item in Java variable form (that is, it cannot start with a number or contain spaces or special characters).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-action-BRL-con"><a class="anchor" href="#guided-decision-tables-columns-action-BRL-con"></a><a class="link" href="#guided-decision-tables-columns-action-BRL-con">16.4.4.4. "Add an Action BRL fragment"</a></h5>
<div class="paragraph">
<p>A Business Rule Language (BRL) fragment is a section of a rule created using the guided rules designer. The <a href="#guided-decision-tables-columns-condition-BRL-con">condition BRL fragment</a> is the "WHEN" portion of the rule, and the action BRL fragment is the "THEN" portion of the rule. With this column option you can define an action BRL fragment to be used in the right ("THEN") side of a rule. Simpler column types can refer to Facts and Fact fields bound in the BRL fragment and vice-versa.</p>
</div>
<div class="paragraph">
<p>The following example is an action BRL fragment for a loan application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-action-BRL.png" alt="Action BRL Fragment in the guided decision tables designer">
</div>
<div class="title">Figure 308. Add an action BRL fragment with the embedded guided rules designer</div>
</div>
<div class="paragraph">
<p>You can also select <strong>Add free form DRL</strong> from the list of action options to define the action BRL fragment without the embedded guided rules designer.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-action-BRL-free.png" alt="Action BRL Fragment column for guided decision tables designer" width="with free form DRL option">
</div>
<div class="title">Figure 309. Add an action BRL fragment with free form DRL</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-action-BRL-free-02.png" alt="Action BRL Fragment column for guided decision tables designer" width="with free form DRL field">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Template keys</div>
<div class="paragraph">
<p>When you add a field for an action BRL fragment, one of the value options is <strong>Template key</strong> (as opposed to <strong>Literal</strong> or <strong>Formula</strong>). Template keys are placeholder variables that are interchanged with a specified value when the guided decision table is generated, and form separate columns in the table for each template key value specified. While Literal and Formula values are static in a decision table, Template key values can be modified as needed.</p>
</div>
<div class="paragraph">
<p>In the embedded guided rules designer, you can add a template key value to a field by selecting the <strong>Template key</strong> field option and entering the value in the editor in the format <code>$key</code>. For example, <code>$age</code> creates an <code>$age</code> column in the decision table.</p>
</div>
<div class="paragraph">
<p>In free form DRL, you can add a template key value to facts in the format <code>@{key}</code>. For example, <code>Person( age &gt; @{age} )</code> creates an <code>$age</code> column in the decision table.</p>
</div>
<div class="paragraph">
<p>The data type is String for new columns added using template keys.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Required column parameters</div>
<p>The following parameters are required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rule Modeller:</strong> Define the action BRL fragment ("THEN" portion) for the rule.</p>
</li>
<li>
<p><strong>Header (description):</strong> Add header text for the column.</p>
</li>
<li>
<p><strong>Hide column:</strong> Select this to hide the column, or clear this to display the column.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-attribute-con"><a class="anchor" href="#guided-decision-tables-columns-attribute-con"></a><a class="link" href="#guided-decision-tables-columns-attribute-con">16.4.4.5. "Add an Attribute column"</a></h5>
<div class="paragraph">
<p>With this column option, you can add one or more attribute columns representing any of the DRL rule attributes, such as Saliance, Enabled, Date-Effective, and others.</p>
</div>
<div class="paragraph">
<p>For example, the following guided decision table uses the <code>salience</code> attribute to specify rule priority and the <code>enabled</code> attribute to enable or disable rules for evaluation. Rules with a higher <code>salience</code> value are evaluated first, and rules with the <code>enabled</code> attribute are evaluated only if the check box is selected.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-attributes.png" alt="Guided decision table with `salience` and `enabled` attributes">
</div>
<div class="title">Figure 310. Example rules with <code>salience</code> and <code>enabled</code> attributes to define evaluation behavior</div>
</div>
<div class="listingblock">
<div class="title">Example rule source with the rule attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Row 1 Pricing loans"
  salience 100
  enabled true
  when
    ...
  then
    ...
end
...
rule "Row 3 Pricing loans"
  enabled false
  when
    ...
  then
    ...
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For descriptions of each attribute, select the attribute from the list in the wizard.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Hit policies and attributes</div>
<div class="paragraph">
<p>Note that depending on the hit policy that you have defined for the decision table, some attributes may be disabled because they are internally used by the hit policy. For example, if you have assigned the <strong>Resolved Hit</strong> policy to this table so that rows (rules) are applied according to a priority order specified in the table, then the Salience attribute would be obsolete. The reason is that the Salience attribute escalates rule priority according to a defined salience value, and that value would be overridden by the <strong>Resolved Hit</strong> policy in the table.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Required Column Parameter</div>
<p>The following parameter is required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Attribute:</strong> Select the attribute to be applied to the column.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-delete-fact-con"><a class="anchor" href="#guided-decision-tables-columns-delete-fact-con"></a><a class="link" href="#guided-decision-tables-columns-delete-fact-con">16.4.4.6. "Delete an existing fact"</a></h5>
<div class="paragraph">
<p>With this column option, you can implement an action to delete a fact that was added previously as a fact pattern in the table. When this column is created, the fact types are provided in the table cells for that column as a drop-down list, from which users can select only one option.</p>
</div>
<div class="paragraph">
<div class="title">Required column parameters</div>
<p>The following parameters are required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Header (description):</strong> Add header text for the column.</p>
</li>
<li>
<p><strong>Hide column:</strong> Select this to hide the column, or clear this to display the column.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-work-item-con"><a class="anchor" href="#guided-decision-tables-columns-work-item-con"></a><a class="link" href="#guided-decision-tables-columns-work-item-con">16.4.4.7. "Execute a Work Item"</a></h5>
<div class="paragraph">
<p>With this column option, you can execute a work item handler, based on your predefined work item definitions in Business Central. (You can create work items in <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> &#8594; <strong><em>[select project]</em></strong> &#8594; <strong>Add Asset</strong> &#8594; <strong>Work Item definition</strong>.)</p>
</div>
<div class="paragraph">
<div class="title">Required column parameters</div>
<p>The following parameters are required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Work Item:</strong> Select from the list of your predefined work items.</p>
</li>
<li>
<p><strong>Header (description):</strong> Add header text for the column.</p>
</li>
<li>
<p><strong>Hide column:</strong> Select this to hide the column, or clear this to display the column.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-field-con"><a class="anchor" href="#guided-decision-tables-columns-field-con"></a><a class="link" href="#guided-decision-tables-columns-field-con">16.4.4.8. "Set the value of a field"</a></h5>
<div class="paragraph">
<p>With this column option, you can implement an action to set the value of a field on a previously bound fact for the "THEN" portion of the rule.
You have the option to notify the Drools engine of the modified values which could lead to other rules being reactivated.</p>
</div>
<div class="paragraph">
<div class="title">Required column parameters</div>
<p>The following parameters are required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Pattern:</strong> Select from the list of fact patterns already used in conditions or condition BRL fragments in your table or create a new fact pattern. A fact pattern is a combination of an available data object in the package (see the note on <a href="#required-data-objects">Required data objects</a> for details) and a model class binding that you specify. (Examples: <code>LoanApplication [application]</code> or <code>IncomeSource [income]</code> where the bracketed portion is the binding to the given fact type)</p>
</li>
<li>
<p><strong>Field:</strong> Select a field from the previously specified fact pattern. The field options are defined in the fact file in the <strong>Data Objects</strong> panel of your project. (Examples: <code>amount</code> or <code>lengthYears</code> fields within the <code>LoanApplication</code> fact type)</p>
</li>
<li>
<p><strong>Value list (optional):</strong> Enter a list of value options, delimited by a comma and space, to limit table input data for the action ("THEN") portion of the rule. When this value list is defined, the values will be provided in the table cells for that column as a drop-down list, from which users can select only one option. (Example list: <code>Accepted, Declined, Pending</code>)</p>
</li>
<li>
<p><strong>Default value (optional):</strong> Select one of the previously defined value options as the default value that will appear in the cell automatically in a new row. If the default value is not specified, the table cell will be blank by default. You can also select a default value from any previously configured data enumerations in the project, listed in the <strong>Enumeration Definitions</strong> panel of the Project Explorer. (You can create enumerations in <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> &#8594; <strong><em>[select project]</em></strong> &#8594; <strong>Add Asset</strong> &#8594; <strong>Enumeration</strong>.)</p>
</li>
<li>
<p><strong>Header (description):</strong> Add header text for the column.</p>
</li>
<li>
<p><strong>Hide column:</strong> Select this to hide the column, or clear this to display the column.</p>
</li>
<li>
<p><strong>Logically insert:</strong> This option appears when the selected Fact Pattern is not currently used in another column in the guided decision table (see the next field description). Select this to insert the fact pattern logically into the Drools engine, or clear this to insert it regularly. The Drools engine is responsible for logical decisions on insertions and retractions of facts. After regular or stated insertions, facts have to be retracted explicitly. After logical insertions, facts are automatically retracted when the conditions that asserted the facts in the first place are no longer true.</p>
</li>
<li>
<p><strong>Update engine with changes:</strong> This option appears when the selected Fact Pattern is already used in another column in the guided decision table. Select this to update the Drools engine with the modified field values, or clear this to not update the Drools engine.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-field-work-item-con"><a class="anchor" href="#guided-decision-tables-columns-field-work-item-con"></a><a class="link" href="#guided-decision-tables-columns-field-work-item-con">16.4.4.9. "Set the value of a field with a Work Item result"</a></h5>
<div class="paragraph">
<p>With this column option, you can implement an action to set the value of a previously defined fact field to the value of a result of a work item handler for the "THEN" portion of the rule. The work item must define a result parameter of the same data type as a field on a bound fact in order for you to set the field to the return parameter. (You can create work items in <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> &#8594; <strong><em>[select project]</em></strong> &#8594; <strong>Add Asset</strong> &#8594; <strong>Work Item definition</strong>.)</p>
</div>
<div class="paragraph">
<p>An <em><a href="#guided-decision-tables-columns-work-item-con">Execute a Work Item</a></em> column must already be created in the table for this column option to be created.</p>
</div>
<div class="paragraph">
<div class="title">Required column parameters</div>
<p>The following parameters are required in the <strong>Add a new column</strong> wizard to set up this column type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Pattern:</strong> Select from the list of fact patterns already used in your table or create a new fact pattern. A fact pattern is a combination of an available data object in the package (see the note on <a href="#required-data-objects">Required data objects</a> for details) and a model class binding that you specify. (Examples: <code>LoanApplication [application]</code> or <code>IncomeSource [income]</code> where the bracketed portion is the binding to the given fact type)</p>
</li>
<li>
<p><strong>Field:</strong> Select a field from the previously specified fact pattern. The field options are defined in the fact file in the <strong>Data Objects</strong> panel of your project. (Examples: <code>amount</code> or <code>lengthYears</code> fields within the <code>LoanApplication</code> fact type)</p>
</li>
<li>
<p><strong>Work Item:</strong> Select from the list of your predefined work items. (The work item must define a result parameter of the same data type as a field on a bound fact in order for you to set the field to the return parameter.)</p>
</li>
<li>
<p><strong>Header (description):</strong> Add header text for the column.</p>
</li>
<li>
<p><strong>Hide column:</strong> Select this to hide the column, or clear this to display the column.</p>
</li>
<li>
<p><strong>Logically insert:</strong> This option appears when the selected Fact Pattern is not currently used in another column in the guided decision table (see the next field description). Select this to insert the fact pattern logically into the Drools engine, or clear this to insert it regularly. The Drools engine is responsible for logical decisions on insertions and retractions of facts. After regular or stated insertions, facts have to be retracted explicitly. After logical insertions, facts are automatically retracted when the conditions that asserted the facts in the first place are no longer true.</p>
</li>
<li>
<p><strong>Update engine with changes:</strong> This option appears when the selected Fact Pattern is already used in another column in the guided decision table. Select this to update the Drools engine with the modified field values, or clear this to not update the Drools engine.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-columns-edit-proc"><a class="anchor" href="#guided-decision-tables-columns-edit-proc"></a><a class="link" href="#guided-decision-tables-columns-edit-proc">16.4.5. Editing or deleting columns in guided decision tables</a></h4>
<div class="paragraph">
<p>You can edit or delete the columns you have created at any time in the guided decision tables designer.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided decision tables designer, click <strong>Columns</strong>.</p>
</li>
<li>
<p>Expand the appropriate section and click <strong>Edit</strong> or <strong>Delete</strong> next to the column name.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-edit.png" alt="Edit or delete columns in the guided decision tables designer.">
</div>
<div class="title">Figure 311. Edit or delete columns</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A condition column cannot be deleted if an existing action column uses the same pattern-matching parameters as the condition column.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>After any column changes, click <strong>Finish</strong> in the wizard to save.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-rows-create-proc"><a class="anchor" href="#guided-decision-tables-rows-create-proc"></a><a class="link" href="#guided-decision-tables-rows-create-proc">16.4.6. Adding rows and defining rules in guided decision tables</a></h4>
<div class="paragraph">
<p>After you have created your columns in the guided decision table, you can add rows and define rules within the guided decision tables designer.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Columns for the guided decision table have been added as described in <a href="#guided-decision-tables-columns-create-proc">Adding columns to guided decision tables</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the guided decision tables designer, click <strong>Insert</strong> &#8594; <strong>Append row</strong> or one of the <strong>Insert row</strong> options. (You can also click <strong>Insert column</strong> to open the column wizard and define a new column.)</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-rows-add.png" alt="Add rows in the guided decision tables designer">
</div>
<div class="title">Figure 312. Add Rows</div>
</div>
</li>
<li>
<p>Double-click each cell and enter data. For cells with specified values, select from the cell drop-down options.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-rows-add_02.png" alt="Enter data in individual cells">
</div>
<div class="title">Figure 313. Enter input data in each cell</div>
</div>
</li>
<li>
<p>After you define all rows of data in the guided decision table, click <strong>Validate</strong> in the upper-right toolbar of the guided decision tables designer to validate the table. If the table validation fails, address any problems described in the error message, review all components in the table, and try again to validate the table until the table passes.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although guided decision tables have real-time verification and validation, you should still manually validate the completed decision table to ensure optimal results.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Save</strong> in the table designer to save your changes.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>After you define your guided decision table contents, in the upper-right corner of the guided decision tables designer, you can use the search bar if needed to search for text that appears in your guided decision table. The search feature is especially helpful in complex guided decision tables with many values:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-search.png" alt="Search guided decision table contents">
</div>
<div class="title">Figure 314. Search guided decision table contents</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-validation-con"><a class="anchor" href="#guided-decision-tables-validation-con"></a><a class="link" href="#guided-decision-tables-validation-con">16.4.7. Real-time verification and validation of guided decision tables</a></h4>
<div class="paragraph">
<p>Business Central provides a real-time verification and validation feature for guided decision tables to ensure that your tables are complete and error free. Guided decision tables are validated after each cell change. If a problem in logic is detected, an error notification appears and describes the problem.</p>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-errors-ref"><a class="anchor" href="#guided-decision-tables-errors-ref"></a><a class="link" href="#guided-decision-tables-errors-ref">16.4.7.1. Types of problems in guided decision tables</a></h5>
<div class="paragraph">
<p>The validation and verification feature detects the following types of problems:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Redundancy</dt>
<dd>
<p>Redundancy occurs when two rows in a decision table execute the same consequences for the same set of facts.
For example, two rows checking a client&#8217;s birthday and providing a birthday discount may result in double discount.</p>
</dd>
<dt class="hdlist1">Subsumption</dt>
<dd>
<p>Subsumption is similar to redundancy and occurs when two rules execute the same consequences, but one executes on a subset of facts of the other. For example, consider these two rules:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>when Person age &gt; 10 then Increase Counter</em></p>
</li>
<li>
<p><em>when Person age &gt; 20 then Increase Counter</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, if a person is 15 years old, only one rule fires and if a person is 20 years old, both rules fire.
Such cases cause similar trouble during runtime as redundancy.</p>
</div>
</dd>
<dt class="hdlist1">Conflicts</dt>
<dd>
<p>A conflicting situation occurs when two similar conditions have different consequences.
Conflicts can occur between two rows (rules) or two cells in a decision table.</p>
<div class="paragraph">
<p>The following example illustrates conflict between two rows in a decision table:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>when Deposit &gt; 20000 then Approve Loan</em></p>
</li>
<li>
<p><em>when Deposit &gt; 20000 then Refuse Loan</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, there is no way to know if the loan will be approved or not.</p>
</div>
<div class="paragraph">
<p>The following example illustrates conflict between two cells in a decision table:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>when Age &gt; 25</em></p>
</li>
<li>
<p><em>when Age &lt; 25</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>A row with conflicting cells never executes.</p>
</div>
</dd>
<dt class="hdlist1">Broken <em>Unique Hit</em> Policy</dt>
<dd>
<p>When the <strong>Unique Hit</strong> policy is applied to a decision table, only one row at a time can be executed and each row must be unique, with no overlap of conditions being met. If more than one row is executed, then the verification report identifies the broken hit policy. For example, consider the following conditions in a table that determines eligibility for a price discount:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>when Is Student = true</em></p>
</li>
<li>
<p><em>when Is Military = true</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If a customer is both a student and in the military, both conditions apply and break the <strong>Unique Hit</strong> policy. Rows in this type of table must therefore be created in a way that does not allow multiple rules to fire at one time. For details about hit policies, see <a href="#hit-policies-con">Hit policies for guided decision tables</a>.</p>
</div>
</dd>
<dt class="hdlist1">Deficiency</dt>
<dd>
<p>Deficiency is similar to a conflict and occurs the logic of a rule in a decision table is incomplete.
For example, consider the following two deficient rules:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>when Age &gt; 20 then Approve Loan</em></p>
</li>
<li>
<p><em>when Deposit &lt; 20000 then Refuse Loan</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>These two rules may lead to confusion for a person who is over 20 years old and has deposited less than 20000.
You can add more constraints to avoid the conflict.</p>
</div>
</dd>
<dt class="hdlist1">Missing Columns</dt>
<dd>
<p>When deleted columns result in incomplete or incorrect logic, rules cannot fire properly. This is detected so that you can address the missing columns, or adjust the logic to not rely on intentionally deleted conditions or actions.</p>
</dd>
<dt class="hdlist1">Incomplete Ranges</dt>
<dd>
<p>Ranges of field values are incomplete if a table contains constraints against possible field values but does not define all possible values. The verification report identifies any incomplete ranges provided. For example, if your table has a check for if an application is approved, the verification report reminds you to make sure you also handle situations where the application was not approved.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-messages-ref"><a class="anchor" href="#guided-decision-tables-messages-ref"></a><a class="link" href="#guided-decision-tables-messages-ref">16.4.7.2. Types of notifications</a></h5>
<div class="paragraph">
<p>The verification and validation feature uses three types of notifications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="image"><img src="./Workbench/AuthoringAssets/gdtValidationVerificationIconError.png" alt="gdtValidationVerificationIconError"></span> Error: A serious problem that may lead to the guided decision table failing to work as designed at run time. Conflicts, for example, are reported as errors.</p>
</li>
<li>
<p><span class="image"><img src="./Workbench/AuthoringAssets/gdtValidationVerificationIconWarning.png" alt="gdtValidationVerificationIconWarning"></span> Warning: Likely a serious problem that may not prevent the guided decision table from working but requires attention. Subsumptions, for example, are reported as warnings.</p>
</li>
<li>
<p><span class="image"><img src="./Workbench/AuthoringAssets/gdtValidationVerificationIconInfo.png" alt="gdtValidationVerificationIconInfo"></span> Information: A moderate or minor problem that may not prevent the guided decision table from working but requires attention. Missing columns, for example, are reported as information.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Business Central verification and validation does not prevent you from saving an incorrect change.
The feature only reports issues while editing and you can still continue to overlook those and save your changes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-validation-disable-proc"><a class="anchor" href="#guided-decision-tables-validation-disable-proc"></a><a class="link" href="#guided-decision-tables-validation-disable-proc">16.4.7.3. Disabling verification and validation of guided decision tables</a></h5>
<div class="paragraph">
<p>The decision table verification and validation feature of Business Central is enabled by default. This feature helps you validate your guided decision tables, but with complex guided decision tables, this feature can hinder Drools engine performance. You can disable this feature by setting the <code>org.kie.verification.disable-dtable-realtime-verification</code> system property value to <code>true</code> in your Drools distribution.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Navigate to <code>~/standalone-full.xml</code> and add the following system property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;property name="org.kie.verification.disable-dtable-realtime-verification" value="true"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-convert-proc"><a class="anchor" href="#guided-decision-tables-convert-proc"></a><a class="link" href="#guided-decision-tables-convert-proc">16.4.8. Converting a guided decision table to a spreadsheet decision table</a></h4>
<div class="paragraph">
<p>After you define a guided decision table in Business Central, you can convert the guided decision table to an XLS spreadsheet decision table file for offline reference and file sharing. The guided decision table must be an extended entry guided decision table in order to be converted. The conversion tool does not support limited entry guided decision tables.</p>
</div>
<div class="paragraph">
<p>For more information about spreadsheet decision tables, see
<a href="#decision-tables-con_decision-tables">Spreadsheet decision tables</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Guided decision tables and spreadsheet decision tables are different decision table formats that support different features. Any supported features that differ between the two decision table formats are modified or lost when you convert one decision table format to the other.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In Business Central, navigate to the guided decision table asset that you want to convert and in the upper-right toolbar of the decision tables designer, click <strong>Convert to XLS</strong>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-convert.png" alt="Decision table example">
</div>
<div class="title">Figure 315. Convert an uploaded decision table</div>
</div>
<div class="paragraph">
<p>After the conversion, the converted decision table is then available as a spreadsheet decision table asset in your project that you can download for offline reference.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guideddecisiontablegrapheditor"><a class="anchor" href="#_drools.guideddecisiontablegrapheditor"></a><a class="link" href="#_drools.guideddecisiontablegrapheditor">16.5. Guided decision table graphs</a></h3>
<div class="paragraph">
<p>Whilst it is possible to author single Guided Decision Tables it is also possible to author a graph of related tables where an action of one may provide a potential match for a condition of another. In this scenario the tables are said to be related.</p>
</div>
<div class="sect3">
<h4 id="_editor"><a class="anchor" href="#_editor"></a><a class="link" href="#_editor">16.5.1. Editor</a></h4>
<div class="paragraph">
<p>The editor itself preserves all the features of the Guided Decision Table Editor merely adding the ability to visualise multiple tables and their relationships in a single view. Selecting a single table leads to the column definitions panel, Source and Data Objects tabs being updated to reflect the selected table. Validation &amp; Verification reporting is also updated to reflect the selected table. The Overview tab maintains state of the graph as a whole.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-graph-radar.png" alt="dtable graph radar">
</div>
<div class="title">Figure 316. Graph editor and radar</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_new_graph"><a class="anchor" href="#_creating_a_new_graph"></a><a class="link" href="#_creating_a_new_graph">16.5.2. Creating a new graph</a></h4>
<div class="paragraph">
<p>When a new "Guided Decision Table Graph" is first created the target package is scanned for existing single Guided Decision Tables. Those found are checked for relationships and, if any exist, added automatically to the new graph.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_new_tables_to_the_graph"><a class="anchor" href="#_adding_new_tables_to_the_graph"></a><a class="link" href="#_adding_new_tables_to_the_graph">16.5.3. Adding new tables to the graph</a></h4>
<div class="paragraph">
<p>Tables can be added to the graph by clicking on the "Documents&#8230;&#8203;" menu entry. This reveals a tool panel that lists the tables already part of the graph. The same panel gives the User the ability to either add a new table or open an existing table.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-documents-selector.png" alt="dtable documents selector">
</div>
<div class="title">Figure 317. Documents popup</div>
</div>
<div class="sect4">
<h5 id="_adding_new_tables"><a class="anchor" href="#_adding_new_tables"></a><a class="link" href="#_adding_new_tables">16.5.3.1. Adding new tables</a></h5>
<div class="paragraph">
<p>Clicking on "New&#8230;&#8203;" launches the New Guided Decision Table Wizard. On completion of the Wizard the new table will be added to the graph and any relationships automatically added.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adding_existing_tables"><a class="anchor" href="#_adding_existing_tables"></a><a class="link" href="#_adding_existing_tables">16.5.3.2. Adding existing tables</a></h5>
<div class="paragraph">
<p>Clicking on "Open&#8230;&#8203;" reveals a file selector wherefrom one or more existing Guided Decision Tables can be selected and added to the graph. If no additional Guided Decision Tables are found a message is shown to the User.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-documents-open.png" alt="dtable documents open">
</div>
<div class="title">Figure 318. Documents popup - Opening existing</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removing_tables"><a class="anchor" href="#_removing_tables"></a><a class="link" href="#_removing_tables">16.5.4. Removing tables</a></h4>
<div class="paragraph">
<p>Tables can be removed from the graph by opening the "Documents&#8230;&#8203;" panel and clicking on the "X" icon beside the table. Tables removed from the graph are not deleted from the Project and can continue to be edited by the Gudied Decision Table Editor.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guideddecisiontreeeditor"><a class="anchor" href="#_drools.guideddecisiontreeeditor"></a><a class="link" href="#_drools.guideddecisiontreeeditor">16.6. Guided decision trees</a></h3>
<div class="paragraph">
<p>Business Central supports authoring of simple Decision Trees.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The editor does not support nested Data Objects at present.
It is therefore advised to only use Guided Decision Trees with flat Data Object models.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_the_initial_editor_layout"><a class="anchor" href="#_the_initial_editor_layout"></a><a class="link" href="#_the_initial_editor_layout">16.6.1. The initial editor layout</a></h4>
<div class="paragraph">
<p>When a new Guided Decision Tree is created the editor is initially blank.</p>
</div>
<div class="paragraph">
<p>The left-hand side is a palette of available Data Objects, their fields and Actions.</p>
</div>
<div class="paragraph">
<p>The right-hand side is the area where you can drag and drop Data Objects, their fields or Actions to build a tree.</p>
</div>
<div class="paragraph">
<p>The editor will show a connector between the node being dragged and applicable children to which it can be attached.
When the drag is complete the new node will be attached to the applicable child.
Root nodes will not have a connector shown when being dragged to an empty tree.
Completing the drag positions the root node in the centre of the editor.</p>
</div>
<div class="paragraph">
<p>There are various restrictions when composing a tree:-</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A tree must have a Data Object at the root.</p>
</li>
<li>
<p>A tree can only have one root.</p>
</li>
<li>
<p>Data Objects can have either other Data Objects, field constraints or Actions as children.</p>
<div class="paragraph">
<p>The field constraints must be on fields of the same Data Object as the parent node.</p>
</div>
</li>
<li>
<p>Field constraints can have either other field constraints or Actions as children.</p>
<div class="paragraph">
<p>The field constraints must be on fields of the same Data Object as the parent node.</p>
</div>
</li>
<li>
<p>Actions can only have other Actions as children.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor1.png" alt="GuidedDecisionTreeEditor1">
</div>
<div class="title">Figure 319. Guided Decision Trees - Empty editor</div>
</div>
<div class="paragraph">
<p>Expanding the palette reveals Tree Nodes for the Data Object and its fields.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor2.png" alt="GuidedDecisionTreeEditor2">
</div>
<div class="title">Figure 320. Guided Decision Trees - Expanded palette</div>
</div>
</div>
<div class="sect3">
<h4 id="_first_steps"><a class="anchor" href="#_first_steps"></a><a class="link" href="#_first_steps">16.6.2. First steps</a></h4>
<div class="paragraph">
<p>Drag a Data Object on to the tree authoring area.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor3.png" alt="GuidedDecisionTreeEditor3">
</div>
<div class="title">Figure 321. Guided Decision Trees - Data Object root node</div>
</div>
<div class="paragraph">
<p>Clicking on a node selects it.</p>
</div>
<div class="paragraph">
<p>Icons to manipulate the node appear when the node is selected.</p>
</div>
<div class="paragraph">
<p>The icons are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete</p>
<div class="paragraph">
<p>Deleting a node will also delete all children.</p>
</div>
</li>
<li>
<p>Edit</p>
<div class="paragraph">
<p>Collapsed nodes cannot be edited as they contain numerous children.</p>
</div>
</li>
<li>
<p>Collapse</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor4.png" alt="GuidedDecisionTreeEditor4">
</div>
<div class="title">Figure 322. Guided Decision Trees - Selected node</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_data_object_nodes"><a class="anchor" href="#_editing_data_object_nodes"></a><a class="link" href="#_editing_data_object_nodes">16.6.3. Editing Data Object nodes</a></h4>
<div class="paragraph">
<p>Selecting a Data Object node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup shows the Data Object type and allows it to be bound to a variable.
Bound Data Objects can be modified or retracted by Actions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor5.png" alt="GuidedDecisionTreeEditor5">
</div>
<div class="title">Figure 323. Guided Decision Trees - Data Object Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_field_constraint_nodes"><a class="anchor" href="#_editing_field_constraint_nodes"></a><a class="link" href="#_editing_field_constraint_nodes">16.6.4. Editing Field Constraint nodes</a></h4>
<div class="paragraph">
<p>Selecting a Field Constraint node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup shows the Data Object type and field and allows the field to be bound to a variable.
An operator, applicable to the Data Model field&#8217;s data-type, can be selected and a corresponding value entered.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor6.png" alt="GuidedDecisionTreeEditor6">
</div>
<div class="title">Figure 324. Guided Decision Trees - Field Constraint Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_action_nodes"><a class="anchor" href="#_editing_action_nodes"></a><a class="link" href="#_editing_action_nodes">16.6.5. Editing Action nodes</a></h4>
<div class="paragraph">
<p>Selecting an Insert Action node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup allows selection of the Data Object to be inserted and whether it&#8217;s insertion is "logical". Please refer to Drools documentation regarding Truth Maintenance for more information.
Fields for the new Data Object can have values set.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionInsert.png" alt="GuidedDecisionTreeEditorActionInsert">
</div>
<div class="title">Figure 325. Guided Decision Trees - Action "Insert" Editor</div>
</div>
<div class="paragraph">
<p>Selecting an Insert Retract node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup allows any Data Object bound in the path from the selected node to the root node to be selected for retraction.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionRetract.png" alt="GuidedDecisionTreeEditorActionRetract">
</div>
<div class="title">Figure 326. Guided Decision Trees - Action "Retract" Editor</div>
</div>
<div class="paragraph">
<p>Selecting an Insert Update node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup allows any Data Object bound in the path from the selected node to the root node to be modified.
Fields for the modified Data Object can have values set.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionUpdate.png" alt="GuidedDecisionTreeEditorActionUpdate">
</div>
<div class="title">Figure 327. Guided Decision Trees - Action "Update" Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_the_tree"><a class="anchor" href="#_managing_the_tree"></a><a class="link" href="#_managing_the_tree">16.6.6. Managing the tree</a></h4>
<div class="paragraph">
<p>Even simple trees can grow in size and become difficult to maintain.</p>
</div>
<div class="paragraph">
<p>It is therefore possible to collapse parts of the tree, giving more space in the user interface to maintain different parts of the tree.</p>
</div>
<div class="paragraph">
<p>If a node has children, when selected, it will have an icon to collapse the children.
Clicking this icon will collapse children.</p>
</div>
<div class="paragraph">
<p>A collapsed node can equally be expanded by selecting it and clicking on the expand icon.
A collapsed node cannot be edited as it contains numerous children.
Deleting a collapsed node deletes all children too.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorCollapse1.png" alt="GuidedDecisionTreeEditorCollapse1">
</div>
<div class="title">Figure 328. Guided Decision Trees - Collapsing nodes</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorCollapse2.png" alt="GuidedDecisionTreeEditorCollapse2">
</div>
<div class="title">Figure 329. Guided Decision Trees - Collapsed node</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-tables-con_decision-tables"><a class="anchor" href="#decision-tables-con_decision-tables"></a><a class="link" href="#decision-tables-con_decision-tables">16.7. Spreadsheet decision tables</a></h3>
<div class="paragraph">
<p>Spreadsheet decision tables are XLS or XLSX spreadsheets that contain business rules defined in a tabular format. You can include spreadsheet decision tables with standalone Drools projects or upload them to projects in Business Central. Each row in a decision table is a rule, and each column is a condition, an action, or another rule attribute. After you create and upload your spreadsheet decision tables, the rules you defined are compiled into Drools Rule Language (DRL) rules as with all other rule assets.</p>
</div>
<div class="paragraph">
<p>All data objects related to a spreadsheet decision table must be in the same project package as the spreadsheet decision table. Assets in the same package are imported by default. Existing assets in other packages can be imported with the decision table.</p>
</div>
<div class="sect3">
<h4 id="decision-tables-use-case-con"><a class="anchor" href="#decision-tables-use-case-con"></a><a class="link" href="#decision-tables-use-case-con">16.7.1. Decision table use case</a></h4>
<div class="paragraph">
<p>An online shopping site lists the shipping charges for ordered items. The site provides free shipping under the following conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The number of items ordered is 4 or more and the checkout total is $300 or more.</p>
</li>
<li>
<p>Standard shipping is selected (4 or 5 business days from the date of purchase).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are the shipping rates under these conditions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 50. For orders less than $300</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Number of items</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Delivery day</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Shipping charge in USD, N = Number of items</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">3 or fewer</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">35</p>
<p class="tableblock">15</p>
<p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">4 or more</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">N*7.50</p>
<p class="tableblock">N*3.50</p>
<p class="tableblock">N*2.50</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 51. For orders more than $300</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Number of items</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Delivery day</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Shipping charge in USD, N = Number of items</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">3 or fewer</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">25</p>
<p class="tableblock">10</p>
<p class="tableblock">N*1.50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">4 or more</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">N*5</p>
<p class="tableblock">N*2</p>
<p class="tableblock">FREE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These conditions and rates are shown in the following example spreadsheet decision table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-example-02.png" alt="Decision table example">
</div>
<div class="title">Figure 330. Decision table for shipping charges</div>
</div>
<div class="paragraph">
<p>In order for a decision table to be uploaded in Business Central, the table must comply with certain structure and syntax requirements, within an XLS or XLSX spreadsheet, as shown in this example. For more information, see <a href="#decision-tables-defining-proc">Defining spreadsheet decision tables</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-defining-proc"><a class="anchor" href="#decision-tables-defining-proc"></a><a class="link" href="#decision-tables-defining-proc">16.7.2. Defining spreadsheet decision tables</a></h4>
<div class="paragraph">
<p>Spreadsheet decision tables (XLS or XLSX) require two key areas that define rule data: a <code>RuleSet</code> area and a <code>RuleTable</code> area. The <code>RuleSet</code> area of the spreadsheet defines elements that you want to apply globally to all rules in the same package (not only the spreadsheet), such as a rule set name or universal rule attributes. The <code>RuleTable</code> area defines the actual rules (rows) and the conditions, actions, and other rule attributes (columns) that constitute that rule table within the specified rule set. A spreadsheet of decision tables can contain multiple <code>RuleTable</code> areas, but only one <code>RuleSet</code> area.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should typically upload only one spreadsheet of decision tables, containing all necessary <code>RuleTable</code> definitions, per rule package in Business Central. You can upload separate decision table spreadsheets for separate packages, but uploading multiple spreadsheets in the same package can cause compilation errors from conflicting <code>RuleSet</code> or <code>RuleTable</code> attributes and is therefore not recommended.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to the following sample spreadsheet as you define your decision table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-example-02.png" alt="Decision table example">
</div>
<div class="title">Figure 331. Sample spreadsheet decision table for shipping charges</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a new XLS or XLSX spreadsheet, go to the second or third column and label a cell <code>RuleSet</code> (row 1 in example). Reserve the column or columns to the left for descriptive metadata (optional).</p>
</li>
<li>
<p>In the next cell to the right, enter a name for the <code>RuleSet</code>. This named rule set will contain all <code>RuleTable</code> rules defined in the rule package.</p>
</li>
<li>
<p>Under the <code>RuleSet</code> cell, define any rule attributes (one per cell) that you want to apply globally to all rule tables in the package. Specify attribute values in the cells to the right. For example, you can enter an <code>Import</code> label and in the cell to the right, specify relevant data objects from other packages that you want to import into the package for the decision table (in the format <code>package.name.object.name</code>). For supported cell labels and values, see <a href="#decision-tables-rule-set-entries-ref">RuleSet definitions</a>.</p>
</li>
<li>
<p>Below the <code>RuleSet</code> area and in the same column as the <code>RuleSet</code> cell, skip a row and label a new cell <code>RuleTable</code> (row 7 in example) and enter a table name in the same cell. The name is used as the initial part of the name for all rules derived from this rule table, with the row number appended for distinction. You can override this automatic naming by inserting a <code>NAME</code> attribute column.</p>
</li>
<li>
<p>Use the next four rows to define the following elements as needed (rows 8-11 in example):</p>
<div class="ulist">
<ul>
<li>
<p><strong>Rule attributes:</strong> Conditions, actions, or other attributes. For supported cell labels and values, see <a href="#decision-tables-rule-table-entries-ref">RuleTable definitions</a>.</p>
</li>
<li>
<p><strong>Object types:</strong> The data objects to which the rule attributes apply. If the same object type applies to multiple columns, merge the object cells into one cell across multiple columns (as shown in the sample decision table), instead of repeating the object type in multiple cells. When an object type is merged, all columns below the merged range will be combined into one set of constraints within a single pattern for matching a single fact at a time. When an object is repeated in separate columns, the separate columns can create different patterns, potentially matching different or identical facts.</p>
</li>
<li>
<p><strong>Constraints:</strong> Constraints on the object types.</p>
</li>
<li>
<p><strong>Column label:</strong> (Optional) Any descriptive label for the column, as a visual aid. Leave blank if unused.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As an alternative to populating both the object type and constraint cells, you can leave the object type cell or cells empty and enter the full expression in the corresponding constraint cell or cells. For example, instead of <code>Order</code> as the object type and <code>itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code>Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for other constraint cells.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>After you have defined all necessary rule attributes (columns), enter values for each column as needed, row by row, to generate rules (rows 12-17 in example). Cells with no data are ignored (such as when a condition or action does not apply).</p>
<div class="paragraph">
<p>If you need to add more rule tables to this decision table spreadsheet, skip a row after the last rule in the previous table, label another <code>RuleTable</code> cell in the same column as the previous <code>RuleTable</code> and  <code>RuleSet</code> cells, and create the new table following the same steps in this section (rows 19-29 in example).</p>
</div>
</li>
<li>
<p>Save your XLS or XLSX spreadsheet to finish.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the first worksheet in a spreadsheet workbook will be processed as a decision table when you upload the spreadsheet in Business Central. Each <code>RuleSet</code> name combined with the <code>RuleTable</code> name must be unique across all decision table files in the same package.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you upload the decision table in Business Central, the rules are rendered as DRL rules like the following example, from the sample spreadsheet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>//row 12
rule "Basic_12"
salience 10
  when
    $order : Order( itemsCount &gt; 0, itemsCount &lt;= 3, deliverInDays == 1 )
  then
    insert( new Charge( 35 ) );
end</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Enabling white space used in cell values</div>
<div class="paragraph">
<p>By default, any white space before or after values in decision table cells is removed before the decision table is processed by the Drools engine. To retain white space that you use intentionally before or after values in cells, set the <code>drools.trimCellsInDTable</code> system property to <code>false</code> in your Drools distribution.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="decision-tables-rule-set-entries-ref"><a class="anchor" href="#decision-tables-rule-set-entries-ref"></a><a class="link" href="#decision-tables-rule-set-entries-ref">16.7.2.1. RuleSet definitions</a></h5>
<div class="paragraph">
<p>Entries in the <code>RuleSet</code> area of a decision table define DRL constructs and rule attributes that you want to apply to all rules in a package (not only in the spreadsheet). Entries must be in a vertically stacked sequence of cell pairs, where the first cell contains a label and the cell to the right contains the value. A decision table spreadsheet can have only one <code>RuleSet</code> area.</p>
</div>
<div class="paragraph">
<p>The following table lists the supported labels and values for <code>RuleSet</code> definitions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 52. Supported <code>RuleSet</code> definitions</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Label</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Value</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>RuleSet</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">The package name for the generated DRL file. Optional, the default is <code>rule_table</code>.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Must be the first entry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>Sequential</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>true</code> or <code>false</code>. If <code>true</code>, then salience is used to ensure that rules fire from the top down.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, at most once. If omitted, no firing order is imposed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>SequentialMaxPriority</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Integer numeric value</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, at most once. In sequential mode, this option is used to set the start value of the salience. If omitted, the default value is 65535.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>SequentialMinPriority</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Integer numeric value</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, at most once. In sequential mode, this option is used to check if this minimum salience value is not violated. If omitted, the default value is 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>EscapeQuotes</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>true</code> or <code>false</code>. If <code>true</code>, then quotation marks are escaped so that they appear literally in the DRL.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, at most once. If omitted, quotation marks are escaped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>Import</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A comma-separated list of Java classes to import from another package.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>Variables</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Declarations of DRL globals (a type followed by a variable name). Multiple global definitions must be separated by commas.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>Functions</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">One or more function definitions, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>Queries</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">One or more query definitions, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>Declare</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">One or more declarative types, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In some cases, Microsoft Office, LibreOffice, and OpenOffice might encode a double quotation mark differently, causing a compilation error. For example, <code>&#8220;A&#8221;</code> will fail, but <code>"A"</code> will pass.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="decision-tables-rule-table-entries-ref"><a class="anchor" href="#decision-tables-rule-table-entries-ref"></a><a class="link" href="#decision-tables-rule-table-entries-ref">16.7.2.2. RuleTable definitions</a></h5>
<div class="paragraph">
<p>Entries in the <code>RuleTable</code> area of a decision table define conditions, actions, and other rule attributes for the rules in that rule table. A spreadsheet of decision tables can contain multiple <code>RuleTable</code> areas.</p>
</div>
<div class="paragraph">
<p>The following table lists the supported labels (column headers) and values for <code>RuleTable</code> definitions. For column headers, you can use either the given labels or any custom labels that begin with the letters listed in the table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 53. Supported <code>RuleTable</code> definitions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 35%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Label</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Or custom label that begins with</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Value</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>NAME</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Provides the name for the rule generated from that row. The default is constructed from the text following the <code>RuleTable</code> tag and the row number.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">At most one column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>DESCRIPTION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">I</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Results in a comment within the generated rule.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">At most one column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>CONDITION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Code snippet and interpolated values for constructing a constraint within a pattern in a condition.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">At least one per rule table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>ACTION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Code snippet and interpolated values for constructing an action for the consequence of the rule.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">At least one per rule table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>METADATA</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">@</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Code snippet and interpolated values for constructing a metadata entry for the rule.</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Optional, any number of columns.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following sections provide more details about how condition, action, and metadata columns use cell data:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Conditions</dt>
<dd>
<p>For columns headed <code>CONDITION</code>, the cells in consecutive lines result in a conditional element:</p>
<div class="ulist">
<ul>
<li>
<p><strong>First cell:</strong> Text in the first cell below <code>CONDITION</code> develops into a pattern for the rule condition, and uses the snippet in the next line as a constraint. If the cell is merged with one or more neighboring cells, a single pattern with multiple constraints is formed. All constraints are combined into a parenthesized list and appended to the text in this cell.</p>
<div class="paragraph">
<p>If this cell is empty, the code snippet in the cell below it must result in a valid conditional element on its own. For example, instead of <code>Order</code> as the object type and <code>itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code>Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for any other constraint cells.</p>
</div>
<div class="paragraph">
<p>To include a pattern without constraints, you can write the pattern in front of the text of another pattern, with or without an empty pair of parentheses. You can also append a <code>from</code> clause to the pattern.</p>
</div>
<div class="paragraph">
<p>If the pattern ends with <code>eval</code>, code snippets produce boolean expressions for inclusion into a pair of parentheses after <code>eval</code>.</p>
</div>
</li>
<li>
<p><strong>Second cell:</strong> Text in the second cell below <code>CONDITION</code> is processed as a constraint on the object reference in the first cell. The code snippet in this cell is modified by interpolating values from cells farther down in the column. If you want to create a constraint consisting of a comparison using <code>==</code> with the value from the cells below, then the field selector alone is sufficient. Any other comparison operator must be specified as the last item within the snippet, and the value from the cells below is appended. For all other constraint forms, you must mark the position for including the contents of a cell with the symbol <code>$param</code>. Multiple insertions are possible if you use the symbols <code>$1</code>, <code>$2</code>, and so on, and a comma-separated list of values in the cells below. However, do not separate <code>$1</code>, <code>$2</code>, and so on, by commas, or the table will fail to process.</p>
<div class="paragraph">
<p>To expand a text according to the pattern <code>forall($delimiter){$snippet}</code>, repeat the <code>$snippet</code> once for each of the values of the comma-separated list in each of the cells below, insert the value in place of the symbol <code>$</code>, and join these expansions by the given <code>$delimiter</code>. Note that the <code>forall</code> construct may be surrounded by other text.</p>
</div>
<div class="paragraph">
<p>If the first cell contains an object, the completed code snippet is added to the conditional element from that cell. A pair of parentheses is provided automatically, as well as a separating comma if multiple constraints are added to a pattern in a merged cell. If the first cell is empty, the code snippet in this cell must result in a valid conditional element on its own. For example, instead of <code>Order</code> as the object type and <code>itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code>Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for any other constraint cells.</p>
</div>
</li>
<li>
<p><strong>Third cell:</strong> Text in the third cell below <code>CONDITION</code> is a descriptive label that you define for the column, as a visual aid.</p>
</li>
<li>
<p><strong>Fourth cell:</strong> From the fourth row on, non-blank entries provide data for interpolation. A blank cell omits the condition or constraint for this rule.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Actions</dt>
<dd>
<p>For columns headed <code>ACTION</code>, the cells in consecutive lines result in an action statement:</p>
<div class="ulist">
<ul>
<li>
<p><strong>First cell:</strong> Text in the first cell below <code>ACTION</code> is optional. If present, the text is interpreted as an object reference.</p>
</li>
<li>
<p><strong>Second cell:</strong> Text in the second cell below <code>ACTION</code> is a code snippet that is modified by interpolating values from cells farther down in the column. For a singular insertion, mark the position for including the contents of a cell with the symbol <code>$param</code>. Multiple insertions are possible if you use the symbols <code>$1</code>, <code>$2</code>, and so on, and a comma-separated list of values in the cells below. However, do not separate <code>$1</code>, <code>$2</code>, and so on, by commas, or the table will fail to process.</p>
<div class="paragraph">
<p>A text without any marker symbols can execute a method call without interpolation. In this case, use any non-blank entry in a row below the cell to include the statement. The <code>forall</code> construct is supported.</p>
</div>
<div class="paragraph">
<p>If the first cell contains an object, then the cell text (followed by a period), the text in the second cell, and a terminating semicolon are strung together, resulting in a method call that is added as an action statement for the consequence. If the first cell is empty, the code snippet in this cell must result in a valid action element on its own.</p>
</div>
</li>
<li>
<p><strong>Third cell:</strong> Text in the third cell below <code>ACTION</code> is a descriptive label that you define for the column, as a visual aid.</p>
</li>
<li>
<p><strong>Fourth cell:</strong> From the fourth row on, non-blank entries provide data for interpolation. A blank cell omits the condition or constraint for this rule.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Metadata</dt>
<dd>
<p>For columns headed <code>METADATA</code>, the cells in consecutive lines result in a metadata annotation for the generated rules:</p>
<div class="ulist">
<ul>
<li>
<p><strong>First cell:</strong> Text in the first cell below <code>METADATA</code> is ignored.</p>
</li>
<li>
<p><strong>Second cell:</strong> Text in the second cell below <code>METADATA</code> is subject to interpolation, using values from the cells in the rule rows. The metadata marker character <code>@</code> is prefixed automatically, so you do not need to include that character in the text for this cell.</p>
</li>
<li>
<p><strong>Third cell:</strong> Text in the third cell below <code>METADATA</code> is a descriptive label that you define for the column, as a visual aid.</p>
</li>
<li>
<p><strong>Fourth cell:</strong> From the fourth row on, non-blank entries provide data for interpolation. A blank cell results in the omission of the metadata annotation for this rule.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="decision-tables-attributes-ref"><a class="anchor" href="#decision-tables-attributes-ref"></a><a class="link" href="#decision-tables-attributes-ref">16.7.2.3. Additional rule attributes for RuleSet or RuleTable definitions</a></h5>
<div class="paragraph">
<p>The <code>RuleSet</code> and <code>RuleTable</code> areas also support labels and values for other rule attributes, such as <code>PRIORITY</code> or <code>NO-LOOP</code>. Rule attributes specified in a <code>RuleSet</code> area will affect all rule assets in the same package (not only in the spreadsheet). Rule attributes specified in a <code>RuleTable</code> area will affect only the rules in that rule table. You can use each rule attribute only once in a <code>RuleSet</code> area and once in a <code>RuleTable</code> area. If the same attribute is used in both <code>RuleSet</code> and <code>RuleTable</code> areas within the spreadsheet, then <code>RuleTable</code> takes priority and the attribute in the <code>RuleSet</code> area is overridden.</p>
</div>
<div class="paragraph">
<p>The following table lists the supported labels (column headers) and values for additional <code>RuleSet</code> or <code>RuleTable</code> definitions. For column headers, you can use either the given labels or any custom labels that begin with the letters listed in the table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 54. Additional rule attributes for <code>RuleSet</code> or <code>RuleTable</code> definitions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Label</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Or custom label that begins with</th>
<th class="tableblock halign-left valign-top" style="background-color: #ffffff;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>PRIORITY</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">An integer defining the <code>salience</code> value of the rule. Rules with a higher salience value are given higher priority when ordered in the activation queue. Overridden by the <code>Sequential</code> flag.</p>
<p class="tableblock">Example: <code>PRIORITY 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>DATE-EFFECTIVE</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code>DATE-EFFECTIVE</code> attribute.</p>
<p class="tableblock">Example: <code>DATE-EFFECTIVE "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>DATE-EXPIRES</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">Z</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code>DATE-EXPIRES</code> attribute.</p>
<p class="tableblock">Example: <code>DATE-EXPIRES "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>NO-LOOP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value. When this option is set to <code>true</code>, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition.</p>
<p class="tableblock">Example: <code>NO-LOOP true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>AGENDA-GROUP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">G</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an agenda group to which you want to assign the rule. Agenda groups allow you to partition the agenda to provide more execution control over groups of rules. Only rules in an agenda group that has acquired a focus are able to be activated.</p>
<p class="tableblock">Example: <code>AGENDA-GROUP "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>ACTIVATION-GROUP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying an activation (or XOR) group to which you want to assign the rule. In activation groups, only one rule can be activated. The first rule to fire will cancel all pending activations of all rules in the activation group.</p>
<p class="tableblock">Example: <code>ACTIVATION-GROUP "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>DURATION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.</p>
<p class="tableblock">Example: <code>DURATION 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>TIMER</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling the rule.</p>
<p class="tableblock">Example: <code>TIMER "*/5 * * * *"</code>  (every 5 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>CALENDAR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Quartz calendar definition for scheduling the rule.</p>
<p class="tableblock">Example: <code>CALENDAR "* * 0-7,18-23 ? * *"</code>  (exclude non-business hours)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>AUTO-FOCUS</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within agenda groups. When this option is set to <code>true</code>, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.</p>
<p class="tableblock">Example: <code>AUTO-FOCUS true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>LOCK-ON-ACTIVE</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">L</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A Boolean value, applicable only to rules within rule flow groups or agenda groups. When this option is set to <code>true</code>, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code>no-loop</code> attribute, because the activation of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.</p>
<p class="tableblock">Example: <code>LOCK-ON-ACTIVE true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock"><code>RULEFLOW-GROUP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #ffffff;"><p class="tableblock">A string identifying a rule flow group. In rule flow groups, rules can fire only when the group is activated by the associated rule flow.</p>
<p class="tableblock">Example: <code>RULEFLOW-GROUP "GroupName"</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-example-03.png" alt="Example decision table with definitions used">
</div>
<div class="title">Figure 332. Sample decision table spreadsheet with attribute columns</div>
</div>
</div>
<div class="sect4">
<h5 id="_examples_of_decision_table_data_interpolation"><a class="anchor" href="#_examples_of_decision_table_data_interpolation"></a><a class="link" href="#_examples_of_decision_table_data_interpolation">16.7.2.4. Examples of decision table data interpolation</a></h5>
<div class="paragraph">
<p>The various interpolations of data in decision tables are illustrated in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 106. Interpolating cell data</div>
<div class="content">
<div class="paragraph">
<p>If the template is <code>Foo(bar == $param)</code> and the cell is <code>42</code>, then the result is <code>Foo(bar == 42)</code>.</p>
</div>
<div class="paragraph">
<p>If the template is <code>Foo(bar &lt; $1, baz == $2)</code> and the cell contains <code>42,43</code>, the result will be <code>Foo(bar &lt; 42, baz ==43)</code>.</p>
</div>
<div class="paragraph">
<p>The template <code>forall(&amp;&amp;){bar != $}</code> with a cell containing <code>42,43</code> results in <code>bar != 42 &amp;&amp; bar != 43</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The next example demonstrates the joint effect of a cell defining the pattern type and the code snippet below it.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2" style="background-color: #ffffff;">RuleTable Cheese fans</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2" style="background-color: #fcedcd;"><p class="tableblock">Person</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">age</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">type</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Persons age</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Cheese type</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">stilton</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">cheddar</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This spreadsheet section shows how the <code>Person</code> type declaration spans 2 columns, and thus both constraints will appear as <code>Person(age == &#8230;&#8203;, type == &#8230;&#8203;)</code>.
Since only the field names are present in the snippet, they imply an equality test.</p>
</div>
<div class="paragraph">
<p>In the following example the marker symbol <code>$param</code> is used.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">Person</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">age == $param</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Persons age
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The result of this column is the pattern <code>Person(age == 42))</code>.
You may have noticed that the marker and the operator "==" are redundant.</p>
</div>
<div class="paragraph">
<p>The next example illustrates that a trailing insertion marker can be omitted.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">Person</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">age &lt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Persons age
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here, appending the value from the cell is implied, resulting in <code>Person(age &lt; 42)).</code></p>
</div>
<div class="paragraph">
<p>You can provide the definition of a binding variable, as in the example below.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">c : Cheese</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">type</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Cheese type
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">stilton</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here, the result is <code>c: Cheese(type == "stilton").</code> Note that the quotes are provided automatically.
Actually, anything can be placed in the object type row.
Apart from the definition of a binding variable, it could also be an additional pattern that is to be inserted literally.</p>
</div>
<div class="paragraph">
<p>A simple construction of an action statement with the insertion of a single value is shown below.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">list.add("$param");</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Log
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Old man stilton</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The cell below the ACTION header is left blank.
Using this style, anything can be placed in the consequence, not just a single method call.
(The same technique is applicable within a CONDITION column as well.)</p>
</div>
<div class="paragraph">
<p>Below is a comprehensive example, showing the use of various column headers.
It is not an error to have no value below a column header (as in the NO-LOOP column): here, the attribute will not be applied in any of the rules.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./DecisionTables/Key.png" alt="Key">
</div>
<div class="title">Figure 333. Example usage of keywords for imports, headers, etc.</div>
</div>
<div class="paragraph">
<p>And, finally, here is an example of Import and Functions.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 80%;">
<caption class="title">Table 55. Example of functions for computing price and discount claim.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #000000;"><p class="tableblock"><span class="white">RuleSet</span></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #000000;"><p class="tableblock"><span class="white">Cheese Price</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><p class="tableblock">Import</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><p class="tableblock">com.sample.Cheese, com.sample.Person</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><p class="tableblock">Functions</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><div class="content"><div class="listingblock">
<div class="content">
<pre>function int computePrice(Cheese cheese) {
    if (cheese.getType() == "cheddar") {
        return 10;
    } else if (cheese.getType() == "stilton") {
        return 15;
    } else {
        return 20;
    }
}

function boolean hasDiscount(Person person) {
    if (person.getAge() &gt; 60) {
        return true;
    } else {
        return false;
    }
}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Multiple package names within the same cell must be separated by a comma.
Also, the pairs of type and variable names must be comma-separated.
Functions, however, must be written as they appear in a DRL file.
This should appear in the same column as the "RuleSet" keyword; it could be above, between or below all the rule rows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may be more convenient to use Import, Variables, Functions and Queries repeatedly rather than packing several definitions into a single cell.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_and_integrating_spreadsheet_decision_tables"><a class="anchor" href="#_creating_and_integrating_spreadsheet_decision_tables"></a><a class="link" href="#_creating_and_integrating_spreadsheet_decision_tables">16.7.3. Creating and integrating spreadsheet decision tables</a></h4>
<div class="paragraph">
<p>The API to use spreadsheet decision tables is in the <code>drools-decisiontables</code> module.
There is really only one class to look at: <code>SpreadsheetCompiler</code>.
This class will take spreadsheets in various formats, and generate rules in DRL (which you can then use in the normal way). The <code>SpreadsheetCompiler</code> can just be used to generate partial rule files if it is wished, and assemble it into a complete rule package after the fact (this allows the separation of technical and non-technical aspects of the rules if needed).</p>
</div>
<div class="paragraph">
<p>To get started, a sample spreadsheet can be used as a base.
Alternatively, if the plug-in is being used, the wizard can generate a spreadsheet from a template (to edit it an xls compatible spreadsheet editor will need to be used).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./DecisionTables/wizard.png" alt="wizard">
</div>
<div class="title">Figure 334. Wizard in the IDE</div>
</div>
</div>
<div class="sect3">
<h4 id="_decision_table_workflow_and_collaboration"><a class="anchor" href="#_decision_table_workflow_and_collaboration"></a><a class="link" href="#_decision_table_workflow_and_collaboration">16.7.4. Decision table workflow and collaboration</a></h4>
<div class="paragraph">
<p>Spreadsheets are well established business tools (in use for over 25 years). Decision tables lend themselves to close collaboration between IT and domain experts, while making the business rules clear to business analysts, it is an ideal separation of concerns.</p>
</div>
<div class="paragraph">
<p>Typically, the whole process of authoring rules (coming up with a new decision table) would be something like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Business analyst takes a template decision table (from a repository, or from IT)</p>
</li>
<li>
<p>Decision table business language descriptions are entered in the table(s)</p>
</li>
<li>
<p>Decision table rules (rows) are entered (roughly)</p>
</li>
<li>
<p>Decision table is handed to a technical resource, who maps the business language (descriptions) to scripts (this may involve software development of course, if it is a new application or data model)</p>
</li>
<li>
<p>Technical person hands back and reviews the modifications with the business analyst.</p>
</li>
<li>
<p>The business analyst can continue editing the rule rows as needed (moving columns around is also fine etc).</p>
</li>
<li>
<p>In parallel, the technical person can develop test cases for the rules (liaising with business analysts) as these test cases can be used to verify rules and rule changes once the system is running.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_spreadsheet_features"><a class="anchor" href="#_using_spreadsheet_features"></a><a class="link" href="#_using_spreadsheet_features">16.7.5. Using spreadsheet features</a></h4>
<div class="paragraph">
<p>Features of applications like Excel can be used to provide assistance in entering data into spreadsheets, such as validating fields.
Lists that are stored in other worksheets can be used to provide valid lists of values for cells, like in the following diagram.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./DecisionTables/lists.png" alt="lists">
</div>
</div>
<div class="paragraph">
<p>Some applications provide a limited ability to keep a history of changes, but it is recommended to use an alternative means of revision control.
When changes are being made to rules over time, older versions are archived (many open source solutions exist for this, such as Subversion or Git).</p>
</div>
</div>
<div class="sect3">
<h4 id="_rule_templates"><a class="anchor" href="#_rule_templates"></a><a class="link" href="#_rule_templates">16.7.6. Rule templates</a></h4>
<div class="paragraph">
<p>Related to decision tables (but not necessarily requiring a spreadsheet) are "Rule Templates" (in the drools-templates module). These use any tabular data source as a source of rule data - populating a template to generate many rules.
This can allow both for more flexible spreadsheets, but also rules in existing databases for instance (at the cost of developing the template up front to generate the rules).</p>
</div>
<div class="paragraph">
<p>With Rule Templates the data is separated from the rule and there are no restrictions on which part of the rule is data-driven.
So whilst you can do everything you could do in decision tables you can also do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>store your data in a database (or any other format)</p>
</li>
<li>
<p>conditionally generate rules based on the values in the data</p>
</li>
<li>
<p>use data for any part of your rules (e.g. condition operator, class name, property name)</p>
</li>
<li>
<p>run different templates over the same data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, a more classic decision table is shown, but without any hidden rows for the rule meta data (so the spreadsheet only contains the raw data to generate the rules).</p>
</div>
<table class="tableblock frame-all grid-all stretch center">
<caption class="title">Table 56. Template data</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Case</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Person age</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Cheese type</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Log</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Old guy</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">stilton</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Old man stilton</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Young guy</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">cheddar</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Young man cheddar</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <em class="path">ExampleCheese.xls</em> in the examples download for the above spreadsheet.</p>
</div>
<div class="paragraph">
<p>If this was a regular decision table there would be hidden rows before row 1 and between rows 1 and 2 containing rule metadata.
With rule templates the data is completely separate from the rules.
This has two handy consequences - you can apply multiple rule templates to the same data and your data is not tied to your rules at all.
So what does the template look like?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>1  template header
2  age
3  type
4  log
5
6  package org.drools.examples.templates;
7
8  global java.util.List list;
9
10 template "cheesefans"
11
12 rule "Cheese fans_@{row.rowNumber}"
13 when
14    Person(age == @{age})
15    Cheese(type == "@{type}")
16 then
17    list.add("@{log}");
18 end
19
20 end template</code></pre>
</div>
</div>
<div class="paragraph">
<p>Annotations to the preceding program listing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1: All rule templates start with <code>template header</code>.</p>
</li>
<li>
<p>Lines 2-4: Following the header is the list of columns in the order they appear in the data. In this case we are calling the first column <code>age</code>, the second <code>type</code> and the third <code>log</code>.</p>
</li>
<li>
<p>Line 5: An empty line signifies the end of the column definitions.</p>
</li>
<li>
<p>Lines 6-9: Standard rule header text. This is standard rule DRL and will appear at the top of the generated DRL. Put the package statement and any imports and global and function definitions into this section.</p>
</li>
<li>
<p>Line 10: The keyword <code>template</code> signals the start of a rule template. There can be more than one template in a template file, but each template should have a unique name.</p>
</li>
<li>
<p>Lines 11-18: The rule template - see below for details.</p>
</li>
<li>
<p>Line 20: The keywords <code>end template</code> signify the end of the template.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rule templates rely on MVEL to do substitution using the syntax @{token_name}. There is currently one built-in expression, @{row.rowNumber} which gives a unique number for each row of data and enables you to generate unique rule names.
For each row of data a rule will be generated with the values in the data substituted for the tokens in the template.</p>
</div>
<div class="paragraph">
<p>A rule template has to be included in a file with extension .drt and associated to the corresponding decision table when defining the kbase in the kmodule.xml file as in the following example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kmodule xmlns="http://drools.org/xsd/kmodule"&gt;
  &lt;kbase name="TemplatesKB" packages="org.drools.examples.templates"&gt;
    &lt;ruleTemplate dtable="org/drools/examples/templates/ExampleCheese.xls"
                  template="org/drools/examples/templates/Cheese.drt"
                  row="2" col="2"/&gt;
      &lt;ksession name="TemplatesKS"/&gt;
      &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the example data above the following rule file would be generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.drools.examples.templates;

global java.util.List list;

rule "Cheese fans_1"
when
  Person( age == 42 )
  Cheese( type == "stilton" )
then
  list.add( "Old man stilton" );
end

rule "Cheese fans_2"
when
  Person( age == 21 )
  Cheese( type == "cheddar" )
then
  list.add( "Young man cheddar" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point the <code>KieSession</code> named "TemplatesKS" and containing the rules generated from the template can be simply created from the <code>KieContainer</code> and used as any other <code>KieSession</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kc.newKieSession("TemplatesKS");

// now create some test data
ksession.insert(new Cheese("stilton", 42));
ksession.insert(new Person("michael", "stilton", 42));
final List&lt;String&gt; list = new ArrayList&lt;String&gt;();
ksession.setGlobal("list", list);

ksession.fireAllRules();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-upload-proc"><a class="anchor" href="#decision-tables-upload-proc"></a><a class="link" href="#decision-tables-upload-proc">16.7.7. Uploading spreadsheet decision tables to Business Central</a></h4>
<div class="paragraph">
<p>After you define your rules in an external XLS or XLSX spreadsheet of decision tables, you can upload the spreadsheet file to your project in Business Central.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should typically upload only one spreadsheet of decision tables, containing all necessary <code>RuleTable</code> definitions, per rule package in Business Central. You can upload separate decision table spreadsheets for separate packages, but uploading multiple spreadsheets in the same package can cause compilation errors from conflicting <code>RuleSet</code> or <code>RuleTable</code> attributes and is therefore not recommended.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Decision Table (Spreadsheet)</strong>.</p>
</li>
<li>
<p>Enter an informative <strong>Decision Table</strong> name and select the appropriate <strong>Package</strong>.</p>
</li>
<li>
<p>Select the file type (<strong>xls</strong> or <strong>xlsx</strong>), click the <strong>Choose File</strong> icon, and select the spreadsheet. Click <strong>Ok</strong> to upload.</p>
</li>
<li>
<p>In the decision tables designer, click <strong>Validate</strong> in the upper-right toolbar to validate the table. If the table validation fails, open the XLS or XLSX file and address any syntax errors. For syntax help, see <a href="#decision-tables-defining-proc">Defining spreadsheet decision tables</a>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You can upload a new version of the decision table or download the current version:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-uploaded.png" alt="Decision table example">
</div>
<div class="title">Figure 335. Uploaded decision table options</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-convert-proc"><a class="anchor" href="#decision-tables-convert-proc"></a><a class="link" href="#decision-tables-convert-proc">16.7.8. Converting an uploaded spreadsheet decision table to a guided decision table in Business Central</a></h4>
<div class="paragraph">
<p>After you upload an XLS or XLSX spreadsheet decision table file to your project in Business Central, you can convert the decision table to a guided decision table that you can modify directly in Business Central.</p>
</div>
<div class="paragraph">
<p>For more information about guided decision tables, see
<a href="#guided-decision-tables-con">Guided decision tables</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Guided decision tables and spreadsheet decision tables are different decision table formats that support different features. Any supported features that differ between the two decision table formats are modified or lost when you convert one decision table format to the other.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In Business Central, navigate to the uploaded decision table asset that you want to convert and in the upper-right toolbar of the decision tables designer, click <strong>Convert</strong>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-uploaded-convert.png" alt="Decision table example">
</div>
<div class="title">Figure 336. Convert an uploaded decision table</div>
</div>
<div class="paragraph">
<p>After the conversion, the converted decision table is then available as a guided decision table asset in your project that you can modify directly in Business Central.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="drl-rules-con_drl-rules"><a class="anchor" href="#drl-rules-con_drl-rules"></a><a class="link" href="#drl-rules-con_drl-rules">16.8. DRL (Drools Rule Language) rules</a></h3>
<div class="paragraph">
<p>DRL (Drools Rule Language) rules are business rules that you define directly in <code>.drl</code> text files. These DRL files are the source in which all other rule assets in Business Central are ultimately rendered. You can create and manage DRL files within the Business Central interface, or create them externally as part of a Maven or Java project using Red Hat CodeReady Studio or another integrated development environment (IDE). A DRL file can contain one or more rules that define at a minimum the rule conditions (<code>when</code>) and actions (<code>then</code>). The DRL designer in Business Central provides syntax highlighting for Java, DRL, and XML.</p>
</div>
<div class="paragraph">
<p>DRL files consist of the following components:</p>
</div>
<div class="listingblock">
<div class="title">Components in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>package

import

function  // Optional

query  // Optional

declare   // Optional

global   // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example DRL rule determines the age limit in a loan application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example rule for loan application age limit</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  salience 15
  agenda-group "applicationGroup"
  when
    $application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>A DRL file can contain single or multiple rules, queries, and functions, and can define resource declarations such as imports, globals, and attributes that are assigned and used by your rules and queries. The DRL package must be listed at the top of a DRL file and the rules are typically listed last. All other DRL components can follow any order.</p>
</div>
<div class="paragraph">
<p>Each rule must have a unique name within the rule package. If you use the same rule name more than once in any DRL file in the package, the rules fail to compile. Always enclose rule names with double quotation marks (<code>rule "rule name"</code>) to  prevent possible compilation errors, especially if you use spaces in rule names.</p>
</div>
<div class="paragraph">
<p>All data objects related to a DRL rule must be in the same project package as the DRL file in Business Central. Assets in the same package are imported by default. Existing assets in other packages can be imported with the DRL rule.</p>
</div>
<div class="sect3">
<h4 id="drl-rules-central-create-proc"><a class="anchor" href="#drl-rules-central-create-proc"></a><a class="link" href="#drl-rules-central-create-proc">16.8.1. Creating DRL rules in Business Central</a></h4>
<div class="paragraph">
<p>You can create and manage DRL rules for your project in Business Central. In each DRL rule file, you define rule conditions, actions, and other components related to the rule, based on the data objects you create or import in the package.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>DRL file</strong>.</p>
</li>
<li>
<p>Enter an informative <strong>DRL file</strong> name and select the appropriate <strong>Package</strong>. The package that you specify must be the same package where the required data objects have been assigned or will be assigned.</p>
<div class="paragraph">
<p>You can also select <strong>Show declared DSL sentences</strong> if any domain specific language (DSL) assets have been defined in your project. These DSL assets will then become usable objects for conditions and actions that you define in the DRL designer.</p>
</div>
</li>
<li>
<p>Click <strong>Ok</strong> to create the rule asset.</p>
<div class="paragraph">
<p>The new DRL file is now listed in the <strong>DRL</strong> panel of the <strong>Project Explorer</strong>, or in the <strong>DSLR</strong> panel if you selected the <strong>Show declared DSL sentences</strong> option. The package to which you assigned this DRL file is listed at the top of the file.</p>
</div>
</li>
<li>
<p>In the <strong>Fact types</strong> list in the left panel of the DRL designer, confirm that all data objects and data object fields (expand each) required for your rules are listed. If not, you can either import relevant data objects from other packages by using <code>import</code> statements in the DRL file, or
<a href="#_wb.datamodeller">create data objects</a>
within your package.</p>
</li>
<li>
<p>After all data objects are in place, return to the <strong>Model</strong> tab of the DRL designer and define the DRL file with any of the following components:</p>
<div class="listingblock">
<div class="title">Components in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>package

import

function  // Optional

query  // Optional

declare   // Optional

global   // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>package</code>: (automatic) This was defined for you when you created the DRL file and selected the package.</p>
</li>
<li>
<p><code>import</code>: Use this to identify the data objects from either this package or another package that you want to use in the DRL file. Specify the package and data object in the format <code>packageName.objectName</code>, with multiple imports on separate lines.</p>
<div class="listingblock">
<div class="title">Importing data objects</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.mortgages.LoanApplication;</code></pre>
</div>
</div>
</li>
<li>
<p><code>function</code>: (optional) Use this to include a function to be used by rules in the DRL file. Functions in DRL files put semantic code in your rule source file instead of in Java classes. Functions are especially useful if an action (<code>then</code>) part of a rule is used repeatedly and only the parameters differ for each rule. Above the rules in the DRL file, you can declare the function or import a static method from a helper class as a function, and then use the function by name in an action (<code>then</code>) part of the rule.</p>
<div class="listingblock">
<div class="title">Declaring and using a function with a rule (option 1)</div>
<div class="content">
<pre class="highlightjs highlight"><code>function String hello(String applicantName) {
    return "Hello " + applicantName + "!";
}

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Importing and using the function with a rule (option 2)</div>
<div class="content">
<pre class="highlightjs highlight"><code>import function my.package.applicant.hello;

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
</li>
<li>
<p><code>query</code>: (optional) Use this to search the Drools engine for facts related to the rules in the DRL file. You add the query definitions in DRL files and then obtain the matching results in your application code. Queries search for a set of defined conditions and do not require <code>when</code> or <code>then</code> specifications. Query names are global to the KIE base and therefore must be unique among all other rule queries in the project. To return the results of a query, construct a traditional <code>QueryResults</code> definition using <code>ksession.getQueryResults("name")</code>, where <code>"name"</code> is the query name. This returns a list of query results, which enable you to retrieve the objects that matched the query. Define the query and query results parameters above the rules in the DRL file.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example query definition in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code>query "people under the age of 21"
    $person : Person( age &lt; 21 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example application code to obtain query results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age  of 21" );</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>declare</code>: (optional) Use this to declare a new fact type to be used by rules in the DRL file. The default fact type in the <code>java.lang</code> package of Drools is <code>Object</code>, but you can declare other types in DRL files as needed. Declaring fact types in DRL files enables you to define a new fact model directly in the Drools engine, without creating models in a lower-level language like Java.</p>
<div class="listingblock">
<div class="title">Declaring and using a new fact type</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  name : String
  dateOfBirth : java.util.Date
  address : Address
end

rule "Using a declared type"
  when
    $p : Person( name == "James" )
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    insert( mark );
end</code></pre>
</div>
</div>
</li>
<li>
<p><code>global</code>: (optional) Use this to include a global variable to be used by rules in the DRL file. Global variables typically provide data or services for the rules, such as application services used in rule consequences, and return data from rules, such as logs or values added in rule consequences. Set the global value in the working memory of the Drools engine through a KIE session configuration or REST operation, declare the global variable above the rules in the DRL file, and then use it in an action (<code>then</code>) part of the rule. For multiple global variables, use separate lines in the DRL file.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Setting the global list configuration for the Drools engine</div>
<div class="content">
<pre class="highlightjs highlight"><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
KieSession kieSession = kiebase.newKieSession();
kieSession.setGlobal( "myGlobalList", list );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Defining the global list in a rule</div>
<div class="content">
<pre class="highlightjs highlight"><code>global java.util.List myGlobalList;

rule "Using a global"
  when
    // Empty
  then
    myGlobalList.add( "My global list" );
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use global variables to establish conditions in rules unless a global variable has a constant immutable value. Global variables are not inserted into the working memory of the Drools engine, so the Drools engine cannot track value changes of variables.</p>
</div>
<div class="paragraph">
<p>Do not use global variables to share data between rules. Rules always reason and react to the working memory state, so if you want to pass data from rule to rule, assert the data as facts into the working memory of the Drools engine.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p><code>rule</code>: Use this to define each rule in the DRL file. Rules consist of a rule name in the format <code>rule "name"</code>, followed by optional attributes that define rule behavior (such as <code>salience</code> or <code>no-loop</code>), followed by <code>when</code> and <code>then</code> definitions. Each rule must have a unique name within the rule package. The <code>when</code> part of the rule contains the conditions that must be met to execute an action. For example, if a bank requires loan applicants to have over 21 years of age, then the <code>when</code> condition for an <code>"Underage"</code> rule would be <code>Applicant( age &lt; 21 )</code>. The <code>then</code> part of the rule contains the actions to be performed when the conditional part of the rule has been met. For example, when the loan applicant is under 21 years old, the <code>then</code> action would be <code>setApproved( false )</code>, declining the loan because the applicant is under age.</p>
<div class="listingblock">
<div class="title">Rule for loan application age limit</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  salience 15
  when
    $application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>At a minimum, each DRL file must specify the <code>package</code>, <code>import</code>, and <code>rule</code> components. All other components are optional.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The following is an example DRL file in a loan application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL file for a loan application</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mortgages;

import org.mortgages.LoanApplication;
import org.mortgages.Bankruptcy;
import org.mortgages.Applicant;

rule "Bankruptcy history"
	salience 10
	when
		$a : LoanApplication()
		exists (Bankruptcy( yearOfOccurrence &gt; 1990 || amountOwed &gt; 10000 ))
	then
		$a.setApproved( false );
		$a.setExplanation( "has been bankrupt" );
		delete( $a );
end

rule "Underage"
	salience 15
	when
		$application : LoanApplication()
		Applicant( age &lt; 21 )
	then
		$application.setApproved( false );
		$application.setExplanation( "Underage" );
		delete( $application );
end</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/drl-rules-sample.png" alt="Example DRL file with required components">
</div>
<div class="title">Figure 337. Example DRL file for a loan application in Business Central</div>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>After you define all components of the rule, click <strong>Validate</strong> in the upper-right toolbar of the DRL designer to validate the DRL file. If the file validation fails, address any problems described in the error message, review all syntax and components in the DRL file, and try again to validate the file until the file passes.</p>
</li>
<li>
<p>Click <strong>Save</strong> in the DRL designer to save your work.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="drl-rules-WHEN-proc"><a class="anchor" href="#drl-rules-WHEN-proc"></a><a class="link" href="#drl-rules-WHEN-proc">16.8.1.1. Adding WHEN conditions in DRL rules</a></h5>
<div class="paragraph">
<p>The <code>when</code> part of the rule contains the conditions that must be met to execute an action. For example, if a bank requires loan applicants to have over 21 years of age, then the <code>when</code> condition of an <code>"Underage"</code> rule would be <code>Applicant( age &lt; 21 )</code>. Conditions consist of a series of stated patterns and constraints, with optional bindings and other supported DRL elements, based on the available data objects in the package.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The <code>package</code> is defined at the top of the DRL file. This should have been done for you when you created the file.</p>
</li>
<li>
<p>The <code>import</code> list of data objects used in the rule is defined below the <code>package</code> line of the DRL file. Data objects can be from this package or from another package in Business Central.</p>
</li>
<li>
<p>The <code>rule</code> name is defined in the format <code>rule "name"</code> below the <code>package</code>, <code>import</code>, and other lines that apply to the entire DRL file. The same rule name cannot be used more than once in the same package. Optional rule attributes (such as <code>salience</code> or <code>no-loop</code>) that define rule behavior are below the rule name, before the <code>when</code> section.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the DRL designer, enter <code>when</code> within the rule to begin adding condition statements. The <code>when</code> section consists of zero or more fact patterns that define conditions for the rule.</p>
<div class="paragraph">
<p>If the <code>when</code> section is empty, then the conditions are considered to be true and the actions in the <code>then</code> section are executed the first time a <code>fireAllRules()</code> call is made in the Drools engine. This is useful if you want to use rules to set up the Drools engine state.</p>
</div>
<div class="listingblock">
<div class="title">Example rule without conditions</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Always insert applicant"
  when
    // Empty
  then   // Actions to be executed once
    insert( new Applicant() );
end

// The rule is internally rewritten in the following way:

rule "Always insert applicant"
  when
    eval( true )
  then
    insert( new Applicant() );
end</code></pre>
</div>
</div>
</li>
<li>
<p>Enter a pattern for the first condition to be met, with optional constraints, bindings, and other supported DRL elements. A basic pattern format is <code>&lt;patternBinding&gt; : &lt;patternType&gt; ( &lt;constraints&gt; )</code>. Patterns are based on the available data objects in the package and define the conditions to be met in order to trigger actions in the <code>then</code> section.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Simple pattern:</strong> A simple pattern with no constraints matches against a fact of the given type. For example, the following condition is only that the applicant exists.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  Applicant()</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Pattern with constraints:</strong> A pattern with constraints matches against a fact of the given type and the additional restrictions in parentheses that are true or false. For example, the following condition is that the applicant is under the age of 21.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  Applicant( age &lt; 21 )</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Pattern with binding:</strong> A binding on a pattern is a shorthand reference that other components of the rule can use to refer back to the defined pattern. For example, the following binding <code>a</code> on <code>LoanApplication</code> is used in a related action for underage applicants.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  $a : LoanApplication()
  Applicant( age &lt; 21 )
then
  $a.setApproved( false );
  $a.setExplanation( "Underage" )</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Continue defining all condition patterns that apply to this rule. The following are some of the keyword options for defining DRL conditions:</p>
<div class="ulist">
<ul>
<li>
<p><code>and</code>: Use this to group conditional components into a logical conjunction. Infix and prefix <code>and</code> are supported. By default, all listed patterns are combined with <code>and</code> when no conjunction is specified.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// All of the following examples are interpreted the same way:
$a : LoanApplication() and Applicant( age &lt; 21 )

$a : LoanApplication()
and Applicant( age &lt; 21 )

$a : LoanApplication()
Applicant( age &lt; 21 )

(and $a : LoanApplication() Applicant( age &lt; 21 ))</code></pre>
</div>
</div>
</li>
<li>
<p><code>or</code>: Use this to group conditional components into a logical disjunction. Infix and prefix <code>or</code> are supported.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// All of the following examples are interpreted the same way:
Bankruptcy( amountOwed == 100000 ) or IncomeSource( amount == 20000 )

Bankruptcy( amountOwed == 100000 )
or IncomeSource( amount == 20000 )

(or Bankruptcy( amountOwed == 100000 ) IncomeSource( amount == 20000 ))</code></pre>
</div>
</div>
</li>
<li>
<p><code>exists</code>: Use this to specify facts and constraints that must exist. This option is triggered on only the first match, not subsequent matches. If you use this element with multiple patterns, enclose the patterns with parentheses <code>()</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>exists ( Bankruptcy( yearOfOccurrence &gt; 1990 || amountOwed &gt; 10000 ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>not</code>: Use this to specify facts and constraints that must not exist.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>not ( Applicant( age &lt; 21 ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>forall</code>: Use this to verify whether all facts that match the first pattern match all the remaining patterns. When a <code>forall</code> construct is satisfied, the rule evaluates to <code>true</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>forall( $app : Applicant( age &lt; 21 )
              Applicant( this == $app, status = 'underage' ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>from</code>: Use this to specify a data source for a pattern.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Applicant( ApplicantAddress : address )
Address( zipcode == "23920W" ) from ApplicantAddress</code></pre>
</div>
</div>
</li>
<li>
<p><code>entry-point</code>: Use this to define an <code>Entry Point</code> corresponding to a data source for the pattern. Typically used with <code>from</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Applicant() from entry-point "LoanApplication"</code></pre>
</div>
</div>
</li>
<li>
<p><code>collect</code>: Use this to define a collection of objects that the rule can use as part of the condition. In the example, all pending applications in the Drools engine for each given mortgage are grouped in a <code>List</code>. If three or more pending applications are found, the rule is executed.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$m : Mortgage()
$a : List( size &gt;= 3 )
    from collect( LoanApplication( Mortgage == $m, status == 'pending' ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>accumulate</code>: Use this to iterate over a collection of objects, execute custom actions for each of the elements, and return one or more result objects (if the constraints evaluate to <code>true</code>). This option is a more flexible and powerful form of <code>collect</code>. Use the format <code>accumulate( &lt;source pattern&gt;; &lt;functions&gt; [;&lt;constraints&gt;] )</code>. In the example, <code>min</code>, <code>max</code>, and <code>average</code> are accumulate functions that calculate the minimum, maximum, and average temperature values over all the readings for each sensor. Other supported functions include <code>count</code>, <code>sum</code>, <code>variance</code>, <code>standardDeviation</code>, <code>collectList</code>, and <code>collectSet</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$s : Sensor()
accumulate( Reading( sensor == $s, $temp : temperature );
            $min : min( $temp ),
            $max : max( $temp ),
            $avg : average( $temp );
            $min &lt; 20, $avg &gt; 70 )</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about DRL rule conditions, see <a href="#drl-rules-WHEN-con_drl-rules">Rule conditions in DRL (WHEN)</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>After you define all condition components of the rule, click <strong>Validate</strong> in the upper-right toolbar of the DRL designer to validate the DRL file. If the file validation fails, address any problems described in the error message, review all syntax and components in the DRL file, and try again to validate the file until the file passes.</p>
</li>
<li>
<p>Click <strong>Save</strong> in the DRL designer to save your work.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-proc"><a class="anchor" href="#drl-rules-THEN-proc"></a><a class="link" href="#drl-rules-THEN-proc">16.8.1.2. Adding THEN actions in DRL rules</a></h5>
<div class="paragraph">
<p>The <code>then</code> part of the rule contains the actions to be performed when the conditional part of the rule has been met. For example, when a loan applicant is under 21 years old, the <code>then</code> action of an <code>"Underage"</code> rule would be <code>setApproved( false )</code>, declining the loan because the applicant is under age. Actions consist of one or more methods that execute consequences based on the rule conditions and on available data objects in the package. The main purpose of rule actions is to to insert, delete, or modify data in the working memory of the Drools engine.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The <code>package</code> is defined at the top of the DRL file. This should have been done for you when you created the file.</p>
</li>
<li>
<p>The <code>import</code> list of data objects used in the rule is defined below the <code>package</code> line of the DRL file. Data objects can be from this package or from another package in Business Central.</p>
</li>
<li>
<p>The <code>rule</code> name is defined in the format <code>rule "name"</code> below the <code>package</code>, <code>import</code>, and other lines that apply to the entire DRL file. The same rule name cannot be used more than once in the same package. Optional rule attributes (such as <code>salience</code> or <code>no-loop</code>) that define rule behavior are below the rule name, before the <code>when</code> section.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the DRL designer, enter <code>then</code> after the <code>when</code> section of the rule to begin adding action statements.</p>
</li>
<li>
<p>Enter one or more actions to be executed on fact patterns based on the conditions for the rule.</p>
<div class="paragraph">
<p>The following are some of the keyword options for defining DRL actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>set</code>: Use this to set the value of a field.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$application.setApproved ( false );
$application.setExplanation( "has been bankrupt" );</code></pre>
</div>
</div>
</li>
<li>
<p><code>modify</code>: Use this to specify fields to be modified for a fact and to notify the Drools engine of the change. This method provides a structured approach to fact updates. It combines the <code>update</code> operation with setter calls to change object fields.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>modify( LoanApplication ) {
        setAmount( 100 ),
        setApproved ( true )
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>update</code>: Use this to specify fields and the entire related fact to be updated and to notify the Drools engine of the change. After a fact has changed, you must call <code>update</code> before changing another fact that might be affected by the updated values. To avoid this added step, use the <code>modify</code> method instead.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>LoanApplication.setAmount( 100 );
update( LoanApplication );</code></pre>
</div>
</div>
</li>
<li>
<p><code>insert</code>: Use this to insert a <code>new</code> fact into the Drools engine.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insert( new Applicant() );</code></pre>
</div>
</div>
</li>
<li>
<p><code>insertLogical</code>: Use this to insert a <code>new</code> fact logically into the Drools engine. The Drools engine is responsible for logical decisions on insertions and retractions of facts. After regular or stated insertions, facts must be retracted explicitly. After logical insertions, the facts that were inserted are automatically retracted when the conditions in the rules that inserted the facts are no longer true.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insertLogical( new Applicant() );</code></pre>
</div>
</div>
</li>
<li>
<p><code>delete</code>: Use this to remove an object from the Drools engine. The keyword <code>retract</code> is also supported in DRL and executes the same action, but <code>delete</code> is typically preferred in DRL code for consistency with the keyword <code>insert</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>delete( Applicant );</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about DRL rule actions, see <a href="#drl-rules-THEN-con_drl-rules">Rule actions in DRL (THEN)</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>After you define all action components of the rule, click <strong>Validate</strong> in the upper-right toolbar of the DRL designer to validate the DRL file. If the file validation fails, address any problems described in the error message, review all syntax and components in the DRL file, and try again to validate the file until the file passes.</p>
</li>
<li>
<p>Click <strong>Save</strong> in the DRL designer to save your work.</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="rules-attributes-ref_drl-rules"><a class="anchor" href="#rules-attributes-ref_drl-rules"></a><a class="link" href="#rules-attributes-ref_drl-rules">Rule attributes in DRL</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="rule attributes">
</div>
<div class="title">Figure 338. Rule attributes</div>
</div>
<div class="paragraph">
<p>Rule attributes are additional specifications that you can add to business rules to modify rule behavior.
In DRL files, you typically define rule attributes above the rule conditions and actions, with multiple attributes on separate lines, in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "rule_name"
    // Attribute
    // Attribute
    when
        // Conditions
    then
        // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table lists the names and supported values of the attributes that you can assign to rules:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 57. Rule attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer defining the priority of the rule. Rules with a higher salience value are given higher priority when ordered in the activation queue.</p>
<p class="tableblock">Example: <code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. When the option is selected, the rule is enabled. When the option is not selected, the rule is disabled.</p>
<p class="tableblock">Example: <code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code>date-effective</code> attribute.</p>
<p class="tableblock">Example: <code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code>date-expires</code> attribute.</p>
<p class="tableblock">Example: <code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. When the option is selected, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition. When the condition is not selected, the rule can be looped in these circumstances.</p>
<p class="tableblock">Example: <code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an agenda group to which you want to assign the rule. Agenda groups allow you to partition the agenda to provide more execution control over groups of rules. Only rules in an agenda group that has acquired a focus are able to be activated.</p>
<p class="tableblock">Example: <code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an activation (or XOR) group to which you want to assign the rule. In activation groups, only one rule can be activated. The first rule to fire will cancel all pending activations of all rules in the activation group.</p>
<p class="tableblock">Example: <code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.</p>
<p class="tableblock">Example: <code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling the rule.</p>
<p class="tableblock">Example: <code>timer ( cron:* 0/15 * * * ? )</code>  (every 15 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://www.quartz-scheduler.org/">Quartz</a> calendar definition for scheduling the rule.</p>
<p class="tableblock">Example: <code>calendars "* * 0-7,18-23 ? * *"</code>  (exclude non-business hours)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value, applicable only to rules within agenda groups. When the option is selected, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.</p>
<p class="tableblock">Example: <code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value, applicable only to rules within rule flow groups or agenda groups. When the option is selected, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code>no-loop</code> attribute, because the activation of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.</p>
<p class="tableblock">Example: <code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying a rule flow group. In rule flow groups, rules can fire only when the group is activated by the associated rule flow.</p>
<p class="tableblock">Example: <code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying either <code>JAVA</code> or <code>MVEL</code> as the language to be used for code expressions in the rule. By default, the rule uses the dialect specified at the package level. Any dialect specified here overrides the package dialect setting for the rule.</p>
<p class="tableblock">Example: <code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.dsleditor"><a class="anchor" href="#_drools.dsleditor"></a><a class="link" href="#_drools.dsleditor">16.9. DSL (domain specific language) rules</a></h3>
<div class="paragraph">
<p>The DSL editor allows DSL Sentences to be authored.
The reader should take time to explore DSL features in the Drools Expert documentation; as the syntax in Business Central&#8217;s DSL Editor is identical.
The normal syntax is extended to provide "hints" to control how the DSL variable is rendered and validated within the user-interface.</p>
</div>
<div class="paragraph">
<p>The following "hints" are supported:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{&lt;varName&gt;:&lt;regular expression&gt;}</p>
<div class="paragraph">
<p>This will render a text field in place of the DSL variable when the DSL Sentence is used in the guided editor.
The content of the text field will be validated against the regular expression.</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:ENUM:&lt;factType.fieldName&gt;}</p>
<div class="paragraph">
<p>This will render an enumeration in place of the DSL variable when the DSL Sentence is used in the guided editor.
&lt;factType.fieldName&gt; binds the enumeration to the model Fact and Field enumeration definition.
This could be either a "Business Central enumeration" (i.e.
defined within Business Central) or a Java enumeration (i.e.
defined in a model POJO JAR file).</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:DATE:&lt;dateFormat&gt;}</p>
<div class="paragraph">
<p>This will render a Date selector in place of the DSL variable when the DSL Sentence is used in the guided editor.</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:BOOLEAN:&lt;[checked | unchecked]&gt;}</p>
<div class="paragraph">
<p>This will render a dropdown selector in place of the DSL variable, providing boolean choices, when the DSL Sentence is used in the guided editor.</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:CF:&lt;factType.fieldName&gt;}</p>
<div class="paragraph">
<p>This will render a button that will allow you to set the value of this variable using a Custom Form.
In order to use this feature, a  Working-Set containing a Custom Form Configuration for factType.fieldName must be active.
If there is no such Working-Set, a simple text box is used (just like a regular variable).</p>
</div>
<div class="paragraph">
<p>For more information, please read more about Working-Sets and Custom Form Configurations.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/DSLEditor.png" alt="DSLEditor">
</div>
<div class="title">Figure 339. DSL rule</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guidedscorecardeditor"><a class="anchor" href="#_drools.guidedscorecardeditor"></a><a class="link" href="#_drools.guidedscorecardeditor">16.10. Scorecards</a></h3>
<div class="paragraph">
<p>A scorecard is a graphical representation of a formula used to calculate an overall score.
A scorecard can be used to predict the likelihood or probability of a certain outcome.
Drools now supports additive scorecards.
An additive scorecard calculates an overall score by adding all partial scores assigned to individual rule conditions.</p>
</div>
<div class="paragraph">
<p>Additionally, Drools Scorecards will allows for reason codes to be set, which help in identifying the specific rules (buckets) that have contributed to the overall score.
Drools Scorecards will be based on the PMML 4.1 Standard.</p>
</div>
<div class="paragraph">
<p>The New Item menu now allows for creation of scorecard assets.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/scorecard_asset_webeditor.png" alt="scorecard asset webeditor">
</div>
<div class="title">Figure 340. Scorecard asset guided editor</div>
</div>
<div class="paragraph">
<p>The above image shows a scorecard with one characteristic.
Each scorecard consists of two sections (a) Setup Parameters (b) Characteristic Section</p>
</div>
<div class="sect3">
<h4 id="_drools.guidedscorecardeditorsetupparameters"><a class="anchor" href="#_drools.guidedscorecardeditorsetupparameters"></a><a class="link" href="#_drools.guidedscorecardeditorsetupparameters">16.10.1. (a) Setup parameters</a></h4>
<div class="paragraph">
<p>The setup section consists of parameters that define the overall behaviour of this scorecard.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Facts: This dropdown shows a list of facts that are visible for this asset.</p>
</li>
<li>
<p>Resultant Score Field: Shows a list of fields from the selected fact. Only fields of type 'double' are shown. If this dropdown is empty double check your fact model. The final calculated score will be stored in this field.</p>
</li>
<li>
<p>Initial Score: Numeric Text Field to capture the initial score. The generated rules will initialize the 'Resultant Score Field' with this score and then is added to the overall score whenever partial scores are summed up.</p>
</li>
<li>
<p>Use Reason Codes: Boolean indicator to compute reason codes along with the final score. Selecting Yes/No in this field will enable/disable the 'Resultant Reason Codes Field', 'Reason Code Algorithm' and the 'Baseline Score' field.</p>
</li>
<li>
<p>Resultant Reason Codes Field: Shows a list of fields from the selected fact. Only fields of type 'java.util.List' are shown. This collection will hold the reason codes selected by this scorecard.</p>
</li>
<li>
<p>Reason Code Algorithm: May be "none", "pointsAbove" or "pointsBelow", describing how reason codes shall be ranked, relative to the baseline score of each Characteristic, or as set at the top-level scorecard.</p>
</li>
<li>
<p>Baseline Score: A single value to use as the baseline comparison score for all characteristics, when determining reason code ranking. Alternatively, unique baseline scores may be set for each individual Characteristic as shown below. This value is required only when UseReasonCodes is "true" and baselineScore is not given for each Characteristic.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If UseReasonCodes is "true", then BaselineScore must be defined at the Scorecard level or for each Characteristic, and ReasonCode must be provided for each Characteristic or for each of its input Attributes.
If UseReasonCodes is "false", then baselineScore and reasonCode are not required.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedscorecardeditorcharacteristics"><a class="anchor" href="#_drools.guidedscorecardeditorcharacteristics"></a><a class="link" href="#_drools.guidedscorecardeditorcharacteristics">16.10.2. (b) Characteristics</a></h4>
<div class="paragraph">
<p>On Clicking the 'New Characteristic' button, a new empty characteristic editor is added to the scorecard.
Defines the point allocation strategy for each scorecard characteristic (numeric or categorical). Each scorecard characteristic is assigned a single partial score which is used to compute the overall score.
The overall score is simply the sum of all partial scores.
Partial scores are assumed to be continuous values of type "double".</p>
</div>
<div class="sect4">
<h5 id="_drools.guidedscorecardeditorcreatingcharacteristics"><a class="anchor" href="#_drools.guidedscorecardeditorcreatingcharacteristics"></a><a class="link" href="#_drools.guidedscorecardeditorcreatingcharacteristics">16.10.2.1. Creating characteristics</a></h5>
<div class="paragraph">
<p>Every scorecard must have at least one characteristic</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/scorecards_new_characteristic.png" alt="scorecards new characteristic">
</div>
<div class="title">Figure 341. New characteristic</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Name: Descriptive name for this characteristic. For informational reasons only.</p>
</li>
<li>
<p>Remove Characteristic: Will remove this characteristic from the scorecard after a confirmation dialog is shown.</p>
</li>
<li>
<p>Add Attribute: Will add a line entry for an attribute (bin).</p>
</li>
<li>
<p>Fact: Select the class which will be evaluated for calculating the partial score.</p>
</li>
<li>
<p>Characteristic: Shows the list of fields from the selected Fact. Only fields of type "String", "int", "double", "boolean" are shown.</p>
</li>
<li>
<p>Baseline Score: Sets the characteristic&#8217;s baseline score against which to compare the actual partial score when determining the ranking of reason codes. This value is required when useReasonCodes attribute is "true" and baselineScore is not defined in element Scorecard. Whenever baselineScore is defined for a Characteristic, it takes precedence over the baselineScore value defined in element Scorecard.</p>
</li>
<li>
<p>Reason Code: Contains the characteristic&#8217;s reason code, usually associated with an adverse decision.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guidedscorecardeditorcreatingattributes"><a class="anchor" href="#_drools.guidedscorecardeditorcreatingattributes"></a><a class="link" href="#_drools.guidedscorecardeditorcreatingattributes">16.10.2.2. Creating attributes</a></h5>
<div class="paragraph">
<p>On Clicking the 'New Attribute' button, a new empty attribute editor.
In scorecard models, all the elements defining the Attributes for a particular Characteristic must all reference a single field.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/scorecards_new_attribute.png" alt="scorecards new attribute">
</div>
<div class="title">Figure 342. New attribute</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Operator: The condition upon which the mapping between input attribute and partial score takes place. The operator dropdown will show different values depending on the datatype of the selected Field.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>DataType Strings: "=", "in".</p>
</li>
<li>
<p>DataType Integers: "=", "&gt;", "&lt;", "&gt;=", "&#8656;", "&gt;..&lt;", "&gt;=..&lt;", "&gt;=..&#8656;", "&gt;..&#8656;".</p>
</li>
<li>
<p>DataType Boolean: "true", "false".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Refer to the next sub-section (values) for more details.</p>
</div>
</li>
<li>
<p>Value: Basis the operator selected the value specified can either be a single value or a set of values separated by comma (","). The value field is disabled for operator type boolean.</p>
<div class="paragraph">
<p></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 58. Operators / Values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remarks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">will look for an exact match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b,c,&#8230;&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operator 'in' indicates an evaluation to TRUE if the field value is contained in the comma separated list of values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value Field is uneditable (readonly)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value Field is uneditable (readonly)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greator Than Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less Than Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal To</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal To</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;..&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than Value 'a') and (less than value 'b')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=..&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than or equal to Value 'a') and (less than value 'b')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=..&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than or equal to Value 'a') and (less than or equal to value 'b')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;..&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than Value 'a') and (less than or equal to value 'b')</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Partial Score: Defines the score points awarded to the Attribute.</p>
</li>
<li>
<p>Reason Code: Defines the attribute&#8217;s reason code. If the reasonCode attribute is used in this level, it takes precedence over the ReasonCode associated with the Characteristic element.</p>
</li>
<li>
<p>Actions: Delete this attribute. Prompts the user for confirmation.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If Use Reason Codes is "true", then Baseline Score must be defined at the Scorecard level or for each Characteristic, and Reason Code must be provided for each Characteristic or for each of its input Attributes.
If Use Reason Codes is "false", then BaselineScore and ReasonCode are not required.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enumerations-define-proc_drl-rules"><a class="anchor" href="#enumerations-define-proc_drl-rules"></a><a class="link" href="#enumerations-define-proc_drl-rules">16.11. Defining enumerations for drop-down lists in rule assets</a></h3>
<div class="paragraph">
<p>Enumeration definitions in Business Central determine the possible values of fields for conditions or actions in guided rules, guided rule templates, and guided decision tables. An enumeration definition contains a <code>fact.field</code> mapping to a list of supported values that are displayed as a drop-down list in the relevant field of a rule asset. When a user selects a field that is based on the same fact and field as the enumeration definition, the drop-down list of defined values is displayed.</p>
</div>
<div class="paragraph">
<p>You can define enumerations in Business Central or in the DRL source for your Drools project.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Enumeration</strong>.</p>
</li>
<li>
<p>Enter an informative <strong>Enumeration</strong> name and select the appropriate <strong>Package</strong>. The package that you specify must be the same package where the required data objects and relevant rule assets have been assigned or will be assigned.</p>
</li>
<li>
<p>Click <strong>Ok</strong> to create the enumeration.</p>
<div class="paragraph">
<p>The new enumeration is now listed in the <strong>Enumeration Definitions</strong> panel of the <strong>Project Explorer</strong>.</p>
</div>
</li>
<li>
<p>In the <strong>Model</strong> tab of the enumerations designer, click <strong>Add enum</strong> and define the following values for the enumeration:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Fact</strong>: Specify an existing data object within the same package of your project with which you want to associate this enumeration. Open the <strong>Data Objects</strong> panel in the <strong>Project Explorer</strong> to view the available data objects, or create the relevant data object as a new asset if needed.</p>
</li>
<li>
<p><strong>Field</strong>: Specify an existing field identifier that you defined as part of the data object that you selected for the <strong>Fact</strong>. Open the <strong>Data Objects</strong> panel in the <strong>Project Explorer</strong> to select the relevant data object and view the list of available <strong>Identifier</strong> options. You can create the relevant identifier for the data object if needed.</p>
</li>
<li>
<p><strong>Context</strong>: Specify a list of values in the format <code>['string1','string2','string3']</code> or <code>[integer1,integer2,integer3]</code> that you want to map to the <strong>Fact</strong> and <strong>Field</strong> definitions. These values will be displayed as a drop-down list for the relevant field of the rule asset.</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following enumeration defines the drop-down values for applicant credit rating in a loan application decision service:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/EnumConfig.png" alt="EnumConfig">
</div>
<div class="title">Figure 343. Example enumeration for applicant credit rating in Business Central</div>
</div>
<div class="listingblock">
<div class="title">Example enumeration for applicant credit rating in the DRL source</div>
<div class="content">
<pre class="highlightjs highlight"><code>'Applicant.creditRating' : ['AA', 'OK', 'Sub prime']</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, for any guided rule, guided rule template, or guided decision table that is in the same package of the project and that uses the <code>Applicant</code> data object and the <code>creditRating</code> field, the configured values are available as drop-down options:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/EnumDropDown.png" alt="EnumDropDown">
</div>
<div class="title">Figure 344. Example enumeration drop-down options in a guided rule or guided rule template</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/EnumDropDownGDT.png" alt="EnumDropDownGDT">
</div>
<div class="title">Figure 345. Example enumeration drop-down options in a guided decision table</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="enumerations-advanced-ref_drl-rules"><a class="anchor" href="#enumerations-advanced-ref_drl-rules"></a><a class="link" href="#enumerations-advanced-ref_drl-rules">16.11.1. Advanced enumeration options for rule assets</a></h4>
<div class="paragraph">
<p>For advanced use cases with enumeration definitions in your Drools project, consider the following extended options for defining enumerations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Mapping between DRL values and values in Business Central</dt>
<dd>
<p>If you want the enumeration values to appear differently or more completely in the Business Central interface than they appear in the DRL source, use a mapping in the format <code>'fact.field' : ['sourceValue1=UIValue1','sourceValue2=UIValue2', &#8230;&#8203; ]</code> for your enumeration definition values.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, in the following enumeration definition for loan status, the options <code>A</code> or <code>D</code> are used in the DRL file but the options <code>Approved</code> or <code>Declined</code> are displayed in Business Central:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Loan.status' : ['A=Approved','D=Declined']</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Enumeration value dependencies</dt>
<dd>
<p>If you want the selected value in one drop-down list to determine the available options in a subsequent drop-down list, use the format <code>'fact.fieldB[fieldA=value1]' : ['value2', 'value3', &#8230;&#8203; ]</code> for your enumeration definition.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, in the following enumeration definition for insurance policies, the <code>policyType</code> field accepts the values <code>Home</code> or <code>Car</code>. The type of policy that the user selects determines the policy <code>coverage</code> field options that are then available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Insurance.policyType' : ['Home', 'Car']
'Insurance.coverage[policyType=Home]' : ['property', 'liability']
'Insurance.coverage[policyType=Car]' : ['collision', 'fullCoverage']</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Enumeration dependencies are not applied across rule conditions and actions. For example, in this insurance policy use case, the selected policy in the rule condition does not determine the available coverage options in the rule actions, if applicable.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">External data sources in enumerations</dt>
<dd>
<p>If you want to retrieve a list of enumeration values from an external data source instead of defining the values directly in the enumeration definition, on the class path of your project, add a helper class that returns a <code>java.util.List</code> list of strings. In the enumeration definition, instead of specifying a list of values, identify the helper class that you configured to retrieve the values externally.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, in the following enumeration definition for loan applicant region, instead of defining applicant regions explicitly in the format <code>'Applicant.region' : ['country1', 'country2', &#8230;&#8203; ]</code>, the enumeration uses a helper class that returns the list of values defined externally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Applicant.region' : (new com.mycompany.DataHelper()).getListOfRegions()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, a <code>DataHelper</code> class contains a <code>getListOfRegions()</code> method that returns a list of strings. The enumerations are loaded in the drop-down list for the relevant field in the rule asset.</p>
</div>
<div class="paragraph">
<p>You can also load dependent enumeration definitions dynamically from a helper class by identifying the dependent field as usual and enclosing the call to the helper class within quotation marks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Applicant.region[countryCode]' : '(new com.mycompany.DataHelper()).getListOfRegions("@{countryCode}")'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to load all enumeration data entirely from an external data source, such as a relational database, you can implement a Java class that returns a <code>Map&lt;String, List&lt;String&gt;&gt;</code> map. The key of the map is the <code>fact.field</code> mapping and the value is a <code>java.util.List&lt;String&gt;</code> list of values.</p>
</div>
<div class="paragraph">
<p>For example, the following Java class defines loan applicant regions for the related enumeration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SampleDataSource {

  public Map&lt;String, List&lt;String&gt;&gt; loadData() {
    Map data = new HashMap();

    List d = new ArrayList();
    d.add("AU");
    d.add("DE");
    d.add("ES");
    d.add("UK");
    d.add("US");
    ...
    data.put("Applicant.region", d);

    return data;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following enumeration definition correlates to this example Java class. The enumeration contains no references to fact or field names because they are defined in the Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>=(new SampleDataSource()).loadData()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>=</code> operator enables Business Central to load all enumeration data from the helper class. The helper methods are statically evaluated when the enumeration definition is requested for use in an editor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Defining an enumeration without a fact and field definition is currently not supported in Business Central. To define the enumeration for the associated Java class in this way, use the DRL source in your Drools project.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test-scenarios-intro-con"><a class="anchor" href="#test-scenarios-intro-con"></a><a class="link" href="#test-scenarios-intro-con">16.12. Test scenarios</a></h3>
<div class="paragraph">
<p>Test scenarios in Drools enable you to validate the functionality of business rules and business rule data (for rules-based test scenarios) or of DMN models (for DMN-based test scenarios) before deploying them into a production environment. With a test scenario, you use data from your project to set given conditions and expected results based on one or more defined business rules. When you run the scenario, the expected results and actual results of the rule instance are compared. If the expected results match the actual results, the test is successful. If the expected results do not match the actual results, then the test fails.</p>
</div>
<div class="paragraph">
<p>Drools currently supports both the new <strong>Test Scenarios</strong> designer and the former <strong>Test Scenarios (Legacy)</strong> designer. The default designer is the new test scenarios designer, which supports testing of both rules and DMN models and provides an enhanced overall user experience with test scenarios. If required, you can continue to use the legacy test scenarios designer, which supports rule-based test scenarios only.</p>
</div>
<div class="paragraph">
<p>You can run the defined test scenarios in a number of ways, for example, you can run available test scenarios at the project level or inside a specific test scenario asset. Test scenarios are independent and cannot affect or modify other test scenarios. You can run test scenarios at any time during project development in Business Central. You do not have to compile or deploy your decision service to run test scenarios.</p>
</div>
<div class="paragraph">
<p>You can import data objects from different packages to the same project package as the test scenario. Assets in the same package are imported by default. After you create the necessary data objects and the test scenario, you can use the <strong>Data Objects</strong> tab of the test scenarios designer to verify that all required data objects are listed or to import other existing data objects by adding a <strong>New item</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Throughout the test scenarios documentation, all references to <em>test scenarios</em> and the <em>test scenarios designer</em> are for the new version, unless explicitly noted as the legacy version.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="test-designer-con"><a class="anchor" href="#test-designer-con"></a><a class="link" href="#test-designer-con">16.12.1. Test scenarios designer in Business Central</a></h4>
<div class="paragraph">
<p>The test scenarios designer provides a tabular layout that helps you in defining a scenario template and all the associated test cases. The designer layout consists of a table which has a header and the individual rows. The header consists of three parts, the <strong>GIVEN</strong> and <strong>EXPECT</strong> row, a row with instances, and a row with corresponding fields. The header is also known as test scenario template and the individual rows are called test scenarios definitions.</p>
</div>
<div class="paragraph">
<p>The test scenario template or header has the following two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GIVEN</strong> data objects and their fields - represents the input information</p>
</li>
<li>
<p><strong>EXPECT</strong> data objects and their fields - represents the objects and their fields whose exact values are checked based on the given information and which also constitutes the expected result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The test scenarios definitions represent the separate test cases of a template.</p>
</div>
<div class="paragraph">
<p>You can access the <strong>Project Explorer</strong> from the left panel of the designer whereas from the right panel you can access the <strong>Settings</strong>, <strong>Test Tools</strong>, <strong>Scenario Cheatsheet</strong>, <strong>Test Report</strong> and the <strong>Coverage Report</strong> tabs. You can access the <strong>Settings</strong> tab to view and edit the global settings of rule-based and DMN-based test scenarios. You can use the <strong>Test Tools</strong> to configure the data object mappings. <strong>Scenario Cheatsheet</strong> tab contains notes and the cheat sheet which you can use as reference. The <strong>Test Report</strong> tab displays the overview of the tests and the scenario status. To view the test coverage statistics, you can use the <strong>Coverage Report</strong> tab from the right side of the test scenario designer.</p>
</div>
<div class="sect4">
<h5 id="test-designer-data-objects-import-proc"><a class="anchor" href="#test-designer-data-objects-import-proc"></a><a class="link" href="#test-designer-data-objects-import-proc">16.12.1.1. Importing data objects</a></h5>
<div class="paragraph">
<p>The test scenarios designer loads all data objects that are located in the same package as the test scenario. You can view all the data objects from the <strong>Data Objects</strong> tab in the designer. The loaded data objects are also displayed in the <strong>Test Tools</strong> panel.</p>
</div>
<div class="paragraph">
<p>You need to close and reopen the designer in case the data objects change (for example, when a new data object is created or when an existing one is deleted). Select a data object from the list to display its fields and the field types.</p>
</div>
<div class="paragraph">
<p>In case you want to use a data object located in a different package than the test scenario, you need to import the data object first. Follow the procedure below to import a data object for rules-based test scenarios.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot import any data objects while creating DMN-based test scenarios. DMN-based test scenarios do not use any data objects from the project but uses the custom data types defined in the DMN file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Go to <strong>Project Explorer</strong> panel in the test scenarios designer.</p>
</li>
<li>
<p>From <strong>Test Scenario</strong>, select a test scenario.</p>
</li>
<li>
<p>Select <strong>Data Objects</strong> tab and click <strong>New Item</strong>.</p>
</li>
<li>
<p>In the <strong>Add import</strong> window, choose the data object from the drop-down list.</p>
</li>
<li>
<p>Click <strong>Ok</strong> and then <strong>Save</strong>.</p>
</li>
<li>
<p>Close and reopen the test scenarios designer to view the new data object from the data objects list.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-test-scenario-import-proc"><a class="anchor" href="#test-designer-test-scenario-import-proc"></a><a class="link" href="#test-designer-test-scenario-import-proc">16.12.1.2. Importing a test scenario</a></h5>
<div class="paragraph">
<p>You can import an existing test scenario using the <strong>Import Asset</strong> button in the <strong>Asset</strong> tab from the project view.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>From the project&#8217;s <strong>Asset</strong> tab, click <strong>Import Asset</strong>.</p>
</li>
<li>
<p>In the <strong>Create new Import Asset</strong> window,</p>
<div class="ulist">
<ul>
<li>
<p>Enter the name of the import asset.</p>
</li>
<li>
<p>Select the package from the <strong>Package</strong> drop-down list.</p>
</li>
<li>
<p>From <strong>Please select a file to upload</strong>, click <strong>Choose File&#8230;&#8203;</strong> to browse to test scenario file.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select the file and click <strong>Open</strong>.</p>
</li>
<li>
<p>Click <strong>Ok</strong> and the test scenario opens in the test scenario designer.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-save-test-proc"><a class="anchor" href="#test-designer-save-test-proc"></a><a class="link" href="#test-designer-save-test-proc">16.12.1.3. Saving a test scenario</a></h5>
<div class="paragraph">
<p>You can save a test scenario at any time while creating a test scenario template or defining the test scenarios.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the test scenarios designer toolbar on the upper-right, click <strong>Save</strong>.</p>
</li>
<li>
<p>On the <strong>Confirm Save</strong> window,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If you wish to add a comment regarding the test scenario, click <strong>add a comment</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> again.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message stating that the test scenario was saved successfully appears on the screen.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-delete-test-proc"><a class="anchor" href="#test-designer-delete-test-proc"></a><a class="link" href="#test-designer-delete-test-proc">16.12.1.4. Deleting a test scenario</a></h5>
<div class="paragraph">
<p>You can delete existing test scenarios that were created using the test scenarios designer.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the test scenarios designer toolbar on the upper-right, click <strong>Delete</strong>.</p>
</li>
<li>
<p>In the <strong>Confirm Delete</strong> window,</p>
<div class="ulist">
<ul>
<li>
<p>To add a comment regarding the deletion of the test scenario, click <strong>add a comment</strong>.</p>
</li>
<li>
<p>Click <strong>Delete</strong>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message stating that the test scenario was deleted successfully appears on the screen.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-rename-test-proc"><a class="anchor" href="#test-designer-rename-test-proc"></a><a class="link" href="#test-designer-rename-test-proc">16.12.1.5. Renaming a test scenario</a></h5>
<div class="paragraph">
<p>You can rename existing test scenarios by using the <strong>Rename</strong> button from the upper-right toolbar in the designer.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the test scenarios designer toolbar on the upper-right, click <strong>Rename</strong>.</p>
</li>
<li>
<p>In the <strong>Rename Asset</strong> window,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter a name in the <strong>Asset Name</strong> field.</p>
</li>
<li>
<p>If you wish to add a comment, click <strong>add a comment</strong>.</p>
</li>
<li>
<p>Click <strong>Rename</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Clicking on <strong>Rename</strong> simply renames the test scenario file.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the test scenarios designer toolbar on the upper-right, click <strong>Save</strong>.</p>
</li>
<li>
<p>In the <strong>Confirm Save</strong> window,</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>If you wish to add a comment, click <strong>add a comment</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> again.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Alternately, you could click <strong>Save and Rename</strong> to save and rename the scenario at the same time.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message stating that the test scenario was renamed successfully appears on the screen.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-copy-test-proc"><a class="anchor" href="#test-designer-copy-test-proc"></a><a class="link" href="#test-designer-copy-test-proc">16.12.1.6. Copying a test scenario</a></h5>
<div class="paragraph">
<p>You can copy an existing test scenario to the same package or to some other package by using the <strong>Copy</strong> button from the upper-right toolbar.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the test scenarios designer toolbar on the upper-right, click <strong>Copy</strong>.</p>
</li>
<li>
<p>In the <strong>Make a Copy</strong> window,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter a name in the <strong>New Name</strong> field.</p>
</li>
<li>
<p>Select the package you want to copy the test scenario to.</p>
</li>
<li>
<p>Optional: To add a comment, click <strong>add a comment</strong>.</p>
</li>
<li>
<p>Click <strong>Make a Copy</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message stating that the test scenario was copied successfully appears on the screen.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-download-test-proc"><a class="anchor" href="#test-designer-download-test-proc"></a><a class="link" href="#test-designer-download-test-proc">16.12.1.7. Downloading a test scenario</a></h5>
<div class="paragraph">
<p>You can download a copy of the test scenario to your local machine for future reference or as backup.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the test scenarios designer toolbar on the upper-right, click the <strong>Download</strong> icon.</p>
</div>
<div class="paragraph">
<p>The <code>.scesim</code> file is downloaded to your local machine.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-latest-version-test-proc"><a class="anchor" href="#test-designer-latest-version-test-proc"></a><a class="link" href="#test-designer-latest-version-test-proc">16.12.1.8. Switching between versions of a test scenario</a></h5>
<div class="paragraph">
<p>Business Central provides you the ability to switch between the various versions of a test scenario. Every time you save the scenario, a new version of the scenario is listed under <strong>Latest Versions</strong>. To use this feature, you must save the test scenario file at least once.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the test scenarios designer toolbar on the upper-right, click <strong>Latest Version</strong>. All the versions of the file are listed under <strong>Latest Version</strong>, if they exist.</p>
</li>
<li>
<p>Click the version you want to work on.</p>
<div class="paragraph">
<p>The selected version of the test scenario opens in the test scenarios designer.</p>
</div>
</li>
<li>
<p>From the designer toolbar, click <strong>Restore</strong>.</p>
</li>
<li>
<p>In the <strong>Confirm Restore</strong>,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To add a comment, click <strong>add a comment</strong>.</p>
</li>
<li>
<p>Click <strong>Restore</strong> to confirm.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message stating that the selected version has been reloaded successfully in the designer appears on the screen.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-view-hide-alerts-con"><a class="anchor" href="#test-designer-view-hide-alerts-con"></a><a class="link" href="#test-designer-view-hide-alerts-con">16.12.1.9. View or hide the alerts panel</a></h5>
<div class="paragraph">
<p>The <strong>Alerts</strong> panel appears at the bottom of the test scenarios designer or the project view. It contains the build information and error messages in case the executed tests are failed.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>From the designer toolbar on the upper-right, click <strong>Hide Alerts</strong>/<strong>View Alerts</strong> to enable or disable the reporting panel.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-contextual-menu-ref"><a class="anchor" href="#test-designer-contextual-menu-ref"></a><a class="link" href="#test-designer-contextual-menu-ref">16.12.1.10. Contextual menu options</a></h5>
<div class="paragraph">
<p>The test scenarios designer provides contextual menu options, which enables you to perform basic operations on the table such as adding, deleting, and, duplicating rows and columns. To use the contextual menus, you need to right-click a table element. Menu options differ based on the table element you select.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 59. Contextual menu options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Table element</th>
<th class="tableblock halign-left valign-top">Cell label</th>
<th class="tableblock halign-left valign-top">Available context menu options</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"># &amp; Scenario description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert row below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GIVEN &amp; EXPECT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert leftmost column, Insert rightmost column, Insert row below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INSTANCE 1, INSTANCE 2 &amp; PROPERTY 1, PROPERTY 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert column left, Insert column right, Delete column, Duplicate Instance, Insert row below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the cells with row numbers, test scenarios description or test scenarios definition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert row above, Insert row below, Duplicate row, Delete row, Run scenario</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 60. Description of table interactions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Table interaction</th>
<th class="tableblock halign-left valign-middle">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert leftmost column</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a new leftmost column (in either the GIVEN or EXPECT section of the table based on user selection).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert rightmost column</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a new rightmost column (in either the GIVEN or EXPECT section of the table based on user selection).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert column left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a new column to the left of the selected column. The new column is of the same type as the selected column (in either the GIVEN or EXPECT section of the table based on user selection).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert column right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a new column to the right of the selected column. The new column is of the same type as the selected column (in either the GIVEN or EXPECT section of the table based on user selection).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete column</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes the selected column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert row above</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a new row above the selected row.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert row below</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a new row below the selected row. If invoked from a header cell, inserts a new row with index 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate row</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicates the selected row.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate Instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicates the selected instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete row</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes the selected row.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run scenario</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs a single test scenario.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>Insert column right</code> or <code>Insert column left</code> context menu options behave differently,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the selected column does not have a type defined, a new column without a type is added.</p>
</li>
<li>
<p>if the selected column has a type defined, either a new empty column or a column with the parent instance type is created.</p>
<div class="ulist">
<ul>
<li>
<p>if the action is performed from an instance header, a new column without a type is created.</p>
</li>
<li>
<p>if the action is performed from a property header, a new column with the parent instance type is created.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-create-test-scenario-template-con"><a class="anchor" href="#test-designer-create-test-scenario-template-con"></a><a class="link" href="#test-designer-create-test-scenario-template-con">16.12.2. Test scenario template</a></h4>
<div class="paragraph">
<p>Before specifying test scenario definitions, you need to create a test scenario template. The header of the test scenario table defines the template for each scenario. You need to set the types of the instance and property headers for both the GIVEN and EXPECT sections. Instance headers map to a particular data object (a fact), whereas the property headers map to a particular field of the corresponding data object.</p>
</div>
<div class="paragraph">
<p>Using the test scenarios designer, you can create test scenario templates for both rule-based and DMN-based test scenarios.</p>
</div>
<div class="sect4">
<h5 id="test-designer-create-test-template-rule-based-proc"><a class="anchor" href="#test-designer-create-test-template-rule-based-proc"></a><a class="link" href="#test-designer-create-test-template-rule-based-proc">16.12.2.1. Creating a test scenario template for rule-based test scenarios</a></h5>
<div class="paragraph">
<p>Create a test scenario template for rule-based test scenarios by following the procedure below to validate your rules and data.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project for which you want to create the test scenario.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Test Scenario</strong>.</p>
</li>
<li>
<p>Enter a <strong>Test Scenario</strong> name and select the appropriate <strong>Package</strong>. The package you select must contain all the required data objects and rule assets have been assigned or will be assigned.</p>
</li>
<li>
<p>Select <strong>RULE</strong> as the <strong>Source type</strong>.</p>
</li>
<li>
<p>Click <strong>Ok</strong> to create and open the test scenario in the test scenarios designer.</p>
</li>
<li>
<p>To map the <strong>GIVEN</strong> column header to a data object,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click an instance header in the <strong>GIVEN</strong> section.</p>
</li>
<li>
<p>Select the data object from the <strong>Test Tools</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To insert more properties of the data object, right-click the property header and select <strong>Insert column right</strong> or <strong>Insert column left</strong> as required.</p>
</li>
<li>
<p>To map a data object field to a property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click a property cell.</p>
</li>
<li>
<p>Select the data object field from the <strong>Test Tools</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To map the <strong>EXPECT</strong> column header to a data object,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click an instance header in the <strong>EXPECT</strong> section.</p>
</li>
<li>
<p>Select the data object from the <strong>Test Tools</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To insert more properties of the data object, right-click the property header and select <strong>Insert column right</strong> or <strong>Insert column left</strong> as required.</p>
</li>
<li>
<p>To map a data object field to a property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click a property cell.</p>
</li>
<li>
<p>Select the data object field from the <strong>Test Tools</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
<div class="paragraph">
<p>Use the contextual menu to add or remove columns as needed.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-alias-proc"><a class="anchor" href="#test-designer-alias-proc"></a><a class="link" href="#test-designer-alias-proc">16.12.2.2. Using aliases in rule-based test scenarios</a></h5>
<div class="paragraph">
<p>In the test scenarios designer, once you map a header cell with a data object, the data object is removed from the <strong>Test Tools</strong> tab. You can re-map a data object to another header cell by using an alias. Aliases enable you to specify multiple instances of the same data object in a test scenario. You can also create property aliases to rename the used properties directly in the table.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the test scenarios designer in Business Central, double-click a header cell and manually change the name. Ensure that the aliases are uniquely named.</p>
</div>
<div class="paragraph">
<p>The instance now appears in the list of data objects in the <strong>Test Tools</strong> tab.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-test-template-dmn-based-con"><a class="anchor" href="#test-designer-test-template-dmn-based-con"></a><a class="link" href="#test-designer-test-template-dmn-based-con">16.12.3. Test template for DMN-based test scenarios</a></h4>
<div class="paragraph">
<p>Business Central automatically generates the template for every DMN-based test scenario asset and it contains all the specified inputs and decisions of the related DMN model. For each input node in the DMN model, a <strong>GIVEN</strong> column is added, whereas each decision node is represented by an <strong>EXPECT</strong> column. You can modify the default template at any time as per your needs. Also, to test only a specific part of the whole DMN model, its possible to remove the generated columns as well as move decision nodes from the EXPECT to the GIVEN section.</p>
</div>
<div class="sect4">
<h5 id="test-designer-create-test-template-dmn-based-proc"><a class="anchor" href="#test-designer-create-test-template-dmn-based-proc"></a><a class="link" href="#test-designer-create-test-template-dmn-based-proc">16.12.3.1. Creating a test scenario template for DMN-based test scenarios</a></h5>
<div class="paragraph">
<p>Create a test scenario template for DMN-based scenarios by following the procedure below to validate your DMN models.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project that you want to create the test scenario for.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Test Scenario</strong>.</p>
</li>
<li>
<p>Enter a <strong>Test Scenario</strong> name and select the appropriate <strong>Package</strong>.</p>
</li>
<li>
<p>Select <strong>DMN</strong> as the <strong>Source type</strong>.</p>
</li>
<li>
<p>Select an existing DMN asset using the <strong>Choose DMN asset</strong> option.</p>
</li>
<li>
<p>Click <strong>Ok</strong> to create and open the test scenario in the test scenarios designer.</p>
<div class="paragraph">
<p>The template is automatically generated and you can modify it as per your needs.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-test-scenario-definition-proc"><a class="anchor" href="#test-designer-test-scenario-definition-proc"></a><a class="link" href="#test-designer-test-scenario-definition-proc">16.12.4. Defining a test scenario</a></h4>
<div class="paragraph">
<p>After creating a test scenario template you have to define the test scenario next. The rows of the test scenario table define the individual test scenarios. A test scenario has a unique index number, description, set of input values (the <strong>Given</strong> values), and a set of output values (the <strong>Expect</strong> values).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The test scenario template has been created for the selected test scenario.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the test scenario in the test scenarios designer.</p>
</li>
<li>
<p>Enter a description of the test scenario and fill in required values in each cell of the row.</p>
</li>
<li>
<p>Use the contextual menu to add or remove rows as required.</p>
<div class="paragraph">
<p>Double click a cell to start inline editing. To skip a particular cell from test evaluation, leave it empty.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After defining the test scenario, you can run the test next.</p>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-list-map-add-remove-item-proc"><a class="anchor" href="#test-designer-list-map-add-remove-item-proc"></a><a class="link" href="#test-designer-list-map-add-remove-item-proc">16.12.5. Using list and map collections in test scenarios</a></h4>
<div class="paragraph">
<p>The test scenarios designer supports list and map collections for both DMN-based as well as rules-based test scenarios. You can define a collection like a list or a map as the value of a particular cell in both <strong>GIVEN</strong> and <strong>EXPECT</strong> columns.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For map entries, an entry key must be a <code>String</code> data type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the column type first (use a field whose type is a list or a map).</p>
</li>
<li>
<p>Double click a cell in the column to input a value.</p>
</li>
<li>
<p>In the collection editor popup, click <strong>Add new item</strong>.</p>
</li>
<li>
<p>Enter the required value and click the check icon <span class="image"><img src="./dmn/dmn-datatype-constraints-tickmark.png" alt="dmn datatype constraints tickmark"></span> to save each collection item that you add.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
<div class="paragraph">
<p>To delete an item from the collection, click the bin icon in the collection popup editor. Click <strong>Remove</strong> to delete the collection itself.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-expressions-syntax-intro-ref"><a class="anchor" href="#test-designer-expressions-syntax-intro-ref"></a><a class="link" href="#test-designer-expressions-syntax-intro-ref">16.12.6. Expression syntax in test scenarios</a></h4>
<div class="paragraph">
<p>The test scenarios designer supports different expression languages for both rule-based and DMN-based test scenarios. While rule-based test scenarios support a basic expression language, DMN-based test scenarios support the FEEL expression language.</p>
</div>
<div class="sect4">
<h5 id="test-designer-expressions-syntax-rule-based-ref"><a class="anchor" href="#test-designer-expressions-syntax-rule-based-ref"></a><a class="link" href="#test-designer-expressions-syntax-rule-based-ref">16.12.6.1. Expression syntax in rule-based test scenarios</a></h5>
<div class="paragraph">
<p>The following rule-based test scenario definition expressions are supported by the test scenarios designer:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 61. Description of expressions syntax</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies equal to a value. This is default for all columns and is the only operator supported by the GIVEN column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=, =!, &lt;&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies inequality of a value. This operator can be combined with other operators.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;, &gt;, &lt;=, &gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a comparison: less than, greater than, less or equals than, and greater or equals than.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[value1, value2, value3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a list of values. If one or more values are valid, the scenario definition is evaluated as true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expression1; expression2; expression3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a list of expressions. If all expressions are valid, the scenario definition is evaluated as true.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An empty cell is skipped from evaluation. To define an empty string, use <code>=</code>,<code>[]</code>, or <code>;</code>. To define a null value, use <code>null</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 62. Example expressions</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 81.8182%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is equal to -1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is less than 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">! &gt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is not greater than 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-1, 0, 1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is equal to either -1 or 0 or 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;&gt; [1, -1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is neither equal to 1 nor -1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">! 100; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is not equal to 100 but is equal to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!= &lt; 0; &lt;&gt; &gt; 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is neither less than 0 nor greater than 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;&gt; &lt;= 0; &gt;= 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual value is neither less than 0 nor equal to 0 but is greater than or equal to 1.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can refer to the supported commands and syntax in the <strong>Scenario Cheatsheet</strong> tab on the right of the rule-based test scenarios designer.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-expressions-syntax-dmn-based-ref"><a class="anchor" href="#test-designer-expressions-syntax-dmn-based-ref"></a><a class="link" href="#test-designer-expressions-syntax-dmn-based-ref">16.12.6.2. Expression syntax in DMN-based scenarios</a></h5>
<div class="paragraph">
<p>The following data types are supported by the DMN-based test scenarios in the test scenarios designer:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 63. Data types supported by DMN-based scenarios</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supported data types</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numbers &amp; strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings must be delimited by quotation marks, for example, <code>"John Doe"</code>, <code>"Brno"</code> or <code>""</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code>, and <code>null</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dates and time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For example, <code>date("2019-05-13")</code> or <code>time("14:10:00+02:00")</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">functions</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For example, <code>{x : 5, y : 3}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ranges and lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For example, <code>[1 .. 10]</code> or <code>[2, 3, 4, 5]</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can refer to the supported commands and syntax in the <strong>Scenario Cheatsheet</strong> tab on the right of the DMN-based test scenarios designer.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-run-test-proc"><a class="anchor" href="#test-designer-run-test-proc"></a><a class="link" href="#test-designer-run-test-proc">16.12.7. Running the test scenarios</a></h4>
<div class="paragraph">
<p>After creating a test scenario template and defining the test scenarios, you can run the tests to validate your business rules and data.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To run defined test scenarios, do any of the following tasks:</p>
<div class="ulist">
<ul>
<li>
<p>To execute all the available test scenarios in your project inside multiple assets, in the upper-right corner of your project page, click <strong>Test</strong>.</p>
<div class="paragraph">
<div class="title">Run all the test scenarios from the project view</div>
<p><span class="image"><img src="./AuthoringAssets/test-scenarios-run-all-tests-button.png" alt="Run all the test scenarios from the project view"></span></p>
</div>
</li>
<li>
<p>To execute all the available test scenarios defined in a single <code>.scesim</code> file, at the top of the Test Scenario designer, click the <strong>Run Test</strong> <span class="image"><img src="./AuthoringAssets/test-scenarios-run-test-icon.png" alt="Run Test icon"></span> icon.</p>
</li>
<li>
<p>To run a single test scenario defined in a single <code>.scesim</code> file, right-click the row of the test scenario you want to run and select <strong>Run scenario</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <strong>Test Report</strong> panel displays the overview of the tests and the scenario status.</p>
<div class="paragraph">
<p>After the tests execute, if the values entered in the test scenario table do not match with the expected values, then the corresponding cells are highlighted.</p>
</div>
</li>
<li>
<p>If tests fail, you can do the following tasks to troubleshoot the failure:</p>
<div class="ulist">
<ul>
<li>
<p>To review the error message in the pop-up window, hover your mouse cursor over the highlighted cell.</p>
</li>
<li>
<p>To open the <strong>Alerts</strong> panel at the bottom of the designer or the project view for the error messages, click <strong>View Alerts</strong>.</p>
</li>
<li>
<p>Make the necessary changes and run the test again until the scenario passes.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-scenarios-running-locally-proc"><a class="anchor" href="#test-scenarios-running-locally-proc"></a><a class="link" href="#test-scenarios-running-locally-proc">16.12.8. Running a test scenario locally</a></h4>
<div class="paragraph">
<p>In Drools, you can either run the test scenarios directly in Business Central or locally using the command line.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>On the Project&#8217;s home page, select the <strong>Settings</strong> tab.</p>
</li>
<li>
<p>Select <strong>git</strong> <strong>URL</strong> and click the <strong>Clipboard</strong> <span class="image"><img src="./AuthoringAssets/test-scenarios-clipboard-icon.png" alt="Copy to clipboard icon"></span> to copy the git url.</p>
</li>
<li>
<p>Open a command terminal and navigate to the directory where you want to clone the git project.</p>
</li>
<li>
<p>Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>git clone your_git_project_url</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>your_git_project_url</code> with relevant data like <code>git://localhost:9418/MySpace/ProjectTestScenarios</code>.</p>
</div>
</li>
<li>
<p>Once the project is successfully cloned, navigate to the git project directory and execute the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your project&#8217;s build information and the test results (such as, the number of tests run and whether the test run was a success or not) are displayed in the command terminal. In case of failures, make the necessary changes in Business Central, pull the changes and run the command again.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-create-mortgages-example-proc"><a class="anchor" href="#test-designer-create-mortgages-example-proc"></a><a class="link" href="#test-designer-create-mortgages-example-proc">16.12.9. Creating test scenario using the sample Mortgages project</a></h4>
<div class="paragraph">
<p>This chapter illustrates creating and executing a test scenario from the sample <strong>Mortgages</strong> project shipped with Business Central using the test scenarios designer. The test scenario example in this chapter is based on the <strong>Pricing loans</strong> guided decision table from the <strong>Mortgages</strong> project.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click <strong>Mortgages</strong>.</p>
</li>
<li>
<p>If the project is not listed under <strong>Projects</strong>, from <strong>MySpace</strong>, click the three dots (<span class="image"><img src="./cases/dotdotdotbutton.png" alt="dotdotdotbutton"></span>) in the upper-right corner of the page.</p>
</li>
<li>
<p>Click <strong>Try Samples</strong> &#8594; <strong>Mortgages</strong> &#8594; <strong>OK</strong>.</p>
<div class="paragraph">
<p>The Assets window appears.</p>
</div>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Test Scenario</strong>.</p>
</li>
<li>
<p>Enter <code>scenario_pricing_loans</code> as the <strong>Test Scenario</strong> name and select the default <code>mortgages.mortgages</code> package from the <strong>Package</strong> drop-down list.</p>
<div class="paragraph">
<p>The package you select must contain all the required rule assets.</p>
</div>
</li>
<li>
<p>Select <strong>RULE</strong> as the <strong>Source type</strong>.</p>
</li>
<li>
<p>Click <strong>Ok</strong> to create and open the test scenario in the test scenarios designer.</p>
</li>
<li>
<p>Expand <strong>Project Explorer</strong> and verify the following:</p>
<div class="ulist">
<ul>
<li>
<p><code>Applicant</code>, <code>Bankruptcy</code>, <code>IncomeSource</code>, and <code>LoanApplication</code> data objects exist.</p>
</li>
<li>
<p><code>Pricing loans</code> guide decision table exists.</p>
</li>
<li>
<p>Verify that the new test scenario is listed under <strong>Test Scenario</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>After verifying that everything is in place, return to the <strong>Model</strong> tab of the test scenarios designer and define the <strong>GIVEN</strong> and <strong>EXPECT</strong> data for the scenario, based on the available data objects.</p>
<div class="paragraph">
<div class="title">A blank test scenarios designer</div>
<p><span class="image"><img src="./project-data/test-scenarios-preview-editor.png" alt="test scenarios preview editor"></span></p>
</div>
</li>
<li>
<p>Define the <strong>GIVEN</strong> column details,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the cell named <strong>INSTANCE 1</strong> under the <strong>GIVEN</strong> column header.</p>
</li>
<li>
<p>From <strong>Test Tools</strong> panel, select <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To create properties of the data object, right-click the property cell and select <strong>Insert column right</strong> or <strong>Insert column left</strong> as required. For this example, you need to create two more property cells under the <strong>GIVEN</strong> column.</p>
</li>
<li>
<p>Click the first property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select and expand the <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>amount</strong> and then <strong>Add</strong> to map the data object field to the property cell.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click the second property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select and expand the <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>deposit</strong> and then <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click the third property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select and expand the <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>lengthYears</strong> and then <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Right-click <strong>LoanApplication</strong> header cell and select <strong>Insert column right</strong>. A new <strong>GIVEN</strong> column to the right is created.</p>
</li>
<li>
<p>Click the new header cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select the <strong>IncomeSource</strong> data object.</p>
</li>
<li>
<p>Click <strong>Add</strong> to map the data object to the header cell.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click the property cell below <strong>IncomeSource</strong>,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select and expand the <strong>IncomeSource</strong> data object.</p>
</li>
<li>
<p>Click <strong>type</strong> and then <strong>Add</strong> to map the data object field to the property cell.</p>
<div class="paragraph">
<p>You have now defined all the <strong>GIVEN</strong> column cells.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Next, define the <strong>EXPECT</strong> column details,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the cell named <strong>INSTANCE 2</strong> under the <strong>EXPECT</strong> column header.</p>
</li>
<li>
<p>From <strong>Test Tools</strong> panel, select <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To create properties of the data object, right-click the property cell and select <strong>Insert column right</strong> or <strong>Insert column left</strong> as required. Create two more property cells under the <strong>EXPECT</strong> column.</p>
</li>
<li>
<p>Click the first property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select and expand the <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>approved</strong> and then <strong>Add</strong> to map the data object field to the property cell.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click the second property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select and expand the <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>insuranceCost</strong> and then <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click the third property cell,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From <strong>Test Tools</strong> panel, select and expand the <strong>LoanApplication</strong> data object.</p>
</li>
<li>
<p>Click <strong>approvedRate</strong> and then <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Now for defining the test scenario, enter the following data in the first row:</p>
<div class="ulist">
<ul>
<li>
<p>Enter <code>Row 1 test scenario</code> as the <strong>Scenario Description</strong>, <code>150000</code> as the <strong>amount</strong>, <code>19000</code> as the <strong>deposit</strong>, <code>30</code> as the <strong>lengthYears</strong>, and <code>Asset</code> as the <strong>type</strong> for the <strong>GIVEN</strong> column values.</p>
</li>
<li>
<p>Enter <code>true</code> as <strong>approved</strong>, <code>0</code> as the <strong>insuranceCost</strong> and <code>2</code> as the <strong>approvedRate</strong> for the <strong>EXPECT</strong> column values.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Next enter the following data in the second row:</p>
<div class="ulist">
<ul>
<li>
<p>Enter <code>Row 2 test scenario</code> as the <strong>Scenario Description</strong>, <code>100002</code> as the <strong>amount</strong>, <code>2999</code> as the <strong>deposit</strong>, <code>20</code> as the <strong>lengthYears</strong>, and <code>Job</code> as the <strong>type</strong> for the <strong>GIVEN</strong> column values.</p>
</li>
<li>
<p>Enter <code>true</code> as <strong>approved</strong>, <code>10</code> as the <strong>insuranceCost</strong> and <code>6</code> as the <strong>approvedRate</strong> for the <strong>EXPECT</strong> column values.</p>
</li>
</ul>
</div>
</li>
<li>
<p>After you have defined all <strong>GIVEN</strong>, <strong>EXPECT</strong>, and other data for the scenario, click <strong>Save</strong> in the test scenarios designer to save your work.</p>
</li>
<li>
<p>Click <strong>Run Test</strong> in the upper-right corner to run the <code>.scesim</code> file.</p>
<div class="paragraph">
<p>The test result is displayed in the <strong>Test Report</strong> panel. Click <strong>View Alerts</strong> to display messages from the <strong>Alerts</strong> section. If a test fails, refer to the messages in the <strong>Alerts</strong> section at the bottom of the window, review and correct all components in the scenario, and try again to validate the scenario until the scenario passes.</p>
</div>
</li>
<li>
<p>Click <strong>Save</strong> in the test scenarios designer to save your work after you have made all necessary changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-scenarios-legacy-designer-con"><a class="anchor" href="#test-scenarios-legacy-designer-con"></a><a class="link" href="#test-scenarios-legacy-designer-con">16.12.10. Test scenarios (legacy) designer in Business Central</a></h4>
<div class="paragraph">
<p>Drools currently supports both the new <strong>Test Scenarios</strong> designer and the former <strong>Test Scenarios (Legacy)</strong> designer. The default designer is the new test scenarios designer, which supports testing of both rules and DMN models and provides an enhanced overall user experience with test scenarios. If required, you can continue to use the legacy test scenarios designer, which supports rule-based test scenarios only.</p>
</div>
<div class="sect4">
<h5 id="test-scenarios-legacy-create-proc"><a class="anchor" href="#test-scenarios-legacy-create-proc"></a><a class="link" href="#test-scenarios-legacy-create-proc">16.12.10.1. Creating and running a test scenario (legacy)</a></h5>
<div class="paragraph">
<p>You can create test scenarios in Business Central to test the functionality of business rule data before deployment. A basic test scenario must have at least the following data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Related data objects</p>
</li>
<li>
<p><strong>GIVEN</strong> facts</p>
</li>
<li>
<p><strong>EXPECT</strong> results</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this data, the test scenario can validate the expected and actual results for that rule instance based on the defined facts. You can also add a <strong>CALL METHOD</strong> and any available <strong>globals</strong> to a test scenario, but these scenario settings are optional.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Business Central, go to <strong>Menu</strong> &#8594; <strong>Design</strong> &#8594; <strong>Projects</strong> and click the project name.</p>
</li>
<li>
<p>Click <strong>Add Asset</strong> &#8594; <strong>Test Scenarios (Legacy)</strong>.</p>
</li>
<li>
<p>Enter an informative <strong>Test Scenario</strong> name and select the appropriate <strong>Package</strong>. The package that you specify must be the same package where the required rule assets have been assigned or will be assigned. You can import data objects from any package into the asset&#8217;s designer.</p>
</li>
<li>
<p>Click <strong>Ok</strong> to create the test scenario.</p>
<div class="paragraph">
<p>The new test scenario is now listed in the <strong>Test Scenarios</strong> panel of the <strong>Project Explorer</strong>,</p>
</div>
</li>
<li>
<p>Click the <strong>Data Objects</strong> tab to verify that all data objects required for the rules that you want to test are listed. If not, click <strong>New item</strong> to import the needed data objects from other packages, or
within your package.</p>
</li>
<li>
<p>After all data objects are in place, return to the <strong>Model</strong> tab of the test scenarios designer and define the <strong>GIVEN</strong> and <strong>EXPECT</strong> data for the scenario, based on the available data objects.</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-edit.png" alt="test scenario edit">
</div>
<div class="title">Figure 346. The test scenarios designer</div>
</div>
<div class="paragraph">
<p>The <strong>GIVEN</strong> section defines the input facts for the test. For example, if an <code>Underage</code> rule in the project declines loan applications for applicants under the age of 21, then the <strong>GIVEN</strong> facts in the test scenario could be <code>Applicant</code> with <code>age</code> set to some integer less than 21.</p>
</div>
<div class="paragraph">
<p>The <strong>EXPECT</strong> section defines the expected results based on the <strong>GIVEN</strong> input facts. That is, <strong>GIVEN</strong> the input facts, <strong>EXPECT</strong> these other facts to be valid or entire rules to be activated. For example, with the given facts of an applicant under the age of 21 in the scenario, the <strong>EXPECT</strong> results could be <code>LoanApplication</code> with <code>approved</code> set to <code>false</code> (as a result of the underage applicant), or could be the activation of the <code>Underage</code> rule as a whole.</p>
</div>
</li>
<li>
<p>Optionally, add a <strong>CALL METHOD</strong> and any <strong>globals</strong> to the test scenario:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>CALL METHOD:</strong> Use this to invoke a method from another fact when the rule execution is initiated. Click <strong>CALL METHOD</strong>, select a fact, and click <span class="image"><img src="./project-data/6187.png" alt="6187"></span> to select the method to invoke. You can invoke any Java class methods (such as methods from an ArrayList) from the Java library or from a JAR that was imported for the project (if applicable).</p>
</li>
<li>
<p><strong>globals:</strong> Use this to add any global variables in the project that you want to validate in the test scenario. Click <strong>globals</strong> to select the variable to be validated, and then in the test scenarios designer, click the global name and define field values to be applied to the global variable. If no global variables are available, then they must be created as new assets in Business Central. Global variables are named objects that are visible to the Drools engine but are different from the objects for facts. Changes in the object of a global do not trigger the re-evaluation of rules.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong>More</strong> at the bottom of the test scenarios designer to add other data blocks to the same scenario file as needed.</p>
</li>
<li>
<p>After you have defined all <strong>GIVEN</strong>, <strong>EXPECT</strong>, and other data for the scenario, click <strong>Save</strong> in the test scenarios designer to save your work.</p>
</li>
<li>
<p>Click <strong>Run scenario</strong> in the upper-right corner to run this <code>.scenario</code> file, or click <strong>Run all scenarios</strong> to run all saved <code>.scenario</code> files in the project package (if there are multiple). Although the <strong>Run scenario</strong> option does not require the individual <code>.scenario</code> file to be saved, the <strong>Run all scenarios</strong> option does require all <code>.scenario</code> files to be saved.</p>
<div class="paragraph">
<p>If the test fails, address any problems described in the <strong>Alerts</strong> message at the bottom of the window, review all components in the scenario, and try again to validate the scenario until the scenario passes.</p>
</div>
</li>
<li>
<p>Click <strong>Save</strong> in the test scenarios designer to save your work after all changes are complete.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-scenarios-legacy-GIVEN-proc"><a class="anchor" href="#test-scenarios-legacy-GIVEN-proc"></a><a class="link" href="#test-scenarios-legacy-GIVEN-proc">16.12.10.2. Adding GIVEN facts in test scenarios (legacy)</a></h5>
<div class="paragraph">
<p>The <strong>GIVEN</strong> section defines input facts for the test. For example, if an <code>Underage</code> rule in the project declines loan applications for applicants under the age of 21, then the <strong>GIVEN</strong> facts in the test scenario could be <code>Applicant</code> with <code>age</code> set to some integer less than 21.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All data objects required for your test scenario have been created or imported and are listed in the <strong>Data Objects</strong> tab of the <strong>Test Scenarios (Legacy)</strong> designer.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Test Scenarios (Legacy)</strong> designer, click <strong>GIVEN</strong> to open the <strong>New input</strong> window with the available facts.</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-facts.png" alt="Add GIVEN input to the test scenario">
</div>
<div class="title">Figure 347. Add GIVEN input to the test scenario</div>
</div>
<div class="paragraph">
<p>The list includes the following options, depending on the data objects available in the <strong>Data Objects</strong> tab of the test scenarios designer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Insert a new fact:</strong> Use this to add a fact and modify its field values. Enter a variable for the fact as the <strong>Fact name</strong>.</p>
</li>
<li>
<p><strong>Modify an existing fact:</strong> (Appears only after another fact has been added.) Use this to specify a previously inserted fact to be modified in the Drools engine between executions of the scenario.</p>
</li>
<li>
<p><strong>Delete an existing fact:</strong> (Appears only after another fact has been added.) Use this to specify a previously inserted fact to be deleted from the Drools engine between executions of the scenario.</p>
</li>
<li>
<p><strong>Activate rule flow group:</strong> Use this to specify a rule flow group to be activated so that all rules within that group can be tested.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose a fact for the desired input option and click <strong>Add</strong>. For example, set <strong>Insert a new fact:</strong> to <strong>Applicant</strong> and enter <code>a</code> or <code>app</code> or any other variable for the <strong>Fact name</strong>.</p>
</li>
<li>
<p>Click the fact in the test scenarios designer and select the field to be modified.</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-field.png" alt="Modifying a condition">
</div>
<div class="title">Figure 348. Modify a fact field</div>
</div>
</li>
<li>
<p>Click the edit icon (<span class="image"><img src="./project-data/6191.png" alt="6191"></span>) and select from the following field values:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Literal value:</strong> Creates an open field in which you enter a specific literal value.</p>
</li>
<li>
<p><strong>Bound variable:</strong> Sets the value of the field to the fact bound to a selected variable. The field type must match the bound variable type.</p>
</li>
<li>
<p><strong>Create new fact:</strong> Enables you to create a new fact and assign it as a field value of the parent fact. Then you can click the child fact in the test scenarios designer and likewise assign field values or nest other facts similarly.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Continue adding any other <strong>GIVEN</strong> input data for the scenario and click <strong>Save</strong> in the test scenarios designer to save your work.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-scenarios-legacy-EXPECT-proc"><a class="anchor" href="#test-scenarios-legacy-EXPECT-proc"></a><a class="link" href="#test-scenarios-legacy-EXPECT-proc">16.12.10.3. Adding EXPECT results in test scenarios (legacy)</a></h5>
<div class="paragraph">
<p>The <strong>EXPECT</strong> section defines the expected results based on the <strong>GIVEN</strong> input facts. That is, <strong>GIVEN</strong> the input facts, <strong>EXPECT</strong> other specified facts to be valid or entire rules to be activated. For example, with the given facts of an applicant under the age of 21 in the scenario, the <strong>EXPECT</strong> results could be <code>LoanApplication</code> with <code>approved</code> set to <code>false</code> (as a result of the underage applicant), or could be the activation of the <code>Underage</code> rule as a whole.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All data objects required for your test scenario have been created or imported and are listed in the <strong>Data Objects</strong> tab of the <strong>Test Scenarios (Legacy)</strong> designer.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Test Scenarios (Legacy)</strong> designer, click <strong>EXPECT</strong> to open the <strong>New expectation</strong> window with the available facts.</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-expected-rules.png" alt="Add EXPECT results to the test scenario">
</div>
<div class="title">Figure 349. Add EXPECT results to the test scenario</div>
</div>
<div class="paragraph">
<p>The list includes the following options, depending on the data in the <strong>GIVEN</strong> section and the data objects available in the <strong>Data Objects</strong> tab of the test scenarios designer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rule:</strong> Use this to specify a particular rule in the project that is expected to be activated as a result of the <strong>GIVEN</strong> input. Type the name of a rule that is expected to be activated or select it from the list of rules, and then in the test scenarios designer, specify the number of times the rule should be activated.</p>
</li>
<li>
<p><strong>Fact value:</strong> Use this to select a fact and define values for it that are expected to be valid as a result of the facts defined in the <strong>GIVEN</strong> section. The facts are listed by the <strong>Fact name</strong> previously defined for the <strong>GIVEN</strong> input.</p>
</li>
<li>
<p><strong>Any fact that matches:</strong> Use this to validate that at least one fact with the specified values exists as a result of the <strong>GIVEN</strong> input.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose a fact for the desired expectation (such as <strong>Fact value:</strong> <code>application</code>) and click <strong>Add</strong> or <strong>OK</strong>.</p>
</li>
<li>
<p>Click the fact in the test scenarios designer and select the field to be added and modified.</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-field-value.png" alt="Modify a fact field">
</div>
<div class="title">Figure 350. Modify a fact field</div>
</div>
</li>
<li>
<p>Set the field values to what is expected to be valid as a result of the <strong>GIVEN</strong> input (such as <code>approved</code> | <code>equals</code> | <code>false</code>).</p>
</li>
<li>
<p>Continue adding any other <strong>EXPECT</strong> input data for the scenario and click <strong>Save</strong> in the test scenarios designer to save your work.</p>
</li>
<li>
<p>After you have defined and saved all <strong>GIVEN</strong>, <strong>EXPECT</strong>, and other data for the scenario, click <strong>Run scenario</strong> in the upper-right corner to run this <code>.scenario</code> file, or click <strong>Run all scenarios</strong> to run all saved <code>.scenario</code> files in the project package (if there are multiple). Although the <strong>Run scenario</strong> option does not require the individual <code>.scenario</code> file to be saved, the <strong>Run all scenarios</strong> option does require all <code>.scenario</code> files to be saved.</p>
<div class="paragraph">
<p>If the test fails, address any problems described in the <strong>Alerts</strong> message at the bottom of the window, review all components in the scenario, and try again to validate the scenario until the scenario passes.</p>
</div>
</li>
<li>
<p>Click <strong>Save</strong> in the test scenarios designer to save your work after all changes are complete.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wb.workbenchintegration"><a class="anchor" href="#_wb.workbenchintegration"></a><a class="link" href="#_wb.workbenchintegration">17. Business Central integration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="knowledge-store-rest-api-con_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-con_drl-rules"></a><a class="link" href="#knowledge-store-rest-api-con_drl-rules">17.1. Knowledge Store REST API for Business Central spaces and projects</a></h3>
<div class="paragraph">
<p>Drools provides a Knowledge Store REST API that you can use to interact with your projects and spaces in Drools without using the Business Central user interface. The Knowledge Store is the artifact repository for assets in Drools. This API support enables you to facilitate and automate maintenance of Business Central projects and spaces.</p>
</div>
<div class="paragraph">
<p>With the Knowledge Store REST API, you can perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve information about all projects and spaces</p>
</li>
<li>
<p>Create, update, or delete projects and spaces</p>
</li>
<li>
<p>Build, deploy, and test projects</p>
</li>
<li>
<p>Retrieve information about previous Knowledge Store REST API requests, or <em>jobs</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Knowledge Store REST API requests require the following components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Authentication</dt>
<dd>
<p>The Knowledge Store REST API requires HTTP Basic authentication or token-based authentication for the user role <code>rest-all</code>. To view configured user roles for your Drools distribution, navigate to <code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code> and <code>~/application-users.properties</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To add a user with the <code>rest-all</code> role, navigate to <code>~/$SERVER_HOME/bin</code> and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role rest-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about user roles and Drools installation options, see
<a href="#_installing_the_kie_server">Installing the KIE Server</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">HTTP headers</dt>
<dd>
<p>The Knowledge Store REST API requires the following HTTP headers for API requests:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: Data format accepted by your requesting client:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> (JSON)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Content-Type</code>: Data format of your <code>POST</code> or <code>PUT</code> API request data:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> (JSON)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP methods</dt>
<dd>
<p>The Knowledge Store REST API supports the following HTTP methods for API requests:</p>
<div class="ulist">
<ul>
<li>
<p><code>GET</code>: Retrieves specified information from a specified resource endpoint</p>
</li>
<li>
<p><code>POST</code>: Creates or updates a resource</p>
</li>
<li>
<p><code>DELETE</code>: Deletes a resource</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Base URL</dt>
<dd>
<p>The base URL for Knowledge Store REST API requests is <code>http://SERVER:PORT/business-central/rest/</code>, such as  <code>http://localhost:8080/business-central/rest/</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The REST API base URL for the Knowledge Store and for the Drools controller built in to Business Central are the same because both are considered part of Business Central REST services.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Endpoints</dt>
<dd>
<p>Knowledge Store REST API endpoints, such as <code>/spaces/{spaceName}</code> for a specified space, are the URIs that you append to the Knowledge Store REST API base URL to access the corresponding resource or type of resource in Drools.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">Example request URL for <code>/spaces/{spaceName}</code> endpoint</div>
<p><code>http://localhost:8080/business-central/rest/spaces/MySpace</code></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Request data</dt>
<dd>
<p>HTTP <code>POST</code> requests in the Knowledge Store REST API may require a JSON request body with data to accompany the request.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">Example POST request URL and JSON request body data</div>
<p><code>http://localhost:8080/business-central/rest/spaces/MySpace/projects</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="knowledge-store-rest-api-requests-proc_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-requests-proc_drl-rules"></a><a class="link" href="#knowledge-store-rest-api-requests-proc_drl-rules">17.1.1. Sending requests with the Knowledge Store REST API using a REST client or curl utility</a></h4>
<div class="paragraph">
<p>The Knowledge Store REST API enables you to interact with your projects and spaces in Drools without using the Business Central user interface. You can send Knowledge Store REST API requests using any REST client or curl utility.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Business Central is installed and running.</p>
</li>
<li>
<p>You have <code>rest-all</code> user role access to Business Central.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the relevant <a href="#knowledge-store-rest-api-endpoints-ref_kie-apis">API endpoint</a> to which you want to send a request, such as <code>[GET] /spaces</code> to retrieve spaces in Business Central.</p>
</li>
<li>
<p>In a REST client or curl utility, enter the following components for a <code>GET</code> request to <code>/spaces</code>. Adjust any request details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For REST client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Enter the user name and password of the Business Central user with the <code>rest-all</code> role.</p>
</li>
<li>
<p><strong>HTTP Headers</strong>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP method</strong>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Knowledge Store REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/spaces</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For curl utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code>: Enter the user name and password of the Business Central user with the <code>rest-all</code> role.</p>
</li>
<li>
<p><code>-H</code>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Knowledge Store REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/spaces</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/business-central/rest/spaces"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the request and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "MySpace",
    "description": null,
    "projects": [
      {
        "name": "Employee_Rostering",
        "spaceName": "MySpace",
        "groupId": "employeerostering",
        "version": "1.0.0-SNAPSHOT",
        "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
          }
        ]
      },
      {
        "name": "Mortgage_Process",
        "spaceName": "MySpace",
        "groupId": "mortgage-process",
        "version": "1.0.0-SNAPSHOT",
        "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  },
  {
    "name": "MySpace2",
    "description": null,
    "projects": [
      {
        "name": "IT_Orders",
        "spaceName": "MySpace",
        "groupId": "itorders",
        "version": "1.0.0-SNAPSHOT",
        "description": "Case Management IT Orders project",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-IT_Orders-1"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-IT_Orders-1"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In your REST client or curl utility, send another API request with the following components for a <code>POST</code> request to <code>/spaces/{spaceName}/projects</code> to create a project within a space. Adjust any request details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For REST client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Enter the user name and password of the Business Central user with the <code>rest-all</code> role.</p>
</li>
<li>
<p><strong>HTTP Headers</strong>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: <code>application/json</code></p>
</li>
<li>
<p><code>Content-Type</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP method</strong>: Set to <code>POST</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Knowledge Store REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/spaces/MySpace/projects</code>.</p>
</li>
<li>
<p><strong>Request body</strong>: Add a JSON request body with the identification data for the new project:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For curl utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code>: Enter the user name and password of the Business Central user with the <code>rest-all</code> role.</p>
</li>
<li>
<p><code>-H</code>: Set the following headers:</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code>: <code>application/json</code></p>
</li>
<li>
<p><code>content-type</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code>: Set to <code>POST</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Knowledge Store REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/spaces/MySpace/projects</code>.</p>
</li>
<li>
<p><code>-d</code>: Add a JSON request body or file (<code>@file.json</code>) with the identification data for the new project:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X POST "http://localhost:8080/business-central/rest/spaces/MySpace/projects" -d "{ \"name\": \"Employee_Rostering\", \"groupId\": \"employeerostering\", \"version\": \"1.0.0-SNAPSHOT\", \"description\": \"Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.\"}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X POST "http://localhost:8080/business-central/rest/spaces/MySpace/projects" -d @my-project.json</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the request and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541017411591-6",
  "status": "APPROVED",
  "spaceName": "MySpace",
  "projectName": "Employee_Rostering",
  "projectGroupId": "employeerostering",
  "projectVersion": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you encounter request errors, review the returned error code messages and adjust your request accordingly.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="knowledge-store-rest-api-endpoints-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-endpoints-ref_drl-rules"></a><a class="link" href="#knowledge-store-rest-api-endpoints-ref_drl-rules">17.1.2. Supported Knowledge Store REST API endpoints</a></h4>
<div class="paragraph">
<p>The Knowledge Store REST API provides endpoints for managing spaces and projects in Drools and for retrieving information about previous Knowledge Store REST API requests, or <em>jobs</em>.</p>
</div>
<div class="sect4">
<h5 id="knowledge-store-rest-api-spaces-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-spaces-ref_drl-rules"></a><a class="link" href="#knowledge-store-rest-api-spaces-ref_drl-rules">17.1.2.1. Spaces</a></h5>
<div class="paragraph">
<p>The Knowledge Store REST API supports the following endpoints for managing spaces in Business Central. The Knowledge Store REST API base URL is <code>http://SERVER:PORT/business-central/rest/</code>. All requests require HTTP Basic authentication or token-based authentication for the <code>rest-all</code> user role.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] /spaces</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns all spaces in Business Central.</p>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "MySpace",
    "description": null,
    "projects": [
      {
        "name": "Employee_Rostering",
        "spaceName": "MySpace",
        "groupId": "employeerostering",
        "version": "1.0.0-SNAPSHOT",
        "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
          }
        ]
      },
      {
        "name": "Mortgage_Process",
        "spaceName": "MySpace",
        "groupId": "mortgage-process",
        "version": "1.0.0-SNAPSHOT",
        "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  },
  {
    "name": "MySpace2",
    "description": null,
    "projects": [
      {
        "name": "IT_Orders",
        "spaceName": "MySpace",
        "groupId": "itorders",
        "version": "1.0.0-SNAPSHOT",
        "description": "Case Management IT Orders project",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-IT_Orders-1"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-IT_Orders-1"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] /spaces/{spaceName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns information about a specified space.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 64. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space to be retrieved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "MySpace",
  "description": null,
  "projects": [
    {
      "name": "Mortgage_Process",
      "spaceName": "MySpace",
      "groupId": "mortgage-process",
      "version": "1.0.0-SNAPSHOT",
      "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
        }
      ]
    },
    {
      "name": "Employee_Rostering",
      "spaceName": "MySpace",
      "groupId": "employeerostering",
      "version": "1.0.0-SNAPSHOT",
      "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
        }
      ]
    },
    {
      "name": "Evaluation_Process",
      "spaceName": "MySpace",
      "groupId": "evaluation",
      "version": "1.0.0-SNAPSHOT",
      "description": "Getting started Business Process for evaluating employees",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-Evaluation_Process"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-Evaluation_Process"
        }
      ]
    },
    {
      "name": "IT_Orders",
      "spaceName": "MySpace",
      "groupId": "itorders",
      "version": "1.0.0-SNAPSHOT",
      "description": "Case Management IT Orders project",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-IT_Orders"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-IT_Orders"
        }
      ]
    }
  ],
  "owner": "admin",
  "defaultGroupId": "com.myspace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /spaces</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Creates a space in Business Central.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 65. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>body</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>name</code>, <code>description</code>, <code>owner</code>, <code>defaultGroupId</code>, and any other components of the new space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "NewSpace",
  "description": "My new space.",
  "owner": "admin",
  "defaultGroupId": "com.newspace"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541016978154-3",
  "status": "APPROVED",
  "spaceName": "NewSpace",
  "owner": "admin",
  "defaultGroupId": "com.newspace",
  "description": "My new space."
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[DELETE] /spaces/{spaceName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deletes a specified space from Business Central.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 66. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space to be deleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541127032997-8",
  "status": "APPROVED",
  "spaceName": "MySpace",
  "owner": "admin",
  "description": "My deleted space.",
  "repositories": null
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="knowledge-store-rest-api-projects-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-projects-ref_drl-rules"></a><a class="link" href="#knowledge-store-rest-api-projects-ref_drl-rules">17.1.2.2. Projects</a></h5>
<div class="paragraph">
<p>The Knowledge Store REST API supports the following endpoints for managing, building, and deploying projects in Business Central. The Knowledge Store REST API base URL is <code>http://SERVER:PORT/business-central/rest/</code>. All requests require HTTP Basic authentication or token-based authentication for the <code>rest-all</code> user role.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] /spaces/{spaceName}/projects</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns projects in a specified space.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 67. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space for which you are retrieving projects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "Mortgage_Process",
    "spaceName": "MySpace",
    "groupId": "mortgage-process",
    "version": "1.0.0-SNAPSHOT",
    "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
      }
    ]
  },
  {
    "name": "Employee_Rostering",
    "spaceName": "MySpace",
    "groupId": "employeerostering",
    "version": "1.0.0-SNAPSHOT",
    "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
      }
    ]
  },
  {
    "name": "Evaluation_Process",
    "spaceName": "MySpace",
    "groupId": "evaluation",
    "version": "1.0.0-SNAPSHOT",
    "description": "Getting started Business Process for evaluating employees",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-Evaluation_Process"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-Evaluation_Process"
      }
    ]
  },
  {
    "name": "IT_Orders",
    "spaceName": "MySpace",
    "groupId": "itorders",
    "version": "1.0.0-SNAPSHOT",
    "description": "Case Management IT Orders project",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-IT_Orders"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-IT_Orders"
      }
    ]
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] /spaces/{spaceName}/projects/{projectName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns information about a specified project in a specified space.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 68. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space where the project is located</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the project to be retrieved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "spaceName": "MySpace",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
  "publicURIs": [
    {
      "protocol": "git",
      "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
    },
    {
      "protocol": "ssh",
      "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /spaces/{spaceName}/projects</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Creates a project in a specified space.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 69. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space in which the new project will be created</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>body</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>name</code>, <code>groupId</code>, <code>version</code>, <code>description</code>, and any other components of the new project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541017411591-6",
  "status": "APPROVED",
  "spaceName": "MySpace",
  "projectName": "Employee_Rostering",
  "projectGroupId": "employeerostering",
  "projectVersion": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[DELETE] /spaces/{spaceName}/projects/{projectName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deletes a specified project from a specified space.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 70. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space where the project is located</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the project to be deleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541128617727-10",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /spaces/{spaceName}/git/clone</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Clones a project into a specified space from a specified Git address.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 71. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space to which you are cloning a project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>body</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>name</code>, <code>description</code>, and Git repository <code>userName</code>, <code>password</code>, and <code>gitURL</code> for the project to be cloned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
  "userName": "baAdmin",
  "password": "password@1",
  "gitURL": "git://localhost:9418/MySpace/example-Employee_Rostering"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541129488547-13",
  "status": "APPROVED",
  "cloneProjectRequest": {
    "name": "Employee_Rostering",
    "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
    "userName": "baAdmin",
    "password": "password@1",
    "gitURL": "git://localhost:9418/MySpace/example-Employee_Rostering"
  },
  "spaceName": "MySpace2"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /spaces/{spaceName}/projects/{projectName}/maven/compile</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Compiles a specified project in a specified space (equivalent to <code>mvn compile</code>).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 72. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space where the project is located</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the project to be compiled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541128617727-10",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /spaces/{spaceName}/projects/{projectName}/maven/test</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Tests a specified project in a specified space (equivalent to <code>mvn test</code>).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 73. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space where the project is located</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the project to be tested</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541132591595-19",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /spaces/{spaceName}/projects/{projectName}/maven/install</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Installs a specified project in a specified space (equivalent to <code>mvn install</code>).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 74. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space where the project is located</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the project to be installed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541132668987-20",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /spaces/{spaceName}/projects/{projectName}/maven/deploy</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deploys a specified project in a specified space (equivalent to <code>mvn deploy</code>).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 75. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the space where the project is located</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the project to be deployed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541132816435-21",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="knowledge-store-rest-api-jobs-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-jobs-ref_drl-rules"></a><a class="link" href="#knowledge-store-rest-api-jobs-ref_drl-rules">17.1.2.3. Jobs (API requests)</a></h5>
<div class="paragraph">
<p>All <code>POST</code> and <code>DELETE</code> requests in the Knowledge Store REST API return a job ID associated with each request, in addition to the returned request details. You can use a job ID to view the request status or delete a sent request.</p>
</div>
<div class="paragraph">
<p>Knowledge Store REST API requests, or <em>jobs</em>, can have the following statuses:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 76. Job statuses (API request statuses)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACCEPTED</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The request was accepted and is being processed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BAD_REQUEST</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The request contained incorrect content and was not accepted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RESOURCE_NOT_EXIST</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The requested resource (path) does not exist.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DUPLICATE_RESOURCE</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The resource already exists.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SERVER_ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An error occurred in KIE Server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUCCESS</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The request finished successfully.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FAIL</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The request failed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>APPROVED</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The request was approved.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DENIED</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The request was denied.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GONE</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The job ID for the request could not be found due to one of the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The request was explicitly removed.</p>
</li>
<li>
<p>The request finished and has been deleted from a status cache. A request is removed from a status cache after the cache has reached its maximum capacity.</p>
</li>
<li>
<p>The request never existed.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Knowledge Store REST API supports the following endpoints for retrieving or deleting sent API requests. The Knowledge Store REST API base URL is <code>http://SERVER:PORT/business-central/rest/</code>. All requests require HTTP Basic authentication or token-based authentication for the <code>rest-all</code> user role.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] /jobs/{jobId}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns the status of a specified job (a previously sent API request).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 77. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jobId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the job to be retrieved (example: <code>1541010216919-1</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "SUCCESS",
  "jobId": "1541010216919-1",
  "result": null,
  "lastModified": 1541010218352,
  "detailedResult": [
    "level:INFO, path:null, text:Build of module 'Mortgage_Process' (requested by system) completed.\n Build: SUCCESSFUL"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[DELETE] /jobs/{jobId}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deletes a specified job (a previously sent API request). If the job is not being processed yet, this request removes the job from the job queue. This request does not cancel or stop an ongoing job.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 78. Request parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jobId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the job to be deleted (example: <code>1541010216919-1</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "GONE",
  "jobId": "1541010216919-1",
  "result": null,
  "lastModified": 1541132054916,
  "detailedResult": [
    "level:INFO, path:null, text:Build of module 'Mortgage_Process' (requested by system) completed.\n Build: SUCCESSFUL"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_drools_controller_calls"><a class="anchor" href="#_embedded_drools_controller_calls"></a><a class="link" href="#_embedded_drools_controller_calls">17.2. Embedded Drools controller calls</a></h3>
<div class="paragraph">
<p>When running Business Central with the embedded Drools controller mode, a series of endpoints related to managing all aspects of KIE Server templates, instances, and containers are also available. For more details, see <a href="#controller-rest-api-con_kie-apis">Drools controller REST API</a>.
A <a href="#controller-java-api-con_kie-apis">Java client API</a> is also available for interacting with these endpoints.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kie.keycloakssointegration"><a class="anchor" href="#_kie.keycloakssointegration"></a><a class="link" href="#_kie.keycloakssointegration">17.3. Keycloak SSO integration</a></h3>
<div class="paragraph">
<p>Single Sign On (SSO) and related token exchange mechanisms are becoming the most common scenario for the authentication and authorization in different environments on the web, specially when moving into the cloud.</p>
</div>
<div class="paragraph">
<p>This section talks about the integration of Keycloak with jBPM or Drools applications in order to use all the features provided on Keycloak.
Keycloak is an integrated SSO and IDM for browser applications and RESTful web services.
Lean more about it in the <a href="http://keycloak.jboss.org/">Keycloak&#8217;s home page</a>.</p>
</div>
<div class="paragraph">
<p>The result of the integration with Keycloak has lots of advantages such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide an integrated SSO and IDM environment for different clients, including Business Central</p>
</li>
<li>
<p>Social logins - use your Facebook, Google, LinkedIn, etc accounts</p>
</li>
<li>
<p>User session management</p>
</li>
<li>
<p>And much more&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next sections cover the following integration points with Keycloak:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Business Central authentication through a Keycloak server</strong></p>
<div class="paragraph">
<p>It basically consists of securing both web client and remote service clients through the Keycloak SSO.
So either web interface or remote service consumers (whether a user or a service) will authenticate into trough KC.</p>
</div>
</li>
<li>
<p><strong>Execution server authentication through a Keycloak server</strong></p>
<div class="paragraph">
<p>Consists of securing the remote services provided by the execution server (as it does not provide web interface). Any remote service consumer (whether a user or a service) will authenticate trough KC.</p>
</div>
</li>
<li>
<p><strong>Consuming remote services</strong></p>
<div class="paragraph">
<p>This section describes how a third party clients can consume the remote service endpoints provided by both Business Central and Execution Server, such as the REST API or remote file system services.</p>
</div>
</li>
<li>
<p><strong>Keycloak and Business Central&#8217;s security administration area</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_scenario"><a class="anchor" href="#_scenario"></a><a class="link" href="#_scenario">17.3.1. Scenario</a></h4>
<div class="paragraph">
<p>Consider the following diagram as the environment for this document&#8217;s example:</p>
</div>
<div class="paragraph">
<p>Keycloak is a standalone process that provides remote authentication, authorization and administration services that can be potentially consumed by one or more jBPM applications over the network.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/KeyCloak_sso_scenario.png" alt="KeyCloak sso scenario">
</div>
</div>
<div class="paragraph">
<p>Consider these main steps for building this environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install and set up a Keycloak server</p>
</li>
<li>
<p>Create and set up a Realm for this example - Configure realm&#8217;s clients, users and roles</p>
</li>
<li>
<p>Install and set up the SSO client adapter &amp; jBPM application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: The resulting environment and the different configurations for this document are based on Business Central.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_and_set_up_a_keycloak_server"><a class="anchor" href="#_install_and_set_up_a_keycloak_server"></a><a class="link" href="#_install_and_set_up_a_keycloak_server">17.3.2. Install and set up a Keycloak server</a></h4>
<div class="paragraph">
<p>Keycloak provides an extensive documentation and several articles about the installation on different environments.
This section describes the minimal set up for being able to build the integrated environment for the example.
Please refer to the <a href="http://www.keycloak.org/documentation.html">Keycloak documentation</a> if you need more information.</p>
</div>
<div class="paragraph">
<p>Here are the steps for a minimal Keycloak installation and set up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download latest version of Keycloak from the <a href="http://www.keycloak.org/downloads.html">Downloads</a> section. This example is based on Keycloak 1.9.0.Final</p>
</li>
<li>
<p>Unzip the downloaded distribution of Keycloak into a folder, let&#8217;s refer it as</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$KC_HOME</code></pre>
</div>
</div>
</li>
<li>
<p>Run the KC server - This example is based on running both Keycloak and jBPM on same host. In order to avoid port conflicts you can use a port offset for the Keycloak&#8217;s server as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$KC_HOME/bin/standalone.sh -Djboss.socket.binding.port-offset=100</code></pre>
</div>
</div>
</li>
<li>
<p>Create a Keycloak&#8217;s administration 'admin' user by navigating to <a href="http://localhost:8180/auth/" class="bare">http://localhost:8180/auth/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Keycloak administration console will be available at <a href="http://localhost:8180/auth/admin/" class="bare">http://localhost:8180/auth/admin/</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_and_set_up_the_demo_realm"><a class="anchor" href="#_create_and_set_up_the_demo_realm"></a><a class="link" href="#_create_and_set_up_the_demo_realm">17.3.3. Create and set up the demo realm</a></h4>
<div class="paragraph">
<p>Security realms are used to restrict the access for the different application&#8217;s resources.</p>
</div>
<div class="paragraph">
<p>Once the Keycloak server is running next step is about creating a realm.
This realm will provide the different users, roles, sessions, etc for the jBPM application/s.</p>
</div>
<div class="paragraph">
<p>Keycloak provides several examples for the realm creation and management, from the <a href="https://github.com/keycloak/keycloak/tree/master/examples">official
        examples</a> to different articles with more examples.</p>
</div>
<div class="paragraph">
<p>Follow these steps in order to create the <em>demo</em> realm used later in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the Keycloak <a href="http://localhost:8180/auth/admin">administration console</a> and click <em>Add realm</em> button. Give it the name <em>demo</em>.</p>
</li>
<li>
<p>Go to the Clients section (from the main admin console menu) and create a new client for the <em>demo</em> realm:</p>
<div class="ulist">
<ul>
<li>
<p>Client ID:  <em>kie</em></p>
</li>
<li>
<p>Client protocol: <em>openid-connect</em></p>
</li>
<li>
<p>Acces type: <em>confidential</em></p>
</li>
<li>
<p>Root URL: <em><a href="http://localhost:8080" class="bare">http://localhost:8080</a></em></p>
</li>
<li>
<p>Base URL:  <em>/business-central-x.y.z.Final</em></p>
</li>
<li>
<p>Redirect URIs: <em>/business-central-x.y.z.Final/*</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The resulting <em>kie</em> client settings screen:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/kie_client_settings.png" alt="kie client settings">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As you can see in the above settings it&#8217;s being considered the value <em>business-central-x.y.z.Final</em> for the application&#8217;s context path.
If your jBPM application will be deployed on a different context path, host or port, just use your concrete settings here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Last step for being able to use the <em>demo</em> realm from Business Central is create the application&#8217;s user and roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the Roles section and create the roles <em>admin</em>, <em>kiemgmt</em> and <em>rest-all</em></p>
</li>
<li>
<p>Go to the Users section and create the <em>admin</em> user. Set the password with value <em>password</em> in the credentials tab, unset the temporary switch.</p>
</li>
<li>
<p>In  the Users section navigate to the <em>Role Mappings</em> tab and assign the <em>admin</em>, <em>kiemgmt</em> and <em>rest-all</em> roles to the <em>admin</em> user</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/admin_user_roles.png" alt="admin user roles">
</div>
</div>
<div class="paragraph">
<p>At this point a Keycloak server is running on the host, set up with a minimal configuration set.
Let&#8217;s move to Business Central set up.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_and_set_up_business_central"><a class="anchor" href="#_install_and_set_up_business_central"></a><a class="link" href="#_install_and_set_up_business_central">17.3.4. Install and set up Business Central</a></h4>
<div class="paragraph">
<p>For this tutorial let&#8217;s use a Wildfly as the application server for Business Central, as the jBPM installer does by default.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume, after running the jBPM installer, the <em>$JBPM_HOME</em> as the root path for the Wildfly server where the application has been deployed.</p>
</div>
<div class="sect4">
<h5 id="_install_the_kc_adapter"><a class="anchor" href="#_install_the_kc_adapter"></a><a class="link" href="#_install_the_kc_adapter">17.3.4.1. Install the KC adapter</a></h5>
<div class="paragraph">
<p>In order to use the Keycloak&#8217;s authentication and authorization modules from the jBPM application, the <a href="http://www.keycloak.org/docs/latest/securing_apps/#jboss-eap-wildfly-adapter">Keycloak JBoss EAP/Wildfly Adapter</a> must be installed on our server at <em>$JBPM_HOME</em>.
Keycloak provides multiple adapters for different containers out of the box, if you are using another container or need to use another adapter, please take a look at the <a href="http://www.keycloak.org/docs/latest/securing_apps/index.html">Securing Applications section</a> from the Keycloak docs.
Here are the steps to install and set up the adapter for Wildfly 11/10/9:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the adapter from <a href="https://downloads.jboss.org/keycloak/3.4.3.Final/adapters/keycloak-oidc/keycloak-wildfly-adapter-dist-3.4.3.Final.zip">Keycloak Client Adapter for Wildfly 11/10/9</a></p>
</li>
<li>
<p>Execute the following commands on your shell:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>cd $JBPM_HOME
unzip keycloak-wildfly-adapter-dist-3.4.3.Final.zip // Install the KC client adapter

cd $JBPM_HOME/bin
./standalone.sh -c standalone-full.xml // set up the KC client adapter.

// ** Once server is up, open a new command line terminal and run:
cd $JBPM_HOME/bin
./jboss-cli.sh -c --file=adapter-install.cli</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configure_the_kc_adapter"><a class="anchor" href="#_configure_the_kc_adapter"></a><a class="link" href="#_configure_the_kc_adapter">17.3.4.2. Configure the KC adapter</a></h5>
<div class="paragraph">
<p>Once installed the KC adapter into Wildfly, next step is to configure the adapter in order to specify different settings such as the location for the authentication server, the realm to use and so on.</p>
</div>
<div class="paragraph">
<p>Keycloak provides two ways of configuring the adapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Per WAR configuration</p>
</li>
<li>
<p>Via Keycloak subsystem</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example let&#8217;s use the second option, use the Keycloak subsystem, so our WAR is free from this kind of settings.
If you want to use the per WAR approach, please take a look <a href="http://www.keycloak.org/docs/latest/securing_apps/index.html#jboss-eap-wildfly-adapter">Required Per WAR Configuration</a>.</p>
</div>
<div class="paragraph">
<p>Edit the configuration file <em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> and locate the subsystem configuration section.
Add the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:keycloak:1.1"&gt;
  &lt;secure-deployment name="business-central-x.y.z.Final.war"&gt;
    &lt;realm&gt;demo&lt;/realm&gt;
    &lt;realm-public-key&gt;MIIBIjANBgkqhkiG9w0BAQEFAAOCA...&lt;/realm-public-key&gt;
    &lt;auth-server-url&gt;http://localhost:8180/auth&lt;/auth-server-url&gt;
    &lt;ssl-required&gt;external&lt;/ssl-required&gt;
    &lt;resource&gt;kie&lt;/resource&gt;
    &lt;enable-basic-auth&gt;true&lt;/enable-basic-auth&gt;
    &lt;credential name="secret"&gt;925f9190-a7c1-4cfd-8a3c-004f9c73dae6&lt;/credential&gt;
    &lt;principal-attribute&gt;preferred_username&lt;/principal-attribute&gt;
  &lt;/secure-deployment&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have imported the example json files from this document in <em>step 2</em>, you can just use same configuration as above by using your concrete deployment name. Otherwise please use your values for these configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Name for the secure deployment</em> - Use your concrete application&#8217;s WAR file name</p>
</li>
<li>
<p><em>Realm</em> - Is the realm that the applications will use, in our example, the <em>demo</em> realm created the previous step.</p>
</li>
<li>
<p><em>Realm Public Key</em> - Provide here the public key for the <em>demo</em> realm. It&#8217;s not mandatory, if it&#8217;s not specified, it will be retrieved from the server. Otherwise, you can find it in the Keycloak admin console &#8594; Realm settings (for <em>demo</em> realm) &#8594; Keys</p>
</li>
<li>
<p><em>Authentication server URL</em> - The URL for the Keycloak&#8217;s authentication server</p>
</li>
<li>
<p><em>Resource</em> - The name for the client created on step 2. In our example, use the value <em>kie</em>.</p>
</li>
<li>
<p><em>Enable basic auth</em> - For this example let&#8217;s enable Basic authentication mechanism as well, so clients can use both Token (Bearer) and Basic approaches to perform the requests.</p>
</li>
<li>
<p><em>Credential</em> - Use the password value for the <em>kie</em> client. You can find it in the Keycloak admin console &#8594; Clients &#8594; kie &#8594; Credentials tab &#8594; Copy the value for the <em>secret</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this example you have to take care about using your concrete values for <em>secure-deployment</em> name, <em>realm-public-key</em> and <em>credential</em> password.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure the following tag is NOT present in the Widfly/EAP profile&#8217;s configuration file (eg: standalone.xml):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;single-sign-on/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s enabled by default in some server versions. If present, it must be removed/disabled in order to allow Keycloak to properly handle the clients.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_run_the_environment"><a class="anchor" href="#_run_the_environment"></a><a class="link" href="#_run_the_environment">17.3.4.3. Run the environment</a></h5>
<div class="paragraph">
<p>At this point a Keycloak server is up and running on the host, and the KC adapter is installed and configured for the jBPM application server.
You can run the application using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$JBPM_HOME/bin/standalone.sh -c standalone-full.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can navigate into the application once the server is up at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> http://localhost:8080/business-central-x.y.z.Final</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/jbpm_login_screen.png" alt="jbpm login screen">
</div>
</div>
<div class="paragraph">
<p>Use your Keycloak&#8217;s admin user credentials to login: <em>admin/password</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_securing_business_central_remote_services_via_keycloak"><a class="anchor" href="#_securing_business_central_remote_services_via_keycloak"></a><a class="link" href="#_securing_business_central_remote_services_via_keycloak">17.3.5. Securing Business Central remote services via Keycloak</a></h4>
<div class="paragraph">
<p>Business Central provides different remote service endpoints that can be consumed by third party clients using the <a href="#knowledge-store-rest-api-con_kie-apis">Knowledge Store REST API</a>.</p>
</div>
<div class="paragraph">
<p>In order to authenticate those services through Keycloak, apply those modifications for the <em>WEB-INF/web.xml</em> file (app deployment descriptor) from jBPM&#8217;s WAR file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constraint the remote services URL patterns as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;remote-services&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;/rest/*&lt;/url-pattern&gt;
    &lt;url-pattern&gt;/maven2/*&lt;/url-pattern&gt;
    &lt;url-pattern&gt;/ws/*&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
    &lt;role-name&gt;rest-all&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The user that consumes the remote services must be member of role <em>rest-all</em>.
As on described previous steps, the <em>admin</em> user in this example it&#8217;s already a member of the <em>rest-all </em>role.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_securing_business_centrals_file_system_services_via_keycloak"><a class="anchor" href="#_securing_business_centrals_file_system_services_via_keycloak"></a><a class="link" href="#_securing_business_centrals_file_system_services_via_keycloak">17.3.6. Securing Business Central's file system services via Keycloak</a></h4>
<div class="paragraph">
<p>In order to consume other remote services such as the file system ones (e.g. remote GIT),
a specific <strong>Keycloak login module must be used</strong> for the application&#8217;s security domain in the
<em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> file.
By default Business Central uses the <em>other</em> security domain, so the resulting  configuration on the
<em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> should be such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-domain name="other" cache-type="default"&gt;
    &lt;authentication&gt;
        &lt;login-module code="org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule" flag="required"&gt;
            &lt;!-- Parameter value can be a file system absolute path or a classpath (e.g. "classpath:/some-path/kie-git.json")--&gt;
            &lt;module-option name="keycloak-config-file" value="$JBPM_HOME/kie-git.json"/&gt;
        &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The login modules on the <em>other</em> security domain in the <em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> file must be REPLACED by the above given one.</p>
</li>
<li>
<p>Replace <em>$JBPM_HOME/kie-git.json</em> by the path (on file system) or the classpath (e.g. <em>classpath:/some-path/kie-git.json</em>) for the json configuration file used for the remote services client. Please continue reading in order to create this Keycloak client and how to obtain this json file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, remote services that use JAAS for the authentication process, such as the file system ones (e.g. GIT), are secured by Keycloak using the client specified in the above json configuration file. So let&#8217;s create this client on Keycloak and generate the required JSON file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to the <a href="http://localhost:8180/auth/admin">KC administration console</a> and create a new client for the <em>demo</em> realm using <em>kie-git</em> as name.</p>
</li>
<li>
<p>Enable <em>Direct Access Grants Enabled</em> option</p>
</li>
<li>
<p>Disable <em>Standard Flow Enabled</em> option</p>
</li>
<li>
<p>Use a <em>confidential</em> access type for this client. See below image as example:</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/kie_git_client_settings.png" alt="kie git client settings">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <em>Installation</em> tab in same <em>kie-git</em> client configuration screen and export using the <em>Keycloak OIDC JSON</em> type.</p>
</li>
<li>
<p>Finally copy this generated JSON file into an accessible directory on the server&#8217;s file system or add it in the application&#8217;s classpath. Use this path value as the <em>keycloak-config-file</em> argument for the above configuration of the <em>org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule</em> login module.</p>
</li>
<li>
<p>More information about Keycloak JAAS Login modules can be found <a href="http://www.keycloak.org/docs/latest/securing_apps/index.html#_jaas_adapter">Keycloak JAAS plugin</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, the internal Git repositories can be cloned by all users authenticated via the Keycloak server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Command example:
git clone ssh://admin@localhost:8001/system</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_execution_server"><a class="anchor" href="#_execution_server"></a><a class="link" href="#_execution_server">17.3.7. Execution server</a></h4>
<div class="paragraph">
<p>The KIE Execution Server provides a <a href="#kie-server-rest-api-con_kie-apis">REST API</a> that can be consumed for any third party clients.
This section is about how to integrate the KIE Execution Server with the Keycloak SSO in order to delegate the third party clients identity management to the SSO server.</p>
</div>
<div class="paragraph">
<p>Consider the above environment running, so consider having:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Keycloak server running and listening on <a href="http://localhost:8180/auth" class="bare">http://localhost:8180/auth</a></p>
</li>
<li>
<p>A realm named <em>demo</em> with a client named <em>kie</em> for Business Central</p>
</li>
<li>
<p>A Business Central running at <a href="http://localhost:8080/business-central-x.y.z.Final" class="bare">http://localhost:8080/business-central-x.y.z.Final</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Follow these steps in order to add an execution server into this environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the client for the execution server on Keycloak</p>
</li>
<li>
<p>Install set up and the Execution server (with the KC client adapter)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_create_the_execution_servers_client_on_keycloak"><a class="anchor" href="#_create_the_execution_servers_client_on_keycloak"></a><a class="link" href="#_create_the_execution_servers_client_on_keycloak">17.3.7.1. Create the execution server&#8217;s client on Keycloak</a></h5>
<div class="paragraph">
<p>As per each execution server is going to be deployed, you have to create a new client on the <em>demo</em> realm in Keycloak:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <a href="http://localhost:8180/auth/admin">KC admin console</a> &#8594; Clients &#8594; New client</p>
</li>
<li>
<p>Name: <em>kie-execution-server</em></p>
</li>
<li>
<p>Root URL: <em><a href="http://localhost:8280/" class="bare">http://localhost:8280/</a></em></p>
</li>
<li>
<p>Client protocol: <em>openid-connect</em></p>
</li>
<li>
<p>Access type: <em>confidential</em> (or <em>public</em> if you want so, but not recommended for production environments)</p>
</li>
<li>
<p>Valid redirect URIs: <em>/kie-server-x.y.z.Final/*</em></p>
</li>
<li>
<p>Base URL: <em>/kie-server-x.y.z.Final</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example the <em>admin</em> user already created on previous steps is the one used for the client requests.
So ensure that the <em>admin</em> user is member of the role <em>kie-server</em> in order to use the execution server&#8217;s remote services.
If the role does not exist, create it.</p>
</div>
<div class="paragraph">
<p>Note: This example considers that the execution server will be configured to run using a port offset of 200, so the HTTP port will be available at localhost:8280.</p>
</div>
</div>
<div class="sect4">
<h5 id="_install_and_set_up_the_kc_adapter_on_the_execution_server"><a class="anchor" href="#_install_and_set_up_the_kc_adapter_on_the_execution_server"></a><a class="link" href="#_install_and_set_up_the_kc_adapter_on_the_execution_server">17.3.7.2. Install and set up the KC adapter on the execution server</a></h5>
<div class="paragraph">
<p>At this point, a client named <em>kie-execution-server</em> is ready on the KC server to use from the execution server.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s install, set up and deploy the execution server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install another Wildfly server to use for the execution server and the KC client adapter as well. You can follow above instructions for Business Central or follow the <a href="http://www.keycloak.org/docs/latest/securing_apps/index.html">securing applications guide</a></p>
</li>
<li>
<p>Edit the <em>standalone-full.xml</em> file from the Wildfly server&#8217;s configuration path and configure the KC subsystem adapter as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;secure-deployment name="kie-server-x.y.z.Final.war"&gt;
    &lt;realm&gt;demo&lt;/realm&gt;
    &lt;realm-public-key&gt;MIGfMA0GCSqGSIb...&lt;/realm-public-key&gt;
    &lt;auth-server-url&gt;http://localhost:8180/auth&lt;/auth-server-url&gt;
    &lt;ssl-required&gt;external&lt;/ssl-required&gt;
    &lt;resource&gt;kie-execution-server&lt;/resource&gt;
    &lt;enable-basic-auth&gt;true&lt;/enable-basic-auth&gt;
    &lt;credential name="secret"&gt;e92ec68d-6177-4239-be05-28ef2f3460ff&lt;/credential&gt;
    &lt;principal-attribute&gt;preferred_username&lt;/principal-attribute&gt;
&lt;/secure-deployment&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider your concrete environment settings if different from this example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secure deployment name &#8594; use the name of the execution server war file being deployed</p>
</li>
<li>
<p>Public key &#8594; Use the demo realm public key or leave it blank, the server will provide one if so</p>
</li>
<li>
<p>Resource &#8594; This time, instead of the kie client used in the Business Central configuration, use the <em>kie-execution-server</em> client</p>
</li>
<li>
<p>Enable basic auth &#8594; Up to you. You can enable Basic auth for third party service consumers</p>
</li>
<li>
<p>Credential &#8594; Use the secret key for the <em>kie-execution-server</em> client. You can find it in the <em>Credentials</em>tab of the KC admin console</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_deploy_and_run_the_execution_server"><a class="anchor" href="#_deploy_and_run_the_execution_server"></a><a class="link" href="#_deploy_and_run_the_execution_server">17.3.7.3. Deploy and run the execution server</a></h5>
<div class="paragraph">
<p>Just deploy the execution server in Wildfly using any of the available mechanisms.
Run the execution server using this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$EXEC_SERVER_HOME/bin/standalone.sh -c standalone-full.xml -Djboss.socket.binding.port-offset=200 -Dorg.kie.server.id=&lt;ID&gt; -Dorg.kie.server.user=&lt;USER&gt; -Dorg.kie.server.pwd=&lt;PWD&gt; -Dorg.kie.server.location=&lt;LOCATION_URL&gt;  -Dorg.kie.server.controller=&lt;CONTROLLER_URL&gt; -Dorg.kie.server.controller.user=&lt;CONTROLLER_USER&gt; -Dorg.kie.server.controller.pwd=&lt;CONTOLLER_PASSWORD&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$EXEC_SERVER_HOME/bin/standalone.sh -c standalone-full.xml -Djboss.socket.binding.port-offset=200 -Dorg.kie.server.id=kieserver1 -Dorg.kie.server.user=admin -Dorg.kie.server.pwd=password -Dorg.kie.server.location=http://localhost:8280/kie-server-x.y.z.Final/services/rest/server -Dorg.kie.server.controller=http://localhost:8080/business-central-x.y.z.Final/rest/controller -Dorg.kie.server.controller.user=admin -Dorg.kie.server.controller.pwd=password</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The users that will consume the execution server remote service endpoints must have the role <em>kie-server</em> assigned.
So create and assign this role in the KC admin console for the users that will consume the execution server remote services.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once up, you can check the server status as (considered using Basic authentication for this request, see next <a href="#consumingRemoteServices">Consuming remote services</a> for more information):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl http://admin:password@localhost:8280/kie-server-x.y.z.Final/services/rest/server/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="consumingRemoteServices"><a class="anchor" href="#consumingRemoteServices"></a><a class="link" href="#consumingRemoteServices">17.3.8. Consuming remote services</a></h4>
<div class="paragraph">
<p>In order to use the different remote services provided by Business Central or by an Execution Server, your client must be authenticated on the KC server and have a valid token to perform the requests.</p>
</div>
<div class="paragraph">
<p>Remember that in order to use the remote services, the authenticated user must have assigned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The role <em>rest-all</em> for using the Business Central remote services</p>
</li>
<li>
<p>The role <em>kie-server</em> for using the Execution Server remote services</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please ensure necessary roles are created and assigned to the users that will consume the remote services on the Keycloak admin console.</p>
</div>
<div class="paragraph">
<p>You have two options to consume the different remove service endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using basic authentication, if the application&#8217;s client supports it</p>
</li>
<li>
<p>Using Bearer (token) based authentication</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_using_basic_authentication"><a class="anchor" href="#_using_basic_authentication"></a><a class="link" href="#_using_basic_authentication">17.3.8.1. Using basic authentication</a></h5>
<div class="paragraph">
<p>If the KC client adapter configuration has the Basic authentication enabled, as proposed in this guide for both Business Central (<em>step 3.2</em>) and Execution Server, you can avoid the token grant/refresh calls and just call the services as the following examples.</p>
</div>
<div class="paragraph">
<p>Example for a Business Central remote repositories endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl http://admin:password@localhost:8080/business-central-x.y.z.Final/rest/repositories</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example to check the status for the Execution Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl http://admin:password@localhost:8280/kie-server-x.y.z.Final/services/rest/server/</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="usingTokenBasedAuthentication"><a class="anchor" href="#usingTokenBasedAuthentication"></a><a class="link" href="#usingTokenBasedAuthentication">17.3.8.2. Using token based authentication</a></h5>
<div class="paragraph">
<p>First step is to create a new client on Keycloak that allows the third party remote service clients to obtain a token.
It can be done as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the KC admin console and create a <em>new client</em> using this configuration:</p>
<div class="ulist">
<ul>
<li>
<p>Client id: <em>kie-remote</em></p>
</li>
<li>
<p>Client protocol: <em>openid-connect</em></p>
</li>
<li>
<p>Access type: <em>public</em></p>
</li>
<li>
<p>Valid redirect URIs: <em><a href="http://localhost/" class="bare">http://localhost/</a></em></p>
</li>
</ul>
</div>
</li>
<li>
<p>As we are going to manually obtain a token and invoke the service let&#8217;s increase the lifespan of tokens slightly. In production access tokens should have a relatively low timeout, ideally less than 5 minutes:</p>
<div class="ulist">
<ul>
<li>
<p>Go to the KC admin console</p>
</li>
<li>
<p>Click your Realm Settings</p>
</li>
<li>
<p>Click Tokens tab</p>
</li>
<li>
<p>Change the value for Access Token Lifespan to 15 minutes. That should give us plenty of time to obtain a token and invoke the service before it expires.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a public client for our remote clients has been created, you can now obtain the token by performing an HTTP request to the KC server&#8217;s tokens endpoint.
Here is an example for command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>RESULT=`curl --data "grant_type=password&amp;client_id=kie-remote&amp;username=admin&amp;passwordpassword=&lt;the_client_secret&gt;" http://localhost:8180/auth/realms/demo/protocol/openid-connect/token`</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TOKEN=`echo $RESULT | sed 's/.*access_token":"//g' | sed 's/".*//g'`</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, if you echo the <em>$TOKEN</em> it will output the token string obtained from the KC server, that can be now used to authorize further calls to the remote endpoints.
For exmple, if you want to check the internal jBPM repositories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -H "Authorization: bearer $TOKEN" http://localhost:8080/business-central-x.y.z.Final/rest/repositories</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keycloak_and_the_business_centrals_security_administration_area"><a class="anchor" href="#_keycloak_and_the_business_centrals_security_administration_area"></a><a class="link" href="#_keycloak_and_the_business_centrals_security_administration_area">17.3.9. Keycloak and the Business Central's security administration area</a></h4>
<div class="paragraph">
<p>Business Central provides an administration area which provides user, group and role management features (see <a href="#_wb.userandgroupmgmt">Security management</a>).</p>
</div>
<div class="paragraph">
<p>By default the application&#8217;s security management system points to the application&#8217;s server realm. For instance, in case of using the packaged distribution for Wildfly, it points to the Wildfly&#8217;s ApplicationRealm (properties based). It means the entities from the realm presented in the administration area are not the ones from the Keycloak realm that the application is using. There exist the following options in order to change this default behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disable the user system administration</p>
</li>
<li>
<p>Use the built-in Keycloak security management provider instead of the default one</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to customize an existing jBPM application (WAR file) for using the Keycloak security management provider replace the content for <em>WEB-INF/classes/security-management.properties</em> by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>org.uberfire.ext.security.management.api.userManagementServices=KCAdapterUserManagementService
org.uberfire.ext.security.management.keycloak.authServer=&lt;authz_server_url&gt;
# eg: org.uberfire.ext.security.management.keycloak.authServer=http://localhost:8180/auth</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The properties <code>org.uberfire.ext.security.management.api.userManagementServices</code> and <code>org.uberfire.ext.security.management.keycloak.authServer</code> can be set as system properties as well.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>jar</em> artifacts required in the steps above can be either downloaded from <a href="https://repository.jboss.org/nexus/">JBoss Nexus</a> or either build from <a href="https://github.com/kiegroup/appformer">sources</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once applying the above changes, the security administration area uses the access token present in the user&#8217;s session in order to authorize and manage the specific Keycloak realm data.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to be able to manage Keycloak realms remotely, please ensure the user has the <em>realm-management</em> client role assigned</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wb.workbenchhighavailability"><a class="anchor" href="#_wb.workbenchhighavailability"></a><a class="link" href="#_wb.workbenchhighavailability">18. Business Central High Availability</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wb.vfsclustering"><a class="anchor" href="#_wb.vfsclustering"></a><a class="link" href="#_wb.vfsclustering">18.1. VFS clustering</a></h3>
<div class="paragraph">
<p>The <a href="#_wb.vfsrepository">VFS repositories</a> (usually git repositories) stores all the assets (such
as rules, decision tables, process definitions, forms, etc). If that VFS is located on each local
server, then it must be kept in sync between all servers of a cluster.</p>
</div>
<div class="paragraph">
<p>Use <a href="http://zookeeper.apache.org/">Apache Zookeeper</a> and <a href="http://helix.incubator.apache.org/">Apache Helix</a>
to accomplish this. Zookeeper glues all the parts together. Helix is the cluster management
component that registers all cluster details (nodes, resources and the cluster itself). Uberfire
(on top of which Business Central is built) uses those 2 components to provide VFS clustering.</p>
</div>
<div class="paragraph">
<p>To create a VFS cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download <a href="http://zookeeper.apache.org/">Apache Zookeeper</a> and <a href="http://helix.incubator.apache.org/">Apache Helix</a>.</p>
</li>
<li>
<p>Install both:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Unzip Zookeeper into a directory (<code>$ZOOKEEPER_HOME</code>).</p>
</li>
<li>
<p>In <code>$ZOOKEEPER_HOME</code>, copy <code>zoo_sample.conf</code> to <code>zoo.conf</code></p>
</li>
<li>
<p>Edit <code>zoo.conf</code>. Adjust the settings if needed. Usually only these 2 properties are relevant:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># the directory where the snapshot is stored.
dataDir=/tmp/zookeeper
# the port at which the clients will connect
clientPort=2181</code></pre>
</div>
</div>
</li>
<li>
<p>Unzip Helix into a directory (<code>$HELIX_HOME</code>).</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the cluster in Zookeeper:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to its <code>bin</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ cd $ZOOKEEPER_HOME/bin</code></pre>
</div>
</div>
</li>
<li>
<p>Start the Zookeeper server:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ sudo ./zkServer.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the server fails to start, verify that the <code>dataDir</code> (as specified in <code>zoo.conf</code>) is accessible.</p>
</div>
</li>
<li>
<p>To review Zookeeper&#8217;s activities, open <code>zookeeper.out</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ cat $ZOOKEEPER_HOME/bin/zookeeper.out</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the cluster in Helix:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to its <code>bin</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ cd $HELIX_HOME/bin</code></pre>
</div>
</div>
</li>
<li>
<p>Create the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./helix-admin.sh --zkSvr localhost:2181 --addCluster kie-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>zkSvr</code> value must match the used Zookeeper server.
The cluster name (<code>kie-cluster</code>) can be changed as needed.</p>
</div>
</li>
<li>
<p>Add nodes to the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Node 1
$ ./helix-admin.sh --zkSvr localhost:2181 --addNode kie-cluster nodeOne:12345
# Node 2
$ ./helix-admin.sh --zkSvr localhost:2181 --addNode kie-cluster nodeTwo:12346
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually the number of nodes a in cluster equal the number of application servers in the cluster.
The node names (<code>nodeOne:12345</code> , &#8230;&#8203;) can be changed as needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>nodeOne:12345</code> is the unique identifier of the node, which will be referenced later on when configuring application servers.
It is not a host and port number, but instead it is used to uniquely identify the logical node.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add resources to the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./helix-admin.sh --zkSvr localhost:2181 --addResource kie-cluster vfs-repo 1 LeaderStandby AUTO_REBALANCE</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource name (<code>vfs-repo</code>) can be changed as needed.</p>
</div>
</li>
<li>
<p>Rebalance the cluster to initialize it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./helix-admin.sh --zkSvr localhost:2181 --rebalance kie-cluster vfs-repo 2</code></pre>
</div>
</div>
</li>
<li>
<p>Start the Helix controller to manage the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  ./run-helix-controller.sh --zkSvr localhost:2181 --cluster kie-cluster 2&gt;&amp;1 &gt; /tmp/controller.log &amp;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the security domain correctly on the application server. For example on WildFly and JBoss EAP:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the file <code>$JBOSS_HOME/domain/configuration/domain.xml</code>.</p>
<div class="paragraph">
<p>For simplicity sake, presume we use the default domain configuration which uses the profile <code>full</code> that defines two server nodes as part of <code>main-server-group</code>.</p>
</div>
</li>
<li>
<p>Locate the profile <code>full</code> and add a new security domain by copying the other security domain already defined there by default:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;security-domain name="kie-ide" cache-type="default"&gt;
    &lt;authentication&gt;
         &lt;login-module code="Remoting" flag="optional"&gt;
             &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
         &lt;/login-module&gt;
         &lt;login-module code="RealmDirect" flag="required"&gt;
             &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
         &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The security-domain name is a magic value.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the <a href="#_wb.systemproperties">system properties</a> for the cluster on the application server. For example on WildFly and JBoss EAP:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the file <code>$JBOSS_HOME/domain/configuration/host.xml</code>.</p>
</li>
<li>
<p>Locate the XML elements <code>server</code> that belong to the <code>main-server-group</code> and add the necessary system property.</p>
<div class="paragraph">
<p>For example for nodeOne:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  &lt;property name="jboss.node.name" value="nodeOne" boot-time="false"/&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="/tmp/kie/nodeone" boot-time="false"/&gt;
  &lt;property name="org.uberfire.metadata.index.dir" value="/tmp/kie/nodeone" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.id" value="kie-cluster" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.zk" value="localhost:2181" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.local.id" value="nodeOne_12345" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo" boot-time="false"/&gt;
  &lt;!-- If you're running both nodes on the same machine: --&gt;
  &lt;property name="org.uberfire.nio.git.daemon.port" value="9418" boot-time="false"/&gt;
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And for nodeTwo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  &lt;property name="jboss.node.name" value="nodeTwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="/tmp/kie/nodetwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.metadata.index.dir" value="/tmp/kie/nodetwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.id" value="kie-cluster" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.zk" value="localhost:2181" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.local.id" value="nodeTwo_12346" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo" boot-time="false"/&gt;
  &lt;!-- If you're running both nodes on the same machine: --&gt;
  &lt;property name="org.uberfire.nio.git.daemon.port" value="9419" boot-time="false"/&gt;
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure the cluster, node and resource names match those configured in Helix.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jbpm_clustering"><a class="anchor" href="#_jbpm_clustering"></a><a class="link" href="#_jbpm_clustering">18.2. jBPM clustering</a></h3>
<div class="paragraph">
<p>In addition to the information above, jBPM clustering requires additional configuration.
See <a href="http://mswiderski.blogspot.com.br/2013/06/clustering-in-jbpm-v6.html">this blog post</a> to configure the database etc correctly.</p>
</div>
<h1 id="_kie_server" class="discrete">KIE Server</h1>
<div class="paragraph">
<p>The KIE Server is a standalone execution server for rules.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.server"><a class="anchor" href="#_ch.kie.server"></a><a class="link" href="#_ch.kie.server">19. KIE Execution Server</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a><a class="link" href="#_overview">19.1. Overview</a></h3>
<div class="paragraph">
<p><em>KIE Server</em> is a modular, standalone server component that can be used to instantiate and execute rules and processes.
It exposes this functionality via REST, JMS and Java interfaces to client application.
It also provides seamless integration with the <em>Business Central</em>.</p>
</div>
<div class="paragraph">
<p>At its core, <em>KIE Server</em> is a configurable web application packaged as a WAR file.
Distributions are availables for pure web containers (like Tomcat) and for JEE 6 and JEE 7 containers.</p>
</div>
<div class="paragraph">
<p>Most capabilities on the Kie Server are configurable, and based on the concepts of extensions.
Each extension can be enabled/disabled independently, allowing the user to configure the server to its need.</p>
</div>
<div class="paragraph">
<p>The current version of the Kie Server ships with two default extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BRM: provides support for the execution of Business Rules using the Drools engine.</p>
</li>
<li>
<p>BPM: provides support for the execution of Business Processes using the jBPM engine. It supports:</p>
<div class="ulist">
<ul>
<li>
<p>process execution</p>
</li>
<li>
<p>task execution</p>
</li>
<li>
<p>asynchronous job execution</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both extensions enabled by default, but can be disabled by setting the corresponding property (see configuration chapter for details).</p>
</div>
<div class="paragraph">
<p>This server was designed to have a low footprint, with minimal memory consumption, and therefore, to be easily deployable on a cloud environment.
Each instance of this server can open and instantiate multiple <em>Kie Containers</em> which allows you to execute multiple services in parallel.</p>
</div>
<div class="sect3">
<h4 id="_glossary"><a class="anchor" href="#_glossary"></a><a class="link" href="#_glossary">19.1.1. Glossary</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Kie Server</strong>: execution server purely focusing on providing runtime environment for both rules and processes. These capabilities are provided by <em>Kie Server Extensions</em>. More capabilities can be added by further extensions (e.g. customer could add his own extensions in case of missing functionality that will then use infrastructure of the KIE Server). A Kie Server instance is a standalone Kie Server executing on a given application server/web container. A Kie Server instantiates and provides support for multiple Kie Containers.</p>
</li>
<li>
<p><strong>Kie Server Extension</strong>: a "plugin" for the Kie Server that adds capabilities to the server. The Kie Server ships with two default kie server extensions: BRM and BPM.</p>
</li>
<li>
<p><strong>Kie Container</strong>: an in-memory instantiation of a kjar, allowing for the instantiation and usage of its assets (domain models, processes, rules, etc). A Kie Server exposes Kie Containers through a standard API over transport protocols like REST and JMS.</p>
</li>
<li>
<p><strong>Controller</strong>: a server-backed REST endpoint that will be responsible for managing KIE Server instances. Such end point must provide following capabilities:</p>
<div class="ulist">
<ul>
<li>
<p>respond to connect requests</p>
</li>
<li>
<p>sync all registered containers on the corresponding <em>Kie Server ID</em></p>
</li>
<li>
<p>respond to disconnect requests</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Kie Server state</strong>: currently known state of given Kie Server instance. This is a local storage (by default in file) that maintains the following information:</p>
<div class="ulist">
<ul>
<li>
<p>list of registered Drools controllers</p>
</li>
<li>
<p>list of known containers</p>
</li>
<li>
<p>kie server configuration</p>
<div class="paragraph">
<p>The server state is persisted upon receival of events like: <em>Kie Container</em> created, <em>Kie Container</em> is disposed, Drools controller accepts registration of <em>Kie Server</em> instance, etc.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Kie Server ID</strong>: an arbitrary assigned identifier to which configurations are assigned. At boot, each Kie Server Instance is assigned an ID, and that ID is matched to a configuration on the Drools controller. The Kie Server Instance fetches and uses that configuration to setup itself.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_kie_server"><a class="anchor" href="#_installing_the_kie_server"></a><a class="link" href="#_installing_the_kie_server">19.2. Installing the KIE Server</a></h3>
<div class="paragraph">
<p>The KIE Server is distributed as a web application archive (WAR) file.
The WAR file comes in three different packagings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>webc</em> - WAR for ordinary Web (Servlet) containers like Tomcat</p>
</li>
<li>
<p><em>ee6</em> - WAR for JavaEE 6 containers like JBoss EAP 6.x</p>
</li>
<li>
<p><em>ee7</em> - WAR for JavaEE 7 containers like WildFly 11.x</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To install the KIE Execution Server and verify it is running, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the WAR file into your web container.</p>
</li>
<li>
<p>Create a user with the role of <code>kie-server</code> on the container.</p>
</li>
<li>
<p>Test that you can access the KIE Server by navigating to the endpoint in a browser window: <code><a href="http://SERVER:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code>.</p>
</li>
<li>
<p>When prompted for username/password, type in the username and password that you created in step 2.</p>
</li>
<li>
<p>Once authenticated, you will see an XML response in the form of KIE Server status, similar to this:</p>
<div class="exampleblock">
<div class="title">Example 107. Sample handshaking server response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;response type="SUCCESS" msg="KIE Server info"&gt;
  &lt;kie-server-info&gt;
    &lt;version&gt;7.30.0.Final&lt;/version&gt;
  &lt;/kie-server-info&gt;
&lt;/response&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_installation_details_for_different_containers"><a class="anchor" href="#_installation_details_for_different_containers"></a><a class="link" href="#_installation_details_for_different_containers">19.2.1. Installation details for different containers</a></h4>
<div class="sect4">
<h5 id="_tomcat_7_x8_x"><a class="anchor" href="#_tomcat_7_x8_x"></a><a class="link" href="#_tomcat_7_x8_x">19.2.1.1. Tomcat 7.x/8.x</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and unzip the Tomcat distribution. Let&#8217;s call the root of the distribution <code>TOMCAT_HOME</code>. This directory is named after the Tomcat version, so for example <code>apache-tomcat-7.0.55</code>.</p>
</li>
<li>
<p>Download <em>kie-server- -webc.war</em> and place it into <code>TOMCAT_HOME/webapps</code>.</p>
</li>
<li>
<p>Configure user(s) and role(s). Make sure that file <code>TOMCAT_HOME/conf/tomcat-users.xml</code> contains the following username and role definition. You can of course choose different username and password, just make sure that the user has role <code>kie-server</code>:</p>
<div class="exampleblock">
<div class="title">Example 108. Username and role definition for Tomcat</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;role rolename="kie-server"/&gt;
&lt;user username="serveruser" password="my.s3cr3t.pass" roles="kie-server"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Start the server by running <code>TOMCAT_HOME/bin/startup.[sh|bat]</code>. You can check out the Tomcat logs in <code>TOMCAT_HOME/logs</code> to see if the application deployed successfully. Please read the table above for the bootstrap switches that can be used to properly configure the instance. For instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./startup.sh -Dorg.kie.server.id=first-kie-server
             -Dorg.kie.server.location=http://localhost:8080/kie-server/services/rest/server</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the server is running. Go to <code><a href="http://SERVER:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code> and type the specified username and password. You should see simple XML message with basic information about the server.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can not leverage the JMS interface when running with Tomcat, or any other Web
container. The Web container version of the WAR contains only the REST interface.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_wildfly_11_x"><a class="anchor" href="#_wildfly_11_x"></a><a class="link" href="#_wildfly_11_x">19.2.1.2. WildFly 11.x</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and unzip the WildFly distribution. Let&#8217;s call the root of the distribution <code>WILDFLY_HOME</code>. This directory is named after the WildFly version, so for example <code>wildfly-14.0.1.Final</code>.</p>
</li>
<li>
<p>Download <em>kie-server- -ee7.war</em> and place it into <code>WILDFLY_HOME/standalone/deployments</code>.</p>
</li>
<li>
<p>Configure user(s) and role(s). Execute the following command <code> WILDFLY_HOME/bin/add-user.[sh|bat] -a -u 'kieserver' -p 'kieserver1!' -ro 'kie-server'</code>. You can of course choose different username and password, just make sure that the user has role <code>kie-server</code>.</p>
</li>
<li>
<p>Start the server by running <code>WILDFLY_HOME/bin/standalone.[sh|bat] -c standalone-full.xml &lt;bootstrap_switches&gt;</code>. You can check out the standard output or WildFly logs in <code>WILDFLY_HOME/standalone/logs</code> to see if the application deployed successfully. Please read the table above for the bootstrap switches that can be used to properly configure the instance. For instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./standalone.sh  --server-config=standalone-full.xml
                 -Djboss.socket.binding.port-offset=150
                 -Dorg.kie.server.id=first-kie-server
                 -Dorg.kie.server.location=http://localhost:8230/kie-server/services/rest/server</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the server is running. Go to <code><a href="http://SERVER:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code> and type the specified username and password. You should see simple XML message with basic information about the server.</p>
<div class="imageblock">
<div class="content">
<img src="./KieServer/kie-server-info.png" alt="kie server info">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-system-properties-ref_kie-apis"><a class="anchor" href="#kie-server-system-properties-ref_kie-apis"></a><a class="link" href="#kie-server-system-properties-ref_kie-apis">19.3. KIE Server system properties</a></h3>
<div class="paragraph">
<p>The KIE Server accepts the following system properties (bootstrap switches) to configure the behavior of the server:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 79. System properties for disabling KIE Server extensions</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, disables the Business Rule Management (BRM) support (for example, rules support).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.optaplanner.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, disables the OptaPlanner support.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.prometheus.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, disables the Prometheus Server extension.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.dmn.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, disables the KIE Server DMN support.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.swagger.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, disables the KIE Server swagger documentation support</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some Drools controller properties listed in the following table are marked as required. Set these properties when you create or remove KIE Server containers in Business Central. If you use the KIE Server separately without any interaction with Business Central, you do not need to set the required properties.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 80. System properties required for Drools controller</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An arbitrary ID to be assigned to the server. If a headless Drools controller is configured outside of Business Central, this is the ID under which the server connects to the headless Drools controller to fetch the KIE container configurations. If not provided, the ID is automatically generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user name used to connect with the KIE Server from the Drools controller, required when running in managed mode. Set this property in Business Central system properties. Set this property when using a Drools controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver1!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password used to connect with the KIE Server from the Drools controller, required when running in managed mode. Set this property in Business Central system properties. Set this property when using a Drools controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A property that enables you to use token-based authentication between the Drools controller and the KIE Server instead of the basic user name and password authentication. The Drools controller sends the token as a parameter in the request header. The server requires long-lived access tokens because the tokens are not refreshed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of the KIE Server instance used by the Drools controller to call back on this server, for example, <code><a href="http://localhost:8230/kie-server/services/rest/server" class="bare">http://localhost:8230/kie-server/services/rest/server</a></code>. Setting this property is required when using a Drools controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of URLs to the Drools controller REST endpoints, for example, <code><a href="http://localhost:8080/business-central/rest/controller" class="bare">http://localhost:8080/business-central/rest/controller</a></code>. Setting this property is required when using a Drools controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user name to connect to the Drools controller REST API. Setting this property is required when using a Drools controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver1!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to connect to the Drools controller REST API. Setting this property is required when using a Drools controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A property that enables you to use token-based authentication between the KIE Server and the Drools controller instead of the basic user name and password authentication. The server sends the token as a parameter in the request header. The server requires long-lived access tokens because the tokens are not refreshed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.connect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The waiting time in milliseconds between repeated attempts to connect the KIE Server to the Drools controller when the server starts.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 81. System properties for loading keystore</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.keyStoreURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL is used to load a Java Cryptography Extension KeyStore (JCEKS). For example, <code><a href="file:///home/kie/keystores/keystore.jceks" class="bare">file:///home/kie/keystores/keystore.jceks</a></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.keyStorePwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password is used for the JCEKS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.server.alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The alias name of the key for REST services where the password is stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.server.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of an alias for REST services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.ctrl.alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The alias of the key for default REST Drools controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.ctrl.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of an alias for default REST Drools controller.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 82. Other system properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.maven.settings.custom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of a custom <code>settings.xml</code> file for Maven configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.server.jms.queues.response</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queue/KIE.SERVER.RESPONSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The response queue JNDI name for JMS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.server.filter.classes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set to <code>true</code>, the Drools KIE Server extension accepts custom classes annotated by the <code>XmlRootElement</code> or <code>Remotable</code> annotations only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JAAS <code>LoginContext</code> domain used to authenticate users when using JMS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.repo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location where KIE Server state files are stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.sync.deploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A property that instructs the KIE Server to hold the deployment until the Drools controller provides the container deployment configuration. This property only affects servers running in managed mode. The following options are available:</p>
<p class="tableblock">* <code>false</code>: The connection to the Drools controller is asynchronous. The application starts, connects to the Drools controller, and once successful, deploys the containers. The application accepts requests even before the containers are available.
* <code>true</code>: The deployment of the server application joins the Drools controller connection thread with the main deployment and awaits its completion. This option can lead to a potential deadlock in case more applications are on the same server. Use only one application on one server instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.startup.strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ControllerBasedStartupStrategy</code>, <code>LocalContainersStartupStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ControllerBasedStartupStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Startup strategy of KIE Server used to control the KIE containers that are deployed and the order in which they are deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.mgmt.api.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set to <code>true</code>, disables KIE Server management API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.xstream.enabled.packages</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java packages like <code>org.kie.example</code>. You can also specify wildcard expressions like <code>org.kie.example.*</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A property that specifies additional packages to whitelist for marshalling using XStream.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.store.services.class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.persistence.jpa.KnowledgeStoreServiceImpl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fully qualified name of the class that implements <code>KieStoreServices</code> that are responsible for bootstraping KieSession instances.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="kie-server-extensions-con_kie-apis"><a class="anchor" href="#kie-server-extensions-con_kie-apis"></a><a class="link" href="#kie-server-extensions-con_kie-apis">19.4. KIE Server capabilities and extensions</a></h3>
<div class="paragraph">
<p>The capabilities in KIE Server are determined by plug-in extensions that you can enable, disable, or further extend to meet your business needs. KIE Server supports the following default capabilities and extensions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 83. KIE Server capabilities and extensions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Capability name</th>
<th class="tableblock halign-left valign-top">Extension name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KieServer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KieServer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides the core capabilities of KIE Server, such as creating and disposing KIE containers on your server instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BRM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Drools</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides the Business Rule Management (BRM) capabilities, such as inserting facts and executing business rules</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BRP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OptaPlanner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides the Business Resource Planning (BRP) capabilities, such as implementing solvers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides the Decision Model and Notation (DMN) capabilities, such as managing DMN data types and executing DMN models</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Swagger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Swagger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides the Swagger web-interface capabilities for interacting with the KIE Server REST API</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To view the supported extensions of a running KIE Server instance, send a <code>GET</code> request to the following REST API endpoint and review the XML or JSON server response:</p>
</div>
<div class="listingblock">
<div class="title">Base URL for GET request for KIE Server information</div>
<div class="content">
<pre class="highlightjs highlight"><code>http://SERVER:PORT/kie-server/services/rest/server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example JSON response with KIE Server information</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Kie Server info",
  "result": {
    "kie-server-info": {
      "id": "test-kie-server",
      "version": "7.26.0.20190818-050814",
      "name": "test-kie-server",
      "location": "http://localhost:8080/kie-server/services/rest/server",
      "capabilities": [
        "KieServer",
        "BRM",
        "BRP",
        "DMN",
        "Swagger"
      ],
      "messages": [
        {
          "severity": "INFO",
          "timestamp": {
            "java.util.Date": 1566169865791
          },
          "content": [
            "Server KieServerInfo{serverId='test-kie-server', version='7.26.0.20190818-050814', name='test-kie-server', location='http:/localhost:8080/kie-server/services/rest/server', capabilities=[KieServer, BRM, BRP, DMN, Swagger]', messages=null', mode=DEVELOPMENT}started successfully at Sun Aug 18 23:11:05 UTC 2019"
          ]
        }
      ],
      "mode": "DEVELOPMENT"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable or disable KIE Server extensions, configure the related <code>*.server.ext.disabled</code> KIE Server system property. For example, to disable the <code>BRM</code> capability, set the system property <code>org.drools.server.ext.disabled=true</code>. For all KIE Server system properties, see
<a href="#kie-server-system-properties-ref_kie-apis">KIE Server system properties</a>.</p>
</div>
<div class="paragraph">
<p>By default, KIE Server extensions are exposed through REST or JMS data transports and use predefined client APIs. You can extend existing KIE Server capabilities with additional REST endpoints, extend supported transport methods beyond REST or JMS, or extend functionality in the KIE Server client.</p>
</div>
<div class="paragraph">
<p>This flexibility in KIE Server functionality enables you to adapt your KIE Server instances to your business needs, instead of adapting your business needs to the default KIE Server capabilities.</p>
</div>
<div class="sect3">
<h4 id="kie-server-extensions-endpoint-proc_kie-apis"><a class="anchor" href="#kie-server-extensions-endpoint-proc_kie-apis"></a><a class="link" href="#kie-server-extensions-endpoint-proc_kie-apis">19.4.1. Extending an existing KIE Server capability with a custom REST API endpoint</a></h4>
<div class="paragraph">
<p>The KIE Server REST API enables you to interact with your KIE containers and business assets (such as business rules, processes, and solvers) in Drools without using the Business Central user interface. The available REST endpoints are determined by the capabilities enabled in your KIE Server system properties (for example, <code>org.drools.server.ext.disabled=false</code> for the <code>BRM</code> capability). You can extend an existing KIE Server capability with a custom REST API endpoint to further adapt the KIE Server REST API to your business needs.</p>
</div>
<div class="paragraph">
<p>As an example, this procedure extends the <code>Drools</code> KIE Server extension (for the <code>BRM</code> capability) with the following custom REST API endpoint:</p>
</div>
<div class="listingblock">
<div class="title">Example custom REST API endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code>/server/containers/instances/{containerId}/ksession/{ksessionId}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example custom endpoint accepts a list of facts to be inserted into the working memory of the Drools engine, automatically executes all rules, and retrieves all objects from the KIE session in the specified KIE container.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an empty Maven project and define the following packaging type and dependencies in the <code>pom.xml</code> file for the project:</p>
<div class="listingblock">
<div class="title">Example pom.xml file in the sample project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
  &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-internal&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-drools&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-rest-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;version&gt;1.7.25&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Implement the <code>org.kie.server.services.api.KieServerApplicationComponentsService</code> interface in a Java class in your project, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>KieServerApplicationComponentsService</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CusomtDroolsKieServerApplicationComponentsService implements KieServerApplicationComponentsService {  <i class="conum" data-value="1"></i><b>(1)</b>

    private static final String OWNER_EXTENSION = "Drools";  <i class="conum" data-value="2"></i><b>(2)</b>

    public Collection&lt;Object&gt; getAppComponents(String extension, SupportedTransports type, Object... services) {  <i class="conum" data-value="3"></i><b>(3)</b>
        // Do not accept calls from extensions other than the owner extension:
        if ( !OWNER_EXTENSION.equals(extension) ) {
            return Collections.emptyList();
        }

        RulesExecutionService rulesExecutionService = null;  <i class="conum" data-value="4"></i><b>(4)</b>
        KieServerRegistry context = null;

        for( Object object : services ) {
            if( RulesExecutionService.class.isAssignableFrom(object.getClass()) ) {
                rulesExecutionService = (RulesExecutionService) object;
                continue;
            } else if( KieServerRegistry.class.isAssignableFrom(object.getClass()) ) {
                context = (KieServerRegistry) object;
                continue;
            }
        }

        List&lt;Object&gt; components = new ArrayList&lt;Object&gt;(1);
        if( SupportedTransports.REST.equals(type) ) {
            components.add(new CustomResource(rulesExecutionService, context));  <i class="conum" data-value="5"></i><b>(5)</b>
        }

        return components;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delivers REST endpoints to the KIE Server infrastructure that is deployed when the application starts.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the extension that you are extending, such as the <code>Drools</code> extension in this example.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns all resources that the REST container must deploy. Each extension that is enabled in your KIE Server instance calls the <code>getAppComponents</code> method, so the <code>if ( !OWNER_EXTENSION.equals(extension) )</code> call returns an empty collection for any extensions other than the specified <code>OWNER_EXTENSION</code> extension.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Lists the services from the specified extension that you want to use, such as the <code>RulesExecutionService</code> and <code>KieServerRegistry</code> services from the <code>Drools</code> extension in this example.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specifies the transport type for the extension, either <code>REST</code> or <code>JMS</code> (<code>REST</code> in this example), and the <code>CustomResource</code> class that returns the resource as part of the <code>components</code> list.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Implement the <code>CustomResource</code> class that the KIE Server can use to provide the additional functionality for the new REST resource, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>CustomResource</code> class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Custom base endpoint:
@Path("server/containers/instances/{containerId}/ksession")
public class CustomResource {

    private static final Logger logger = LoggerFactory.getLogger(CustomResource.class);

    private KieCommands commandsFactory = KieServices.Factory.get().getCommands();

    private RulesExecutionService rulesExecutionService;
    private KieServerRegistry registry;

    public CustomResource() {

    }

    public CustomResource(RulesExecutionService rulesExecutionService, KieServerRegistry registry) {
        this.rulesExecutionService = rulesExecutionService;
        this.registry = registry;
    }

    // Supported HTTP method, path parameters, and data formats:
    @POST
    @Path("/{ksessionId}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response insertFireReturn(@Context HttpHeaders headers,
            @PathParam("containerId") String id,
            @PathParam("ksessionId") String ksessionId,
            String cmdPayload) {

        Variant v = getVariant(headers);
        String contentType = getContentType(headers);

        // Marshalling behavior and supported actions:
        MarshallingFormat format = MarshallingFormat.fromType(contentType);
        if (format == null) {
            format = MarshallingFormat.valueOf(contentType);
        }
        try {
            KieContainerInstance kci = registry.getContainer(id);

            Marshaller marshaller = kci.getMarshaller(format);

            List&lt;?&gt; listOfFacts = marshaller.unmarshall(cmdPayload, List.class);

            List&lt;Command&lt;?&gt;&gt; commands = new ArrayList&lt;Command&lt;?&gt;&gt;();
            BatchExecutionCommand executionCommand = commandsFactory.newBatchExecution(commands, ksessionId);

            for (Object fact : listOfFacts) {
                commands.add(commandsFactory.newInsert(fact, fact.toString()));
            }
            commands.add(commandsFactory.newFireAllRules());
            commands.add(commandsFactory.newGetObjects());

            ExecutionResults results = rulesExecutionService.call(kci, executionCommand);

            String result = marshaller.marshall(results);


            logger.debug("Returning OK response with content '{}'", result);
            return createResponse(result, v, Response.Status.OK);
        } catch (Exception e) {
            // If marshalling fails, return the `call-container` response to maintain backward compatibility:
            String response = "Execution failed with error : " + e.getMessage();
            logger.debug("Returning Failure response with content '{}'", response);
            return createResponse(response, v, Response.Status.INTERNAL_SERVER_ERROR);
        }

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>CustomResource</code> class for the custom endpoint specifies the following data and behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the base endpoint <code>server/containers/instances/{containerId}/ksession</code></p>
</li>
<li>
<p>Uses <code>POST</code> HTTP method</p>
</li>
<li>
<p>Expects the following data to be given in REST requests:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>containerId</code> as a path argument</p>
</li>
<li>
<p>The <code>ksessionId</code> as a path argument</p>
</li>
<li>
<p>List of facts as a message payload</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supports all KIE Server data formats:</p>
<div class="ulist">
<ul>
<li>
<p>XML (JAXB, XStream)</p>
</li>
<li>
<p>JSON</p>
</li>
</ul>
</div>
</li>
<li>
<p>Unmarshals the payload into a <code>List&lt;?&gt;</code> collection and, for each item in the list, creates an <code>InsertCommand</code> instance followed by <code>FireAllRules</code> and <code>GetObject</code> commands.</p>
</li>
<li>
<p>Adds all commands to the <code>BatchExecutionCommand</code> instance that calls to the Drools engine.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>To make the new endpoint discoverable for KIE Server, create a <code>META-INF/services/org.kie.server.services.api.KieServerApplicationComponentsService</code> file in your Maven project and add the fully qualified class name of the <code>KieServerApplicationComponentsService</code> implementation class within the file. For this example, the file contains the single line <code>org.kie.server.ext.drools.rest.CusomtDroolsKieServerApplicationComponentsService</code>.</p>
</li>
<li>
<p>Build your project and copy the resulting JAR file into the <code>~/kie-server.war/WEB-INF/lib</code> directory of your project.</p>
</li>
<li>
<p>Start the KIE Server and deploy the built project to the running KIE Server. You can deploy the project using either the Business Central interface or the KIE Server REST API (a <code>PUT</code> request to <code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code>).</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>After your project is deployed on a running KIE Server, you can start interacting with your new REST endpoint.</p>
</div>
<div class="paragraph">
<p>For this example, you can use the following information to invoke the new endpoint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Example request URL:</strong> <code>http://localhost:8080/kie-server/services/rest/server/containers/instances/demo/ksession/defaultKieSession</code></p>
</li>
<li>
<p><strong>HTTP method:</strong> <code>POST</code></p>
</li>
<li>
<p><strong>HTTP headers:</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>Content-Type: application/json</code></p>
</li>
<li>
<p><code>Accept: application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Example message payload:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "org.jbpm.test.Person": {
      "name": "john",
      "age": 25
    }
  },
  {
    "org.jbpm.test.Person": {
      "name": "mary",
      "age": 22
    }
  }
]</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Example server response:</strong> <code>200</code> (success)</p>
</li>
<li>
<p><strong>Example server log output:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>13:37:20,347 INFO  [stdout] (default task-24) Hello mary
13:37:20,348 INFO  [stdout] (default task-24) Hello john</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-extensions-transport-proc_kie-apis"><a class="anchor" href="#kie-server-extensions-transport-proc_kie-apis"></a><a class="link" href="#kie-server-extensions-transport-proc_kie-apis">19.4.2. Extending KIE Server to use a custom data transport</a></h4>
<div class="paragraph">
<p>By default, KIE Server extensions are exposed through REST or JMS data transports. You can extend KIE Server to support a custom data transport to adapt KIE Server transport protocols to your business needs.</p>
</div>
<div class="paragraph">
<p>As an example, this procedure adds a custom data transport to KIE Server that uses the <code>Drools</code> extension and that is based on Apache MINA, an open-source Java network-application framework. The example custom MINA transport exchanges string-based data that relies on existing marshalling operations and supports only JSON format.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an empty Maven project and define the following packaging type and dependencies in the <code>pom.xml</code> file for the project:</p>
<div class="listingblock">
<div class="title">Example pom.xml file in the sample project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
  &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-internal&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-drools&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;version&gt;1.7.25&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.mina&lt;/groupId&gt;
    &lt;artifactId&gt;mina-core&lt;/artifactId&gt;
    &lt;version&gt;2.1.3&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Implement the <code>org.kie.server.services.api.KieServerExtension</code> interface in a Java class in your project, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>KieServerExtension</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MinaDroolsKieServerExtension implements KieServerExtension {

    private static final Logger logger = LoggerFactory.getLogger(MinaDroolsKieServerExtension.class);

    public static final String EXTENSION_NAME = "Drools-Mina";

    private static final Boolean disabled = Boolean.parseBoolean(System.getProperty("org.kie.server.drools-mina.ext.disabled", "false"));
    private static final String MINA_HOST = System.getProperty("org.kie.server.drools-mina.ext.port", "localhost");
    private static final int MINA_PORT = Integer.parseInt(System.getProperty("org.kie.server.drools-mina.ext.port", "9123"));

    // Taken from dependency on the `Drools` extension:
    private KieContainerCommandService batchCommandService;

    // Specific to MINA:
    private IoAcceptor acceptor;

    public boolean isActive() {
        return disabled == false;
    }

    public void init(KieServerImpl kieServer, KieServerRegistry registry) {

        KieServerExtension droolsExtension = registry.getServerExtension("Drools");
        if (droolsExtension == null) {
            logger.warn("No Drools extension available, quiting...");
            return;
        }

        List&lt;Object&gt; droolsServices = droolsExtension.getServices();
        for( Object object : droolsServices ) {
            // If the given service is null (not configured), continue to the next service:
            if (object == null) {
                continue;
            }
            if( KieContainerCommandService.class.isAssignableFrom(object.getClass()) ) {
                batchCommandService = (KieContainerCommandService) object;
                continue;
            }
        }
        if (batchCommandService != null) {
            acceptor = new NioSocketAcceptor();
            acceptor.getFilterChain().addLast( "codec", new ProtocolCodecFilter( new TextLineCodecFactory( Charset.forName( "UTF-8" ))));

            acceptor.setHandler( new TextBasedIoHandlerAdapter(batchCommandService) );
            acceptor.getSessionConfig().setReadBufferSize( 2048 );
            acceptor.getSessionConfig().setIdleTime( IdleStatus.BOTH_IDLE, 10 );
            try {
                acceptor.bind( new InetSocketAddress(MINA_HOST, MINA_PORT) );

                logger.info("{} -- Mina server started at {} and port {}", toString(), MINA_HOST, MINA_PORT);
            } catch (IOException e) {
                logger.error("Unable to start Mina acceptor due to {}", e.getMessage(), e);
            }

        }
    }

    public void destroy(KieServerImpl kieServer, KieServerRegistry registry) {
        if (acceptor != null) {
            acceptor.dispose();
            acceptor = null;
        }
        logger.info("{} -- Mina server stopped", toString());
    }

    public void createContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters) {
        // Empty, already handled by the `Drools` extension

    }

    public void disposeContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters) {
      // Empty, already handled by the `Drools` extension

    }

    public List&lt;Object&gt; getAppComponents(SupportedTransports type) {
        // Nothing for supported transports (REST or JMS)
        return Collections.emptyList();
    }

    public &lt;T&gt; T getAppComponents(Class&lt;T&gt; serviceType) {

        return null;
    }

    public String getImplementedCapability() {
        return "BRM-Mina";
    }

    public List&lt;Object&gt; getServices() {
        return Collections.emptyList();
    }

    public String getExtensionName() {
        return EXTENSION_NAME;
    }

    public Integer getStartOrder() {
        return 20;
    }

    @Override
    public String toString() {
        return EXTENSION_NAME + " KIE Server extension";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>KieServerExtension</code> interface is the main extension interface that KIE Server can use to provide the additional functionality for the new MINA transport. The interface consists of the following components:</p>
</div>
<div class="listingblock">
<div class="title">Overview of the <code>KieServerExtension</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface KieServerExtension {

    boolean isActive();

    void init(KieServerImpl kieServer, KieServerRegistry registry);

    void destroy(KieServerImpl kieServer, KieServerRegistry registry);

    void createContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters);

    void disposeContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters);

    List&lt;Object&gt; getAppComponents(SupportedTransports type);

    &lt;T&gt; T getAppComponents(Class&lt;T&gt; serviceType);

    String getImplementedCapability();  <i class="conum" data-value="1"></i><b>(1)</b>

    List&lt;Object&gt; getServices();

    String getExtensionName();  <i class="conum" data-value="2"></i><b>(2)</b>

    Integer getStartOrder();  <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifies the capability that is covered by this extension. The capability must be unique within KIE Server.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines a human-readable name for the extension.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Determines when the specified extension should be started. For extensions that have dependencies on other extensions, this setting must not conflict with the parent setting. For example, in this case, this custom extension depends on the <code>Drools</code> extension, which has <code>StartOrder</code> set to <code>0</code>, so this custom add-on extension must be greater than <code>0</code> (set to <code>20</code> in the sample implementation).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous <code>MinaDroolsKieServerExtension</code> sample implementation of this interface, the <code>init</code> method is the main element for collecting services from the <code>Drools</code> extension and for bootstrapping the MINA server. All other methods in the <code>KieServerExtension</code> interface can remain with the standard implementation to fulfill interface requirements.</p>
</div>
<div class="paragraph">
<p>The <code>TextBasedIoHandlerAdapter</code> class is the handler on the MINA server that reacts to incoming requests.</p>
</div>
</div>
</div>
</li>
<li>
<p>Implement the <code>TextBasedIoHandlerAdapter</code> handler for the MINA server, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>TextBasedIoHandlerAdapter</code> handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TextBasedIoHandlerAdapter extends IoHandlerAdapter {

    private static final Logger logger = LoggerFactory.getLogger(TextBasedIoHandlerAdapter.class);

    private KieContainerCommandService batchCommandService;

    public TextBasedIoHandlerAdapter(KieContainerCommandService batchCommandService) {
        this.batchCommandService = batchCommandService;
    }

    @Override
    public void messageReceived( IoSession session, Object message ) throws Exception {
        String completeMessage = message.toString();
        logger.debug("Received message '{}'", completeMessage);
        if( completeMessage.trim().equalsIgnoreCase("quit") || completeMessage.trim().equalsIgnoreCase("exit") ) {
            session.close(false);
            return;
        }

        String[] elements = completeMessage.split("\\|");
        logger.debug("Container id {}", elements[0]);
        try {
            ServiceResponse&lt;String&gt; result = batchCommandService.callContainer(elements[0], elements[1], MarshallingFormat.JSON, null);

            if (result.getType().equals(ServiceResponse.ResponseType.SUCCESS)) {
                session.write(result.getResult());
                logger.debug("Successful message written with content '{}'", result.getResult());
            } else {
                session.write(result.getMsg());
                logger.debug("Failure message written with content '{}'", result.getMsg());
            }
        } catch (Exception e) {

        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the handler class receives text messages and executes them in the <code>Drools</code> service.</p>
</div>
<div class="paragraph">
<p>Consider the following handler requirements and behavior when you use the <code>TextBasedIoHandlerAdapter</code> handler implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Anything that you submit to the handler must be a single line because each incoming transport request is a single line.</p>
</li>
<li>
<p>You must pass a KIE container ID in this single line so that the handler expects the format <code>containerID|payload</code>.</p>
</li>
<li>
<p>You can set a response in the way that it is produced by the marshaller. The response can be multiple lines.</p>
</li>
<li>
<p>The handler supports a <em>stream mode</em> that enables you to send commands without disconnecting from a KIE Server session. To end a KIE Server session in stream mode, send either an <code>exit</code> or <code>quit</code> command to the server.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>To make the new data transport discoverable for KIE Server, create a <code>META-INF/services/org.kie.server.services.api.KieServerExtension</code> file in your Maven project and add the fully qualified class name of the <code>KieServerExtension</code> implementation class within the file. For this example, the file contains the single line <code>org.kie.server.ext.mina.MinaDroolsKieServerExtension</code>.</p>
</li>
<li>
<p>Build your project and copy the resulting JAR file and the <code>mina-core-2.0.9.jar</code> file (which the extension depends on in this example) into the <code>~/kie-server.war/WEB-INF/lib</code> directory of your project.</p>
</li>
<li>
<p>Start the KIE Server and deploy the built project to the running KIE Server. You can deploy the project using either the Business Central interface or the KIE Server REST API (a <code>PUT</code> request to <code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code>).</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>After your project is deployed on a running KIE Server, you can view the status of the new data transport in your KIE Server log and start using your new data transport:</p>
</div>
<div class="listingblock">
<div class="title">New data transport in the server log</div>
<div class="content">
<pre class="highlightjs highlight"><code>Drools-Mina KIE Server extension -- Mina server started at localhost and port 9123
Drools-Mina KIE Server extension has been successfully registered as server extension</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, you can use Telnet to interact with the new MINA-based data transport in KIE Server:</p>
</div>
<div class="listingblock">
<div class="title">Starting Telnet and connecting to KIE Server on port 9123 in a command terminal</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">telnet 127.0.0.1 9123</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example interactions with KIE Server in a command terminal</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.

# Request body:
demo|{"lookup":"defaultKieSession","commands":[{"insert":{"object":{"org.jbpm.test.Person":{"name":"john","age":25}}}},{"fire-all-rules":""}]}

# Server response:
{
  "results" : [ {
    "key" : "",
    "value" : 1
  } ],
  "facts" : [ ]
}

demo|{"lookup":"defaultKieSession","commands":[{"insert":{"object":{"org.jbpm.test.Person":{"name":"mary","age":22}}}},{"fire-all-rules":""}]}
{
  "results" : [ {
    "key" : "",
    "value" : 1
  } ],
  "facts" : [ ]
}

demo|{"lookup":"defaultKieSession","commands":[{"insert":{"object":{"org.jbpm.test.Person":{"name":"james","age":25}}}},{"fire-all-rules":""}]}
{
  "results" : [ {
    "key" : "",
    "value" : 1
  } ],
  "facts" : [ ]
}
exit
Connection closed by foreign host.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server log output</div>
<div class="content">
<pre class="highlightjs highlight"><code>16:33:40,206 INFO  [stdout] (NioProcessor-2) Hello john
16:34:03,877 INFO  [stdout] (NioProcessor-2) Hello mary
16:34:19,800 INFO  [stdout] (NioProcessor-2) Hello james</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-extensions-client-proc_kie-apis"><a class="anchor" href="#kie-server-extensions-client-proc_kie-apis"></a><a class="link" href="#kie-server-extensions-client-proc_kie-apis">19.4.3. Extending the KIE Server client with a custom client API</a></h4>
<div class="paragraph">
<p>KIE Server uses predefined client APIs that you can interact with to use KIE Server services. You can extend the KIE Server client with a custom client API to adapt KIE Server services to your business needs.</p>
</div>
<div class="paragraph">
<p>As an example, this procedure adds a custom client API to KIE Server to accommodate a custom data transport (configured previously for this scenario) that is based on Apache MINA, an open-source Java network-application framework.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an empty Maven project and define the following packaging type and dependencies in the <code>pom.xml</code> file for the project:</p>
<div class="listingblock">
<div class="title">Example pom.xml file in the sample project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
   &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
 &lt;/properties&gt;

 &lt;dependencies&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
     &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
     &lt;version&gt;${version.org.kie}&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
      &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
      &lt;version&gt;${version.org.kie}&lt;/version&gt;
    &lt;/dependency&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;org.drools&lt;/groupId&gt;
     &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
     &lt;version&gt;${version.org.kie}&lt;/version&gt;
   &lt;/dependency&gt;
 &lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Implement the relevant <code>ServicesClient</code> interface in a Java class in your project, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample <code>RulesMinaServicesClient</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface RulesMinaServicesClient extends RuleServicesClient {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A specific interface is required because you must register client implementations based on the interface, and you can have only one implementation for a given interface.</p>
</div>
<div class="paragraph">
<p>For this example, the custom MINA-based data transport uses the <code>Drools</code> extension, so this example <code>RulesMinaServicesClient</code> interface extends the existing <code>RuleServicesClient</code> client API from the <code>Drools</code> extension.</p>
</div>
</div>
</div>
</li>
<li>
<p>Implement the <code>RulesMinaServicesClient</code> interface that the KIE Server can use to provide the additional client functionality for the new MINA transport, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>RulesMinaServicesClient</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class RulesMinaServicesClientImpl implements RulesMinaServicesClient {

    private String host;
    private Integer port;

    private Marshaller marshaller;

    public RulesMinaServicesClientImpl(KieServicesConfiguration configuration, ClassLoader classloader) {
        String[] serverDetails = configuration.getServerUrl().split(":");

        this.host = serverDetails[0];
        this.port = Integer.parseInt(serverDetails[1]);

        this.marshaller = MarshallerFactory.getMarshaller(configuration.getExtraJaxbClasses(), MarshallingFormat.JSON, classloader);
    }

    public ServiceResponse&lt;String&gt; executeCommands(String id, String payload) {

        try {
            String response = sendReceive(id, payload);
            if (response.startsWith("{")) {
                return new ServiceResponse&lt;String&gt;(ResponseType.SUCCESS, null, response);
            } else {
                return new ServiceResponse&lt;String&gt;(ResponseType.FAILURE, response);
            }
        } catch (Exception e) {
            throw new KieServicesException("Unable to send request to KIE Server", e);
        }
    }

    public ServiceResponse&lt;String&gt; executeCommands(String id, Command&lt;?&gt; cmd) {
        try {
            String response = sendReceive(id, marshaller.marshall(cmd));
            if (response.startsWith("{")) {
                return new ServiceResponse&lt;String&gt;(ResponseType.SUCCESS, null, response);
            } else {
                return new ServiceResponse&lt;String&gt;(ResponseType.FAILURE, response);
            }
        } catch (Exception e) {
            throw new KieServicesException("Unable to send request to KIE Server", e);
        }
    }

    protected String sendReceive(String containerId, String content) throws Exception {

        // Flatten the content to be single line:
        content = content.replaceAll("\\n", "");

        Socket minaSocket = null;
        PrintWriter out = null;
        BufferedReader in = null;

        StringBuffer data = new StringBuffer();
        try {
            minaSocket = new Socket(host, port);
            out = new PrintWriter(minaSocket.getOutputStream(), true);
            in = new BufferedReader(new InputStreamReader(minaSocket.getInputStream()));

            // Prepare and send data:
            out.println(containerId + "|" + content);
            // Wait for the first line:
            data.append(in.readLine());
            // Continue as long as data is available:
            while (in.ready()) {
                data.append(in.readLine());
            }

            return data.toString();
        } finally {
            out.close();
            in.close();
            minaSocket.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example implementation specifies the following data and behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses socket-based communication for simplicity</p>
</li>
<li>
<p>Relies on default configurations from the KIE Server client and uses <code>ServerUrl</code> for providing the host and port of the MINA server</p>
</li>
<li>
<p>Specifies JSON as the marshalling format</p>
</li>
<li>
<p>Requires received messages to be JSON objects that start with an open bracket <code>{</code></p>
</li>
<li>
<p>Uses direct socket communication with a blocking API while waiting for the first line of the response and then reads all lines that are available</p>
</li>
<li>
<p>Does not use <em>stream mode</em> and therefore disconnects the KIE Server session after invoking a command</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Implement the <code>org.kie.server.client.helper.KieServicesClientBuilder</code> interface in a Java class in your project, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>KieServicesClientBuilder</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MinaClientBuilderImpl implements KieServicesClientBuilder {  <i class="conum" data-value="1"></i><b>(1)</b>

    public String getImplementedCapability() {  <i class="conum" data-value="2"></i><b>(2)</b>
        return "BRM-Mina";
    }

    public Map&lt;Class&lt;?&gt;, Object&gt; build(KieServicesConfiguration configuration, ClassLoader classLoader) {  <i class="conum" data-value="3"></i><b>(3)</b>
        Map&lt;Class&lt;?&gt;, Object&gt; services = new HashMap&lt;Class&lt;?&gt;, Object&gt;();

        services.put(RulesMinaServicesClient.class, new RulesMinaServicesClientImpl(configuration, classLoader));

        return services;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables you to provide additional client APIs to the generic KIE Server client infrastructure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines the KIE Server capability (extension) that the client uses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Provides a map of the client implementations, where the key is the interface and the value is the fully initialized implementation</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>To make the new client API discoverable for the KIE Server client, create a <code>META-INF/services/org.kie.server.client.helper.KieServicesClientBuilder</code> file in your Maven project and add the fully qualified class name of the <code>KieServicesClientBuilder</code> implementation class within the file. For this example, the file contains the single line <code>org.kie.server.ext.mina.client.MinaClientBuilderImpl</code>.</p>
</li>
<li>
<p>Build your project and copy the resulting JAR file into the <code>~/kie-server.war/WEB-INF/lib</code> directory of your project.</p>
</li>
<li>
<p>Start the KIE Server and deploy the built project to the running KIE Server. You can deploy the project using either the Business Central interface or the KIE Server REST API (a <code>PUT</code> request to <code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code>).</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>After your project is deployed on a running KIE Server, you can start interacting with your new KIE Server client. You use your new client in the same way as the standard KIE Server client, by creating the client configuration and client instance, retrieving the service client by type, and invoking client methods.</p>
</div>
<div class="paragraph">
<p>For this example, you can create a <code>RulesMinaServiceClient</code> client instance and invoke operations on KIE Server through the MINA transport:</p>
</div>
<div class="listingblock">
<div class="title">Sample implementation to create the <code>RulesMinaServiceClient</code> client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected RulesMinaServicesClient buildClient() {
    KieServicesConfiguration configuration = KieServicesFactory.newRestConfiguration("localhost:9123", null, null);
    List&lt;String&gt; capabilities = new ArrayList&lt;String&gt;();
    // Explicitly add capabilities (the MINA client does not respond to `get-server-info` requests):
    capabilities.add("BRM-Mina");

    configuration.setCapabilities(capabilities);
    configuration.setMarshallingFormat(MarshallingFormat.JSON);

    configuration.addJaxbClasses(extraClasses);

    KieServicesClient kieServicesClient =  KieServicesFactory.newKieServicesClient(configuration);

    RulesMinaServicesClient rulesClient = kieServicesClient.getServicesClient(RulesMinaServicesClient.class);

    return rulesClient;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample configuration to invoke operations on KIE Server through the MINA transport</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RulesMinaServicesClient rulesClient = buildClient();

List&lt;Command&lt;?&gt;&gt; commands = new ArrayList&lt;Command&lt;?&gt;&gt;();
BatchExecutionCommand executionCommand = commandsFactory.newBatchExecution(commands, "defaultKieSession");

Person person = new Person();
person.setName("mary");
commands.add(commandsFactory.newInsert(person, "person"));
commands.add(commandsFactory.newFireAllRules("fired"));

ServiceResponse&lt;String&gt; response = rulesClient.executeCommands(containerId, executionCommand);
Assert.assertNotNull(response);

Assert.assertEquals(ResponseType.SUCCESS, response.getType());

String data = response.getResult();

Marshaller marshaller = MarshallerFactory.getMarshaller(extraClasses, MarshallingFormat.JSON, this.getClass().getClassLoader());

ExecutionResultImpl results = marshaller.unmarshall(data, ExecutionResultImpl.class);
Assert.assertNotNull(results);

Object personResult = results.getValue("person");
Assert.assertTrue(personResult instanceof Person);

Assert.assertEquals("mary", ((Person) personResult).getName());
Assert.assertEquals("JBoss Community", ((Person) personResult).getAddress());
Assert.assertEquals(true, ((Person) personResult).isRegistered());</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie_server_setup"><a class="anchor" href="#_kie_server_setup"></a><a class="link" href="#_kie_server_setup">19.5. Kie Server setup</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server setup and registration changed significantly from versions 6.2 and before.
The following applies only to version 6.3 and forward.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_managed_kie_server"><a class="anchor" href="#_managed_kie_server"></a><a class="link" href="#_managed_kie_server">19.5.1. Managed Kie Server</a></h4>
<div class="paragraph">
<p>A managed instance is one that requires a Drools controller to be available to properly start up the Kie Server instance.</p>
</div>
<div class="paragraph">
<p>The Drools controller is a component responsible for keeping and managing a Kie Server Configuration in centralized way.
Each Drools controller can manage multiple configurations at once and there can be multiple Drools controllers in the environment.
Managed KIE Servers can be configured with a list of Drools controllers but will connect to only one at a time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s important to mention that even though there can be multiple
Drools controllers they should be kept in sync to make sure that regardless
which one of them is contacted by KIE Server instance it will provide
same set of configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At startup, if a Kie Server is configured with a list of Drools controllers, it will try successively to connect to each of them until a connection is successfully established with one of them.
If for any reason a connection can&#8217;t be established, the server will not start, even if there is local storage available with configuration.
This happens by design in order to ensure consistency.
For instance, if the Kie  Server was down and the configuration has changed, this restriction guarantees that it will run with up to date configuration or not at all.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to run the Kie Server in standalone mode, without connecting to
any Drools controllers, please see "Unmanaged Kie Server".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration sets, among other things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie containers to be deployed and started</p>
</li>
<li>
<p>configuration items - currently this is a place holder for further enhancements that will allow remotely configure KIE Execution Server components - timers, persistence, etc</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Drools controller, besides providing configuration management, is also responsible for overall management of Kie Servers.
It provides a REST api that is divided into two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the Drools controller itself that is exposed to interact with KIE Execution Server instances</p>
</li>
<li>
<p>an administration API that allows to remotely manage Kie Server instances:</p>
<div class="ulist">
<ul>
<li>
<p>add/remove servers</p>
</li>
<li>
<p>add/remove containers to/from the servers</p>
</li>
<li>
<p>start/stop containers on servers</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Drools controller deals only with the Kie Server configuration or definition to put it differently.
It does not handle any runtime components of KIE Execution Server instances.
They are always considered remote to Drools controller.
The Drools controller is responsible for persisting the configuration to preserve restarts of the Drools controller itself.
It should manage the synchronization as well in case multiple Drools controllers are configured to keep all definitions up to date on all instances of the Drools controller.</p>
</div>
<div class="paragraph">
<p>By default Drools controller is shipped with Business Central and provides a fully featured management interface (both REST api and UI). It uses underlying git repository as persistent store and thus when GIT repositories are clustered (using Apache Zookeeper and Apache Helix) it will cover the Drools controllers synchronization as well.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/kie-server-simple-architecture.png" alt="kie server simple architecture">
</div>
</div>
<div class="paragraph">
<p>The diagram above illustrates the single Drools controller (Business Central) setup with multiple Kie Server instances managed by it.</p>
</div>
<div class="paragraph">
<p>The diagram below illustrates the clustered setup where there are multiple instances of Drools controller synchronized over Zookeeper.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/kie-server-architecture.png" alt="kie server architecture">
</div>
</div>
<div class="paragraph">
<p>In the above diagram we can see that the Kie Server instances are capable of connecting to any Drools controllers, but they will connect to only one.
Each instance will attempt to connect to Drools controller as long as it can reach one.
Once connection is established with one of the Drools controllers it will skip the others.</p>
</div>
<div class="sect4">
<h5 id="_working_with_managed_servers"><a class="anchor" href="#_working_with_managed_servers"></a><a class="link" href="#_working_with_managed_servers">19.5.1.1. Working with managed servers</a></h5>
<div class="paragraph">
<p>There are two approaches that users can take when working with managed KIE Server instances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Configuration first: </em>with this approach, a user will start working with the Drools controller (either UI or REST api) and create and configure Kie Server definitions. That consists basically of an identification for the server definition (id and name + optionally version for improved readability) and the configuration for the Kie Containers to run on the server.</p>
</li>
<li>
<p><em>Registration first:</em> with this approach, the Kie Server instances are started first and auto register themselves on Drools controller. The user then can configure the Kie Containers. This option simply skips the registration step done in the first approach and populates it with server id, name and version directly upon auto registration. There are no other differences between the two approaches.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unmanaged_kie_execution_server"><a class="anchor" href="#_unmanaged_kie_execution_server"></a><a class="link" href="#_unmanaged_kie_execution_server">19.5.2. Unmanaged KIE Execution Server</a></h4>
<div class="paragraph">
<p>An unmanaged Kie Server is in turn just a standalone instance, and thus must be configured individually using REST/JMS api from the Kie Server itself.
There is no Drools controller involved.
The configuration is automatically persisted by the server into a file and that is used as the internal server state, in case of restarts.</p>
</div>
<div class="paragraph">
<p>The configuration is updated during the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deploy Kie Container</p>
</li>
<li>
<p>undeploy Kie Container</p>
</li>
<li>
<p>start Kie Container</p>
</li>
<li>
<p>stop Kie Container</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the Kie Server is restarted, it will try to restablish the same state
that was persisted before shutdown. That means that Kie Containers that were
running, will be started, but the ones that were stopped/disposed before, will not.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In most use cases, the Kie Server should be executed in managed mode as that provides some benefits, like a web user interface (if using Business Central as a Drools controller) and some facilities for clustering.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_kie_container"><a class="anchor" href="#_creating_a_kie_container"></a><a class="link" href="#_creating_a_kie_container">19.6. Creating a Kie Container</a></h3>
<div class="paragraph">
<p>Once your Execution Server is registered, you can start adding <strong>Kie Containers</strong> to it.</p>
</div>
<div class="paragraph">
<p><strong>Kie Containers</strong> are self contained environments that have been provisioned to hold instances of your packaged and deployed rule instances.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start by clicking the <strong>\+</strong> icon next to the Execution Server where you want to deploy your Container. This will bring up the New Container screen.</p>
</li>
<li>
<p>If you know the <strong>Group Name</strong>, <strong>Artifact Id</strong> and <strong>Version</strong> (GAV) of your deployed package, then you can enter those details and click the Ok button to select that instance (and provide a name for the Container);</p>
</li>
<li>
<p>If you don&#8217;t know these values, you can search Business Central for all packages that can be deployed. Click the <strong>Search</strong> button without entering any value in the search field (you can narrow your search by entering any term that you know exists in the package that you want to deploy).</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>INSERT SCREENSHOT HERE</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The figure above shows that there are three deployable packages available to be used as containers on the Execution Server.
Select the one that you want by clicking the Select button.
This will auto-populate the <strong>GAV</strong> and you can then click the <strong>Ok</strong> button to use this deployable as the new Container.</p>
</div>
</li>
<li>
<p>Enter a name for this Container at the top and then press the Ok button.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Container name must be unique inside each execution server and must not contain any spaces.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just below the <strong>GAV</strong> row, you will see an uneditable row that shows you the <strong>URL</strong> for your Container against which you will be able to execute REST commands.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_managing_containers"><a class="anchor" href="#_managing_containers"></a><a class="link" href="#_managing_containers">19.7. Managing Containers</a></h3>
<div class="paragraph">
<p>Containers within the Execution Server can be started, stopped and updated from within Business Central.</p>
</div>
<div class="sect3">
<h4 id="_starting_a_container"><a class="anchor" href="#_starting_a_container"></a><a class="link" href="#_starting_a_container">19.7.1. Starting a Container</a></h4>
<div class="paragraph">
<p>Once registered, a Container is in the 'Stopped' mode.
It can be started by first selecting it and then clicking the Start button.
You can also select multiple Containers and start them all at the same time.</p>
</div>
<div class="paragraph">
<p>Once the Container is in the 'Running' mode, a green arrow appears next to it.
If there are any errors starting the Container(s), red icons appear next to Containers and the Execution Server that they are deployed on.</p>
</div>
<div class="paragraph">
<p>You should check the logs of both the Execution Server and the current Business Central to see what the errors are before redeploying the Containers (and possibly the Execution Server).</p>
</div>
</div>
<div class="sect3">
<h4 id="_stopping_and_deleting_a_container"><a class="anchor" href="#_stopping_and_deleting_a_container"></a><a class="link" href="#_stopping_and_deleting_a_container">19.7.2. Stopping and Deleting a Container</a></h4>
<div class="paragraph">
<p>Similar to starting a Container, select the Container(s) that you want to stop (or delete) and click the Stop button (which replaces the Start button for that Container once it has entered the 'Running' mode) or the Delete button.</p>
</div>
</div>
<div class="sect3">
<h4 id="_updating_a_container"><a class="anchor" href="#_updating_a_container"></a><a class="link" href="#_updating_a_container">19.7.3. Updating a Container</a></h4>
<div class="paragraph">
<p>You can update deployed <code>KieContainers</code> without restarting the Execution Server.
This is useful in cases where the Business Rules change, creating new versions of packages to be provisioned.</p>
</div>
<div class="paragraph">
<p>You can have multiple versions of the same package provisioned and deployed, each to a different <code>KieContainer</code>.</p>
</div>
<div class="paragraph">
<p>To update deployments in a <code>KieContainer</code> dynamically, click the icon next to the Container.
This will open up the Container Info screen.
An example of this screen is shown here:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>INSERT SCREENSHOT HERE</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Container Info screen is a useful tool because it not only allows you to see the endpoint for this <code>KieContainer</code>, but it also allows you to either manually or automatically refresh the provision if an update is available.
The update can be manual or automatic:</p>
</div>
<div class="paragraph">
<p><strong>Manual Update:</strong> To manually update a <code>KieContainer</code>, enter the new Version number in the Version box and click the <strong>Update</strong> button.
You can of course, update the Group Id or the Artifact Id , if these have changed as well.
Once updated, the Execution server updates the container and shows you the resolved GAV attributes at the bottom of the screen in the <strong>Resolved Release Id</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>Automatic Update:</strong> If you want a deployed Container to always have the latest version of your deployment without manually editing it, you will need to set the Version property to the value of <code>LATEST</code> and start a <code>Scanner</code>.
This will ensure that the deployed provision always contains the latest version.
The Scanner can be started just once on demand by clicking the Scan Now button or you can start it in the background with scans happening at a specified interval (in milliseconds).You can also set this value to <code>LATEST</code> when you are first creating this deployment.
The <strong>Resolved Release
                            Id</strong> in this case will show you the actual, latest version number.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-rest-api-con_kie-apis"><a class="anchor" href="#kie-server-rest-api-con_kie-apis"></a><a class="link" href="#kie-server-rest-api-con_kie-apis">19.8. KIE Server REST API for KIE containers and business assets</a></h3>
<div class="paragraph">
<p>Drools provides a KIE Server REST API that you can use to interact with your KIE containers and business assets (such as business rules, processes, and solvers) in Drools without using the Business Central user interface. This API support enables you to maintain your Drools resources more efficiently and optimize your integration and development with Drools.</p>
</div>
<div class="paragraph">
<p>With the KIE Server REST API, you can perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy or dispose KIE containers</p>
</li>
<li>
<p>Retrieve and update KIE container information</p>
</li>
<li>
<p>Return KIE Server status and basic information</p>
</li>
<li>
<p>Retrieve and update business asset information</p>
</li>
<li>
<p>Execute business assets (such as rules and processes)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>KIE Server REST API requests require the following components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Authentication</dt>
<dd>
<p>The KIE Server REST API requires HTTP Basic authentication or token-based authentication for the user role <code>kie-server</code>. To view configured user roles for your Drools distribution, navigate to <code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code> and <code>~/application-users.properties</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To add a user with the <code>kie-server</code> role, navigate to <code>~/$SERVER_HOME/bin</code> and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about user roles and Drools installation options, see
<a href="#_installing_the_kie_server">Installing the KIE Server</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">HTTP headers</dt>
<dd>
<p>The KIE Server REST API requires the following HTTP headers for API requests:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: Data format accepted by your requesting client:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> (JSON)</p>
</li>
<li>
<p><code>application/xml</code> (XML, for JAXB or XSTREAM)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Content-Type</code>: Data format of your <code>POST</code> or <code>PUT</code> API request data:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> (JSON)</p>
</li>
<li>
<p><code>application/xml</code> (XML, for JAXB or XSTREAM)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>X-KIE-ContentType</code>: Required header for <code>application/xml</code> XSTREAM API requests and responses:</p>
<div class="ulist">
<ul>
<li>
<p><code>XSTREAM</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP methods</dt>
<dd>
<p>The KIE Server REST API supports the following HTTP methods for API requests:</p>
<div class="ulist">
<ul>
<li>
<p><code>GET</code>: Retrieves specified information from a specified resource endpoint</p>
</li>
<li>
<p><code>POST</code>: Updates a resource or resource instance</p>
</li>
<li>
<p><code>PUT</code>: Updates or creates a resource or resource instance</p>
</li>
<li>
<p><code>DELETE</code>: Deletes a resource or resource instance</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Base URL</dt>
<dd>
<p>The base URL for KIE Server REST API requests is <code>http://SERVER:PORT/kie-server/services/rest/</code>, such as  <code>http://localhost:8080/kie-server/services/rest/</code>.</p>
</dd>
<dt class="hdlist1">Endpoints</dt>
<dd>
<p>KIE Server REST API endpoints, such as <code>/server/containers/{containerId}</code> for a specified KIE container, are the URIs that you append to the KIE Server REST API base URL to access the corresponding resource or type of resource in Drools.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">Example request URL for <code>/server/containers/{containerId}</code> endpoint</div>
<p><code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer</code></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Request parameters and request data</dt>
<dd>
<p>Many KIE Server REST API requests require specific parameters in the request URL path to identify or filter specific resources and to perform specific actions. You can append URL parameters to the endpoint in the format <code>?&lt;PARAM&gt;=&lt;VALUE&gt;&amp;&lt;PARAM&gt;=&lt;VALUE&gt;</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">Example GET request URL with parameters</div>
<p><code>http://localhost:8080/kie-server/services/rest/server/containers?groupId=com.redhat&amp;artifactId=Project1&amp;version=1.0&amp;status=STARTED</code></p>
</div>
<div class="paragraph">
<p>HTTP <code>POST</code> and <code>PUT</code> requests may additionally require a request body or file with data to accompany the request.</p>
</div>
<div class="paragraph">
<div class="title">Example POST request URL and JSON request body data</div>
<p><code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer/release-id</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "release-id": {
    "artifact-id": "Project1",
    "group-id": "com.redhat",
    "version": "1.1"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="kie-server-rest-api-requests-proc_kie-apis"><a class="anchor" href="#kie-server-rest-api-requests-proc_kie-apis"></a><a class="link" href="#kie-server-rest-api-requests-proc_kie-apis">19.8.1. Sending requests with the KIE Server REST API using a REST client or curl utility</a></h4>
<div class="paragraph">
<p>The KIE Server REST API enables you to interact with your KIE containers and business assets (such as business rules, processes, and solvers) in Drools without using the Business Central user interface. You can send KIE Server REST API requests using any REST client or curl utility.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and running.</p>
</li>
<li>
<p>You have <code>kie-server</code> user role access to KIE Server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the relevant <a href="#kie-server-rest-api-endpoints-ref_kie-apis">API endpoint</a> to which you want to send a request, such as <code>[GET] /server/containers</code> to retrieve KIE containers from KIE Server.</p>
</li>
<li>
<p>In a REST client or curl utility, enter the following components for a <code>GET</code> request to <code>/server/containers</code>. Adjust any request details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For REST client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Enter the user name and password of the KIE Server user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><strong>HTTP Headers</strong>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP method</strong>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the KIE Server REST API base URL and endpoint, such as <code>http://localhost:8080/kie-server/services/rest/server/containers</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For curl utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code>: Enter the user name and password of the KIE Server user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><code>-H</code>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the KIE Server REST API base URL and endpoint, such as <code>http://localhost:8080/kie-server/services/rest/server/containers</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/kie-server/services/rest/server/containers"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the request and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "List of created containers",
  "result": {
    "kie-containers": {
      "kie-container": [
        {
          "container-id": "itorders_1.0.0-SNAPSHOT",
          "release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "resolved-release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [],
          "container-alias": "itorders"
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>For this example, copy or note the project <code>group-id</code>, <code>artifact-id</code>, and <code>version</code> (GAV) data from one of the deployed KIE containers returned in the response.</p>
</li>
<li>
<p>In your REST client or curl utility, send another API request with the following components for a <code>PUT</code> request to <code>/server/containers/{containerId}</code> to deploy a new KIE container with the copied project GAV data. Adjust any request details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For REST client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Enter the user name and password of the KIE Server user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><strong>HTTP Headers</strong>: Set the following headers:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: <code>application/json</code></p>
</li>
<li>
<p><code>Content-Type</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP method</strong>: Set to <code>PUT</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the KIE Server REST API base URL and endpoint, such as <code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer</code>.</p>
</li>
<li>
<p><strong>Request body</strong>: Add a JSON request body with the configuration items for the new KIE container:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "config-items": [
    {
      "itemName": "RuntimeStrategy",
      "itemValue": "SINGLETON",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "MergeMode",
      "itemValue": "MERGE_COLLECTIONS",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KBase",
      "itemValue": "",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KSession",
      "itemValue": "",
      "itemType": "java.lang.String"
    }
  ],
  "release-id": {
    "group-id": "itorders",
    "artifact-id": "itorders",
    "version": "1.0.0-SNAPSHOT"
  },
  "scanner": {
    "poll-interval": "5000",
    "status": "STARTED"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For curl utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code>: Enter the user name and password of the KIE Server user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><code>-H</code>: Set the following headers:</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code>: <code>application/json</code></p>
</li>
<li>
<p><code>content-type</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code>: Set to <code>PUT</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the KIE Server REST API base URL and endpoint, such as <code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer</code>.</p>
</li>
<li>
<p><code>-d</code>: Add a JSON request body or file (<code>@file.json</code>) with the configuration items for the new KIE container:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/kie-server/services/rest/server/containers/MyContainer" -d "{ \"config-items\": [ { \"itemName\": \"RuntimeStrategy\", \"itemValue\": \"SINGLETON\", \"itemType\": \"java.lang.String\" }, { \"itemName\": \"MergeMode\", \"itemValue\": \"MERGE_COLLECTIONS\", \"itemType\": \"java.lang.String\" }, { \"itemName\": \"KBase\", \"itemValue\": \"\", \"itemType\": \"java.lang.String\" }, { \"itemName\": \"KSession\", \"itemValue\": \"\", \"itemType\": \"java.lang.String\" } ], \"release-id\": { \"group-id\": \"itorders\", \"artifact-id\": \"itorders\", \"version\": \"1.0.0-SNAPSHOT\" }, \"scanner\": { \"poll-interval\": \"5000\", \"status\": \"STARTED\" }}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/kie-server/services/rest/server/containers/MyContainer" -d @my-container-configs.json</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the request and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container MyContainer successfully deployed with module itorders:itorders:1.0.0-SNAPSHOT.",
  "result": {
    "kie-container": {
      "container-id": "MyContainer",
      "release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "resolved-release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "status": "STARTED",
      "scanner": {
        "status": "STARTED",
        "poll-interval": 5000
      },
      "config-items": [],
      "messages": [
        {
          "severity": "INFO",
          "timestamp": {
            "java.util.Date": 1540584717937
          },
          "content": [
            "Container MyContainer successfully created with module itorders:itorders:1.0.0-SNAPSHOT."
          ]
        }
      ],
      "container-alias": null
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you encounter request errors, review the returned error code messages and adjust your request accordingly.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-rest-api-requests-swagger-proc_kie-apis"><a class="anchor" href="#kie-server-rest-api-requests-swagger-proc_kie-apis"></a><a class="link" href="#kie-server-rest-api-requests-swagger-proc_kie-apis">19.8.2. Sending requests with the KIE Server REST API using the Swagger interface</a></h4>
<div class="paragraph">
<p>The KIE Server REST API supports a Swagger web interface that you can use instead of a standalone REST client or curl utility to interact with your KIE containers and business assets (such as business rules, processes, and solvers) in Drools without using the Business Central user interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the Swagger web interface for KIE Server is enabled by the <code>org.kie.swagger.server.ext.disabled=false</code> system property. To disable the Swagger web interface in KIE Server, set this system property to <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and running.</p>
</li>
<li>
<p>You have <code>kie-server</code> user role access to KIE Server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a web browser, navigate to <code>http://SERVER:PORT/kie-server/docs</code>, such as <code>http://localhost:8080/kie-server/docs</code>, and log in with the user name and password of the KIE Server user with the <code>kie-server</code> role.</p>
</li>
<li>
<p>In the Swagger page, select the relevant API endpoint to which you want to send a request, such as <strong>KIE Server and KIE containers</strong> &#8594; <strong>[GET] /server/containers</strong> to retrieve KIE containers from KIE Server.</p>
</li>
<li>
<p>Click <strong>Try it out</strong> and provide any optional parameters by which you want to filter results, if needed.</p>
</li>
<li>
<p>In the <strong>Response content type</strong> drop-down menu, select the desired format of the server response, such as <strong>application/json</strong> for JSON format.</p>
</li>
<li>
<p>Click <strong>Execute</strong> and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "List of created containers",
  "result": {
    "kie-containers": {
      "kie-container": [
        {
          "container-id": "itorders_1.0.0-SNAPSHOT",
          "release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "resolved-release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [],
          "container-alias": "itorders"
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>For this example, copy or note the project <code>group-id</code>, <code>artifact-id</code>, and <code>version</code> (GAV) data from one of the deployed KIE containers returned in the response.</p>
</li>
<li>
<p>In the Swagger page, navigate to the <strong>KIE Server and KIE containers</strong> &#8594; <strong>[PUT] /server/containers/{containerId}</strong> endpoint to send another request to deploy a new KIE container with the copied project GAV data. Adjust any request details according to your use case.</p>
</li>
<li>
<p>Click <strong>Try it out</strong> and enter the following components for the request:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>containerId</strong>: Enter the ID of the new KIE container, such as <code>MyContainer</code>.</p>
</li>
<li>
<p><strong>body</strong>: Set the <strong>Parameter content type</strong> to the desired request body format, such as <strong>application/json</strong> for JSON format, and add a request body with the configuration items for the new KIE container:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "config-items": [
    {
      "itemName": "RuntimeStrategy",
      "itemValue": "SINGLETON",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "MergeMode",
      "itemValue": "MERGE_COLLECTIONS",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KBase",
      "itemValue": "",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KSession",
      "itemValue": "",
      "itemType": "java.lang.String"
    }
  ],
  "release-id": {
    "group-id": "itorders",
    "artifact-id": "itorders",
    "version": "1.0.0-SNAPSHOT"
  },
  "scanner": {
    "poll-interval": "5000",
    "status": "STARTED"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In the <strong>Response content type</strong> drop-down menu, select the desired format of the server response, such as <strong>application/json</strong> for JSON format.</p>
</li>
<li>
<p>Click <strong>Execute</strong> and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container MyContainer successfully deployed with module itorders:itorders:1.0.0-SNAPSHOT.",
  "result": {
    "kie-container": {
      "container-id": "MyContainer",
      "release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "resolved-release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "status": "STARTED",
      "scanner": {
        "status": "STARTED",
        "poll-interval": 5000
      },
      "config-items": [],
      "messages": [
        {
          "severity": "INFO",
          "timestamp": {
            "java.util.Date": 1540584717937
          },
          "content": [
            "Container MyContainer successfully created with module itorders:itorders:1.0.0-SNAPSHOT."
          ]
        }
      ],
      "container-alias": null
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you encounter request errors, review the returned error code messages and adjust your request accordingly.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-rest-api-endpoints-ref_kie-apis"><a class="anchor" href="#kie-server-rest-api-endpoints-ref_kie-apis"></a><a class="link" href="#kie-server-rest-api-endpoints-ref_kie-apis">19.8.3. Supported KIE Server REST API endpoints</a></h4>
<div class="paragraph">
<p>The KIE Server REST API provides endpoints for the following types of resources in Drools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KIE Server and KIE containers</p>
</li>
<li>
<p>KIE session assets (for runtime commands)</p>
</li>
<li>
<p>DMN assets</p>
</li>
<li>
<p>Planning solvers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The KIE Server REST API base URL is <code>http://SERVER:PORT/kie-server/services/rest/</code>. All requests require HTTP Basic authentication or token-based authentication for the <code>kie-server</code> user role.</p>
</div>
<div class="paragraph">
<p>For the full list of KIE Server REST API endpoints and descriptions, use one of the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://jbpm.org/learn/documentation.html">Execution Server REST API</a> on the jBPM Documentation page (static)</p>
</li>
<li>
<p>Swagger UI for the KIE Server REST API at <code>http://SERVER:PORT/kie-server/docs</code> (dynamic, requires running KIE Server)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the Swagger web interface for KIE Server is enabled by the <code>org.kie.swagger.server.ext.disabled=false</code> system property. To disable the Swagger web interface in KIE Server, set this system property to <code>true</code>.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-java-api-con_kie-apis"><a class="anchor" href="#kie-server-java-api-con_kie-apis"></a><a class="link" href="#kie-server-java-api-con_kie-apis">19.9. KIE Server Java client API for KIE containers and business assets</a></h3>
<div class="paragraph">
<p>Drools provides a KIE Server Java client API that enables you to connect to KIE Server using REST protocol from your Java client application. You can use the KIE Server Java client API as an alternative to the KIE Server REST API to interact with your KIE containers and business assets (such as business rules, processes, and solvers) in Drools without using the Business Central user interface. This API support enables you to maintain your Drools resources more efficiently and optimize your integration and development with Drools.</p>
</div>
<div class="paragraph">
<p>With the KIE Server Java client API, you can perform the following actions also supported by the KIE Server REST API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy or dispose KIE containers</p>
</li>
<li>
<p>Retrieve and update KIE container information</p>
</li>
<li>
<p>Return KIE Server status and basic information</p>
</li>
<li>
<p>Retrieve and update business asset information</p>
</li>
<li>
<p>Execute business assets (such as rules and processes)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>KIE Server Java client API requests require the following components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Authentication</dt>
<dd>
<p>The KIE Server Java client API requires HTTP Basic authentication for the user role <code>kie-server</code>. To view configured user roles for your Drools distribution, navigate to <code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code> and <code>~/application-users.properties</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To add a user with the <code>kie-server</code> role, navigate to <code>~/$SERVER_HOME/bin</code> and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about user roles and Drools installation options, see
<a href="#_installing_the_kie_server">Installing the KIE Server</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Project dependencies</dt>
<dd>
<p>The KIE Server Java client API requires the following dependencies on the relevant classpath of your Java project:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on KIE Server --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For runtime commands --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
  &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;version&gt;</code> for Drools dependencies is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005).</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Client request configuration</dt>
<dd>
<p>All Java client requests with the KIE Server Java client API must define at least the following server communication components:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Credentials of the <code>kie-server</code> user</p>
</li>
<li>
<p>KIE Server location, such as <code>http://localhost:8080/kie-server/services/rest/server</code></p>
</li>
<li>
<p>Marshalling format for API requests and responses (JSON, JAXB, or XSTREAM)</p>
</li>
<li>
<p>A <code>KieServicesConfiguration</code> object and a <code>KieServicesClient</code> object, which serve as the entry point for starting the server communication using the Java client API</p>
</li>
<li>
<p>A <code>KieServicesFactory</code> object defining REST protocol and user access</p>
</li>
<li>
<p>Any other client services used, such as <code>RuleServicesClient</code>, <code>ProcessServicesClient</code>, or <code>QueryServicesClient</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are examples of basic and advanced client configurations with these components:</p>
</div>
<div class="listingblock">
<div class="title">Basic client configuration example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.client.KieServicesClient;
import org.kie.server.client.KieServicesConfiguration;
import org.kie.server.client.KieServicesFactory;

public class MyConfigurationObject {

  private static final String URL = "http://localhost:8080/kie-server/services/rest/server";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

  private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

  private static KieServicesConfiguration conf;
  private static KieServicesClient kieServicesClient;

  public static void initialize() {
    conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);

    //If you use custom classes, such as Obj.class, add them to the configuration.
    Set&lt;Class&lt;?&gt;&gt; extraClassList = new HashSet&lt;Class&lt;?&gt;&gt;();
    extraClassList.add(Obj.class);
    conf.addExtraClasses(extraClassList);

    conf.setMarshallingFormat(FORMAT);
    kieServicesClient = KieServicesFactory.newKieServicesClient(conf);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Advanced client configuration example with additional client services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.client.CaseServicesClient;
import org.kie.server.client.DMNServicesClient;
import org.kie.server.client.DocumentServicesClient;
import org.kie.server.client.JobServicesClient;
import org.kie.server.client.KieServicesClient;
import org.kie.server.client.KieServicesConfiguration;
import org.kie.server.client.KieServicesFactory;
import org.kie.server.client.ProcessServicesClient;
import org.kie.server.client.QueryServicesClient;
import org.kie.server.client.RuleServicesClient;
import org.kie.server.client.SolverServicesClient;
import org.kie.server.client.UIServicesClient;
import org.kie.server.client.UserTaskServicesClient;
import org.kie.server.api.model.instance.ProcessInstance;
import org.kie.server.api.model.KieContainerResource;
import org.kie.server.api.model.ReleaseId;

public class MyAdvancedConfigurationObject {

    // REST API base URL, credentials, and marshalling format
    private static final String URL = "http://localhost:8080/kie-server/services/rest/server";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";;

    private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

    private static KieServicesConfiguration conf;

    // KIE client for common operations
    private static KieServicesClient kieServicesClient;

    // Rules client
    private static RuleServicesClient ruleClient;

    // Process automation clients
    private static CaseServicesClient caseClient;
    private static DocumentServicesClient documentClient;
    private static JobServicesClient jobClient;
    private static ProcessServicesClient processClient;
    private static QueryServicesClient queryClient;
    private static UIServicesClient uiClient;
    private static UserTaskServicesClient userTaskClient;

    // DMN client
    private static DMNServicesClient dmnClient;

    // Planning client
    private static SolverServicesClient solverClient;

    public static void main(String[] args) {
        initializeKieServerClient();
        initializeDroolsServiceClients();
        initializeJbpmServiceClients();
        initializeSolverServiceClients();
    }

    public static void initializeKieServerClient() {
        conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);
        conf.setMarshallingFormat(FORMAT);
        kieServicesClient = KieServicesFactory.newKieServicesClient(conf);
    }

    public static void initializeDroolsServiceClients() {
        ruleClient = kieServicesClient.getServicesClient(RuleServicesClient.class);
        dmnClient = kieServicesClient.getServicesClient(DMNServicesClient.class);
    }

    public static void initializeJbpmServiceClients() {
        caseClient = kieServicesClient.getServicesClient(CaseServicesClient.class);
        documentClient = kieServicesClient.getServicesClient(DocumentServicesClient.class);
        jobClient = kieServicesClient.getServicesClient(JobServicesClient.class);
        processClient = kieServicesClient.getServicesClient(ProcessServicesClient.class);
        queryClient = kieServicesClient.getServicesClient(QueryServicesClient.class);
        uiClient = kieServicesClient.getServicesClient(UIServicesClient.class);
        userTaskClient = kieServicesClient.getServicesClient(UserTaskServicesClient.class);
    }

    public static void initializeSolverServiceClients() {
        solverClient = kieServicesClient.getServicesClient(SolverServicesClient.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="kie-server-java-api-requests-proc_kie-apis"><a class="anchor" href="#kie-server-java-api-requests-proc_kie-apis"></a><a class="link" href="#kie-server-java-api-requests-proc_kie-apis">19.9.1. Sending requests with the KIE Server Java client API</a></h4>
<div class="paragraph">
<p>The KIE Server Java client API enables you to connect to KIE Server using REST protocol from your Java client application. You can use the KIE Server Java client API as an alternative to the KIE Server REST API to interact with your KIE containers and business assets (such as business rules, processes, and solvers) in Drools without using the Business Central user interface.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and running.</p>
</li>
<li>
<p>You have <code>kie-server</code> user role access to KIE Server.</p>
</li>
<li>
<p>You have a Java project with Drools resources.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your client application, ensure that the following dependencies have been added to the relevant classpath of your Java project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on KIE Server --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For runtime commands --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
  &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>~/kie/server/client</code> folder
of the Java client API in <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client">GitHub</a>
, identify the relevant Java client for the request you want to send, such as <code>KieServicesClient</code> to access client services for KIE containers and other assets in KIE Server.</p>
</li>
<li>
<p>In your client application, create a <code>.java</code> class for the API request. The class must contain the necessary imports, KIE Server location and user credentials, a <code>KieServicesClient</code> object, and the client method to execute, such as <code>createContainer</code> and <code>disposeContainer</code> from the <code>KieServicesClient</code> client. Adjust any configuration details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Creating and disposing a container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.client.KieServicesClient;
import org.kie.server.client.KieServicesConfiguration;
import org.kie.server.client.KieServicesFactory;
import org.kie.server.api.model.KieContainerResource;
import org.kie.server.api.model.ServiceResponse;

public class MyConfigurationObject {

  private static final String URL = "http://localhost:8080/kie-server/services/rest/server";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

  private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

  private static KieServicesConfiguration conf;
  private static KieServicesClient kieServicesClient;

  public static void initialize() {
    conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);

  public void disposeAndCreateContainer() {
      System.out.println("== Disposing and creating containers ==");

      // Retrieve list of KIE containers
      List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();
      if (kieContainers.size() == 0) {
          System.out.println("No containers available...");
          return;
      }

      // Dispose KIE container
      KieContainerResource container = kieContainers.get(0);
      String containerId = container.getContainerId();
      ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);
      if (responseDispose.getType() == ResponseType.FAILURE) {
          System.out.println("Error disposing " + containerId + ". Message: ");
          System.out.println(responseDispose.getMsg());
          return;
      }
      System.out.println("Success Disposing container " + containerId);
      System.out.println("Trying to recreate the container...");

      // Re-create KIE container
      ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);
      if(createResponse.getType() == ResponseType.FAILURE) {
          System.out.println("Error creating " + containerId + ". Message: ");
          System.out.println(responseDispose.getMsg());
          return;
      }
      System.out.println("Container recreated with success!");
      }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You define service responses using the <code>org.kie.server.api.model.ServiceResponse&lt;T&gt;</code> object, where <code>T</code> represents the type of returned response. The <code>ServiceResponse</code> object has the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>String <em>message</em></code>: Returns the response message</p>
</li>
<li>
<p><code>ResponseType <em>type</em></code>: Returns either <code>SUCCESS</code> or <code>FAILURE</code></p>
</li>
<li>
<p><code>T <em>result</em></code>: Returns the requested object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example, when you dispose a container, the <code>ServiceResponse</code> returns a <code>Void</code> response. When you create a container, the <code>ServiceResponse</code> returns a <code>KieContainerResource</code> object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A conversation between a client and a specific KIE Server container in a clustered environment is secured by a unique <code>conversationID</code>. The <code>conversationID</code>  is transferred using the <code>X-KIE-ConversationId</code> REST header. If you update the container, unset the previous <code>conversationID</code>.  Use <code>KieServiesClient.completeConversation()</code> to unset the <code>conversationID</code> for Java API.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Run the configured <code>.java</code> class from your project directory to execute the request, and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If you enabled debug logging, KIE Server responds with a detailed response according to your configured marshalling format, such as JSON.</p>
</div>
<div class="paragraph">
<p>Example server response for a new KIE container (log):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>10:23:35.194 [main] INFO  o.k.s.a.m.MarshallerFactory - Marshaller extensions init
10:23:35.396 [main] DEBUG o.k.s.client.balancer.LoadBalancer - Load balancer RoundRobinBalancerStrategy{availableEndpoints=[http://localhost:8080/kie-server/services/rest/server]} selected url 'http://localhost:8080/kie-server/services/rest/server'
10:23:35.398 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to send GET request to 'http://localhost:8080/kie-server/services/rest/server'
10:23:35.440 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to deserialize content:
 '{
  "type" : "SUCCESS",
  "msg" : "Kie Server info",
  "result" : {
    "kie-server-info" : {
      "id" : "default-kieserver",
      "version" : "7.11.0.Final-redhat-00003",
      "name" : "default-kieserver",
      "location" : "http://localhost:8080/kie-server/services/rest/server",
      "capabilities" : [ "KieServer", "BRM", "BPM", "CaseMgmt", "BPM-UI", "BRP", "DMN", "Swagger" ],
      "messages" : [ {
        "severity" : "INFO",
        "timestamp" : {
  "java.util.Date" : 1540814906533
},
        "content" : [ "Server KieServerInfo{serverId='default-kieserver', version='7.11.0.Final-redhat-00003', name='default-kieserver', location='http://localhost:8080/kie-server/services/rest/server', capabilities=[KieServer, BRM, BPM, CaseMgmt, BPM-UI, BRP, DMN, Swagger], messages=null}started successfully at Mon Oct 29 08:08:26 EDT 2018" ]
      } ]
    }
  }
}'
 into type: 'class org.kie.server.api.model.ServiceResponse'
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - KieServicesClient connected to: default-kieserver version 7.11.0.Final-redhat-00003
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Supported capabilities by the server: [KieServer, BRM, BPM, CaseMgmt, BPM-UI, BRP, DMN, Swagger]
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability KieServer
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - No builder found for 'KieServer' capability
10:23:35.654 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BRM
10:23:35.654 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.DroolsServicesClientBuilder@6b927fb' for capability 'BRM'
10:23:35.655 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.RuleServicesClient=org.kie.server.client.impl.RuleServicesClientImpl@4a94ee4}
10:23:35.655 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BPM
10:23:35.656 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.JBPMServicesClientBuilder@4cc451f2' for capability 'BPM'
10:23:35.672 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.JobServicesClient=org.kie.server.client.impl.JobServicesClientImpl@1189dd52, interface org.kie.server.client.admin.ProcessAdminServicesClient=org.kie.server.client.admin.impl.ProcessAdminServicesClientImpl@36bc55de, interface org.kie.server.client.DocumentServicesClient=org.kie.server.client.impl.DocumentServicesClientImpl@564fabc8, interface org.kie.server.client.admin.UserTaskAdminServicesClient=org.kie.server.client.admin.impl.UserTaskAdminServicesClientImpl@16d04d3d, interface org.kie.server.client.QueryServicesClient=org.kie.server.client.impl.QueryServicesClientImpl@49ec71f8, interface org.kie.server.client.ProcessServicesClient=org.kie.server.client.impl.ProcessServicesClientImpl@1d2adfbe, interface org.kie.server.client.UserTaskServicesClient=org.kie.server.client.impl.UserTaskServicesClientImpl@36902638}
10:23:35.672 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability CaseMgmt
10:23:35.672 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.CaseServicesClientBuilder@223d2c72' for capability 'CaseMgmt'
10:23:35.676 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.admin.CaseAdminServicesClient=org.kie.server.client.admin.impl.CaseAdminServicesClientImpl@2b662a77, interface org.kie.server.client.CaseServicesClient=org.kie.server.client.impl.CaseServicesClientImpl@7f0eb4b4}
10:23:35.676 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BPM-UI
10:23:35.676 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.JBPMUIServicesClientBuilder@5c33f1a9' for capability 'BPM-UI'
10:23:35.677 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.UIServicesClient=org.kie.server.client.impl.UIServicesClientImpl@223191a6}
10:23:35.678 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BRP
10:23:35.678 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.OptaplannerServicesClientBuilder@49139829' for capability 'BRP'
10:23:35.679 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.SolverServicesClient=org.kie.server.client.impl.SolverServicesClientImpl@77fbd92c}
10:23:35.679 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability DMN
10:23:35.679 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.DMNServicesClientBuilder@67c27493' for capability 'DMN'
10:23:35.680 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.DMNServicesClient=org.kie.server.client.impl.DMNServicesClientImpl@35e2d654}
10:23:35.680 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability Swagger
10:23:35.680 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - No builder found for 'Swagger' capability
10:23:35.681 [main] DEBUG o.k.s.client.balancer.LoadBalancer - Load balancer RoundRobinBalancerStrategy{availableEndpoints=[http://localhost:8080/kie-server/services/rest/server]} selected url 'http://localhost:8080/kie-server/services/rest/server'
10:23:35.701 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to send PUT request to 'http://localhost:8080/kie-server/services/rest/server/containers/employee-rostering3' with payload '{
  "container-id" : null,
  "release-id" : {
    "group-id" : "employeerostering",
    "artifact-id" : "employeerostering",
    "version" : "1.0.0-SNAPSHOT"
  },
  "resolved-release-id" : null,
  "status" : null,
  "scanner" : null,
  "config-items" : [ ],
  "messages" : [ ],
  "container-alias" : null
}'
10:23:38.071 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to deserialize content:
 '{
  "type" : "SUCCESS",
  "msg" : "Container employee-rostering3 successfully deployed with module employeerostering:employeerostering:1.0.0-SNAPSHOT.",
  "result" : {
    "kie-container" : {
      "container-id" : "employee-rostering3",
      "release-id" : {
        "group-id" : "employeerostering",
        "artifact-id" : "employeerostering",
        "version" : "1.0.0-SNAPSHOT"
      },
      "resolved-release-id" : {
        "group-id" : "employeerostering",
        "artifact-id" : "employeerostering",
        "version" : "1.0.0-SNAPSHOT"
      },
      "status" : "STARTED",
      "scanner" : {
        "status" : "DISPOSED",
        "poll-interval" : null
      },
      "config-items" : [ ],
      "messages" : [ {
        "severity" : "INFO",
        "timestamp" : {
  "java.util.Date" : 1540909418069
},
        "content" : [ "Container employee-rostering3 successfully created with module employeerostering:employeerostering:1.0.0-SNAPSHOT." ]
      } ],
      "container-alias" : null
    }
  }
}'
 into type: 'class org.kie.server.api.model.ServiceResponse'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you encounter request errors, review the returned error code messages and adjust your Java configurations accordingly.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-java-clients-ref_kie-apis"><a class="anchor" href="#kie-server-java-clients-ref_kie-apis"></a><a class="link" href="#kie-server-java-clients-ref_kie-apis">19.9.2. Supported KIE Server Java clients</a></h4>
<div class="paragraph">
<p>The following are some of the Java client services available in the <code>org.kie.server.client</code> package of your Drools distribution. You can use these services to interact with related resources in KIE Server similarly to the KIE Server REST API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KieServicesClient</code>: Used as the entry point for other KIE Server Java clients, and used to interact with KIE containers</p>
</li>
<li>
<p><code>JobServicesClient</code>: Used to schedule, cancel, re-queue, and get job requests</p>
</li>
<li>
<p><code>RuleServicesClient</code>: Used to send commands to the server to perform rule-related operations, such as executing rules or inserting objects into the KIE session</p>
</li>
<li>
<p><code>SolverServicesClient</code>: Used to perform all OptaPlanner operations, such as getting the solver state and the best solution, or disposing a solver</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>getServicesClient</code> method provides access to any of these clients:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleServicesClient rulesClient = kieServicesClient.getServicesClient(RuleServicesClient.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the full list of available KIE Server Java clients,
see the Java client API source in <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client">GitHub</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-java-api-examples-ref_kie-apis"><a class="anchor" href="#kie-server-java-api-examples-ref_kie-apis"></a><a class="link" href="#kie-server-java-api-examples-ref_kie-apis">19.9.3. Example requests with the KIE Server Java client API</a></h4>
<div class="paragraph">
<p>The following are examples of KIE Server Java client API requests for basic interactions with KIE Server. For the full list of available KIE Server Java clients,
see the Java client API source in <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client">GitHub</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Listing KIE Server capabilities</dt>
<dd>
<p>You can use the <code>org.kie.server.api.model.KieServerInfo</code> object to identify server capabilities. The <code>KieServicesClient</code> client requires the server capability information to correctly produce service clients. You can specify the capabilities globally in <code>KieServicesConfiguration</code>; otherwise they are automatically retrieved from KIE Server.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example request to return KIE Server capabilities</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void listCapabilities() {

  KieServerInfo serverInfo = kieServicesClient.getServerInfo().getResult();
  System.out.print("Server capabilities:");

  for (String capability : serverInfo.getCapabilities()) {
    System.out.print(" " + capability);
  }

  System.out.println();
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Listing KIE containers in KIE Server</dt>
<dd>
<p>KIE containers are represented by the <code>org.kie.server.api.model.KieContainerResource</code> object. The list of resources is represented by the <code>org.kie.server.api.model.KieContainerResourceList</code> object.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example request to return KIE containers from KIE Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void listContainers() {
    KieContainerResourceList containersList = kieServicesClient.listContainers().getResult();
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();
    System.out.println("Available containers: ");
    for (KieContainerResource container : kieContainers) {
        System.out.println("\t" + container.getContainerId() + " (" + container.getReleaseId() + ")");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally filter the KIE container results using an instance of the <code>org.kie.server.api.model.KieContainerResourceFilter</code> class, which is passed to the <code>org.kie.server.client.KieServicesClient.listContainers()</code> method.</p>
</div>
<div class="listingblock">
<div class="title">Example request to return KIE containers by release ID and status</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void listContainersWithFilter() {

    // Filter containers by releaseId "org.example:container:1.0.0.Final" and status FAILED
    KieContainerResourceFilter filter = new KieContainerResourceFilter.Builder()
            .releaseId("org.example", "container", "1.0.0.Final")
            .status(KieContainerStatus.FAILED)
            .build();

    // Using previously created KieServicesClient
    KieContainerResourceList containersList = kieServicesClient.listContainers(filter).getResult();
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();

    System.out.println("Available containers: ");

    for (KieContainerResource container : kieContainers) {
        System.out.println("\t" + container.getContainerId() + " (" + container.getReleaseId() + ")");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Creating and disposing KIE containers in KIE Server</dt>
<dd>
<p>You can use the <code>createContainer</code> and <code>disposeContainer</code> methods in the <code>KieServicesClient</code> client to dispose and create KIE containers. In this example, when you dispose a container, the <code>ServiceResponse</code> returns a <code>Void</code> response. When you create a container, the <code>ServiceResponse</code> returns a <code>KieContainerResource</code> object.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example request to dispose and re-create a KIE container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void disposeAndCreateContainer() {
    System.out.println("== Disposing and creating containers ==");

    // Retrieve list of KIE containers
    List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();
    if (kieContainers.size() == 0) {
        System.out.println("No containers available...");
        return;
    }

    // Dispose KIE container
    KieContainerResource container = kieContainers.get(0);
    String containerId = container.getContainerId();
    ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);
    if (responseDispose.getType() == ResponseType.FAILURE) {
        System.out.println("Error disposing " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Success Disposing container " + containerId);
    System.out.println("Trying to recreate the container...");

    // Re-create KIE container
    ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);
    if(createResponse.getType() == ResponseType.FAILURE) {
        System.out.println("Error creating " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Container recreated with success!");
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Executing runtime commands in KIE Server</dt>
<dd>
<p>Drools supports runtime commands that you can send to KIE Server for asset-related operations, such as inserting or retracting objects in a KIE session or firing all rules. The full list of supported runtime commands is located in the <code>org.drools.core.command.runtime</code> package in your Drools instance.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You can use the <code>org.kie.api.command.KieCommands</code> class to insert commands, and use <code>org.kie.api.KieServices.get().getCommands()</code> to instantiate the <code>KieCommands</code> class. If you want to add multiple commands, use the <code>BatchExecutionCommand</code> wrapper.</p>
</div>
<div class="listingblock">
<div class="title">Example request to insert an object and fire all rules</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.command.Command;
import org.kie.api.command.KieCommands;
import org.kie.server.api.model.ServiceResponse;
import org.kie.server.client.RuleServicesClient;
import org.kie.server.client.KieServicesClient;
import org.kie.api.KieServices;

import java.util.Arrays;

...

public void executeCommands() {

  String containerId = "hello";
  System.out.println("== Sending commands to the server ==");
  RuleServicesClient rulesClient = kieServicesClient.getServicesClient(RuleServicesClient.class);
  KieCommands commandsFactory = KieServices.Factory.get().getCommands();

  Command&lt;?&gt; insert = commandsFactory.newInsert("Some String OBJ");
  Command&lt;?&gt; fireAllRules = commandsFactory.newFireAllRules();
  Command&lt;?&gt; batchCommand = commandsFactory.newBatchExecution(Arrays.asList(insert, fireAllRules));

  ServiceResponse&lt;String&gt; executeResponse = rulesClient.executeCommands(containerId, batchCommand);

  if(executeResponse.getType() == ResponseType.SUCCESS) {
    System.out.println("Commands executed with success! Response: ");
    System.out.println(executeResponse.getResult());
  } else {
    System.out.println("Error executing rules. Message: ");
    System.out.println(executeResponse.getMsg());
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A conversation between a client and a specific KIE Server container in a clustered environment is secured by a unique <code>conversationID</code>. The <code>conversationID</code>  is transferred using the <code>X-KIE-ConversationId</code> REST header. If you update the container, unset the previous <code>conversationID</code>.  Use <code>KieServiesClient.completeConversation()</code> to unset the <code>conversationID</code> for Java API.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-commands-con_kie-apis"><a class="anchor" href="#kie-server-commands-con_kie-apis"></a><a class="link" href="#kie-server-commands-con_kie-apis">19.10. KIE Server and KIE container commands in Drools</a></h3>
<div class="paragraph">
<p>Drools supports server commands that you can send to KIE Server for server-related or container-related operations, such as retrieving server information or creating or deleting a container. The full list of supported KIE Server configuration commands is located in the <code>org.kie.server.api.commands</code> package in your Drools instance.</p>
</div>
<div class="paragraph">
<p>In the KIE Server REST API, you use the <code>org.kie.server.api.commands</code> commands as the request body for <code>POST</code> requests to <code>http://SERVER:PORT/kie-server/services/rest/server/config</code>. For more information about using the KIE Server REST API, see <a href="#kie-server-rest-api-con_kie-apis">KIE Server REST API for KIE containers and business assets</a>.</p>
</div>
<div class="paragraph">
<p>In the KIE Server Java client API, you use the corresponding method in the parent <code>KieServicesClient</code> Java client as an embedded API request in your Java application. All KIE Server commands are executed by methods provided in the Java client API, so you do not need to embed the actual KIE Server commands in your Java application. For more information about using the KIE Server Java client API, see <a href="#kie-server-java-api-con_kie-apis">KIE Server Java client API for KIE containers and business assets</a>.</p>
</div>
<div class="sect3">
<h4 id="kie-server-commands-samples-ref_kie-apis"><a class="anchor" href="#kie-server-commands-samples-ref_kie-apis"></a><a class="link" href="#kie-server-commands-samples-ref_kie-apis">19.10.1. Sample KIE Server and KIE container commands</a></h4>
<div class="paragraph">
<p>The following are sample KIE Server commands that you can use with the KIE Server REST API or Java client API for server-related or container-related operations in KIE Server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GetServerInfoCommand</code></p>
</li>
<li>
<p><code>GetServerStateCommand</code></p>
</li>
<li>
<p><code>CreateContainerCommand</code></p>
</li>
<li>
<p><code>GetContainerInfoCommand</code></p>
</li>
<li>
<p><code>ListContainersCommand</code></p>
</li>
<li>
<p><code>CallContainerCommand</code></p>
</li>
<li>
<p><code>DisposeContainerCommand</code></p>
</li>
<li>
<p><code>GetScannerInfoCommand</code></p>
</li>
<li>
<p><code>UpdateScannerCommand</code></p>
</li>
<li>
<p><code>UpdateReleaseIdCommand</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the full list of supported KIE Server configuration and management commands, see the <code>org.kie.server.api.commands</code> package in your Drools instance.</p>
</div>
<div class="paragraph">
<p>You can run KIE Server commands individually or together as a batch REST API request or batch Java API request:</p>
</div>
<div class="listingblock">
<div class="title">Batch REST API request to create, call, and dispose a KIE container (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "create-container": {
        "container": {
          "status": "STARTED",
          "container-id": "command-script-container",
          "release-id": {
            "version": "1.0",
            "group-id": "com.redhat",
            "artifact-id": "Project1"
          }
        }
      }
    },
    {
      "call-container": {
        "payload": "{\n  \"commands\" : [ {\n    \"fire-all-rules\" : {\n      \"max\" : -1,\n      \"out-identifier\" : null\n    }\n  } ]\n}",
        "container-id": "command-script-container"
      }
    },
    {
      "dispose-container": {
        "container-id": "command-script-container"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Batch Java API request to retrieve, dispose, and re-create a KIE container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void disposeAndCreateContainer() {
    System.out.println("== Disposing and creating containers ==");

    // Retrieve list of KIE containers
    List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();
    if (kieContainers.size() == 0) {
        System.out.println("No containers available...");
        return;
    }

    // Dispose KIE container
    KieContainerResource container = kieContainers.get(0);
    String containerId = container.getContainerId();
    ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);
    if (responseDispose.getType() == ResponseType.FAILURE) {
        System.out.println("Error disposing " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Success Disposing container " + containerId);
    System.out.println("Trying to recreate the container...");

    // Re-create KIE container
    ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);
    if(createResponse.getType() == ResponseType.FAILURE) {
        System.out.println("Error creating " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Container recreated with success!");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each command in this section includes a REST request body example (JSON) for the KIE Server REST API and an embedded method example from the <code>KieServicesClient</code> Java client for the KIE Server Java client API.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GetServerInfoCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns information about the KIE Server.</p>
</div>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-server-info" : { }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServerInfo serverInfo = kieServicesClient.getServerInfo();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Kie Server info",
      "result": {
        "kie-server-info": {
          "id": "default-kieserver",
          "version": "7.11.0.Final-redhat-00001",
          "name": "default-kieserver",
          "location": "http://localhost:8080/kie-server/services/rest/server",
          "capabilities": [
            "KieServer",
            "BRM",
            "BPM",
            "CaseMgmt",
            "BPM-UI",
            "BRP",
            "DMN",
            "Swagger"
          ],
          "messages": [
            {
              "severity": "INFO",
              "timestamp": {
                "java.util.Date": 1538502533321
              },
              "content": [
                "Server KieServerInfo{serverId='default-kieserver', version='7.11.0.Final-redhat-00001', name='default-kieserver', location='http://localhost:8080/kie-server/services/rest/server', capabilities=[KieServer, BRM, BPM, CaseMgmt, BPM-UI, BRP, DMN, Swagger], messages=null}started successfully at Tue Oct 02 13:48:53 EDT 2018"
              ]
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetServerStateCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns information about the current state and configurations of the KIE Server.</p>
</div>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-server-state" : { }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServerStateInfo serverStateInfo = kieServicesClient.getServerState();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Successfully loaded server state for server id default-kieserver",
      "result": {
        "kie-server-state-info": {
          "controller": [
            "http://localhost:8080/business-central/rest/controller"
          ],
          "config": {
            "config-items": [
              {
                "itemName": "org.kie.server.location",
                "itemValue": "http://localhost:8080/kie-server/services/rest/server",
                "itemType": "java.lang.String"
              },
              {
                "itemName": "org.kie.server.controller.user",
                "itemValue": "controllerUser",
                "itemType": "java.lang.String"
              },
              {
                "itemName": "org.kie.server.controller",
                "itemValue": "http://localhost:8080/business-central/rest/controller",
                "itemType": "java.lang.String"
              }
            ]
          },
          "containers": [
            {
              "container-id": "employee-rostering",
              "release-id": {
                "group-id": "employeerostering",
                "artifact-id": "employeerostering",
                "version": "1.0.0-SNAPSHOT"
              },
              "resolved-release-id": null,
              "status": "STARTED",
              "scanner": {
                "status": "STOPPED",
                "poll-interval": null
              },
              "config-items": [
                {
                  "itemName": "KBase",
                  "itemValue": "",
                  "itemType": "BPM"
                },
                {
                  "itemName": "KSession",
                  "itemValue": "",
                  "itemType": "BPM"
                },
                {
                  "itemName": "MergeMode",
                  "itemValue": "MERGE_COLLECTIONS",
                  "itemType": "BPM"
                },
                {
                  "itemName": "RuntimeStrategy",
                  "itemValue": "SINGLETON",
                  "itemType": "BPM"
                }
              ],
              "messages": [],
              "container-alias": "employeerostering"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">CreateContainerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Creates a KIE container in the KIE Server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 84. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map containing the <code>container-id</code>, <code>release-id</code> data (group ID, artifact ID, version), <code>status</code>, and any other components of the new KIE container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "create-container" : {
      "container" : {
        "status" : null,
        "messages" : [ ],
        "container-id" : "command-script-container",
        "release-id" : {
          "version" : "1.0",
          "group-id" : "com.redhat",
          "artifact-id" : "Project1"
        },
        "config-items" : [ ]
      }
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;KieContainerResource&gt; response = kieServicesClient.createContainer("command-script-container", resource);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully deployed with module com.redhat:Project1:1.0.",
      "result": {
        "kie-container": {
          "container-id": "command-script-container",
          "release-id": {
            "version" : "1.0",
            "group-id" : "com.redhat",
            "artifact-id" : "Project1"
          },
          "resolved-release-id": {
            "version" : "1.0",
            "group-id" : "com.redhat",
            "artifact-id" : "Project1"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [],
          "messages": [
            {
              "severity": "INFO",
              "timestamp": {
                "java.util.Date": 1538762455510
              },
              "content": [
                "Container command-script-container successfully created with module com.redhat:Project1:1.0."
              ]
            }
          ],
          "container-alias": null
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetContainerInfoCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns information about a specified KIE container in KIE Server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 85. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the KIE container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-container-info" : {
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;KieContainerResource&gt; response = kieServicesClient.getContainerInfo("command-script-container");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Info for container command-script-container",
      "result": {
        "kie-container": {
          "container-id": "command-script-container",
          "release-id": {
            "group-id": "com.redhat",
            "artifact-id": "Project1",
            "version": "1.0"
          },
          "resolved-release-id": {
            "group-id": "com.redhat",
            "artifact-id": "Project1",
            "version": "1.0"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [

          ],
          "container-alias": null
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">ListContainersCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns a list of KIE containers that have been created in the KIE Server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 86. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie-container-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional map containing <code>release-id-filter</code>, <code>container-status-filter</code>, and any other KIE container properties by which you want to filter results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "list-containers" : {
      "kie-container-filter" : {
        "release-id-filter" : { },
        "container-status-filter" : {
          "accepted-status" : ["FAILED"]
        }
      }
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainerResourceFilter filter = new KieContainerResourceFilter.Builder()
        .status(KieContainerStatus.FAILED)
        .build();

KieContainerResourceList containersList = kieServicesClient.listContainers(filter);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "List of created containers",
      "result": {
        "kie-containers": {
          "kie-container": [
            {
              "container-id": "command-script-container",
              "release-id": {
                "group-id": "com.redhat",
                "artifact-id": "Project1",
                "version": "1.0"
              },
              "resolved-release-id": {
                "group-id": "com.redhat",
                "artifact-id": "Project1",
                "version": "1.0"
              },
              "status": "STARTED",
              "scanner": {
                "status": "STARTED",
                "poll-interval": 5000
              },
              "config-items": [
                {
                  "itemName": "RuntimeStrategy",
                  "itemValue": "SINGLETON",
                  "itemType": "java.lang.String"
                },
                {
                  "itemName": "MergeMode",
                  "itemValue": "MERGE_COLLECTIONS",
                  "itemType": "java.lang.String"
                },
                {
                  "itemName": "KBase",
                  "itemValue": "",
                  "itemType": "java.lang.String"
                },
                {
                  "itemName": "KSession",
                  "itemValue": "",
                  "itemType": "java.lang.String"
                }
              ],
              "messages": [
                {
                  "severity": "INFO",
                  "timestamp": {
                    "java.util.Date": 1538504619749
                  },
                  "content": [
                    "Container command-script-container successfully created with module com.redhat:Project1:1.0."
                  ]
                }
              ],
              "container-alias": null
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">CallContainerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Calls a KIE container and executes one or more runtime commands. For information about Drools runtime commands, see <a href="#runtime-commands-con_kie-apis">Runtime commands in Drools</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 87. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the KIE container to be called</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more commands in a <code>BatchExecutionCommand</code> wrapper to be executed on the KIE container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "call-container" : {
      "payload" : "{\n  \"lookup\" : \"defaultKieSession\",\n  \"commands\" : [ {\n    \"fire-all-rules\" : {\n      \"max\" : -1,\n      \"out-identifier\" : null\n    }\n  } ]\n}",
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Command&lt;?&gt;&gt; commands = new ArrayList&lt;Command&lt;?&gt;&gt;();
      BatchExecutionCommand batchExecution1 = commandsFactory.newBatchExecution(commands, "defaultKieSession");
      commands.add(commandsFactory.newFireAllRules());

      ServiceResponse&lt;ExecutionResults&gt; response1 = ruleClient.executeCommandsWithResults("command-script-container", batchExecution1);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": "{\n  \"results\" : [ ],\n  \"facts\" : [ ]\n}"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">DisposeContainerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Disposes a specified KIE container in the KIE Server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 88. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the KIE container to be disposed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "dispose-container" : {
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;Void&gt; response = kieServicesClient.disposeContainer("command-script-container");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully disposed.",
      "result": null
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetScannerInfoCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns information about the KIE scanner used for automatic updates in a specified KIE container, if applicable.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 89. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the KIE container where the KIE scanner is used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-scanner-info" : {
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;KieScannerResource&gt; response = kieServicesClient.getScannerInfo("command-script-container");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Scanner info successfully retrieved",
      "result": {
        "kie-scanner": {
          "status": "DISPOSED",
          "poll-interval": null
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">UpdateScannerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Starts or stops a KIE scanner that controls polling for updated KIE container deployments.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Avoid using a KIE scanner with business processes. Using a KIE scanner with processes can lead to unforeseen updates that can then cause errors in long-running processes when changes are not compatible with running process instances.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 90. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the KIE container where the KIE scanner is used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status to be set on the KIE scanner (<code>STARTED</code>, <code>STOPPED</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>poll-interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permitted polling duration in milliseconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required only when starting scanner</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "update-scanner" : {
      "scanner" : {
        "status" : "STARTED",
        "poll-interval" : 10000
      },
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieScannerResource scannerResource = new KieScannerResource();
scannerResource.setPollInterval(10000);
scannerResource.setStatus(KieScannerStatus. STARTED);

ServiceResponse&lt;KieScannerResource&gt; response = kieServicesClient.updateScanner("command-script-container", scannerResource);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Kie scanner successfully created.",
      "result": {
        "kie-scanner": {
          "status": "STARTED",
          "poll-interval": 10000
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">UpdateReleaseIdCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Updates the release ID data (group ID, artifact ID, version) for a specified KIE container.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 91. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the KIE container to be updated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>releaseId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updated GAV (group ID, artifact ID, version) data to be applied to the KIE container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example REST request body (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "update-release-id" : {
      "releaseId" : {
        "version" : "1.1",
        "group-id" : "com.redhat",
        "artifact-id" : "Project1"
      },
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java client method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;ReleaseId&gt; response = kieServicesClient.updateReleaseId("command-script-container", "com.redhat:Project1:1.1");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Release id successfully updated",
      "result": {
        "release-id": {
          "group-id": "com.redhat",
          "artifact-id": "Project1",
          "version": "1.1"
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="runtime-commands-con_kie-apis"><a class="anchor" href="#runtime-commands-con_kie-apis"></a><a class="link" href="#runtime-commands-con_kie-apis">19.11. Runtime commands in Drools</a></h3>
<div class="paragraph">
<p>Drools supports runtime commands that you can send to KIE Server for asset-related operations, such as executing all rules or inserting or retracting objects in a KIE session. The full list of supported runtime commands is located in the <code>org.drools.core.command.runtime</code> package in your Drools instance.</p>
</div>
<div class="paragraph">
<p>In the KIE Server REST API, you use the global <code>org.drools.core.command.runtime</code> commands or the rule-specific <code>org.drools.core.command.runtime.rule</code> commands as the request body for <code>POST</code> requests to <code>http://SERVER:PORT/kie-server/services/rest/server/containers/instances/{containerId}</code>. For more information about using the KIE Server REST API, see <a href="#kie-server-rest-api-con_kie-apis">KIE Server REST API for KIE containers and business assets</a>.</p>
</div>
<div class="paragraph">
<p>In the KIE Server Java client API, you can embed these commands in your Java application along with the relevant Java client. For example, for rule-related commands, you use the <code>RuleServicesClient</code> Java client with the embedded commands. For more information about using the KIE Server Java client API, see <a href="#kie-server-java-api-con_kie-apis">KIE Server Java client API for KIE containers and business assets</a>.</p>
</div>
<div class="sect3">
<h4 id="runtime-commands-samples-ref_kie-apis"><a class="anchor" href="#runtime-commands-samples-ref_kie-apis"></a><a class="link" href="#runtime-commands-samples-ref_kie-apis">19.11.1. Sample runtime commands in Drools</a></h4>
<div class="paragraph">
<p>The following are sample runtime commands that you can use with the KIE Server REST API or Java client API for asset-related operations in KIE Server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BatchExecutionCommand</code></p>
</li>
<li>
<p><code>InsertObjectCommand</code></p>
</li>
<li>
<p><code>RetractCommand</code></p>
</li>
<li>
<p><code>ModifyCommand</code></p>
</li>
<li>
<p><code>GetObjectCommand</code></p>
</li>
<li>
<p><code>GetObjectsCommand</code></p>
</li>
<li>
<p><code>InsertElementsCommand</code></p>
</li>
<li>
<p><code>FireAllRulesCommand</code></p>
</li>
<li>
<p><code>QueryCommand</code></p>
</li>
<li>
<p><code>SetGlobalCommand</code></p>
</li>
<li>
<p><code>GetGlobalCommand</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the full list of supported runtime commands, see the <code>org.drools.core.command.runtime</code> package in your Drools instance.</p>
</div>
<div class="paragraph">
<p>Each command in this section includes a REST request body example (JSON) for the KIE Server REST API and an embedded Java command example for the KIE Server Java client API. The Java examples use an object <code>org.drools.compiler.test.Person</code> with the fields <code>name</code> (String) and <code>age</code> (Integer).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">BatchExecutionCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Contains multiple commands to be executed together.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 92. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commands</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of commands to be executed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the KIE session ID on which the commands will be executed. For stateless KIE sessions, this attribute is required. For stateful KIE sessions, this attribute is optional and if not specified, the default KIE session is used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required for stateless KIE session, optional for stateful KIE session</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
KIE session IDs are in the <code>kmodule.xml</code> file of your Drools project. To view or add a KIE session ID in Business Central to use with the <code>lookup</code> command attribute, navigate to the relevant project in Business Central and go to project <strong>Settings</strong> &#8594; <strong>KIE bases</strong> &#8594; <strong>KIE sessions</strong>. If no KIE bases exist, click <strong>Add KIE base</strong> &#8594; <strong>KIE sessions</strong> to define the new KIE base and KIE sessions.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "lookup": "ksession1",
  "commands": [ {
      "insert": {
        "object": {
          "org.drools.compiler.test.Person": {
            "name": "john",
            "age": 25
          }
        }
      }
    },
    {
      "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");

InsertObjectCommand insertObjectCommand = new InsertObjectCommand(new Person("john", 25));
FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();

command.getCommands().add(insertObjectCommand);
command.getCommands().add(fireAllRulesCommand);

ksession.execute(command);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Inserts an object into the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 93. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The object to be inserted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the <code>FactHandle</code> created from the object insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to determine whether the object must be returned in the execution results (default: <code>true</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entry point for the insertion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "insert": {
        "entry-point": "my stream",
        "object": {
          "org.drools.compiler.test.Person": {
            "age": 25,
            "name": "john"
          }
        },
        "out-identifier": "john",
        "return-object": false
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Command insertObjectCommand =
  CommandFactory.newInsert(new Person("john", 25), "john", false, null);

ksession.execute(insertObjectCommand);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">RetractCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retracts an object from the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 94. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>FactHandle</code> associated with the object to be retracted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "retract": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command: Use <code>FactHandleFromString</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand();
retractCommand.setFactHandleFromString("123:234:345:456:567");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command: Use <code>FactHandle</code> from inserted object</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand(factHandle);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">ModifyCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Modifies a previously inserted object in the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 95. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>FactHandle</code> associated with the object to be modified</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of setters for object modifications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "modify": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "setters": {
          "accessor": "age",
          "value": 25
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ModifyCommand modifyCommand = new ModifyCommand(factHandle);

List&lt;Setter&gt; setters = new ArrayList&lt;Setter&gt;();
setters.add(new SetterImpl("age", "25"));

modifyCommand.setSetters(setters);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retrieves an object from a KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 96. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>FactHandle</code> associated with the object to be retrieved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the <code>FactHandle</code> created from the object insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-object": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "out-identifier": "john"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectCommand getObjectCommand = new GetObjectCommand();
getObjectCommand.setFactHandleFromString("123:234:345:456:567");
getObjectCommand.setOutIdentifier("john");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "john"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retrieves all objects from the KIE session as a collection.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 97. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filter for the objects returned from the KIE session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifier to be used in the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-objects": {
        "out-identifier": "objects"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectsCommand getObjectsCommand = new GetObjectsCommand();
getObjectsCommand.setOutIdentifier("objects");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": [
                {
                  "org.apache.xerces.dom.ElementNSImpl": "&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;\n&lt;object xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"person\"&gt;&lt;age&gt;25&lt;/age&gt;&lt;name&gt;john&lt;/name&gt;\n &lt;\/object&gt;"
                },
                {
                  "org.drools.compiler.test.Person": {
                    "name": "john",
                    "age": 25
                  }
                }
              ],
              "key": "objects"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertElementsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Inserts a list of objects into the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 98. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>objects</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of objects to be inserted into the KIE session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the <code>FactHandle</code> created from the object insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to determine whether the object must be returned in the execution results. Default value: <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entry point for the insertion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
    "insert-elements": {
        "objects": [
            {
                "containedObject": {
                    "@class": "org.drools.compiler.test.Person",
                    "age": 25,
                    "name": "john"
                }
            },
            {
                "containedObject": {
                    "@class": "Person",
                    "age": 35,
                    "name": "sarah"
                }
            }
        ]
    }
  }
]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Object&gt; objects = new ArrayList&lt;Object&gt;();
objects.add(new Person("john", 25));
objects.add(new Person("sarah", 35));

Command insertElementsCommand = CommandFactory.newInsertElements(objects);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            },
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720266:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "sarah"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">FireAllRulesCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Executes all rules in the KIE session.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 99. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of rules to be executed. The default is <code>-1</code> and does not put any restriction on execution.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID to be used for retrieving the number of fired rules in execution results.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agenda-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Agenda Filter to be used for rule execution.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();
fireAllRulesCommand.setMax(10);
fireAllRulesCommand.setOutIdentifier("firedActivations");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">QueryCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Executes a query defined in the KIE base.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 100. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the query results. The query results are added in the execution results with this identifier.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>arguments</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of objects to be passed as a query parameter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "query": {
        "name": "persons",
        "arguments": [],
        "out-identifier": "persons"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryCommand queryCommand = new QueryCommand();
queryCommand.setName("persons");
queryCommand.setOutIdentifier("persons");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.drools.core.runtime.rule.impl.FlatQueryResults": {
              "idFactHandleMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.drools.core.common.DisconnectedFactHandle": {
                            "id": 1,
                            "identityHashCode": 1809949690,
                            "objectHashCode": 1809949690,
                            "recency": 1,
                            "object": {
                              "org.kie.server.testing.Person": {
                                "fullname": "John Doe",
                                "age": 47
                              }
                            },
                            "entryPointId": "DEFAULT",
                            "traitType": "NON_TRAIT",
                            "external-form": "0:1:1809949690:1809949690:1:DEFAULT:NON_TRAIT:org.kie.server.testing.Person"
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "idResultMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.kie.server.testing.Person": {
                            "fullname": "John Doe",
                            "age": 47
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "identifiers": {
                "type": "SET",
                "componentType": null,
                "element": [
                  "$person"
                ]
              }
            }
          },
          "key": "persons"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">SetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Sets an object to a global state.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 101. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the global variable defined in the KIE base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object to be set into the global variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to exclude the global variable you set from the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the global execution result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "set-global": {
        "identifier": "helper",
        "object": {
          "org.kie.server.testing.Person": {
            "fullname": "kyle",
            "age": 30
          }
        },
        "out-identifier": "output"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SetGlobalCommand setGlobalCommand = new SetGlobalCommand();
setGlobalCommand.setIdentifier("helper");
setGlobalCommand.setObject(new Person("kyle", 30));
setGlobalCommand.setOut(true);
setGlobalCommand.setOutIdentifier("output");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.kie.server.testing.Person": {
              "fullname": "kyle",
              "age": 30
            }
          },
          "key": "output"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Retrieves a previously defined global object.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 102. Command attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 50%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the global variable defined in the KIE base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID to be used in the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example JSON request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-global": {
        "identifier": "helper",
        "out-identifier": "helperOutput"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetGlobalCommand getGlobalCommand = new GetGlobalCommand();
getGlobalCommand.setIdentifier("helper");
getGlobalCommand.setOutIdentifier("helperOutput");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "helperOutput"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controller-rest-api-con_kie-apis"><a class="anchor" href="#controller-rest-api-con_kie-apis"></a><a class="link" href="#controller-rest-api-con_kie-apis">19.12. Drools controller REST API for KIE Server templates and instances</a></h3>
<div class="paragraph">
<p>Drools provides a Drools controller REST API that you can use to interact with your KIE Server templates (configurations), KIE Server instances (remote servers), and associated KIE containers (deployment units) in Drools without using the Business Central user interface. This API support enables you to maintain your Drools servers and resources more efficiently and optimize your integration and development with Drools.</p>
</div>
<div class="paragraph">
<p>With the Drools controller REST API, you can perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve information about KIE Server templates, instances, and associated KIE containers</p>
</li>
<li>
<p>Update, start, or stop KIE containers associated with KIE Server templates and instances</p>
</li>
<li>
<p>Create, update, or delete KIE Server templates</p>
</li>
<li>
<p>Create, update, or delete KIE Server instances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Requests to the Drools controller REST API require the following components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Authentication</dt>
<dd>
<p>The Drools controller REST API requires HTTP Basic authentication or token-based authentication for the following user roles, depending on controller type:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>rest-all</code> user role if you installed Business Central and you want to use the built-in Drools controller</p>
</li>
<li>
<p><code>kie-server</code> user role if you installed the headless Drools controller separately from Business Central</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To view configured user roles for your Drools distribution, navigate to <code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code> and <code>~/application-users.properties</code>.</p>
</div>
<div class="paragraph">
<p>To add a user with the <code>kie-server</code> role or the <code>rest-all</code> role or both, navigate to <code>~/$SERVER_HOME/bin</code> and run the following command with the role or roles specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server,rest-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure the <code>kie-server</code> or <code>rest-all</code> user with Drools controller access, navigate to <code>~/$SERVER_HOME/standalone/configuration/standalone-full.xml</code>, uncomment the <code>org.kie.server</code> properties (if applicable), and add the controller user login credentials and controller location (if needed):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;property name="org.kie.server.location" value="http://localhost:8080/kie-server/services/rest/server"/&gt;
&lt;property name="org.kie.server.controller" value="http://localhost:8080/business-central/rest/controller"/&gt;
&lt;property name="org.kie.server.controller.user" value="baAdmin"/&gt;
&lt;property name="org.kie.server.controller.pwd" value="password@1"/&gt;
&lt;property name="org.kie.server.id" value="default-kieserver"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about user roles and Drools installation options, see
<a href="#_installing_the_kie_server">Installing the KIE Server</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">HTTP headers</dt>
<dd>
<p>The Drools controller REST API requires the following HTTP headers for API requests:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: Data format accepted by your requesting client:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> (JSON)</p>
</li>
<li>
<p><code>application/xml</code> (XML, for JAXB)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Content-Type</code>: Data format of your <code>POST</code> or <code>PUT</code> API request data:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> (JSON)</p>
</li>
<li>
<p><code>application/xml</code> (XML, for JAXB)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP methods</dt>
<dd>
<p>The Drools controller REST API supports the following HTTP methods for API requests:</p>
<div class="ulist">
<ul>
<li>
<p><code>GET</code>: Retrieves specified information from a specified resource endpoint</p>
</li>
<li>
<p><code>POST</code>: Updates a resource or resource instance</p>
</li>
<li>
<p><code>PUT</code>: Creates a resource or resource instance</p>
</li>
<li>
<p><code>DELETE</code>: Deletes a resource or resource instance</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Base URL</dt>
<dd>
<p>The base URL for Drools controller REST API requests is <code>http://SERVER:PORT/CONTROLLER/rest/</code>, such as  <code>http://localhost:8080/business-central/rest/</code> if you are using the Drools controller built in to Business Central.</p>
</dd>
<dt class="hdlist1">Endpoints</dt>
<dd>
<p>Drools controller REST API endpoints, such as <code>/controller/management/servers/{serverTemplateId}</code> for a specified KIE Server template, are the URIs that you append to the Drools controller REST API base URL to access the corresponding server resource or type of server resource in Drools.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">Example request URL for <code>/controller/management/servers/{serverTemplateId}</code> endpoint</div>
<p><code>http://localhost:8080/business-central/rest/controller/management/servers/default-kieserver</code></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Request parameters and request data</dt>
<dd>
<p>Some Drools controller REST API requests require specific parameters in the request URL path to identify or filter specific resources and to perform specific actions. You can append URL parameters to the endpoint in the format <code>?&lt;PARAM&gt;=&lt;VALUE&gt;&amp;&lt;PARAM&gt;=&lt;VALUE&gt;</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">Example DELETE request URL with parameters</div>
<p><code>http://localhost:8080/business-central/rest/controller/server/new-kieserver-instance?location=http://localhost:8080/kie-server/services/rest/server</code></p>
</div>
<div class="paragraph">
<p>HTTP <code>POST</code> and <code>PUT</code> requests may additionally require a request body or file with data to accompany the request.</p>
</div>
<div class="paragraph">
<div class="title">Example PUT request URL and JSON request body data</div>
<p><code>http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-id": "new-kieserver",
  "server-name": "new-kieserver",
  "container-specs": [],
  "server-config": {},
  "capabilities": [
    "RULE",
    "PROCESS",
    "PLANNING"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="controller-rest-api-requests-proc_kie-apis"><a class="anchor" href="#controller-rest-api-requests-proc_kie-apis"></a><a class="link" href="#controller-rest-api-requests-proc_kie-apis">19.12.1. Sending requests with the Drools controller REST API using a REST client or curl utility</a></h4>
<div class="paragraph">
<p>The Drools controller REST API enables you to interact with your KIE Server templates (configurations), KIE Server instances (remote servers), and associated KIE containers (deployment units) in Drools without using the Business Central user interface. You can send Drools controller REST API requests using any REST client or curl utility.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and running.</p>
</li>
<li>
<p>The Drools controller or headless Drools controller is installed and running.</p>
</li>
<li>
<p>You have <code>rest-all</code> user role access to the Drools controller if you installed Business Central, or <code>kie-server</code> user role access to the headless Drools controller installed separately from Business Central.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the relevant <a href="#controller-rest-api-endpoints-ref_kie-apis">API endpoint</a> to which you want to send a request, such as <code>[GET] /controller/management/servers</code> to retrieve KIE Server templates from the Drools controller.</p>
</li>
<li>
<p>In a REST client or curl utility, enter the following components for a <code>GET</code> request to <code>controller/management/servers</code>. Adjust any request details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For REST client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Enter the user name and password of the Drools controller user with the <code>rest-all</code> role or the headless Drools controller user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><strong>HTTP Headers</strong>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP method</strong>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Drools controller REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/controller/management/servers</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For curl utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code>: Enter the user name and password of the Drools controller user with the <code>rest-all</code> role or the headless Drools controller user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><code>-H</code>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Drools controller REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/controller/management/servers</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/business-central/rest/controller/management/servers"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the request and review the Drools controller response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-template": [
    {
      "server-id": "default-kieserver",
      "server-name": "default-kieserver",
      "container-specs": [
        {
          "container-id": "employeerostering_1.0.0-SNAPSHOT",
          "container-name": "employeerostering",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "employeerostering",
            "artifact-id": "employeerostering",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "SINGLETON",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        },
        {
          "container-id": "mortgage-process_1.0.0-SNAPSHOT",
          "container-name": "mortgage-process",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "mortgage-process",
            "artifact-id": "mortgage-process",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "PER_PROCESS_INSTANCE",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        }
      ],
      "server-config": {},
      "server-instances": [
        {
          "server-instance-id": "default-kieserver-instance@localhost:8080",
          "server-name": "default-kieserver-instance@localhost:8080",
          "server-template-id": "default-kieserver",
          "server-url": "http://localhost:8080/kie-server/services/rest/server"
        }
      ],
      "capabilities": [
        "RULE",
        "PROCESS",
        "PLANNING"
      ]
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In your REST client or curl utility, send another API request with the following components for a <code>PUT</code> request to <code>/controller/management/servers/{serverTemplateId}</code> to create a new KIE Server template. Adjust any request details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For REST client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Enter the user name and password of the Drools controller user with the <code>rest-all</code> role or the headless Drools controller user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><strong>HTTP Headers</strong>: Set the following headers:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: <code>application/json</code></p>
</li>
<li>
<p><code>Content-Type</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP method</strong>: Set to <code>PUT</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Drools controller REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver</code>.</p>
</li>
<li>
<p><strong>Request body</strong>: Add a JSON request body with the configurations for the new KIE Server template:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-id": "new-kieserver",
  "server-name": "new-kieserver",
  "container-specs": [],
  "server-config": {},
  "capabilities": [
    "RULE",
    "PROCESS",
    "PLANNING"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For curl utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code>: Enter the user name and password of the Drools controller user with the <code>rest-all</code> role or the headless Drools controller user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><code>-H</code>: Set the following headers:</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code>: <code>application/json</code></p>
</li>
<li>
<p><code>content-type</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code>: Set to <code>PUT</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the Drools controller REST API base URL and endpoint, such as <code>http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver</code>.</p>
</li>
<li>
<p><code>-d</code>: Add a JSON request body or file (<code>@file.json</code>) with the configurations for the new KIE Server template:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver" -d "{ \"server-id\": \"new-kieserver\", \"server-name\": \"new-kieserver\", \"container-specs\": [], \"server-config\": {}, \"capabilities\": [ \"RULE\", \"PROCESS\", \"PLANNING\" ]}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver" -d @my-server-template-configs.json</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the request and confirm the successful Drools controller response.</p>
<div class="paragraph">
<p>If you encounter request errors, review the returned error code messages and adjust your request accordingly.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="controller-rest-api-requests-swagger-proc_kie-apis"><a class="anchor" href="#controller-rest-api-requests-swagger-proc_kie-apis"></a><a class="link" href="#controller-rest-api-requests-swagger-proc_kie-apis">19.12.2. Sending requests with the Drools controller REST API using the Swagger interface</a></h4>
<div class="paragraph">
<p>The Drools controller REST API supports a Swagger web interface that you can use instead of a standalone REST client or curl utility to interact with your KIE Server templates, instances, and associated KIE containers in Drools without using the Business Central user interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the Swagger web interface for the Drools controller is enabled by the <code>org.kie.workbench.swagger.disabled=false</code> system property. To disable the Swagger web interface for the Drools controller, set this system property to <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Drools controller is installed and running.</p>
</li>
<li>
<p>You have <code>rest-all</code> user role access to the Drools controller if you installed Business Central, or <code>kie-server</code> user role access to the headless Drools controller installed separately from Business Central.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a web browser, navigate to <code>http://SERVER:PORT/CONTROLLER/docs</code>, such as <code>http://localhost:8080/business-central/docs</code>, and log in with the user name and password of the Drools controller user with the <code>rest-all</code> role or the headless Drools controller user with the <code>kie-server</code> role.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using the Drools controller built in to Business Central, the Swagger page associated with the Drools controller is identified as the "Business Central API" for Business Central REST services. If you are using the headless Drools controller without Business Central, the Swagger page associated with the headless Drools controller is identified as the "Controller API". In both cases, the Drools controller REST API endpoints are the same.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the Swagger page, select the relevant API endpoint to which you want to send a request, such as <strong>Controller :: KIE Server templates and KIE containers</strong> &#8594; <strong>[GET] /controller/management/servers</strong> to retrieve KIE Server templates from the Drools controller.</p>
</li>
<li>
<p>Click <strong>Try it out</strong> and provide any optional parameters by which you want to filter results, if applicable.</p>
</li>
<li>
<p>In the <strong>Response content type</strong> drop-down menu, select the desired format of the server response, such as <strong>application/json</strong> for JSON format.</p>
</li>
<li>
<p>Click <strong>Execute</strong> and review the KIE Server response.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Example server response (JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-template": [
    {
      "server-id": "default-kieserver",
      "server-name": "default-kieserver",
      "container-specs": [
        {
          "container-id": "employeerostering_1.0.0-SNAPSHOT",
          "container-name": "employeerostering",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "employeerostering",
            "artifact-id": "employeerostering",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "SINGLETON",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        },
        {
          "container-id": "mortgage-process_1.0.0-SNAPSHOT",
          "container-name": "mortgage-process",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "mortgage-process",
            "artifact-id": "mortgage-process",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "PER_PROCESS_INSTANCE",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        }
      ],
      "server-config": {},
      "server-instances": [
        {
          "server-instance-id": "default-kieserver-instance@localhost:8080",
          "server-name": "default-kieserver-instance@localhost:8080",
          "server-template-id": "default-kieserver",
          "server-url": "http://localhost:8080/kie-server/services/rest/server"
        }
      ],
      "capabilities": [
        "RULE",
        "PROCESS",
        "PLANNING"
      ]
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In the Swagger page, navigate to the <strong>Controller :: KIE Server templates and KIE containers</strong> &#8594; <strong>[GET] /controller/management/servers/{serverTemplateId}</strong> endpoint to send another request to create a new KIE Server template. Adjust any request details according to your use case.</p>
</li>
<li>
<p>Click <strong>Try it out</strong> and enter the following components for the request:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>serverTemplateId</strong>: Enter the ID of the new KIE Server template, such as <code>new-kieserver</code>.</p>
</li>
<li>
<p><strong>body</strong>: Set the <strong>Parameter content type</strong> to the desired request body format, such as <strong>application/json</strong> for JSON format, and add a request body with the configurations for the new KIE Server template:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-id": "new-kieserver",
  "server-name": "new-kieserver",
  "container-specs": [],
  "server-config": {},
  "capabilities": [
    "RULE",
    "PROCESS",
    "PLANNING"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In the <strong>Response content type</strong> drop-down menu, select the desired format of the server response, such as <strong>application/json</strong> for JSON format.</p>
</li>
<li>
<p>Click <strong>Execute</strong> and confirm the successful Drools controller response.</p>
<div class="paragraph">
<p>If you encounter request errors, review the returned error code messages and adjust your request accordingly.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="controller-rest-api-endpoints-ref_kie-apis"><a class="anchor" href="#controller-rest-api-endpoints-ref_kie-apis"></a><a class="link" href="#controller-rest-api-endpoints-ref_kie-apis">19.12.3. Supported Drools controller REST API endpoints</a></h4>
<div class="paragraph">
<p>The Drools controller REST API provides endpoints for interacting with KIE Server templates (configurations), KIE Server instances (remote servers), and associated KIE containers (deployment units). The Drools controller REST API base URL is <code>http://SERVER:PORT/CONTROLLER/rest/</code>. All requests require HTTP Basic authentication or token-based authentication for the <code>rest-all</code> user role if you installed Business Central and you want to use the built-in Drools controller, or the <code>kie-server</code> user role if you installed the headless Drools controller separately from Business Central.</p>
</div>
<div class="paragraph">
<p>For the full list of Drools controller REST API endpoints and descriptions, use one of the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://jbpm.org/learn/documentation.html">Controller REST API</a> on the jBPM Documentation page (static)</p>
</li>
<li>
<p>Swagger UI for the Drools controller REST API at <code>http://SERVER:PORT/CONTROLLER/docs</code> (dynamic, requires running Drools controller)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the Swagger web interface for the Drools controller is enabled by the <code>org.kie.workbench.swagger.disabled=false</code> system property. To disable the Swagger web interface for the Drools controller, set this system property to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>If you are using the Drools controller built in to Business Central, the Swagger page associated with the Drools controller is identified as the "Business Central API" for Business Central REST services. If you are using the headless Drools controller without Business Central, the Swagger page associated with the headless Drools controller is identified as the "Controller API". In both cases, the Drools controller REST API endpoints are the same.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controller-java-api-con_kie-apis"><a class="anchor" href="#controller-java-api-con_kie-apis"></a><a class="link" href="#controller-java-api-con_kie-apis">19.13. Drools controller Java client API for KIE Server templates and instances</a></h3>
<div class="paragraph">
<p>Drools provides a Drools controller Java client API that enables you to connect to the Drools controller using REST or WebSocket protocol from your Java client application. You can use the Drools controller Java client API as an alternative to the Drools controller REST API to interact with your KIE Server templates (configurations), KIE Server instances (remote servers), and associated KIE containers (deployment units) in Drools without using the Business Central user interface. This API support enables you to maintain your Drools servers and resources more efficiently and optimize your integration and development with Drools.</p>
</div>
<div class="paragraph">
<p>With the Drools controller Java client API, you can perform the following actions also supported by the Drools controller REST API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve information about KIE Server templates, instances, and associated KIE containers</p>
</li>
<li>
<p>Update, start, or stop KIE containers associated with KIE Server templates and instances</p>
</li>
<li>
<p>Create, update, or delete KIE Server templates</p>
</li>
<li>
<p>Create, update, or delete KIE Server instances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools controller Java client API requests require the following components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Authentication</dt>
<dd>
<p>The Drools controller Java client API requires HTTP Basic authentication for the following user roles, depending on controller type:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>rest-all</code> user role if you installed Business Central and you want to use the built-in Drools controller</p>
</li>
<li>
<p><code>kie-server</code> user role if you installed the headless Drools controller separately from Business Central</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To view configured user roles for your Drools distribution, navigate to <code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code> and <code>~/application-users.properties</code>.</p>
</div>
<div class="paragraph">
<p>To add a user with the <code>kie-server</code> role or the <code>rest-all</code> role or both, navigate to <code>~/$SERVER_HOME/bin</code> and run the following command with the role or roles specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server,rest-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure the <code>kie-server</code> or <code>rest-all</code> user with Drools controller access, navigate to <code>~/$SERVER_HOME/standalone/configuration/standalone-full.xml</code>, uncomment the <code>org.kie.server</code> properties (if applicable), and add the controller user login credentials and controller location (if needed):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;property name="org.kie.server.location" value="http://localhost:8080/kie-server/services/rest/server"/&gt;
&lt;property name="org.kie.server.controller" value="http://localhost:8080/business-central/rest/controller"/&gt;
&lt;property name="org.kie.server.controller.user" value="baAdmin"/&gt;
&lt;property name="org.kie.server.controller.pwd" value="password@1"/&gt;
&lt;property name="org.kie.server.id" value="default-kieserver"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about user roles and Drools installation options, see
<a href="#_installing_the_kie_server">Installing the KIE Server</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Project dependencies</dt>
<dd>
<p>The Drools controller Java client API requires the following dependencies on the relevant classpath of your Java project:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on controller --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-controller-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For REST client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
  &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
  &lt;version&gt;${resteasy.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For WebSocket client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.undertow&lt;/groupId&gt;
  &lt;artifactId&gt;undertow-websockets-jsr&lt;/artifactId&gt;
  &lt;version&gt;${undertow.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;version&gt;</code> for Drools dependencies is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005).</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Client request configuration</dt>
<dd>
<p>All Java client requests with the Drools controller Java client API must define at least the following controller communication components:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Credentials of the <code>rest-all</code> user if you installed Business Central, or the <code>kie-server</code> user if you installed the headless Drools controller separately from Business Central</p>
</li>
<li>
<p>Drools controller location for REST or WebSocket protocol:</p>
<div class="ulist">
<ul>
<li>
<p>Example REST URL: <code>http://localhost:8080/business-central/rest/controller</code></p>
</li>
<li>
<p>Example WebSocket URL: <code>ws://localhost:8080/headless-controller/websocket/controller</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Marshalling format for API requests and responses (JSON or JAXB)</p>
</li>
<li>
<p>A <code>KieServerControllerClient</code> object, which serves as the entry point for starting the server communication using the Java client API</p>
</li>
<li>
<p>A <code>KieServerControllerClientFactory</code> defining REST or WebSocket protocol and user access</p>
</li>
<li>
<p>The Drools controller client service or services used, such as <code>listServerTemplates</code>, <code>getServerTemplate</code>, or <code>getServerInstances</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are examples of REST and WebSocket client configurations with these components:</p>
</div>
<div class="listingblock">
<div class="title">Client configuration example with REST</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class ListServerTemplatesExample {

    private static final String URL = "http://localhost:8080/business-central/rest/controller";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";

    private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD);

        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Client configuration example with WebSocket</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class ListServerTemplatesExample {

    private static final String URL = "ws://localhost:8080/my-controller/websocket/controller";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";

    private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newWebSocketClient(URL,
                                                                                               USER,
                                                                                               PASSWORD);

        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="controller-java-api-requests-proc_kie-apis"><a class="anchor" href="#controller-java-api-requests-proc_kie-apis"></a><a class="link" href="#controller-java-api-requests-proc_kie-apis">19.13.1. Sending requests with the Drools controller Java client API</a></h4>
<div class="paragraph">
<p>The Drools controller Java client API enables you to connect to the Drools controller using REST or WebSocket protocols from your Java client application. You can use the Drools controller Java client API as an alternative to the Drools controller REST API to interact with your KIE Server templates (configurations), KIE Server instances (remote servers), and associated KIE containers (deployment units) in Drools without using the Business Central user interface.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed and running.</p>
</li>
<li>
<p>The Drools controller or headless Drools controller is installed and running.</p>
</li>
<li>
<p>You have <code>rest-all</code> user role access to the Drools controller if you installed Business Central, or <code>kie-server</code> user role access to the headless Drools controller installed separately from Business Central.</p>
</li>
<li>
<p>You have a Java project with Drools resources.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your client application, ensure that the following dependencies have been added to the relevant classpath of your Java project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on controller --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-controller-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For REST client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
  &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
  &lt;version&gt;${resteasy.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For WebSocket client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.undertow&lt;/groupId&gt;
  &lt;artifactId&gt;undertow-websockets-jsr&lt;/artifactId&gt;
  &lt;version&gt;${undertow.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>~/kie/server/controller/client</code> folder
of the Java client API in <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-controller/kie-server-controller-client/src/main/java/org/kie/server/controller/client">GitHub</a>
, identify the relevant Java client implementation for the request you want to send, such as the <code>RestKieServerControllerClient</code> implementation to access client services for KIE Server templates and KIE containers in REST protocol.</p>
</li>
<li>
<p>In your client application, create a <code>.java</code> class for the API request. The class must contain the necessary imports, the Drools controller location and user credentials, a <code>KieServerControllerClient</code> object, and the client method to execute, such as <code>createServerTemplate</code> and <code>createContainer</code> from the <code>RestKieServerControllerClient</code> implementation. Adjust any configuration details according to your use case.</p>
<div class="listingblock">
<div class="title">Creating and interacting with a KIE Server template and KIE containers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.api.model.KieContainerStatus;
import org.kie.server.api.model.KieScannerStatus;
import org.kie.server.api.model.ReleaseId;
import org.kie.server.controller.api.model.spec.*;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class RestTemplateContainerExample {

  private static final String URL = "http://localhost:8080/business-central/rest/controller";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

    private static KieServerControllerClient client;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD,
                                                                                          MarshallingFormat.JSON);
        // Create server template and KIE container, start and stop KIE container, and delete server template
        ServerTemplate serverTemplate = createServerTemplate();
        ContainerSpec container = createContainer(serverTemplate);
        client.startContainer(container);
        client.stopContainer(container);
        client.deleteServerTemplate(serverTemplate.getId());
    }

    // Re-create and configure server template
    protected static ServerTemplate createServerTemplate() {
        ServerTemplate serverTemplate = new ServerTemplate();
        serverTemplate.setId("example-client-id");
        serverTemplate.setName("example-client-name");
        serverTemplate.setCapabilities(Arrays.asList(Capability.PROCESS.name(),
                                                     Capability.RULE.name(),
                                                     Capability.PLANNING.name()));

        client.saveServerTemplate(serverTemplate);

        return serverTemplate;
    }

    // Re-create and configure KIE containers
    protected static ContainerSpec createContainer(ServerTemplate serverTemplate){
        Map&lt;Capability, ContainerConfig&gt; containerConfigMap = new HashMap();

        ProcessConfig processConfig = new ProcessConfig("PER_PROCESS_INSTANCE", "kieBase", "kieSession", "MERGE_COLLECTION");
        containerConfigMap.put(Capability.PROCESS, processConfig);

        RuleConfig ruleConfig = new RuleConfig(500l, KieScannerStatus.SCANNING);
        containerConfigMap.put(Capability.RULE, ruleConfig);

        ReleaseId releaseId = new ReleaseId("org.kie.server.testing", "stateless-session-kjar", "1.0.0-SNAPSHOT");

        ContainerSpec containerSpec = new ContainerSpec("example-container-id", "example-client-name", serverTemplate, releaseId, KieContainerStatus.STOPPED, containerConfigMap);
        client.saveContainerSpec(serverTemplate.getId(), containerSpec);

        return containerSpec;
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Run the configured <code>.java</code> class from your project directory to execute the request, and review the Drools controller response.</p>
<div class="paragraph">
<p>If you enabled debug logging, KIE Server responds with a detailed response according to your configured marshalling format, such as JSON. If you encounter request errors, review the returned error code messages and adjust your Java configurations accordingly.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="controller-java-clients-ref_kie-apis"><a class="anchor" href="#controller-java-clients-ref_kie-apis"></a><a class="link" href="#controller-java-clients-ref_kie-apis">19.13.2. Supported Drools controller Java clients</a></h4>
<div class="paragraph">
<p>The following are some of the Java client services available in the <code>org.kie.server.controller.client</code> package of your Drools distribution. You can use these services to interact with related resources in the Drools controller similarly to the Drools controller REST API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KieServerControllerClient</code>: Used as the entry point for communicating with the Drools controller</p>
</li>
<li>
<p><code>RestKieServerControllerClient</code>: Implementation used to interact with KIE Server templates and KIE containers in REST protocol (found in <code>~/org/kie/server/controller/client/rest</code>)</p>
</li>
<li>
<p><code>WebSocketKieServerControllerClient</code>: Implementation used to interact with KIE Server templates and KIE containers in WebSocket protocol (found in <code>~/org/kie/server/controller/client/websocket</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the full list of available Drools controller Java clients,
see the Java client API source in <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-controller/kie-server-controller-client/src/main/java/org/kie/server/controller/client">GitHub</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="controller-java-api-examples-ref_kie-apis"><a class="anchor" href="#controller-java-api-examples-ref_kie-apis"></a><a class="link" href="#controller-java-api-examples-ref_kie-apis">19.13.3. Example requests with the Drools controller Java client API</a></h4>
<div class="paragraph">
<p>The following are examples of Drools controller Java client API requests for basic interactions with the Drools controller. For the full list of available Drools controller Java clients,
see the Java client API source in <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-controller/kie-server-controller-client/src/main/java/org/kie/server/controller/client">GitHub</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Creating and interacting with KIE Server templates and KIE containers</dt>
<dd>
<p>You can use the <code>ServerTemplate</code> and <code>ContainerSpec</code> services in the REST or WebSocket Drools controller clients to create, dispose, and update KIE Server templates and KIE containers, and to start and stop KIE containers, as illustrated in this example.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example request to create and interact with a KIE Server template and KIE containers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.api.model.KieContainerStatus;
import org.kie.server.api.model.KieScannerStatus;
import org.kie.server.api.model.ReleaseId;
import org.kie.server.controller.api.model.spec.*;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class RestTemplateContainerExample {

  private static final String URL = "http://localhost:8080/business-central/rest/controller";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

    private static KieServerControllerClient client;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD,
                                                                                          MarshallingFormat.JSON);
        // Create server template and KIE container, start and stop KIE container, and delete server template
        ServerTemplate serverTemplate = createServerTemplate();
        ContainerSpec container = createContainer(serverTemplate);
        client.startContainer(container);
        client.stopContainer(container);
        client.deleteServerTemplate(serverTemplate.getId());
    }

    // Re-create and configure server template
    protected static ServerTemplate createServerTemplate() {
        ServerTemplate serverTemplate = new ServerTemplate();
        serverTemplate.setId("example-client-id");
        serverTemplate.setName("example-client-name");
        serverTemplate.setCapabilities(Arrays.asList(Capability.PROCESS.name(),
                                                     Capability.RULE.name(),
                                                     Capability.PLANNING.name()));

        client.saveServerTemplate(serverTemplate);

        return serverTemplate;
    }

    // Re-create and configure KIE containers
    protected static ContainerSpec createContainer(ServerTemplate serverTemplate){
        Map&lt;Capability, ContainerConfig&gt; containerConfigMap = new HashMap();

        ProcessConfig processConfig = new ProcessConfig("PER_PROCESS_INSTANCE", "kieBase", "kieSession", "MERGE_COLLECTION");
        containerConfigMap.put(Capability.PROCESS, processConfig);

        RuleConfig ruleConfig = new RuleConfig(500l, KieScannerStatus.SCANNING);
        containerConfigMap.put(Capability.RULE, ruleConfig);

        ReleaseId releaseId = new ReleaseId("org.kie.server.testing", "stateless-session-kjar", "1.0.0-SNAPSHOT");

        ContainerSpec containerSpec = new ContainerSpec("example-container-id", "example-client-name", serverTemplate, releaseId, KieContainerStatus.STOPPED, containerConfigMap);
        client.saveContainerSpec(serverTemplate.getId(), containerSpec);

        return containerSpec;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Listing KIE Server templates and specifying connection timeout (REST)</dt>
<dd>
<p>When you use REST protocol for Drools controller Java client API requests, you can provide your own <code>javax.ws.rs.core.Configuration</code> specification to modify the underlying REST client API, such as connection timeout.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example REST request to return server templates and specify connection timeout</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.concurrent.TimeUnit;
import javax.ws.rs.core.Configuration;
import org.jboss.resteasy.client.jaxrs.ResteasyClientBuilder;

import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class RESTTimeoutExample {

  private static final String URL = "http://localhost:8080/business-central/rest/controller";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

  public static void main(String[] args) {

      // Specify connection timeout
      final Configuration configuration =
              new ResteasyClientBuilder()
                      .establishConnectionTimeout(10,
                                                    TimeUnit.SECONDS)
                      .socketTimeout(60,
                                       TimeUnit.SECONDS)
                        .getConfiguration();
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD,
                                                                                          MarshallingFormat.JSON,
                                                                                          configuration);

        // Retrieve list of server templates
        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Listing KIE Server templates and specifying event notifications (WebSocket)</dt>
<dd>
<p>When you use WebSocket protocol for Drools controller Java client API requests, you can enable event notifications based
on changes that happen in the particular Drools controller to which the client API is connected. For example, you can
receive notifications when KIE Server templates or instances are connected to or updated in the Drools controller.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example WebSocket request to return server templates and specify event notifications</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.events.*;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;
import org.kie.server.controller.client.event.EventHandler;

public class WebSocketEventsExample {

    private static final String URL = "ws://localhost:8080/my-controller/websocket/controller";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newWebSocketClient(URL,
                                                                                               USER,
                                                                                               PASSWORD,
                                                                                               MarshallingFormat.JSON,
                                                                                               new TestEventHandler());

        // Retrieve list of server templates
        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
        try {
            Thread.sleep(60 * 1000);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // Set up event notifications
    static class TestEventHandler implements EventHandler {

        @Override
        public void onServerInstanceConnected(ServerInstanceConnected serverInstanceConnected) {
            System.out.println("serverInstanceConnected = " + serverInstanceConnected);
        }

        @Override
        public void onServerInstanceDeleted(ServerInstanceDeleted serverInstanceDeleted) {
            System.out.println("serverInstanceDeleted = " + serverInstanceDeleted);
        }

        @Override
        public void onServerInstanceDisconnected(ServerInstanceDisconnected serverInstanceDisconnected) {
            System.out.println("serverInstanceDisconnected = " + serverInstanceDisconnected);
        }

        @Override
        public void onServerTemplateDeleted(ServerTemplateDeleted serverTemplateDeleted) {
            System.out.println("serverTemplateDeleted = " + serverTemplateDeleted);
        }

        @Override
        public void onServerTemplateUpdated(ServerTemplateUpdated serverTemplateUpdated) {
            System.out.println("serverTemplateUpdated = " + serverTemplateUpdated);
        }

        @Override
        public void onServerInstanceUpdated(ServerInstanceUpdated serverInstanceUpdated) {
            System.out.println("serverInstanceUpdated = " + serverInstanceUpdated);
        }

        @Override
        public void onContainerSpecUpdated(ContainerSpecUpdated containerSpecUpdated) {
            System.out.println("onContainerSpecUpdated = " + containerSpecUpdated);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_password_using_key_store"><a class="anchor" href="#_securing_password_using_key_store"></a><a class="link" href="#_securing_password_using_key_store">19.14. Securing password using key store</a></h3>
<div class="paragraph">
<p>KIE server is using for some communication (e.g. REST api) basic authentication with passwords. From the security perspective it is not safe to store such passwords in clear text form on the disc. For this purpose a mechanism was developed to store passwords in a key store and then use it in the application.</p>
</div>
<div class="sect3">
<h4 id="_simple_usecase"><a class="anchor" href="#_simple_usecase"></a><a class="link" href="#_simple_usecase">19.14.1. Simple usecase</a></h4>
<div class="paragraph">
<p>User wants to secure his password for communicating via REST client. He creates new keystore where he will put his password, he will setup sytem variables with the info to the keystore and KIE will automatically load the keystore and will use the password for securing the communication.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_and_business_logic"><a class="anchor" href="#_implementation_and_business_logic"></a><a class="link" href="#_implementation_and_business_logic">19.14.2. Implementation and business logic</a></h4>
<div class="paragraph">
<p>Current implementation is using key store if it is defined. If not, the funcionality is falling back to old behavior using config parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a><a class="link" href="#_system_requirements">19.14.3. System requirements</a></h4>
<div class="paragraph">
<p>To use a key store we need to create it first. As JKS is not supporting symetric keys we have to create JCEKS key store. Moreover, password can be stored in a key store only for Java 8 and above. For generating a key store you can use standard tool KeyTool which is part of JDK instalation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_initialization_of_a_key_store"><a class="anchor" href="#_initialization_of_a_key_store"></a><a class="link" href="#_initialization_of_a_key_store">19.14.4. Initialization of a key store</a></h4>
<div class="paragraph">
<p>For keystore initialization we recommend to use keytool. Syntax is the following:<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">${JAVA_HOME}/bin/keytool -importpassword -keystore _keystore_url_ -keypass _alias_key_password_ -alias _password_alias_ -storepass _keystore_password_ -storetype JCEKS</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>alias</strong> - alias name of the entry to process</p>
</li>
<li>
<p><strong>keypass</strong> - key password</p>
</li>
<li>
<p><strong>keystore</strong> - keystore name</p>
</li>
<li>
<p><strong>storepass</strong> - keystore password</p>
</li>
<li>
<p><strong>storetype</strong> - keystore type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After running this command user will be asked for entering the password which he wants to store.</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_parameters_for_loading_key_store"><a class="anchor" href="#_system_parameters_for_loading_key_store"></a><a class="link" href="#_system_parameters_for_loading_key_store">19.14.5. System parameters for loading key store</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>kie.keystore.keyStoreURL</strong> - URL to a keystore which should be used</p>
</li>
<li>
<p><strong>kie.keystore.keyStorePwd</strong> - password to a keystore</p>
</li>
<li>
<p><strong>kie.keystore.key.server.alias</strong> - alias of the key for REST services where password is stored</p>
</li>
<li>
<p><strong>kie.keystore.key.server.pwd</strong> - password of an alias for REST services with stored password</p>
</li>
<li>
<p><strong>kie.keystore.key.ctrl.alias</strong> - alias of the key for default REST Drools controller where password is stored</p>
</li>
<li>
<p><strong>kie.keystore.key.ctrl.pwd</strong> - password of an alias for default REST Drools controller with stored password</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_example_3"><a class="anchor" href="#_example_3"></a><a class="link" href="#_example_3">19.14.6. Example</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create user and password in application server (it has to have kie-server role)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>${EAP_HOME}/add-user.sh -a -e -u kieserver -p "kiePassword1!" -g kie-server</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>use key tool to create keystore with password in it<br></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">${JAVA_HOME}/bin/keytool -importpassword -keystore /home/kie/keystores/droolsServer.jceks -keypass keypwd -alias droolsKey -storepass serverpwd -storetype JCEKS

Enter the password to be stored:
Re-enter password:

${JAVA_HOME}/bin/keytool -importpassword -keystore /home/kie/keystores/droolsServer.jceks -keypass keypwd -alias restKey -storepass serverpwd -storetype JCEKS

Enter the password to be stored:
Re-enter password:</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>set following system properties on application server that will let the KIE Server or Drools controller to read password from keystore</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;system-properties&gt;
        &lt;property name="kie.keystore.keyStoreURL" value="file:///home/kie/keystores/droolsServer.jceks"/&gt;
        &lt;property name="kie.keystore.keyStorePwd" value="serverpwd"/&gt;
        &lt;property name="kie.keystore.key.server.alias" value="restKey"/&gt;
        &lt;property name="kie.keystore.key.server.pwd" value="keypwd"/&gt;
        &lt;property name="kie.keystore.key.ctrl.alias" value="droolsKey"/&gt;
        &lt;property name="kie.keystore.key.ctrl.pwd" value="keypwd"/&gt;
    &lt;/system-properties&gt;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>start server to verify configuration</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prometheus-monitoring-con_kie-apis"><a class="anchor" href="#prometheus-monitoring-con_kie-apis"></a><a class="link" href="#prometheus-monitoring-con_kie-apis">19.15. Prometheus metrics monitoring in Drools</a></h3>
<div class="paragraph">
<p>Prometheus is an open-source systems monitoring toolkit that you can use with Drools to collect and store metrics related to the execution of business rules, processes, Decision Model and Notation (DMN) models, and other Drools assets. You can access the stored metrics through a REST API call to the KIE Server, through the Prometheus expression browser, or using a data-graphing tool such as Grafana.</p>
</div>
<div class="paragraph">
<p>You can configure Prometheus metrics monitoring for an on-premise KIE Server instance, for KIE Server on Spring Boot, or for a KIE Server deployment on Red Hat OpenShift Container Platform.</p>
</div>
<div class="paragraph">
<p>For the list of available metrics that KIE Server exposes with Prometheus,
see the <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-services/kie-server-services-prometheus">KIE Server Prometheus Extension</a> page on GitHub.</p>
</div>
<div class="sect3">
<h4 id="prometheus-monitoring-proc_kie-apis"><a class="anchor" href="#prometheus-monitoring-proc_kie-apis"></a><a class="link" href="#prometheus-monitoring-proc_kie-apis">19.15.1. Configuring Prometheus metrics monitoring for KIE Server</a></h4>
<div class="paragraph">
<p>You can configure your KIE Server instances to use Prometheus to collect and store metrics related to your business asset activity in Drools. For the list of available metrics that KIE Server exposes with Prometheus,
see the <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-services/kie-server-services-prometheus">KIE Server Prometheus Extension</a> page on GitHub.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>KIE Server is installed.</p>
</li>
<li>
<p>You have <code>kie-server</code> user role access to KIE Server.</p>
</li>
<li>
<p>Prometheus is installed. For information about downloading and using Prometheus, see the <a href="https://prometheus.io/docs/introduction/overview/">Prometheus documentation page</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your KIE Server instance, set the <code>org.kie.prometheus.server.ext.disabled</code> system property to <code>false</code> to enable the Prometheus extension. You can define this property when you start KIE Server or in the <code>standalone.xml</code> or <code>standalone-full.xml</code> file of Drools distribution.</p>
</li>
<li>
<p>If you are running Drools on Spring Boot, add the following dependencies in the <code>pom.xml</code> file of your Maven project and configure the required key in the <code>application.properties</code> system property:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Spring Boot pom.xml dependencies for Prometheus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-services-prometheus&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-rest-prometheus&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Spring Boot application.properties key for Drools and Prometheus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">kieserver.drools.enabled=true
kieserver.dmn.enabled=true
kieserver.prometheus.enabled=true</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In the <code>prometheus.yaml</code> file of your Prometheus distribution, add the following settings in the <code>scrape_configs</code> section to configure Prometheus to scrape metrics from KIE Server:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Scrape configurations in prometheus.yaml file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">scrape_configs:
  job_name: 'kie-server'
metrics_path: /SERVER_PATH/services/rest/metrics
Basic_auth:
username: USER_NAME
password: PASSWORD
static_configs:
  - targets: ["HOST:PORT"]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Scrape configurations in prometheus.yaml file for Spring Boot (if applicable)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">scrape_configs:
  job_name: 'kie'
metrics_path: /rest/metrics
static_configs:
- targets: ["HOST:PORT"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace the values according to your KIE Server location and settings.</p>
</div>
</div>
</div>
</li>
<li>
<p>Start the KIE Server instance.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>After you start the configured KIE Server instance, Prometheus begins collecting metrics and KIE Server publishes the metrics to the REST API endpoint <code>http://HOST:PORT/SERVER/services/rest/metrics</code> (or on Spring Boot, to <code>http://HOST:PORT/rest/metrics</code>).</p>
</div>
</div>
</div>
</li>
<li>
<p>In a REST client or curl utility, send a REST API request with the following components to verify that KIE Server is publishing the metrics:</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For REST client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Enter the user name and password of the KIE Server user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><strong>HTTP Headers</strong>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP method</strong>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the KIE Server REST API base URL and metrics endpoint, such as <code>http://localhost:8080/kie-server/services/rest/metrics</code> (or on Spring Boot, <code>http://localhost:8080/rest/metrics</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For curl utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code>: Enter the user name and password of the KIE Server user with the <code>kie-server</code> role.</p>
</li>
<li>
<p><code>-H</code>: Set the following header:</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code>: <code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code>: Set to <code>GET</code>.</p>
</li>
<li>
<p><strong>URL</strong>: Enter the KIE Server REST API base URL and metrics endpoint, such as <code>http://localhost:8080/kie-server/services/rest/metrics</code> (or on Spring Boot, <code>http://localhost:8080/rest/metrics</code>).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/kie-server/services/rest/metrics"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example server response</div>
<div class="content">
<pre class="highlightjs highlight"><code># HELP kie_server_container_started_total Kie Server Started Containers
# TYPE kie_server_container_started_total counter
kie_server_container_started_total{container_id="task-assignment-kjar-1.0",} 1.0
# HELP solvers_running Number of solvers currently running
# TYPE solvers_running gauge
solvers_running 0.0
# HELP dmn_evaluate_decision_nanosecond DMN Evaluation Time
# TYPE dmn_evaluate_decision_nanosecond histogram
# HELP solver_duration_seconds Time in seconds it took solver to solve the constraint problem
# TYPE solver_duration_seconds summary
solver_duration_seconds_count{solver_id="100tasks-5employees.xml",} 1.0
solver_duration_seconds_sum{solver_id="100tasks-5employees.xml",} 179.828255925
solver_duration_seconds_count{solver_id="24tasks-8employees.xml",} 1.0
solver_duration_seconds_sum{solver_id="24tasks-8employees.xml",} 179.995759653
# HELP drl_match_fired_nanosecond Drools Firing Time
# TYPE drl_match_fired_nanosecond histogram
# HELP dmn_evaluate_failed_count DMN Evaluation Failed
# TYPE dmn_evaluate_failed_count counter
# HELP kie_server_start_time Kie Server Start Time
# TYPE kie_server_start_time gauge
kie_server_start_time{name="myapp-kieserver",server_id="myapp-kieserver",location="http://myapp-kieserver-demo-monitoring.127.0.0.1.nip.io:80/services/rest/server",version="7.4.0.redhat-20190428",} 1.557221271502E12
# HELP kie_server_container_running_total Kie Server Running Containers
# TYPE kie_server_container_running_total gauge
kie_server_container_running_total{container_id="task-assignment-kjar-1.0",} 1.0
# HELP solver_score_calculation_speed Number of moves per second for a particular solver solving the constraint problem
# TYPE solver_score_calculation_speed summary
solver_score_calculation_speed_count{solver_id="100tasks-5employees.xml",} 1.0
solver_score_calculation_speed_sum{solver_id="100tasks-5employees.xml",} 6997.0
solver_score_calculation_speed_count{solver_id="24tasks-8employees.xml",} 1.0
solver_score_calculation_speed_sum{solver_id="24tasks-8employees.xml",} 19772.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the metrics are not available in KIE Server, review and verify the KIE Server and Prometheus configurations described in this section.</p>
</div>
<div class="paragraph">
<p>You can also interact with your collected metrics in the Prometheus expression browser at <code>http://HOST:PORT/graph</code>, or integrate your Prometheus data source with a data-graphing tool such as Grafana:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-expression-browser-data.png" alt="prometheus expression browser data">
</div>
<div class="title">Figure 351. Prometheus expression browser with KIE Server metrics</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-expression-browser-targets.png" alt="prometheus expression browser targets">
</div>
<div class="title">Figure 352. Prometheus expression browser with KIE Server target</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-grafana-data-dmn.png" alt="prometheus grafana data dmn">
</div>
<div class="title">Figure 353. Grafana dashboard with KIE Server metrics for DMN models</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-grafana-data-optimizer.png" alt="prometheus grafana data optimizer">
</div>
<div class="title">Figure 354. Grafana dashboard with KIE Server metrics for solvers</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://prometheus.io/docs/prometheus/latest/getting_started/">Getting Started with Prometheus</a></p>
</li>
<li>
<p><a href="https://prometheus.io/docs/visualization/grafana/">Grafana Support for Prometheus</a></p>
</li>
<li>
<p><a href="https://grafana.com/docs/features/datasources/prometheus/">Using Prometheus in Grafana</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="prometheus-monitoring-custom-proc_kie-apis"><a class="anchor" href="#prometheus-monitoring-custom-proc_kie-apis"></a><a class="link" href="#prometheus-monitoring-custom-proc_kie-apis">19.15.2. Extending Prometheus metrics monitoring in KIE Server with custom metrics</a></h4>
<div class="paragraph">
<p>After you configure your KIE Server instance to use Prometheus metrics monitoring, you can extend the Prometheus functionality in KIE Server to use custom metrics according to your business needs. Prometheus then collects and stores your custom metrics along with the default metrics that KIE Server exposes with Prometheus.</p>
</div>
<div class="paragraph">
<p>As an example, this procedure defines custom Decision Model and Notation (DMN) metrics to be collected and stored by Prometheus.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Prometheus metrics monitoring is configured for your KIE Server instance. For information about Prometheus configuration with KIE Server on-premise, see
<a href="#prometheus-monitoring-proc_kie-apis">Configuring Prometheus metrics monitoring for KIE Server</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an empty Maven project and define the following packaging type and dependencies in the <code>pom.xml</code> file for the project:</p>
<div class="listingblock">
<div class="title">Example pom.xml file in the sample project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
  &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-drools&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-prometheus&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-dmn-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-dmn-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.jbpm&lt;/groupId&gt;
    &lt;artifactId&gt;jbpm-services-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.jbpm&lt;/groupId&gt;
    &lt;artifactId&gt;jbpm-executor&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
    &lt;artifactId&gt;optaplanner-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;io.prometheus&lt;/groupId&gt;
    &lt;artifactId&gt;simpleclient&lt;/artifactId&gt;
    &lt;version&gt;0.5.0&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Implement the relevant listener from the <code>org.kie.server.services.prometheus.PrometheusMetricsProvider</code> interface as part of the custom listener class that defines your custom Prometheus metrics, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>DMNRuntimeEventListener</code> listener in a custom listener class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.kie.server.ext.prometheus;

import io.prometheus.client.Gauge;
import org.kie.dmn.api.core.ast.DecisionNode;
import org.kie.dmn.api.core.event.AfterEvaluateBKMEvent;
import org.kie.dmn.api.core.event.AfterEvaluateContextEntryEvent;
import org.kie.dmn.api.core.event.AfterEvaluateDecisionEvent;
import org.kie.dmn.api.core.event.AfterEvaluateDecisionServiceEvent;
import org.kie.dmn.api.core.event.AfterEvaluateDecisionTableEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateBKMEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateContextEntryEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateDecisionEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateDecisionServiceEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateDecisionTableEvent;
import org.kie.dmn.api.core.event.DMNRuntimeEventListener;
import org.kie.server.api.model.ReleaseId;
import org.kie.server.services.api.KieContainerInstance;

public class ExampleCustomPrometheusMetricListener implements DMNRuntimeEventListener {

    private final KieContainerInstance kieContainer;

    private final Gauge randomGauge = Gauge.build()
            .name("random_gauge_nanosecond")
            .help("Random gauge as an example of custom KIE Prometheus metric")
            .labelNames("container_id", "group_id", "artifact_id", "version", "decision_namespace", "decision_name")
            .register();

    public ExampleCustomPrometheusMetricListener(KieContainerInstance containerInstance) {
        kieContainer = containerInstance;
    }

    public void beforeEvaluateDecision(BeforeEvaluateDecisionEvent e) {
    }

    public void afterEvaluateDecision(AfterEvaluateDecisionEvent e) {
        DecisionNode decisionNode = e.getDecision();
        ReleaseId releaseId = kieContainer.getResource().getReleaseId();
        randomGauge.labels(kieContainer.getContainerId(), releaseId.getGroupId(),
                           releaseId.getArtifactId(), releaseId.getVersion(),
                           decisionNode.getModelName(), decisionNode.getModelNamespace())
                .set((int) (Math.random() * 100));
    }

    public void beforeEvaluateBKM(BeforeEvaluateBKMEvent event) {
    }

    public void afterEvaluateBKM(AfterEvaluateBKMEvent event) {
    }

    public void beforeEvaluateContextEntry(BeforeEvaluateContextEntryEvent event) {
    }

    public void afterEvaluateContextEntry(AfterEvaluateContextEntryEvent event) {
    }

    public void beforeEvaluateDecisionTable(BeforeEvaluateDecisionTableEvent event) {
    }

    public void afterEvaluateDecisionTable(AfterEvaluateDecisionTableEvent event) {
    }

    public void beforeEvaluateDecisionService(BeforeEvaluateDecisionServiceEvent event) {
    }

    public void afterEvaluateDecisionService(AfterEvaluateDecisionServiceEvent event) {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PrometheusMetricsProvider</code> interface contains the required listeners for collecting Prometheus metrics. The interface is incorporated by the <code>kie-server-services-prometheus</code> dependency that you declared in your project <code>pom.xml</code> file.</p>
</div>
<div class="paragraph">
<p>In this example, the <code>ExampleCustomPrometheusMetricListener</code> class implements the <code>DMNRuntimeEventListener</code> listener (from the <code>PrometheusMetricsProvider</code> interface) and defines the custom DMN metrics to be collected and stored by Prometheus.</p>
</div>
</div>
</div>
</li>
<li>
<p>Implement the <code>PrometheusMetricsProvider</code> interface as part of a custom metrics provider class that associates your custom listener with the <code>PrometheusMetricsProvider</code> interface, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Sample implementation of the <code>PrometheusMetricsProvider</code> interface in a custom metrics provider class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.kie.server.ext.prometheus;

import org.jbpm.executor.AsynchronousJobListener;
import org.jbpm.services.api.DeploymentEventListener;
import org.kie.api.event.rule.AgendaEventListener;
import org.kie.api.event.rule.DefaultAgendaEventListener;
import org.kie.dmn.api.core.event.DMNRuntimeEventListener;
import org.kie.server.services.api.KieContainerInstance;
import org.kie.server.services.prometheus.PrometheusMetricsProvider;
import org.optaplanner.core.impl.phase.event.PhaseLifecycleListener;
import org.optaplanner.core.impl.phase.event.PhaseLifecycleListenerAdapter;

public class MyPrometheusMetricsProvider implements PrometheusMetricsProvider {

    public DMNRuntimeEventListener createDMNRuntimeEventListener(KieContainerInstance kContainer) {
        return new ExampleCustomPrometheusMetricListener(kContainer);
    }

    public AgendaEventListener createAgendaEventListener(String kieSessionId, KieContainerInstance kContainer) {
        return new DefaultAgendaEventListener();
    }

    public PhaseLifecycleListener createPhaseLifecycleListener(String solverId) {
        return new PhaseLifecycleListenerAdapter() {
        };
    }

    public AsynchronousJobListener createAsynchronousJobListener() {
        return null;
    }

    public DeploymentEventListener createDeploymentEventListener() {
        return null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>MyPrometheusMetricsProvider</code> class implements the <code>PrometheusMetricsProvider</code> interface and includes your custom <code>ExampleCustomPrometheusMetricListener</code> listener class.</p>
</div>
</div>
</div>
</li>
<li>
<p>To make the new metrics provider discoverable for KIE Server, create a <code>META-INF/services/org.kie.server.services.prometheus.PrometheusMetricsProvider</code> file in your Maven project and add the fully qualified class name of the <code>PrometheusMetricsProvider</code> implementation class within the file. For this example, the file contains the single line <code>org.kie.server.ext.prometheus.MyPrometheusMetricsProvider</code>.</p>
</li>
<li>
<p>Build your project and copy the resulting JAR file into the <code>~/kie-server.war/WEB-INF/lib</code> directory of your project.</p>
</li>
<li>
<p>Start the KIE Server and deploy the built project to the running KIE Server. You can deploy the project using the Business Central interface or the KIE Server REST API (a <code>PUT</code> request to <code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code>).</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>After your project is deployed on a running KIE Server, Prometheus begins collecting metrics and KIE Server publishes the metrics to the REST API endpoint <code>http://HOST:PORT/SERVER/services/rest/metrics</code> (or on Spring Boot, to <code>http://HOST:PORT/rest/metrics</code>).</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performance-tuning-kie-server-ref_kie-apis"><a class="anchor" href="#performance-tuning-kie-server-ref_kie-apis"></a><a class="link" href="#performance-tuning-kie-server-ref_kie-apis">19.16. Performance tuning considerations with KIE Server</a></h3>
<div class="paragraph">
<p>The following key concepts or suggested practices can help you optimize KIE Server performance. These concepts are summarized in this section as a convenience and are explained in more detail in the cross-referenced documentation, where applicable. This section will expand or change as needed with new releases of Drools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Ensure that development mode is enabled during development</dt>
<dd>
<p>You can set KIE Server or specific projects in Business Central to use <code>production</code> mode or <code>development</code> mode. By default, KIE Server and all new projects in Business Central are in development mode. This mode provides features that facilitate your development experience, such as flexible project deployment policies, and features that optimize KIE Server performance during development, such as disabled duplicate GAV detection. Use development mode until your Drools environment is established and completely ready for production mode.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For more information about configuring the environment mode or duplicate GAV detection, see the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_development_streamline_lifecycle">Development streamline lifecycle</a></p>
</li>
<li>
<p><a href="#_duplicate_gav_detection">Duplicate GAV detection</a></p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Adapt KIE Server capabilities and extensions to your specific needs</dt>
<dd>
<p>The capabilities in KIE Server are determined by plug-in extensions that you can enable, disable, or further extend to meet your business needs. By default, KIE Server extensions are exposed through REST or JMS data transports and use predefined client APIs. You can extend existing KIE Server capabilities with additional REST endpoints, extend supported transport methods beyond REST or JMS, or extend functionality in the KIE Server client.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This flexibility in KIE Server functionality enables you to adapt your KIE Server instances to your business needs, instead of adapting your business needs to the default KIE Server capabilities.</p>
</div>
<div class="paragraph">
<p>For information about enabling, disabling, or extending KIE Server capabilities, see
<a href="#kie-server-extensions-con_kie-apis">KIE Server capabilities and extensions</a>.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
<h1 id="_drools_examples" class="discrete">Drools Examples</h1>
<div class="paragraph">
<p>Examples to help you learn Drools</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a><a class="link" href="#_examples">20. Examples</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="decision-examples-IDE-con_drools-examples"><a class="anchor" href="#decision-examples-IDE-con_drools-examples"></a><a class="link" href="#decision-examples-IDE-con_drools-examples">20.1. Example decisions in Drools for an IDE</a></h3>
<div class="paragraph">
<p>Drools provides example decisions distributed as Java classes that you can import into your integrated development environment (IDE). You can use these examples to better understand Drools engine capabilities or use them as a reference for the decisions that you define in your own Drools projects.</p>
</div>
<div class="paragraph">
<p>The following example decision sets are some of the examples available in Drools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Hello World example</strong>: Demonstrates basic rule execution and use of debug output</p>
</li>
<li>
<p><strong>State example</strong>: Demonstrates forward chaining and conflict resolution through rule salience and agenda groups</p>
</li>
<li>
<p><strong>Fibonacci example</strong>: Demonstrates recursion and conflict resolution through rule salience</p>
</li>
<li>
<p><strong>Banking example</strong>: Demonstrates pattern matching, basic sorting, and calculation</p>
</li>
<li>
<p><strong>Pet Store example</strong>: Demonstrates rule agenda groups, global variables, callbacks, and GUI integration</p>
</li>
<li>
<p><strong>Sudoku example</strong>: Demonstrates complex pattern matching, problem solving, callbacks, and GUI integration</p>
</li>
<li>
<p><strong>House of Doom example</strong>: Demonstrates backward chaining and recursion</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For optimization examples provided with OptaPlanner, see
the <a href="https://docs.optaplanner.org/7.15.0.Final/optaplanner-docs/html_single/index.html#useCasesAndExamples">OptaPlanner User Guide</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-IDE-proc_drools-examples"><a class="anchor" href="#decision-examples-IDE-proc_drools-examples"></a><a class="link" href="#decision-examples-IDE-proc_drools-examples">20.2. Importing and executing Drools example decisions in an IDE</a></h3>
<div class="paragraph">
<p>You can import Drools example decisions into your integrated development environment (IDE) and execute them to explore how the rules and code function. You can use these examples to better understand Drools engine capabilities or use them as a reference for the decisions that you define in your own Drools projects.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Java 8 or later is installed.</p>
</li>
<li>
<p>Maven 3.5.x or later is installed.</p>
</li>
<li>
<p>An IDE is installed, such as
Eclipse with the JBoss Tools plugin.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download and unzip the source from the Drools <a href="https://github.com/kiegroup/drools/archive/master.zip">repository in GitHub</a>.</p>
<div class="paragraph">
<p>For the Conways Game of Life example decision, also download and unzip the source from the Drools and jBPM integration <a href="https://github.com/kiegroup/droolsjbpm-integration/archive/master.zip">repository in GitHub</a>.</p>
</div>
</li>
<li>
<p>Open your IDE and select <strong>File</strong> &#8594; <strong>Import</strong> &#8594; <strong>Maven</strong> &#8594; <strong>Existing Maven Projects</strong>, or the equivalent option for importing a Maven project.</p>
</li>
<li>
<p>Click <strong>Browse</strong>, navigate to
<code>~/drools-master/drools-examples</code> (or, for the Conways Game of Life example, <code>~/droolsjbpm-integration-examples</code>),
and import the project.</p>
</li>
<li>
<p>Navigate to the example package that you want to run and find the Java class with the <code>main</code> method.</p>
</li>
<li>
<p>Right-click the Java class and select <strong>Run As</strong> &#8594; <strong>Java Application</strong> to run the example.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To run all examples through a basic user interface, run the <code>DroolsExamplesApp.java</code> class (or, for Conway&#8217;s Game of Life, the <code>DroolsJbpmIntegrationExamplesApp.java</code> class) in the <code>org.drools.examples</code> main class.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/All/drools-examples-run-all.png" alt="drools examples run all">
</div>
<div class="title">Figure 355. Interface for all examples in drools-examples (DroolsExamplesApp.java)</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/All/droolsjbpm-examples-run-all.png" alt="droolsjbpm examples run all">
</div>
<div class="title">Figure 356. Interface for all examples in droolsjbpm-integration-examples (DroolsJbpmIntegrationExamplesApp.java)</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-helloworld-ref_drools-examples"><a class="anchor" href="#decision-examples-helloworld-ref_drools-examples"></a><a class="link" href="#decision-examples-helloworld-ref_drools-examples">20.3. Hello World example decisions (basic rules and debugging)</a></h3>
<div class="paragraph">
<p>The Hello World example decision set demonstrates how to insert objects into the Drools engine working memory, how to match the objects using rules, and how to configure logging to trace the internal activity of the Drools engine.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the Hello World example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>helloworld</code></p>
</li>
<li>
<p><strong>Main class</strong>: <code>org.drools.examples.helloworld.HelloWorldExample</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule file</strong>: <code>org.drools.examples.helloworld.HelloWorld.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates basic rule execution and use of debug output</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the Hello World example, a KIE session is generated to enable rule execution. All rules require a KIE session for execution.</p>
</div>
<div class="listingblock">
<div class="title">KIE session for rule execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get(); <i class="conum" data-value="1"></i><b>(1)</b>
KieContainer kc = ks.getKieClasspathContainer(); <i class="conum" data-value="2"></i><b>(2)</b>
KieSession ksession = kc.newKieSession("HelloWorldKS"); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtains the <code>KieServices</code> factory. This is the main interface that applications use to interact with the Drools engine.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates a <code>KieContainer</code> from the project class path. This detects a <strong>/META-INF/kmodule.xml</strong> file from which it configures and instantiates a <code>KieContainer</code> with a <code>KieModule</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creates a <code>KieSession</code> based on the <code>"HelloWorldKS"</code> KIE session configuration defined in the <strong>/META-INF/kmodule.xml</strong> file.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about Drools project packaging, see
<a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Drools has an event model that exposes internal engine activity. Two default debug listeners, <code>DebugAgendaEventListener</code> and <code>DebugRuleRuntimeEventListener</code>, print debug event information to the <code>System.err</code> output. The <code>KieRuntimeLogger</code> provides execution auditing, the result of which you can view in a graphical viewer.</p>
</div>
<div class="listingblock">
<div class="title">Debug listeners and audit loggers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Set up listeners.
ksession.addEventListener( new DebugAgendaEventListener() );
ksession.addEventListener( new DebugRuleRuntimeEventListener() );

// Set up a file-based audit logger.
KieRuntimeLogger logger = KieServices.get().getLoggers().newFileLogger( ksession, "./target/helloworld" );

// Set up a ThreadedFileLogger so that the audit view reflects events while debugging.
KieRuntimeLogger logger = ks.getLoggers().newThreadedFileLogger( ksession, "./target/helloworld", 1000 );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logger is a specialized implementation built on the <code>Agenda</code> and <code>RuleRuntime</code> listeners. When the Drools engine has finished executing, <code>logger.close()</code> is called.</p>
</div>
<div class="paragraph">
<p>The example creates a single <code>Message</code> object with the message <code>"Hello World"</code>, inserts the status <code>HELLO</code> into the <code>KieSession</code>, executes rules with <code>fireAllRules()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Data insertion and execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Insert facts into the KIE session.
final Message message = new Message();
message.setMessage( "Hello World" );
message.setStatus( Message.HELLO );
ksession.insert( message );

// Fire the rules.
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rule execution uses a data model to pass data as inputs and outputs to the <code>KieSession</code>. The data model in this example has two fields: the <code>message</code>, which is a <code>String</code>, and the <code>status</code>, which can be <code>HELLO</code> or <code>GOODBYE</code>.</p>
</div>
<div class="listingblock">
<div class="title">Data model class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static class Message {
    public static final int HELLO   = 0;
    public static final int GOODBYE = 1;

    private String          message;
    private int             status;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two rules are located in the file <code>src/main/resources/org/drools/examples/helloworld/HelloWorld.drl</code>.</p>
</div>
<div class="paragraph">
<p>The <code>when</code> condition of the <code>"Hello World"</code> rule states that the rule is activated for each <code>Message</code> object inserted into the KIE session that has the status <code>Message.HELLO</code>. Additionally, two variable bindings are created: the variable <code>message</code> is bound to the <code>message</code> attribute and the variable <code>m</code> is bound to the matched <code>Message</code> object itself.</p>
</div>
<div class="paragraph">
<p>The <code>then</code> action of the rule specifies to print the content of the bound variable <code>message</code> to <code>System.out</code>, and then changes the values of the <code>message</code> and <code>status</code> attributes of the <code>Message</code> object bound to <code>m</code>. The rule uses the <code>modify</code> statement to apply a block of assignments in one statement and to notify the Drools engine of the changes at the end of the block.</p>
</div>
<div class="listingblock">
<div class="title">"Hello World" rule</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Hello World"
  when
    m : Message( status == Message.HELLO, message : message )
  then
    System.out.println( message );
    modify ( m ) { message = "Goodbye cruel world",
                   status = Message.GOODBYE };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>"Good Bye"</code> rule is similar to the <code>"Hello World"</code> rule except that it matches <code>Message</code> objects that have the status <code>Message.GOODBYE</code>.</p>
</div>
<div class="listingblock">
<div class="title">"Good Bye" rule</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Good Bye"
  when
    Message( status == Message.GOODBYE, message : message )
  then
    System.out.println( message );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute the example, run the <code>org.drools.examples.helloworld.HelloWorldExample</code> class as a Java application in your IDE. The rule writes to <code>System.out</code>, the debug listener writes to <code>System.err</code>, and the audit logger creates a log file in <code>target/helloworld.log</code>.</p>
</div>
<div class="listingblock">
<div class="title">System.out output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>Hello World
Goodbye cruel world</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">System.err output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>==&gt;[ActivationCreated(0): rule=Hello World;
                   tuple=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[ObjectInserted: handle=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96];
                 object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]
[BeforeActivationFired: rule=Hello World;
                   tuple=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
==&gt;[ActivationCreated(4): rule=Good Bye;
                   tuple=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[ObjectUpdated: handle=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96];
                old_object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96;
                new_object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]
[AfterActivationFired(0): rule=Hello World]
[BeforeActivationFired: rule=Good Bye;
                   tuple=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[AfterActivationFired(4): rule=Good Bye]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To better understand the execution flow of this example, you can load the audit log file from <code>target/helloworld.log</code> into your IDE debug view or <strong>Audit View</strong>, if available (for example, in <strong>Window</strong> &#8594; <strong>Show View</strong> in some IDEs).</p>
</div>
<div class="paragraph">
<p>In this example, the <strong>Audit view</strong> shows that the object is inserted, which creates an activation for the <code>"Hello World"</code> rule. The activation is then executed, which updates the <code>Message</code> object and causes the <code>"Good Bye"</code> rule to activate. Finally, the <code>"Good Bye"</code> rule is executed. When you select an event in the <strong>Audit View</strong>, the origin event, which is the <code>"Activation created"</code> event in this example, is highlighted in green.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/HelloWorldExample/helloworld_auditview1.png" alt="helloworld auditview1">
</div>
<div class="title">Figure 357. Hello World example Audit View</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-state-ref_drools-examples"><a class="anchor" href="#decision-examples-state-ref_drools-examples"></a><a class="link" href="#decision-examples-state-ref_drools-examples">20.4. State example decisions (forward chaining and conflict resolution)</a></h3>
<div class="paragraph">
<p>The State example decision set demonstrates how the Drools engine uses forward chaining and any changes to facts in the working memory to resolve execution conflicts for rules in a sequence. The example focuses on resolving conflicts through salience values or through agenda groups that you can define in rules.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the State example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>state</code></p>
</li>
<li>
<p><strong>Main classes</strong>: <code>org.drools.examples.state.StateExampleUsingSalience</code>, <code>org.drools.examples.state.StateExampleUsingAgendaGroup</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule files</strong>: <code>org.drools.examples.state.*.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates forward chaining and conflict resolution through rule salience and agenda groups</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A forward-chaining rule system is a data-driven system that starts with a fact in the working memory of the Drools engine and reacts to changes to that fact. When objects are inserted into working memory, any rule conditions that become true as a result of the change are scheduled for execution by the agenda.</p>
</div>
<div class="paragraph">
<p>In contrast, a backward-chaining rule system is a goal-driven system that starts with a conclusion that the Drools engine attempts to satisfy, often using recursion. If the system cannot reach the conclusion or goal, it searches for subgoals, which are conclusions that complete part of the current goal. The system continues this process until either the initial conclusion is satisfied or all subgoals are satisfied.</p>
</div>
<div class="paragraph">
<p>The Drools engine in Drools uses both forward and backward chaining to evaluate rules.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates how the Drools engine evaluates rules using forward chaining overall with a backward-chaining segment in the logic flow:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/BackwardChaining/RuleEvaluation.png" alt="RuleEvaluation">
</div>
<div class="title">Figure 358. Rule evaluation logic using forward and backward chaining</div>
</div>
<div class="paragraph">
<p>In the State example, each <code>State</code> class has fields for its name and its current state (see the class <code>org.drools.examples.state.State</code>). The following states are the two possible states for each object:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NOTRUN</code></p>
</li>
<li>
<p><code>FINISHED</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">State class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class State {
    public static final int NOTRUN   = 0;
    public static final int FINISHED = 1;

    private final PropertyChangeSupport changes =
        new PropertyChangeSupport( this );

    private String name;
    private int    state;

    ... setters and getters go here...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The State example contains two versions of the same example to resolve rule execution conflicts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>StateExampleUsingSalience</code> version that resolves conflicts by using rule salience</p>
</li>
<li>
<p>A <code>StateExampleUsingAgendaGroups</code> version that resolves conflicts by using rule agenda groups</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both versions of the state example involve four <code>State</code> objects: <code>A</code>, <code>B</code>, <code>C</code>, and <code>D</code>. Initially, their states are set to <code>NOTRUN</code>, which is the default value for the constructor that the example uses.</p>
</div>
<h4 id="_state_example_using_salience" class="discrete">State example using salience</h4>
<div class="paragraph">
<p>The <code>StateExampleUsingSalience</code> version of the State example uses salience values in rules to resolve rule execution conflicts. Rules with a higher salience value are given higher priority when ordered in the activation queue.</p>
</div>
<div class="paragraph">
<p>The example inserts each <code>State</code> instance into the KIE session and then calls <code>fireAllRules()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Salience State example execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final State a = new State( "A" );
final State b = new State( "B" );
final State c = new State( "C" );
final State d = new State( "D" );

ksession.insert( a );
ksession.insert( b );
ksession.insert( c );
ksession.insert( d );

ksession.fireAllRules();

// Dispose KIE session if stateful (not required if stateless).
ksession.dispose();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute the example, run the <code>org.drools.examples.state.StateExampleUsingSalience</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>After the execution, the following output appears in the IDE console window:</p>
</div>
<div class="listingblock">
<div class="title">Salience State example output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>A finished
B finished
C finished
D finished</code></pre>
</div>
</div>
<div class="paragraph">
<p>Four rules are present.</p>
</div>
<div class="paragraph">
<p>First, the <code>"Bootstrap"</code> rule fires, setting <code>A</code> to state <code>FINISHED</code>, which then causes <code>B</code> to change its state to <code>FINISHED</code>. Objects <code>C</code> and <code>D</code> are both dependent on <code>B</code>, causing a conflict that is resolved by the salience values.</p>
</div>
<div class="paragraph">
<p>To better understand the execution flow of this example, you can load the audit log file from <code>target/state.log</code> into your IDE debug view or <strong>Audit View</strong>, if available (for example, in <strong>Window</strong> &#8594; <strong>Show View</strong> in some IDEs).</p>
</div>
<div class="paragraph">
<p>In this example, the <strong>Audit View</strong> shows that the assertion of the object <code>A</code> in the state <code>NOTRUN</code> activates the <code>"Bootstrap"</code> rule, while the assertions of the other objects have no immediate effect.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/StateExample/state_example_audit1.png" alt="state example audit1">
</div>
<div class="title">Figure 359. Salience State example Audit View</div>
</div>
<div class="listingblock">
<div class="title">Rule "Bootstrap" in salience State example</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Bootstrap"
  when
    a : State(name == "A", state == State.NOTRUN )
  then
    System.out.println(a.getName() + " finished" );
    a.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The execution of the <code>"Bootstrap"</code> rule changes the state of <code>A</code> to <code>FINISHED</code>, which activates rule <code>"A to B"</code>.</p>
</div>
<div class="listingblock">
<div class="title">Rule "A to B" in salience State example</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "A to B"
  when
    State(name == "A", state == State.FINISHED )
    b : State(name == "B", state == State.NOTRUN )
  then
    System.out.println(b.getName() + " finished" );
    b.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The execution of rule <code>"A to B"</code> changes the state of <code>B</code> to <code>FINISHED</code>, which activates both rules <code>"B to C"</code> and <code>"B to D"</code>, placing their activations onto the Drools engine agenda.</p>
</div>
<div class="listingblock">
<div class="title">Rules "B to C" and "B to D" in salience State example</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "B to C"
    salience 10
  when
    State(name == "B", state == State.FINISHED )
    c : State(name == "C", state == State.NOTRUN )
  then
    System.out.println(c.getName() + " finished" );
    c.setState( State.FINISHED );
end

rule "B to D"
  when
    State(name == "B", state == State.FINISHED )
    d : State(name == "D", state == State.NOTRUN )
  then
    System.out.println(d.getName() + " finished" );
    d.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this point on, both rules may fire and, therefore, the rules are in conflict. The conflict resolution strategy enables the Drools engine agenda to decide which rule to fire. Rule <code>"B to C"</code> has the higher salience value (<code>10</code> versus the default salience value of <code>0</code>), so it fires first, modifying object <code>C</code> to state <code>FINISHED</code>.</p>
</div>
<div class="paragraph">
<p>The <strong>Audit View</strong> in your IDE shows the modification of the <code>State</code> object in the rule <code>"A to B"</code>, which results in two activations being in conflict.</p>
</div>
<div class="paragraph">
<p>You can also use the <strong>Agenda View</strong> in your IDE to investigate the state of the Drools engine agenda. In this example, the <strong>Agenda View</strong> shows the breakpoint in the rule <code>"A to B"</code> and the state of the agenda with the two conflicting rules. Rule <code>"B to D"</code> fires last, modifying object <code>D</code> to state <code>FINISHED</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/StateExample/state_example_agenda1.png" alt="state example agenda1">
</div>
<div class="title">Figure 360. Salience State example Agenda View</div>
</div>
<h4 id="_state_example_using_agenda_groups" class="discrete">State example using agenda groups</h4>
<div class="paragraph">
<p>The <code>StateExampleUsingAgendaGroups</code> version of the State example uses agenda groups in rules to resolve rule execution conflicts. Agenda groups enable you to partition the Drools engine agenda to provide more execution control over groups of rules. By default, all rules are in the agenda group <code>MAIN</code>. You can use the <code>agenda-group</code> attribute to specify a different agenda group for the rule.</p>
</div>
<div class="paragraph">
<p>Initially, a working memory has its focus on the agenda group <code>MAIN</code>. Rules in an agenda group only fire when the group receives the focus. You can set the focus either by using the method <code>setFocus()</code> or the rule attribute <code>auto-focus</code>. The <code>auto-focus</code> attribute enables the rule to be given a focus automatically for its agenda group when the rule is matched and activated.</p>
</div>
<div class="paragraph">
<p>In this example, the <code>auto-focus</code> attribute enables rule <code>"B to C"</code> to fire before <code>"B to D"</code>.</p>
</div>
<div class="listingblock">
<div class="title">Rule "B to C" in agenda group State example</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "B to C"
    agenda-group "B to C"
    auto-focus true
  when
    State(name == "B", state == State.FINISHED )
    c : State(name == "C", state == State.NOTRUN )
  then
    System.out.println(c.getName() + " finished" );
    c.setState( State.FINISHED );
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "B to D" ).setFocus();
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"B to C"</code> calls <code>setFocus()</code> on the agenda group <code>"B to D"</code>, enabling its active rules to fire, which then enables the rule <code>"B to D"</code> to fire.</p>
</div>
<div class="listingblock">
<div class="title">Rule "B to D" in agenda group State example</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "B to D"
    agenda-group "B to D"
  when
    State(name == "B", state == State.FINISHED )
    d : State(name == "D", state == State.NOTRUN )
  then
    System.out.println(d.getName() + " finished" );
    d.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute the example, run the <code>org.drools.examples.state.StateExampleUsingAgendaGroups</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>After the execution, the following output appears in the IDE console window (same as the salience version of the State example):</p>
</div>
<div class="listingblock">
<div class="title">Agenda group State example output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>A finished
B finished
C finished
D finished</code></pre>
</div>
</div>
<h4 id="_dynamic_facts_in_the_state_example" class="discrete">Dynamic facts in the State example</h4>
<div class="paragraph">
<p>Another notable concept in this State example is the use of <em>dynamic facts</em>, based on objects that implement a <code>PropertyChangeListener</code> object. In order for the Drools engine to see and react to changes of fact properties, the application must notify the Drools engine that changes occurred. You can configure this communication explicitly in the rules by using the <code>modify</code> statement, or implicitly by specifying that the facts implement the <code>PropertyChangeSupport</code> interface as defined by the JavaBeans specification.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how to use the <code>PropertyChangeSupport</code> interface to avoid the need for explicit <code>modify</code> statements in the rules. To make use of this interface, ensure that your facts implement <code>PropertyChangeSupport</code> in the same way that the class <code>org.drools.example.State</code> implements it, and then use the following code in the DRL rule file to configure the Drools engine to listen for property changes on those facts:</p>
</div>
<div class="listingblock">
<div class="title">Declaring a dynamic fact</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare type State
  @propertyChangeSupport
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you use <code>PropertyChangeListener</code> objects, each setter must implement additional code for the notification. For example, the following setter for <code>state</code> is in the class <code>org.drools.examples</code>:</p>
</div>
<div class="listingblock">
<div class="title">Setter example with PropertyChangeSupport</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setState(final int newState) {
    int oldState = this.state;
    this.state = newState;
    this.changes.firePropertyChange( "state",
                                     oldState,
                                     newState );
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-fibonacci-ref_drools-examples"><a class="anchor" href="#decision-examples-fibonacci-ref_drools-examples"></a><a class="link" href="#decision-examples-fibonacci-ref_drools-examples">20.5. Fibonacci example decisions (recursion and conflict resolution)</a></h3>
<div class="paragraph">
<p>The Fibonacci example decision set demonstrates how the Drools engine uses recursion to resolve execution conflicts for rules in a sequence. The example focuses on resolving conflicts through salience values that you can define in rules.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the Fibonacci example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>fibonacci</code></p>
</li>
<li>
<p><strong>Main class</strong>: <code>org.drools.examples.fibonacci.FibonacciExample</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule file</strong>: <code>org.drools.examples.fibonacci.Fibonacci.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates recursion and conflict resolution through rule salience</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Fibonacci Numbers form a sequence starting with 0 and 1. The next Fibonacci number is obtained by adding the two preceding Fibonacci numbers: 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946, and so on.</p>
</div>
<div class="paragraph">
<p>The Fibonacci example uses the single fact class <code>Fibonacci</code> with the following two fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sequence</code></p>
</li>
<li>
<p><code>value</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>sequence</code> field indicates the position of the object in the Fibonacci number sequence. The <code>value</code> field shows the value of that Fibonacci object for that sequence position, where <code>-1</code> indicates a value that still needs to be computed.</p>
</div>
<div class="listingblock">
<div class="title">Fibonacci class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static class Fibonacci {
    private int  sequence;
    private long value;

    public Fibonacci( final int sequence ) {
        this.sequence = sequence;
        this.value = -1;
    }

    ... setters and getters go here...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute the example, run the <code>org.drools.examples.fibonacci.FibonacciExample</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>After the execution, the following output appears in the IDE console window:</p>
</div>
<div class="listingblock">
<div class="title">Fibonacci example output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>recurse for 50
recurse for 49
recurse for 48
recurse for 47
...
recurse for 5
recurse for 4
recurse for 3
recurse for 2
1 == 1
2 == 1
3 == 2
4 == 3
5 == 5
6 == 8
...
47 == 2971215073
48 == 4807526976
49 == 7778742049
50 == 12586269025</code></pre>
</div>
</div>
<div class="paragraph">
<p>To achieve this behavior in Java, the example inserts a single <code>Fibonacci</code> object with a sequence field of <code>50</code>. The example then uses a recursive rule to insert the other 49 <code>Fibonacci</code> objects.</p>
</div>
<div class="paragraph">
<p>Instead of implementing the <code>PropertyChangeSupport</code> interface to use dynamic facts, this example uses the MVEL dialect <code>modify</code> keyword to enable a block setter action and notify the Drools engine of changes.</p>
</div>
<div class="listingblock">
<div class="title">Fibonacci example execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.insert( new Fibonacci( 50 ) );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example uses the following three rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"Recurse"</code></p>
</li>
<li>
<p><code>"Bootstrap"</code></p>
</li>
<li>
<p><code>"Calculate"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rule <code>"Recurse"</code> matches each asserted <code>Fibonacci</code> object with a value of <code>-1</code>, creating and asserting a new <code>Fibonacci</code> object with a sequence of one less than the currently matched object. Each time a Fibonacci object is added while the one with a sequence field equal to <code>1</code> does not exist, the rule re-matches and fires again. The <code>not</code> conditional element is used to stop the rule matching once you have all 50 Fibonacci objects in memory. The rule also has a <code>salience</code> value because you need to have all 50 <code>Fibonacci</code> objects asserted before you execute the <code>"Bootstrap"</code> rule.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Recurse"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Recurse"
    salience 10
  when
    f : Fibonacci ( value == -1 )
    not ( Fibonacci ( sequence == 1 ) )
  then
    insert( new Fibonacci( f.sequence - 1 ) );
    System.out.println( "recurse for " + f.sequence );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>To better understand the execution flow of this example, you can load the audit log file from <code>target/fibonacci.log</code> into your IDE debug view or <strong>Audit View</strong>, if available (for example, in <strong>Window</strong> &#8594; <strong>Show View</strong> in some IDEs).</p>
</div>
<div class="paragraph">
<p>In this example, the <strong>Audit View</strong> shows the original assertion of the <code>Fibonacci</code> object with a <code>sequence</code> field of <code>50</code>, done from Java code. From there on, the <strong>Audit View</strong> shows the continual recursion of the rule, where each asserted <code>Fibonacci</code> object causes the <code>"Recurse"</code> rule to become activated and to fire again.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci1.png" alt="fibonacci1">
</div>
<div class="title">Figure 361. Rule "Recurse" in Audit View</div>
</div>
<div class="paragraph">
<p>When a <code>Fibonacci</code> object with a <code>sequence</code> field of <code>2</code> is asserted, the <code>"Bootstrap"</code> rule is matched and activated along with the <code>"Recurse"</code> rule. Notice the multiple restrictions on field <code>sequence</code> that test for equality with <code>1</code> or <code>2</code>:</p>
</div>
<div class="listingblock">
<div class="title">Rule "Bootstrap"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Bootstrap"
  when
    f : Fibonacci( sequence == 1 || == 2, value == -1 ) // multi-restriction
  then
    modify ( f ){ value = 1 };
    System.out.println( f.sequence + " == " + f.value );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <strong>Agenda View</strong> in your IDE to investigate the state of the Drools engine agenda. The <code>"Bootstrap"</code> rule does not fire yet because the <code>"Recurse"</code> rule has a higher salience value.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci_agenda1.png" alt="fibonacci agenda1">
</div>
<div class="title">Figure 362. Rules "Recurse" and "Bootstrap" in Agenda View 1</div>
</div>
<div class="paragraph">
<p>When a <code>Fibonacci</code> object with a <code>sequence</code> of <code>1</code> is asserted, the <code>"Bootstrap"</code> rule is matched again, causing two activations for this rule. The <code>"Recurse"</code> rule does not match and activate because the <code>not</code> conditional element stops the rule matching as soon as a <code>Fibonacci</code> object with a <code>sequence</code> of <code>1</code> exists.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci_agenda2.png" alt="fibonacci agenda2">
</div>
<div class="title">Figure 363. Rules "Recurse" and "Bootstrap" in Agenda View 2</div>
</div>
<div class="paragraph">
<p>The <code>"Bootstrap"</code> rule sets the objects with a <code>sequence</code> of <code>1</code> and <code>2</code> to a value of <code>1</code>. Now that you have two <code>Fibonacci</code> objects with values not equal to <code>-1</code>, the <code>"Calculate"</code> rule is able to match.</p>
</div>
<div class="paragraph">
<p>At this point in the example, nearly 50 <code>Fibonacci</code> objects exist in the working memory. You need to select a suitable triple to calculate each of their values in turn. If you use three Fibonacci patterns in a rule without field constraints to confine the possible cross products, the result would be 50x49x48 possible combinations, leading to about 125,000 possible rule firings, most of them incorrect.</p>
</div>
<div class="paragraph">
<p>The <code>"Calculate"</code> rule uses field constraints to evaluate the three Fibonacci patterns in the correct order. This technique is called <em>cross-product matching</em>.</p>
</div>
<div class="paragraph">
<p>The first pattern finds any <code>Fibonacci</code> object with a value <code>!= -1</code> and binds both the pattern and the field. The second <code>Fibonacci</code> object does the same thing, but adds an additional field constraint to ensure that its sequence is greater by one than the <code>Fibonacci</code> object bound to <code>f1</code>. When this rule fires for the first time, you know that only sequences <code>1</code> and <code>2</code> have values of <code>1</code>, and the two constraints ensure that <code>f1</code> references sequence <code>1</code> and that <code>f2</code> references sequence <code>2</code>.</p>
</div>
<div class="paragraph">
<p>The final pattern finds the <code>Fibonacci</code> object with a value equal to <code>-1</code> and with a sequence one greater than <code>f2</code>.</p>
</div>
<div class="paragraph">
<p>At this point in the example, three <code>Fibonacci</code> objects are correctly selected from the available cross products, and you can calculate the value for the third <code>Fibonacci</code> object that is bound to <code>f3</code>.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Calculate"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Calculate"
  when
    // Bind f1 and s1.
    f1 : Fibonacci( s1 : sequence, value != -1 )
    // Bind f2 and v2, refer to bound variable s1.
    f2 : Fibonacci( sequence == (s1 + 1), v2 : value != -1 )
    // Bind f3 and s3, alternative reference of f2.sequence.
    f3 : Fibonacci( s3 : sequence == (f2.sequence + 1 ), value == -1 )
  then
    // Note the various referencing techniques.
    modify ( f3 ) { value = f1.value + v2 };
    System.out.println( s3 + " == " + f3.value );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>modify</code> statement updates the value of the <code>Fibonacci</code> object bound to <code>f3</code>. This means that you now have another new <code>Fibonacci</code> object with a value not equal to <code>-1</code>, which allows the <code>"Calculate"</code> rule to re-match and calculate the next Fibonacci number.</p>
</div>
<div class="paragraph">
<p>The debug view or <strong>Audit View</strong> of your IDE shows how the firing of the last <code>"Bootstrap"</code> rule modifies the <code>Fibonacci</code> object, enabling the <code>"Calculate"</code> rule to match, which then modifies another <code>Fibonacci</code> object that enables the <code>"Calculate"</code> rule to match again. This process continues until the value is set for all <code>Fibonacci</code> objects.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci4.png" alt="fibonacci4">
</div>
<div class="title">Figure 364. Rules in Audit View</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-pricing-ref_drools-examples"><a class="anchor" href="#decision-examples-pricing-ref_drools-examples"></a><a class="link" href="#decision-examples-pricing-ref_drools-examples">20.6. Pricing example decisions (decision tables)</a></h3>
<div class="paragraph">
<p>The Pricing example decision set demonstrates how to use a spreadsheet decision table for calculating the retail cost of an insurance policy in tabular format instead of directly in a DRL file.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the Pricing example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>decisiontable</code></p>
</li>
<li>
<p><strong>Main class</strong>: <code>org.drools.examples.decisiontable.PricingRuleDTExample</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule file</strong>: <code>org.drools.examples.decisiontable.ExamplePolicyPricing.xls</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates use of spreadsheet decision tables to define rules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spreadsheet decision tables are XLS or XLSX spreadsheets that contain business rules defined in a tabular format. You can include spreadsheet decision tables with standalone Drools projects or upload them to projects in Business Central. Each row in a decision table is a rule, and each column is a condition, an action, or another rule attribute. After you create and upload your decision tables into your Drools project, the rules you defined are compiled into Drools Rule Language (DRL) rules as with all other rule assets.</p>
</div>
<div class="paragraph">
<p>The purpose of the Pricing example is to provide a set of business rules to calculate the base price and a discount for a car driver applying for a specific type of insurance policy. The driver&#8217;s age and history and the policy type all contribute to calculate the basic premium, and additional rules calculate potential discounts for which the driver might be eligible.</p>
</div>
<div class="paragraph">
<p>To execute the example, run the <code>org.drools.examples.decisiontable.PricingRuleDTExample</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>After the execution, the following output appears in the IDE console window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheapest possible
BASE PRICE IS: 120
DISCOUNT IS: 20</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code to execute the example follows the typical execution pattern: the rules are loaded, the facts are inserted, and a stateless KIE session is created. The difference in this example is that the rules are defined in an <code>ExamplePolicyPricing.xls</code> file instead of a DRL file or other source. The spreadsheet file is loaded into the Drools engine using templates and DRL rules.</p>
</div>
<h4 id="_spreadsheet_decision_table_setup" class="discrete">Spreadsheet decision table setup</h4>
<div class="paragraph">
<p>The <code>ExamplePolicyPricing.xls</code> spreadsheet contains two decision tables in the first tab:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Base pricing rules</code></p>
</li>
<li>
<p><code>Promotional discount rules</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As the example spreadsheet demonstrates, you can use only the first tab of a spreadsheet to create decision tables, but multiple tables can be within a single tab. Decision tables do not necessarily follow top-down logic, but are more of a means to capture data resulting in rules. The evaluation of the rules is not necessarily in the given order, because all of the normal mechanics of the Drools engine still apply. This is why you can have multiple decision tables in the same tab of a spreadsheet.</p>
</div>
<div class="paragraph">
<p>The decision tables are executed through the corresponding rule template files <code>BasePricing.drt</code> and <code>PromotionalPricing.drt</code>. These template files reference the decision tables through their template parameter and directly reference the various headers for the conditions and actions in the decision tables.</p>
</div>
<div class="listingblock">
<div class="title">BasePricing.drt rule template file</div>
<div class="content">
<pre class="highlightjs highlight"><code>template header
age[]
profile
priorClaims
policyType
base
reason

package org.drools.examples.decisiontable;

template "Pricing bracket"
age
policyType
base

rule "Pricing bracket_@{row.rowNumber}"
  when
    Driver(age &gt;= @{age0}, age &lt;= @{age1}
        , priorClaims == "@{priorClaims}"
        , locationRiskProfile == "@{profile}"
    )
    policy: Policy(type == "@{policyType}")
  then
    policy.setBasePrice(@{base});
    System.out.println("@{reason}");
end
end template</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PromotionalPricing.drt rule template file</div>
<div class="content">
<pre class="highlightjs highlight"><code>template header
age[]
priorClaims
policyType
discount

package org.drools.examples.decisiontable;

template "discounts"
age
priorClaims
policyType
discount

rule "Discounts_@{row.rowNumber}"
  when
    Driver(age &gt;= @{age0}, age &lt;= @{age1}, priorClaims == "@{priorClaims}")
    policy: Policy(type == "@{policyType}")
  then
    policy.applyDiscount(@{discount});
end
end template</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rules are executed through the <code>kmodule.xml</code> reference of the KIE Session <code>DTableWithTemplateKB</code>, which specifically mentions the <code>ExamplePolicyPricing.xls</code> spreadsheet and is required for successful execution of the rules. This execution method enables you to execute the rules as a standalone unit (as in this example) or to include the rules in a packaged knowledge JAR (KJAR) file, so that the spreadsheet is packaged along with the rules for execution.</p>
</div>
<div class="paragraph">
<p>The following section of the <code>kmodule.xml</code> file is required for the execution of the rules and spreadsheet to work successfully:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;kbase name="DecisionTableKB" packages="org.drools.examples.decisiontable"&gt;
        &lt;ksession name="DecisionTableKS" type="stateless"/&gt;
    &lt;/kbase&gt;

    &lt;kbase name="DTableWithTemplateKB" packages="org.drools.examples.decisiontable-template"&gt;
        &lt;ruleTemplate dtable="org/drools/examples/decisiontable-template/ExamplePolicyPricingTemplateData.xls"
                      template="org/drools/examples/decisiontable-template/BasePricing.drt"
                      row="3" col="3"/&gt;
        &lt;ruleTemplate dtable="org/drools/examples/decisiontable-template/ExamplePolicyPricingTemplateData.xls"
                      template="org/drools/examples/decisiontable-template/PromotionalPricing.drt"
                      row="18" col="3"/&gt;
        &lt;ksession name="DTableWithTemplateKS"/&gt;
    &lt;/kbase&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to executing the decision tables using rule template files, you can use the <code>DecisionTableConfiguration</code> object and specify an input spreadsheet as the input type, such as <code>DecisionTableInputType.xls</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DecisionTableConfiguration dtableconfiguration =
    KnowledgeBuilderFactory.newDecisionTableConfiguration();
        dtableconfiguration.setInputType( DecisionTableInputType.XLS );

        KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();

        Resource xlsRes = ResourceFactory.newClassPathResource( "ExamplePolicyPricing.xls",
                                                                getClass() );
        kbuilder.add( xlsRes,
                      ResourceType.DTABLE,
                      dtableconfiguration );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Pricing example uses two fact types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Driver</code></p>
</li>
<li>
<p><code>Policy</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example sets the default values for both facts in their respective Java classes <code>Driver.java</code> and <code>Policy.java</code>. The <code>Driver</code> is 30 years old, has had no prior claims, and currently has a risk profile of <code>LOW</code>. The <code>Policy</code> that the driver is applying for is <code>COMPREHENSIVE</code>.</p>
</div>
<div class="paragraph">
<p>In any decision table, each row is considered a different rule and each column is a condition or an action. Each row is evaluated in a decision table unless the agenda is cleared upon execution.</p>
</div>
<div class="paragraph">
<p>Decision table spreadsheets (XLS or XLSX) require two key areas that define rule data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>RuleSet</code> area</p>
</li>
<li>
<p>A <code>RuleTable</code> area</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>RuleSet</code> area of the spreadsheet defines elements that you want to apply globally to all rules in the same package (not only the spreadsheet), such as a rule set name or universal rule attributes. The <code>RuleTable</code> area defines the actual rules (rows) and the conditions, actions, and other rule attributes (columns) that constitute that rule table within the specified rule set. A decision table spreadsheet can contain multiple <code>RuleTable</code> areas, but only one <code>RuleSet</code> area.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/PricingExample/DT_Config.png" alt="DT Config">
</div>
<div class="title">Figure 365. Decision table configuration</div>
</div>
<div class="paragraph">
<p>The <code>RuleTable</code> area also defines the objects to which the rule attributes apply, in this case <code>Driver</code> and <code>Policy</code>, followed by constraints on the objects. For example, the <code>Driver</code> object constraint that defines the <code>Age Bracket</code> column is <code>age &gt;= $1, age &lt;= $2</code>, where the comma-separated range is defined in the table column values, such as <code>18,24</code>.</p>
</div>
<h4 id="_base_pricing_rules" class="discrete">Base pricing rules</h4>
<div class="paragraph">
<p>The <code>Base pricing rules</code> decision table in the Pricing example evaluates the age, risk profile, number of claims, and policy type of the driver and produces the base price of the policy based on these conditions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/PricingExample/DT_Table1.png" alt="DT Table1">
</div>
<div class="title">Figure 366. Base price calculation</div>
</div>
<div class="paragraph">
<p>The <code>Driver</code> attributes are defined in the following table columns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Age Bracket</code>: The age bracket has a definition for the condition <code>age &gt;=$1, age &lt;=$2</code>, which defines the condition boundaries for the driver&#8217;s age. This condition column highlights the use of <code>$1 and $2</code>, which is comma delimited in the spreadsheet. You can write these values as <code>18,24</code> or <code>18, 24</code> and both formats work in the execution of the business rules.</p>
</li>
<li>
<p><code>Location risk profile</code>: The risk profile is a string that the example program passes always as <code>LOW</code> but can be changed to reflect <code>MED</code> or <code>HIGH</code>.</p>
</li>
<li>
<p><code>Number of prior claims</code>: The number of claims is defined as an integer that the condition column must exactly equal to trigger the action. The value is not a range, only exact matches.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Policy</code> of the decision table is used in both the conditions and the actions of the rule and has attributes defined in the following table columns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Policy type applying for</code>: The policy type is a condition that is passed as a string that defines the type of coverage: <code>COMPREHENSIVE</code>, <code>FIRE_THEFT</code>, or <code>THIRD_PARTY</code>.</p>
</li>
<li>
<p><code>Base $ AUD</code>: The <code>basePrice</code> is defined as an <code>ACTION</code> that sets the price through the constraint <code>policy.setBasePrice($param);</code> based on the spreadsheet cells corresponding to this value. When you execute the corresponding DRL rule for this decision table, the <code>then</code> portion of the rule executes this action statement on the true conditions matching the facts and sets the base price to the corresponding value.</p>
</li>
<li>
<p><code>Record Reason</code>: When the rule successfully executes, this action generates an output message to the <code>System.out</code> console reflecting which rule fired. This is later captured in the application and printed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example also uses the first column on the left to categorize rules. This column is for annotation only and has no affect on rule execution.</p>
</div>
<h4 id="_promotional_discount_rules" class="discrete">Promotional discount rules</h4>
<div class="paragraph">
<p>The <code>Promotional discount rules</code> decision table in the Pricing example evaluates the age, number of prior claims, and policy type of the driver to generate a potential discount on the price of the insurance policy.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/PricingExample/DT_Table2.png" alt="DT Table2">
</div>
<div class="title">Figure 367. Discount calculation</div>
</div>
<div class="paragraph">
<p>This decision table contains the conditions for the discount for which the driver might be eligible. Similar to the base price calculation, this table evaluates the <code>Age</code>, <code>Number of prior claims</code> of the driver, and the <code>Policy type applying for</code> to determine a <code>Discount %</code> rate to be applied. For example, if the driver is 30 years old, has no prior claims, and is applying for a <code>COMPREHENSIVE</code> policy, the driver is given a discount of <code>20</code> percent.</p>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-petstore-ref_drools-examples"><a class="anchor" href="#decision-examples-petstore-ref_drools-examples"></a><a class="link" href="#decision-examples-petstore-ref_drools-examples">20.7. Pet Store example decisions (agenda groups, global variables, callbacks, and GUI integration)</a></h3>
<div class="paragraph">
<p>The Pet Store example decision set demonstrates how to use agenda groups and global variables in rules and how to integrate Drools rules with a graphical user interface (GUI), in this case a Swing-based desktop application. The example also demonstrates how to use callbacks to interact with a running Drools engine to update the GUI based on changes in the working memory at run time.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the Pet Store example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>petstore</code></p>
</li>
<li>
<p><strong>Main class</strong>: <code>org.drools.examples.petstore.PetStoreExample</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule file</strong>: <code>org.drools.examples.petstore.PetStore.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates rule agenda groups, global variables, callbacks, and GUI integration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the Pet Store example, the sample <code>PetStoreExample.java</code> class defines the following principal classes (in addition to several classes to handle Swing events):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Petstore</code> contains the <code>main()</code> method.</p>
</li>
<li>
<p><code>PetStoreUI</code> is responsible for creating and displaying the Swing-based GUI. This class contains several smaller classes, mainly for responding to various GUI events, such as user mouse clicks.</p>
</li>
<li>
<p><code>TableModel</code> holds the table data. This class is essentially a JavaBean that extends the Swing class <code>AbstractTableModel</code>.</p>
</li>
<li>
<p><code>CheckoutCallback</code> enables the GUI to interact with the rules.</p>
</li>
<li>
<p><code>Ordershow</code> keeps the items that you want to buy.</p>
</li>
<li>
<p><code>Purchase</code> stores details of the order and the products that you are buying.</p>
</li>
<li>
<p><code>Product</code> is a JavaBean containing details of the product available for purchase and its price.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Much of the Java code in this example is either plain JavaBean or Swing based. For more information about Swing components, see the Java tutorial on <a href="https://docs.oracle.com/javase/tutorial/uiswing/">Creating a GUI with JFC/Swing</a>.</p>
</div>
<h4 id="_rule_execution_behavior_in_the_pet_store_example" class="discrete">Rule execution behavior in the Pet Store example</h4>
<div class="paragraph">
<p>Unlike other example decision sets where the facts are asserted and fired immediately, the Pet Store example does not execute the rules until more facts are gathered based on user interaction. The example executes rules through a <code>PetStoreUI</code> object, created by a constructor, that accepts the <code>Vector</code> object <code>stock</code> for collecting the products. The example then uses an instance of the <code>CheckoutCallback</code> class containing the rule base that was previously loaded.</p>
</div>
<div class="listingblock">
<div class="title">Pet Store KIE container and fact execution setup</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// KieServices is the factory for all KIE services.
KieServices ks = KieServices.Factory.get();

// Create a KIE container on the class path.
KieContainer kc = ks.getKieClasspathContainer();

// Create the stock.
Vector&lt;Product&gt; stock = new Vector&lt;Product&gt;();
stock.add( new Product( "Gold Fish", 5 ) );
stock.add( new Product( "Fish Tank", 25 ) );
stock.add( new Product( "Fish Food", 2 ) );

// A callback is responsible for populating the working memory and for firing all rules.
PetStoreUI ui = new PetStoreUI( stock,
                                new CheckoutCallback( kc ) );
ui.createAndShowGUI();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java code that fires the rules is in the <code>CheckoutCallBack.checkout()</code> method. This method is triggered when the user clicks <strong>Checkout</strong> in the UI.</p>
</div>
<div class="listingblock">
<div class="title">Rule execution from CheckoutCallBack.checkout()</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String checkout(JFrame frame, List&lt;Product&gt; items) {
    Order order = new Order();

    // Iterate through list and add to cart.
    for ( Product p: items ) {
        order.addItem( new Purchase( order, p ) );
    }

    // Add the JFrame to the ApplicationData to allow for user interaction.

    // From the KIE container, a KIE session is created based on
    // its definition and configuration in the META-INF/kmodule.xml file.
    KieSession ksession = kcontainer.newKieSession("PetStoreKS");

    ksession.setGlobal( "frame", frame );
    ksession.setGlobal( "textArea", this.output );

    ksession.insert( new Product( "Gold Fish", 5 ) );
    ksession.insert( new Product( "Fish Tank", 25 ) );
    ksession.insert( new Product( "Fish Food", 2 ) );

    ksession.insert( new Product( "Fish Food Sample", 0 ) );

    ksession.insert( order );

    // Execute rules.
    ksession.fireAllRules();

    // Return the state of the cart
    return order.toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example code passes two elements into the <code>CheckoutCallBack.checkout()</code> method. One element is the handle for the <code>JFrame</code> Swing component surrounding the output text frame, found at the bottom of the GUI. The second element is a list of order items, which comes from the <code>TableModel</code> that stores the information from the <code>Table</code> area at the upper-right section of the GUI.</p>
</div>
<div class="paragraph">
<p>The <code>for</code> loop transforms the list of order items coming from the GUI into the <code>Order</code> JavaBean, also contained in the file <code>PetStoreExample.java</code>.</p>
</div>
<div class="paragraph">
<p>In this case, the rule is firing in a stateless KIE session because all of the data is stored in Swing components and is not executed until the user clicks <strong>Checkout</strong> in the UI. Each time the user clicks <strong>Checkout</strong>, the content of the list is moved from the Swing <code>TableModel</code> into the KIE session working memory and is then executed with the <code>ksession.fireAllRules()</code> method.</p>
</div>
<div class="paragraph">
<p>Within this code, there are nine calls to <code>KieSession</code>. The first of these creates a new <code>KieSession</code> from the <code>KieContainer</code> (the example passed in this <code>KieContainer</code> from the <code>CheckoutCallBack</code> class in the <code>main()</code> method). The next two calls pass in the two objects that hold the global variables in the rules: the Swing text area and the Swing frame used for writing messages. More inserts put information on products into the <code>KieSession</code>, as well as the order list. The final call is the standard <code>fireAllRules()</code>.</p>
</div>
<h4 id="_pet_store_rule_file_imports_global_variables_and_java_functions" class="discrete">Pet Store rule file imports, global variables, and Java functions</h4>
<div class="paragraph">
<p>The <code>PetStore.drl</code> file contains the standard package and import statements to make various Java classes available to the rules. The rule file also includes <em>global variables</em> to be used within the rules, defined as  <code>frame</code> and <code>textArea</code>. The global variables hold references to the Swing components <code>JFrame</code> and <code>JTextArea</code> components that were previously passed on by the Java code that called the <code>setGlobal()</code> method. Unlike standard variables in rules, which expire as soon as the rule has fired, global variables retain their value for the lifetime of the KIE session. This means the contents of these global variables are available for evaluation on all subsequent rules.</p>
</div>
<div class="listingblock">
<div class="title">PetStore.drl package, imports, and global variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.drools.examples;

import org.kie.api.runtime.KieRuntime;
import org.drools.examples.petstore.PetStoreExample.Order;
import org.drools.examples.petstore.PetStoreExample.Purchase;
import org.drools.examples.petstore.PetStoreExample.Product;
import java.util.ArrayList;
import javax.swing.JOptionPane;

import javax.swing.JFrame;

global JFrame frame
global javax.swing.JTextArea textArea</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PetStore.drl</code> file also contains two functions that the rules in the file use:</p>
</div>
<div class="listingblock">
<div class="title">PetStore.drl Java functions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">function void doCheckout(JFrame frame, KieRuntime krt) {
        Object[] options = {"Yes",
                            "No"};

        int n = JOptionPane.showOptionDialog(frame,
                                             "Would you like to checkout?",
                                             "",
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             null,
                                             options,
                                             options[0]);

       if (n == 0) {
            krt.getAgenda().getAgendaGroup( "checkout" ).setFocus();
       }
}

function boolean requireTank(JFrame frame, KieRuntime krt, Order order, Product fishTank, int total) {
        Object[] options = {"Yes",
                            "No"};

        int n = JOptionPane.showOptionDialog(frame,
                                             "Would you like to buy a tank for your " + total + " fish?",
                                             "Purchase Suggestion",
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             null,
                                             options,
                                             options[0]);

       System.out.print( "SUGGESTION: Would you like to buy a tank for your "
                           + total + " fish? - " );

       if (n == 0) {
             Purchase purchase = new Purchase( order, fishTank );
             krt.insert( purchase );
             order.addItem( purchase );
             System.out.println( "Yes" );
       } else {
            System.out.println( "No" );
       }
       return true;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two functions perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>doCheckout()</code> displays a dialog that asks the user if she or he wants to check out. If the user does, the focus is set to the <code>checkout</code> agenda group, enabling rules in that group to (potentially) fire.</p>
</li>
<li>
<p><code>requireTank()</code> displays a dialog that asks the user if she or he wants to buy a fish tank. If the user does, a new fish tank <code>Product</code> is added to the order list in the working memory.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For this example, all rules and functions are within the same rule file for efficiency. In a production environment, you typically separate the rules and functions in different files or build a static Java method and import the files using the import function, such as <code>import function my.package.name.hello</code>.
</td>
</tr>
</table>
</div>
<h4 id="_pet_store_rules_with_agenda_groups" class="discrete">Pet Store rules with agenda groups</h4>
<div class="paragraph">
<p>Most of the rules in the Pet Store example use agenda groups to control rule execution. Agenda groups allow you to partition the Drools engine agenda to provide more execution control over groups of rules. By default, all rules are in the agenda group <code>MAIN</code>. You can use the <code>agenda-group</code> attribute to specify a different agenda group for the rule.</p>
</div>
<div class="paragraph">
<p>Initially, a working memory has its focus on the agenda group <code>MAIN</code>. Rules in an agenda group only fire when the group receives the focus. You can set the focus either by using the method <code>setFocus()</code> or the rule attribute <code>auto-focus</code>. The <code>auto-focus</code> attribute enables the rule to be given a focus automatically for its agenda group when the rule is matched and activated.</p>
</div>
<div class="paragraph">
<p>The Pet Store example uses the following agenda groups for rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"init"</code></p>
</li>
<li>
<p><code>"evaluate"</code></p>
</li>
<li>
<p><code>"show items"</code></p>
</li>
<li>
<p><code>"checkout"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the sample rule <code>"Explode Cart"</code> uses the <code>"init"</code> agenda group to ensure that it has the option to fire and insert shopping cart items into the KIE session working memory:</p>
</div>
<div class="listingblock">
<div class="title">Rule "Explode Cart"</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Insert each item in the shopping cart into the working memory.
rule "Explode Cart"
    agenda-group "init"
    auto-focus true
    salience 10
  when
    $order : Order( grossTotal == -1 )
    $item : Purchase() from $order.items
  then
    insert( $item );
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "show items" ).setFocus();
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "evaluate" ).setFocus();
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule matches against all orders that do not yet have their <code>grossTotal</code> calculated. The execution loops for each purchase item in that order.</p>
</div>
<div class="paragraph">
<p>The rule uses the following features related to its agenda group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>agenda-group "init"</code> defines the name of the agenda group. In this case, only one rule is in the group. However, neither the Java code nor a rule consequence sets the focus to this group, and therefore it relies on the <code>auto-focus</code> attribute for its chance to fire.</p>
</li>
<li>
<p><code>auto-focus true</code> ensures that this rule, while being the only rule in the agenda group, gets a chance to fire when <code>fireAllRules()</code> is called from the Java code.</p>
</li>
<li>
<p><code>kcontext&#8230;&#8203;.setFocus()</code> sets the focus to the <code>"show items"</code> and <code>"evaluate"</code> agenda groups, enabling their rules to fire. In practice, you loop through all items in the order, insert them into memory, and then fire the other rules after each insertion.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>"show items"</code> agenda group contains only one rule, <code>"Show Items"</code>. For each purchase in the order currently in the KIE session working memory, the rule logs details to the text area at the bottom of the GUI, based on the <code>textArea</code> variable defined in the rule file.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Show Items"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Show Items"
    agenda-group "show items"
  when
    $order : Order()
    $p : Purchase( order == $order )
  then
   textArea.append( $p.product + "\n");
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>"evaluate"</code> agenda group also gains focus from the <code>"Explode Cart"</code> rule. This agenda group contains two rules, <code>"Free Fish Food Sample"</code> and <code>"Suggest Tank"</code>, which are executed in that order.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Free Fish Food Sample"</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Free fish food sample when users buy a goldfish if they did not already buy
// fish food and do not already have a fish food sample.
rule "Free Fish Food Sample"
    agenda-group "evaluate" <i class="conum" data-value="1"></i><b>(1)</b>
  when
    $order : Order()
    not ( $p : Product( name == "Fish Food") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="2"></i><b>(2)</b>
    not ( $p : Product( name == "Fish Food Sample") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="3"></i><b>(3)</b>
    exists ( $p : Product( name == "Gold Fish") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="4"></i><b>(4)</b>
    $fishFoodSample : Product( name == "Fish Food Sample" );
  then
    System.out.println( "Adding free Fish Food Sample to cart" );
    purchase = new Purchase($order, $fishFoodSample);
    insert( purchase );
    $order.addItem( purchase );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"Free Fish Food Sample"</code> fires only if all of the following conditions are true:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The agenda group <code>"evaluate"</code> is being evaluated in the rules execution.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>User does not already have fish food.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>User does not already have a free fish food sample.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>User has a goldfish in the order.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the order facts meet all of these requirements, then a new product is created (Fish Food Sample) and is added to the order in working memory.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Suggest Tank"</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Suggest a fish tank if users buy more than five goldfish and
// do not already have a tank.
rule "Suggest Tank"
    agenda-group "evaluate"
  when
    $order : Order()
    not ( $p : Product( name == "Fish Tank") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="1"></i><b>(1)</b>
    ArrayList( $total : size &gt; 5 ) from collect( Purchase( product.name == "Gold Fish" ) ) <i class="conum" data-value="2"></i><b>(2)</b>
    $fishTank : Product( name == "Fish Tank" )
  then
    requireTank(frame, kcontext.getKieRuntime(), $order, $fishTank, $total);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"Suggest Tank"</code> fires only if the following conditions are true:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>User does not have a fish tank in the order.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>User has more than five fish in the order.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the rule fires, it calls the <code>requireTank()</code> function defined in the rule file. This function displays a dialog that asks the user if she or he wants to buy a fish tank. If the user does, a new fish tank <code>Product</code> is added to the order list in the working memory. When the rule calls the <code>requireTank()</code> function, the rule passes the <code>frame</code> global variable so that the function has a handle for the Swing GUI.</p>
</div>
<div class="paragraph">
<p>The <code>"do checkout"</code> rule in the Pet Store example has no agenda group and no <code>when</code> conditions, so the rule is always executed and considered part of the default <code>MAIN</code> agenda group.</p>
</div>
<div class="listingblock">
<div class="title">Rule "do checkout"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "do checkout"
  when
  then
    doCheckout(frame, kcontext.getKieRuntime());
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the rule fires, it calls the <code>doCheckout()</code> function defined in the rule file. This function displays a dialog that asks the user if she or he wants to check out. If the user does, the focus is set to the <code>checkout</code> agenda group, enabling rules in that group to (potentially) fire. When the rule calls the <code>doCheckout()</code> function, the rule passes the <code>frame</code> global variable so that the function has a handle for the Swing GUI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example also demonstrates a troubleshooting technique if results are not executing as you expect: You can remove the conditions from the <code>when</code> statement of a rule and test the action in the <code>then</code> statement to verify that the action is performed correctly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>"checkout"</code> agenda group contains three rules for processing the order checkout and applying any discounts: <code>"Gross Total"</code>, <code>"Apply 5% Discount"</code>, and <code>"Apply 10% Discount"</code>.</p>
</div>
<div class="listingblock">
<div class="title">Rules "Gross Total", "Apply 5% Discount", and "Apply 10% Discount"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Gross Total"
    agenda-group "checkout"
  when
    $order : Order( grossTotal == -1)
    Number( total : doubleValue ) from accumulate( Purchase( $price : product.price ),
                                                              sum( $price ) )
  then
    modify( $order ) { grossTotal = total }
    textArea.append( "\ngross total=" + total + "\n" );
end

rule "Apply 5% Discount"
    agenda-group "checkout"
  when
    $order : Order( grossTotal &gt;= 10 &amp;&amp; &lt; 20 )
  then
    $order.discountedTotal = $order.grossTotal * 0.95;
    textArea.append( "discountedTotal total=" + $order.discountedTotal + "\n" );
end

rule "Apply 10% Discount"
    agenda-group "checkout"
  when
    $order : Order( grossTotal &gt;= 20 )
  then
    $order.discountedTotal = $order.grossTotal * 0.90;
    textArea.append( "discountedTotal total=" + $order.discountedTotal + "\n" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user has not already calculated the gross total, the <code>Gross Total</code> accumulates the product prices into a total, puts this total into the KIE session, and displays it through the Swing <code>JTextArea</code> using the <code>textArea</code> global variable.</p>
</div>
<div class="paragraph">
<p>If the gross total is between <code>10</code> and <code>20</code> (currency units), the <code>"Apply 5% Discount"</code> rule calculates the discounted total, adds it to the KIE session, and displays it in the text area.</p>
</div>
<div class="paragraph">
<p>If the gross total is not less than <code>20</code>, the <code>"Apply 10% Discount"</code> rule calculates the discounted total, adds it to the KIE session, and displays it in the text area.</p>
</div>
<h4 id="_pet_store_example_execution" class="discrete">Pet Store example execution</h4>
<div class="paragraph">
<p>Similar to other Drools decision examples, you execute the Pet Store example by running the <code>org.drools.examples.petstore.PetStoreExample</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>When you execute the Pet Store example, the <code>Pet Store Demo</code> GUI window appears. This window displays a list of available products (upper left), an empty list of selected products (upper right), <strong>Checkout</strong> and <strong>Reset</strong> buttons (middle), and an empty system messages area (bottom).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/PetStoreExample/1-PetStore-Start-Screen.png" alt="1 PetStore Start Screen">
</div>
<div class="title">Figure 368. Pet Store example GUI after launch</div>
</div>
<div class="paragraph">
<p>The following events occurred in this example to establish this execution behavior:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>main()</code> method has run and loaded the rule base but has not yet fired the rules. So far, this is the only code in connection with rules that has been run.</p>
</li>
<li>
<p>A new <code>PetStoreUI</code> object has been created and given a handle for the rule base, for later use.</p>
</li>
<li>
<p>Various Swing components have performed their functions, and the initial UI screen is displayed and waits for user input.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can click various products from the list to explore the UI setup:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/PetStoreExample/2-stock-added-to-order-list.png" alt="2 stock added to order list">
</div>
<div class="title">Figure 369. Explore the Pet Store example GUI</div>
</div>
<div class="paragraph">
<p>No rules code has been fired yet. The UI uses Swing code to detect user mouse clicks and add selected products to the <code>TableModel</code> object for display in the upper-right corner of the UI. This example illustrates the Model-View-Controller design pattern.</p>
</div>
<div class="paragraph">
<p>When you click <strong>Checkout</strong>, the rules are then fired in the following way:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Method <code>CheckOutCallBack.checkout()</code> is called (eventually) by the Swing class waiting for a user to click <strong>Checkout</strong>. This inserts the data from the <code>TableModel</code> object (upper-right corner of the UI) into the KIE session working memory. The method then fires the rules.</p>
</li>
<li>
<p>The <code>"Explode Cart"</code> rule is the first to fire, with the <code>auto-focus</code> attribute set to <code>true</code>. The rule loops through all of the products in the cart, ensures that the products are in the working memory, and then gives the <code>"show Items"</code> and <code>"evaluate"</code> agenda groups the option to fire. The rules in these groups add the contents of the cart to the text area (bottom of the UI), evaluate if you are eligible for free fish food, and determine whether to ask if you want to buy a fish tank.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/PetStoreExample/3-purchase-suggestion.png" alt="3 purchase suggestion">
</div>
<div class="title">Figure 370. Fish tank qualification</div>
</div>
</li>
<li>
<p>The <code>"do checkout"</code> rule is the next to fire because no other agenda group currently has focus and because it is part of the default <code>MAIN</code> agenda group. This rule always calls the <code>doCheckout()</code> function, which asks you if you want to check out.</p>
</li>
<li>
<p>The <code>doCheckout()</code> function sets the focus to the <code>"checkout"</code> agenda group, giving the rules in that group the option to fire.</p>
</li>
<li>
<p>The rules in the <code>"checkout"</code> agenda group display the contents of the cart and apply the appropriate discount.</p>
</li>
<li>
<p>Swing then waits for user input to either select more products (and cause the rules to fire again) or to close the UI.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/PetStoreExample/4-Petstore-final-screen.png" alt="4 Petstore final screen">
</div>
<div class="title">Figure 371. Pet Store example GUI after all rules have fired</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can add more <code>System.out</code> calls to demonstrate this flow of events in your IDE console:</p>
</div>
<div class="listingblock">
<div class="title">System.out output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>Adding free Fish Food Sample to cart
SUGGESTION: Would you like to buy a tank for your 6 fish? - Yes</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-politician-ref_drools-examples"><a class="anchor" href="#decision-examples-politician-ref_drools-examples"></a><a class="link" href="#decision-examples-politician-ref_drools-examples">20.8. Honest Politician example decisions (truth maintenance and salience)</a></h3>
<div class="paragraph">
<p>The Honest Politician example decision set demonstrates the concept of truth maintenance with logical insertions and the use of salience in rules.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the Honest Politician example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>honestpolitician</code></p>
</li>
<li>
<p><strong>Main class</strong>: <code>org.drools.examples.honestpolitician.HonestPoliticianExample</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule file</strong>: <code>org.drools.examples.honestpolitician.HonestPolitician.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates the concept of truth maintenance based on the logical insertion of facts and the use of salience in rules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basic premise of the Honest Politician example is that an object can only exist while a statement is true. A rule consequence can logically insert an object with the <code>insertLogical()</code> method. This means the object remains in the KIE session working memory as long as the rule that logically inserted it remains true. When the rule is no longer true, the object is automatically retracted.</p>
</div>
<div class="paragraph">
<p>In this example, rule execution causes a group of politicians to change from being honest to being dishonest as a result of a corrupt corporation. As each politician is evaluated, they start out with their honesty attribute being set to <code>true</code>, but a rule fires that makes the politicians no longer honest. As they switch their state from being honest to dishonest, they are then removed from the working memory. The rule salience notifies the Drools engine how to prioritize any rules that have a salience defined for them, otherwise utilizing the default salience value of <code>0</code>. Rules with a higher salience value are given higher priority when ordered in the activation queue.</p>
</div>
<h4 id="_politician_and_hope_classes" class="discrete">Politician and Hope classes</h4>
<div class="paragraph">
<p>The sample class <code>Politician</code> in the example is configured for an honest politician. The <code>Politician</code> class is made up of a String item <code>name</code> and a Boolean item <code>honest</code>:</p>
</div>
<div class="listingblock">
<div class="title">Politician class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Politician {
    private String name;
    private boolean honest;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Hope</code> class determines if a <code>Hope</code> object exists. This class has no meaningful members, but is present in the working memory as long as society has hope.</p>
</div>
<div class="listingblock">
<div class="title">Hope class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Hope {

    public Hope() {

    }
  }</code></pre>
</div>
</div>
<h4 id="_rule_definitions_for_politician_honesty" class="discrete">Rule definitions for politician honesty</h4>
<div class="paragraph">
<p>In the Honest Politician example, when at least one honest politician exists in the working memory, the <code>"We have an honest Politician"</code> rule logically inserts a new <code>Hope</code> object. As soon as all politicians become dishonest, the <code>Hope</code> object is automatically retracted. This rule has a <code>salience</code> attribute with a value of <code>10</code> to ensure that it fires before any other rule, because at that stage the <code>"Hope is Dead"</code> rule is true.</p>
</div>
<div class="listingblock">
<div class="title">Rule "We have an honest politician"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "We have an honest Politician"
    salience 10
  when
    exists( Politician( honest == true ) )
  then
    insertLogical( new Hope() );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>As soon as a <code>Hope</code> object exists, the <code>"Hope Lives"</code> rule matches and fires. This rule also has a <code>salience</code> value of <code>10</code> so that it takes priority over the <code>"Corrupt the Honest"</code> rule.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Hope Lives"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Hope Lives"
    salience 10
  when
    exists( Hope() )
  then
    System.out.println("Hurrah!!! Democracy Lives");
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initially, four honest politicians exist so this rule has four activations, all in conflict. Each rule fires in turn, corrupting each politician so that they are no longer honest. When all four politicians have been corrupted, no politicians have the property <code>honest == true</code>. The rule <code>"We have an honest Politician"</code> is no longer true and the object it logically inserted (due to the last execution of <code>new Hope()</code>) is automatically retracted.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Corrupt the Honest"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Corrupt the Honest"
  when
    politician : Politician( honest == true )
    exists( Hope() )
  then
    System.out.println( "I'm an evil corporation and I have corrupted " + politician.getName() );
    modify ( politician ) { honest = false };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <code>Hope</code> object automatically retracted through the truth maintenance system, the conditional element <code>not</code> applied to <code>Hope</code> is no longer true so that the <code>"Hope is Dead"</code> rule matches and fires.</p>
</div>
<div class="listingblock">
<div class="title">Rule "Hope is Dead"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Hope is Dead"
  when
    not( Hope() )
  then
    System.out.println( "We are all Doomed!!! Democracy is Dead" );
end</code></pre>
</div>
</div>
<h4 id="_example_execution_and_audit_trail" class="discrete">Example execution and audit trail</h4>
<div class="paragraph">
<p>In the <code>HonestPoliticianExample.java</code> class, the four politicians with the honest state set to <code>true</code> are inserted for evaluation against the defined business rules:</p>
</div>
<div class="listingblock">
<div class="title">HonestPoliticianExample.java class execution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static void execute( KieContainer kc ) {
        KieSession ksession = kc.newKieSession("HonestPoliticianKS");

        final Politician p1 = new Politician( "President of Umpa Lumpa", true );
        final Politician p2 = new Politician( "Prime Minster of Cheeseland", true );
        final Politician p3 = new Politician( "Tsar of Pringapopaloo", true );
        final Politician p4 = new Politician( "Omnipotence Om", true );

        ksession.insert( p1 );
        ksession.insert( p2 );
        ksession.insert( p3 );
        ksession.insert( p4 );

        ksession.fireAllRules();

        ksession.dispose();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute the example, run the <code>org.drools.examples.honestpolitician.HonestPoliticianExample</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>After the execution, the following output appears in the IDE console window:</p>
</div>
<div class="listingblock">
<div class="title">Execution output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>Hurrah!!! Democracy Lives
I'm an evil corporation and I have corrupted President of Umpa Lumpa
I'm an evil corporation and I have corrupted Prime Minster of Cheeseland
I'm an evil corporation and I have corrupted Tsar of Pringapopaloo
I'm an evil corporation and I have corrupted Omnipotence Om
We are all Doomed!!! Democracy is Dead</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output shows that, while there is at least one honest politician, democracy lives. However, as each politician is corrupted by some corporation, all politicians become dishonest, and democracy is dead.</p>
</div>
<div class="paragraph">
<p>To better understand the execution flow of this example, you can modify the <code>HonestPoliticianExample.java</code> class to include a <code>DebugRuleRuntimeEventListener</code> listener and an audit logger to view execution details:</p>
</div>
<div class="listingblock">
<div class="title">HonestPoliticianExample.java class with an audit logger</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.drools.examples.honestpolitician;

import org.kie.api.KieServices;
import org.kie.api.event.rule.DebugAgendaEventListener; <i class="conum" data-value="1"></i><b>(1)</b>
import org.kie.api.event.rule.DebugRuleRuntimeEventListener;
import org.kie.api.runtime.KieContainer;
import org.kie.api.runtime.KieSession;

public class HonestPoliticianExample {

    /**
     * @param args
     */
    public static void main(final String[] args) {
    	KieServices ks = KieServices.Factory.get(); <i class="conum" data-value="2"></i><b>(2)</b>
    	//ks = KieServices.Factory.get();
        KieContainer kc = KieServices.Factory.get().getKieClasspathContainer();
        System.out.println(kc.verify().getMessages().toString());
        //execute( kc );
        execute( ks, kc); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    public static void execute( KieServices ks, KieContainer kc ) { <i class="conum" data-value="4"></i><b>(4)</b>
        KieSession ksession = kc.newKieSession("HonestPoliticianKS");

        final Politician p1 = new Politician( "President of Umpa Lumpa", true );
        final Politician p2 = new Politician( "Prime Minster of Cheeseland", true );
        final Politician p3 = new Politician( "Tsar of Pringapopaloo", true );
        final Politician p4 = new Politician( "Omnipotence Om", true );

        ksession.insert( p1 );
        ksession.insert( p2 );
        ksession.insert( p3 );
        ksession.insert( p4 );

        // The application can also setup listeners <i class="conum" data-value="5"></i><b>(5)</b>
        ksession.addEventListener( new DebugAgendaEventListener() );
        ksession.addEventListener( new DebugRuleRuntimeEventListener() );

        // Set up a file-based audit logger.
        ks.getLoggers().newFileLogger( ksession, "./target/honestpolitician" ); <i class="conum" data-value="6"></i><b>(6)</b>

        ksession.fireAllRules();

        ksession.dispose();
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adds to your imports the packages that handle the <code>DebugAgendaEventListener</code> and <code>DebugRuleRuntimeEventListener</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates a <code>KieServices Factory</code> and a <code>ks</code> element to produce the logs because this audit log is not available at the <code>KieContainer</code> level</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Modifies the <code>execute</code> method to use both <code>KieServices</code> and <code>KieContainer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Modifies the <code>execute</code> method to pass in <code>KieServices</code> in addition to the <code>KieContainer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Creates the listeners</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Builds the log that can be passed into the debug view or <strong>Audit View</strong> or your IDE after executing of the rules</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you run the Honest Politician with this modified logging capability, you can load the audit log file from <code>target/honestpolitician.log</code> into your IDE debug view or <strong>Audit View</strong>, if available (for example, in <strong>Window</strong> &#8594; <strong>Show View</strong> in some IDEs).</p>
</div>
<div class="paragraph">
<p>In this example, the <strong>Audit View</strong> shows the flow of executions, insertions, and retractions as defined in the example classes and rules:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/HonestPoliticianExample/honest_politician_audit.png" alt="honest politician audit">
</div>
<div class="title">Figure 372. Honest Politician example Audit View</div>
</div>
<div class="paragraph">
<p>When the first politician is inserted, two activations occur. The rule <code>"We have an honest Politician"</code> is activated only one time for the first inserted politician because it uses an <code>exists</code> conditional element, which matches when at least one politician is inserted. The rule <code>"Hope is Dead"</code> is also activated at this stage because the <code>Hope</code> object is not yet inserted. The rule <code>"We have an honest Politician"</code> fires first because it has a higher <code>salience</code> value than the rule <code>"Hope is Dead"</code>, and inserts the <code>Hope</code> object (highlighted in green). The insertion of the <code>Hope</code> object activates the rule <code>"Hope Lives"</code> and deactivates the rule <code>"Hope is Dead"</code>. The insertion also activates the rule <code>"Corrupt the Honest"</code> for each inserted honest politician. The rule <code>"Hope Lives"</code> is executed and prints <code>"Hurrah!!! Democracy Lives"</code>.</p>
</div>
<div class="paragraph">
<p>Next, for each politician, the rule <code>"Corrupt the Honest"</code> fires, printing <code>"I&#8217;m an evil corporation and I have corrupted X"</code>, where <code>X</code> is the name of the politician, and modifies the politician honesty value to <code>false</code>. When the last honest politician is corrupted, <code>Hope</code> is automatically retracted by the truth maintenance system (highlighted in blue). The green highlighted area shows the origin of the currently selected blue highlighted area. After the <code>Hope</code> fact is retracted, the rule <code>"Hope is dead"</code> fires, printing <code>"We are all Doomed!!! Democracy is Dead"</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-sudoku-ref_drools-examples"><a class="anchor" href="#decision-examples-sudoku-ref_drools-examples"></a><a class="link" href="#decision-examples-sudoku-ref_drools-examples">20.9. Sudoku example decisions (complex pattern matching, callbacks, and GUI integration)</a></h3>
<div class="paragraph">
<p>The Sudoku example decision set, based on the popular number puzzle Sudoku, demonstrates how to use rules in Drools to find a solution in a large potential solution space based on various constraints. This example also shows how to integrate Drools rules into a graphical user interface (GUI), in this case a Swing-based desktop application, and how to use callbacks to interact with a running Drools engine to update the GUI based on changes in the working memory at run time.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the Sudoku example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>sudoku</code></p>
</li>
<li>
<p><strong>Main class</strong>: <code>org.drools.examples.sudoku.SudokuExample</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule files</strong>: <code>org.drools.examples.sudoku.*.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates complex pattern matching, problem solving, callbacks, and GUI integration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sudoku is a logic-based number placement puzzle. The objective is to fill a 9x9 grid so that each column, each row, and each of the nine 3x3 zones contains the digits from 1 to 9 only one time. The puzzle setter provides a partially completed grid and the puzzle solver&#8217;s task is to complete the grid with these constraints.</p>
</div>
<div class="paragraph">
<p>The general strategy to solve the problem is to ensure that when you insert a new number, it must be unique in its particular 3x3 zone, row, and column. This Sudoku example decision set uses Drools rules to solve Sudoku puzzles from a range of difficulty levels, and to attempt to resolve flawed puzzles that contain invalid entries.</p>
</div>
<h4 id="_sudoku_example_execution_and_interaction" class="discrete">Sudoku example execution and interaction</h4>
<div class="paragraph">
<p>Similar to other Drools decision examples, you execute the Sudoku example by running the <code>org.drools.examples.sudoku.SudokuExample</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>When you execute the Sudoku example, the <code>Drools Sudoku Example</code> GUI window appears. This window contains an empty grid, but the program comes with various grids stored internally that you can load and solve.</p>
</div>
<div class="paragraph">
<p>Click <strong>File</strong> &#8594; <strong>Samples</strong> &#8594; <strong>Simple</strong> to load one of the examples. Notice that all buttons are disabled until a grid is loaded.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku1.png" alt="sudoku1">
</div>
<div class="title">Figure 373. Sudoku example GUI after launch</div>
</div>
<div class="paragraph">
<p>When you load the <strong>Simple</strong> example, the grid is filled according to the puzzle&#8217;s initial state.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku2.png" alt="sudoku2">
</div>
<div class="title">Figure 374. Sudoku example GUI after loading Simple sample</div>
</div>
<div class="paragraph">
<p>Choose from the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Solve</strong> to fire the rules defined in the Sudoku example that fill out the remaining values and that make the buttons inactive again.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku3.png" alt="sudoku3">
</div>
<div class="title">Figure 375. Simple sample solved</div>
</div>
</li>
<li>
<p>Click <strong>Step</strong> to see the next digit found by the rule set. The console window in your IDE displays detailed information about the rules that are executing to solve the step.</p>
<div class="listingblock">
<div class="title">Step execution output in the IDE console</div>
<div class="content">
<pre>single 8 at [0,1]
column elimination due to [1,2]: remove 9 from [4,2]
hidden single 9 at [1,2]
row elimination due to [2,8]: remove 7 from [2,4]
remove 6 from [3,8] due to naked pair at [3,2] and [3,7]
hidden pair in row at [4,6] and [4,4]</pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Dump</strong> to see the state of the grid, with cells showing either the established value or the remaining possibilities.</p>
<div class="listingblock">
<div class="title">Dump execution output in the IDE console</div>
<div class="content">
<pre>        Col: 0     Col: 1     Col: 2     Col: 3     Col: 4     Col: 5     Col: 6     Col: 7     Col: 8
Row 0:  123456789  --- 5 ---  --- 6 ---  --- 8 ---  123456789  --- 1 ---  --- 9 ---  --- 4 ---  123456789
Row 1:  --- 9 ---  123456789  123456789  --- 6 ---  123456789  --- 5 ---  123456789  123456789  --- 3 ---
Row 2:  --- 7 ---  123456789  123456789  --- 4 ---  --- 9 ---  --- 3 ---  123456789  123456789  --- 8 ---
Row 3:  --- 8 ---  --- 9 ---  --- 7 ---  123456789  --- 4 ---  123456789  --- 6 ---  --- 3 ---  --- 5 ---
Row 4:  123456789  123456789  --- 3 ---  --- 9 ---  123456789  --- 6 ---  --- 8 ---  123456789  123456789
Row 5:  --- 4 ---  --- 6 ---  --- 5 ---  123456789  --- 8 ---  123456789  --- 2 ---  --- 9 ---  --- 1 ---
Row 6:  --- 5 ---  123456789  123456789  --- 2 ---  --- 6 ---  --- 9 ---  123456789  123456789  --- 7 ---
Row 7:  --- 6 ---  123456789  123456789  --- 5 ---  123456789  --- 4 ---  123456789  123456789  --- 9 ---
Row 8:  123456789  --- 4 ---  --- 9 ---  --- 7 ---  123456789  --- 8 ---  --- 3 ---  --- 5 ---  123456789</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Sudoku example includes a deliberately broken sample file that the rules defined in the example can resolve.</p>
</div>
<div class="paragraph">
<p>Click <strong>File</strong> &#8594; <strong>Samples</strong> &#8594; <strong>!DELIBERATELY BROKEN!</strong> to load the broken sample. The grid starts with some issues, for example, the value <code>5</code> appears two times in the first row, which is not allowed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku4.png" alt="sudoku4">
</div>
<div class="title">Figure 376. Broken Sudoku example initial state</div>
</div>
<div class="paragraph">
<p>Click <strong>Solve</strong> to apply the solving rules to this invalid grid. The associated solving rules in the Sudoku example detect the issues in the sample and attempts to solve the puzzle as far as possible. This process does not complete and leaves some cells empty.</p>
</div>
<div class="paragraph">
<p>The solving rule activity is displayed in the IDE console window:</p>
</div>
<div class="listingblock">
<div class="title">Detected issues in the broken sample</div>
<div class="content">
<pre>cell [0,8]: 5 has a duplicate in row 0
cell [0,0]: 5 has a duplicate in row 0
cell [6,0]: 8 has a duplicate in col 0
cell [4,0]: 8 has a duplicate in col 0
Validation complete.</pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku5.png" alt="sudoku5">
</div>
<div class="title">Figure 377. Broken sample solution attempt</div>
</div>
<div class="paragraph">
<p>The sample Sudoku files labeled <strong>Hard</strong> are more complex and the solving rules might not be able to solve them. The unsuccessful solution attempt is displayed in the IDE console window:</p>
</div>
<div class="listingblock">
<div class="title">Hard sample unresolved</div>
<div class="content">
<pre>Validation complete.
...
Sorry - can't solve this grid.</pre>
</div>
</div>
<div class="paragraph">
<p>The rules that work to solve the broken sample implement standard solving techniques based on the sets of values that are still candidates for a cell. For example, if a set contains a single value, then this is the value for the cell. For a single occurrence of a value in one of the groups of nine cells, the rules insert a fact of type <code>Setting</code> with the solution value for some specific cell. This fact causes the elimination of this value from all other cells in any of the groups the cell belongs to and the value is retracted.</p>
</div>
<div class="paragraph">
<p>Other rules in the example reduce the permissible values for some cells. The rules <code>"naked pair"</code>, <code>"hidden pair in row"</code>, <code>"hidden pair in column"</code>, and <code>"hidden pair in square"</code> eliminate possibilities but do not establish solutions. The rules <code>"X-wings in rows"</code>, "`X-wings in columns"`, <code>"intersection removal row"</code>, and <code>"intersection removal column"</code> perform more sophisticated eliminations.</p>
</div>
<h4 id="_sudoku_example_classes" class="discrete">Sudoku example classes</h4>
<div class="paragraph">
<p>The package <code>org.drools.examples.sudoku.swing</code> contains the following core set of classes that implement a framework for Sudoku puzzles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>SudokuGridModel</code> class defines an interface that is implemented to store a Sudoku puzzle as a 9x9 grid of <code>Cell</code> objects.</p>
</li>
<li>
<p>The <code>SudokuGridView</code> class is a Swing component that can visualize any implementation of the <code>SudokuGridModel</code> class.</p>
</li>
<li>
<p>The <code>SudokuGridEvent</code> and <code>SudokuGridListener</code> classes communicate state changes between the model and the view. Events are fired when a cell value is resolved or changed.</p>
</li>
<li>
<p>The <code>SudokuGridSamples</code> class provides partially filled Sudoku puzzles for demonstration purposes.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This package does not have any dependencies on Drools libraries.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The package <code>org.drools.examples.sudoku</code> contains the following core set of classes that implement the elementary <code>Cell</code> object and its various aggregations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>CellFile</code> class, with subtypes <code>CellRow</code>, <code>CellCol</code>, and <code>CellSqr</code>, all of which are subtypes of the <code>CellGroup</code> class.</p>
</li>
<li>
<p>The <code>Cell</code> and <code>CellGroup</code> subclasses of <code>SetOfNine</code>, which provides a property <code>free</code> with the type <code>Set&lt;Integer&gt;</code>. For a <code>Cell</code> class, the set represents the individual candidate set. For a <code>CellGroup</code> class, the set is the union of all candidate sets of its cells (the set of digits that still need to be allocated).</p>
<div class="paragraph">
<p>In the Sudoku example are 81 <code>Cell</code> and 27 <code>CellGroup</code> objects and a linkage provided by the <code>Cell</code> properties <code>cellRow</code>, <code>cellCol</code>, and <code>cellSqr</code>, and by the <code>CellGroup</code> property <code>cells</code> (a list of <code>Cell</code> objects). With these components, you can write rules that detect the specific situations that permit the allocation of a value to a cell or the elimination of a value from some candidate set.</p>
</div>
</li>
<li>
<p>The <code>Setting</code> class is used to trigger the operations that accompany the allocation of a value. The presence of a <code>Setting</code> fact is used in all rules that detect a new situation in order to avoid reactions to inconsistent intermediary states.</p>
</li>
<li>
<p>The <code>Stepping</code> class is used in a low priority rule to execute an emergency halt when a <code>"Step"</code> does not terminate regularly. This behavior indicates that the program cannot solve the puzzle.</p>
</li>
<li>
<p>The main class <code>org.drools.examples.sudoku.SudokuExample</code> implements a Java application combining all of these components.</p>
</li>
</ul>
</div>
<h4 id="_sudoku_validation_rules_validate_drl" class="discrete">Sudoku validation rules (validate.drl)</h4>
<div class="paragraph">
<p>The <code>validate.drl</code> file in the Sudoku example contains validation rules that detect duplicate numbers in cell groups. They are combined in a <code>"validate"</code> agenda group that enables the rules to be explicitly activated after a user loads the puzzle.</p>
</div>
<div class="paragraph">
<p>The <code>when</code> conditions of the three rules <code>"duplicate in cell &#8230;&#8203;"</code> all function in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first condition in the rule locates a cell with an allocated value.</p>
</li>
<li>
<p>The second condition in the rule pulls in any of the three cell groups to which the cell belongs.</p>
</li>
<li>
<p>The final condition finds a cell (other than the first one) with the same value as the first cell and in the same row, column, or square, depending on the rule.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Rules "duplicate in cell &#8230;&#8203;"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "duplicate in cell row"
  when
    $c: Cell( $v: value != null )
    $cr: CellRow( cells contains $c )
    exists Cell( this != $c, value == $v, cellRow == $cr )
  then
    System.out.println( "cell " + $c.toString() + " has a duplicate in row " + $cr.getNumber() );
end

rule "duplicate in cell col"
  when
    $c: Cell( $v: value != null )
    $cc: CellCol( cells contains $c )
    exists Cell( this != $c, value == $v, cellCol == $cc )
  then
    System.out.println( "cell " + $c.toString() + " has a duplicate in col " + $cc.getNumber() );
end

rule "duplicate in cell sqr"
  when
    $c: Cell( $v: value != null )
    $cs: CellSqr( cells contains $c )
    exists Cell( this != $c, value == $v, cellSqr == $cs )
  then
    System.out.println( "cell " + $c.toString() + " has duplicate in its square of nine." );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"terminate group"</code> is the last to fire. This rule prints a message and stops the sequence.</p>
</div>
<div class="listingblock">
<div class="title">Rule "terminate group"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "terminate group"
    salience -100
  when
  then
    System.out.println( "Validation complete." );
    drools.halt();
end</code></pre>
</div>
</div>
<h4 id="_sudoku_solving_rules_sudoku_drl" class="discrete">Sudoku solving rules (sudoku.drl)</h4>
<div class="paragraph">
<p>The <code>sudoku.drl</code> file in the Sudoku example contains three types of rules: one group handles the allocation of a number to a cell, another group detects feasible allocations, and the third group eliminates values from candidate sets.</p>
</div>
<div class="paragraph">
<p>The rules  <code>"set a value"</code>, <code>"eliminate a value from Cell"</code>, and <code>"retract setting"</code> depend on the presence of a <code>Setting</code> object. The first rule handles the assignment to the cell and the operations for removing the value from the <code>free</code> sets of the three groups of the cell. This group also reduces a counter that, when zero, returns control to the Java application that has called <code>fireUntilHalt()</code>.</p>
</div>
<div class="paragraph">
<p>The purpose of the rule <code>"eliminate a value from Cell"</code> is to reduce the candidate lists of all cells that are related to the newly assigned cell. Finally, when all eliminations have been made, the rule <code>"retract setting"</code> retracts the triggering <code>Setting</code> fact.</p>
</div>
<div class="listingblock">
<div class="title">Rules "set a value", "eliminate a value from a Cell", and "retract setting"</div>
<div class="content">
<pre class="highlightjs highlight"><code>// A Setting object is inserted to define the value of a Cell.
// Rule for updating the cell and all cell groups that contain it
rule "set a value"
  when
    // A Setting with row and column number, and a value
    $s: Setting( $rn: rowNo, $cn: colNo, $v: value )

    // A matching Cell, with no value set
    $c: Cell( rowNo == $rn, colNo == $cn, value == null,
              $cr: cellRow, $cc: cellCol, $cs: cellSqr )

    // Count down
    $ctr: Counter( $count: count )
  then
    // Modify the Cell by setting its value.
    modify( $c ){ setValue( $v ) }
    // System.out.println( "set cell " + $c.toString() );
    modify( $cr ){ blockValue( $v ) }
    modify( $cc ){ blockValue( $v ) }
    modify( $cs ){ blockValue( $v ) }
    modify( $ctr ){ setCount( $count - 1 ) }
end

// Rule for removing a value from all cells that are siblings
// in one of the three cell groups
rule "eliminate a value from Cell"
  when
    // A Setting with row and column number, and a value
    $s: Setting( $rn: rowNo, $cn: colNo, $v: value )

    // The matching Cell, with the value already set
    Cell( rowNo == $rn, colNo == $cn, value == $v, $exCells: exCells )

    // For all Cells that are associated with the updated cell
    $c: Cell( free contains $v ) from $exCells
  then
    // System.out.println( "clear " + $v + " from cell " + $c.posAsString()  );
    // Modify a related Cell by blocking the assigned value.
    modify( $c ){ blockValue( $v ) }
end

// Rule for eliminating the Setting fact
rule "retract setting"
  when
    // A Setting with row and column number, and a value
    $s: Setting( $rn: rowNo, $cn: colNo, $v: value )

    // The matching Cell, with the value already set
    $c: Cell( rowNo == $rn, colNo == $cn, value == $v )

    // This is the negation of the last pattern in the previous rule.
    // Now the Setting fact can be safely retracted.
    not( $x: Cell( free contains $v )
         and
         Cell( this == $c, exCells contains $x ) )
  then
    // System.out.println( "done setting cell " + $c.toString() );
    // Discard the Setter fact.
    delete( $s );
    // Sudoku.sudoku.consistencyCheck();
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two solving rules detect a situation where an allocation of a number to a cell is possible. The rule <code>"single"</code> fires for a <code>Cell</code> with a candidate set containing a single number. The rule <code>"hidden single"</code> fires when no cell exists with a single candidate, but when a cell exists containing a candidate, this candidate is absent from all other cells in one of the three groups to which the cell belongs. Both rules create and insert a <code>Setting</code> fact.</p>
</div>
<div class="listingblock">
<div class="title">Rules "single" and "hidden single"</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Detect a set of candidate values with cardinality 1 for some Cell.
// This is the value to be set.
rule "single"
  when
    // Currently no setting underway
    not Setting()

    // One element in the "free" set
    $c: Cell( $rn: rowNo, $cn: colNo, freeCount == 1 )
  then
    Integer i = $c.getFreeValue();
    if (explain) System.out.println( "single " + i + " at " + $c.posAsString() );
    // Insert another Setter fact.
    insert( new Setting( $rn, $cn, i ) );
end

// Detect a set of candidate values with a value that is the only one
// in one of its groups. This is the value to be set.
rule "hidden single"
  when
    // Currently no setting underway
    not Setting()
    not Cell( freeCount == 1 )

    // Some integer
    $i: Integer()

    // The "free" set contains this number
    $c: Cell( $rn: rowNo, $cn: colNo, freeCount &gt; 1, free contains $i )

    // A cell group contains this cell $c.
    $cg: CellGroup( cells contains $c )
    // No other cell from that group contains $i.
    not ( Cell( this != $c, free contains $i ) from $cg.getCells() )
  then
    if (explain) System.out.println( "hidden single " + $i + " at " + $c.posAsString() );
    // Insert another Setter fact.
    insert( new Setting( $rn, $cn, $i ) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rules from the largest group, either individually or in groups of two or three, implement various solving techniques used for solving Sudoku puzzles manually.</p>
</div>
<div class="paragraph">
<p>The rule <code>"naked pair"</code> detects identical candidate sets of size <code>2</code> in two cells of a group. These two values may be removed from all other candidate sets of that group.</p>
</div>
<div class="listingblock">
<div class="title">Rule "naked pair"</div>
<div class="content">
<pre class="highlightjs highlight"><code>// A "naked pair" is two cells in some cell group with their sets of
// permissible values being equal with cardinality 2. These two values
// can be removed from all other candidate lists in the group.
rule "naked pair"
  when
    // Currently no setting underway
    not Setting()
    not Cell( freeCount == 1 )

    // One cell with two candidates
    $c1: Cell( freeCount == 2, $f1: free, $r1: cellRow, $rn1: rowNo, $cn1: colNo, $b1: cellSqr )

    // The containing cell group
    $cg: CellGroup( freeCount &gt; 2, cells contains $c1 )

    // Another cell with two candidates, not the one we already have
    $c2: Cell( this != $c1, free == $f1 /*** , rowNo &gt;= $rn1, colNo &gt;= $cn1 ***/ ) from $cg.cells

    // Get one of the "naked pair".
    Integer( $v: intValue ) from $c1.getFree()

    // Get some other cell with a candidate equal to one from the pair.
    $c3: Cell( this != $c1 &amp;&amp; != $c2, freeCount &gt; 1, free contains $v ) from $cg.cells
  then
    if (explain) System.out.println( "remove " + $v + " from " + $c3.posAsString() + " due to naked pair at " + $c1.posAsString() + " and " + $c2.posAsString() );
    // Remove the value.
    modify( $c3 ){ blockValue( $v ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The three rules <code>"hidden pair in &#8230;&#8203;"</code> functions similarly to the rule <code>"naked pair"</code>. These rules detect a subset of two numbers in exactly two cells of a group, with neither value occurring in any of the other cells of the group. This means that all other candidates can be eliminated from the two cells harboring the hidden pair.</p>
</div>
<div class="listingblock">
<div class="title">Rules "hidden pair in &#8230;&#8203;"</div>
<div class="content">
<pre class="highlightjs highlight"><code>// If two cells within the same cell group contain candidate sets with more than
// two values, with two values being in both of them but in none of the other
// cells, then we have a "hidden pair". We can remove all other candidates from
// these two cells.
rule "hidden pair in row"
  when
    // Currently no setting underway
    not Setting()
    not Cell( freeCount == 1 )

    // Establish a pair of Integer facts.
    $i1: Integer()
    $i2: Integer( this &gt; $i1 )

    // Look for a Cell with these two among its candidates. (The upper bound on
    // the number of candidates avoids a lot of useless work during startup.)
    $c1: Cell( $rn1: rowNo, $cn1: colNo, freeCount &gt; 2 &amp;&amp; &lt; 9, free contains $i1 &amp;&amp; contains $i2, $cellRow: cellRow )

    // Get another one from the same row, with the same pair among its candidates.
    $c2: Cell( this != $c1, cellRow == $cellRow, freeCount &gt; 2, free contains $i1 &amp;&amp; contains $i2 )

    // Ascertain that no other cell in the group has one of these two values.
    not( Cell( this != $c1 &amp;&amp; != $c2, free contains $i1 || contains $i2 ) from $cellRow.getCells() )
  then
    if( explain) System.out.println( "hidden pair in row at " + $c1.posAsString() + " and " + $c2.posAsString() );
    // Set the candidate lists of these two Cells to the "hidden pair".
    modify( $c1 ){ blockExcept( $i1, $i2 ) }
    modify( $c2 ){ blockExcept( $i1, $i2 ) }
end

rule "hidden pair in column"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i1: Integer()
    $i2: Integer( this &gt; $i1 )
    $c1: Cell( $rn1: rowNo, $cn1: colNo, freeCount &gt; 2 &amp;&amp; &lt; 9, free contains $i1 &amp;&amp; contains $i2, $cellCol: cellCol )
    $c2: Cell( this != $c1, cellCol == $cellCol, freeCount &gt; 2, free contains $i1 &amp;&amp; contains $i2 )
    not( Cell( this != $c1 &amp;&amp; != $c2, free contains $i1 || contains $i2 ) from $cellCol.getCells() )
  then
    if (explain) System.out.println( "hidden pair in column at " + $c1.posAsString() + " and " + $c2.posAsString() );
    modify( $c1 ){ blockExcept( $i1, $i2 ) }
    modify( $c2 ){ blockExcept( $i1, $i2 ) }
end

rule "hidden pair in square"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i1: Integer()
    $i2: Integer( this &gt; $i1 )
    $c1: Cell( $rn1: rowNo, $cn1: colNo, freeCount &gt; 2 &amp;&amp; &lt; 9, free contains $i1 &amp;&amp; contains $i2,
               $cellSqr: cellSqr )
    $c2: Cell( this != $c1, cellSqr == $cellSqr, freeCount &gt; 2, free contains $i1 &amp;&amp; contains $i2 )
    not( Cell( this != $c1 &amp;&amp; != $c2, free contains $i1 || contains $i2 ) from $cellSqr.getCells() )
  then
    if (explain) System.out.println( "hidden pair in square " + $c1.posAsString() + " and " + $c2.posAsString() );
    modify( $c1 ){ blockExcept( $i1, $i2 ) }
    modify( $c2 ){ blockExcept( $i1, $i2 ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two rules deal with <code>"X-wings"</code> in rows and columns. When only two possible cells for a value exist in each of two different rows (or columns) and these candidates lie also in the same columns (or rows), then all other candidates for this value in the columns (or rows) can be eliminated. When you follow the pattern sequence in one of these rules, notice how the conditions that are conveniently expressed by words such as <code>same</code> or <code>only</code> result in patterns with suitable constraints or that are prefixed with <code>not</code>.</p>
</div>
<div class="listingblock">
<div class="title">Rules "X-wings in &#8230;&#8203;"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "X-wings in rows"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    $ca1: Cell( freeCount &gt; 1, free contains $i,
                $ra: cellRow, $rano: rowNo,         $c1: cellCol,        $c1no: colNo )
    $cb1: Cell( freeCount &gt; 1, free contains $i,
                $rb: cellRow, $rbno: rowNo &gt; $rano,      cellCol == $c1 )
    not( Cell( this != $ca1 &amp;&amp; != $cb1, free contains $i ) from $c1.getCells() )

    $ca2: Cell( freeCount &gt; 1, free contains $i,
                cellRow == $ra, $c2: cellCol,       $c2no: colNo &gt; $c1no )
    $cb2: Cell( freeCount &gt; 1, free contains $i,
                cellRow == $rb,      cellCol == $c2 )
    not( Cell( this != $ca2 &amp;&amp; != $cb2, free contains $i ) from $c2.getCells() )

    $cx: Cell( rowNo == $rano || == $rbno, colNo != $c1no &amp;&amp; != $c2no,
               freeCount &gt; 1, free contains $i )
  then
    if (explain) {
        System.out.println( "X-wing with " + $i + " in rows " +
            $ca1.posAsString() + " - " + $cb1.posAsString() +
            $ca2.posAsString() + " - " + $cb2.posAsString() + ", remove from " + $cx.posAsString() );
    }
    modify( $cx ){ blockValue( $i ) }
end

rule "X-wings in columns"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    $ca1: Cell( freeCount &gt; 1, free contains $i,
                $c1: cellCol, $c1no: colNo,         $ra: cellRow,        $rano: rowNo )
    $ca2: Cell( freeCount &gt; 1, free contains $i,
                $c2: cellCol, $c2no: colNo &gt; $c1no,      cellRow == $ra )
    not( Cell( this != $ca1 &amp;&amp; != $ca2, free contains $i ) from $ra.getCells() )

    $cb1: Cell( freeCount &gt; 1, free contains $i,
                cellCol == $c1, $rb: cellRow,  $rbno: rowNo &gt; $rano )
    $cb2: Cell( freeCount &gt; 1, free contains $i,
                cellCol == $c2,      cellRow == $rb )
    not( Cell( this != $cb1 &amp;&amp; != $cb2, free contains $i ) from $rb.getCells() )

    $cx: Cell( colNo == $c1no || == $c2no, rowNo != $rano &amp;&amp; != $rbno,
               freeCount &gt; 1, free contains $i )
  then
    if (explain) {
        System.out.println( "X-wing with " + $i + " in columns " +
            $ca1.posAsString() + " - " + $ca2.posAsString() +
            $cb1.posAsString() + " - " + $cb2.posAsString() + ", remove from " + $cx.posAsString()  );
    }
    modify( $cx ){ blockValue( $i ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two rules <code>"intersection removal &#8230;&#8203;"</code> are based on the restricted occurrence of some number within one square, either in a single row or in a single column. This means that this number must be in one of those two or three cells of the row or column and can be removed from the candidate sets of all other cells of the group. The pattern establishes the restricted occurrence and then fires for each cell outside of the square and within the same cell file.</p>
</div>
<div class="listingblock">
<div class="title">Rules "intersection removal &#8230;&#8203;"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "intersection removal column"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    // Occurs in a Cell
    $c: Cell( free contains $i, $cs: cellSqr, $cc: cellCol )
    // Does not occur in another cell of the same square and a different column
    not Cell( this != $c, free contains $i, cellSqr == $cs, cellCol != $cc )

    // A cell exists in the same column and another square containing this value.
    $cx: Cell( freeCount &gt; 1, free contains $i, cellCol == $cc, cellSqr != $cs )
  then
    // Remove the value from that other cell.
    if (explain) {
        System.out.println( "column elimination due to " + $c.posAsString() +
                            ": remove " + $i + " from " + $cx.posAsString() );
    }
    modify( $cx ){ blockValue( $i ) }
end

rule "intersection removal row"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    // Occurs in a Cell
    $c: Cell( free contains $i, $cs: cellSqr, $cr: cellRow )
    // Does not occur in another cell of the same square and a different row.
    not Cell( this != $c, free contains $i, cellSqr == $cs, cellRow != $cr )

    // A cell exists in the same row and another square containing this value.
    $cx: Cell( freeCount &gt; 1, free contains $i, cellRow == $cr, cellSqr != $cs )
  then
    // Remove the value from that other cell.
    if (explain) {
        System.out.println( "row elimination due to " + $c.posAsString() +
                            ": remove " + $i + " from " + $cx.posAsString() );
    }
    modify( $cx ){ blockValue( $i ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>These rules are sufficient for many but not all Sudoku puzzles. To solve very difficult grids, the rule set requires more complex rules. (Ultimately, some puzzles can be solved only by trial and error.)</p>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-conway-ref_drools-examples"><a class="anchor" href="#decision-examples-conway-ref_drools-examples"></a><a class="link" href="#decision-examples-conway-ref_drools-examples">20.10. Conway&#8217;s Game of Life example decisions (ruleflow groups and GUI integration)</a></h3>
<div class="paragraph">
<p>The Conway&#8217;s Game of Life example decision set, based on the famous cellular automaton by John Conway, demonstrates how to use ruleflow groups in rules to control rule execution. The example also demonstrates how to integrate Drools rules with a graphical user interface (GUI), in this case a Swing-based implementation of Conway&#8217;s Game of Life.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the Conway&#8217;s Game of Life (Conway) example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>conway</code></p>
</li>
<li>
<p><strong>Main classes</strong>: <code>org.drools.examples.conway.ConwayRuleFlowGroupRun</code>, <code>org.drools.examples.conway.ConwayAgendaGroupRun</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>droolsjbpm-integration-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule files</strong>: <code>org.drools.examples.conway.*.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates ruleflow groups and GUI integration</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Conway&#8217;s Game of Life example is separate from most of the other example decision sets in Drools and is located in
the Drools and jBPM integration repository in <a href="https://github.com/kiegroup/droolsjbpm-integration/archive/master.zip">GitHub</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Conway&#8217;s Game of Life, a user interacts with the game by creating an initial configuration or an advanced pattern with defined properties and then observing how the initial state evolves. The objective of the game is to show the development of a population, generation by generation. Each generation results from the preceding one, based on the simultaneous evaluation of all cells.</p>
</div>
<div class="paragraph">
<p>The following basic rules govern what the next generation looks like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a live cell has fewer than two live neighbors, it dies of loneliness.</p>
</li>
<li>
<p>If a live cell has more than three live neighbors, it dies from overcrowding.</p>
</li>
<li>
<p>If a dead cell has exactly three live neighbors, it comes to life.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any cell that does not meet any of those criteria is left as is for the next generation.</p>
</div>
<div class="paragraph">
<p>The Conway&#8217;s Game of Life example uses Drools rules with <code>ruleflow-group</code> attributes to define the pattern implemented in the game. The example also contains a version of the decision set that achieves the same behavior using agenda groups. Agenda groups enable you to partition the Drools engine agenda to provide execution control over groups of rules. By default, all rules are in the agenda group <code>MAIN</code>. You can use the <code>agenda-group</code> attribute to specify a different agenda group for the rule.</p>
</div>
<div class="paragraph">
<p>This overview does not explore the version of the Conway example using agenda groups. For more information about agenda groups, see the Drools example decision sets that specifically address agenda groups.</p>
</div>
<h4 id="_conway_example_execution_and_interaction" class="discrete">Conway example execution and interaction</h4>
<div class="paragraph">
<p>Similar to other Drools decision examples, you execute the Conway ruleflow example by running the <code>org.drools.examples.conway.ConwayRuleFlowGroupRun</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>When you execute the Conway example, the <code>Conway&#8217;s Game of Life</code> GUI window appears. This window contains an empty grid, or "arena" where the life simulation takes place. Initially the grid is empty because no live cells are in the system yet.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/ConwaysGameOfLifeExample/conway1.png" alt="conway1">
</div>
<div class="title">Figure 378. Conway example GUI after launch</div>
</div>
<div class="paragraph">
<p>Select a predefined pattern from the <strong>Pattern</strong> drop-down menu and click <strong>Next Generation</strong> to click through each population generation. Each cell is either alive or dead, where live cells contain a green ball. As the population evolves from the initial pattern, cells live or die relative to neighboring cells, according to the rules of the game.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/ConwaysGameOfLifeExample/conway2.png" alt="conway2">
</div>
<div class="title">Figure 379. Generation evolution in Conway example</div>
</div>
<div class="paragraph">
<p>Neighbors include not only cells to the left, right, top, and bottom but also cells that are connected diagonally, so that each cell has a total of eight neighbors. Exceptions are the corner cells, which have only three neighbors, and the cells along the four borders, with five neighbors each.</p>
</div>
<div class="paragraph">
<p>You can manually intervene to create or kill cells by clicking the cell.</p>
</div>
<div class="paragraph">
<p>To run through an evolution automatically from the initial pattern, click <strong>Start</strong>.</p>
</div>
<h4 id="_conway_example_rules_with_ruleflow_groups" class="discrete">Conway example rules with ruleflow groups</h4>
<div class="paragraph">
<p>The rules in the <code>ConwayRuleFlowGroupRun</code> example use ruleflow groups to control rule execution. A ruleflow group is a group of rules associated by the <code>ruleflow-group</code> rule attribute. These rules can only fire when the group is activated. The group itself can only become active when the elaboration of the ruleflow diagram reaches the node representing the group.</p>
</div>
<div class="paragraph">
<p>The Conway example uses the following ruleflow groups for rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"register neighbor"</code></p>
</li>
<li>
<p><code>"evaluate"</code></p>
</li>
<li>
<p><code>"calculate"</code></p>
</li>
<li>
<p><code>"reset calculate"</code></p>
</li>
<li>
<p><code>"birth"</code></p>
</li>
<li>
<p><code>"kill"</code></p>
</li>
<li>
<p><code>"kill all"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of the <code>Cell</code> objects are inserted into the KIE session and the <code>"register &#8230;&#8203;"</code> rules in the ruleflow group <code>"register neighbor"</code> are allowed to execute by the ruleflow process. This group of four rules creates <code>Neighbor</code> relations between some cell and its northeastern, northern, northwestern, and western neighbors.</p>
</div>
<div class="paragraph">
<p>This relation is bidirectional and handles the other four directions. Border cells do not require any special treatment. These cells are not paired with neighboring cells where there is not any.</p>
</div>
<div class="paragraph">
<p>By the time all activations have fired for these rules, all cells are related to all their neighboring cells.</p>
</div>
<div class="listingblock">
<div class="title">Rules "register &#8230;&#8203;"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "register north east"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $northEast : Cell( row  == ($row - 1), col == ( $col + 1 ) )
  then
    insert( new Neighbor( $cell, $northEast ) );
    insert( new Neighbor( $northEast, $cell ) );
end

rule "register north"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $north : Cell( row  == ($row - 1), col == $col )
  then
    insert( new Neighbor( $cell, $north ) );
    insert( new Neighbor( $north, $cell ) );
end

rule "register north west"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $northWest : Cell( row  == ($row - 1), col == ( $col - 1 ) )
  then
    insert( new Neighbor( $cell, $northWest ) );
    insert( new Neighbor( $northWest, $cell ) );
end

rule "register west"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $west : Cell( row  == $row, col == ( $col - 1 ) )
  then
    insert( new Neighbor( $cell, $west ) );
    insert( new Neighbor( $west, $cell ) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>After all the cells are inserted, some Java code applies the pattern to the grid, setting certain cells to <code>Live</code>. Then, when the user clicks <strong>Start</strong> or <strong>Next Generation</strong>, the example executes the <code>Generation</code> ruleflow. This ruleflow manages all changes of cells in each generation cycle.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/ConwaysGameOfLifeExample/conway_ruleflow_generation.png" alt="conway ruleflow generation">
</div>
<div class="title">Figure 380. Generation ruleflow</div>
</div>
<div class="paragraph">
<p>The ruleflow process enters the <code>"evaluate"</code> ruleflow group and any active rules in the group can fire. The rules <code>"Kill the &#8230;&#8203;"</code> and <code>"Give Birth"</code> in this group apply the game rules to birth or kill cells. The example uses the <code>phase</code> attribute to drive the reasoning of the <code>Cell</code> object by specific groups of rules. Typically, the phase is tied to a ruleflow group in the ruleflow process definition.</p>
</div>
<div class="paragraph">
<p>Notice that the example does not change the state of any <code>Cell</code> objects at this point because it must complete the full evaluation before those changes can be applied. The example sets the cell to a <code>phase</code> that is either <code>Phase.KILL</code> or <code>Phase.BIRTH</code>, which is used later to control actions applied to the <code>Cell</code> object.</p>
</div>
<div class="listingblock">
<div class="title">Rules "Kill the &#8230;&#8203;" and "Give Birth"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Kill The Lonely"
    ruleflow-group "evaluate"
    no-loop
  when
    // A live cell has fewer than 2 live neighbors.
    theCell: Cell( liveNeighbors &lt; 2, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
  then
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule "Kill The Overcrowded"
    ruleflow-group "evaluate"
    no-loop
  when
    // A live cell has more than 3 live neighbors.
    theCell: Cell( liveNeighbors &gt; 3, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
  then
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule "Give Birth"
    ruleflow-group "evaluate"
    no-loop
  when
    // A dead cell has 3 live neighbors.
    theCell: Cell( liveNeighbors == 3, cellState == CellState.DEAD,
                   phase == Phase.EVALUATE )
  then
    modify( theCell ){
        theCell.setPhase( Phase.BIRTH );
    }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>After all <code>Cell</code> objects in the grid have been evaluated, the example uses the <code>"reset calculate"</code> rule to clear any activations in the <code>"calculate"</code> ruleflow group. The example then enters a split in the ruleflow that enables the rules <code>"kill"</code> and <code>"birth"</code> to fire, if the ruleflow group is activated. These rules apply the state change.</p>
</div>
<div class="listingblock">
<div class="title">Rules "reset calculate", "kill", and "birth"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "reset calculate"
    ruleflow-group "reset calculate"
  when
  then
    WorkingMemory wm = drools.getWorkingMemory();
    wm.clearRuleFlowGroup( "calculate" );
end

rule "kill"
    ruleflow-group "kill"
    no-loop
  when
    theCell: Cell( phase == Phase.KILL )
  then
    modify( theCell ){
        setCellState( CellState.DEAD ),
        setPhase( Phase.DONE );
    }
end

rule "birth"
    ruleflow-group "birth"
    no-loop
  when
    theCell: Cell( phase == Phase.BIRTH )
  then
    modify( theCell ){
        setCellState( CellState.LIVE ),
        setPhase( Phase.DONE );
    }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this stage, several <code>Cell</code> objects have been modified with the state changed to either <code>LIVE</code> or <code>DEAD</code>. When a cell becomes live or dead, the example uses the <code>Neighbor</code> relation in the rules <code>"Calculate &#8230;&#8203;"</code> to iterate over all surrounding cells, increasing or decreasing the <code>liveNeighbor</code> count. Any cell that has its count changed is also set to the <code>EVALUATE</code> phase to make sure it is included in the reasoning during the evaluation stage of the ruleflow process.</p>
</div>
<div class="paragraph">
<p>After the live count has been determined and set for all cells, the ruleflow process ends. If the user initially clicked <strong>Start</strong>, the Drools engine restarts the ruleflow at that point. If the user initially clicked <strong>Next Generation</strong>, the user can request another generation.</p>
</div>
<div class="listingblock">
<div class="title">Rules "Calculate &#8230;&#8203;"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Calculate Live"
    ruleflow-group "calculate"
    lock-on-active
  when
    theCell: Cell( cellState == CellState.LIVE )
    Neighbor( cell == theCell, $neighbor : neighbor )
  then
    modify( $neighbor ){
        setLiveNeighbors( $neighbor.getLiveNeighbors() + 1 ),
        setPhase( Phase.EVALUATE );
    }
end

rule "Calculate Dead"
    ruleflow-group "calculate"
    lock-on-active
  when
    theCell: Cell( cellState == CellState.DEAD )
    Neighbor( cell == theCell, $neighbor : neighbor )
  then
    modify( $neighbor ){
        setLiveNeighbors( $neighbor.getLiveNeighbors() - 1 ),
        setPhase( Phase.EVALUATE );
    }
end</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-doom-ref_drools-examples"><a class="anchor" href="#decision-examples-doom-ref_drools-examples"></a><a class="link" href="#decision-examples-doom-ref_drools-examples">20.11. House of Doom example decisions (backward chaining and recursion)</a></h3>
<div class="paragraph">
<p>The House of Doom example decision set demonstrates how the Drools engine uses backward chaining and recursion to reach defined goals or subgoals in a hierarchical system.</p>
</div>
<div class="paragraph">
<p>The following is an overview of the House of Doom example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: <code>backwardchaining</code></p>
</li>
<li>
<p><strong>Main class</strong>: <code>org.drools.examples.backwardchaining.HouseOfDoomMain</code> (in <code>src/main/java</code>)</p>
</li>
<li>
<p><strong>Module</strong>: <code>drools-examples</code></p>
</li>
<li>
<p><strong>Type</strong>: Java application</p>
</li>
<li>
<p><strong>Rule file</strong>: <code>org.drools.examples.backwardchaining.BC-Example.drl</code> (in <code>src/main/resources</code>)</p>
</li>
<li>
<p><strong>Objective</strong>: Demonstrates backward chaining and recursion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A backward-chaining rule system is a goal-driven system that starts with a conclusion that the Drools engine attempts to satisfy, often using recursion. If the system cannot reach the conclusion or goal, it searches for subgoals, which are conclusions that complete part of the current goal. The system continues this process until either the initial conclusion is satisfied or all subgoals are satisfied.</p>
</div>
<div class="paragraph">
<p>In contrast, a forward-chaining rule system is a data-driven system that starts with a fact in the working memory of the Drools engine and reacts to changes to that fact. When objects are inserted into working memory, any rule conditions that become true as a result of the change are scheduled for execution by the agenda.</p>
</div>
<div class="paragraph">
<p>The Drools engine in Drools uses both forward and backward chaining to evaluate rules.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates how the Drools engine evaluates rules using forward chaining overall with a backward-chaining segment in the logic flow:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/BackwardChaining/RuleEvaluation.png" alt="RuleEvaluation">
</div>
<div class="title">Figure 381. Rule evaluation logic using forward and backward chaining</div>
</div>
<div class="paragraph">
<p>The House of Doom example uses rules with various types of queries to find the location of rooms and items within the house. The sample class <code>Location.java</code> contains the <code>item</code> and <code>location</code> elements used in the example. The sample class <code>HouseOfDoomMain.java</code> inserts the items or rooms in their respective locations in the house and executes the rules.</p>
</div>
<div class="listingblock">
<div class="title">Items and locations in HouseOfDoomMain.java class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.insert( new Location("Office", "House") );
ksession.insert( new Location("Kitchen", "House") );
ksession.insert( new Location("Knife", "Kitchen") );
ksession.insert( new Location("Cheese", "Kitchen") );
ksession.insert( new Location("Desk", "Office") );
ksession.insert( new Location("Chair", "Office") );
ksession.insert( new Location("Computer", "Desk") );
ksession.insert( new Location("Drawer", "Desk") );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example rules rely on backward chaining and recursion to determine the location of all items and rooms in the house structure.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the structure of the House of Doom and the items and rooms within it:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Examples/BackwardChaining/TransitiveReasoning.png" alt="TransitiveReasoning">
</div>
<div class="title">Figure 382. House of Doom structure</div>
</div>
<div class="paragraph">
<p>To execute the example, run the <code>org.drools.examples.backwardchaining.HouseOfDoomMain</code> class as a Java application in your IDE.</p>
</div>
<div class="paragraph">
<p>After the execution, the following output appears in the IDE console window:</p>
</div>
<div class="listingblock">
<div class="title">Execution output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>go1
Office is in the House
---
go2
Drawer is in the House
---
go3
---
Key is in the Office
---
go4
Chair is in the Office
Desk is in the Office
Key is in the Office
Computer is in the Office
Drawer is in the Office
---
go5
Chair is in Office
Desk is in Office
Drawer is in Desk
Key is in Drawer
Kitchen is in House
Cheese is in Kitchen
Knife is in Kitchen
Computer is in Desk
Office is in House
Key is in Office
Drawer is in House
Computer is in House
Key is in House
Desk is in House
Chair is in House
Knife is in House
Cheese is in House
Computer is in Office
Drawer is in Office
Key is in Desk</code></pre>
</div>
</div>
<div class="paragraph">
<p>All rules in the example have fired to detect the location of all items in the house and to print the location of each in the output.</p>
</div>
<h4 id="_recursive_query_and_related_rules" class="discrete">Recursive query and related rules</h4>
<div class="paragraph">
<p>A recursive query repeatedly searches through the hierarchy of a data structure for relationships between elements.</p>
</div>
<div class="paragraph">
<p>In the House of Doom example, the <code>BC-Example.drl</code> file contains an <code>isContainedIn</code> query that most of the rules in the example use to recursively evaluate the house data structure for data inserted into the Drools engine:</p>
</div>
<div class="listingblock">
<div class="title">Recursive query in BC-Example.drl</div>
<div class="content">
<pre class="highlightjs highlight"><code>query isContainedIn( String x, String y )
  Location( x, y; )
  or
  ( Location( z, y; ) and isContainedIn( x, z; ) )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"go"</code> prints every string inserted into the system to determine how items are implemented, and the rule <code>"go1"</code> calls the query <code>isContainedIn</code>:</p>
</div>
<div class="listingblock">
<div class="title">Rules "go" and "go1"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go" salience 10
  when
    $s : String()
  then
    System.out.println( $s );
end

rule "go1"
  when
    String( this == "go1" )
    isContainedIn("Office", "House"; )
  then
    System.out.println( "Office is in the House" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example inserts the <code>"go1"</code> string into the Drools engine and activates the <code>"go1"</code> rule to detect that item <code>Office</code> is in the location <code>House</code>:</p>
</div>
<div class="listingblock">
<div class="title">Insert string and fire rules</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go1" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Rule "go1" output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>go1
Office is in the House</code></pre>
</div>
</div>
<h4 id="_transitive_closure_rule" class="discrete">Transitive closure rule</h4>
<div class="paragraph">
<p>Transitive closure is a relationship between an element contained in a parent element that is multiple levels higher in a hierarchical structure.</p>
</div>
<div class="paragraph">
<p>The rule <code>"go2"</code> identifies the transitive closure relationship of the <code>Drawer</code> and the <code>House</code>: The <code>Drawer</code> is in the <code>Desk</code> in the <code>Office</code> in the <code>House</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "go2"
  when
    String( this == "go2" )
    isContainedIn("Drawer", "House"; )
  then
    System.out.println( "Drawer is in the House" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example inserts the <code>"go2"</code> string into the Drools engine and activates the <code>"go2"</code> rule to detect that item <code>Drawer</code> is ultimately within the location <code>House</code>:</p>
</div>
<div class="listingblock">
<div class="title">Insert string and fire rules</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go2" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Rule "go2" output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>go2
Drawer is in the House</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Drools engine determines this outcome based on the following logic:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The query recursively searches through several levels in the house to detect the transitive closure between <code>Drawer</code> and <code>House</code>.</p>
</li>
<li>
<p>Instead of using <code>Location( x, y; )</code>, the query uses the value of <code>(z, y; )</code> because <code>Drawer</code> is not directly in <code>House</code>.</p>
</li>
<li>
<p>The <code>z</code> argument is currently unbound, which means it has no value and returns everything that is in the argument.</p>
</li>
<li>
<p>The <code>y</code> argument is currently bound to <code>House</code>, so <code>z</code> returns <code>Office</code> and <code>Kitchen</code>.</p>
</li>
<li>
<p>The query gathers information from the <code>Office</code> and checks recursively if the <code>Drawer</code> is in the <code>Office</code>. The query line <code>isContainedIn( x, z; )</code> is called for these parameters.</p>
</li>
<li>
<p>No instance of <code>Drawer</code> exists directly in <code>Office</code>, so no match is found.</p>
</li>
<li>
<p>With <code>z</code> unbound, the query returns data within the <code>Office</code> and determines that <strong>z == Desk</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>isContainedIn(x==drawer, z==desk)</code></pre>
</div>
</div>
</li>
<li>
<p>The <code>isContainedIn</code> query recursively searches three times, and on the third time, the query detects an instance of <code>Drawer</code> in <code>Desk</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Location(x==drawer, y==desk)</code></pre>
</div>
</div>
</li>
<li>
<p>After this match on the first location, the query recursively searches back up the structure to determine that the <code>Drawer</code> is in the <code>Desk</code>, the <code>Desk</code> is in the <code>Office</code>, and the <code>Office</code> is in the <code>House</code>. Therefore, the <code>Drawer</code> is in the <code>House</code> and the rule is satisfied.</p>
</li>
</ol>
</div>
<h4 id="_reactive_query_rule" class="discrete">Reactive query rule</h4>
<div class="paragraph">
<p>A reactive query searches through the hierarchy of a data structure for relationships between elements and is dynamically updated when elements in the structure are modified.</p>
</div>
<div class="paragraph">
<p>The rule <code>"go3"</code> functions as a reactive query that detects if a new item <code>Key</code> ever becomes present in the <code>Office</code> by transitive closure: A <code>Key</code> in the <code>Drawer</code> in the <code>Office</code>.</p>
</div>
<div class="listingblock">
<div class="title">Rule "go3"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go3"
  when
    String( this == "go3" )
    isContainedIn("Key", "Office"; )
  then
    System.out.println( "Key is in the Office" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example inserts the <code>"go3"</code> string into the Drools engine and activates the <code>"go3"</code> rule. Initially, this rule is not satisfied because no item <code>Key</code> exists in the house structure, so the rule produces no output.</p>
</div>
<div class="listingblock">
<div class="title">Insert string and fire rules</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go3" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Rule "go3" output in the IDE console (unsatisfied)</div>
<div class="content">
<pre class="highlightjs highlight"><code>go3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example then inserts a new item <code>Key</code> in the location <code>Drawer</code>, which is in <code>Office</code>. This change satisfies the transitive closure in the <code>"go3"</code> rule and the output is populated accordingly.</p>
</div>
<div class="listingblock">
<div class="title">Insert new item location and fire rules</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( new Location("Key", "Drawer") );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Rule "go3" output in the IDE console (satisfied)</div>
<div class="content">
<pre class="highlightjs highlight"><code>Key is in the Office</code></pre>
</div>
</div>
<div class="paragraph">
<p>This change also adds another level in the structure that the query includes in subsequent recursive searches.</p>
</div>
<h4 id="_queries_with_unbound_arguments_in_rules" class="discrete">Queries with unbound arguments in rules</h4>
<div class="paragraph">
<p>A query with one or more unbound arguments returns all undefined (unbound) items within a defined (bound) argument of the query. If all arguments in a query are unbound, then the query returns all items within the scope of the query.</p>
</div>
<div class="paragraph">
<p>The rule <code>"go4"</code> uses an unbound argument <code>thing</code> to search for all items within the bound argument <code>Office</code>, instead of using a bound argument to search for a specific item in the <code>Office</code>:</p>
</div>
<div class="listingblock">
<div class="title">Rule "go4"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go4"
  when
    String( this == "go4" )
    isContainedIn(thing, "Office"; )
  then
    System.out.println( thing + "is in the Office" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example inserts the <code>"go4"</code> string into the Drools engine and activates the <code>"go4"</code> rule to return all items in the <code>Office</code>:</p>
</div>
<div class="listingblock">
<div class="title">Insert string and fire rules</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go4" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Rule "go4" output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>go4
Chair is in the Office
Desk is in the Office
Key is in the Office
Computer is in the Office
Drawer is in the Office</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"go5"</code> uses both unbound arguments <code>thing</code> and <code>location</code> to search for all items and their locations in the entire <code>House</code> data structure:</p>
</div>
<div class="listingblock">
<div class="title">Rule "go5"</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go5"
  when
    String( this == "go5" )
    isContainedIn(thing, location; )
  then
    System.out.println(thing + " is in " + location );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example inserts the <code>"go5"</code> string into the Drools engine and activates the <code>"go5"</code> rule to return all items and their locations in the <code>House</code> data structure:</p>
</div>
<div class="listingblock">
<div class="title">Insert string and fire rules</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go5" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Rule "go5" output in the IDE console</div>
<div class="content">
<pre class="highlightjs highlight"><code>go5
Chair is in Office
Desk is in Office
Drawer is in Desk
Key is in Drawer
Kitchen is in House
Cheese is in Kitchen
Knife is in Kitchen
Computer is in Desk
Office is in House
Key is in Office
Drawer is in House
Computer is in House
Key is in House
Desk is in House
Chair is in House
Knife is in House
Cheese is in House
Computer is in Office
Drawer is in Office
Key is in Desk</code></pre>
</div>
</div>
<h1 id="_drools_release_notes" class="discrete">Drools Release Notes</h1>
</div>
</div>
</div>
<div class="sect1">
<h2 id="droolsreleasenoteschapter"><a class="anchor" href="#droolsreleasenoteschapter"></a><a class="link" href="#droolsreleasenoteschapter">21. Release Notes</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="drools.releasenotesdrools.7.24.0"><a class="anchor" href="#drools.releasenotesdrools.7.24.0"></a><a class="link" href="#drools.releasenotesdrools.7.24.0">21.1. New and Noteworthy in Drools 7.24.0</a></h3>
<div class="sect3">
<h4 id="dmn-pmml-support"><a class="anchor" href="#dmn-pmml-support"></a><a class="link" href="#dmn-pmml-support">21.1.1. PMML support in DMN included models</a></h4>
<div class="paragraph">
<p>You can now use the <strong>Included Models</strong> tab in the Decision Model and Notation (DMN) designer in Business Central to include PMML models from your project in a specified DMN file. When you include a PMML model within a DMN file, you can invoke that PMML model as a boxed function expression for a DMN decision node or business knowledge model node.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.23.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.23.0.final"></a><a class="link" href="#_drools.releasenotesworkbench.7.23.0.final">21.2. New and Noteworthy in Business Central 7.23.0</a></h3>
<div class="sect3">
<h4 id="_enhanced_bc_collaboration_features"><a class="anchor" href="#_enhanced_bc_collaboration_features"></a><a class="link" href="#_enhanced_bc_collaboration_features">21.2.1. Enhanced BC collaboration features</a></h4>
<div class="paragraph">
<p>The following enhancements were added to Business Central to provide additional options for managing access to spaces and projects.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-security-management.png" alt="collaboration security management">
</div>
<div class="title">Figure 383. Security Management user interface</div>
</div>
<div class="paragraph">
<p>With the introduction of this new feature, it is now possible to manage spaces and projects permissions directly in their respective screens, using the Contributors tab. When contributors are added to a space, they are able to open it and see its projects and other information available. Based on their contributor role, they also have the following permissions granted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Owner</em>: Update contributors, delete spaces, create and delete projects</p>
</li>
<li>
<p><em>Admin</em>: Update contributors (except owners) and create projects</p>
</li>
<li>
<p><em>Contributor</em>: Create projects</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-space-contributors.png" alt="collaboration space contributors">
</div>
<div class="title">Figure 384. Space Contributors tab</div>
</div>
<div class="paragraph">
<p>When a project is created inside a space, its contributors are copied from the space and the project creator becomes the owner of the new project. It is also possible to add new contributors to the project if they are also contributors to the project&#8217;s space. Contributors can view the project, and depending on their role, they may also have the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Owner</em>: View, update, build, deploy, and delete projects</p>
</li>
<li>
<p><em>Admin</em>: View, update, build and deploy projects</p>
</li>
<li>
<p><em>Contributor</em>: View, update and build projects</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-project-contributors.png" alt="collaboration project contributors">
</div>
<div class="title">Figure 385. Project Contributors tab</div>
</div>
<div class="paragraph">
<p>The security check uses both the Security Management user interface and Contributors tab to assign permissions to spaces and projects. For example, users can delete a space if they are assigned to a role with the required permissions or is a owner of that space.</p>
</div>
</div>
<div class="sect3">
<h4 id="_role_based_access_control_for_branches"><a class="anchor" href="#_role_based_access_control_for_branches"></a><a class="link" href="#_role_based_access_control_for_branches">21.2.2. Role based access control for branches</a></h4>
<div class="paragraph">
<p>In addition to the new collaboration features, you can customize contributor role permissions for each branch of a project.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-branch-management.png" alt="collaboration branch management">
</div>
<div class="title">Figure 386. Branch Management settings section</div>
</div>
<div class="paragraph">
<p>Select which permissions each contributor role has for the selected branch.</p>
</div>
</div>
<div class="sect3">
<h4 id="_importing_a_subset_of_branches"><a class="anchor" href="#_importing_a_subset_of_branches"></a><a class="link" href="#_importing_a_subset_of_branches">21.2.3. Importing a subset of branches</a></h4>
<div class="paragraph">
<p>When importing projects from a repository, you can select only the branches that you want to persist in Business Central.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Business Central, click <strong>Menu</strong>  <strong>Design</strong>  <strong>Projects</strong>.</p>
</li>
<li>
<p>Select or create the space into which you want to import the project. The default space is MySpace.</p>
</li>
<li>
<p>Click the three dots on the right side of the screen and select <strong>Import Project</strong>.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-menu.png" alt="import project menu">
</div>
<div class="title">Figure 387. Import project popup access</div>
</div>
<div class="paragraph">
<p>In the <strong>Import Project</strong> window, enter the URL and credentials for the Git repository that contains the project that you want to import and click <strong>Import</strong>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-repository-url.png" alt="import project repository url">
</div>
<div class="title">Figure 388. Import project popup</div>
</div>
<div class="paragraph">
<p>After clicking on <strong>Import</strong>, all projects found in that repository will be listed:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-list-of-projects.png" alt="import project list of projects">
</div>
<div class="title">Figure 389. List of projects to import</div>
</div>
<div class="paragraph">
<p>On the right side of each project name, click the branch icon. Select the branches that you want to import.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-branch-selector-popup.png" alt="import project branch selector popup">
</div>
<div class="title">Figure 390. List of projects to import</div>
</div>
<div class="paragraph">
<p>Only the selected branches are persisted:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-imported-branches.png" alt="import project imported branches">
</div>
<div class="title">Figure 391. List of imported branches</div>
</div>
</div>
<div class="sect3">
<h4 id="_dmn_included_models"><a class="anchor" href="#_dmn_included_models"></a><a class="link" href="#_dmn_included_models">21.2.4. DMN included models</a></h4>
<div class="paragraph">
<p>The DMN designer contains a new <strong>Included Models</strong> tab that you can use to include externally defined DMN models in the specified DMN file. When you add an included model in a DMN file, you can reuse components of the included model in that DMN file. This enhancement helps you more efficiently integrate DMN logic between different DMN models in your project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.19.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.19.0.final"></a><a class="link" href="#_drools.releasenotesworkbench.7.19.0.final">21.3. New and Noteworthy in Business Central 7.19.0</a></h3>
<div class="sect3">
<h4 id="_dmn_automatic_layout"><a class="anchor" href="#_dmn_automatic_layout"></a><a class="link" href="#_dmn_automatic_layout">21.3.1. DMN Automatic Layout</a></h4>
<div class="paragraph">
<p>Nodes in DMN decision requirements diagrams (DRDs) can be positioned automatically with the new <strong>Perform automatic layout</strong> toolbar button. This automatic layout feature orients DRD nodes vertically, from the bottom to the top of the  DRD. However, automatic layout currently does not support <strong>Decision Service</strong> nodes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dmn_and_test_scenario_context_menu_keyboard_control"><a class="anchor" href="#_dmn_and_test_scenario_context_menu_keyboard_control"></a><a class="link" href="#_dmn_and_test_scenario_context_menu_keyboard_control">21.3.2. DMN and Test Scenario context menu keyboard control</a></h4>
<div class="paragraph">
<p>In both DMN and Test Scenario tables, keyboard support for the context menu invocation was added. You can now invoke a context menu by typing <strong>Ctrl+Space</strong>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.18.0"><a class="anchor" href="#_drools.releasenotesdrools.7.18.0"></a><a class="link" href="#_drools.releasenotesdrools.7.18.0">21.4. New and Noteworthy in Drools 7.18</a></h3>
<div class="sect3">
<h4 id="_new_builder_options"><a class="anchor" href="#_new_builder_options"></a><a class="link" href="#_new_builder_options">21.4.1. New Builder Options</a></h4>
<div class="sect4">
<h5 id="_trimcellsindtableoption"><a class="anchor" href="#_trimcellsindtableoption"></a><a class="link" href="#_trimcellsindtableoption">21.4.1.1. TrimCellsInDTableOption</a></h5>
<div class="paragraph">
<p>By default all the value of the cells in decision tables are trimmed before being processed. There could be situations where
this automatic trimming is not required or even detrimental. In this cases it is now possible to disable the trimming using
the new TrimCellsInDTableOption or the correspondent "drools.trimCellsInDTable" System property.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_groupdrlsinkiebasesbyfolderoption"><a class="anchor" href="#_groupdrlsinkiebasesbyfolderoption"></a><a class="link" href="#_groupdrlsinkiebasesbyfolderoption">21.4.2. GroupDRLsInKieBasesByFolderOption</a></h4>
<div class="paragraph">
<p>By default all the Drools artifacts under the resources folder, at any level, are included into the KieBase.
From now on, the packages attribute of the kmodule.xml allows to limit the artifacts that will be compiled in this KieBase
to only the ones belonging to the list of packages. However older versions of Drools actually checked the folder
name instead of the package one. The new  GroupDRLsInKieBasesByFolderOption or the correspondent
"drools.groupDRLsInKieBasesByFolder" System property allows to re-enable that old folder-based behaviour.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.18.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.18.0.final"></a><a class="link" href="#_drools.releasenotesworkbench.7.18.0.final">21.5. New and Noteworthy in Business Central 7.18.0</a></h3>
<div class="sect3">
<h4 id="_guided_rules_designer_filtering"><a class="anchor" href="#_guided_rules_designer_filtering"></a><a class="link" href="#_guided_rules_designer_filtering">21.5.1. Guided rules designer filtering</a></h4>
<div class="paragraph">
<p>The guided rules designer now supports filtering of DSL (domain specific language) files and Fact Types when you add new Condition or Action elements.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-editor-filter.png" alt="guided rule editor filter">
</div>
<div class="title">Figure 392. Filtering</div>
</div>
</div>
<div class="sect3">
<h4 id="_test_scenario_preview_renamed_to_test_scenario_and_listmap_support"><a class="anchor" href="#_test_scenario_preview_renamed_to_test_scenario_and_listmap_support"></a><a class="link" href="#_test_scenario_preview_renamed_to_test_scenario_and_listmap_support">21.5.2. Test Scenario (Preview) renamed to Test Scenario and List/Map support</a></h4>
<div class="paragraph">
<p>Old Test Scenario has been renamed as Test Scenario (Legacy) and Test Scenario (Preview) now is Test Scenario.
The editor now supports also List and Map as supported data types for testing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_development_streamline_lifecycle"><a class="anchor" href="#_development_streamline_lifecycle"></a><a class="link" href="#_development_streamline_lifecycle">21.5.3. Development streamline lifecycle</a></h4>
<div class="paragraph">
<p>Along with the new development mode on KIE Server, Business Central also adds a simplified deployment mechanism for
<em>SNAPSHOT</em> modules to improve the user experience during the development and testing phases of a module.
Some of the changes introduced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>More flexible deployment policy, allowing you to run module updates with no need of undeploying previous deployments.</p>
</li>
<li>
<p>Once a <em>SNAPSHOT</em> module is deployed, Business Central will store the user deployment preferences making subsequent
deployments update the previously deployed container. This mechanism also keeps the active process instances.</p>
</li>
<li>
<p>Added ability to redeploy a module, updating the container with latest changes but aborting the active process instances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other changes introduced:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/StreamlineDevelopment/streamline_dev_mode_toggle.png" alt="streamline dev mode toggle">
</div>
<div class="title">Figure 393. New <strong>Development Mode</strong> toggle on the module <strong>General Settings</strong> screen to turn the module into <em>SNAPSHOT</em></div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/StreamlineDevelopment/streamline_build_and_install.png" alt="streamline build and install">
</div>
<div class="title">Figure 394. Changed <strong>Build</strong> button to drop-down with <strong>Build &amp; Install</strong> option</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/StreamlineDevelopment/streamline_redeploy.png" alt="streamline redeploy">
</div>
<div class="title">Figure 395. Changed <strong>Deploy</strong> button to drop-down with <strong>Redeploy</strong> only (only available on <em>SNAPSHOT</em> modules)</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.17.0"><a class="anchor" href="#_drools.releasenotesdrools.7.17.0"></a><a class="link" href="#_drools.releasenotesdrools.7.17.0">21.6. New and Noteworthy in Drools 7.17</a></h3>
<div class="sect3">
<h4 id="_minor_changes_in_dmn_feel_built_in_functions_parameter_names"><a class="anchor" href="#_minor_changes_in_dmn_feel_built_in_functions_parameter_names"></a><a class="link" href="#_minor_changes_in_dmn_feel_built_in_functions_parameter_names">21.6.1. Minor changes in DMN FEEL built-in functions' parameter names</a></h4>
<div class="paragraph">
<p>Previous releases of Drools offered (optionally) a FEEL built-in function <code>split()</code> as an extended function, beyond the DMN v1.1 specification.
In order to align with version v1.2 of the DMN specification, which now includes <code>split()</code> as part of the standardised FEEL built-in functions set, the function parameter names have been aligned to the ones mandated by the DMN specification itself, with the signature <code>split( string, delimiter )</code> as specified in Table 68 of the DMN v1.2 specification document.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.17.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.17.0.final"></a><a class="link" href="#_drools.releasenotesworkbench.7.17.0.final">21.7. New and Noteworthy in Business Central 7.17.0</a></h3>
<div class="sect3">
<h4 id="_test_scenario_preview_enabled_by_default"><a class="anchor" href="#_test_scenario_preview_enabled_by_default"></a><a class="link" href="#_test_scenario_preview_enabled_by_default">21.7.1. Test Scenario (Preview) enabled by default</a></h4>
<div class="paragraph">
<p>Test Scenario (Preview) is now enabled by default so there is no additional configuration needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_scenario_dmn_support"><a class="anchor" href="#_test_scenario_dmn_support"></a><a class="link" href="#_test_scenario_dmn_support">21.7.2. Test Scenario DMN support</a></h4>
<div class="paragraph">
<p>Test Scenario (Preview) now support DMN model testing</p>
</div>
</div>
<div class="sect3">
<h4 id="_dmn_decision_service_support"><a class="anchor" href="#_dmn_decision_service_support"></a><a class="link" href="#_dmn_decision_service_support">21.7.3. DMN Decision Service support</a></h4>
<div class="paragraph">
<p>A DMN decision service node is now available in the DMN designer palette in Business Central.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.16.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.16.0.final"></a><a class="link" href="#_drools.releasenotesworkbench.7.16.0.final">21.8. New and Noteworthy in Business Central 7.16.0</a></h3>
<div class="sect3">
<h4 id="_dmn_and_test_scenario_keyboard_control"><a class="anchor" href="#_dmn_and_test_scenario_keyboard_control"></a><a class="link" href="#_dmn_and_test_scenario_keyboard_control">21.8.1. DMN and Test Scenario keyboard control</a></h4>
<div class="paragraph">
<p>For both DMN and Test Scenario tables, the following keyboard control support was added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Table navigation:</strong> After you select a cell in a DMN or Test Scenario table, you can use the arrow keys to navigate between other cells. The way you select the first cell differs in DMN and Test Scenario tables:</p>
<div class="ulist">
<ul>
<li>
<p>In a DMN table, the top-left cell is selected by default. Next to standard navigation, press <strong>Enter</strong> to select a nested expression and <strong>Esc</strong> to return to the parent expression.</p>
</li>
<li>
<p>In a Test Scenario table, no cell is selected by default. Press <strong>Shift+Home</strong> to select the first available cell.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Table editing:</strong> After you select a cell in a DMN or Test Scenario table, you can input a new value into the cell or change the already added value. To edit a cell, press <strong>Enter</strong>. To stop the editing, press <strong>Shift+Tab</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.15.0"><a class="anchor" href="#_drools.releasenotesdrools.7.15.0"></a><a class="link" href="#_drools.releasenotesdrools.7.15.0">21.9. New and Noteworthy in Drools 7.15</a></h3>
<div class="sect3">
<h4 id="_broken_dmn_resources_detected_in_drools_project_builds"><a class="anchor" href="#_broken_dmn_resources_detected_in_drools_project_builds"></a><a class="link" href="#_broken_dmn_resources_detected_in_drools_project_builds">21.9.1. Broken DMN resources detected in Drools project builds</a></h4>
<div class="paragraph">
<p>When a Drools project (KJAR file) contains an invalid or a broken resource, the project fails to build and reports the failure in one or more error messages. Previously, a Drools project with an invalid DMN resource could build successfully, with no error messages. With this release, this issue has been resolved so that an invalid DMN resource now causes a project build failure with error messaging, as expected (ref: DROOLS-3335).</p>
</div>
<div class="paragraph">
<p>For more information about project packaging and deployment, see <a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a>.</p>
</div>
<div class="paragraph">
<p>For a custom programmatic build, you can use the following code snippet to retrieve a list of build errors:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieFileSystem kfs = ks.newKieFileSystem()
                      .generateAndWritePomXML(releaseId)
                      .write(dmnResource);
KieBuilder kieBuilder = ks.newKieBuilder(kfs)
                          .buildAll();
Results results = kieBuilder.getResults();
if (results.hasMessages(Message.Level.ERROR)) {
    throw new IllegalStateException(results.getMessages(Message.Level.ERROR).toString());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_method_for_creating_a_knowledge_run_time"><a class="anchor" href="#_new_method_for_creating_a_knowledge_run_time"></a><a class="link" href="#_new_method_for_creating_a_knowledge_run_time">21.9.2. New method for creating a knowledge run time</a></h4>
<div class="paragraph">
<p>The preferred way to create a knowledge run time (for example, <code>DMNRuntime</code>) is no longer through a <code>KieSession</code> instance, but rather through the new <code>KieRuntimeFactory</code> API:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNRuntime rt = KieRuntimeFactory.of(kieContainer.getKieBase()).get(DMNRuntime.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.15.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.15.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.15.0.final">21.10. New and Noteworthy in KIE Workbench 7.15.0</a></h3>
<div class="sect3">
<h4 id="_git_hooks_notifications"><a class="anchor" href="#_git_hooks_notifications"></a><a class="link" href="#_git_hooks_notifications">21.10.1. Git hooks notifications</a></h4>
<div class="paragraph">
<p>Improved git hooks integration to provide feedback notifications to the user with customized messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_workbench_consolidation"><a class="anchor" href="#_kie_workbench_consolidation"></a><a class="link" href="#_kie_workbench_consolidation">21.10.2. KIE Workbench Consolidation</a></h4>
<div class="paragraph">
<p>KIE Workbench is now called Business Central and it is available on <code>business-central</code> web context.
Profiles provide a set of Business Central features and you can choose a profile based on your requirements.
The <code>FULL</code> profile is a default profile that includes all features. The <code>PLANNER_AND_RULES</code> profile includes only drools-kie-wb features. You can select a profile either by using the <code>org.kie.workbench.profile</code> system property (possible values are FULL or PLANNER_AND_RULES) or from the Profile option in the Administration screen.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.14.0"><a class="anchor" href="#_drools.releasenotesdrools.7.14.0"></a><a class="link" href="#_drools.releasenotesdrools.7.14.0">21.11. New and Noteworthy in Drools 7.14</a></h3>
<div class="sect3">
<h4 id="_file_system_based_kiescanner"><a class="anchor" href="#_file_system_based_kiescanner"></a><a class="link" href="#_file_system_based_kiescanner">21.11.1. File-system based KieScanner</a></h4>
<div class="paragraph">
<p>The <code>KieScanner</code> allows continuous monitoring of your Maven repository to check whether a new release of a Kie project has been installed
and if so it live updates the running <code>KieContainer</code> with the newer version of that project. However in many cases installing a maven
repository is impractical especially in production environment. For this reason it is now possible to have a <code>KieScanner</code> that works
by simply fetching update from a folder of a plain file system. You can create and start such a <code>KieScanner</code> as simply as</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieScanner kScanner = kieServices.newKieScanner( kContainer, "/myrepo/kjars" );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>where "/myrepo/kjars" will be the folder where the <code>KieScanner</code> will look for kjar updates. The jar files placed in this folder
have to follow the maven convention and then have to be a name in the form {artifactId}-{versionId}.jar</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_executable_models_in_dmn_projects"><a class="anchor" href="#_support_for_executable_models_in_dmn_projects"></a><a class="link" href="#_support_for_executable_models_in_dmn_projects">21.11.2. Support for executable models in DMN projects</a></h4>
<div class="paragraph">
<p>You can now use the <code>kie-maven-plugin</code> build component to generate DMN executable model classes and compile them in a Drools project (<code>kjar</code>). This support enables DMN decision table logic in DMN projects to be evaluated more efficiently.</p>
</div>
<div class="paragraph">
<p>To enable executable models in DMN projects, add the required <code>kie-dmn-core</code> dependency in the <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-dmn-core&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To build a DMN project enabling executable model compilation, navigate to your Maven project directory in a command terminal and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can define the property directly in the <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
  ...
  &lt;properties&gt;
    &lt;generateDMNModel&gt;yes&lt;/generateDMNModel&gt;
  &lt;/properties&gt;
  ...
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about configuring executable models for your Maven or Java project, see <a href="#executable-model-con_N&amp;N-7.7">Executable rule models</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.14.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.14.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.14.0.final">21.12. New and Noteworthy in KIE Workbench 7.14.0</a></h3>
<div class="sect3">
<h4 id="_ssh_and_git_daemon_port_assignment_changes"><a class="anchor" href="#_ssh_and_git_daemon_port_assignment_changes"></a><a class="link" href="#_ssh_and_git_daemon_port_assignment_changes">21.12.1. SSH and Git Daemon Port Assignment Changes</a></h4>
<div class="paragraph">
<p>If the SSH or Git daemon default or assigned ports are already in use, a new port is automatically selected. Ensure that the ports are available and check the log for more information.</p>
</div>
<div class="paragraph">
<p>Before this change, the application used to fail to start.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.13.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.13.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.13.0.final">21.13. New and Noteworthy in KIE Workbench 7.13.0</a></h3>
<div class="sect3">
<h4 id="_test_scenarios_preview_editor"><a class="anchor" href="#_test_scenarios_preview_editor"></a><a class="link" href="#_test_scenarios_preview_editor">21.13.1. Test Scenarios (Preview) editor</a></h4>
<div class="paragraph">
<p>This version contains the preview of the new Test Scenarios editor that tests a rule with a completely new user experience.</p>
</div>
<div class="paragraph">
<p>See section <a href="#test-scenarios-intro-con">Test scenarios</a> for details on enabling and using the editor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_experimental_features_support"><a class="anchor" href="#_experimental_features_support"></a><a class="link" href="#_experimental_features_support">21.13.2. Experimental Features support</a></h4>
<div class="paragraph">
<p>New <em>Experimental Features Framework</em> added to the Workbench. It provides an easy mechanism for users to preview features
which are not part of the product but might be interesting for them (for example, ongoing developments, tech previews, POCs&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>See section <a href="#_wb.experimentalFeatures">Experimental Features Framework</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ssh_keystore"><a class="anchor" href="#_ssh_keystore"></a><a class="link" href="#_ssh_keystore">21.13.3. SSH keystore</a></h4>
<div class="paragraph">
<p>In order to provide the Workbench VFS with proper SSH authentication, a new keystore must added. This keystore
enables users to register their SSH public keys.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor.png" alt="ssh keystore editor">
</div>
<div class="title">Figure 396. SSH keystore UI</div>
</div>
<div class="paragraph">
<p>You can access it from the <strong>Admin</strong> page using the new <strong>SSH Keys</strong> menu option.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh keystore menu">
</div>
<div class="title">Figure 397. SSH Keys Menu Option on Admin Page</div>
</div>
<div class="paragraph">
<p>See the <a href="#_wb.sshkeystore">SSH keystore</a> section for details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.13.0"><a class="anchor" href="#_drools.releasenotesdrools.7.13.0"></a><a class="link" href="#_drools.releasenotesdrools.7.13.0">21.14. New and Noteworthy in Drools 7.13</a></h3>
<div class="sect3">
<h4 id="_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types"><a class="anchor" href="#_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types"></a><a class="link" href="#_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types">21.14.1. Allow to declare serialVersionUID on classes generated from declared types</a></h4>
<div class="paragraph">
<p>To improve the compatibility of serialized KieSession, it has been introduced the possibility to specify the serialVersionUID
on the classes generated from the declared types through an annotation like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare MyClass
  @serialVersionUID( 42 )
  name : String
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_declaratively_set_calendars_on_kiesession_via_kmodule_xml"><a class="anchor" href="#_declaratively_set_calendars_on_kiesession_via_kmodule_xml"></a><a class="link" href="#_declaratively_set_calendars_on_kiesession_via_kmodule_xml">21.14.2. Declaratively set Calendars on KieSession via kmodule.xml</a></h4>
<div class="paragraph">
<p>It is possible to declaratively set one or more Calendars on a KieSession through the kmodule.xml configuration file as
in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;ksession name="KSession1"&gt;
  &lt;calendars&gt;
    &lt;calendar name="monday" type="org.domain.Monday"/&gt;
  &lt;/calendars&gt;
&lt;/ksession&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the type is the name of class implementing the <code>org.kie.api.time.Calendar</code> interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions_pool"><a class="anchor" href="#_kiesessions_pool"></a><a class="link" href="#_kiesessions_pool">21.14.3. KieSessions pool</a></h4>
<div class="paragraph">
<p>In high volume use cases `KieSession`s get created and disposed with a very high frequency. In general this operation is not
extremely time consuming, but when repeated millions of times can become a bottleneck and also requires a huge GC effort.
Some users tried to alleviate this problem with self-made pools and for this reason it has been decided to provide this
solution out-of-the-box.</p>
</div>
<div class="paragraph">
<p>To obtain a pool of <code>KieSession</code> from a <code>KieContainer</code> is enough to invoke on it the method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>KieContainerSessionsPool KieContainer.newKieSessionsPool(int initialSize)</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>initialSize</code> is the number of the <code>KieSession`s that will be initially created in the pool. However, if required by the running
application, the number of `KieSession`s in the pool will dynamically grow beyond that value. At this point you can create
`KieSession`s from that pool as you would normally do from a `KieContainer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>KieContainerSessionsPool pool = kContainer.newKieSessionsPool(10);
KieSession kSession = pool.newKieSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can use the KieSession as per normal, and when you call <code>dispose()</code> on it, instead of being destroyed, it just
gets resetted and pushed back into the pool. Note that using this pool will also affect the case when you have one or more
<code>StatelessKieSession`s and you keep reusing them with multiple call to the `execute()</code> method. In fact a  <code>StatelessKieSession</code>
created directly from a <code>KieContainer</code> will keep to internally create a new <code>KieSession</code> for each <code>execute()</code> invocation.
Conversely if you create the <code>StatelessKieSession</code> from the pool it will internally uses the <code>KieSession`s provided by the
pool itself. In other words even if you asked a `StatelessKieSession</code> to the pool, what is actually pooled are the `KieSession`s
that are wrapped by it.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;re done with the pool it is required that you call the <code>shutdown()</code> method on it to avoid memory leaks. Alternatively
calling <code>dispose()</code> on the whole <code>KieContainer</code> will also automatically shutdown all the pools eventually created from it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.releasenotesworkbench.7.13.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.13.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.13.0.final">21.14.4. New and Noteworthy in KIE Workbench 7.13.0</a></h4>
<div class="sect4">
<h5 id="_test_scenarios_preview_editor_2"><a class="anchor" href="#_test_scenarios_preview_editor_2"></a><a class="link" href="#_test_scenarios_preview_editor_2">21.14.4.1. Test Scenarios (Preview) editor</a></h5>
<div class="paragraph">
<p>This version contains the preview of the new Test Scenarios editor that tests a rule with a completely new user experience.</p>
</div>
<div class="paragraph">
<p>See section <a href="#test-scenarios-intro-con">Test scenarios</a> for details on enabling and using the editor.</p>
</div>
</div>
<div class="sect4">
<h5 id="_experimental_features_support_2"><a class="anchor" href="#_experimental_features_support_2"></a><a class="link" href="#_experimental_features_support_2">21.14.4.2. Experimental Features support</a></h5>
<div class="paragraph">
<p>New <em>Experimental Features Framework</em> added to the Workbench. It provides an easy mechanism for users to preview features
which are not part of the product but might be interesting for them (for example, ongoing developments, tech previews, POCs&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>See section <a href="#_wb.experimentalFeatures">Experimental Features Framework</a> for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ssh_keystore_2"><a class="anchor" href="#_ssh_keystore_2"></a><a class="link" href="#_ssh_keystore_2">21.14.4.3. SSH keystore</a></h5>
<div class="paragraph">
<p>In order to provide the Workbench VFS with proper SSH authentication, a new keystore must added. This keystore
enables users to register their SSH public keys.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor.png" alt="ssh keystore editor">
</div>
<div class="title">Figure 398. SSH keystore UI</div>
</div>
<div class="paragraph">
<p>You can access it from the <strong>Admin</strong> page using the new <strong>SSH Keys</strong> menu option.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh keystore menu">
</div>
<div class="title">Figure 399. SSH Keys Menu Option on Admin Page</div>
</div>
<div class="paragraph">
<p>See the <a href="#_wb.sshkeystore">SSH keystore</a> section for details.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.12.0"><a class="anchor" href="#_drools.releasenotesdrools.7.12.0"></a><a class="link" href="#_drools.releasenotesdrools.7.12.0">21.15. New and Noteworthy in Drools 7.12</a></h3>
<div class="sect3">
<h4 id="_end_of_support_for_drools_rhq_plugin_component"><a class="anchor" href="#_end_of_support_for_drools_rhq_plugin_component"></a><a class="link" href="#_end_of_support_for_drools_rhq_plugin_component">21.15.1. End of support for <code>drools-rhq-plugin</code> component</a></h4>
<div class="paragraph">
<p>The <code>drools-rhq-plugin</code> component for monitoring Drools using JBoss Operations Network is no longer supported because it is underutilized and has become outdated.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.11.0"><a class="anchor" href="#_drools.releasenotesdrools.7.11.0"></a><a class="link" href="#_drools.releasenotesdrools.7.11.0">21.16. New and Noteworthy in Drools 7.11</a></h3>
<div class="sect3">
<h4 id="_minor_api_changes_of_kie_dmn_open_source_engine"><a class="anchor" href="#_minor_api_changes_of_kie_dmn_open_source_engine"></a><a class="link" href="#_minor_api_changes_of_kie_dmn_open_source_engine">21.16.1. Minor API changes of Kie DMN open source engine</a></h4>
<div class="paragraph">
<p>The API of Kie DMN open source engine introduces some minor changes, in order to support the new DMN v1.2 format.</p>
</div>
<div class="paragraph">
<p>A new package <code>org.kie.dmn.model.api</code> inside Maven module <code>kie-dmn-model</code> provides a generic model to support for both DMN versions v1.1 and v1.2.
This requires users of previous versions to update references from previous package <code>org.kie.dmn.model.v1_1</code> to this new package <code>org.kie.dmn.model.api</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Users of the Kie DMN API must update references of import packages from <code>import org.kie.dmn.model.v1_1.<strong>;</code> to <code>import org.kie.dmn.model.api.</strong>;</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Package <code>org.kie.dmn.api.marshalling.v1_1</code> has been deprecated in favour of <code>org.kie.dmn.api.marshalling</code>; normally this shouldn&#8217;t impact end-users of the Kie DMN API as the <code>DMNRuntime</code> will automatically provide support for both DMN v1.1 and v1.2. This change impacts users who manage the marshaling of DMN resources manually, who must upgrade to the new package in order to support the new DMN v1.2 version.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.11.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.11.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.11.0.final">21.17. New and Noteworthy in KIE Workbench 7.11.0</a></h3>
<div class="sect3">
<h4 id="_multiple_git_branches_support"><a class="anchor" href="#_multiple_git_branches_support"></a><a class="link" href="#_multiple_git_branches_support">21.17.1. Multiple Git branches support</a></h4>
<div class="paragraph">
<p>You can now work on multiple Git source branches interchangeably in Business Central to improve the Git workflow of your projects.</p>
</div>
<div class="paragraph">
<p>After you have created and opened a project, you can see all the assets of your project:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/project_master.png" alt="project master">
</div>
</div>
<div class="paragraph">
<p>In the breadcrumbs navigation, you can now see a drop-down menu that, when clicked, displays all the Git branches available:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/branches_breadcrumb_only_master.png" alt="branches breadcrumb only master">
</div>
</div>
<div class="paragraph">
<p>You can click <strong>Add Branch</strong> to add more branches to your project:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/add_branch_popup.png" alt="add branch popup">
</div>
</div>
<div class="paragraph">
<p>After adding the new branch, you are redirected to the new branch with all the assets that you had in the base branch:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/feature_branch.png" alt="feature branch">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/branches_breadcrumb.png" alt="branches breadcrumb">
</div>
</div>
<div class="paragraph">
<p>You can also click <strong>Delete Branch</strong> in the top-right corner of the screen to delete any branch except for the master branch:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/delete_branch_option.png" alt="delete branch option">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.9.0"><a class="anchor" href="#_drools.releasenotesdrools.7.9.0"></a><a class="link" href="#_drools.releasenotesdrools.7.9.0">21.18. New and Noteworthy in Drools 7.9</a></h3>
<div class="sect3">
<h4 id="_moved_executablecommand_to_kie_public_api"><a class="anchor" href="#_moved_executablecommand_to_kie_public_api"></a><a class="link" href="#_moved_executablecommand_to_kie_public_api">21.18.1. Moved ExecutableCommand to KIE public API</a></h4>
<div class="paragraph">
<p>Drools internal <code>ExecutableCommand</code> interface has been moved to KIE public API. It&#8217;s now possible to create custom
executable commands without rely on internal interface.</p>
</div>
<div class="paragraph">
<p>A deprecated internal <code>ExecutableCommand</code> interface still exists for backward compatibility and will be removed in a
future release.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Existing custom commands based on old internal interface that override <code>canRunInTransaction()</code> method will no
longer compile due to this change.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_alpha_network_compiler"><a class="anchor" href="#_alpha_network_compiler"></a><a class="link" href="#_alpha_network_compiler">21.18.2. Alpha Network Compiler</a></h4>
<div class="paragraph">
<p>Drools now supports an optimization on evaluating alpha nodes which involves generating an intermediate class that gets compiled to evaluate the constraint faster.</p>
</div>
<div class="paragraph">
<p>It&#8217;s highly experimental and it&#8217;s supposed to work only with the new executable model system. To enable it use <code>drools.alphaNetworkCompiler</code> configuration key in the <code>KieModuleModel</code> configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;configuration&gt;
    &lt;property key="drools.alphaNetworkCompiler" value="true"/&gt;
  &lt;/configuration&gt;
&lt;/kmodule&gt;</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The current implementation has problems with incremental compilation so don&#8217;t use it together.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.8.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.8.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.8.0.final">21.19. New and Noteworthy in KIE Workbench 7.8.0</a></h3>
<div class="sect3">
<h4 id="_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files"><a class="anchor" href="#_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files"></a><a class="link" href="#_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files">21.19.1. New System Property for setting the Default Maven Repository in Project pom.xml files</a></h4>
<div class="paragraph">
<p>To make building Workbench projects outside of the Workbench easier, it is now possible to set the URL for the default Maven Repository that is added into each new Project pom.xml. It is recommended that you set this before starting you Workbench for the first time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.7.0"><a class="anchor" href="#_drools.releasenotesdrools.7.7.0"></a><a class="link" href="#_drools.releasenotesdrools.7.7.0">21.20. New and Noteworthy in Drools 7.7</a></h3>
<div class="sect3">
<h4 id="executable-model-con_N&amp;N-7.7"><a class="anchor" href="#executable-model-con_N&amp;N-7.7"></a><a class="link" href="#executable-model-con_N&amp;N-7.7">21.20.1. Executable rule models</a></h4>
<div class="paragraph">
<p>Executable rule models are embeddable models that provide a Java-based representation of a rule set for execution at build time. The executable model is a more efficient alternative to the standard asset packaging in Drools and enables KIE containers and KIE bases to be created more quickly, especially when you have large lists of DRL (Drools Rule Language) files and other Drools assets. The model is low level and enables you to provide all necessary execution information, such as the lambda expressions for the index evaluation.</p>
</div>
<div class="paragraph">
<p>Executable rule models provide the following specific advantages for your projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Compile time:</strong> Traditionally, a packaged Drools project (KJAR) contains a list of DRL files and other Drools artifacts that define the rule base together with some pre-generated classes implementing the constraints and the consequences. Those DRL files must be parsed and compiled when the KJAR is downloaded from the Maven repository and installed in a KIE container. This process can be slow, especially for large rule sets. With an executable model, you can package within the project KJAR the Java classes
that implement the executable model of the project rule base and re-create the KIE container and its KIE bases out of it in a much faster way. In Maven projects, you use the <code>kie-maven-plugin</code> to automatically generate the executable model sources from the DRL files during the compilation process.</p>
</li>
<li>
<p><strong>Run time:</strong> In an executable model, all constraints are defined as Java lambda expressions. The same lambda expressions are also used
for constraints evaluation, so you no longer need to use <code>mvel</code> expressions for interpreted evaluation nor the just-in-time (JIT) process to transform the <code>mvel</code>-based constraints into bytecode. This creates a quicker and more efficient run time.</p>
</li>
<li>
<p><strong>Development time:</strong> An executable model enables you to develop and experiment with new features of the Drools engine without needing to encode elements directly in the DRL format or modify the DRL parser to support them.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For query definitions in executable rule models, you can use up to 10 arguments only.</p>
</div>
<div class="paragraph">
<p>For variables within rule consequences in executable rule models, you can use up to 24 bound variables only (including the built-in <code>drools</code> variable). For example, the following rule consequence uses more than 24 bound variables and creates a compilation error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...
then
  $input.setNo25Count(functions.sumOf(new Object[]{$no1Count_1, $no2Count_1, $no3Count_1, ..., $no25Count_1}).intValue());
  $input.getFirings().add("fired");
  update($input);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_executable_model_domain_specific_languages_dsls"><a class="anchor" href="#_executable_model_domain_specific_languages_dsls"></a><a class="link" href="#_executable_model_domain_specific_languages_dsls">21.20.1.1. Executable model domain-specific languages (DSLs)</a></h5>
<div class="paragraph">
<p>One goal while designing the first iteration of the domain-specific language (DSL) for the executable model was to get rid of the notion of pattern and to consider a rule as a flow of expressions (constraints) and actions (consequences). For this reason we called it Flow DSL. Some examples of this DSL are available here.</p>
</div>
<div class="paragraph">
<p>However after having implemented the Flow DSL it became clear that the decision of avoiding the explicit use of patterns obliged us to implement some extra logic that had both a complexity and a performance cost, since in order to properly re-create the data structures expected by the Drools compiler it is necessary to put together the patterns out of those apparently unrelated expressions.</p>
</div>
<div class="paragraph">
<p>For this reason it has been decided to reintroduce the patterns in a second DSL that we called Pattern DSL. This allowed to bypass that algorithm grouping expressions that has to fill an artificial semantic gap and that is also time consuming at run time. We believe that both DSLs are valid for different use cases and so we decided to keep and support both. In particular the Pattern DSL is safer and faster (even if more verbose) so this will be the DSL that will be automatically generated when creating a KJAR through the kie-maven-plugin. Conversely the Flow DSL is more succinct and closer to the way a user may want to programmatically define a rule in Java and we planned to make it even less verbose by generating in an automatic way through a post processor the parts of the model defining the indexing and property reactivity. In other words, we expect that the Pattern DSL will be written by machines and the Flow DSL eventually by humans.</p>
</div>
</div>
<div class="sect4">
<h5 id="executable-model-maven-proc_N&amp;N-7.7"><a class="anchor" href="#executable-model-maven-proc_N&amp;N-7.7"></a><a class="link" href="#executable-model-maven-proc_N&amp;N-7.7">21.20.1.2. Embedding an executable rule model in a Maven project</a></h5>
<div class="paragraph">
<p>You can embed an executable rule model in your Maven project to compile your rule assets more efficiently at build time.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a Mavenized project that contains Drools business assets.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <code>pom.xml</code> file of your Maven project, ensure that the packaging type is set to <code>kjar</code> and add the <code>kie-maven-plugin</code> build component:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;kjar&lt;/packaging&gt;
...
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;${drools.version}&lt;/version&gt;
      &lt;extensions&gt;true&lt;/extensions&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>kjar</code> packaging type activates the <code>kie-maven-plugin</code> component to validate and pre-compile artifact resources. The <code>&lt;version&gt;</code> is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005). These settings are required to properly package the Maven project.</p>
</div>
</div>
</div>
</li>
<li>
<p>Add the following dependencies to the <code>pom.xml</code> file to enable rule assets to be built from an executable model:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>drools-canonical-model</code>: Enables an executable canonical representation of a rule set model that is independent from Drools</p>
</li>
<li>
<p><code>drools-model-compiler</code>: Compiles the executable model into Drools internal data structures so that it can be executed by the Drools engine</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-canonical-model&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-model-compiler&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In a command terminal, navigate to your Maven project directory and run the following command to build the project from an executable model:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateModel=&lt;VALUE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-DgenerateModel=&lt;VALUE&gt;</code> property enables the project to be built as a model-based KJAR instead of a DRL-based KJAR.</p>
</div>
<div class="paragraph">
<p>Replace <code>&lt;VALUE&gt;</code> with one of three values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>YES</code>: Generates the executable model corresponding to the DRL files in the original project and excludes the DRL files from the generated KJAR.</p>
</li>
<li>
<p><code>WITHDRL</code>: Generates the executable model corresponding to the DRL files in the original project and also adds the DRL files to the generated KJAR for documentation purposes (the KIE base is built from the executable model regardless).</p>
</li>
<li>
<p><code>NO</code>: Does not generate the executable model.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example build command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateModel=YES</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="executable-model-java-proc_N&amp;N-7.7"><a class="anchor" href="#executable-model-java-proc_N&amp;N-7.7"></a><a class="link" href="#executable-model-java-proc_N&amp;N-7.7">21.20.1.3. Embedding an executable rule model in a Java application</a></h5>
<div class="paragraph">
<p>You can embed an executable rule model programmatically within your Java application to compile your rule assets more efficiently at build time.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a Java application that contains Drools business assets.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the following dependencies to the relevant classpath for your Java project:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>drools-canonical-model</code>: Enables an executable canonical representation of a rule set model that is independent from Drools</p>
</li>
<li>
<p><code>drools-model-compiler</code>: Compiles the executable model into Drools internal data structures so that it can be executed by the Drools engine</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-canonical-model&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-model-compiler&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;version&gt;</code> is the Maven artifact version for Drools currently used in your project (for example, 7.26.0.Final-redhat-00005).</p>
</div>
</div>
</div>
</li>
<li>
<p>Add rule assets to the KIE virtual file system <code>KieFileSystem</code> and use <code>KieBuilder</code> with <code>buildAll( ExecutableModelProject.class )</code> specified to build the assets from an executable model:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.KieServices;
import org.kie.api.builder.KieFileSystem;
import org.kie.api.builder.KieBuilder;

  KieServices ks = KieServices.Factory.get();
  KieFileSystem kfs = ks.newKieFileSystem()
  kfs.write("src/main/resources/KBase1/ruleSet1.drl", stringContainingAValidDRL)
  .write("src/main/resources/dtable.xls",
    kieServices.getResources().newInputStreamResource(dtableFileStream));

  KieBuilder kieBuilder = ks.newKieBuilder( kfs );
  // Build from an executable model
  kieBuilder.buildAll( ExecutableModelProject.class )
  assertEquals(0, kieBuilder.getResults().getMessages(Message.Level.ERROR).size());</code></pre>
</div>
</div>
<div class="paragraph">
<p>After <code>KieFileSystem</code> is built from the executable model, the resulting <code>KieSession</code> uses constraints based on lambda expressions instead of less-efficient <code>mvel</code> expressions. If <code>buildAll()</code> contains no arguments, the project is built in the standard method without an executable model.</p>
</div>
<div class="paragraph">
<p>As a more manual alternative to using <code>KieFileSystem</code> for creating executable models, you can define a <code>Model</code> with a fluent API and create a <code>KieBase</code> from it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Model model = new ModelImpl().addRule( rule );
KieBase kieBase = KieBaseBuilder.createKieBaseFromModel( model );</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.7.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.7.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.7.0.final">21.21. New and Noteworthy in KIE Workbench 7.7.0</a></h3>
<div class="sect3">
<h4 id="_project_oriented_workbench"><a class="anchor" href="#_project_oriented_workbench"></a><a class="link" href="#_project_oriented_workbench">21.21.1. Project Oriented Workbench</a></h4>
<div class="paragraph">
<p>Workbench becomes Project Oriented. Meaning each project is now in a dedicated repository. Previously each project was in a folder and one repository could hold several projects. These changes merge the concepts of Project and Repository.</p>
</div>
<div class="paragraph">
<p>One project one repository approach makes the UI simpler and improves releasing or freezing a single project. Previously if a project was frozen, branched or tagged the repository was still shared with other projects, making the release control harder and more complicated.</p>
</div>
<div class="paragraph">
<p>Projects from older Workbench versions need to be migrated to the new setup. For this we offer a command line migration tool.</p>
</div>
<div class="paragraph">
<p>Project Orientated does not, at the moment, offer support for multimodule setup. This feature is planned, but not in this release. The now deprecated Asset Management features depended on multimodule support and can not be migrated to this Workbench version.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_a_headless_drools_controller"><a class="anchor" href="#_connecting_to_a_headless_drools_controller"></a><a class="link" href="#_connecting_to_a_headless_drools_controller">21.21.2. Connecting to a headless Drools controller</a></h4>
<div class="paragraph">
<p>When running a Workbench instance, there is now greater flexibility to decide how Kie Server instances will be managed.
Previously, whenever a Workbench is started, it would always start an embedded Drools controller. This setup is still available
but now there is also an option to not start this service and instead connect to a headless Drools controller.
This allows a more fine grained deployment model where it&#8217;s possible to decide the best approach for a specific scenario.</p>
</div>
<div class="paragraph">
<p>To switch between these modes, a key system property is used: <strong>org.kie.workbench.controller</strong>. By default, the Workbench
will continue to start the embedded service if this system property is missing. Otherwise, it will try to connect to the remote
service and also ensure that none of the embedded services are started.</p>
</div>
<div class="paragraph">
<p>It is important to note that only Web Socket connection protocol is available to use when connecting to headless Drools controller.</p>
</div>
<div class="paragraph">
<p>For more details regarding all possible system configs regarding user name, password, token and secured password via key store,
please refer to <a href="#_wb.systemproperties">Workbench system properties</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_content_management_enhancements"><a class="anchor" href="#_content_management_enhancements"></a><a class="link" href="#_content_management_enhancements">21.21.3. Content management enhancements</a></h4>
<div class="sect4">
<h5 id="_properties_panel"><a class="anchor" href="#_properties_panel"></a><a class="link" href="#_properties_panel">21.21.3.1. Properties panel</a></h5>
<div class="paragraph">
<p>It is possible to edit the properties of the different page elements including, the page itself or any of its rows and components.
Once an element is selected, either by hovering on the element and clicking on the editor&#8217;s area or selecting the element in the
<em>Properties</em> panel dropdown, its properties are displayed in the left docked panel. See screenshot:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/ContentManagementPropertiesPanel.png" alt="ContentManagementPropertiesPanel">
</div>
<div class="title">Figure 400. Content management properties panel</div>
</div>
<div class="paragraph">
<p>The properties available in this version are basically those related with the element style such as width, height or margins, amongst others.
The properties available might differ for each type. Notice for example, the HTML component provides an extra set of properties all related
with the text style.</p>
</div>
<div class="paragraph">
<p>Once a property is changed, its value is reflected in the editor&#8217;s area, both in <em>design</em> and <em>preview</em> modes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_screen_component_removed"><a class="anchor" href="#_screen_component_removed"></a><a class="link" href="#_screen_component_removed">21.21.3.2. Screen component removed</a></h5>
<div class="paragraph">
<p>The <em>Screen</em> component, which was placed under the <em>Core</em> group in the right sidebar&#8217;s <em>Components</em> panel, has been removed.
The reason is, this component was not suitable for production environments.</p>
</div>
<div class="paragraph">
<p>In future versions though, domain related components, such as a BPM&#8217;s task list, will be available for easy consumption by end users.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_migration_tool"><a class="anchor" href="#_new_migration_tool"></a><a class="link" href="#_new_migration_tool">21.21.4. New Migration Tool</a></h4>
<div class="paragraph">
<p>A new command line Migration tool with support for Linux and Windows has been provided to move different resources to it&#8217;s latest version.
It makes possible to perform different migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Project Migration</strong>: migrates KIE projects from the old project layout (7.4.x and previous) to the new project-oriented structure.</p>
</li>
<li>
<p><strong>Forms Migration</strong>: migrates old jBPM Form Modeler forms into the new Forms format.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/7.7.0/MigrationTool.png" alt="MigrationTool">
</div>
<div class="title">Figure 401. Command Line Migration Tool</div>
</div>
<div class="paragraph">
<p>You can find more info <a href="https://github.com/kiegroup/kie-wb-common/blob/master/kie-wb-common-cli/kie-wb-common-cli-migration-tool/README.md">here</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.6.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.6.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.6.0.final">21.22. New and Noteworthy in KIE Workbench 7.6.0</a></h3>
<div class="sect3">
<h4 id="_content_management_enhancements_2"><a class="anchor" href="#_content_management_enhancements_2"></a><a class="link" href="#_content_management_enhancements_2">21.22.1. Content management enhancements</a></h4>
<div class="paragraph">
<p>A few extra changes have been introduced in the <em>Content Management</em> tooling (aka <em>Page Authoring</em>) in order to
improve the user experience. The following screenshot reveals the changes introduced since the latest version.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/ContentManagementEnhancements.png" alt="ContentManagementEnhancements">
</div>
<div class="title">Figure 402. Content management new look &amp; feel</div>
</div>
<div class="sect4">
<h5 id="_fluidpage_editor_mode_selection"><a class="anchor" href="#_fluidpage_editor_mode_selection"></a><a class="link" href="#_fluidpage_editor_mode_selection">21.22.1.1. Fluid/Page editor mode selection</a></h5>
<div class="paragraph">
<p>The new page pop up allows for the selection of two edition modes:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/NewPagePopup.png" alt="NewPagePopup">
</div>
<div class="title">Figure 403. Content management&#8217;s new page pop up</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fluid</strong>: it acts more as a classical web page, showing a vertical scrollbar when the page exceeds the available height.</p>
</li>
<li>
<p><strong>Page</strong>: it was the default in previous versions. When selected, it forces the page to always fit the window&#8217;s 100% height.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_preview_feature"><a class="anchor" href="#_preview_feature"></a><a class="link" href="#_preview_feature">21.22.1.2. Preview feature</a></h5>
<div class="paragraph">
<p>Page authors can go back and forth from the <em>Editor</em> to the <em>Preview</em> mode as many times as needed. In the <em>Preview</em> mode
all the editor&#8217;s controls are removed, allowing for the display of the page as it would be seen by end
users once the page is published.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_dock_panels_to_increase_the_editor_content_area"><a class="anchor" href="#_use_dock_panels_to_increase_the_editor_content_area"></a><a class="link" href="#_use_dock_panels_to_increase_the_editor_content_area">21.22.1.3. Use dock panels to increase the editor content area</a></h5>
<div class="paragraph">
<p>In order to increase the available space in the editor&#8217;s central area, the page listing, the navigation configuration and the
component palette panels have all been moved to the left sidebar as docked panels.</p>
</div>
</div>
<div class="sect4">
<h5 id="_component_palette_reorganization"><a class="anchor" href="#_component_palette_reorganization"></a><a class="link" href="#_component_palette_reorganization">21.22.1.4. Component palette reorganization</a></h5>
<div class="paragraph">
<p>In previous versions, there only existed one single category of components in the palette. As of
version 7.6, the components are now grouped into three main categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Core</em>: HTML and Page components</p>
</li>
<li>
<p><em>Navigation</em>: Menu Bar, Tree, Tiles, Tab List, Carousel and Target Div</p>
</li>
<li>
<p><em>Reporting</em>: Bar, Pie, Line, Area, Map, Bubble, Metric, Meter, Table and Filter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The goal of these changes is to make the palette more appealing as well as to ease the selection of the target component to
drag.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kieserver.releasenoteskie.7.5.1"><a class="anchor" href="#_kieserver.releasenoteskie.7.5.1"></a><a class="link" href="#_kieserver.releasenoteskie.7.5.1">21.23. New Drools controller client API</a></h3>
<div class="paragraph">
<p>In order to facilitate the management of Drools controller related tasks such as creating server templates, starting and stopping containers,
etc, we developed a new Java client API available under the kie-server-controller-client Maven module.
With this API, you can connect to a Drools controller using either REST or Web Socket protocols.
For more details, see <a href="#ControllerJavaAPI-section.adoc">Drools controller Client API</a> chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_breaking_changes_in_kie_server_7_5_1_from_7_0"><a class="anchor" href="#_breaking_changes_in_kie_server_7_5_1_from_7_0"></a><a class="link" href="#_breaking_changes_in_kie_server_7_5_1_from_7_0">21.24. Breaking changes in Kie Server 7.5.1 from 7.0</a></h3>
<div class="sect3">
<h4 id="_drools_controller_api_changes"><a class="anchor" href="#_drools_controller_api_changes"></a><a class="link" href="#_drools_controller_api_changes">21.24.1. Drools controller API changes</a></h4>
<div class="paragraph">
<p>Changes to <code>SpecManagementService</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Included new method <code>getContainerInfo</code> that allows to retrieve a single <code>ContainerSpec</code> defined in a <code>ServerTemplate</code>.</p>
</li>
<li>
<p>Changed methods <code>listContainerSpec</code>, <code>listServerTemplateKeys</code>, and <code>listServerTemplates</code> return types from generic
collection to specific domain list types (<code>ContainerSpecList</code>, <code>ServerTemplateKeyList</code>, and <code>ServerTemplateList</code>) in order
to properly serialize and deserialize the returned values using JAXB and JSON.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changes to <code>RuleCapabilitiesService</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>startScanner</code> method now uses a <code>java.lang.Long</code> time instead of a primitive <code>long</code> for the <code>interval</code> parameter in order
to avoid JSON and JAXB serialization issues.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changes to <code>RuntimeManagementService</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changed methods <code>getContainers</code> and <code>getServerInstances</code> return types from generic collection to specific domain list types
(<code>ContainerList</code> and <code>ServerInstanceKeyList</code>) in order to properly serialize and deserialize the returned values using JAXB and JSON.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://issues.jboss.org/browse/JBPM-6243">JBPM-6243</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_server_api_changes"><a class="anchor" href="#_kie_server_api_changes"></a><a class="link" href="#_kie_server_api_changes">21.24.2. Kie Server API changes</a></h4>
<div class="paragraph">
<p>Changes to <code>ServiceResponse</code> wrapper:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Moved <code>ResponseType</code> enum and common methods to a new interface called <code>KieServiceResponse</code>,
allowing it to be extended to multiple implementations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.5.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.5.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.5.0.final">21.25. New and Noteworthy in KIE Workbench 7.5.0</a></h3>
<div class="sect3">
<h4 id="_content_management_enhancements_3"><a class="anchor" href="#_content_management_enhancements_3"></a><a class="link" href="#_content_management_enhancements_3">21.25.1. Content management enhancements</a></h4>
<div class="paragraph">
<p>Remarkable changes have been introduced in the <em>Content Management</em> (aka <em>Dashboards</em>) tooling in order to
improve the user experience.</p>
</div>
<div class="sect4">
<h5 id="_perspective_to_page_renaming"><a class="anchor" href="#_perspective_to_page_renaming"></a><a class="link" href="#_perspective_to_page_renaming">21.25.1.1. Perspective to page renaming</a></h5>
<div class="paragraph">
<p>The "page" term is far more familiar to users. Notice that, "perspective" is a concept that was borrowed from the Eclipse
development tool, thus it is a concept mostly used in developer circles. Page is more related to web content, easier to
understand by regular people. For this reason, perspective has been renamed to page all over the tooling.</p>
</div>
</div>
<div class="sect4">
<h5 id="_left_sidebar_new_look_and_feel"><a class="anchor" href="#_left_sidebar_new_look_and_feel"></a><a class="link" href="#_left_sidebar_new_look_and_feel">21.25.1.2. Left sidebar new look and feel</a></h5>
<div class="paragraph">
<p>This is the most noticeable change introduced. The left sidebar has been completely rewritten in order to provide an
enhanced look and feel.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/ContentManagementLeftSideBar.png" alt="ContentManagementLeftSideBar">
</div>
<div class="title">Figure 404. Content management tooling&#8217;s left side bar</div>
</div>
<div class="paragraph">
<p>The two sections <em>Pages</em> and <em>Navigation</em> have been merged into a single view. From this view users can either create
new pages or change the navigation configuration.</p>
</div>
<div class="paragraph">
<p>The <em>Navigation</em> section lists the navigation trees. Specifically, the tree named <em>Workbench</em> is available by
default, it can not be deleted and it contains the entries displayed in the workbench&#8217;s top mega menu. Any change applied
to it will cause the mega menu to modify its entries. This is actually the mechanism users must use to extend the workbench
with new pages.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tags_button_disabled"><a class="anchor" href="#_tags_button_disabled"></a><a class="link" href="#_tags_button_disabled">21.25.1.3. Tags button disabled</a></h5>
<div class="paragraph">
<p>The tags feature or the ability to attach a set of labels to a page during edition time has been removed. This
feature in combination with the former "Apps" perspective was used to allow users to publish their dynamic pages
in a categorized way. This feature is no longer needed. During the edition of a page, the <em>Tags</em> button, that used
to appear at the editor&#8217;s top right button bar, has been removed.</p>
</div>
<div class="paragraph">
<p>As a replacement, users can leverage the existing navigation features to create new pages and attach them
to the workbench&#8217;s mega menu.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_extra_navigation_components"><a class="anchor" href="#_extra_navigation_components"></a><a class="link" href="#_extra_navigation_components">21.25.2. Extra navigation components</a></h4>
<div class="paragraph">
<p>The existing navigation components available in the <em>Content Management</em> tooling have been extended with some extra types.
To date there exist the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tile navigator</p>
</li>
<li>
<p>Tab list</p>
</li>
<li>
<p>Carousel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following have recently been added to the release:</p>
</div>
<div class="sect4">
<h5 id="_menu_bar"><a class="anchor" href="#_menu_bar"></a><a class="link" href="#_menu_bar">21.25.2.1. Menu bar</a></h5>
<div class="paragraph">
<p>As its name states, this component displays the entries of a navigation tree in a menu bar shape. There is no limit to
the number of levels supported. When a page item is clicked, the page content is displayed in the <em>Target div</em>
(see details below) component specified in the menu bar&#8217;s configuration.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/MenubarComponent.png" alt="MenubarComponent">
</div>
<div class="title">Figure 405. Menu bar navigation component</div>
</div>
</div>
<div class="sect4">
<h5 id="_tree_navigator"><a class="anchor" href="#_tree_navigator"></a><a class="link" href="#_tree_navigator">21.25.2.2. Tree navigator</a></h5>
<div class="paragraph">
<p>Same as the <em>Menu bar</em>, but the entries are displayed as a vertical tree structure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/TreeNavigatorComponent.png" alt="TreeNavigatorComponent">
</div>
<div class="title">Figure 406. Menu bar navigation component</div>
</div>
</div>
<div class="sect4">
<h5 id="_target_div"><a class="anchor" href="#_target_div"></a><a class="link" href="#_target_div">21.25.2.3. Target div</a></h5>
<div class="paragraph">
<p>Both the <em>Carousel</em> and the <em>Tile navigator</em> components can handle by themselves the display of the items the user clicks on.
Others like <em>Tab list</em>, <em>Menu bar</em> and <em>Tree navigator</em> require a <em>Target div</em> component as its display output since they
have a clear separation between the display of its entries and the content of the last item clicked.</p>
</div>
<div class="paragraph">
<p>So, every time, a <em>Target div</em> based navigation component is dropped into a page, a <em>Target div</em> component must
have been dropped as well, so that the first one can link to it. The following screen shows the configuration panel that
 is displayed every time a target div based component is dropped into a page.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/NavComponentTargetDivModal.png" alt="NavComponentTargetDivModal">
</div>
<div class="title">Figure 407. Target div based navigation components configuration</div>
</div>
<div class="paragraph">
<p>The navigation group is mandatory for all the navigation components as it indicates the navigation structure to display
whereas the <em>Target div</em> setting is <strong>not</strong> available for non target div components like <em>Carousel</em> or <em>Tile navigator</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.4.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.4.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.4.0.final">21.26. New and Noteworthy in KIE Workbench 7.4.0</a></h3>
<div class="sect3">
<h4 id="_guided_decision_table_improvements"><a class="anchor" href="#_guided_decision_table_improvements"></a><a class="link" href="#_guided_decision_table_improvements">21.26.1. Guided Decision Table improvements</a></h4>
<div class="paragraph">
<p>In addition to fixing numerous bugs the Wizard used to create and edit columns has been improved to show descriptions of the different steps required for the different column types.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtable-wizard-help-text1.png" alt="dtable wizard help text1">
</div>
<div class="title">Figure 408. Guided Decision Table Wizard example 1</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtable-wizard-help-text2.png" alt="dtable wizard help text2">
</div>
<div class="title">Figure 409. Guided Decision Table Wizard example 2</div>
</div>
</div>
<div class="sect3">
<h4 id="_disable_experimental_editors"><a class="anchor" href="#_disable_experimental_editors"></a><a class="link" href="#_disable_experimental_editors">21.26.2. Disable experimental editors</a></h4>
<div class="paragraph">
<p>The following features are considered experimental and can be disabled using the Security/User Management administration screen:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Guided Decision Tree Editor</p>
</li>
<li>
<p>Guided Score Card Editor</p>
</li>
<li>
<p>XLS Score Card Editor</p>
</li>
<li>
<p>(New) BPMN2 Process Editor</p>
</li>
<li>
<p>Deployments/Server Provisioning Perspective</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These features are enabled by default.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/disable-experimental-features1.png" alt="disable experimental features1">
</div>
<div class="title">Figure 410. Disabling an Editor</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.3.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.3.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.3.0.final">21.27. New and Noteworthy in KIE Workbench 7.3.0</a></h3>
<div class="sect3">
<h4 id="_new_home_and_menu_bar"><a class="anchor" href="#_new_home_and_menu_bar"></a><a class="link" href="#_new_home_and_menu_bar">21.27.1. New Home and Menu Bar</a></h4>
<div class="paragraph">
<p>The Home page, Menu bar and About popup now have a new design. Menu items are split into groups representing major functional areas.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Home/home-with-menu-expanded.png" alt="home with menu expanded">
</div>
<div class="title">Figure 411. Home view with Menu expanded</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Home/about-popup.png" alt="about popup">
</div>
<div class="title">Figure 412. About popup</div>
</div>
</div>
<div class="sect3">
<h4 id="_admin_page_changes"><a class="anchor" href="#_admin_page_changes"></a><a class="link" href="#_admin_page_changes">21.27.2. Admin page changes</a></h4>
<div class="paragraph">
<p>The Admin page is now accessible with the cog icon on the Menu bar and has more items. Access to the perspective artifacts, Data Sets, Data Sources and Language options have been moved there.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Home/admin-page-7-3-x.png" alt="admin page 7 3 x">
</div>
<div class="title">Figure 413. Admin page</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.1.0"><a class="anchor" href="#_drools.releasenotesdrools.7.1.0"></a><a class="link" href="#_drools.releasenotesdrools.7.1.0">21.28. New and Noteworthy in Drools 7.1</a></h3>

</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.1.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.1.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.1.0.final">21.29. New and Noteworthy in KIE Workbench 7.1.0</a></h3>
<div class="sect3">
<h4 id="_project_metrics_dashboard"><a class="anchor" href="#_project_metrics_dashboard"></a><a class="link" href="#_project_metrics_dashboard">21.29.1. Project Metrics Dashboard</a></h4>
<div class="paragraph">
<p>A brand new dashboard is now available for every project listed in the authoring library. After opening the project details page, a metrics card shows up on the right side of the screen.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/project-metrics-card.png" alt="project metrics card">
</div>
<div class="title">Figure 414. Project Metrics Card</div>
</div>
<div class="paragraph">
<p>The card shows the history of contributions (commits) made to that specific project over time.
Click the <em>View All</em> link to access the full dashboard that shows several metrics all about the project&#8217;s contributions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/project-metrics-dashboard.png" alt="project metrics dashboard">
</div>
<div class="title">Figure 415. Project Metrics Dashboard</div>
</div>
<div class="paragraph">
<p>Notice that different filter controls are available for selecting the contributions made either by a concrete user or in a specific time frame.</p>
</div>
</div>
<div class="sect3">
<h4 id="_teams_metrics_dashboard"><a class="anchor" href="#_teams_metrics_dashboard"></a><a class="link" href="#_teams_metrics_dashboard">21.29.2. Teams Metrics Dashboard</a></h4>
<div class="paragraph">
<p>A brand new dashboard has also been added to the Teams page. A metrics card on the right side shows the history of all contributions (commits).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/teams-metrics-card.png" alt="teams metrics card">
</div>
<div class="title">Figure 416. Teams Metrics Card</div>
</div>
<div class="paragraph">
<p>Click the <em>View All</em> link to access the full dashboard showing overall contributions metrics.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/teams-metrics-dashboard.png" alt="teams metrics dashboard">
</div>
<div class="title">Figure 417. Teams Metrics Dashboard</div>
</div>
<div class="paragraph">
<p>Note that different filter controls are available for selecting the contributions by different criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>by a concrete user,</p>
</li>
<li>
<p>within a specific time frame,</p>
</li>
<li>
<p>by team or,</p>
</li>
<li>
<p>by project.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This dashboard replaces the former <em>Authoring&gt;Contributors</em> dashboard, which is no longer available at the top menu bar of the workbench.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.0.0"><a class="anchor" href="#_drools.releasenotesdrools.7.0.0"></a><a class="link" href="#_drools.releasenotesdrools.7.0.0">21.30. New and Noteworthy in Drools 7.0</a></h3>
<div class="sect3">
<h4 id="_core_engine"><a class="anchor" href="#_core_engine"></a><a class="link" href="#_core_engine">21.30.1. Core Engine</a></h4>
<div class="sect4">
<h5 id="_dmn_runtime_support"><a class="anchor" href="#_dmn_runtime_support"></a><a class="link" href="#_dmn_runtime_support">21.30.1.1. DMN Runtime Support</a></h5>
<div class="paragraph">
<p>Drools now has complete runtime support for DMN (Decision Model and Notation). DMN files are now an asset
that can be added to any kjar for execution. Please refer to the <a href="#drools.DMN">DMN section</a>
for details on how to build and execute DMN models.</p>
</div>
<div class="paragraph">
<p>At this time, no DMN authoring is supported, but it will be supported in future versions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_multithreaded_evaluation_in_the_drools_engine"><a class="anchor" href="#_multithreaded_evaluation_in_the_drools_engine"></a><a class="link" href="#_multithreaded_evaluation_in_the_drools_engine">21.30.1.2. Multithreaded evaluation in the Drools engine</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental in Drools 7.0.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Drools 7.0, the Drools engine can now evaluate more business rules in parallel by dividing the RETE and PHREAK pattern-matching algorithms in independent partitions and evaluating them in parallel.</p>
</div>
<div class="paragraph">
<p>Multithreaded evaluation is disabled by default in Drools. To enable multithreaded evaluation for a parallel KIE base, use one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable multithreaded evaluation with <code>KieBaseConfiguration</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(MultithreadEvaluationOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the multithreaded evaluation system property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.multithreadEvaluation = true</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rules that use queries, salience, or agenda groups are currently not supported by the parallel Drools engine. If these rule elements are present in the KIE base, the compiler emits a warning and automatically switches back to single-threaded evaluation. However, in some cases, the Drools engine might not detect the unsupported rule elements and rules might be evaluated incorrectly. For example, the Drools engine might not detect when rules rely on implicit salience given by rule ordering inside the DRL file, resulting in incorrect evaluation due to the unsupported salience attribute.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_oopath_improvements"><a class="anchor" href="#_oopath_improvements"></a><a class="link" href="#_oopath_improvements">21.30.1.3. OOPath improvements</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>OOPath has been introduced with Drools 6.3.0 but in Drools 7.0.0 the syntax has been slightly changed to make it closer to standard
xpath one. This means that constraints have to be put between square brackets instead of curly ones and inline cast has to be
expressed out of constraints. For instance the following oopath expressed with 6.x syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/list{#SubClass, prop == 0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>in Drools 7.x becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/list#SubClass[prop == 0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also Drools 7.0.0 improves the support for standard Java Collection, with a dedicated implementation for <code>List</code> and <code>Set</code>,
as specialized <code>ReactiveList</code> and <code>ReactiveSet</code>; a <code>ReactiveCollection</code> is also available.
This also includes out of the box reactive support when performing mutable operations through their <code>Iterator</code> and <code>ListIterator</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School extends AbstractReactiveObject {
    private String name;
    private final List&lt;Child&gt; children = new ReactiveList&lt;Child&gt;(); <i class="conum" data-value="1"></i><b>(1)</b>

    public void setName(String name) {
        this.name = name;
        notifyModification(); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    public void addChild(Child child) {
        children.add(child); <i class="conum" data-value="3"></i><b>(3)</b>
        // no need to call notifyModification() here.
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using specialized <code>ReactiveList</code> for reactive support over standard Java <code>List</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Usually <code>notifyModification()</code> is required to be called when a field is changed for reactive support</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but in the case of <code>ReactiveList</code> this is handled automatically, like every other mutating operation performed over the field <code>children</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As a best-practice, it is recommended to declare reactive collection fields <code>final</code> as per the example shown.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_oopath_maven_plug_in"><a class="anchor" href="#_oopath_maven_plug_in"></a><a class="link" href="#_oopath_maven_plug_in">OOPath Maven plug-in</a></h6>
<div class="paragraph">
<p>The Kie Maven plug-in offers a new goal <code>injectreactive</code> to instrument bytecode and automatically inject reactivity support for standard cases.</p>
</div>
<div class="paragraph">
<p>The <code>injectreactive</code> goal is disabled by default, and can be enabled via Maven plug-in configuration <code>instrument-enabled</code> settings.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;groupId&gt;org.kie&lt;/groupId&gt;
&lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
&lt;extensions&gt;true&lt;/extensions&gt;
&lt;configuration&gt;
    &lt;instrument-enabled&gt;true&lt;/instrument-enabled&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable the <code>injectreactive</code> goal.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>injectreactive</code> goal will instrument bytecode pertaining to the Maven project build&#8217;s output directory <code>${project.build.outputDirectory}</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to limit the scope of the goal to a specific package or hierarchy of packages via Maven plug-in
configuration <code>instrument-packages</code> settings list.
.Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;groupId&gt;org.kie&lt;/groupId&gt;
&lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
&lt;extensions&gt;true&lt;/extensions&gt;
&lt;configuration&gt;
    &lt;instrument-enabled&gt;true&lt;/instrument-enabled&gt;
    &lt;instrument-packages&gt;
        &lt;instrumentPackage&gt;to.instrument&lt;/instrumentPackage&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;instrumentPackage&gt;org.drools.compiler.xpath.tobeinstrumented.*&lt;/instrumentPackage&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/instrument-packages&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Limit scope of instrumentation specifically to <code>to.instrument</code> package only.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Limit scope of instrumentation to <code>org.drools.compiler.xpath.tobeinstrumented</code> and its children packages.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The plug-in will instrument bytecode for every field assignment under the following standard cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a field assignment will also trigger <code>notifyModification()</code></p>
</li>
<li>
<p>wrap any field defined as List with a <code>ReactiveList</code></p>
</li>
<li>
<p>wrap any field defined as Set with a <code>ReactiveSet</code></p>
</li>
<li>
<p>wrap any field defined as Collection with a <code>ReactiveCollection</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order for a field of type List/Set to be wrapped correctly, the field member of the java class must be declared specifically using either
<code>java.util.Collection</code>, <code>java.util.List</code> or <code>java.util.Set</code>
(declaring for instance a field as <code>java.util.ArrayList</code> will not be instrumented with the specialized reactive collections).
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is not recommended to mix manual support for reactivity (implemented manually) and the bytecode instrumentation Maven plug-in; it is better envisaged to keep the two scopes distinct, for instance by making use of the plug-in configuration to instrument only specific packages as documented above.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following section present detailed examples of the plug-in instrumentation.</p>
</div>
<div class="sect6">
<h7 id="_instrumentation_of_field_assignments"><a class="anchor" href="#_instrumentation_of_field_assignments"></a><a class="link" href="#_instrumentation_of_field_assignments">Instrumentation of field assignments</a></h7>
<div class="paragraph">
<p>A field assignment like in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Original:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Toy {
    private String owner;
    ...

    public void setOwner(String owner) {
        this.owner = owner;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be instrumented by intercepting the field assignment and triggering the <code>notifyModification()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Result:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Toy implements ReactiveObject {
    private String owner;
    ...

    public void setOwner(final String owner) {
        this.$$_drools_write_owner(owner);
    }

    public void $$_drools_write_owner(final String owner) {
        this.owner = owner;
        ReactiveObjectUtil.notifyModification((ReactiveObject) this);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please notice this instrumentation applies only if the field is not a <code>Collection</code>.</p>
</div>
<div class="paragraph">
<p>In the case the field assignment is referring a <code>List</code> or a <code>Set</code>, the instrumentation will wrap the assignment with a <code>ReactiveList</code> or <code>`ReactiveSet</code> accordingly; for example:</p>
</div>
<div class="listingblock">
<div class="title">Original:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School {
    private final String name;
    private final List&lt;Child&gt; children = new ArrayList&lt;Child&gt;();
    ...

    public School(String name) {
        this.name = name;
    }

    public List&lt;Child&gt; getChildren() {
        return children;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be instrumented by intercepting and wrapping with <code>ReactiveList</code>:</p>
</div>
<div class="listingblock">
<div class="title">Result:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School implements ReactiveObject {
    private final String name;
    private final List&lt;Child&gt; children;

    public School(final String name) {
        this.$$_drools_write_children(new ArrayList());
        this.name = name;
    }

    public List&lt;Child&gt; getChildren() {
        return this.children;
    }

    public void $$_drools_write_children(final List list) {
        this.children = (List&lt;Child&gt;) new ReactiveList(list);
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pmml_support"><a class="anchor" href="#_pmml_support"></a><a class="link" href="#_pmml_support">21.30.1.4. PMML Support</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature makes use of <a href="#drl-rule-units-con">Rule Units</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Drools now support assets that conform to a subset of the Predictive Modeling Markup Language (PMML). The following
predictive model types are now supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Regression</p>
</li>
<li>
<p>Scorecard</p>
</li>
<li>
<p>Tree</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the Mining model type has partial support; with the following modes currently available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Model Chain</p>
</li>
<li>
<p>Select All</p>
</li>
<li>
<p>Select First</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further modes of operation will be supported as they become available.</p>
</div>
</div>
<div class="sect4">
<h5 id="_soft_expiration_for_events"><a class="anchor" href="#_soft_expiration_for_events"></a><a class="link" href="#_soft_expiration_for_events">21.30.1.5. Soft expiration for events</a></h5>
<div class="paragraph">
<p>When explicitly defining an event expiration in Drools 6.x, it is always considered a hard expiration, meaning that it always
takes precedence on any other expiration implicitly calculated on temporal windows and constraints where the event is involved.
Drools 7 also allows to specify a soft expiration for events that can be used if the inferred expiration offset is infinite.
In this way it is possible to have a guaranteed expiration that is either the inferred one or the specified one if the other
is missing. Moreover this implies that rule authors are not required to include a temporal constraint in all rules and then
event classes can be designed even if the rules are not yet known.</p>
</div>
<div class="paragraph">
<p>By default event expiration is considered to be hard, but it is possible to change the expiration policy and define a soft
expiration either annotating the event&#8217;s class as it follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Role(Role.Type.EVENT)
@Expires( value = "30s", policy = TIME_SOFT )
public class MyEvent { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or using a type declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare MyEvent
  @role( event )
  @expires(value = 30s, policy = TIME_SOFT)
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_units"><a class="anchor" href="#_rule_units"></a><a class="link" href="#_rule_units">21.30.1.6. Rule Units</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Rule units represent a purely declarative approach to partition a rules set into smaller units, binding different data sources
to those units and orchestrate the execution of the individual unit. A rule unit is an aggregate of data sources, global variables
and rules.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_business_central_2"><a class="anchor" href="#_business_central_2"></a><a class="link" href="#_business_central_2">21.30.2. Business Central</a></h4>
<div class="paragraph">
<p>Apart from the generic improvements to Business Central (listed below in a separate section), there are also some Drools-specific enhancements in Business Central.</p>
</div>
<div class="sect4">
<h5 id="_dmn_style_hit_policies_for_decision_tables"><a class="anchor" href="#_dmn_style_hit_policies_for_decision_tables"></a><a class="link" href="#_dmn_style_hit_policies_for_decision_tables">21.30.2.1. DMN style hit policies for Decision Tables</a></h5>
<div class="paragraph">
<p>With each Hit Policy, by default a row has priority over each row below it.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unique Hit
With unique hit policy each row has to be unique meaning there can be no overlap. There can never be a situation where two rows can fire, if there is the Verification feature warns about this on development time.</p>
</li>
<li>
<p>First Hit
First hit fires only one row, the one that is satisfied first from top to bottom.</p>
</li>
<li>
<p>Resolved Hit
Similar to First Hit, but you can for example give row 10 priority over row 5. This means you can keep the order of the rows you want for visual readability, but specify priority exceptions.</p>
</li>
<li>
<p>Rule Order
Multiple rows can fire and Verification does not report about conflicts between the rows since they are expected to happen.</p>
</li>
<li>
<p>None
This is the normal hit mode. Old decision tables will use this by default, but since 7.0 uses PHREAK the row order now matters. There is no migration tooling needed for the old tables. Multiple rows can fire. Verification warns about rows that conflict.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_guided_rule_editor_support_formulae_in_composite_field_constraints"><a class="anchor" href="#_guided_rule_editor_support_formulae_in_composite_field_constraints"></a><a class="link" href="#_guided_rule_editor_support_formulae_in_composite_field_constraints">21.30.2.2. Guided Rule Editor : Support formulae in composite field constraints</a></h5>
<div class="paragraph">
<p>Composite field constraints now support use of formulae.</p>
</div>
<div class="paragraph">
<p>When adding constraints to a Pattern the "Multiple Field Constraint" selection ("All of (and)" and "Any of (or)") supports use of formulae in addition to expressions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/composite-field-constraint-formulae1.png" alt="composite field constraint formulae1">
</div>
<div class="title">Figure 418. Composite field constraint - Select formula</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/composite-field-constraint-formulae2.png" alt="composite field constraint formulae2">
</div>
<div class="title">Figure 419. Composite field constraint - Formula editor</div>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_new_editor"><a class="anchor" href="#_guided_decision_table_editor_new_editor"></a><a class="link" href="#_guided_decision_table_editor_new_editor">21.30.2.3. Guided Decision Table Editor : New editor</a></h5>
<div class="paragraph">
<p>The Guided Decision Table Editor has been extensively rewritten to support editing of multiple tables in the same editor. Tables that share an association are visibly linked making it easier to visualise relationships. Associations are inferred from Actions that create or update a Fact consumed by the Conditions of another table.</p>
</div>
<div class="paragraph">
<p>Highlights include:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new look and feel</p>
</li>
<li>
<p>Resizable columns</p>
</li>
<li>
<p>Reordering of columns by dragging and dropping "in table"</p>
</li>
<li>
<p>Reordering of rows by dragging and dropping "in table"</p>
</li>
<li>
<p>Repositioning of tables with drag and drop</p>
</li>
<li>
<p>Panning of view to scroll content</p>
</li>
<li>
<p>Zoomable view, so you can zoom "out" to see more content at once</p>
</li>
<li>
<p>File locks and Version History per Decision Table</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtables-new-editor.png" alt="dtables new editor">
</div>
<div class="title">Figure 420. New editor</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtables-new-editor-multiple.png" alt="dtables new editor multiple">
</div>
<div class="title">Figure 421. New editor - multiple open tables</div>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_caching_of_enumeration_lookups"><a class="anchor" href="#_guided_decision_table_editor_caching_of_enumeration_lookups"></a><a class="link" href="#_guided_decision_table_editor_caching_of_enumeration_lookups">21.30.2.4. Guided Decision Table Editor : Caching of enumeration lookups</a></h5>
<div class="paragraph">
<p>The Guided Decision Table Editor has long been capable of using enumeration definitions. However since a table can contain many cells performance of enumerations could sometimes be less than ideal if the definition required a server round-trip to retrieve the lookups from a helper class.</p>
</div>
<div class="paragraph">
<p>Results from server round-trips are now cached in the client hence removing the need for successive network calls when cells are modified. The cache is initialised when the editor is opened and populated on demand.</p>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_verification_and_validation"><a class="anchor" href="#_guided_decision_table_editor_verification_and_validation"></a><a class="link" href="#_guided_decision_table_editor_verification_and_validation">21.30.2.5. Guided Decision Table Editor : Verification and Validation</a></h5>
<div class="sect5">
<h6 id="_system_property"><a class="anchor" href="#_system_property"></a><a class="link" href="#_system_property">System Property</a></h6>
<div class="paragraph">
<p>It is possible to disable the Verification &amp; Validation with the system property <strong><code></strong>org.kie.verification.disable-dtable-realtime-verification<strong></code></strong>. This can be useful for large decision tables or if the users want to ignore V&amp;V.</p>
</div>
</div>
<div class="sect5">
<h6 id="_range_checks"><a class="anchor" href="#_range_checks"></a><a class="link" href="#_range_checks">Range Checks</a></h6>
<div class="paragraph">
<p>The verification takes the first steps towards helping you to make complete decision tables. In the next release we add the support for checking if all the ranges are covered for boolean, numeric and date values. This means if your table has a check for if an Application is approved the verification report will remind you to make sure you also handle situations where the Application was not approved.</p>
</div>
</div>
<div class="sect5">
<h6 id="_unique_single_hit"><a class="anchor" href="#_unique_single_hit"></a><a class="link" href="#_unique_single_hit">Unique Single Hit</a></h6>
<div class="paragraph">
<p>In the past verification and validation has raised an issue if rows subsume each other. If a row subsumes another, then the conditions can be satisfied with the same set of facts. Meaning two rows from the same table can fire at the same time. In some cases subsumption does not matter, but in other cases you want to have a table where only one rule fires at the time. The table is then a single hit decision table. To help the making of single hit tables where only one row can fire, the verification keeps an eye on the conditions. Reporting situations when single hit is broken.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_breaking_changes_in_drools_7_0_from_6_x"><a class="anchor" href="#_breaking_changes_in_drools_7_0_from_6_x"></a><a class="link" href="#_breaking_changes_in_drools_7_0_from_6_x">21.31. Breaking changes in Drools 7.0 from 6.x</a></h3>
<div class="sect3">
<h4 id="_property_reactivity_enabled_by_default"><a class="anchor" href="#_property_reactivity_enabled_by_default"></a><a class="link" href="#_property_reactivity_enabled_by_default">21.31.1. Property reactivity enabled by default</a></h4>
<div class="paragraph">
<p>Property reactivity has been introduced in Drools 5.4 but users had to explicitly enable it on a class by class basis through
the <code>@PropertyReactive</code> annotation or on the whole KIE base using the <code>PropertySpecificOption.ALWAYS</code> builder option.
However, since using this feature is considered a good practice both under correctness and performance points of view, it has
been enabled by default in Drools 7.0. If required it is possible to disable property reactivity and reconfigure Drools 7.0
to work exactly as it did in version 6.x by adding the following configuration to the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;configuration&gt;
  &lt;property key="drools.propertySpecific" value="ALLOWED"/&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_type_preserving_accumulate_functions"><a class="anchor" href="#_type_preserving_accumulate_functions"></a><a class="link" href="#_type_preserving_accumulate_functions">21.31.2. Type preserving accumulate functions</a></h4>
<div class="paragraph">
<p>In Drools 6 when using the <code>sum</code> function inside an accumulate pattern the result was always a Double regardless of the
field type on which the sum was performed. This caused the following 3 problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Loss of precision: the sum of a long <code>1881617265586265321L</code> will incorrectly return <code>1.88161726558626534E18</code>.
The BigDecimal sum of <code>0.09</code> and <code>0.01</code> will also be incorrect.</p>
</li>
<li>
<p>Loss of performance: summing with a Double total is significantly slower than summing with a Long or an Integer.</p>
</li>
<li>
<p>Leaked complexity: it enforced the user to pattern matching on Double, or more generically (suggested choice) on Number,
while it may be expected that the result of summing on a field of type Integer would be an Integer as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Conversely Drools 7 preserves the type of the expression on which the sum is executed, so it will be possible to directly
match on that type as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Long(...) from accumulate(..., sum($p.getLongWeight()))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_renaming_timedruleexecutionoption"><a class="anchor" href="#_renaming_timedruleexecutionoption"></a><a class="link" href="#_renaming_timedruleexecutionoption">21.31.3. Renaming TimedRuleExecutionOption</a></h4>
<div class="paragraph">
<p>The KieSession option to control when timed rules have to be automatically executed has been renamed into <code>TimedRuleExecutionOption</code> fixing a typing mistake in its name which affected previous releases; the property has been aligned into <code>drools.timedRuleExecution</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 103. Name changes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">previous releases</th>
<th class="tableblock halign-left valign-top">version <code>7.0.0.Final</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieSession option</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimedRuleExectionOption</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimedRuleExecutionOption</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drools.timedRuleExection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drools.timedRuleExecution</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_renaming_and_unification_of_configuration_files"><a class="anchor" href="#_renaming_and_unification_of_configuration_files"></a><a class="link" href="#_renaming_and_unification_of_configuration_files">21.31.4. Renaming and unification of configuration files</a></h4>
<div class="paragraph">
<p>In Drools 6.x, the default Drools configuration properties were configured in two distinct files:
*  <code>drools.default.rulebase.conf</code> located in the META-INF folder of drools-core
*  <code>drools.default.packagebuilder.conf</code> located in the META-INF folder of of drools-compiler</p>
</div>
<div class="paragraph">
<p>In Drools 7.0.0, these files are unified into a single one named <code>kie.default.properties.conf</code>, located in the META-INF folder of drools-core.
If you want to override the default values of these properties or add your own, you can put them in a file called <code>kie.properties.conf</code> located in the META-INF folder of your project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.0.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.0.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.0.0.final">21.32. New and Noteworthy in KIE Workbench 7.0.0</a></h3>
<div class="paragraph">
<p>The workbench has been updated to support Wildfly 10 and EAP7.  Minimum Java requirement is JDK8.</p>
</div>
<div class="sect3">
<h4 id="_new_authoring_library"><a class="anchor" href="#_new_authoring_library"></a><a class="link" href="#_new_authoring_library">21.32.1. New Authoring (Library)</a></h4>
<div class="paragraph">
<p>Authoring now has a new design, with a better information organization. It&#8217;s now possible to manage (create, delete and edit) Teams (Organizational Units), list Projects in a Repository and the Assets in a Project. When an Asset is selected, you can see the Asset Editor and the Project Explorer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Library uses the indexing of the Workbench. It is, therefore, <strong>imperative</strong> that existing index information is deleted so that the Workbench can rebuild them with the necessary information. Index information is stored in the <code>.index</code> folder within your application servers <code>\bin</code> folder (or as you may have configured otherwise with the <code>org.uberfire.metadata.index.dir</code> System Property).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-teams-view.png" alt="library teams view">
</div>
<div class="title">Figure 422. Teams view</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-team-creation.png" alt="library team creation">
</div>
<div class="title">Figure 423. Teams creation</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-empty-library.png" alt="library empty library">
</div>
<div class="title">Figure 424. Empty Repository</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-projects-list.png" alt="library projects list">
</div>
<div class="title">Figure 425. Repository with Projects</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-empty-project.png" alt="library empty project">
</div>
<div class="title">Figure 426. Empty Project</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-assets-list.png" alt="library assets list">
</div>
<div class="title">Figure 427. Project with Assets</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-asset-view.png" alt="library asset view">
</div>
<div class="title">Figure 428. Asset View</div>
</div>
<div class="paragraph">
<p>Also, you can set some preferences about your default workspace by accessing Home &gt; Admin &gt; Library.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-preferences.png" alt="library preferences">
</div>
<div class="title">Figure 429. Library Preferences</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_imports_of_examples"><a class="anchor" href="#_authoring_imports_of_examples"></a><a class="link" href="#_authoring_imports_of_examples">21.32.2. Authoring - Imports of Examples</a></h4>
<div class="paragraph">
<p>Prior to 7.x the Workbench used to install pre-defined examples at startup.</p>
</div>
<div class="paragraph">
<p>Version 7.x brings the ability to import examples from git repositories.
The Authoring Perspective contains a menu item for 'Examples' clicking this launches a Wizard to guide you through the import.</p>
</div>
<div class="exampleblock">
<div class="title">Example 109. Menu item</div>
<div class="content">
<div class="paragraph">
<p>The Authoring Perspective contains a menu item for 'Examples'.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard1.png" alt="examples wizard1">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 110. Wizard - Enter source Repository</div>
<div class="content">
<div class="paragraph">
<p>Page 1 of the Wizard allows the User to select a pre-defined examples repository, or enter their own URL.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard2.png" alt="examples wizard2">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 111. Wizard - Select Project(s)</div>
<div class="content">
<div class="paragraph">
<p>Page 2 of the Wizard lists Projects available in the source repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard3.png" alt="examples wizard3">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 112. Wizard - Enter target Repository</div>
<div class="content">
<div class="paragraph">
<p>Page 3 of the Wizard allows the User to enter a target Repository name and associate it with an Organizational Unit.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard4.png" alt="examples wizard4">
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_pop_ups_improvements"><a class="anchor" href="#_authoring_pop_ups_improvements"></a><a class="link" href="#_authoring_pop_ups_improvements">21.32.3. Authoring - Pop-ups improvements</a></h4>
<div class="paragraph">
<p>All system pop-ups had their UX improved.</p>
</div>
<div class="paragraph">
<p>The "comment" field is hidden by default.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/popups-comment-field.png" alt="popups comment field">
</div>
</div>
<div class="paragraph">
<p>Now, the destination package can be selected when a project file is copied from any package.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/popups-package-field.png" alt="popups package field">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_project_editor_reimport_button"><a class="anchor" href="#_authoring_project_editor_reimport_button"></a><a class="link" href="#_authoring_project_editor_reimport_button">21.32.4. Authoring - Project Editor - Reimport button</a></h4>
<div class="paragraph">
<p>The "Reimport" button invalidates all cached dependencies, in order to handle scenarios where a specific dependency was updated without having its version modified.</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_management"><a class="anchor" href="#_security_management"></a><a class="link" href="#_security_management">21.32.5. Security Management</a></h4>
<div class="paragraph">
<p>The User and Group management perspectives released in version 6.4 have been unified into a single perspective which delivers a shared view for managing both users and groups as well as the permissions granted to any of the application roles.</p>
</div>
<div class="paragraph">
<p>This very new perspective is placed under the <em>Home</em> section in the top menu bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementMenuEntry.png" alt="SecurityManagementMenuEntry">
</div>
<div class="title">Figure 430. Link to the Security Management perspective</div>
</div>
<div class="paragraph">
<p>The next screenshot shows how this new perspective looks:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementHome.png" alt="SecurityManagementHome">
</div>
<div class="title">Figure 431. Security Management Home</div>
</div>
<div class="paragraph">
<p>A tabbed pane is shown on the left, allowing the User to select the <em>Roles</em>, <em>Groups</em> or <em>Users</em> tab. After clicking on a Role (or Group)
a detailed screen is displayed allowing the user to configure some security settings.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRoleView.png" alt="SecurityManagementRoleView">
</div>
<div class="title">Figure 432. Role security settings</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Home Perspective</strong>: The target perspective where the user is directed after login, which makes it possible to have different home pages per role/group.</p>
</li>
<li>
<p><strong>Priority</strong>: Used to determine what settings (home perspective, permissions, &#8230;&#8203;) have precedence for those users with more than one role or group assigned.</p>
</li>
<li>
<p><strong>Permissions</strong>: A full ACL (<em>Access Control List</em>) editor for grant/deny permissions over the different resources available in the platform like <em>Perspectives</em>,
<em>Organizational Units</em>, <em>Repositories</em> or <em>Projects</em>. Global permissions on top of any of those resource types can be ovewritten by means of adding individual exceptions
which makes it possible to implement both the <em>grant all deny a few</em> or the <em>deny all grant a few</em> strategies.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_kie_config_cli_has_been_removed"><a class="anchor" href="#_kie_config_cli_has_been_removed"></a><a class="link" href="#_kie_config_cli_has_been_removed">21.32.6. kie-config-cli has been removed</a></h4>
<div class="paragraph">
<p>The command-line tool <code>kie-config-cli.[sh/bat]</code> for managing remote repositories that was present in 6.x has been removed for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The security-related operations it provided (<code>add-role-repo</code>, <code>remove-role-repo</code>, <code>add-role-org-unit</code>, <code>remove-role-org-unit</code>, <code>add-role-project</code>, <code>remove-role-project</code>) have been replaced by more comprehensive <a href="#_wb.userandgroupmgmt">Security management</a> feature.</p>
</li>
<li>
<p>The operations related to managing deployments (<code>list-deployment</code>, <code>add-deployment</code>, <code>remove-deployment</code>) no longer make sense, since jBPM Runtime has been removed from workbench. Deployments can still be managed programmatically using <a href="#kie-server-rest-api-con_kie-apis">Kie Server REST API</a>.</p>
</li>
<li>
<p>The remaining operations (<code>create-org-unit</code>, <code>remove-org-unit</code>, <code>list-org-units</code>, <code>create-repo</code>, <code>remove-repo</code>, <code>list-repo</code>, <code>add-repo-org-unit</code>, <code>remove-repo-org-unit</code>, <code>list-project-details</code>) are available as a part of <a href="#knowledge-store-rest-api-con_kie-apis">Knowledge Store REST API</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_user_and_project_admin_pages_and_preferences"><a class="anchor" href="#_user_and_project_admin_pages_and_preferences"></a><a class="link" href="#_user_and_project_admin_pages_and_preferences">21.32.7. User and Project Admin Pages and Preferences</a></h4>
<div class="paragraph">
<p>The workbench now has a new menu item: "Admin". In there, you can find some admin tools, like "Users", "Groups" and "Roles" management, and also general preferences. When a preference is changed there, it will affect all places that depend on it, but only for the logged user.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-user-access.png" alt="admin page user access">
</div>
<div class="title">Figure 433. User admin page access</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-user.png" alt="admin page user">
</div>
<div class="title">Figure 434. User admin page, that contains user level tools and preferences</div>
</div>
<div class="paragraph">
<p>Each project also has its own admin page, with admin tools and preferences. When a preference is changed there, it will affect only that project, and only for the logged user.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-project-access.png" alt="admin page project access">
</div>
<div class="title">Figure 435. Project admin page access</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-project.png" alt="admin page project">
</div>
<div class="title">Figure 436. Project admin page, that contains project level tools and preferences</div>
</div>
</div>
<div class="sect3">
<h4 id="_gav_conflict_check_and_child_gav_edition"><a class="anchor" href="#_gav_conflict_check_and_child_gav_edition"></a><a class="link" href="#_gav_conflict_check_and_child_gav_edition">21.32.8. GAV conflict check and child GAV edition</a></h4>
<div class="paragraph">
<p>It is now possible, for each user, to set the GAV conflict check flag, and also allow or block child GAV edition for all their projects, or specifically for each project.</p>
</div>
<div class="paragraph">
<p>The configuration can be found inside the admin tool "Project", in case the access is made through the "Admin" menu item. It can also be found by entering the admin tool "General", on the Project admin page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/gav-preferences.png" alt="gav preferences">
</div>
<div class="title">Figure 437. Group Artifact Version (GAV) preferences</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_source_management"><a class="anchor" href="#_data_source_management"></a><a class="link" href="#_data_source_management">21.32.9. Data Source Management</a></h4>
<div class="paragraph">
<p>The new data source management system empowers the workbench with the ability of defining data sources and drivers for accessing external databases.</p>
</div>
<div class="paragraph">
<p>Some of the included functionalities are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new perspective for managing the data sources:</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceManagementPerspective.png" alt="DataSourceManagementPerspective">
</div>
<div class="title">Figure 438. Data Source Authoring Perspective</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A new wizard for guiding the data source creation.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDataSourceWizard.png" alt="NewDataSourceWizard">
</div>
<div class="title">Figure 439. New Data Source Wizard</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A new wizard for guiding the drivers creation.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDriverWizard.png" alt="NewDriverWizard">
</div>
<div class="title">Figure 440. New Driver Wizard</div>
</div>
<div class="paragraph">
<p>And the ability of browsing the database information for the databases pointed to by the data sources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Available schemas browsing</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser1.png" alt="DataSourceContentBrowser1">
</div>
<div class="title">Figure 441. Database schemas</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Available tables browsing</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser2.png" alt="DataSourceContentBrowser2">
</div>
<div class="title">Figure 442. Schema tables</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Table content browsing</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser3.png" alt="DataSourceContentBrowser3">
</div>
<div class="title">Figure 443. Table information</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kieserver.releasenoteskie.7.0.0"><a class="anchor" href="#_kieserver.releasenoteskie.7.0.0"></a><a class="link" href="#_kieserver.releasenoteskie.7.0.0">21.33. Breaking changes in Kie Server 7.0 from 6.x</a></h3>
<div class="sect3">
<h4 id="_serviceresponse_xstream_marshalling_changes"><a class="anchor" href="#_serviceresponse_xstream_marshalling_changes"></a><a class="link" href="#_serviceresponse_xstream_marshalling_changes">21.33.1. ServiceResponse XStream marshalling changes</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This release note applies only when directly interfacing with the Kie Server (kie-server) API, not when using the Kie Server Java Client (kie-server-client) API.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In an effort to be more consistent with JAXB marshalling, XStream marshalling has undergone the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The XML ServiceResponse element&#8217;s <code>response</code> object no longer renders with the canonical name.</p>
</li>
<li>
<p>XStream now uses <code>type</code> and <code>msg</code> as attributes, not child elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://issues.jboss.org/browse/DROOLS-1509">DROOLS-1509</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simplified_planner_rest_api"><a class="anchor" href="#_simplified_planner_rest_api"></a><a class="link" href="#_simplified_planner_rest_api">21.33.2. Simplified Planner REST API</a></h4>
<div class="sect4">
<h5 id="_serviceresponse_wrapper_removal"><a class="anchor" href="#_serviceresponse_wrapper_removal"></a><a class="link" href="#_serviceresponse_wrapper_removal">21.33.2.1. ServiceResponse wrapper removal</a></h5>
<div class="paragraph">
<p><code>ServiceResponse</code> wrapper has been removed from Planner service responses returned by KIE Server.
This allows an easier processing of the responses on the client side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;solver-instance&gt;
    ...
    &lt;status&gt;SOLVING&lt;/status&gt;
    &lt;score scoreClass="org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore"&gt;0hard/-10soft&lt;/score&gt;
    &lt;best-solution class="curriculumcourse.curriculumcourse.CourseSchedule"&gt;
        ...
    &lt;/best-solution&gt;
&lt;/solver-instance&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_new_planner_api_overview"><a class="anchor" href="#_new_planner_api_overview"></a><a class="link" href="#_new_planner_api_overview">21.33.2.2. New Planner API overview</a></h5>
<div class="paragraph">
<p>Register a solver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PUT <a href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Submit a solution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POST <a href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/solving" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/solving</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Get the best solution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET <a href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/bestsolution" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/bestsolution</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Terminate a solver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POST <a href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/terminating-early" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/terminating-early</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dispose a solver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DELETE <a href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.5.0"><a class="anchor" href="#_drools.releasenotesdrools.6.5.0"></a><a class="link" href="#_drools.releasenotesdrools.6.5.0">21.34. New and Noteworthy in Drools 6.5.0</a></h3>
<div class="sect3">
<h4 id="_configurable_threadfactory"><a class="anchor" href="#_configurable_threadfactory"></a><a class="link" href="#_configurable_threadfactory">21.34.1. Configurable ThreadFactory</a></h4>
<div class="paragraph">
<p>Some runtime environments (like for example Google App Engine) don&#8217;t allow to directly create new Threads.
For this reason it is now possible to plug your own ThreadFactory implementation by setting the system property <strong>drools.threadFactory</strong> with its class name.
For instance if you implemented your Google App Engine compatible ThreadFactory with the class <code>com.user.project.GoogleAppEngineThreadFactory</code> you can make Drools to use it by setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.threadFactory = com.user.project.GoogleAppEngineThreadFactory</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_of_any_expressions_as_input_for_a_query"><a class="anchor" href="#_use_of_any_expressions_as_input_for_a_query"></a><a class="link" href="#_use_of_any_expressions_as_input_for_a_query">21.34.2. Use of any expressions as input for a query</a></h4>
<div class="paragraph">
<p>It is now possible to use as input argument for a query both the field of a fact as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query contains(String $s, String $c)
    $s := String( this.contains( $c ) )
end

rule PersonNamesWithA when
    $p : Person()
    contains( $p.name, "a"; )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>and more in general any kind of valid expression like in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query checkLength(String $s, int $l)
    $s := String( length == $l )
end

rule CheckPersonNameLength when
    $i : Integer()
    $p : Person()
    checkLength( $p.name, 1 + $i + $p.age; )
then
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_with_modified_properties"><a class="anchor" href="#_update_with_modified_properties"></a><a class="link" href="#_update_with_modified_properties">21.34.3. Update with modified properties</a></h4>
<div class="paragraph">
<p>Property reactivity has been introduced to avoid unwanted and useless (re)evaluations and allow the Drools engine to react only to
modification of properties actually constrained or bound inside of a given pattern. However this feature is automatically available
only for modifications performed inside the consequence of a rule. Conversely a programmatic update is unaware of the object&#8217;s
properties that have been changed, so it is unable of using this feature.</p>
</div>
<div class="paragraph">
<p>To overcome this limitation it is now possible to optionally specify in an update statement the names of the properties that
have been changed in the modified object as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person me = new Person("me", 40);
FactHandle meHandle = ksession.insert( me );

me.setAge(41);
me.setAddress("California Avenue");
ksession.update( meHandle, me, "age", "address" );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_framework_improvements"><a class="anchor" href="#_monitoring_framework_improvements"></a><a class="link" href="#_monitoring_framework_improvements">21.34.4. Monitoring framework improvements</a></h4>
<div class="paragraph">
<p>A new type of MBean has been introduced in order to provide monitoring of the KieContainers, and the JMX MBeans hierarchical structure have been revisited to reflect the relationship with the related MBeans of the KieBases.
The JMX objectnaming has been normalized to reflect the terminology used in the Kie API.
A new type of MBean has been introduced in order to provide monitoring for Stateless KieSession, which was not available in previous releases.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 104. JMX objectname changes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MBean</th>
<th class="tableblock halign-left valign-top">before <code>6.5.x</code></th>
<th class="tableblock halign-left valign-top">from <code>6.5.0.Final</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieContainer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieBase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.kbases:type=<em>{kbaseId}</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieSession (stateful)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.kbases:type=<em>{kbaseId}</em>,group=Sessions,sessionId=<em>{ksessionId}</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em>,ksessionType=Stateful,ksessionName=<em>{ksessionName}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stateless KieSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em>,ksessionType=Stateless,ksessionName=<em>{ksessionName}</em></code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The KieSession MBeans consolidate the statistics data for all sessions instantiated under the same name.</p>
</div>
<div class="paragraph">
<p>KieSession created via <code>JPAKnowledgeService</code>, will be monitored under a KieSession MBean having constant <code>{ksessionName}</code> valorized to <code>persistent</code>; this MBean is not managed by the KieContainer directly, hence it requires to be manually deregistered from JMX, when monitoring is no longer needed.</p>
</div>
<div class="paragraph">
<p>The new JMX objectnaming scheme now enforces proper JMX quoting for IDs, e.g.: <code>org.kie:kcontainerId="2cb55f40-f220-432a-aba8-7940c18bf108",kbaseId="KBase1"</code></p>
</div>
<div class="paragraph">
<p>The old DroolsManagementAgent (which was registered on JMX under <code>org.drools:type=DroolsManagementAgent</code>) is no longer necessary, hence no longer registered on JMX.</p>
</div>
<div class="paragraph">
<p>The KieSession MBeans now have proper JMX <code>CompositeData</code> and <code>TabularData</code> support, where applicable. The KieSession MBeans continue to support all process-related aggregated statistics monitoring, but no longer display start/end dates for each process instances: auditing and logging support is available in jBPM for this scope.</p>
</div>
<div class="paragraph">
<p>The Drools RHQ/JON plug-in have been changed to reflect all the above mentioned changes, in addition to specific bug-fixing aiming to display hierarchical nesting correctly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.4.0"><a class="anchor" href="#_drools.releasenotesdrools.6.4.0"></a><a class="link" href="#_drools.releasenotesdrools.6.4.0">21.35. New and Noteworthy in Drools 6.4.0</a></h3>
<div class="sect3">
<h4 id="_better_java_8_compatibility"><a class="anchor" href="#_better_java_8_compatibility"></a><a class="link" href="#_better_java_8_compatibility">21.35.1. Better Java 8 compatibility</a></h4>
<div class="paragraph">
<p>It is now possible to use Java 8 syntax (lambdas and method references) in the Right Hand Side (then) part of a rule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_robust_incremental_compilation"><a class="anchor" href="#_more_robust_incremental_compilation"></a><a class="link" href="#_more_robust_incremental_compilation">21.35.2. More robust incremental compilation</a></h4>
<div class="paragraph">
<p>The incremental compilation (dynamic rule-base update) had some relevant flaws when one or more rules with a subnetwork (rules with complex existential patterns) were involved, especially when the same subnetwork was shared among different rules.
This issue required a partial rewriting of the existing incremental compilation algorithm, followed by a complete audit that has also been validated by brand new test suite made by more than 20,000 test cases only in this area.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improved_multi_threading_behaviour"><a class="anchor" href="#_improved_multi_threading_behaviour"></a><a class="link" href="#_improved_multi_threading_behaviour">21.35.3. Improved multi-threading behaviour</a></h4>
<div class="paragraph">
<p>Engine&#8217;s code dealing with multi-threading has been partially rewritten in order to remove a large number of synchronisation points and improve stability and predictability.
In particular this new implementation allows a clearer separation and better interaction between the User thread (performing the insert/update/delete actions on the session), the Drools engine thread (doing the proper rules evaluation) and the Timer one (performing time-based actions like events expiration).</p>
</div>
<div class="paragraph">
<p>This improvement has been made possible by the new phreak algorithm introduced with Drools 6.
In fact with in the ReteOO algorithm the network evaluation is performed during the User insert/update/delete action, meaning that each user action locks the entire engine.
Conversely with phreak the insert/update/delete is separated and the network evaluation happens when fireAllRules or fireUntilHalt is called.</p>
</div>
<div class="paragraph">
<p>More in detail this improvement has been made by 2 parts.
First of all a new thread-safe queue has been added to store all user actions as commands.
This queue is populated by the User thread while its entries are flushed and processed by the Drools engine thread during the rules evaluations phase.
The second part introduced a state machine coordinating the User, Timer and Engine threads and then providing a clearer and self-documenting way to model their interactions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oopath_improvements_2"><a class="anchor" href="#_oopath_improvements_2"></a><a class="link" href="#_oopath_improvements_2">21.35.4. OOPath improvements</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>OOPath has been introduced with Drools 6.3.0.
In Drools 6.4.0 it has been enhanced to support the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A constraint can also have a beckreference to an object of the graph traversed before the currently iterated one. For example the following OOPath:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams/grades{ result &gt; ../averageResult } )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will match only the grades having a result above the average for the passed exam.</p>
</div>
</li>
<li>
<p>A constraint can also recursively be another OOPath as it follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $exam: /plan/exams{ /grades{ result &gt; 20 } } )</code></pre>
</div>
</div>
</li>
<li>
<p>It is also possible to use the <code>?/</code> separator instead of the <code>/</code> one. As in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams{ course == "Big Data" }?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>By doing so the Drools engine will react to a change made to an exam, or if an exam is added to the plan, but not if a new grade is added to an existing exam.
Of course if a OOPath chunk is not reactive, all remaining part of the OOPath from there till the end of the expression will be non-reactive as well.
For instance the following OOPath</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: ?/plan/exams{ course == "Big Data" }/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be completely non-reactive.
For this reason it is not allowed to use the <code>?/</code> separator more than once in the same OOPath so an expression like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan?/exams{ course == "Big Data" }?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will cause a compile time error.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.4.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.4.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.6.4.0.final">21.36. New and Noteworthy in KIE Workbench 6.4.0</a></h3>
<div class="sect3">
<h4 id="_new_look_and_feel"><a class="anchor" href="#_new_look_and_feel"></a><a class="link" href="#_new_look_and_feel">21.36.1. New look and feel</a></h4>
<div class="paragraph">
<p>The general look and feel in the entire workbench has been updated to adopt <a href="https://www.patternfly.org/">PatternFly</a>.
The update brings a cleaner, lightweight and more consistent user experience throughout every screen.
Allowing users focus on the data and the tasks by removing all uncessary visual elements.
Interactions and behaviors remain mostly unchanged, limiting the scope of this change to visual updates.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewLookAndFeel.png" alt="NewLookAndFeel">
</div>
<div class="title">Figure 444. Workbench - New look and feel</div>
</div>
</div>
<div class="sect3">
<h4 id="_various_ui_improvements"><a class="anchor" href="#_various_ui_improvements"></a><a class="link" href="#_various_ui_improvements">21.36.2. Various UI improvements</a></h4>
<div class="paragraph">
<p>In addition to the PatternFly update described above which targeted the general look and feel, many  individual components in the workbench have been improved to create a better user experience.
This involved  making sure the default size of modal popup windows is appropriate to fit the corresponding content, adjusting the size of text fields as well as aligning labels, and improving the resize behaviour of various components  when used on smaller screens.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ModalPostPatternFly.png" alt="ModalPostPatternFly">
</div>
<div class="title">Figure 445. Workbench - Properly sized popup window</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/LabelFieldAlignmentPostPatternFly.png" alt="LabelFieldAlignmentPostPatternFly">
</div>
<div class="title">Figure 446. Workbench - Properly sized text fields and aligned labels</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/HorizonalAlignmentPostPatternFly.png" alt="HorizonalAlignmentPostPatternFly">
</div>
<div class="title">Figure 447. Workbench - Resized editor window with limited horizontal space</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_locales"><a class="anchor" href="#_new_locales"></a><a class="link" href="#_new_locales">21.36.3. New locales</a></h4>
<div class="paragraph">
<p>Locales <code>ru</code> (Russian) and <code>zh_TW</code> (Chineses Traditional) have now been added.</p>
</div>
<div class="paragraph">
<p>The locales now supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default English.</p>
</li>
<li>
<p><code>es</code> (Spanish)</p>
</li>
<li>
<p><code>fr</code> (French)</p>
</li>
<li>
<p><code>de</code> (German)</p>
</li>
<li>
<p><code>ja</code> (Japanese)</p>
</li>
<li>
<p><code>pt_BR</code> (Portuguese - Brazil)</p>
</li>
<li>
<p><code>zh_CN</code> (Chinese - Simplified)</p>
</li>
<li>
<p><code>zh_TW</code> (Chinese - Traditional)</p>
</li>
<li>
<p><code>ru</code> (Russian)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_imports_consistent_terminology"><a class="anchor" href="#_authoring_imports_consistent_terminology"></a><a class="link" href="#_authoring_imports_consistent_terminology">21.36.4. Authoring - Imports - Consistent terminology</a></h4>
<div class="paragraph">
<p>The Workbench used to have a section in the Project Editor for "Import Suggestions" which was really a way for Users to register classes provided by the Java Runtime environment to be available to Rule authoring.
Furthermore Editors had a "Config" tab which was where Users were expected to import classes from other packages to that in which the rule is located.</p>
</div>
<div class="paragraph">
<p>Neither term was clear and both were inconsistent with each other and other aspects of the Workbench.</p>
</div>
<div class="paragraph">
<p>We have changed these terms to (hopefully) be clearer in their meaning and to be consistent with the "Data Object" term used in relation to authoring Java classes within the Workbench.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ExternalDataObjects1.png" alt="ExternalDataObjects1">
</div>
<div class="title">Figure 448. Project Editor - External Data Objects</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ExternalDataObjects2.png" alt="ExternalDataObjects2">
</div>
<div class="title">Figure 449. Project Editor - Defining External Data Objects</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataObjects1.png" alt="DataObjects1">
</div>
<div class="title">Figure 450. Asset Editors - Data Objects</div>
</div>
<div class="paragraph">
<p>The Data Object screen lists all Data Objects in the same package as the asset and allows other Data Objects from other packages to be imported.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataObjects2.png" alt="DataObjects2">
</div>
<div class="title">Figure 451. Asset Editors - Defining Data Objects available for authoring</div>
</div>
</div>
<div class="sect3">
<h4 id="_disable_automatic_build"><a class="anchor" href="#_disable_automatic_build"></a><a class="link" href="#_disable_automatic_build">21.36.5. Disable automatic build</a></h4>
<div class="paragraph">
<p>When navigating Projects with the Project Explorer the workbench automatically builds the selected project, displaying build messages in the  Message Console.
Whilst this is beneficial it can have a detrimental impact on performance of the workbench when authoring large projects.
The  automatic build can now be disabled with the <code>org.kie.build.disable-project-explorer</code> System Property.
Set the value  to <code>true</code> to disable.
The default value is <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_scp_style_git_repository_urls"><a class="anchor" href="#_support_for_scp_style_git_repository_urls"></a><a class="link" href="#_support_for_scp_style_git_repository_urls">21.36.6. Support for <code>SCP</code> style <code>git</code> Repository URLs</a></h4>
<div class="paragraph">
<p>When cloning <code>git</code> Repositories it is now possible to use <code>SCP</code> style URLS, for example <code>git@github.com:user/repository.git</code>.
If your Operating System&#8217;s public keystore is password protected the passphrase can be provided with the <code>org.uberfire.nio.git.ssh.passphrase</code> System Property.</p>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_duplicate_gav_detection"><a class="anchor" href="#_authoring_duplicate_gav_detection"></a><a class="link" href="#_authoring_duplicate_gav_detection">21.36.7. Authoring - Duplicate GAV detection</a></h4>
<div class="paragraph">
<p>When performing any of the following operations a check is now made against all Maven Repositories, resolved for the Project,  for whether the Project&#8217;s GroupId, ArtifactId and Version pre-exist.
If a clash is found the operation is prevented; although this can be overridden by Users with the <code>admin</code> role.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The feature can be disabled by setting the System Property <code>org.guvnor.project.gav.check.disabled</code> to <code>true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resolved repositories are those discovered in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Project&#8217;s <code>POM</code> <code>&lt;repositories&gt;</code> section (or any parent <code>POM</code>).</p>
</li>
<li>
<p>The Project&#8217;s <code>POM</code> <code>&lt;distributionManagement&gt;</code> section.</p>
</li>
<li>
<p>Maven&#8217;s global <code>settings.xml</code> configuration file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Affected operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation of new Managed Repositories.</p>
</li>
<li>
<p>Saving a Project definition with the Project Editor.</p>
</li>
<li>
<p>Adding new Modules to a Managed Multi-Module Repository.</p>
</li>
<li>
<p>Saving the <code>pom.xml</code> file.</p>
</li>
<li>
<p>Build &amp; installing a Project with the Project Editor.</p>
</li>
<li>
<p>Build &amp; deploying a Project with the Project Editor.</p>
</li>
<li>
<p>Asset Management operations building, installing or deploying Projects.</p>
</li>
<li>
<p><code>REST</code> operations creating, installing or deploying Projects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users with the <code>Admin</code> role can override the list of Repositories checked using the "Repositories" settings in the Project Editor.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories1.png" alt="MavenRepositories1">
</div>
<div class="title">Figure 452. Project Editor - Viewing resolved Repositories</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories2.png" alt="MavenRepositories2">
</div>
<div class="title">Figure 453. Project Editor - The list of resolved Repositories</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories3.png" alt="MavenRepositories3">
</div>
<div class="title">Figure 454. Duplicate GAV detected</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_execution_server_management_user_interface"><a class="anchor" href="#_new_execution_server_management_user_interface"></a><a class="link" href="#_new_execution_server_management_user_interface">21.36.8. New Execution Server Management User Interface</a></h4>
<div class="paragraph">
<p>The KIE Execution Server Management UI has been completely redesigned to adjust to major improvements introduced recently.
Besides the fact that new UI has been built from scratch and following best practices provided by PatternFly, the new interface expands previous features giving users more control of their servers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewExecServerUI.png" alt="NewExecServerUI">
</div>
<div class="title">Figure 455. KIE Execution Server - New user interface</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_and_group_management"><a class="anchor" href="#_user_and_group_management"></a><a class="link" href="#_user_and_group_management">21.36.9. User and group management</a></h4>
<div class="paragraph">
<p>Provides the backend services and an intuitive and friendly user interface that allows the workbench administrators to manage the application&#8217;s users and groups.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/UserAndGroupManagement.png" alt="UserAndGroupManagement">
</div>
</div>
<div class="paragraph">
<p>This interface provides to the workbench administrators the ability to perform realm related operations such as create users, create groups, assign groups or roles to a given user, etc.</p>
</div>
<div class="paragraph">
<p>It comes by default with built-in implementations for the administration of Wildfly, EAP and Tomcat default realms, and it&#8217;s designed to be extensible - any third party realm management system can be easily integrated into the workbench.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.3.0"><a class="anchor" href="#_drools.releasenotesdrools.6.3.0"></a><a class="link" href="#_drools.releasenotesdrools.6.3.0">21.37. New and Noteworthy in Drools 6.3.0</a></h3>
<div class="sect3">
<h4 id="_browsing_graphs_of_objects_with_oopath"><a class="anchor" href="#_browsing_graphs_of_objects_with_oopath"></a><a class="link" href="#_browsing_graphs_of_objects_with_oopath">21.37.1. Browsing graphs of objects with OOPath</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the field of a fact is a collection it is possible to bind and reason over all the items in that collection on by one using the <code>from</code> keyword.
Nevertheless, when it is required to browse a graph of object the extensive use of the <code>from</code> conditional element may result in a verbose and cumbersome syntax like in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 113. Browsing a graph of objects with from</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam" when
    $student: Student( $plan: plan )
    $exam: Exam( course == "Big Data" ) from $plan.exams
    $grade: Grade() from $exam.grades
then /* RHS */ end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example it has been assumed to use a domain model consisting of a <code>Student</code> who has a <code>Plan</code> of study: a <code>Plan</code> can have zero or more <code>Exam</code>s and an <code>Exam</code> zero or more <code>Grade</code>s.
Note that only the root object of the graph (the <code>Student</code> in this case) needs to be in the working memory in order to make this works.</p>
</div>
<div class="paragraph">
<p>By borrowing ideas from XPath, this syntax can be made more succinct, as XPath has a compact notation for navigating through related elements while handling collections and filtering constraints.
This XPath-inspired notation has been called <code>OOPath</code> since it is explictly intended to browse graph of objects.
Using this notation the former example can be rewritten as it follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 114. Browsing a graph of objects with OOPath</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam" when
    Student( $grade: /plan/exams[course == "Big Data"]/grades )
then /* RHS */ end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Formally, the core grammar of an <code>OOPath</code> expression can be defined in EBNF notation in this way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>OOPExpr = "/" OOPSegment { ( "/" | "." ) OOPSegment } ;
OOPSegment = [ID ( ":" | ":=" )] ID ["[" Number "]"] ["{" Constraints "}"];</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice an <code>OOPath</code> expression has the following features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It has to start with <code>/</code>.</p>
</li>
<li>
<p>It can dereference a single property of an object with the <code>.</code> operator</p>
</li>
<li>
<p>It can dereference a multiple property of an object using the <code>/</code> operator. If a collection is returned, it will iterate over the values in the collection</p>
</li>
<li>
<p>While traversing referenced objects it can filter away those not satisfying one or more constraints, written as predicate expressions between curly brackets like in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[course == "Big Data"]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>Items can also be accessed by their index by putting it between square brackets like in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[0]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To adhere to Java convention OOPath indexes are 0-based, compared to XPath 1-based</p>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_reactive_oopath"><a class="anchor" href="#_reactive_oopath"></a><a class="link" href="#_reactive_oopath">21.37.1.1. Reactive OOPath</a></h5>
<div class="paragraph">
<p>At the moment Drools is not able to react to updates involving a deeply nested traversed during the evaluation of an <code>OOPath</code> expression.
To make these objects reactive to changes at the moment it is necessary to make them extend the class <code>org.drools.core.phreak.ReactiveObject</code>.
It is planned to overcome this limitation by implementing a mechanism that automatically instruments the classes belonging to a specific domain model.</p>
</div>
<div class="paragraph">
<p>Having extended that class, the domain objects can notify the Drools engine when one of its field has been updated by invoking the inherited method <code>notifyModification</code> as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 115. Notifying the Drools engine that an exam has been moved to a different course</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public void setCourse(String course) {
    this.course = course;
    notifyModification(this);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this way if an exam is moved to a different course, the rule is re-triggered and the list of grades matching the rule recomputed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shared.releasenotes.kienavigator"><a class="anchor" href="#_shared.releasenotes.kienavigator"></a><a class="link" href="#_shared.releasenotes.kienavigator">21.37.2. Kie Navigator View for Eclipse</a></h4>
<div class="paragraph">
<p>A new viewer has been added to the Eclipse Tooling.
This Kie Navigator View is used to manage Kie Server installations and projects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.3.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.3.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.6.3.0.final">21.38. New and Noteworthy in KIE Workbench 6.3.0</a></h3>
<div class="sect3">
<h4 id="_real_time_validation_and_verification_for_the_decision_tables"><a class="anchor" href="#_real_time_validation_and_verification_for_the_decision_tables"></a><a class="link" href="#_real_time_validation_and_verification_for_the_decision_tables">21.38.1. Real Time Validation and Verification for the Decision Tables</a></h4>
<div class="paragraph">
<p>Decision tables used to have a Validation-button for validating the table.
This is now removed and the table is validated after each cell value change.
The validation and verification checks include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Redundancy</p>
</li>
<li>
<p>Subsumption</p>
</li>
<li>
<p>Conflicts</p>
</li>
<li>
<p>Missing Columns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These checks are explained in detail in the workbench documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improved_drl_editor"><a class="anchor" href="#_improved_drl_editor"></a><a class="link" href="#_improved_drl_editor">21.38.2. Improved DRL Editor</a></h4>
<div class="paragraph">
<p>The DRL Editor has undergone a face lift; moving from a plain TextArea to using ACE Editor and a custom DRL syntax highlighter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/drl-ace-editor.png" alt="drl ace editor">
</div>
<div class="title">Figure 456. ACE Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_asset_locking"><a class="anchor" href="#_asset_locking"></a><a class="link" href="#_asset_locking">21.38.3. Asset locking</a></h4>
<div class="paragraph">
<p>To avoid conflicts when editing assets, a new locking mechanism has been introduced that makes sure that only one user at a time can edit an asset.
When a user begins to edit an asset, a lock will automatically be acquired.
This is indicated by a lock symbol appearing on the asset title bar as well as in the project explorer view.
If a user starts editing an already locked asset a pop-up notification will appear to inform the user that the asset can&#8217;t currently be edited, as it is being worked on by another user.
As long as the editing user holds the lock, changes by other users will be prevented.
Locks will automatically be released when the editing user saves or closes the asset, or logs out of the workbench.
Every user further has the option to force a lock release in the metadata tab, if required.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataModelEditingWithLock.png" alt="DataModelEditingWithLock">
</div>
<div class="title">Figure 457. Editing an asset automatically acquires a lock</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataModelLocked.png" alt="DataModelLocked">
</div>
<div class="title">Figure 458. Locked assets cannot be edited by other users</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_modeller_tool_windows"><a class="anchor" href="#_data_modeller_tool_windows"></a><a class="link" href="#_data_modeller_tool_windows">21.38.4. Data Modeller Tool Windows</a></h4>
<div class="paragraph">
<p>Drools and jBPM configurations, Persistence (see Generation of JPA enabled Data Models) and Advanced configurations were moved into "Tool Windows". "Tool Windows" are a new concept introduced in latest Uberfire version that enables the development of context aware screens.
Each "Tool Window" will contain a domain editor that will manage a set of related Data Object parameters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-DroolsDomainToolWindow6.3.png" alt="DM DroolsDomainToolWindow6.3">
</div>
<div class="title">Figure 459. Drools and jBPM domain tool window</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-JPADomainToolWindow6.3.png" alt="DM JPADomainToolWindow6.3">
</div>
<div class="title">Figure 460. Persistence tool window</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-AdvancedDomainToolWindow6.3.png" alt="DM AdvancedDomainToolWindow6.3">
</div>
<div class="title">Figure 461. Advanced configurations tool window</div>
</div>
</div>
<div class="sect3">
<h4 id="_generation_of_jpa_enabled_data_models"><a class="anchor" href="#_generation_of_jpa_enabled_data_models"></a><a class="link" href="#_generation_of_jpa_enabled_data_models">21.38.5. Generation of JPA enabled Data Models</a></h4>
<div class="paragraph">
<p>Data modeller was extended to support the generation of persistable Data Objects.
The persistable Data Objects are based on the JPA specification and all the underlying metadata are automatically generated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"The New &#8594; Data Object" Data Objects can be marked as persistable at creation time.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-NewDataObject6.3.png" alt="DM NewDataObject6.3">
</div>
<div class="title">Figure 462. New Data Object</div>
</div>
</li>
<li>
<p>The Persistence tool window contains the JPA Domain editors for both Data Object and Field. Each editor will manage the by default generated JPA metadata</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-DataObjectJPADomainTab6.3.png" alt="DM DataObjectJPADomainTab6.3">
</div>
<div class="title">Figure 463. Data Object level JPA domain editor</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-FieldJPADomainTab6.3.png" alt="DM FieldJPADomainTab6.3">
</div>
<div class="title">Figure 464. Field level JPA domain editor</div>
</div>
</li>
<li>
<p>Persistence configuration screen was added to the project editor.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-Persistence-Configuration6.3.png" alt="DM Persistence Configuration6.3">
</div>
<div class="title">Figure 465. Persistence configuration</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_data_set_authoring"><a class="anchor" href="#_data_set_authoring"></a><a class="link" href="#_data_set_authoring">21.38.6. Data Set Authoring</a></h4>
<div class="paragraph">
<p>A new perspective for authoring data set definitions has been added.
Data set definitions make it possible to retrieve data from external systems like databases, CSV/Excel files or even use a Java class to generate the data.
Once the data is available it can be used, for instance, to create charts and dashboards from the Perspective Editor just feeding the charts from any of the data sets available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataSetAuthoringPerspective.png" alt="DataSetAuthoringPerspective">
</div>
<div class="title">Figure 466. Data Sets Authoring Perspective</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.2.0"><a class="anchor" href="#_drools.releasenotesdrools.6.2.0"></a><a class="link" href="#_drools.releasenotesdrools.6.2.0">21.39. New and Noteworthy in Drools 6.2.0</a></h3>
<div class="sect3">
<h4 id="_propagation_modes"><a class="anchor" href="#_propagation_modes"></a><a class="link" href="#_propagation_modes">21.39.1. Propagation modes</a></h4>
<div class="paragraph">
<p>The introduction of PHREAK as default algorithm for the Drools engine made the rules' evaluation lazy.
This new Drools lazy behavior allowed a relevant performance boost but, in some very specific cases, breaks the semantic of a few Drools features.</p>
</div>
<div class="paragraph">
<p>More precisely in some circumstances it is necessary to propagate the insertion of new fact into th session immediately.
For instance Drools allows a query to be executed in pull only (or passive) mode by prepending a '?' symbol to its invocation as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 116. A passive query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">query Q (Integer i)
    String( this == i.toString() )
end
rule R when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, since the query is passive, it shouldn&#8217;t react to the insertion of a String matching the join condition in the query itself.
In other words this sequence of commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = ...
ksession.insert(1);
ksession.insert("1");
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>shouldn&#8217;t cause the rule R to fire because the String satisfying the query condition has been inserted after the Integer and the passive query shouldn&#8217;t react to this insertion.
Conversely the rule should fire if the insertion sequence is inverted because the insertion of the Integer, when the passive query can be satisfied by the presence of an already existing String, will trigger it.</p>
</div>
<div class="paragraph">
<p>Unfortunately the lazy nature of PHREAK doesn&#8217;t allow the Drools engine to make any distinction regarding the insertion sequence of the two facts, so the rule will fire in both cases.
In circumstances like this it is necessary to evaluate the rule eagerly as done by the old RETEOO-based engine.</p>
</div>
<div class="paragraph">
<p>In other cases it is required that the propagation is eager, meaning that it is not immediate, but anyway has to happen before the Drools engine/agenda starts scheduled evaluations.
For instance this is necessary when a rule has the no-loop or the lock-on-active attribute and in fact when this happens this propagation mode is automatically enforced by the Drools engine.</p>
</div>
<div class="paragraph">
<p>To cover these use cases, and in all other situations where an immediate or eager rule evaluation is required, it is possible to declaratively specify so by annotating the rule itself with <strong>@Propagation(Propagation.Type)</strong>, where Propagation.Type is an enumeration with 3 possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>IMMEDIATE</strong> means that the propagation is performed immediately.</p>
</li>
<li>
<p><strong>EAGER</strong> means that the propagation is performed lazily but eagerly evaluated before scheduled evaluations.</p>
</li>
<li>
<p><strong>LAZY</strong> means that the propagation is totally lazy and this is default PHREAK behaviour</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means that the following drl:</p>
</div>
<div class="exampleblock">
<div class="title">Example 117. A data-driven rule using a passive query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">query Q (Integer i)
    String( this == i.toString() )
end
rule R @Propagation(IMMEDIATE) when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>will make the rule R to fire if and only if the Integer is inserted after the String, thus behaving in accordance with the semantic of the passive query.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.2.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.2.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.6.2.0.final">21.40. New and Noteworthy in KIE Workbench 6.2.0</a></h3>
<div class="sect3">
<h4 id="_download_repository_or_part_of_the_repository_as_a_zip"><a class="anchor" href="#_download_repository_or_part_of_the_repository_as_a_zip"></a><a class="link" href="#_download_repository_or_part_of_the_repository_as_a_zip">21.40.1. Download Repository or Part of the Repository as a ZIP</a></h4>
<div class="paragraph">
<p>This feature makes it possible to download a repository or a folder from the repository as a ZIP file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/zip_repo.png" alt="zip repo">
</div>
<div class="title">Figure 467. Download current repository or project</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/zip_folder.png" alt="zip folder">
</div>
<div class="title">Figure 468. Download a folder</div>
</div>
</div>
<div class="sect3">
<h4 id="_project_editor_permissions"><a class="anchor" href="#_project_editor_permissions"></a><a class="link" href="#_project_editor_permissions">21.40.2. Project Editor permissions</a></h4>
<div class="paragraph">
<p>The ability to configure role-based permissions for the Project Editor have been added.</p>
</div>
<div class="paragraph">
<p>Permissions can be configured using the <code>WEB-INF/classes/workbench-policy.properties</code> file.</p>
</div>
<div class="paragraph">
<p>The following permissions are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Save button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_save</code></p>
</div>
</li>
<li>
<p>Delete button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_delete</code></p>
</div>
</li>
<li>
<p>Copy button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_copy</code></p>
</div>
</li>
<li>
<p>Rename button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_rename</code></p>
</div>
</li>
<li>
<p>Build &amp; Deploy button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_buildAndDeploy</code></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unify_validation_style_in_guided_decision_table_wizard"><a class="anchor" href="#_unify_validation_style_in_guided_decision_table_wizard"></a><a class="link" href="#_unify_validation_style_in_guided_decision_table_wizard">21.40.3. Unify validation style in Guided Decision Table Wizard.</a></h4>
<div class="paragraph">
<p>All of our new screens use GWT-Bootstrap widgets and alert users to input errors in a consistent way.</p>
</div>
<div class="paragraph">
<p>One of the most noticeable differences was the Guided Decision Table Wizard that alerted errors in a way inconsistent with our use of GWT-Bootstrap.</p>
</div>
<div class="paragraph">
<p>This Wizard has been updated to use the new look and feel.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewGuidedDecisionTableWizardValidation.png" alt="NewGuidedDecisionTableWizardValidation">
</div>
<div class="title">Figure 469. New Guided Decision Table Wizard validation</div>
</div>
</div>
<div class="sect3">
<h4 id="_improved_wizards"><a class="anchor" href="#_improved_wizards"></a><a class="link" href="#_improved_wizards">21.40.4. Improved Wizards</a></h4>
<div class="paragraph">
<p>During the re-work of the Guided Decision Table&#8217;s Wizard to make it&#8217;s validation consistent with other areas of the application we took the opportunity to move the Wizard Framework to GWT-Bootstrap too.</p>
</div>
<div class="paragraph">
<p>The resulting appearance is much more pleasing.
We hope to migrate more legacy editors to GWT-Bootstrap as time and priorities permit.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewGuidedDecisionTableWizard.png" alt="NewGuidedDecisionTableWizard">
</div>
<div class="title">Figure 470. New Wizard Framework</div>
</div>
</div>
<div class="sect3">
<h4 id="_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates"><a class="anchor" href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates"></a><a class="link" href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates">21.40.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</a></h4>
<div class="paragraph">
<p>Consistency is a good thing for everybody.
Users can expect different authoring metaphors to produce the same rule behaviour (and developers know when something is a bug!).</p>
</div>
<div class="paragraph">
<p>There were a few inconsistencies in the way XLS Decision Tables, Guided Decision Tables and Guided Rule Templates generated the underlying rules for empty cells.
These have been eliminated making their operation consistent.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If all constraints have null values (empty cells) the Pattern is not created.</p>
<div class="paragraph">
<p>Should you need the Pattern but no constraints; you will need to include the constraint <code>this != null</code>.</p>
</div>
<div class="paragraph">
<p>This operation is consistent with how XLS and Guided Decision Tables have always worked.</p>
</div>
</li>
<li>
<p>You can define a constraint on a String field for an empty String or white-space by delimiting it with double-quotation marks. The enclosing quotation-marks are removed from the value when generating the rules.</p>
<div class="paragraph">
<p>The use of quotation marks for other String values is not required and they can be omitted.
Their use is however essential to differentiate a constraint for an empty String from an empty cell - in which case the constraint is omitted.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_improved_metadata_tab"><a class="anchor" href="#_improved_metadata_tab"></a><a class="link" href="#_improved_metadata_tab">21.40.6. Improved Metadata Tab</a></h4>
<div class="paragraph">
<p>The Metadata tab provided in previous versions was redesigned to provide a better asset versioning information browsing and recovery.
Now every workbench editor will provide an "Overview tab" that will enable the user to manage the following information.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedMetadataWidget.jpg" alt="ImprovedMetadataWidget">
</div>
<div class="title">Figure 471. Improved Metadata Tab</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Versions history</p>
<div class="paragraph">
<p>The versions history shows a tabular view of the asset versions and provides a "Select" button that will enable the user to load a previously created version.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedVersionsHistory.jpg" alt="ImprovedVersionsHistory">
</div>
<div class="title">Figure 472. Versions history</div>
</div>
</li>
<li>
<p>Metadata</p>
<div class="paragraph">
<p>The metadata section gets access to additional file attributes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedMetadatSection.jpg" alt="ImprovedMetadatSection">
</div>
<div class="title">Figure 473. Metadata section</div>
</div>
</li>
<li>
<p>Comments area</p>
<div class="paragraph">
<p>The redesigned comments area enables much clearer discussions on a file.</p>
</div>
</li>
<li>
<p>Version selection dropdown</p>
<div class="paragraph">
<p>The "Version selector dropdown" located at the menu bar provides the ability to load and restore previous versions from the "Editor tab", without having to open the "Overview tab" to load the "Version history".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedVersionsSelector.jpg" alt="ImprovedVersionsSelector">
</div>
<div class="title">Figure 474. Version selection dropdown</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_improved_data_objects_editor"><a class="anchor" href="#_improved_data_objects_editor"></a><a class="link" href="#_improved_data_objects_editor">21.40.7. Improved Data Objects Editor</a></h4>
<div class="paragraph">
<p>The Java editor was unified to the standard workbench editors functioning.
It means that and now every data object is edited on his own editor window.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewJavaEditor.png" alt="NewJavaEditor">
</div>
<div class="title">Figure 475. Improved Data Object Editor</div>
</div>
<div class="ulist">
<ul>
<li>
<p>"New &#8594; Data Object" option was added to create the data objects.</p>
</li>
<li>
<p>Overview tab was added for every file to manage the file metadata and have access to the file versions history.</p>
</li>
<li>
<p>Editable "Source Tab" tab was added. Now the Java code can be modified by administrators using the workbench.</p>
</li>
<li>
<p>"Editor" - "Source Tab" round trip is provided. This will let administrators to do manual changes on the generated Java code and go back to the editor tab to continue working.</p>
</li>
<li>
<p>Class usages detection. Whenever a Data Object is about to be deleted or renamed, the project will be scanned for the class usages. If usages are found (e.g. in drl files, decision tables, etc.) the user will receive an alert. This will prevent the user from breaking the project build.</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/UsagesDetection.png" alt="UsagesDetection">
</div>
<div class="title">Figure 476. Usages detection</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_execution_server_management_ui"><a class="anchor" href="#_execution_server_management_ui"></a><a class="link" href="#_execution_server_management_ui">21.40.8. Execution Server Management UI</a></h4>
<div class="paragraph">
<p>A new perspective called <strong>Management</strong> has been added under <strong>Servers</strong> top level menu.
This perspective provides users the ability to manage multiple execution servers with multiple containers.
Available features includes connect to already deployed execution servers; create new, start, stop, delete or upgrade containers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewExecutionServerManagementPerspective.png" alt="NewExecutionServerManagementPerspective">
</div>
<div class="title">Figure 477. Management perspective</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Current version of Execution Server just supports rule based execution.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_social_activities"><a class="anchor" href="#_social_activities"></a><a class="link" href="#_social_activities">21.40.9. Social Activities</a></h4>
<div class="paragraph">
<p>A brand new feature called <strong>Social Activities</strong> has been added under a new top level menu item group called <strong>Activity</strong>.</p>
</div>
<div class="paragraph">
<p>This new feature is divided in two different perspectives: <strong>Timeline Perspective</strong>  and <strong>People Perspective</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>Timeline Perspective</strong> shows on left side the recent assets created or edited by the logged user.
In the main window there is the "Latest Changes" screen, showing all the recent updated assets and an option to filter the recent updates by repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/TimelinePerspective.png" alt="TimelinePerspective">
</div>
<div class="title">Figure 478. Timeline Perspective</div>
</div>
<div class="paragraph">
<p>The <strong>People Perspective</strong> is the home page of a user.
Showing his infos (including a gravatar picture from user e-mail), user connections (people that user follow) and user recent activities.
There is also a way to edit a user info.
The search suggestion can be used to navigate to a user profile, follow him and see his updates on your timeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/PeoplePerspective.png" alt="PeoplePerspective">
</div>
<div class="title">Figure 479. People Perspective</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/PeoplePerspective1.png" alt="PeoplePerspective1">
</div>
<div class="title">Figure 480. Edit User Info</div>
</div>
</div>
<div class="sect3">
<h4 id="_contributors_dashboard"><a class="anchor" href="#_contributors_dashboard"></a><a class="link" href="#_contributors_dashboard">21.40.10. Contributors Dashboard</a></h4>
<div class="paragraph">
<p>A brand new perspective called <strong>Contributors</strong> has been added under a new top level menu item group called <strong>Activity</strong>.
The perspective itself is a dashboard which shows several indicators about the contributions made to the managed organizations / repositories within the workbench.
Every time a organization/repository is added/removed from the workbench the dashboard itself is updated accordingly.</p>
</div>
<div class="paragraph">
<p>This new perspective allows for the monitoring of the underlying activity on the managed repositories.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContributorsPerspective.png" alt="ContributorsPerspective">
</div>
<div class="title">Figure 481. Contributors perspective</div>
</div>
</div>
<div class="sect3">
<h4 id="_package_selector"><a class="anchor" href="#_package_selector"></a><a class="link" href="#_package_selector">21.40.11. Package selector</a></h4>
<div class="paragraph">
<p>The location of new assets whilst authoring was driven by the context of the Project Explorer.</p>
</div>
<div class="paragraph">
<p>This has been replaced with a Package Selector in the New Resource Popup.</p>
</div>
<div class="paragraph">
<p>The location defaults to the Project Explorer context but different packages can now be more easily chosen.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/PackageSelector.png" alt="PackageSelector">
</div>
<div class="title">Figure 482. Package selector</div>
</div>
</div>
<div class="sect3">
<h4 id="_improved_visual_consistency"><a class="anchor" href="#_improved_visual_consistency"></a><a class="link" href="#_improved_visual_consistency">21.40.12. Improved visual consistency</a></h4>
<div class="paragraph">
<p>All Popups have been refactored to use GWT-Bootstrap widgets.</p>
</div>
<div class="paragraph">
<p>Whilst a simple change it brings greater visual consistency to the application as a whole.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/GuidedDecisionTableNewPopup.png" alt="GuidedDecisionTableNewPopup">
</div>
<div class="title">Figure 483. Example Guided Decision Table Editor popup</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/GuidedRuleNewPopup.png" alt="GuidedRuleNewPopup">
</div>
<div class="title">Figure 484. Example Guided Rule Editor popup</div>
</div>
</div>
<div class="sect3">
<h4 id="_guided_decision_tree_editor"><a class="anchor" href="#_guided_decision_tree_editor"></a><a class="link" href="#_guided_decision_tree_editor">21.40.13. Guided Decision Tree Editor</a></h4>
<div class="paragraph">
<p>A new editor has been added to support modelling of simple decision trees.</p>
</div>
<div class="paragraph">
<p>See the applicable section within the User Guide for more information about usage.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/GuidedDecisionTree1.png" alt="GuidedDecisionTree1">
</div>
<div class="title">Figure 485. Example Guided Decision Tree</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_repository_wizard"><a class="anchor" href="#_create_repository_wizard"></a><a class="link" href="#_create_repository_wizard">21.40.14. Create Repository Wizard</a></h4>
<div class="paragraph">
<p>A wizard has been created to guide the repository creation process.
Now the user can decide at repository creation time if it should be a managed or unmanaged repository and configure all related parameters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/CreateRepositoryWizard1.png" alt="CreateRepositoryWizard1">
</div>
<div class="title">Figure 486. Create Repository Wizard 1/2</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/CreateRepositoryWizard2.png" alt="CreateRepositoryWizard2">
</div>
<div class="title">Figure 487. Create Repository Wizard 2/2</div>
</div>
</div>
<div class="sect3">
<h4 id="_repository_structure_screen"><a class="anchor" href="#_repository_structure_screen"></a><a class="link" href="#_repository_structure_screen">21.40.15. Repository Structure Screen</a></h4>
<div class="paragraph">
<p>The new Repository Structure Screen will let users to manage the projects for a given repository, as well as other operations related to managed repositories like: branch creation, assets promotion and project release.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ManagedRepositoryStructureScreen.png" alt="ManagedRepositoryStructureScreen">
</div>
<div class="title">Figure 488. Repository Structure Screen for a Managed Repository</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/UnManagedRepositoryStructureScreen.png" alt="UnManagedRepositoryStructureScreen">
</div>
<div class="title">Figure 489. Repository Structure Screen for an Unmanaged Repository</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenotesintegration.6.2.0"><a class="anchor" href="#_kie.releasenotesintegration.6.2.0"></a><a class="link" href="#_kie.releasenotesintegration.6.2.0">21.41. New and Noteworthy in Integration 6.2.0</a></h3>
<div class="sect3">
<h4 id="_kie_execution_server"><a class="anchor" href="#_kie_execution_server"></a><a class="link" href="#_kie_execution_server">21.41.1. KIE Execution Server</a></h4>
<div class="paragraph">
<p>A new KIE Execution Server was created with the goal of supporting the deployment of kjars and the automatic creation of REST endpoints for remote rules execution.
This initial implementation supports provisioning and execution of kjars via REST without any glue code.</p>
</div>
<div class="paragraph">
<p>A user interface was also integrated into the workbench for remote provisioning.
See the workbench&#8217;s New&amp;Noteworthy for details.</p>
</div>
<div class="listingblock">
<div class="title">Kie Server interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/server")
public interface KieServer {

    @GET
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getInfo();

    @POST
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response execute( CommandScript command );

    @GET
    @Path("containers")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response listContainers();

    @GET
    @Path("containers/{id}")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getContainerInfo( @PathParam("id") String id );

    @PUT
    @Path("containers/{id}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response createContainer( @PathParam("id") String id, KieContainerResource container );

    @DELETE
    @Path("containers/{id}")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response disposeContainer( @PathParam("id") String id );

    @POST
    @Path("containers/{id}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response execute( @PathParam("id") String id, String cmdPayload );

    @GET
    @Path("containers/{id}/release-id")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getReleaseId( @PathParam("id") String id);

    @POST
    @Path("containers/{id}/release-id")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response updateReleaseId( @PathParam("id") String id, ReleaseId releaseId );

    @GET
    @Path("containers/{id}/scanner")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getScannerInfo( @PathParam("id") String id );

    @POST
    @Path("containers/{id}/scanner")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response updateScanner( @PathParam("id") String id, KieScannerResource resource );

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.1.0"><a class="anchor" href="#_drools.releasenotesdrools.6.1.0"></a><a class="link" href="#_drools.releasenotesdrools.6.1.0">21.42. New and Noteworthy in Drools 6.1.0</a></h3>
<div class="sect3">
<h4 id="_jmx_support_for_kiescanner"><a class="anchor" href="#_jmx_support_for_kiescanner"></a><a class="link" href="#_jmx_support_for_kiescanner">21.42.1. JMX support for KieScanner</a></h4>
<div class="paragraph">
<p>Added support for JMX monitoring and management on KieScanner and KieContainer.
To enable, set the property <code>kie.scanner.mbeans</code> to <code>enabled</code>, for example via Java command line: <code> -Dkie.scanner.mbeans=enabled </code>.</p>
</div>
<div class="paragraph">
<p>KieScannerMBean will register under the name:</p>
</div>
<div class="paragraph">
<p>It exposes the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Scanner Release Id:</strong> the release ID the scanner was configured with. May include maven range versions and special keywords like LATEST, SNAPSHOT, etc.</p>
</li>
<li>
<p><strong>Current Release Id: </strong>the actual release ID the artifact resolved to.</p>
</li>
<li>
<p><strong>Status:</strong> STARTING, SCANNING, UPDATING, RUNNING, STOPPED, SHUTDOWN</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also exposes the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scanNow():</strong> forces an immediate scan of the maven repository looking for artifact updates</p>
</li>
<li>
<p><strong>start():</strong> starts polling the maven repository for artifact updates based on the polling interval parameter</p>
</li>
<li>
<p><strong>stop():</strong> stops automatically polling the maven repository</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.1.0"><a class="anchor" href="#_wb.releasenotesworkbench.6.1.0"></a><a class="link" href="#_wb.releasenotesworkbench.6.1.0">21.43. New and Noteworthy in KIE Workbench 6.1.0</a></h3>
<div class="sect3">
<h4 id="_data_modeler_round_trip_and_source_code_preservation"><a class="anchor" href="#_data_modeler_round_trip_and_source_code_preservation"></a><a class="link" href="#_data_modeler_round_trip_and_source_code_preservation">21.43.1. Data Modeler - round trip and source code preservation</a></h4>
<div class="paragraph">
<p>Full round trip between Data modeler and Java source code is now supported.
No matter where the Java code was generated (e.g.
Eclipse, Data modeller), data modeler will only update the necessary code blocks to maintain the model updated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_modeler_improved_annotations"><a class="anchor" href="#_data_modeler_improved_annotations"></a><a class="link" href="#_data_modeler_improved_annotations">21.43.2. Data Modeler - improved annotations</a></h4>
<div class="paragraph">
<p>New annotations @TypeSafe, @ClassReactive, @PropertyReactive, @Timestamp, @Duration and @Expires were added in order enrich current Drools annotations manged by the data modeler.</p>
</div>
</div>
<div class="sect3">
<h4 id="_standardization_of_the_display_of_tabular_data"><a class="anchor" href="#_standardization_of_the_display_of_tabular_data"></a><a class="link" href="#_standardization_of_the_display_of_tabular_data">21.43.3. Standardization of the display of tabular data</a></h4>
<div class="paragraph">
<p>We have standardized the display of tabular data with a new table widget.</p>
</div>
<div class="paragraph">
<p>The new table supports the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Selection of visible columns</p>
</li>
<li>
<p>Resizable columns</p>
</li>
<li>
<p>Moveable columns</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/new-grid.png" alt="new grid">
</div>
<div class="title">Figure 490. New table</div>
</div>
<div class="paragraph">
<p>The table is used in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inbox (Incoming changes)</p>
</li>
<li>
<p>Inbox (Recently edited)</p>
</li>
<li>
<p>Inbox (Recently opened)</p>
</li>
<li>
<p>Project Problems summary</p>
</li>
<li>
<p>Artifact Repository browser</p>
</li>
<li>
<p>Project Editor Dependency grid</p>
</li>
<li>
<p>Project Editor KSession grid</p>
</li>
<li>
<p>Project Editor Work Item Handlers Configuration grid</p>
</li>
<li>
<p>Project Editor Listeners Configuration grid</p>
</li>
<li>
<p>Search Results grid</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_generation_of_modifyx_blocks"><a class="anchor" href="#_generation_of_modifyx_blocks"></a><a class="link" href="#_generation_of_modifyx_blocks">21.43.4. Generation of <code>modify(x) {&#8230;&#8203;}</code> blocks</a></h4>
<div class="paragraph">
<p>The Guided Rule Editor, Guided Template Editor and Guided Decision Table Editor have been changed to generate <code>modify(x){&#8230;&#8203;}</code></p>
</div>
<div class="paragraph">
<p>Historically these editors supported the older <code>update(x)</code> syntax and hence rules created within the Workbench would not respond correctly to <code>@PropertyReactive</code> and associated annotations within a model.
This has now been rectified with the use of <code>modify(x){&#8230;&#8203;}</code> blocks.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenoteskie.6.0.0"><a class="anchor" href="#_kie.releasenoteskie.6.0.0"></a><a class="link" href="#_kie.releasenoteskie.6.0.0">21.44. New and Noteworthy in KIE API 6.0.0</a></h3>
<div class="sect3">
<h4 id="_new_kie_name"><a class="anchor" href="#_new_kie_name"></a><a class="link" href="#_new_kie_name">21.44.1. New KIE name</a></h4>
<div class="paragraph">
<p>KIE is the new umbrella name used to group together our related projects; as the family continues to grow.
KIE is also used for the generic parts of unified API; such as building, deploying and loading.
This replaces the kiegroup and knowledge keywords that would have been used before.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./KIE/Overview/kie.png" alt="kie">
</div>
<div class="title">Figure 491. KIE Anatomy</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_aligned_projects_and_modules_and_maven_deployment"><a class="anchor" href="#_maven_aligned_projects_and_modules_and_maven_deployment"></a><a class="link" href="#_maven_aligned_projects_and_modules_and_maven_deployment">21.44.2. Maven aligned projects and modules and Maven Deployment</a></h4>
<div class="paragraph">
<p>One of the biggest complaints during the 5.x series was the lack of defined methodology for deployment.
The mechanism used by Drools and jBPM was very flexible, but it was too flexible.
A big focus for 6.0 was streamlining the build, deploy and loading (utilization) aspects of the system.
Building and deploying activities are now aligned with Maven and Maven repositories.
The utilization for loading rules and processess is now convention and configuration oriented, instead of programmatic, with sane defaults to minimise the configuration.</p>
</div>
<div class="paragraph">
<p>Projects can be built with Maven and installed to the local M2_REPO or remote Maven repositories.
Maven is then used to declare and build the classpath of dependencies, for KIE to access.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_and_convention_based_projects"><a class="anchor" href="#_configuration_and_convention_based_projects"></a><a class="link" href="#_configuration_and_convention_based_projects">21.44.3. Configuration and convention based projects</a></h4>
<div class="paragraph">
<p>The 'kmodule.xml' provides declarative configuration for KIE projects.
Conventions and defaults are used to reduce the amount of configuration needed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 118. Declare KieBases and KieSessions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;kbase name="kbase1" packages="org.mypackages"&gt;
    &lt;ksession name="ksession1"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 119. Utilize the KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_inclusion"><a class="anchor" href="#_kiebase_inclusion"></a><a class="link" href="#_kiebase_inclusion">21.44.4. KieBase Inclusion</a></h4>
<div class="paragraph">
<p>It is possible to include all the KIE artifacts belonging to a KieBase into a second KieBase.
This means that the second KieBase, in addition to all the rules, function and processes directly defined into it,  will also contain the ones created in the included KieBase.
This inclusion can be done declaratively in the kmodule.xml file</p>
</div>
<div class="exampleblock">
<div class="title">Example 120. Including a KieBase into another declaratively</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;kbase name="kbase2" includes="kbase1"&gt;
    &lt;ksession name="ksession2"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>or programmatically using the <code>KieModuleModel</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 121. Including a KieBase into another programmatically</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieModuleModel kmodule = KieServices.Factory.get().newKieModuleModel();
KieBaseModel kieBaseModel1 = kmodule.newKieBaseModel("KBase2").addInclude("KBase1");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiemodules_kiecontainer_and_kie_ci"><a class="anchor" href="#_kiemodules_kiecontainer_and_kie_ci"></a><a class="link" href="#_kiemodules_kiecontainer_and_kie_ci">21.44.5. KieModules, KieContainer and KIE-CI</a></h4>
<div class="paragraph">
<p>Any Maven produced JAR with a 'kmodule.xml' in it is considered a KieModule.
This can be loaded from the classpath or dynamically at runtime from a Resource location.
If the kie-ci dependency is on the classpath it embeds Maven and all resolving is done automatically using Maven and can access local or remote repositories.
Settings.xml is obeyed for Maven configuration.</p>
</div>
<div class="paragraph">
<p>The KieContainer provides a runtime to utilize the KieModule, versioning is built in throughout, via Maven.
Kie-ci will create a classpath dynamically from all the Maven declared dependencies for the artifact being loaded.
Maven LATEST, SNAPSHOT, RELEASE and version ranges are supported.</p>
</div>
<div class="exampleblock">
<div class="title">Example 122. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.newKieContainer(
        ks.newReleaseId("org.mygroup", "myartefact", "1.0") );

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>KieContainers can be dynamically updated to a specific version, and resolved through Maven if KIE-CI is on the classpath.
For stateful KieSessions the existing sessions are incrementally updated.</p>
</div>
<div class="exampleblock">
<div class="title">Example 123. Dynamically Update - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainer kContainer.updateToVersion(
                ks.newReleaseId("org.mygroup", "myartefact", "1.1") );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiescanner_2"><a class="anchor" href="#_kiescanner_2"></a><a class="link" href="#_kiescanner_2">21.44.6. KieScanner</a></h4>
<div class="paragraph">
<p>The <code>KieScanner</code> is a Maven-oriented replacement of the KnowledgeAgent present in Drools 5.
It continuously monitors your Maven repository to check if a new release of a Kie project has been installed and if so, deploys it in the <code>KieContainer</code> wrapping that project.
The use of the <code>KieScanner</code> requires kie-ci.jar to be on the classpath.</p>
</div>
<div class="paragraph">
<p>A <code>KieScanner</code> can be registered on a <code>KieContainer</code> as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 124. Registering and starting a KieScanner on a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0-SNAPSHOT" );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example the <code>KieScanner</code> is configured to run with a fixed time interval, but it is also possible to run it on demand by invoking the <code>scanNow()</code> method on it.
If the <code>KieScanner</code> finds, in the Maven repository, an updated version of the Kie project used by that <code>KieContainer</code> it automatically downloads the new version and triggers an incremental build of the new project.
From this moment all the new <code>KieBase</code>s and <code>KieSession</code>s created from that <code>KieContainer</code> will use the new project version.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hierarchical_classloader"><a class="anchor" href="#_hierarchical_classloader"></a><a class="link" href="#_hierarchical_classloader">21.44.7. Hierarchical ClassLoader</a></h4>
<div class="paragraph">
<p>The CompositeClassLoader is no longer used; as it was a constant source of performance problems and bugs.
Traditional hierarchical classloaders are now used.
The root classloader is at the KieContext level, with one child ClassLoader per namespace.
This makes it cleaner to add and remove rules, but there can now be no referencing between namespaces in DRL files; i.e.
functions can only be used by the namespaces that declared them.
The recommendation is to use static Java methods in your project, which is visible to all namespaces; but those cannot (like other classes on the root KieContainer ClassLoader) be dynamically updated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_legacy_api_adapter"><a class="anchor" href="#_legacy_api_adapter"></a><a class="link" href="#_legacy_api_adapter">21.44.8. Legacy API Adapter</a></h4>
<div class="paragraph">
<p>The 5.x API for building and running with Drools and jBPM is still available through Maven dependency "knowledge-api-legacy5-adapter". Because the nature of deployment has significantly changed in 6.0, it was not possible to provide an adapter bridge for the KnowledgeAgent.
If any other methods are missing or problematic, please open a JIRA, and we&#8217;ll fix for 6.1</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_documentation"><a class="anchor" href="#_kie_documentation"></a><a class="link" href="#_kie_documentation">21.44.9. KIE Documentation</a></h4>
<div class="paragraph">
<p>While a lot of new documentation has been added for working with the new KIE API, the entire documentation has not yet been brought up to date.
For this reason there will be continued references to old terminologies.
Apologies in advance, and thank you for your patience.
We hope those in the community will work with us to get the documentation updated throughout, for 6.1</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.0.0"><a class="anchor" href="#_drools.releasenotesdrools.6.0.0"></a><a class="link" href="#_drools.releasenotesdrools.6.0.0">21.45. New and Noteworthy in Drools 6.0.0</a></h3>
<div class="sect3">
<h4 id="_phreak_lazy_rule_matching_algorithm"><a class="anchor" href="#_phreak_lazy_rule_matching_algorithm"></a><a class="link" href="#_phreak_lazy_rule_matching_algorithm">21.45.1. PHREAK - Lazy rule matching algorithm</a></h4>
<div class="paragraph">
<p>The main work done for Drools in 6.0 involves the new PREAK algorithm.
This is a lazy algorithm that should enable Drools to handle a larger number of rules and facts.
AngendaGroups can now help improvement performance, as rules are not evaluated until it attempts to fire them.</p>
</div>
<div class="paragraph">
<p>Sequential mode continues to be supported for PHREAK but now 'modify' is allowed.
While there is no 'inference' with sequential configuration,  as rules are lazily evaluated, any rule not yet evaluated will see the more recent data as a result of 'modify'. This is more inline with how people intuitively think sequential works.</p>
</div>
<div class="paragraph">
<p>The conflict resolution order has been tweaked for PHREAK, and now is ordered by salience and then rule order; based on the rule position in the file. Prior to Drools 6.0.0, after salience, it was considered arbitrary.
When KieModules and updateToVersion are used for dynamic deployment, the rule order in the file is preserved via the diff processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_automatically_firing_timed_rule_in_passive_mode"><a class="anchor" href="#_automatically_firing_timed_rule_in_passive_mode"></a><a class="link" href="#_automatically_firing_timed_rule_in_passive_mode">21.45.2. Automatically firing timed rule in passive mode</a></h4>
<div class="paragraph">
<p>When the Drools engine runs in passive mode (i.e.: using fireAllRules) by default it doesn&#8217;t fire consequences of timed rules unless fireAllRules isn&#8217;t invoked again.
Now it is possible to change this default behavior by configuring the KieSession with a <code>TimedRuleExectionOption</code> as shown in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 125. Configuring a KieSession to automatically execute timed rules</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExectionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to have a finer grained control on the timed rules that have to be automatically executed.
To do this it is necessary to set a `FILTERED<code>`TimedRuleExectionOption</code> that allows to define a callback to filter those rules, as done in the next example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 126. Configuring a filter to choose which timed rules should be automatically executed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( new TimedRuleExectionOption.FILTERED(new TimedRuleExecutionFilter() {
    public boolean accept(Rule[] rules) {
        return rules[0].getName().equals("MyRule");
    }
}) );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expression_timers"><a class="anchor" href="#_expression_timers"></a><a class="link" href="#_expression_timers">21.45.3. Expression Timers</a></h4>
<div class="paragraph">
<p>It is now possible to define both the delay and interval of an interval timer as an expression instead of a fixed value.
To do that it is necessary to declare the timer as an expression one (indicated by "expr:") as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 127. An Expression Timer Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">declare Bean
    delay   : String = "30s"
    period  : long = 60000
end

rule "Expression timer"
    timer( expr: $d, $p )
when
    Bean( $d : delay, $p : period )
then
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The expressions, $d and $p in this case, can use any variable defined in the pattern matching part of the rule and can be any String that can be parsed in a time duration or any numeric value that will be internally converted in a long representing a duration expressed in milliseconds.</p>
</div>
<div class="paragraph">
<p>Both interval and expression timers can have 3 optional parameters named "start", "end" and "repeat-limit". When one or more of these parameters are used the first part of the timer definition must be followed by a semicolon ';' and the parameters have to be separated by a comma ',' as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 128. An Interval Timer with a start and an end</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer (int: 30s 10s; start=3-JAN-2010, end=5-JAN-2010)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The value for start and end parameters can be a Date, a String representing a Date or a long, or more in general any Number, that will be transformed in a Java Date applying the following conversion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">new Date( ((Number) n).longValue() )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversely the repeat-limit can be only an integer and it defines the maximum number of repetitions allowed by the timer.
If both the end and the repeat-limit parameters are set the timer will stop when the first of the two will be matched.</p>
</div>
<div class="paragraph">
<p>The using of the start parameter implies the definition of a phase for the timer, where the beginning of the phase is given by the start itself plus the eventual delay.
In other words in this case the timed rule will then be scheduled at times:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">start + delay + n*period</code></pre>
</div>
</div>
<div class="paragraph">
<p>for up to repeat-limit times and no later than the end timestamp (whichever first). For instance the rule having the following interval timer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer ( int: 30s 1m; start="3-JAN-2010" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be scheduled at the 30th second of every minute after the midnight of the 3-JAN-2010.
This also means that if for example you turn the system on at midnight of the 3-FEB-2010 it won&#8217;t be scheduled immediately but will preserve the phase defined by the timer and so it will be scheduled for the first time 30 seconds after the midnight.
If for some reason the system is paused (e.g.
the session is serialized and then deserialized after a while) the rule will be scheduled only once to recover from missing activations (regardless of how many activations we missed) and subsequently it will be scheduled again in phase with the timer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ruleflowgroups_and_agendagroups_are_merged"><a class="anchor" href="#_ruleflowgroups_and_agendagroups_are_merged"></a><a class="link" href="#_ruleflowgroups_and_agendagroups_are_merged">21.45.4. RuleFlowGroups and AgendaGroups are merged</a></h4>
<div class="paragraph">
<p>These two groups have been merged and now RuleFlowGroups behave the same as AgendaGroups.
The get methods have been left, for deprecation reasons, but both return the same underlying data.
When jBPM activates a group it now just calls setFocus.
RuleFlowGroups and AgendaGroups when used together was a continued source of errors.
It also aligns the codebase, towards PHREAK and the multi-core exploitation that is planned in the future.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.0.0"><a class="anchor" href="#_wb.releasenotesworkbench.6.0.0"></a><a class="link" href="#_wb.releasenotesworkbench.6.0.0">21.46. New and Noteworthy in KIE Workbench 6.0.0</a></h3>
<div class="paragraph">
<p>The workbench has had a big overhaul using a new base project called UberFire.
UberFire is inspired by Eclipse and provides a clean, extensible and flexible framework for the workbench.
The end result is not only a richer experience for our end users, but we can now develop more rapidly with a clean component based architecture.
If you like he Workbench experience you can use UberFire today to build your own web based dashboard and console efforts.</p>
</div>
<div class="paragraph">
<p>As well as the move to a UberFire the other biggest change is the move from JCR to Git; there is a utility project to help with migration.
Git is the most scalable and powerful source repository bar none.
JGit provides a solid OSS implementation for Git.
This addresses the continued performance problems with the various JCR implementations, which would slow down once the number of files and number of versions become too high.
There has been a big "low tech" drive, to remove complexity.
Everything is now stored as a file, including meta data.
The database is only there to provide fast indexing and search.
So importing and exporting is all standard Git and external sites, like GitHub, can be used to exchange repositories.</p>
</div>
<div class="paragraph">
<p>In 5.x developers would work with their own source repository and then push JCR, via the team provider.
This team provider was not full featured and not available outside Eclipse.
Git enables our repository to work any existing Git tool or team provider.
While not yet supported in the UI,  this will be added over time, it is possible to connect to the repo and tag and branch and restore things.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/kie-drools-wb.png" alt="kie drools wb">
</div>
<div class="title">Figure 492. Workbench</div>
</div>
<div class="paragraph">
<p>The Guvnor brand leaked too much from its intended role; such as the authoring metaphors, like Decision Tables, being considered Guvnor components instead of Drools components.
This wasn&#8217;t helped by the monolithic projects structure used in 5.x for Guvnor.
In 6.0 Guvnor 's focus has been narrowed to encapsulates the set of UberFire plugins that provide the basis for building a web based IDE.
Such as Maven integration for building and deploying, management of Maven repositories and activity notifications via inboxes.
Drools and jBPM build workbench distributions using Uberfire as the base and including a set of plugins, such as Guvnor, along with their own plugins for things like decision tables, guided editors, BPMN2 designer, human tasks.</p>
</div>
<div class="paragraph">
<p>The "Model Structure" diagram outlines the new project anatomy.
The Drools workbench is called KIE-Drools-WB.
KIE-WB is the uber workbench that combines all the Guvnor, Drools and jBPM plugins.
The jBPM-WB is ghosted out, as it doesn&#8217;t actually exist, being made redundant by KIE-WB.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/kie-structure.png" alt="kie structure">
</div>
<div class="title">Figure 493. Module Structure</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>KIE Drools Workbench and KIE Workbench share a common set of components for generic workbench functionality such as Project navigation, Project definitions, Maven based Projects, Maven Artifact Repository.
These common features are described in more detail throughout this documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The two primary distributions consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KIE Drools Workbench</p>
<div class="ulist">
<ul>
<li>
<p>Drools Editors, for rules and supporting assets.</p>
</li>
<li>
<p>jBPM Designer, for Rule Flow and supporting assets.</p>
</li>
</ul>
</div>
</li>
<li>
<p>KIE Workbench</p>
<div class="ulist">
<ul>
<li>
<p>Drools Editors, for rules and supporting assets.</p>
</li>
<li>
<p>jBPM Designer, for BPMN2 and supporting assets.</p>
</li>
<li>
<p>Business Central, runtime and Human Task support.</p>
</li>
<li>
<p>jBPM Form Builder.</p>
</li>
<li>
<p>BAM.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Workbench highlights:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New flexible Workbench environment, with perspectives and panels.</p>
</li>
<li>
<p>New packaging and build system following KIE API.</p>
<div class="ulist">
<ul>
<li>
<p>Maven based projects.</p>
</li>
<li>
<p>Maven Artifact Repository replaces Global Area, with full dependency support.</p>
</li>
</ul>
</div>
</li>
<li>
<p>New Data Modeller replaces the declarative Fact Model Editor; bringing authoring of Java classes to the authoring environment. Java classes are packaged into the project and can be used within rules, processes etc and externally in your own applications.</p>
</li>
<li>
<p>Virtual File System replaces JCR with a default Git based implementation.</p>
<div class="ulist">
<ul>
<li>
<p>Default Git based implementation supports remote operations.</p>
</li>
<li>
<p>External modifications appear within the Workbench.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Incremental Build system showing, near real-time validation results of your project and assets.</p>
<div class="literalblock">
<div class="content">
<pre>The editors themselves are largely unchanged; however of note imports have moved from the package definition to individual editors so you need only import types used for an asset and not the package as a whole.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenotesintegration.6.0.0"><a class="anchor" href="#_kie.releasenotesintegration.6.0.0"></a><a class="link" href="#_kie.releasenotesintegration.6.0.0">21.47. New and Noteworthy in Integration 6.0.0</a></h3>
<div class="sect3">
<h4 id="_cdi"><a class="anchor" href="#_cdi"></a><a class="link" href="#_cdi">21.47.1. CDI</a></h4>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("kbase1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private KieBase kbase1v10;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="paragraph">
<p>CDI is now tightly integrated into the KIE API.
It can be used to inject versioned KieSession and KieBases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring"><a class="anchor" href="#_spring"></a><a class="link" href="#_spring">21.47.2. Spring</a></h4>
<div class="paragraph">
<p>Spring has been revamped and now integrated with KIE.
Spring can replace the 'kmodule.xml' with a more powerful spring version.
The aim is for consistency with kmodule.xml</p>
</div>
</div>
<div class="sect3">
<h4 id="_aries_blueprints"><a class="anchor" href="#_aries_blueprints"></a><a class="link" href="#_aries_blueprints">21.47.3. Aries Blueprints</a></h4>
<div class="paragraph">
<p>Aries blueprints is now also supported, and follows the work done for spring.
The aim is for consistency with spring and kmodule.xml</p>
</div>
</div>
<div class="sect3">
<h4 id="_osgi_ready"><a class="anchor" href="#_osgi_ready"></a><a class="link" href="#_osgi_ready">21.47.4. OSGi Ready</a></h4>
<div class="paragraph">
<p>All modules have been refactored to avoid package splitting, which was a problem in 5.x.
Testing has been moved to PAX.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 7.30.0.Final<br>
Last updated 2019-11-26 20:59:04 CET
</div>
</div>
<!-- Collapsed Table of Content -->
<script src="website/jquery/jquery.min.js"></script>
<script src="website/jstree/jstree.min.js"></script>
<script src="website/toc.js"></script>

<!-- Adobe Analytics for Red Hat - DPAL (DTM Property Auto-Loader) - part 2/2 -->
<script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>