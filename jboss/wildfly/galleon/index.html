<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<meta name="author" content="Alexey Loubyansky, Jean-François Denise">
<title>Galleon Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement when using as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Galleon Documentation</h1>
<div class="details">
<span id="author" class="author">Alexey Loubyansky, Jean-François Denise</span><br>
<span id="revnumber">version 4.0.0.Final,</span>
<span id="revdate">2019-05-10</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a></li>
<li><a href="#_feature_packs">2. Feature-packs</a>
<ul class="sectlevel2">
<li><a href="#_feature_pack_archive_structure">2.1. Feature-pack archive structure</a></li>
<li><a href="#_feature_pack_metadata_feature_pack_xml">2.2. Feature-pack metadata (feature-pack.xml)</a></li>
<li><a href="#_feature_pack_location">2.3. Feature-pack location</a></li>
</ul>
</li>
<li><a href="#_general_provisioning_workflow">3. General provisioning workflow</a></li>
<li><a href="#_feature_pack_packages">4. Feature-pack packages</a>
<ul class="sectlevel2">
<li><a href="#_package_directory_structure">4.1. Package directory structure</a></li>
<li><a href="#_package_metadata_package_xml">4.2. Package metadata (package.xml)</a></li>
<li><a href="#_package_dependencies">4.3. Package dependencies</a></li>
<li><a href="#_feature_pack_default_packages">4.4. Feature-pack default packages</a></li>
<li><a href="#_feature_pack_non_default_packages">4.5. Feature-pack non-default packages</a></li>
<li><a href="#_effective_package_set">4.6. Effective package set</a></li>
</ul>
</li>
<li><a href="#_feature_pack_dependencies">5. Feature-pack dependencies</a>
<ul class="sectlevel2">
<li><a href="#_customizing_the_effective_package_set_of_a_dependency">5.1. Customizing the effective package set of a dependency</a></li>
<li><a href="#_disabling_package_inheritance_from_a_dependency">5.2. Disabling package inheritance from a dependency</a></li>
<li><a href="#_merging_package_sets_of_dependencies">5.3. Merging package sets of dependencies</a></li>
</ul>
</li>
<li><a href="#_feature_pack_transitive_dependencies">6. Feature-pack transitive dependencies</a>
<ul class="sectlevel2">
<li><a href="#_customizing_package_set_of_a_transitive_dependency">6.1. Customizing package set of a transitive dependency</a></li>
</ul>
</li>
<li><a href="#_overriding_dependency_versions_and_resolving_conflicts">7. Overriding dependency versions and resolving conflicts</a>
<ul class="sectlevel2">
<li><a href="#_resolving_version_conflicts">7.1. Resolving version conflicts</a></li>
</ul>
</li>
<li><a href="#_generic_configuration_model">8. Generic configuration model</a>
<ul class="sectlevel2">
<li><a href="#_features">8.1. Features</a></li>
<li><a href="#_feature_groups">8.2. Feature groups</a></li>
<li><a href="#_layers">8.3. Layers</a></li>
</ul>
</li>
<li><a href="#_provisioned_installation_configuration">9. Provisioned installation configuration</a>
<ul class="sectlevel2">
<li><a href="#_configuration_model_attributes">9.1. Configuration model attributes</a></li>
<li><a href="#_excluding_default_configs_from_the_installation">9.2. Excluding default configs from the installation</a></li>
<li><a href="#_picking_default_configs_into_the_installation">9.3. Picking default configs into the installation</a></li>
<li><a href="#_configuration_model_merges">9.4. Configuration model merges</a></li>
<li><a href="#_content_of_config_element">9.5. Content of <code>config</code> element</a></li>
<li><a href="#_configuration_package_dependencies">9.6. Configuration package dependencies</a></li>
<li><a href="#_configuration_dependencies">9.7. Configuration dependencies</a></li>
<li><a href="#_arranging_features_in_configurations">9.8. Arranging features in configurations</a></li>
</ul>
</li>
<li><a href="#_patches">10. Patches</a>
<ul class="sectlevel2">
<li><a href="#_what_can_be_patched">10.1. What can be patched</a></li>
<li><a href="#_multiple_patches_for_the_same_feature_pack">10.2. Multiple patches for the same feature-pack</a></li>
<li><a href="#_applying_patches">10.3. Applying patches</a></li>
</ul>
</li>
<li><a href="#_handling_user_managed_content">11. Handling user-managed content</a>
<ul class="sectlevel2">
<li><a href="#_application_of_user_changes_to_the_updated_installation_state">11.1. Application of user changes to the updated installation state</a></li>
</ul>
</li>
<li><a href="#_provisioning_options">12. Provisioning options</a>
<ul class="sectlevel2">
<li><a href="#_persistent_and_non_persistent_options">12.1. Persistent and non-persistent options</a></li>
<li><a href="#_built_in_and_product_specific_options">12.2. Built-in and product-specific options</a></li>
</ul>
</li>
<li><a href="#_maven_plugin">13. Maven plugin</a>
<ul class="sectlevel2">
<li><a href="#_install_feature_pack">13.1. install-feature-pack</a></li>
<li><a href="#_provision">13.2. provision</a></li>
</ul>
</li>
<li><a href="#_galleon_cli_tool">14. Galleon CLI tool</a>
<ul class="sectlevel2">
<li><a href="#_feature_pack">14.1. Feature-pack</a></li>
<li><a href="#_universe_feature_pack_location_fpl">14.2. Universe feature-pack location (FPL)</a></li>
<li><a href="#_universe_feature_pack_id_fpid">14.3. Universe feature-pack id (FPID)</a></li>
<li><a href="#_listing_latest_available_feature_packs">14.4. Listing latest available feature-packs</a></li>
<li><a href="#_searching_for_feature_packs">14.5. Searching for feature-packs</a></li>
<li><a href="#_installing_a_feature_pack">14.6. Installing a feature-pack</a></li>
<li><a href="#_installing_a_subset_of_feature_pack_configurations">14.7. Installing a subset of feature-pack configurations</a></li>
<li><a href="#_installing_feature_pack_layers">14.8. Installing feature-pack layers</a></li>
<li><a href="#_un_installing_a_feature_pack">14.9. Un-installing a feature-pack</a></li>
<li><a href="#_un_doing_the_last_provisioning_command">14.10. Un-doing the last provisioning command</a></li>
<li><a href="#_patching_an_installation">14.11. Patching an installation</a></li>
<li><a href="#_un_installing_a_patch">14.12. Un-installing a patch</a></li>
<li><a href="#_checking_for_updates">14.13. Checking for updates</a></li>
<li><a href="#_updating_an_installation">14.14. Updating an installation</a></li>
<li><a href="#_retrieving_changes_applied_to_an_installation">14.15. Retrieving changes applied to an installation</a></li>
<li><a href="#_persisting_changes_applied_to_an_installation">14.16. Persisting changes applied to an installation</a></li>
<li><a href="#_observing_an_installation">14.17. Observing an installation</a></li>
<li><a href="#_observing_a_feature_pack">14.18. Observing a feature-pack</a></li>
<li><a href="#_optional_packages">14.19. Optional packages</a></li>
<li><a href="#_managing_the_local_cache_of_feature_packs">14.20. Managing the local cache of feature-packs</a></li>
<li><a href="#_exporting_an_installation_to_xml">14.21. Exporting an installation to xml</a></li>
<li><a href="#_provisioning_an_installation_from_xml">14.22. Provisioning an installation from xml</a></li>
<li><a href="#_managing_the_history_of_an_installation">14.23. Managing the history of an installation</a></li>
<li><a href="#_managing_installation_universes">14.24. Managing installation universes</a></li>
<li><a href="#_directory_option">14.25. Directory option</a></li>
<li><a href="#_exploring_an_installation_or_a_feature_pack">14.26. Exploring an installation or a feature-pack.</a></li>
<li><a href="#_searching_the_current_state">14.27. Searching the current state</a></li>
<li><a href="#_creating_a_new_state_or_editing_an_existing_state_from_an_installation_or_provisioning_xml_file">14.28. Creating a new state (or editing an existing state from an installation or provisioning XML file)</a></li>
<li><a href="#_exporting_or_provisioning_the_current_state">14.29. Exporting or provisioning the current state</a></li>
<li><a href="#_adding_a_feature_pack">14.30. Adding a feature-pack</a></li>
<li><a href="#_removing_a_feature_pack">14.31. Removing a feature-pack</a></li>
<li><a href="#_including_a_default_configuration">14.32. Including a default configuration</a></li>
<li><a href="#_removing_an_included_default_configuration">14.33. Removing an included default configuration</a></li>
<li><a href="#_excluding_a_default_configuration">14.34. Excluding a default configuration</a></li>
<li><a href="#_removing_an_excluded_default_configuration">14.35. Removing an excluded default configuration</a></li>
<li><a href="#_including_layers_into_a_configuration">14.36. Including layers into a configuration</a></li>
<li><a href="#_removing_included_layers_from_a_configuration">14.37. Removing included layers from a configuration</a></li>
<li><a href="#_excluding_layers_from_a_configuration">14.38. Excluding layers from a configuration</a></li>
<li><a href="#_removing_excluded_layers_from_a_configuration">14.39. Removing excluded layers from a configuration</a></li>
<li><a href="#_reseting_a_configuration">14.40. Reseting a configuration</a></li>
<li><a href="#_including_a_default_package">14.41. Including a default package</a></li>
<li><a href="#_removing_an_included_default_package">14.42. Removing an included default package</a></li>
<li><a href="#_excluding_a_default_package">14.43. Excluding a default package</a></li>
<li><a href="#_removing_an_excluded_default_package">14.44. Removing an excluded default package</a></li>
<li><a href="#_adding_a_new_feature">14.45. Adding a new feature</a></li>
<li><a href="#_removing_a_feature">14.46. Removing a feature</a></li>
<li><a href="#_managing_universes">14.47. Managing universes</a></li>
</ul>
</li>
<li><a href="#_cli_tool_maven_configuration">15. CLI tool Maven configuration</a>
<ul class="sectlevel2">
<li><a href="#_relying_on_maven_settings">15.1. Relying on maven settings</a></li>
<li><a href="#_adding_new_remote_repositories">15.2. Adding new remote repositories</a></li>
<li><a href="#_default_repository_policies">15.3. Default Repository policies</a></li>
<li><a href="#_advanced_maven_configuration">15.4. Advanced maven configuration</a></li>
<li><a href="#_local_repository">15.5. Local repository</a></li>
<li><a href="#_offline_mode">15.6. Offline mode</a></li>
<li><a href="#_display_maven_configuration">15.7. Display maven configuration</a></li>
<li><a href="#_impact_on_universe">15.8. Impact on Universe</a></li>
<li><a href="#_resolving_feature_packs">15.9. Resolving feature-packs</a></li>
<li><a href="#_maven_tracing">15.10. Maven tracing</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2018 The original authors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a><a class="link" href="#_overview">1. Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Galleon is a provisioning tool designed to create and maintain software distributions that consist of one or more products (or components). The tool supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>adding products to a distribution;</p>
<div class="ulist">
<ul>
<li>
<p>their default and customized configurations;</p>
</li>
</ul>
</div>
</li>
<li>
<p>removing products from a distribution;</p>
</li>
<li>
<p>integration of the products in the distribution;</p>
</li>
<li>
<p>resolution and validation of the resulting configuration and runtime dependencies;</p>
</li>
<li>
<p>patching and version updates;</p>
</li>
<li>
<p>product-specific provisioning plugins;</p>
</li>
<li>
<p>detection of the changes in the provisioned distribution (its filesystem content and/or its configuration) applied by the user manually or by means of other management tools</p>
<div class="ulist">
<ul>
<li>
<p>to be able to preserve them after a version upgrade (having made sure the changes are compatible in the new version)</p>
</li>
<li>
<p>or create a provisioning configuration that could be used to reproduce the state of the distribution including the user changes;</p>
</li>
</ul>
</div>
</li>
<li>
<p>exporting the provisioning configuration of the current state of the distribution with the goal to reproduce it later at another location.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tool includes a command-line interface and a public API. There is also a Maven plugin that allows provisioning a distribution according to the provided configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_packs"><a class="anchor" href="#_feature_packs"></a><a class="link" href="#_feature_packs">2. Feature-packs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feature-pack represents a released unit of software (project, product, component, etc) that can be installed or uninstalled using Galleon tools. Feature-packs are ZIP archives that are normally deployed by the feature-pack producers to artifact repositories (such as Maven) where they can be discovered and consumed by users using Galleon tools.</p>
</div>
<div class="paragraph">
<p>Feature-pack contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>metadata describing</p>
<div class="ulist">
<ul>
<li>
<p>dependencies on other feature-packs;</p>
</li>
<li>
<p>the default configuration(s) of the product the feature-pack represents;</p>
</li>
<li>
<p>the package set that should be installed by default;</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>(optional)</em> a set of packages (that represent various filesystem content);</p>
</li>
<li>
<p><em>(optional)</em> a set of configuration feature specs (used to define and/or tune parts of the product configuration);</p>
</li>
<li>
<p><em>(optional)</em> various resources required to properly assemble and configure the product;</p>
</li>
<li>
<p><em>(optional)</em> product-specific provisioning plug-ins.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Feature-pack may declare dependencies on other feature-packs. Before a feature-pack is installed the tool will make sure its dependencies are satisifed (by installing the missing ones).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_feature_pack_archive_structure"><a class="anchor" href="#_feature_pack_archive_structure"></a><a class="link" href="#_feature_pack_archive_structure">2.1. Feature-pack archive structure</a></h3>
<div class="paragraph">
<p>Feature-packs are distributed as ZIP archives with the following root entries:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">feature-pack.zip
|- configs/
|- feature_groups/
|- features/
|- layers/
|- packages/
|- plugins/
|- resources/
`- feature-pack.xml</pre>
</div>
</div>
<div class="paragraph">
<p>Where</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>configs</strong> - optional directory containing predefined installation configurations;</p>
</li>
<li>
<p><strong>feature_groups</strong> - optional directory containing feature group descriptions;</p>
</li>
<li>
<p><strong>features</strong> - optional directory containing feature specs (units of configuration);</p>
</li>
<li>
<p><strong>layers</strong> - optional directory containing predefined configuration layers that can be used to create custom installation configurations;</p>
</li>
<li>
<p><strong>packages</strong> - optional directory containing packages (units of filesystem content);</p>
</li>
<li>
<p><strong>resources</strong> - optional directory containing various resources needed to properly assemble and configure the product;</p>
</li>
<li>
<p><strong>plugins</strong> - optional directory containing product-specific provisioning plug-ins (note, that alternatively plugin artifacts can also be referenced from <code>feature-pack.xml</code> using their repository coordinates);</p>
</li>
<li>
<p><strong>feature-pack.xml</strong> - metadata describing the feature-pack and the default product configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_feature_pack_metadata_feature_pack_xml"><a class="anchor" href="#_feature_pack_metadata_feature_pack_xml"></a><a class="link" href="#_feature_pack_metadata_feature_pack_xml">2.2. Feature-pack metadata (feature-pack.xml)</a></h3>
<div class="paragraph">
<p>Generally, feature-pack metadata contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Feature-pack location</strong> - string expression that indicates how to resolve the feature-pack artifact from a remote repository and how it can be identified among other feature-packs;</p>
</li>
<li>
<p><em>(optional)</em> <strong>dependencies</strong> -  dependencies on other feature-packs.</p>
</li>
<li>
<p><em>(optional)</em> <strong>configuration</strong> -  the default configurations of the product (there could be more than one default configuration);</p>
</li>
<li>
<p><em>(optional)</em> <strong>default packages</strong> - names of the packages that are installed by default.</p>
</li>
<li>
<p><em>(optional)</em> <strong>plugins</strong> - various provisioning plugins.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of how it may look like in a <code>feature-pack.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
    location="wildfly-servlet@maven(org.jboss.universe:community-universe):current#14.0.0.Beta2"&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;dependencies&gt;
        &lt;dependency location="wildfly-core@maven(org.jboss.universe:community-universe):current#6.0.0.Beta1"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/dependencies&gt;
    &lt;config model="standalone" name="standalone.xml"&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;feature-group name="standalone"/&gt;
        &lt;feature spec="another-feature"&gt;
            &lt;param name="p1" value="v1" /&gt;
            &lt;param name="p2" value="v2" /&gt;
        &lt;/feature&gt;
    &lt;/config&gt;
    &lt;config model="domain" name="domain.xml"&gt;
        &lt;feature-group name="domain"/&gt;
    &lt;/config&gt;
    &lt;config model="host" name="host.xml"&gt;
        &lt;feature-group name="host"/&gt;
    &lt;/config&gt;
    &lt;default-packages&gt; <i class="conum" data-value="4"></i><b>(4)</b>
        &lt;package name="docs"/&gt;
        &lt;package name="modules.all"/&gt;
    &lt;/default-packages&gt;
    &lt;plugins&gt; <i class="conum" data-value="5"></i><b>(5)</b>
        &lt;plugin location="org.jboss.galleon.example:galleon-example-plugin:1.0.0.Final"/&gt;
    &lt;/plugins&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Feature-pack location and build info</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Dependency on another feature-pack</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Description of the default <code>standalone.xml</code> configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>List of packages that should be installed by default</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>List of provisioning plugins</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_feature_pack_location"><a class="anchor" href="#_feature_pack_location"></a><a class="link" href="#_feature_pack_location">2.3. Feature-pack location</a></h3>
<div class="paragraph">
<p>Feature-pack location is an expression that is used to resolve the feature-pack artifact from the remote repository and also identify the feature-pack among other feature-packs.</p>
</div>
<div class="paragraph">
<p>The general and complete feature-pack location format is <strong><em>producer</em></strong>@<strong><em>universe</em></strong>:<strong><em>channel</em></strong>/<strong><em>frequency</em></strong>#<strong><em>build</em></strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>producer</em></strong> - simple name of a feature-pack producer, normally a product or a component name;</p>
</li>
<li>
<p><strong><em>universe</em></strong> - the universe the producer belongs to (universe is basically a named set of feature-pack producers);</p>
</li>
<li>
<p><strong><em>channel</em></strong> - source of backward compatible feature-pack builds;</p>
</li>
<li>
<p><strong><em>frequency</em></strong> - denotes the lowest accepted build quality (e.g. alpha, beta, final, etc) for the feature-pack builds pulled from the channel;</p>
</li>
<li>
<p><strong><em>build</em></strong> - feature-pack build number or version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of the parts above are or could be optional. For example, a user could add a specific universe as the default one for the distribution (in its provisioning configuration) and then not include it explicitly into feature-pack locations for the feature-packs coming from that universe.</p>
</div>
<div class="paragraph">
<p>Frequency is, generally, also optional and could be omitted.</p>
</div>
<div class="paragraph">
<p>Feature-pack producer may configure a default channel, which makes the channel part optional for the feature-packs of that producer.</p>
</div>
<div class="paragraph">
<p>With the universe and frequency omitted the location becomes <strong><em>producer</em></strong>:<strong><em>channel</em></strong>#<strong><em>build</em></strong></p>
</div>
<div class="paragraph">
<p>Here is an example of a full feature-pack location:</p>
</div>
<div class="paragraph">
<p><code>wildfly@maven(org.jboss.universe:community-universe):current/beta#17.0.0.Beta1</code></p>
</div>
<div class="paragraph">
<p>And a shortened version:</p>
</div>
<div class="paragraph">
<p><code>wildfly:current#17.0.0.Beta1</code></p>
</div>
<div class="paragraph">
<p>And assuming <code>current</code> is the default channel it becomes</p>
</div>
<div class="paragraph">
<p><code>wildfly#17.0.0.Beta1</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Galleon CLI tool comes pre-configured with <code>maven(org.jboss.universe:community-universe)</code> as the default universe, which means Galleon CLI users can omit the universe part for wildfly and other feature-pack producers from that universe and also, in general, rely on TAB-completion for feature-pack locations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using Galleon CLI</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">install wildfly@maven(org.jboss.universe:community-universe):current/beta#17.0.0.Beta1</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">install wildfly#17.0.0.Beta1</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in the exact same distribution. And to install the latest (final) version of <code>wildfly</code> a user can simply type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">install wildfly</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_channel"><a class="anchor" href="#_channel"></a><a class="link" href="#_channel">2.3.1. Channel</a></h4>
<div class="paragraph">
<p>Channel represents a source of backward compatible releases. Channels are defined and configured by feature-pack producers.</p>
</div>
<div class="paragraph">
<p>As an example, a channel could be mapped to a major version of a product. Suppose, there is product <code>productA</code> with development branches <code>1.x</code> and <code>2.x</code> and <code>2.x</code> branch is not backward compatible with <code>1.x</code> branch. In this case, the producer of <code>productA</code> could define two channels <code>1</code> for branch <code>1.x</code> and <code>2</code> for branch <code>2.x</code>. Then, to install the latest available (final) release of <code>1.x</code> branch the user would request the tool to install <code>productA:1</code> and <code>productA:2</code> for the latest available (final) release on <code>2.x</code> branch.</p>
</div>
</div>
<div class="sect3">
<h4 id="_frequency"><a class="anchor" href="#_frequency"></a><a class="link" href="#_frequency">2.3.2. Frequency</a></h4>
<div class="paragraph">
<p>Frequency is a channel option that indicates the lowest acceptable build quality when the tool is looking for the latest build of the product. Supported frequencies are defined and configured by feature-pack producers. If the user has not provided any frequency, the default is assumed to be the final (or GA) release.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Frequency is used by the provisioning mechanism only when looking for the latest build. I.e. when installing a product for which the user has not specified the version or when looking for updates for the already installed products.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is a valid feature-pack location expression: <code>productA:1#1.0.0.Beta2</code>.</p>
</div>
<div class="paragraph">
<p>Although the frequency is missing, which means it&#8217;s equivalent to <code>productA:1/final#1.0.0.Beta2</code>. Installing <code>productA:1#1.0.0.Beta2</code> will still install <code>1.0.0.Beta2</code>, because the user has provided the desired version explicitly.</p>
</div>
<div class="paragraph">
<p>But if the user requests an update to the latest version, the tool will check the frequency and will look for the latest available release that satisfies the frequency. In the example above, the tool will not update the distribution until <code>1.0.0.Final</code> becomes available, even if <code>1.0.0.Beta3</code> becomes available before that.</p>
</div>
<div class="paragraph">
<p>However, if the user installed the same feature-pack as <code>productA:1/beta#1.0.0.Beta2</code> and requested an update to the latest version, the tool would also look for the available beta releases and propose <code>1.0.0.Beta3</code> if it&#8217;s available.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
frequency specifies the lowest quality, which mean installing <code>productA:1/beta</code> may actually install <code>1.0.0.Final</code> if the final release is available.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_feature_pack_maven_artifact_location"><a class="anchor" href="#_feature_pack_maven_artifact_location"></a><a class="link" href="#_feature_pack_maven_artifact_location">2.3.3. Feature-pack Maven Artifact Location</a></h4>
<div class="paragraph">
<p>It is also possible to use the feature-pack&#8217;s Maven artifact coordinates in place of the feature-pack location expression described above. In that case, after the feature-pack artifact has been resolved, its actual Galleon feature-pack location will be used during provisioning and state persistence. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">install org.wildfly:wildfly-galleon-pack:17.0.0.Final</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">install wildfly#17.0.0.Final</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general_provisioning_workflow"><a class="anchor" href="#_general_provisioning_workflow"></a><a class="link" href="#_general_provisioning_workflow">3. General provisioning workflow</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is <strong>not</strong> a precise description of how it happens but a high level overview of the workflow.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The provisioning mechanism determines a set of feature-packs that need to be resolved for the installation</p>
</li>
<li>
<p>Feature-pack version compatibility is checked</p>
</li>
<li>
<p>The feature-packs are downloaded from their respective repositories and unpacked in a temporary location</p>
</li>
<li>
<p>Feature-packs are processed in the order they are specified in the installation provisioning description</p>
<div class="ulist">
<ul>
<li>
<p>configuration models and the packages set to be installed is determined for every feature-pack</p>
</li>
<li>
<p>configuration models are merged on-the-fly as soon as they are processed</p>
</li>
</ul>
</div>
</li>
<li>
<p>A staged directory is created</p>
</li>
<li>
<p>Content from all the feature-pack packages is copied to the staged directory (in the order the feature-packs should be installed)</p>
</li>
<li>
<p>Feature-pack plugins are invoked</p>
<div class="ulist">
<ul>
<li>
<p>The plugins are assumed to generate the configuration files from the provided resolved configuration models and perform other necessary tasks to complete the installation</p>
</li>
</ul>
</div>
</li>
<li>
<p>The provisioned state of the installation is recoded</p>
</li>
<li>
<p>The installation created in the staged directory is moved to the target installation directory (fully replacing the current one, if it exists)</p>
</li>
<li>
<p>The temporary directories are deleted</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_pack_packages"><a class="anchor" href="#_feature_pack_packages"></a><a class="link" href="#_feature_pack_packages">4. Feature-pack packages</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A package is a minimal atomic unit of filesystem content that can be included into or excluded from the installation. It could be a set of files and/or provisioning-related resources attached to the package used by the mechanism to provision a piece of filesystem content.</p>
</div>
<div class="paragraph">
<p>Essentially, a software release (filesystem content-wise) is represented as a set of packages released under a common version.</p>
</div>
<div class="paragraph">
<p>Package contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>metadata describing the package;</p>
</li>
<li>
<p><em>(optional)</em> FS content which is copied into the installation when the package is installed;</p>
</li>
<li>
<p><em>(optional)</em> other provisioning resources that are used during provisioning to generate and/or integrate the content (or what the package represents) properly into the target installation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Package may declare dependencies on other packages that belong to the same or another feature-pack. Before a package is installed, the tool will make sure all its dependencies are satisifed (which includes automatic installation of the ones that are missing from the installation).</p>
</div>
<div class="paragraph">
<p>Package is identified by its name. The name must be unique in the scope of the feature-pack the package belongs to.</p>
</div>
<div class="paragraph">
<p>Packages are not versioned. Only the feature-pack has a version.</p>
</div>
<div class="sect2">
<h3 id="_package_directory_structure"><a class="anchor" href="#_package_directory_structure"></a><a class="link" href="#_package_directory_structure">4.1. Package directory structure</a></h3>
<div class="paragraph">
<p>Packages are stored in the directories (named after the packages) under the feature-pack <code>packages</code> directory.</p>
</div>
<div class="paragraph">
<p>Package directory contains the following entries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>package.xml</strong> - the metadata describing the package;</p>
</li>
<li>
<p><em>(optional)</em> <strong>content</strong> - directory containing the content of the package which will be copied to the installation when the package is installed;</p>
</li>
<li>
<p><em>(optional)</em> <strong>pm</strong> - directory containing various resources needed to properly provision the content of the package.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of <code>packages</code> entry from a feature-pack archive containing packages <code>p1</code>, <code>p2</code>, <code>p3</code> and <code>p4</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">packages/
|-p1/
| |-content/
| | `-...
| |-pm/
| | `-...
| `-package.xml
|-p2/
| |-content/
| | `-...
| `-package.xml
|-p3/
| |-pm/
| | `-...
| `-package.xml
`-p4/
  `-package.xml</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_package_metadata_package_xml"><a class="anchor" href="#_package_metadata_package_xml"></a><a class="link" href="#_package_metadata_package_xml">4.2. Package metadata (package.xml)</a></h3>
<div class="paragraph">
<p>Package metadata contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>package name</strong>;</p>
</li>
<li>
<p><em>(optional)</em> <strong>dependencies</strong> - dependencies on other packages from the same and/or other feature-packs;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of how <code>package.xml</code> might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:jboss:galleon:package:2.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2"/&gt;
        &lt;package name="p3" optional="true"/&gt;
        &lt;origin name="another-feature-pack"&gt;
            &lt;package name="p1"/&gt;
            &lt;package name="p11" optional="true"/&gt;
        &lt;/origin&gt;
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here package <code>p1</code> declares dependencies on packages <code>p2</code> and <code>p3</code> that belong to the same feature-pack as <code>p1</code> and packages <code>p1</code> and <code>p11</code> that belong to another feature-pack referenced by alias <code>another-feature-pack</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_package_dependencies"><a class="anchor" href="#_package_dependencies"></a><a class="link" href="#_package_dependencies">4.3. Package dependencies</a></h3>
<div class="paragraph">
<p><a id="package-deps"></a>Package dependency may be required or optional.</p>
</div>
<div class="paragraph">
<p><strong>Required dependency</strong> means that a package cannot be installed unless all its required dependencies are satisfied, i.e. installed. If any required dependency cannot be satisfied (perhaps because a package that happens to be a required dependency has been explicitly excluded from the installation), the provisioning process will fail with an error.</p>
</div>
<div class="paragraph">
<p><strong>Optional dependency</strong> means that the dependency does not have to be satisfied for the package to be installed. For example if package <code>p1</code> declares an optional dependency on package <code>p2</code> and <code>p2</code> is explicitly excluded by the user, <code>p1</code> will still be installed. An example of an optional dependency could be a package called <code>documentation</code> which declares an optional dependency on package <code>examples</code>. If a user is not interested in <code>examples</code>, the rest of <code>documentation</code> could still be installed.</p>
</div>
<div class="paragraph">
<p>Package dependencies are also used to determine the <a href="#_effective_package_set">effective package set of a feature-pack</a> to be installed described later.</p>
</div>
<div class="paragraph">
<p>Here is an example of how dependencies are expressed in the XML metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:jboss:galleon:package:2.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;package name="p3" optional=”true”/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>required dependency on package <code>p2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>optional dependency on package <code>p3</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A package may declare dependency on a package from the same or another feature-pack. During the dependency resolution, at first, the mechanism is trying to resolve the package dependency locally, i.e. in the current feature-pack. If the dependency could not be resolved locally, the mechanism will look for the package dependency in the feature-packs the current feature-pack depends on (in the order the feature-pack dependencies are listed in <code>feature-pack.xml</code> of the current feature-pack). The first found matching package will be used as the resolved dependency. If the package dependency could not be resolved, the mechanism will report an error.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although a package may declare a dependency on a package from another feature-pack, it cannot specify the version of the feature-pack in the package dependency declaration.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_passive_dependencies"><a class="anchor" href="#_passive_dependencies"></a><a class="link" href="#_passive_dependencies">4.3.1. Passive dependencies</a></h4>
<div class="paragraph">
<p>An optional dependency may be also marked as passive, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:jboss:galleon:package:2.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2" optional=”true” passive="true"/&gt;
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, in fact, the example above can be re-written without <code>optional="true"</code> since only optional dependencies can be passive, i.e.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:jboss:galleon:package:2.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2" passive="true"/&gt;
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A passive dependency on a package is satisified only if all the required dependencies of that package are included into the installation (as the default packages or direct or required dependencies (possibly transitive) of the provisioned configs, layers, feature groups or features).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Passive dependencies affect how the <a href="#_effective_package_set">effective package set of a feature-pack</a> is resolved.</p>
</div>
</div>
<div class="sect3">
<h4 id="_explicit_package_dependency_origin"><a class="anchor" href="#_explicit_package_dependency_origin"></a><a class="link" href="#_explicit_package_dependency_origin">4.3.2. Explicit package dependency origin</a></h4>
<div class="paragraph">
<p>Feature-pack containing a package with an external dependency must declare an explicit dependency on the feature-pack (specifying its version) the target package of the external dependency belongs to. This feature-pack dependency may also be assigned a name which can later be used as a reference to that feature-pack dependency when declaring dependencies in <code>package.xml</code> file on packages that belong to that feature-pack.</p>
</div>
<div class="paragraph">
<p>For example, suppose feature-pack <code>fp1</code> depends on feature-pack <code>fp2</code> and package <code>fp1:p1</code> depends on packages <code>fp2:p1</code> and <code>fp2:p10</code>. The <code>feature-pack.xml</code> of <code>fp1</code> might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
            &lt;origin&gt;fp2-dep&lt;/origin&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the <code>package.xml</code> file of <code>fp1:p1</code> might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:jboss:galleon:package:2.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2" /&gt;
        &lt;origin name=”fp2-dep”&gt;
            &lt;package name=”p1” /&gt;
            &lt;package name=”p10” /&gt;
        &lt;/origin&gt;
        &lt;package name="p3" /&gt;
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, the <code>origin</code> element is optional, but in some cases it helps to specify explicitly the origin of package dependencies.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_feature_pack_default_packages"><a class="anchor" href="#_feature_pack_default_packages"></a><a class="link" href="#_feature_pack_default_packages">4.4. Feature-pack default packages</a></h3>
<div class="paragraph">
<p>Feature-pack may define a set of default packages. This set of default packages is installed when the user does not provide explicit instructions about which packages from the feature-pack to install.</p>
</div>
<div class="paragraph">
<p>Default packages are explicitly listed in <code>feature-pack.xml</code> file which is a part of the feature-pack archive. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="package1" /&gt;
        &lt;package name="package2" /&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this feature-pack is installed without further customizations, <code>package1</code> and <code>package2</code> will be installed by default, although the feature-pack above may still contain other packages (not listed as default) that may not get installed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_feature_pack_non_default_packages"><a class="anchor" href="#_feature_pack_non_default_packages"></a><a class="link" href="#_feature_pack_non_default_packages">4.5. Feature-pack non-default packages</a></h3>
<div class="paragraph">
<p>Feature-pack may contain packages that are not marked as default in its <code>feature-pack.xml</code>. Non-default packages can be installed either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implicitly, in case a non-default package appears to be a transitive dependency of a default package;</p>
</li>
<li>
<p>explicitly, in case a user explicitly selected a non-default package to be installed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_effective_package_set"><a class="anchor" href="#_effective_package_set"></a><a class="link" href="#_effective_package_set">4.6. Effective package set</a></h3>
<div class="paragraph">
<p>This chapter is dedicated to the effective package set of a feature-pack (without dependencies) that is going to be installed, how it is resolved by the mechanism and how it can be adjusted by a user.</p>
</div>
<div class="sect3">
<h4 id="_feature_pack_original_effective_package_set"><a class="anchor" href="#_feature_pack_original_effective_package_set"></a><a class="link" href="#_feature_pack_original_effective_package_set">4.6.1. Feature-pack original effective package set</a></h4>
<div class="paragraph">
<p><em>Original</em> in the title means not explicitly modified. I.e. the set of packages which is going to be installed when the feature-pack is installed as-is without any customizations from a user.</p>
</div>
<div class="paragraph">
<p>Generally speaking, the original effective package set of a feature-pack consists of all the default packages of the feature-pack plus all the packages that appear to be direct or transitive dependencies of the default packages, the default configs and layers, feature groups and features those configs consist of.</p>
</div>
<div class="paragraph">
<p>While the required package dependencies are always included into the effective package set, the inclusion of optional packages can be controlled with one of the policies specified as the value of provisioning option <code>optional-packages</code>: <code>all</code>, <code>none</code>, <code>passive</code> and <code>passive+</code>.</p>
</div>
<div class="paragraph">
<p>Here is the table illustrating which dependency types are automatically included and which are filtered out form the effective package set under each policy:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Optional package inclusion policies</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>all</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>passive+</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>passive</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>none</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>passive</strong> (satisfied)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>passive</strong> (unsatisfied)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>optional</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_explicit_package_exclusion"><a class="anchor" href="#_explicit_package_exclusion"></a><a class="link" href="#_explicit_package_exclusion">4.6.2. Explicit package exclusion</a></h4>
<div class="paragraph">
<p>A package may be explicitly excluded from the feature-pack&#8217;s effective package set. For example, given the following feature-pack definition (<code>feature-pack.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1" /&gt;
        &lt;package name="p2" /&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and assuming that</p>
</div>
<div class="ulist">
<ul>
<li>
<p>package <code>p1</code> has an optional dependency on non-default package <code>p11</code>,</p>
</li>
<li>
<p>package <code>p2</code> has an optional dependency on non-default package <code>p22</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The original effective package set of <code>fp1</code> includes <code>p1</code>, <code>p11</code>, <code>p2</code> and <code>p22</code>.</p>
</div>
<div class="paragraph">
<p>If a user is interested in a subset of the effective package set, in fact, only in package <code>p1</code>, for example, it can be expressed in the provisioning XML configuration file as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
         &lt;packages&gt;
             &lt;exclude name="p11"/&gt;
             &lt;exclude name="p2"/&gt;
         &lt;/packages&gt;
     &lt;/feature-pack&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Packages <code>p11</code> and <code>p2</code> are explicitly excluded and package <code>p22</code> is a non-default package which is not a direct or transitive dependency of the packages to be installed, i.e. <code>p1</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_explicit_package_inclusion"><a class="anchor" href="#_explicit_package_inclusion"></a><a class="link" href="#_explicit_package_inclusion">4.6.3. Explicit package inclusion</a></h4>
<div class="paragraph">
<p>A package may be explicitly included into the feature-pack&#8217;s effective package set. For example, given the following feature-pack definition (<code>feature-pack.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe:1#1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1" /&gt;
        &lt;package name="p2" /&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and assuming that</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>p2</code> has an optional dependency on non-default package <code>p21</code>,</p>
</li>
<li>
<p><code>fp1</code> also contains non-default package <code>p3</code>,</p>
</li>
<li>
<p><code>p3</code> has an optional dependency on non-default package <code>p31</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The effective package set of <code>fp1</code> includes <code>p1</code>, <code>p2</code> and <code>p21</code>.</p>
</div>
<div class="paragraph">
<p>A user may explicitly add package <code>p3</code>, exclude <code>p2</code> and still leave <code>p21</code> in the effective package set using the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
         &lt;packages&gt;
             &lt;include name="p3"/&gt;
             &lt;exclude name="p2"/&gt;
             &lt;include name="p21"/&gt;
         &lt;/packages&gt;
     &lt;/feature-pack&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The effective package set now will consist of <code>p1</code> (default package), <code>p21</code> (explicitly included non-default), <code>p3</code> (explicitly included non-default) and <code>p31</code> (brought in as a dependency of <code>p3</code>).</p>
</div>
<div class="paragraph">
<p>If, for example, the user wanted to further cut down the effective set to <code>p21</code> and <code>p3</code>, the configuration would change to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
         &lt;packages&gt;
             &lt;exclude name="p1"/&gt;
             &lt;exclude name="p2"/&gt;
             &lt;include name="p21"/&gt;
             &lt;include name="p3"/&gt;
             &lt;exclude name="p31"/&gt;
         &lt;/packages&gt;
     &lt;/feature-pack&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_pack_dependencies"><a class="anchor" href="#_feature_pack_dependencies"></a><a class="link" href="#_feature_pack_dependencies">5. Feature-pack dependencies</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feature-pack may depend on one or more other feature-packs. Feature-pack dependencies are expressed in <code>feature-pack.xml</code> file. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):2#2.0.1"/&gt;
        &lt;dependency location="fp3@maven(org.jboss.universe:community-universe):1#1.0.2"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="package1"/&gt;
        &lt;package name="package2"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case feature-pack <code>fp1</code> depends on feature-packs <code>fp2</code> and <code>fp3</code>. And if a user requests to install <code>fp1</code>, feature-packs <code>fp2</code> and <code>fp3</code> will be installed by the mechanism implicitly as dependencies of <code>fp1</code>.</p>
</div>
<div class="paragraph">
<p>If we further assume that <code>fp3</code> depends on feature-pack <code>fp4</code> and <code>fp2</code> and <code>fp4</code> don’t have any further dependencies. The effective package set of the distribution provisioned from <code>fp1</code> will consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the effective package set of <code>fp1</code>;</p>
</li>
<li>
<p>the effective package set of <code>fp2</code>;</p>
</li>
<li>
<p>the effective package set of <code>fp3</code>;</p>
</li>
<li>
<p>the effective package set of <code>fp4</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>fp2</code> and <code>fp3</code> are called <strong>direct</strong> dependencies of <code>fp1</code>, while <code>fp4</code> is called a <strong>transitive</strong> dependency of <code>fp1</code> and a <strong>direct</strong> dependency of <code>fp3</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customizing_the_effective_package_set_of_a_dependency"><a class="anchor" href="#_customizing_the_effective_package_set_of_a_dependency"></a><a class="link" href="#_customizing_the_effective_package_set_of_a_dependency">5.1. Customizing the effective package set of a dependency</a></h3>
<div class="paragraph">
<p>As illustrated in the example above, the effective package set of the dependency contributes to the effective package set of the distribution. The feature-pack declaring the dependency, though, is allowed to customize the effective package set of the dependency (the package set it inherits) using the already mentioned in previous chapters <code>include</code> and <code>exclude</code> XML elements in its <code>feature-pack.xml</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"&gt;
            &lt;packages&gt;
                &lt;exclude name="p1"/&gt;
                &lt;exclude name="p2"/&gt;
                &lt;include name="p3"/&gt;
                &lt;include name="p4"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
        &lt;package name="p2"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Element <code>packages</code> under <code>dependency</code> in <code>feature-pack.xml</code> has exactly the same structure as element <code>packages</code> in the provisioning XML configuration file, mentioned earlier in <a href="#_effective_package_set">the chaper describing the effective package set</a> of a feature-pack.</p>
</div>
<div class="paragraph">
<p>Now the effective package set of a distribution provisioned from <code>fp1</code> becomes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fp1</code> packages <code>p1</code> and <code>p2</code>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages (if any);</p>
</li>
</ul>
</div>
</li>
<li>
<p>the effective package set of <code>fp2</code>;</p>
<div class="ulist">
<ul>
<li>
<p>minus packages <code>p1</code> and <code>p2</code> from <code>fp2</code> and their dependencies on other packages;</p>
</li>
<li>
<p>plus packages <code>p3</code> and <code>p4</code> from <code>fp2</code> and their dependencies on other packages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
in case <code>fp2</code> in its turn depended on other feature-packs then the effective package sets of those feature-packs (possibly customized using <code>include</code>/<code>exclude</code> in the corresponding dependency declaration in the <code>feature-pack.xml</code> of <code>fp2</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_package_inheritance_from_a_dependency"><a class="anchor" href="#_disabling_package_inheritance_from_a_dependency"></a><a class="link" href="#_disabling_package_inheritance_from_a_dependency">5.2. Disabling package inheritance from a dependency</a></h3>
<div class="paragraph">
<p>The effective package set of a dependency is inherited by the feature-pack declaring the dependency. However, it is possible to declare the dependency without inheriting its effective package set and simply pick the packages explicity under <code>dependency</code> element (in other words, explicitly define the effective package set of the dependency).</p>
</div>
<div class="paragraph">
<p>Optional boolean attribute <code>inherit</code> of element <code>packages</code> controls whether package inheritance is enabled or disabled. In case the attribute is not explicitly specified, its value is assumed to be true. Here is an example of a dependency with disabled package inheritance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"&gt;
            &lt;packages inherit=”false”&gt;
                &lt;exclude name="p1"/&gt;
                &lt;exclude name="p2"/&gt;
                &lt;include name="p3"/&gt;
                &lt;include name="p4"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
        &lt;package name="p2"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the effective package set of the distribution provisioned from <code>fp1</code> becomes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fp1</code> packages <code>p1</code> and <code>p2</code>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages (if any);</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>fp2</code> packages <code>p3</code> and <code>p4</code>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages minus packages <code>p1</code> and <code>p2</code> from <code>fp2</code> and their dependencies on other packages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_merging_package_sets_of_dependencies"><a class="anchor" href="#_merging_package_sets_of_dependencies"></a><a class="link" href="#_merging_package_sets_of_dependencies">5.3. Merging package sets of dependencies</a></h3>
<div class="paragraph">
<p>Suppose feature-pack <code>fp1</code> depends on feature-packs <code>fp2</code> and <code>fp3</code>. Both <code>fp2</code> and <code>fp3</code> depend on their own custom package sets of feature-pack <code>fp4</code>. When <code>fp1</code> is installed, the effective package set of <strong>fp4</strong> will be a merge of the custom package sets of <code>fp4</code> defined in <code>fp2</code> and <code>fp3</code> as their dependencies.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"/&gt;
        &lt;dependency location="fp3@maven(org.jboss.universe:community-universe):2#2.0.0"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp2</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp4@maven(org.jboss.universe:community-universe):2#2.0.0"&gt;
            &lt;packages&gt;
                &lt;exclude name="p1"/&gt;
                &lt;exclude name="p3"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp3</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp3@maven(org.jboss.universe:community-universe):2#2.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp4@maven(org.jboss.universe:community-universe):2#2.0.0"&gt;
            &lt;packages inherit=”false”&gt;
                &lt;!-- assume fp4 also contains non-default package p4 --&gt;
                &lt;include name="p4"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp4</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp4@maven(org.jboss.universe:community-universe):2#2.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
        &lt;package name="p2"/&gt;
        &lt;package name="p3"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A distribution provisioned from <code>fp1</code> without further customizations will include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fp1:p1</code> and its dependencies;</p>
</li>
<li>
<p><code>fp2:p1</code> and its dependencies;</p>
</li>
<li>
<p><code>fp3:p1</code> and its dependencies;</p>
</li>
<li>
<p><code>fp4:p2</code>, <code>fp4:p4</code> and their dependencies.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_pack_transitive_dependencies"><a class="anchor" href="#_feature_pack_transitive_dependencies"></a><a class="link" href="#_feature_pack_transitive_dependencies">6. Feature-pack transitive dependencies</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose there is feature-pack <code>fp1</code> that depends on <code>fp2</code> and <code>fp2</code> in its turn depends on <code>fp3</code>. In this case, <code>fp2</code> is a <strong>direct</strong> dependency of <code>fp1</code> while <code>fp3</code> is a <strong>transitive</strong> dependency of <code>fp1</code> and a <strong>direct</strong> dependency of <code>fp2</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Transitive dependencies are the dependencies of the dependencies.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customizing_package_set_of_a_transitive_dependency"><a class="anchor" href="#_customizing_package_set_of_a_transitive_dependency"></a><a class="link" href="#_customizing_package_set_of_a_transitive_dependency">6.1. Customizing package set of a transitive dependency</a></h3>
<div class="paragraph">
<p>Let&#8217;s suppose we have the following two feature-packs:</p>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
     &lt;dependencies&gt;
         &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"&gt;
             &lt;packages inherit="false"&gt; <i class="conum" data-value="1"></i><b>(1)</b>
                 &lt;include name="p3"/&gt;
                 &lt;include name="p4"/&gt;
                 &lt;exclude name="p5"/&gt;
             &lt;/packages&gt;
         &lt;/dependency&gt;
     &lt;/dependencies&gt;
     &lt;default-packages&gt;
         &lt;package name="p1"/&gt;
     &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Let&#8217;s assume <code>fp2</code> also contains packages <code>p4</code>, <code>p5</code> among others.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp2</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0" &gt;
     &lt;default-packages&gt;
         &lt;package name="p1"/&gt;
         &lt;package name="p2"/&gt;
         &lt;package name="p3"/&gt;
     &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we provision a distribution from <code>fp1</code> like this</p>
</div>
<div class="listingblock xml">
<div class="title">Distribution provisioning configuration</div>
<div class="content">
<pre class="highlight"><code> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>its effective package set will include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fp1:p1</code> plus its dependencies;</p>
</li>
<li>
<p><code>p3</code> and <code>p4</code> from <code>fp2</code> plus their dependencies excluding <code>p5</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The provisioning mechanism will not install the default configuration of <code>fp2</code> but its customized version defined by <code>fp1</code>, in other words a subset of <code>fp2</code> that <code>fp1</code> needs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now if we provision our distribution as</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="highlight"><code> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"/&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>its effective package set will become:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fp1:p1</code> plus its dependencies;</p>
</li>
<li>
<p><code>p1</code>, <code>p2</code>, <code>p3</code> and <code>p4</code> from <code>fp2</code> plus their dependencies (<strong>not excluding <code>p5</code></strong>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The provisioning mechanism will install the default configuration of <code>fp2</code> plus what <code>fp1</code> needs on top of it.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>feature-pack</code> element appearing in the provisioning configuration under <code>installation</code> always points to the default configuration of the feature-pack.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now let&#8217;s suppose we want to add another package from <code>fp2</code> to our distribution but we want to start from the customized <code>fp2</code> configuration defined by <code>fp1</code>. One way of achieving that would be</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="highlight"><code> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"&gt;
         &lt;packages inherit="false"&gt;
             &lt;include name="p3"/&gt;
             &lt;include name="p4"/&gt;
             &lt;exclude name="p5"/&gt;
             &lt;include name="p6"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
         &lt;/packages&gt;
     &lt;/feature-pack&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the package we want to add to our distribution</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That works but is not very practical. We basically copied the customizations of <code>fp2</code> from <code>fp1</code> to our provisioning configuration. If the configuration was more sophisticated it wouldn&#8217;t be that easy. Here is an easier alternative:</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="highlight"><code> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;transitive&gt;
         &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe)"&gt; <i class="conum" data-value="1"></i><b>(1)</b>
             &lt;packages&gt;
                 &lt;include name="p6"/&gt;
             &lt;/packages&gt;
         &lt;/feature-pack&gt;
     &lt;/transitive&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note, although we could provide the full version of <code>fp2</code> here, we chose not to, the mechanism will resolve it to the version specified in <code>feature-pack.xml</code> of <code>fp1</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By including <code>feature-pack</code> element under <code>transitive</code> we indicate to the provisioning mechanism that the feature-pack we are about to customize appears on a dependency branch of another feature-pack installed in this configuration directly and that we want to adjust the configuration defined by the feature-pack that depends on it instead of the configuration defined in its <code>feature-pack.xml</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overriding_dependency_versions_and_resolving_conflicts"><a class="anchor" href="#_overriding_dependency_versions_and_resolving_conflicts"></a><a class="link" href="#_overriding_dependency_versions_and_resolving_conflicts">7. Overriding dependency versions and resolving conflicts</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose we have these feature-packs</p>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp2</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Feature-pack <code>fp1</code> declares a dependency on version <code>2.0.0</code> of <code>fp2</code>. Even if later backward compatible versions of <code>fp2</code> are available, provisioning a distribution from <code>fp1</code> will get <code>fp2</code> version <code>2.0.0</code> installed. If we still want to upgrade <code>fp2</code> there are two ways to do that</p>
</div>
<div class="paragraph">
<p>1) install the desired version of <code>fp2</code> directly as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe):2#2.0.1"/&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) use <code>transitive</code> element to override the version of <code>fp2</code> specified in <code>feature-pack.xml</code> of <code>fp1</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;transitive&gt;
         &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe):2#2.0.1"/&gt;
     &lt;/transitive&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantage of specifying the version in the transitive dependency is that it will override only the version of <code>fp2</code> w/o affecting its customizations (if any) applied to <code>fp2</code> by <code>fp1</code>. While installing the new version directly will install the default configuration of <code>fp2</code>.</p>
</div>
<div class="paragraph">
<p>This example has illustrated the basic version overriding rule.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Feature-pack versions that appear higher in the feature-pack dependency hierarchy (i.e. closer to the root in the provisioning configuration) override versions that appear further down in the dependency hierarchy, no matter whether they are higher or lower in comparison.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_resolving_version_conflicts"><a class="anchor" href="#_resolving_version_conflicts"></a><a class="link" href="#_resolving_version_conflicts">7.1. Resolving version conflicts</a></h3>
<div class="paragraph">
<p>It is possible to run into a version conflict when feature-packs on different dependency branches delcare dependencies on different versions of the same feature-pack. Since it happens on different branches, the version overriding rule does not apply and the provisioning mechanism cannot automatically pick the version. Here is an example</p>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp3@maven(org.jboss.universe:community-universe):1#1.2.0"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Feature-pack fp2</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp3@maven(org.jboss.universe:community-universe):1#1.3.0"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Provisioning configuration</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
     &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Provisioning of this configuration will fail with the version conflict for feature-pack <code>fp3</code>. <code>fp1</code> depends on <code>fp3</code> version <code>1.2.0</code> and <code>fp2</code> depends on <code>fp3</code> version <code>1.3.0</code>. <code>fp1</code> and <code>fp2</code> are two roots of separate dependency branches, so the version overriding rule does not apply to <code>fp3</code>.</p>
</div>
<div class="paragraph">
<p>To resolve this kind of version conflict a user cane either install <code>fp3</code> directly or specify its desired version in the <code>transitive</code> element of the <code>installation</code>. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
     &lt;transitive&gt;
         &lt;feature-pack location="fp3@maven(org.jboss.universe:community-universe):1#1.4.0"/&gt;
     &lt;/transitive&gt;
     &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
     &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0"/&gt;
 &lt;/installation&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generic_configuration_model"><a class="anchor" href="#_generic_configuration_model"></a><a class="link" href="#_generic_configuration_model">8. Generic configuration model</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to provisioning various filesystem content as packages, the mechanism also allows generation of the configuration files for the target installation taking into account the customizations applied by the user to the feature-pack defaults.</p>
</div>
<div class="paragraph">
<p>Feature-pack may include predefined configurations for the installation. They are stored in feature-pack&#8217;s <code>configs</code> directory. Every configuration is described in an XML file and in a simple (and perhaps the most common) case, every configuration will represent a specific configuration file in the provisioned installation.</p>
</div>
<div class="paragraph">
<p>Feature-pack metadata (<code>feature-pack.xml</code>) may define which of the predefined configurations should be provisioned by default by referencing them using <code>config</code> elements .</p>
</div>
<div class="paragraph">
<p>Installation configuration is described using a generic configuration model. The generic configuration model is based on an abstract schema that describes configurable units and relationships between them. The model allows a user to manipulate the confguration in a generic way by adding to and/or removing parts from it, and/or overwriting some parameter values. The responsibilities of the core provisioning mechanism with regards to the configuration are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resolve the final installation configuration model taking into account the customizations applied to the pre-defined in <code>feature-pack.xml</code> default configuration;</p>
</li>
<li>
<p>make sure the resolved configuration model is valid by:</p>
<div class="ulist">
<ul>
<li>
<p>verifying that all the required parameter values are set;</p>
</li>
<li>
<p>checking the referential integrity of the resolved configuration model (i.e. in case certain configuration units imply presence of certain other configuration units);</p>
</li>
<li>
<p>making sure that the capability requirements in the resolved configuration are satisfied;</p>
</li>
<li>
<p>and that packages required by the configuration model are included into the installation;</p>
</li>
</ul>
</div>
</li>
<li>
<p>present the units of the resolved configuration to the provisioning plugins in the order the configuration model was populated but also respecting the dependencies of those units.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The generic provisioning mechanism itself does not generate the final configuration files. As indicated above, it only resolves the effective generic configuration model for the provisioned installation and makes sure it does not violate various constraints it might have. It is the responsibility of product-specific provisioning plugins to generate the final configuration file(s) from the already resolved and validated generic configuration model.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_features"><a class="anchor" href="#_features"></a><a class="link" href="#_features">8.1. Features</a></h3>
<div class="paragraph">
<p>Minimal configurable unit of the generic configuration model is called a <strong>feature</strong>. A <strong>feature</strong> is described by a <strong>feature specification</strong> (or <strong>feature spec</strong> further in the text). A <strong>feature spec</strong> describes how a feature can be configured, while a <strong>feature</strong> is a specific configuration of a <strong>feature spec</strong>.</p>
</div>
<div class="paragraph">
<p>Feature specs are identified by their names that must be unique in the scope of the feature-pack.</p>
</div>
<div class="paragraph">
<p>A feature spec describes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the configurable parameters (including their names, default values (if any) and whether they are nillable);</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-refs">references to other feature specs</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-deps">dependencies on other features</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#caps">required capabilities</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#caps">provided capabilities</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-package-deps">dependencies on packages</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-annotations">annnotations</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Feature specs are stored in <code>spec.xml</code> files in the directories named after the feature spec names under feature-pack&#8217;s <code>features</code> directory. For example</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">features/
|-feature1/
| `-spec.xml
`-feature2/
  `-spec.xml</pre>
</div>
</div>
<div class="sect3">
<h4 id="_feature_id"><a class="anchor" href="#_feature_id"></a><a class="link" href="#_feature_id">8.1.1. Feature ID</a></h4>
<div class="paragraph">
<p>A feature may have an identifier (<strong>feature id</strong> further in the text) which is used to locate a specific feature in the configuration model. Whether a feature has an ID or not is specified in the feature spec.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A feature ID is essential to be able to customize the configuration of a specific feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Feature ID consists of a feature spec name plus one or more feature parameters. Feature parameters that are a part of the feature ID include <code>feature-id="true"</code> attribute in their descriptions (and cannot be nillable). For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="feature1"&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="b" default="bb"/&gt;
     &lt;param name="c" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if a config includes multiple features of feature spec <code>feature1</code>, they could be refered to by <strong>feature1:name=<em>unique_name</em></strong> expression, where <em>unique_name</em> is the value of parameter <code>name</code> of the target feature.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Feature ID parameters cannot change values during config customizations. If a user wants to have a different value for an ID parameter of a certain feature, the existing feature has to be excluded from the config and a new feature with the desired ID parameter value has to be added in.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example of a feature spec with multiple feature ID parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="feature2"&gt;
   &lt;params&gt;
     &lt;param name="p1" feature-id="true"/&gt;
     &lt;param name="p2" feature-id="true"/&gt;
     &lt;param name="p3" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An ID of a feature of this spec will look like <strong>feature2:p1=<em>p1_value</em>,p2=<em>p2_value</em></strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order of the ID parameters in the feature ID string is <strong>not</strong> significant.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_feature_parameters"><a class="anchor" href="#_feature_parameters"></a><a class="link" href="#_feature_parameters">8.1.2. Feature parameters</a></h4>
<div class="paragraph">
<p>Feature parameters are described in feature specs. A parameter is identified by its name (which must be unique in the scope of the feature spec) and may have the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>required string <strong>name</strong> - the name of the parameter;</p>
</li>
<li>
<p>optional boolean <strong>feature-id</strong> - indicating whether the parameter is a part of the feature ID (if not present, the default is assumed to be <strong>false</strong>);</p>
</li>
<li>
<p>optional boolean <strong>nillable</strong> - indicating whether the parameter allows null as the value in the resolved config (if not present, the default is assumed to be <strong>false</strong>);</p>
</li>
<li>
<p>optional string <strong>default</strong> - indicates which value should be used for the parameter, if the parameter was not explicitly initialized in the configuration (if not present, the default is assumed to be <strong>null</strong>);</p>
</li>
<li>
<p>optional string <strong>type</strong> - type of the parameter (if not present, the default is assumed to be <strong>String</strong>).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="feature1"&gt;
   &lt;params&gt;
     &lt;param name="a" feature-id="true"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
     &lt;param name="b" default="bb"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
     &lt;param name="c" nillable="true"/&gt; <i class="conum" data-value="3"></i><b>(3)</b>
     &lt;param name="d"/&gt; <i class="conum" data-value="4"></i><b>(4)</b>
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>feature ID parameter, cannot be null and must be explicitly initialized in the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>parameter will be initialized to <em>bb</em> unless explicitly set to a different value by the user;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>has no default and may be left uninitialized in the configuration;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>parameter must be explicitly initialized by the user.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_features_in_configuration"><a class="anchor" href="#_features_in_configuration"></a><a class="link" href="#_features_in_configuration">8.1.3. Features in configuration</a></h4>
<div class="paragraph">
<p>Here is an example of how features can be used in a configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
   &lt;config name="main"&gt;
     &lt;feature spec="feature1"&gt;
       &lt;param name="a" value="a1"/&gt;
       &lt;param name="b" value="b1"/&gt;
       &lt;param name="d" value="d1"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="feature1"&gt;
       &lt;param name="a" value="a2"/&gt;
       &lt;param name="d" value="d2"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="feature1"&gt;
       &lt;param name="a" value="a3"/&gt;
       &lt;param name="c" value="c3"/&gt;
       &lt;param name="d" value="d3"/&gt;
     &lt;/feature&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>config</code> element describes the default configuration which will be generated when <code>fp1</code> is installed (unless it is explicitly customized by the user), which includes three features of the same spec. When the final configuration is generated, the features will be processed in the order they appear in the <code>config</code> element.</p>
</div>
</div>
<div class="sect3">
<h4 id="_feature_references"><a class="anchor" href="#_feature_references"></a><a class="link" href="#_feature_references">8.1.4. Feature references</a></h4>
<div class="paragraph">
<p><a id="feature-refs"></a>There are cases when a value range of a parameter of one feature spec is defined by a set of existing in the configuration model values of an ID parameter of another feature spec. In other words, a feature spec may declare certain parameters as references to ID parameters of another feature spec. (In a relational database, this would be a foreign key reference).</p>
</div>
<div class="paragraph">
<p>In a feature spec a simple feature reference would look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attribute <code>feature</code> of element <code>ref</code> contains the name of the referenced feature-spec. Note that we have not provided which parameter of <code>featureC</code> references the ID parameter of <code>featureP</code>. This example also demonstrates the <strong>default (implicit) reference parameter mapping</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The default reference parameter mapping rule is based on the expectation that the feature spec declaring the reference includes parameters with the names matching the ID parameter names of the referenced feature spec.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So the example above will work if one of the following statements is true:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>featureP</code> declares parameter <code>p</code> and it is its only feature-id parameter;</p>
</li>
<li>
<p><code>featureP</code> declares parameter <code>name</code> and it is its only feature-id parameter;</p>
</li>
<li>
<p><code>featureP</code> declares parameters <code>name</code> and <code>p</code> as its feature-id parameters and has not other feature-id parameters.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. The complete set of a feature reference declaration attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dependency</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null (current feature-pack or its dependencies)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The feature-pack dependency name the referenced feature spec belongs to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>feature</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the referenced feature spec.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the <strong>feature</strong> attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique feature reference name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>nillable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether a reference is nillable or not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>include</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the referenced feature should automatically be included into the config model if it was not explicitly configured.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_non_default_reference_parameter_mapping"><a class="anchor" href="#_non_default_reference_parameter_mapping"></a><a class="link" href="#_non_default_reference_parameter_mapping">Non-default reference parameter mapping</a></h5>
<div class="paragraph">
<p>Instead of relying on the default reference parameter mapping rule, it is also possible to map the parameters in the reference declaration explicitly. The example below will correspond to the statement 1. from the example above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"&gt;
       &lt;param name="p" maps-to="p"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s suppose that <code>featureP</code> ID parameter is in fact <code>name</code> but we still want to use parameter <code>p</code> as the reference to <code>featureP</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"&gt;
       &lt;param name="p" maps-to="name"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>featureP</code> had more than one ID parameter, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="id1" feature-id="true"/&gt;
     &lt;param name="id2" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the reference parameter mapping in <code>featureC</code> could look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"&gt;
       &lt;param name="p1" maps-to="id1"/&gt;
       &lt;param name="p2" maps-to="id2"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1"/&gt;
     &lt;param name="p2"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_nillable_feature_references"><a class="anchor" href="#_nillable_feature_references"></a><a class="link" href="#_nillable_feature_references">Nillable feature references</a></h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Feature reference resolves to null if one of the feature reference parameters is null.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If a reference resolves to null and its not marked as nillable in the feature spec, the provisioning will fail with an error. Here is an example of a nillable reference declaration:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP" nillable="true"&gt;
       &lt;param name="p1" maps-to="id1"/&gt;
       &lt;param name="p2" maps-to="id2"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1" nillable="true"/&gt;
     &lt;param name="p2"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_external_feature_references"><a class="anchor" href="#_external_feature_references"></a><a class="link" href="#_external_feature_references">External feature references</a></h5>
<div class="paragraph">
<p>A feature may reference a feature from another feature-pack. The other feature-pack must be a (direct or transitive) dependency of the feature-pack the referencing feature belongs to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unless the feature-pack of the referenced feature has not been explicitly specified, the mechanism will navigate the dependency tree of the feature-pack of the referencing feature and the first feature-pack containing a feature spec with the referenced feature spec name will be selected as the target.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otherwise, the target feature-pack can be specified using <code>dependency</code> attribute of the feature reference declaration. The value of <code>dependency</code> attribute must match the value of <code>origin</code> element of the feature-pack dependency (the referenced feature spec belongs to) declaration in the <code>feature-pack.xml</code> file of the referencing feature spec.</p>
</div>
<div class="paragraph">
<p>For example, suppose, feature-pack <code>fp1</code> depends on feature-pack <code>fp2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
    &lt;dependencies&gt;
        &lt;dependency location="fp2@maven(org.jboss.universe:community-universe):2#2.0.0"&gt;
            &lt;origin&gt;fp2-dep&lt;/origin&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fp2</code> includes feature spec <code>featureP</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="p" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And <code>fp1</code> includes feature spec <code>featureC</code> which declares a reference to <code>featureP</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref dependency="fp2-dep" feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is expected that in most cases <code>dependency</code> attribute of element <code>ref</code> will not have to be used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_implicit_feature_reference_parameter_initialization"><a class="anchor" href="#_implicit_feature_reference_parameter_initialization"></a><a class="link" href="#_implicit_feature_reference_parameter_initialization">Implicit feature reference parameter initialization</a></h5>
<div class="paragraph">
<p><a id="feature-fk-init"></a>Let&#8217;s suppose we have a parent-child relationship between two feature specs, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="parentId" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="childId" feature-id="true"/&gt;
     &lt;param name="parentId"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we were to add features of these specs to a config, it could look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;config name="main"&gt;
   &lt;feature spec="featureP"&gt;
     &lt;param name="parentId" value="parent1"/&gt;
   &lt;/feature&gt;
   &lt;feature spec="featureC"&gt;
     &lt;param name="childId" value="child1"/&gt;
     &lt;param name="parentId" value="parent1"/&gt;
   &lt;/feature&gt;
 &lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is very verbose, the value for <code>parentId</code> parameter is set on every feature. There is a more compact way of expressing the same configuration using nesting, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;config name="main"&gt;
   &lt;feature spec="featureP"&gt;
     &lt;param name="parentId" value="parent1"/&gt;
     &lt;feature spec="featureC"&gt;
       &lt;param name="childId" value="child1"/&gt;
     &lt;/feature&gt;
   &lt;/feature&gt;
 &lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>parentId</code> parameter is initialized only once for the parent feature. <code>parentId</code> of the child feature will be implicitly initialized to the value of <code>parentId</code> of the parent.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a feature is nested, the tool will look in the feature spec of the nested feature for a reference declaration with the name matching the outer feature spec and, if it is found, the tool will resolve the reference parameter mappings and will initialize the parameters of the child feature referencing the parent.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case the reference name is different from the referenced feature spec name, i.e. it was explicitly set in the reference spec, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP" name="parent"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="childId" feature-id="true"/&gt;
     &lt;param name="parentId"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the name of the reference has to be explicitly specified when the child feature is nested using the <code>parent-ref</code> attribute, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;config name="main"&gt;
   &lt;feature spec="featureP"&gt;
     &lt;param name="parentId" value="parent1"/&gt;
     &lt;feature spec="featureC" parent-ref="parent"&gt;
       &lt;param name="childId" value="child1"/&gt;
     &lt;/feature&gt;
   &lt;/feature&gt;
 &lt;/config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
it is also possible to <a href="#fg-in-features">include a feature-group as a child of the feature</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_implicit_inclusion_of_referenced_features_into_the_configuration"><a class="anchor" href="#_implicit_inclusion_of_referenced_features_into_the_configuration"></a><a class="link" href="#_implicit_inclusion_of_referenced_features_into_the_configuration">Implicit inclusion of referenced features into the configuration</a></h5>
<div class="paragraph">
<p>It is possible to configure feature references so that when the resolved referenced feature ID is not found in the configuration model, instead of failing with the referential integrity constraint error, implicitly include the referenced feature into the configuration model initializing it with its default values. This is done by simply setting <code>include</code> attribute of the feature reference declaration to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref dependency="fp2-dep" feature="featureP" include="true"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_references_to_the_same_feature_spec"><a class="anchor" href="#_multiple_references_to_the_same_feature_spec"></a><a class="link" href="#_multiple_references_to_the_same_feature_spec">Multiple references to the same feature spec</a></h5>
<div class="paragraph">
<p>Suppose a feature needs to declare more than one reference to the same feature spec. For example let&#8217;s model a chain using a feature spec called <code>link</code>. <code>link</code> must have an ID parameter, let&#8217;s call it <code>id</code>. Then it has to include a parameter to reference the previous link and another parameter to reference the next link in the chain. The following, although looking right from the parameter mapping perspective, will clearly not work</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="link"&gt;
   &lt;refs&gt;
     &lt;ref feature="link"&gt;
       &lt;param name="prev-id" maps-to="id"/&gt;
     &lt;/ref&gt;
     &lt;ref feature="link"&gt;
       &lt;param name="next-id" maps-to="id"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
     &lt;param name="prev-id" nillable="true"/&gt;
     &lt;param name="next-id" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Feature references must have a unique name. In this case, both reference names are set to <strong>link</strong> and the provisioning tool will fail to process this spec. To workaround the error explicit names have to be assigned to the reference declarations, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="link"&gt;
   &lt;refs&gt;
     &lt;ref name="prev" feature="link"&gt;
       &lt;param name="prev-id" maps-to="id"/&gt;
     &lt;/ref&gt;
     &lt;ref name="next" feature="link"&gt;
       &lt;param name="next-id" maps-to="id"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
     &lt;param name="prev-id" nillable="true"/&gt;
     &lt;param name="next-id" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_processing_of_features_with_references"><a class="anchor" href="#_processing_of_features_with_references"></a><a class="link" href="#_processing_of_features_with_references">Processing of features with references</a></h5>
<div class="paragraph">
<p>One of the responsibilities of the provisioning tool is to order the features from the resolved configuration model for processing by the provisioning plugins that generate the final installation configuration files. While the general rule is to preserve the order in which the features where added to the configuration model, when feature <code>A</code> references feature <code>B</code>, feature <code>B</code> will get the priority and will be processed by the provisioning plugins before feature <code>A</code> to not break the referential integrity of the generated model (if it is significant for the consuming plugin).</p>
</div>
</div>
<div class="sect4">
<h5 id="_circular_feature_references"><a class="anchor" href="#_circular_feature_references"></a><a class="link" href="#_circular_feature_references">Circular feature references</a></h5>
<div class="paragraph">
<p>The provisioning mechanism is capable of identifying circular references (circular reference graphs). It does not throw an error if a circular reference graphs is detected. The responsibility of the provisioning mechanism is to make sure the configuration model is valid and all the referential integrity constraints are satisfied. From this point of view circular references are not illegal.</p>
</div>
<div class="paragraph">
<p>The issue with circular references is the ordering of the features when configuration model is processed by the product specific plugins that generate the final configuration files. In some cases the order of the features will not be significant but in some cases it will be. So the rule is</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a circular reference graph is identified, the feature that was added to the configuration model first will be processed by the provisioning plugins first, the rest of the features from the graph will be processed respecting the references as usual.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_feature_dependencies"><a class="anchor" href="#_feature_dependencies"></a><a class="link" href="#_feature_dependencies">8.1.5. Feature dependencies</a></h4>
<div class="paragraph">
<p><a id="feature-deps"></a>While references are a kind of dependencies, they require parameters in the spec of the feature declaring the reference to identify the target. Unlike references, feature dependencies do not use parameters to specify the target. Instead the dependency is declared by specifying the ID of the target feature directly.</p>
</div>
<div class="sect4">
<h5 id="_feature_spec_dependencies"><a class="anchor" href="#_feature_spec_dependencies"></a><a class="link" href="#_feature_spec_dependencies">Feature spec dependencies</a></h5>
<div class="paragraph">
<p>Feature dependencies can be declared in the feature spec and/or on the feature itself. Here is an example of a dependency declaration in the feature spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature2:id=123"/&gt;
   &lt;/deps&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now all the features of spec <code>feature1</code> will depend on the feature with ID <code>feature2:id=123</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_feature_config_dependencies"><a class="anchor" href="#_feature_config_dependencies"></a><a class="link" href="#_feature_config_dependencies">Feature config dependencies</a></h5>
<div class="paragraph">
<p>And here is how a feature dependency can be declared on a specific feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature spec="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature3:id=789"/&gt;
   &lt;/deps&gt;
   &lt;param name="name" value="abc"/&gt;
 &lt;/feature&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now feature <code>feature1:name=abc</code> depends on feature <code>feature2:id=123</code> (inherited dependency from the spec) and feature <code>feature3:id=789</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_external_feature_dependencies"><a class="anchor" href="#_external_feature_dependencies"></a><a class="link" href="#_external_feature_dependencies">External feature dependencies</a></h5>
<div class="paragraph">
<p>It is allowed to delcalre dependencies on features that come from other feature-packs. If the specs of those features come from feature-packs that appear to be dependencies of the feature-pack the feature dependencies are configured in then those feature specs will most probably be located by the mechanism automatically (by navigating the feature-pack dependency tree). The mechanism might need some help resolving the specs of the dependencies only if they belong to a feature-pack that doesn&#8217;t appear to be a dependency of the feature-pack where the dependencies are defined or if there are multiple feature specs with the same name in the feature-pack dependency hierarchy and it&#8217;s not obvious which one is targeted by the dependency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the feature spec resolution mechanism will pick the first feature spec with the matching name met while navigating the feature-pack dependency tree.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is a way though to specify the origin of the feature spec used in the dependency. If <code>feature3</code> spec was from another feature-pack than <code>feature1</code> spec then to be precise we could have added the origin of <code>feature3</code> spec to the dependency declaration. Assuming that the feature-pack <code>feature1</code> spec belongs to declared a dependecy named <code>fp2</code> on the feature-pack <code>feature3</code> spec belongs to, the dependency declaration would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature spec="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature3:id=789" dependency="fp2"/&gt;
   &lt;/deps&gt;
   &lt;param name="name" value="abc"/&gt;
 &lt;/feature&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_implicit_inclusion_of_feature_dependencies"><a class="anchor" href="#_implicit_inclusion_of_feature_dependencies"></a><a class="link" href="#_implicit_inclusion_of_feature_dependencies">Implicit inclusion of feature dependencies</a></h5>
<div class="paragraph">
<p>Like references, dependencies also support <code>include</code> attribute. If the dependency is declared with <code>include=true</code>, the target of the dependency will implicitly be included into the configuration unless it is already present. Here is an example of an implicitly included feature dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature spec="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature3:id=789" include="true"/&gt;
   &lt;/deps&gt;
   &lt;param name="name" value="abc"/&gt;
 &lt;/feature&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_feature_capabilities"><a class="anchor" href="#_feature_capabilities"></a><a class="link" href="#_feature_capabilities">8.1.6. Feature capabilities</a></h4>
<div class="paragraph">
<p><a id="caps"></a>In the actual provisioned installation, the components that are represented as features in the configuration model may provide certain runtime capabilities that other components, also represented as features in the configuration model, may depend upon. There are two reasons why this <strong>may</strong> be important when resolving the configuration model for the installation to be provisioned:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>to make sure the configuration is consistent in a sense that the runtime requirements of its components are satisfied;</p>
</li>
<li>
<p>to order the features in the configuration model for processing by the provisioning plugins based on their dependencies and runtime requirements.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Capabilities are represented as strings with a dot serving as a word separator. Here is an example of a feature spec providing a capability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="interface" xmlns="urn:jboss:galleon:feature-spec:1.0"&gt;
   &lt;provides&gt;
     &lt;capability name="org.wildfly.network.interface"/&gt;
   &lt;/provides&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="inet-address"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is a feature spec that requires the capability provided above</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="socket-binding" xmlns="urn:jboss:galleon:feature-spec:1.0"&gt;
   &lt;requires&gt;
     &lt;capability name="org.wildfly.network.interface"/&gt;
   &lt;/requires&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="port"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the examples above the capabilities were configured using constant values. This type of a capability is called a <strong>static capability</strong>. As a consequence, all the features of spec <code>interface</code> will provide the same capability <code>org.wildfly.network.interface</code>. And all the features of spec <code>socket-binding</code> will require the same capabality <code>org.wildfly.network.interface</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_dynamic_capabilities"><a class="anchor" href="#_dynamic_capabilities"></a><a class="link" href="#_dynamic_capabilities">Dynamic capabilities</a></h5>
<div class="paragraph">
<p>It is also possible, however, to provide and/or require a capability that depends on the parameters of a specific feature. Dynamic capabilities are following the same dot-separated string format but include feature parameter names prefixed with <code>$</code> character. The examples above could be enhanced with dynamic capabilities as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="interface" xmlns="urn:jboss:galleon:feature-spec:1.0"&gt;
   &lt;provides&gt;
     &lt;capability name="org.wildfly.network.interface.$name"/&gt;
   &lt;/provides&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="inet-address" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="socket-binding" xmlns="urn:jboss:galleon:feature-spec:1.0"&gt;
   &lt;requires&gt;
     &lt;capability name="org.wildfly.network.interface.$interface"/&gt;
   &lt;/requires&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="interface"/&gt;
     &lt;param name="port" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see how it will look like in an actual configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
   &lt;config name="main"&gt;
     &lt;feature spec="interface"&gt;
       &lt;param name="name" value="public"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="interface"&gt;
       &lt;param name="name" value="secure"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="socket-binding"&gt;
       &lt;param name="name" value="http"/&gt;
       &lt;param name="interface" value="public"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="socket-binding"&gt;
       &lt;param name="name" value="https"/&gt;
       &lt;param name="interface" value="secure"/&gt;
     &lt;/feature&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above feature <code>interface:name=public</code> provides capability <code>org.wildfly.network.interface.public</code> which is required by feature <code>socket-binding:name=http</code>. And feature <code>interface:name=secure</code> provides capability <code>org.wildfly.network.interface.secure</code> which is required by feature <code>socket-binding:name=https</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
More than one parameter could be used in a capability name. The parameters may appear in any part of the name, not necessarily at the end as in the example. The only rule is to use dot as a separator for the parameters and the static parts of the name.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_optional_capabilities"><a class="anchor" href="#_optional_capabilities"></a><a class="link" href="#_optional_capabilities">Optional capabilities</a></h6>
<div class="paragraph">
<p>In the example above, parameter <code>interface</code> in both feature specs is not nillable, which means the capability will always be provided by <code>interface</code> and always be required <code>socket-binding</code>. There could be cases though, when a parameter referenced from the capability name is nillable. In fact, if the parameter is null, the capability name will fail to resolve and provisioning will fail. However, dynamic capabilities can be marked as optional. Optional dynamic capability will be provided (or required) only if its name could be resolved (i.e. all the parameters referenced were not null). Here is the example illustrating optional capabilities in a feature spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="specA" xmlns="urn:jboss:galleon:feature-spec:1.0"&gt;
   &lt;provides&gt;
     &lt;capability name="$b" optional="true"/&gt;
   &lt;/provides&gt;
   &lt;requires&gt;
     &lt;capability name="$c" optional="true"/&gt;
   &lt;/requires&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
     &lt;param name="b" nillable="true"/&gt;
     &lt;param name="c" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_feature_package_dependencies"><a class="anchor" href="#_feature_package_dependencies"></a><a class="link" href="#_feature_package_dependencies">8.1.7. Feature package dependencies</a></h4>
<div class="paragraph">
<p><a id="feature-package-deps"></a>Feature specs representing configurable components of the installation may include dependencies on feature-pack packages that contain certain binary content (e.g. JAR files) of those installation components. So that, when a feature is included into configuration, the packages the feature will require at runtime will automatically be added to the list of the installed packages.</p>
</div>
<div class="paragraph">
<p>Package dependencies are configured under <code>packages</code> element of the feature spec which is equivalent to the <a href="#package-deps"><code>dependencies</code> element of the package spec metadata</a>. Here is an example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="feature1" xmlns="urn:jboss:galleon:feature-spec:1.0"&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
   &lt;/params&gt;
   &lt;packages&gt;
     &lt;package name="p1"/&gt;
     &lt;package name="p2" optional="true"/&gt;
     &lt;origin name="another-feature-pack"&gt;
       &lt;package name="p2"/&gt;
       &lt;package name="p3" optional="true"/&gt;
     &lt;/origin&gt;
   &lt;/packages&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, any feature of spec <code>feature1</code> will have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a required dependency on package <code>p1</code>;</p>
</li>
<li>
<p>an optional dependency on package <code>p2</code>;</p>
</li>
<li>
<p>a required dependency on package <code>p2</code> from the feature-pack dependency refered to as <code>another-feature-pack</code>;</p>
</li>
<li>
<p>an optional dependency on package <code>p3</code> from the feature-pack dependency refered to as <code>another-feature-pack</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_feature_annotations"><a class="anchor" href="#_feature_annotations"></a><a class="link" href="#_feature_annotations">8.1.8. Feature annotations</a></h4>
<div class="paragraph">
<p><a id="feature-annotations"></a>Feature specs may include a list of annotations. The provisioning mechanism includes a few pre-defined annotations. Product-specific annotations are also supported, they are simply parsed and attached to feature specs and are available to the provisioning plugins for processing. Here is an example of an annotated feature spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="feature1"&gt;
   &lt;annotation name="name1"&gt;
     &lt;elem name="elem1" value="value1"/&gt;
   &lt;/annotation&gt;
   &lt;annotation name="name2"&gt;
     &lt;elem name="elem1" value="value1"/&gt;
     &lt;elem name="elem1" value="value1"/&gt;
   &lt;/annotation&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_feature_groups"><a class="anchor" href="#_feature_groups"></a><a class="link" href="#_feature_groups">8.2. Feature groups</a></h3>
<div class="paragraph">
<p>A feature spec represents a minimal configuration unit. When a configuration model reaches a certain level of complexity though, using and manipulating features to define the final configuration may become impractical.
Feature groups allow to group a set of features that represent a certain part of the configuration together and then include them all into the final configuration as a group. For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;
   &lt;feature spec="feature1"&gt;
     &lt;param name="id" value="a1"/&gt;
     &lt;feature spec="feature2"&gt;
       &lt;param name="id" value="b1"/&gt;
     &lt;/feature&gt;
   &lt;/feature&gt;
   &lt;feature spec="feature3"&gt;
     &lt;param name="id" value="c1"/&gt;
   &lt;/feature&gt;
 &lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
   &lt;config name="main"&gt;
     &lt;feature-group name="group1"/&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, we defined a feature group named <code>group1</code> which includes three features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of the group must be unique in the scope of the feature-pack.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Feature groups are saved in the feature-pack&#8217;s <code>feature_groups</code> directory in XML files named after the feature groups (<code>group1.xml</code> in this example).</p>
</div>
<div class="paragraph">
<p>Then in the default configuration of the feature-pack we simply included <code>group1</code>, which is equivalent to including the mentioned three features into the config directly.</p>
</div>
<div class="paragraph">
<p>Besides features, feature groups may also include other feature groups. Continuing the example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-group-spec name="group2" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;
   &lt;feature-group name="group1"/&gt;
   &lt;feature spec="feature4"&gt;
     &lt;param name="id" value="d1"/&gt;
   &lt;/feature&gt;
 &lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:1.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;
   &lt;config name="main"&gt;
     &lt;feature-group name="group2"/&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final configuration will now include all the four features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order of the features in the resolved configuration will reflect the order in which the features were included into the configuration but also respecting the feature references and the dependencies, i.e.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>feature1:id=a1</code></p>
</li>
<li>
<p><code>feature2:id=b1</code></p>
</li>
<li>
<p><code>feature3:id=c1</code></p>
</li>
<li>
<p><code>feature4:id=d1</code></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_including_customized_feature_groups"><a class="anchor" href="#_including_customized_feature_groups"></a><a class="link" href="#_including_customized_feature_groups">8.2.1. Including customized feature groups</a></h4>
<div class="paragraph">
<p>When a feature group is included (into another feature group or a <code>config</code> element of a feature-pack configuration) the set of its features can be customized. There are two main kinds of customizations that are allowed when including a feature group:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#feature-param-overwrites">the configuration of the features included into the group can be overwritten</a>;</p>
</li>
<li>
<p>certain features can be excluded from the group by</p>
<div class="ulist">
<ul>
<li>
<p><a href="#fg-exclude-features-by-ids">specifying the feature IDs</a>;</p>
</li>
<li>
<p><a href="#fg-exclude-features-by-specs">specifying the specs features of which have to be excluded</a>;</p>
</li>
<li>
<p><a href="#fg-include-features-by-ids">explicitly choosing which features should be included by specifying their feature IDs</a>;</p>
</li>
<li>
<p><a href="#fg-include-features-by-specs">explicitly choosing features of which feature specs should be included</a>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a feature group is included into another feature group or a <code>config</code> element, the list of its direct entries (features and feature groups) defined by the feature group spec cannot be extended by applying customizations. <a href="#fg-indirect-ext">There is a way though to extend the feature set of the included feature group indirectly</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All the feature group customizations are expressed in the body of <code>feature-group</code> XML element.</p>
</div>
<div class="sect4">
<h5 id="_overwriting_parameters_of_features_from_a_feature_group"><a class="anchor" href="#_overwriting_parameters_of_features_from_a_feature_group"></a><a class="link" href="#_overwriting_parameters_of_features_from_a_feature_group">Overwriting parameters of features from a feature group</a></h5>
<div class="paragraph">
<p><a id="feature-param-overwrites"></a>The configuration of a feature can be customized by adding <code>include</code> element with <code>feature-id</code> attribute targeting its ID to the body of the <code>feature-group</code> element. E.g. suppose this is our feature spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="feature1"&gt;
  &lt;params&gt;
    &lt;param name="a" feature-id="true"/&gt;
    &lt;param name="b" default="bb"/&gt;
    &lt;param name="c" nillable="true"/&gt;
    &lt;param name="d"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is our feature group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="a" value="a1"/&gt;
    &lt;param name="c" value="group1"/&gt;
    &lt;param name="d" value="group1"/&gt;
  &lt;/feature&gt;
&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this is our config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="feature1:a=a1"&gt;
      &lt;param name="d" value="config"/&gt;
    &lt;/include&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration will consist of one feature with the following configuration</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
<th class="tableblock halign-left valign-top">d</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s now suppose that we have two feature specs with a parent-child relationship</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureP"&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
  &lt;refs&gt;
    &lt;ref feature="featureP"&gt;
  &lt;/refs&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
    &lt;param name="child" feature-id="true"/&gt;
    &lt;param name="a"/&gt;
    &lt;param name="b"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The group is defined as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p1"/&gt;
    &lt;feature spec="featureC"&gt;
      &lt;param name="child" value="c1"/&gt;
      &lt;param name="a" value="group1"/&gt;
      &lt;param name="b" value="group1"/&gt;
    &lt;/feature&gt;
  &lt;/feature&gt;
&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we want to customize the child feature when including <code>group1</code> into the config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureC:parent=p1,child=c1"&gt;
      &lt;param name="b" value="config"/&gt;
    &lt;/include&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration will contain two features:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">parent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">child</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_excluding_features_from_a_group_by_ids"><a class="anchor" href="#_excluding_features_from_a_group_by_ids"></a><a class="link" href="#_excluding_features_from_a_group_by_ids">Excluding features from a group by IDs</a></h5>
<div class="paragraph">
<p><a id="fg-exclude-features-by-ids"></a>When a feature group is included into another group or a config, certain features can be excluded from the included feature set by simply specifying their IDs.</p>
</div>
<div class="paragraph">
<p>Suppose, we have defined the following group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how <code>feature1:id=a1</code> and <code>feature2:id=b1</code> can be excluded when <code>group1</code> is added a configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1"&gt;
    &lt;exclude feature-id="feature1:id=a1"/&gt;
    &lt;exclude feature-id="feature2:id=b1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The config will include <code>feature1:id=a2</code> and <code>feature2:id=b2</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_excluding_features_from_a_group_by_specs"><a class="anchor" href="#_excluding_features_from_a_group_by_specs"></a><a class="link" href="#_excluding_features_from_a_group_by_specs">Excluding features from a group by specs</a></h5>
<div class="paragraph">
<p><a id="fg-exclude-features-by-specs"></a>When a feature group is included into another group or a config, all the features of a specific feature spec can be excluded from the included feature set by simply specifying the feature spec.</p>
</div>
<div class="paragraph">
<p>Suppose, we have the following group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how all the feature of spec <code>feature1</code> can be excluded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1"&gt;
    &lt;exclude spec="feature1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The config will include <code>feature2:id=b1</code> and <code>feature2:id=b2</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_picking_features_from_a_group_by_ids"><a class="anchor" href="#_picking_features_from_a_group_by_ids"></a><a class="link" href="#_picking_features_from_a_group_by_ids">Picking features from a group by IDs</a></h5>
<div class="paragraph">
<p><a id="fg-include-features-by-ids"></a>When a feature group is included into another feature group or a config, by default all the features it contains are included into the configuration. It is possible though to pick which ones exactly should be included.</p>
</div>
<div class="paragraph">
<p>Suppose, we have the following group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how <code>feature1:id=a1</code> and <code>feature2:id=b1</code> can be picked into the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1" inherit-features="false"&gt;
    &lt;include feature-id="feature1:id=a1"/&gt;
    &lt;include feature-id="feature2:id=b1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>inherit-features</code> attribute indicates whether the whole feature set of the group should be included into the config or not. If this attribute is not specified, its value is assumed to be <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then <code>include</code> elements are picking the features that need to be included into the configuration.</p>
</div>
<div class="paragraph">
<p>The config will include <code>feature1:id=a1</code> and <code>feature2:id=b1</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>include</code> elements can also be used to pick features from the excluded feature specs. The config below is equivalent to the config above.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1" inherit-features="true"&gt;
    &lt;exclude spec="feature1"/&gt;
    &lt;exclude spec="feature2"/&gt;
    &lt;include feature-id="feature1:id=a1"/&gt;
    &lt;include feature-id="feature2:id=b1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_including_features_of_specific_feature_specs_from_a_group"><a class="anchor" href="#_including_features_of_specific_feature_specs_from_a_group"></a><a class="link" href="#_including_features_of_specific_feature_specs_from_a_group">Including features of specific feature specs from a group</a></h5>
<div class="paragraph">
<p><a id="fg-include-features-by-specs"></a>When a feature group is included into another group or a config, by default all the features it contains are added to the configuration. There is a way though to pick features of which feature specs should be included.</p>
</div>
<div class="paragraph">
<p>Suppose, we have the following group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how all the features of spec <code>feature1</code> can be included into the config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1" inherit-features="false"&gt;
    &lt;include spec="feature1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>inherit-features</code> attribute indicates whether the whole feature set of the group should be included into the config or not. If this attribute is not specified, its value is assumed to be <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then <code>include</code> element is specifying the feature spec features of which should be included into the config.</p>
</div>
<div class="paragraph">
<p>The config will include <code>feature1:id=a1</code> and <code>feature1:id=a2</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>&lt;exclude feature-id="xxx"/&gt;</code> elements can be used to exclude certain features from the feature set of the included feature spec.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_extending_feature_groups_by_including_features_indirectly"><a class="anchor" href="#_extending_feature_groups_by_including_features_indirectly"></a><a class="link" href="#_extending_feature_groups_by_including_features_indirectly">Extending feature groups by including features indirectly</a></h5>
<div class="paragraph">
<p><a id="fg-indirect-ext"></a>While the list of the feature group spec enrties (features and feature groups) is fixed and cannot be extended, new features and feature groups can be added as children of the features that have already been included into the feature group.
Let&#8217;s edit the example from the previous paragraph to demonstrate that. The feature specs will remain the same.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureP"&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureC"&gt;
  &lt;refs&gt;
    &lt;ref feature="featureP"&gt;
  &lt;/refs&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
    &lt;param name="child" feature-id="true"/&gt;
    &lt;param name="a"/&gt;
    &lt;param name="b"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The group definition will now include only parent feature</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p1"/&gt;
  &lt;/feature&gt;
&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now we will include the child feature as a configuration customization of the parent feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureP:parent=p1"&gt;
      &lt;feature spec="featureC"&gt;
        &lt;param name="child" value="c1"/&gt;
        &lt;param name="a" value="config"/&gt;
        &lt;param name="b" value="config"/&gt;
      &lt;/feature&gt;
    &lt;/include&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration will contain both features:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">parent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">parent</th>
<th class="tableblock halign-left valign-top">child</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_including_features_and_feature_groups_from_other_feature_packs"><a class="anchor" href="#_including_features_and_feature_groups_from_other_feature_packs"></a><a class="link" href="#_including_features_and_feature_groups_from_other_feature_packs">8.2.2. Including features and feature groups from other feature-packs</a></h4>
<div class="paragraph">
<p>Feature groups, as well as <code>config</code> elements in <code>feature-pack.xml</code>, may include features and feature groups from other feature-packs. If those feature-packs appear to be dependencies (direct or transitive) of the feature-pack that uses their feature specs and groups in its configuration, the mechanism will most probably be able to resolve the origins of those feature specs and groups by navigating the feature-pack dependency tree.</p>
</div>
<div class="paragraph">
<p>However, if there are multiple feature specs or feature groups with the same name in the feature-pack dependency hierarchy, it may become confusing which feature spec or feature group was meant as the target. In this case, the origin of those feature specs and feature groups can be specified with element <code>origin</code> and its attribute 'name' referencing the corresponding feature-pack dependency declared in the <code>feature-pack.xml</code>. For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;

  &lt;origin name="another-feature-pack"&gt;
    &lt;feature-group name="group2"/&gt;
    &lt;feature spec="feature2"&gt;
      &lt;param name="id" value="b1"/&gt;
    &lt;/feature&gt;
  &lt;/origin&gt;

  &lt;feature-group name="group3"/&gt;

  &lt;origin name="another-feature-pack"&gt;
    &lt;feature-group name="group3"/&gt;
  &lt;/origin&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the order of the features in the resolved feature group will be</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>feature1:id=a1</code> from the local feature-pack;</p>
</li>
<li>
<p>features from <code>group2</code> from <code>another-feature-pack</code>;</p>
</li>
<li>
<p><code>feature2:id=b1</code> from <code>another-feature-pack</code>;</p>
</li>
<li>
<p>features from <code>group3</code> from the local feature-pack;</p>
</li>
<li>
<p>features from <code>group3</code> from <code>another-feature-pack</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_nesting_feature_groups_under_features"><a class="anchor" href="#_nesting_feature_groups_under_features"></a><a class="link" href="#_nesting_feature_groups_under_features">8.2.3. Nesting feature groups under features</a></h4>
<div class="paragraph">
<p>It was mentioned in an earlier chapter that a <a href="#feature-fk-init">feature may nest other features that reference it</a>. <a id="fg-in-features"></a>It is also possible to nest a feature group under a feature with the condition that all the features included directly into the definition of the feature group reference the same parent feature.</p>
</div>
<div class="paragraph">
<p>For example, suppose we have a parent feature spec <code>featureP</code> and child feature specs <code>featureA</code> and <code>featureB</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="parent" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureA"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="parent" feature-id="true"/&gt;
     &lt;param name="a" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureB"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="parent" feature-id="true"/&gt;
     &lt;param name="b" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s suppose that there is a group which includes features of <code>featureA</code> and <code>featureB</code> specs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature spec="featureA"&gt;
    &lt;param name="a" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureB"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This group can be nested under any instance of <code>featureP</code> and parameter <code>parent</code> of the features in the group will implicitly be initialized to the value of parameter <code>parent</code> of the outer <code>featureP</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p1"/&gt;
    &lt;feature-group name="group1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p2"/&gt;
    &lt;feature-group name="group1"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting config will include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>featureP:parent=p1</code>;</p>
</li>
<li>
<p><code>featureP:parent=p2</code>;</p>
</li>
<li>
<p><code>featureA:parent=p1,a=a1</code>;</p>
</li>
<li>
<p><code>featureA:parent=p2,a=a1</code>;</p>
</li>
<li>
<p><code>featureB:parent=p1,b=b1</code>;</p>
</li>
<li>
<p><code>featureB:parent=p2,b=b1</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_merging_feature_groups"><a class="anchor" href="#_merging_feature_groups"></a><a class="link" href="#_merging_feature_groups">8.2.4. Merging feature groups</a></h4>
<div class="paragraph">
<p>There could be a situation when the same feature group is brought into the config as a dependency of a few other feature groups. Which means its basic feature set is included into the final configuration multiple times but, taking into account possible customizations, each time it might be slightly different.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In that case the feature configurations will be merged. The features that are included later in the config will overwrite the common parameters of the corresponding features included earlier. But they will not completely replace the feature configurations that were added earlier.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, suppose we have these feature specs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureA"&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1" default="feature-spec"/&gt;
     &lt;param name="p2" default="feature-spec"/&gt;
     &lt;param name="p3" default="feature-spec"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="featureB"&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1" default="feature-spec"/&gt;
     &lt;param name="p2" default="feature-spec"/&gt;
     &lt;param name="p3" default="feature-spec"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and these feature groups</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature spec="featureA"&gt;
    &lt;param name="name" value="a1"/&gt;
    &lt;param name="p1" value="group1"/&gt;
    &lt;param name="p2" value="group1"/&gt;
    &lt;param name="p3" value="group1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureA"&gt;
    &lt;param name="name" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureA"&gt;
    &lt;param name="name" value="a3"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureB"&gt;
    &lt;param name="name" value="b1"/&gt;
    &lt;param name="p1" value="gorup1"/&gt;
    &lt;param name="p2" value="group1"/&gt;
    &lt;param name="p3" value="group1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureB"&gt;
    &lt;param name="name" value="b2"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group2" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureA:name="a1"&gt;
      &lt;param name="p1" value="group2"/&gt;
      &lt;param name="p2" value="group2"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureA:name=a3"/&gt;
    &lt;include feature-id="featureB:name="b1"&gt;
      &lt;param name="p2" value="group2"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureB:name=b2"/&gt;
  &lt;/feature-group&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group3" xmlns="urn:jboss:galleon:feature-group:1.0"&gt;

  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureA:name="a1"&gt;
      &lt;param name="p1" value="group3"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureA:name=a2"/&gt;
    &lt;include feature-id="featureB:name="b1"&gt;
      &lt;param name="p3" value="group3"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureB:name=b2"/&gt;
  &lt;/feature-group&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config name="main"&gt;
  &lt;feature-group name="group2"/&gt;
  &lt;feature-group name="group3"/&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>will contain</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">p1</th>
<th class="tableblock halign-left valign-top">p2</th>
<th class="tableblock halign-left valign-top">p3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group3</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_layers"><a class="anchor" href="#_layers"></a><a class="link" href="#_layers">8.3. Layers</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A layer is meant to represent a certain configuration flavor that can be used on its own or in combination with other layers to produce the final configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The idea behind layers is to predefine certain technology or some other purpose specific complete configurations (that can be used individually or in combination) and expose them as a multichoice to users composing their desired configuration.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s suppose we are provisioning an application server that supports multiple technologies such as EJB, Servlet, Messaging, etc. Those technologies could be viewed as components that make up the complete server but also, possibly, as a user&#8217;s choice at installation time, in case the user is actually interested only in a subset of those or perhaps simply one, or something that is not included into the default set.</p>
</div>
<div class="paragraph">
<p>Layers are defined in feature-pack archive&#8217;s <code>layers</code> directory. A layer is associated with a name but also, <a href="#_configuration_model_attributes">as configuration models</a>, can be associated with a model. If a layer is associated with a model, its definition in the feature-pack archive will appear in <code>layers/<em>config_model</em>/<em>layer_name</em>/layer-spec.xml</code> file, otherwise it will end up in <code>layers/<em>layer_name</em>/layer-spec.xml</code>.</p>
</div>
<div class="paragraph">
<p>Layers may depend on other layers. If a configuration includes a layer that depends on another layer, that other layer will be included (unless explicitly excluded by the user) into the configuration as well (prior to the layer declaring the dependency on it).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
While layers may be associated with both configuration model and a name, <strong>they are always referenced in configuration by simple name</strong>. The reason for that is that a layer can be referenced only from a configuration model or another layer and, ultimately, it still goes down to the configuration model that includes the layers. So it is the configuration model that determines which model to use for the layers it includes.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_layers_vs_feature_groups"><a class="anchor" href="#_layers_vs_feature_groups"></a><a class="link" href="#_layers_vs_feature_groups">8.3.1. Layers vs feature groups</a></h4>
<div class="paragraph">
<p>Layers and feature groups have the following in common:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>both are meant to define a certain (specialized) part of the final configuration;</p>
</li>
<li>
<p>both may define package dependencies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But they also have quite a few significant differences.</p>
</div>
<div class="sect4">
<h5 id="_origin"><a class="anchor" href="#_origin"></a><a class="link" href="#_origin">Origin</a></h5>
<div class="paragraph">
<p>The content of a feature group (including its package dependencies, if any) is fully defined in a single file - the feature group spec XML. And so, a feature group has a specific origin - the feature-pack containing the definition of the feature group.</p>
</div>
<div class="paragraph">
<p>Layers, on the other hand, are a product of merging layer specs with the same identity (configuration model + layer name combination) from all the feature-packs that make up the installation. From this perspective, layers are closer to configuration models than feature groups. And so, a layer might not have a single origin.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dependencies"><a class="anchor" href="#_dependencies"></a><a class="link" href="#_dependencies">Dependencies</a></h5>
<div class="paragraph">
<p>Feature groups don&#8217;t really have the notion of dependencies on other feature groups. A feature group may include other feature groups (their content) into its body.</p>
</div>
<div class="paragraph">
<p>A layer may define dependencies on other layers, which is not the same as including content of those layers into the layer declaring the dependency. The content of layers is merged directly into the configuration model which includes the layers.</p>
</div>
</div>
<div class="sect4">
<h5 id="_exclusion_from_configuration"><a class="anchor" href="#_exclusion_from_configuration"></a><a class="link" href="#_exclusion_from_configuration">Exclusion from configuration</a></h5>
<div class="paragraph">
<p>There is no way to exclude feature groups that have been earlier included into the configuration. When a feature group is added to a configuration, its content (features) is merged immediately into the configuration model. In a way, feature groups dissolve in the configuration and there is no way to identify the set of features previously forming the group with the goal to exclude them altogether from the configuration.</p>
</div>
<div class="paragraph">
<p>Layers, on the other hand, can be excluded from the configuration. When a configuration is resolved, the complete set of layers it includes is determined and then merged into the configuration. A user may provide instructions though to filter certain (or all the) layers out of the configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="_nesting"><a class="anchor" href="#_nesting"></a><a class="link" href="#_nesting">Nesting</a></h5>
<div class="paragraph">
<p>Feature groups can be nested under a feature which would serve as a parent feature for all the features included into the nested group directly and initialize the corresponding ID parameters of all the features contained in the group.</p>
</div>
<div class="paragraph">
<p>Layers can&#8217;t be nested under a feature. They are meant to define a complete configuration or a part of it starting from the very top of it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_layer_spec"><a class="anchor" href="#_layer_spec"></a><a class="link" href="#_layer_spec">8.3.2. Layer spec</a></h4>
<div class="paragraph">
<p>A layer spec is defined in <code>layer-spec.xml</code> file which, for the most part, content-wise is identical to a feature-group spec except it allows to configure dependencies on other layers. Here is an example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layerA"&gt;
    &lt;dependencies&gt;
        &lt;layer name="layerB"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;layer name="layerC" optional="true"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/dependencies&gt;

    &lt;!-- various features and feature groups --&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="p1" value="value"/&gt;
    &lt;/feature&gt;
    &lt;feature-group name="groupA"/&gt;

    &lt;packages&gt;
        &lt;package name="packageA"/&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;package name="packageB" optional="true"/&gt; <i class="conum" data-value="4"></i><b>(4)</b>
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>required dependency on <code>layerB</code> (<code>layerA</code> can&#8217;t be installed unless <code>layerB</code> has been installed)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>optional dependency on <code>layerC</code> (<code>layerC</code> will be installed when <code>layerA</code> is installed but if <code>layerC</code> has been excluded by the user, <code>layerA</code> will still be installed)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>required dependency on <code>packageA</code> (<code>layerA</code> can&#8217;t be installed unless <code>packageA</code> has been installed)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>optional dependency on <code>packageB</code> (<code>packageB</code> will be installed when <code>layerA</code> is installed but if <code>packageB</code> has been excluded by the user, <code>layerA</code> will still be installed)</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_effective_layer_spec"><a class="anchor" href="#_effective_layer_spec"></a><a class="link" href="#_effective_layer_spec">8.3.3. Effective layer spec</a></h4>
<div class="paragraph">
<p>In the simplest case, when only one feature-pack among all of the feature-packs that make up the installation defines a layer with a specific identity in the corresponding <code>layer-spec.xml</code>, whatever is defined in that <code>layer-spec.xml</code> is the effective layer spec in the installation.</p>
</div>
<div class="paragraph">
<p>However, in case an installation includes multiple feature-packs that happen to define a layer with the same identity (model and layer name combination) then the effective layer spec with that identity will be the result of merging all the layer specs from all the  feature-packs that make up the installation into one. Merging happens in the order the feature-packs are installed and follow the same principle used for merging configuration models.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s supposed we have three feature-packs: <code>fpA</code>, <code>fpB</code> and <code>fpC</code> and <code>fpB</code> depends on <code>fpA</code>. Every one of those feature-packs defines <code>layer1</code>.</p>
</div>
<div class="listingblock">
<div class="title">fpA layer1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layerA"&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="p1" value="fpA"/&gt;
        &lt;param name="p2" value="fpA"/&gt;
        &lt;param name="p3" value="fpA"/&gt;
    &lt;/feature&gt;
    &lt;packages&gt;
        &lt;package name="package-fpA"/&gt;
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fpB layer1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layerA"&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="p2" value="fpB"/&gt;
        &lt;param name="p3" value="fpB"/&gt;
    &lt;/feature&gt;
    &lt;packages&gt;
        &lt;package name="package-fpB"/&gt;
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fpC layer1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layerA"&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="p3" value="fpC"/&gt;
    &lt;/feature&gt;
    &lt;packages&gt;
        &lt;package name="package-fpC"/&gt;
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if we provision an installation using the feature-packs above as</p>
</div>
<div class="listingblock">
<div class="title">Provisioning configuration</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="fpB@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;feature-pack location="fpC@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>fpB</code> installs <code>fpA</code> as its transitive dependency</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The effective layer spec of <code>layerA</code> will be resolved as</p>
</div>
<div class="listingblock">
<div class="title">Effective <code>layer1</code> spec</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layerA"&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="p1" value="fpA"/&gt;
        &lt;param name="p2" value="fpB"/&gt;
        &lt;param name="p3" value="fpC"/&gt;
    &lt;/feature&gt;
    &lt;packages&gt;
        &lt;package name="package-fpA"/&gt;
        &lt;package name="package-fpB"/&gt;
        &lt;package name="package-fpC"/&gt;
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There won&#8217;t actually be an XML file generated for the effective layer spec. The XML above is used only for illustration of the effective layer content and its dependencies.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As in case of configuration model merging, feature-packs that appear higher in the feature-pack dependency hierarchy are allowed to use <code>include</code> and/or <code>exclude</code> elements in their layer specs to include and/or exclude features from the corresponding layers inherited from their feature-pack dependencies. In our example above, <code>include</code> and/or <code>exclude</code> elements could be used in <code>layer1</code> of <code>fpB</code> to manipulate the content of <code>layer1</code> inherited from <code>fpA</code>. E.g.</p>
</div>
<div class="listingblock">
<div class="title">fpB layer1</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layerA"&gt;
    &lt;exclude spec="specA"/&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="p2" value="fpB"/&gt;
        &lt;param name="p3" value="fpB"/&gt;
    &lt;/feature&gt;
    &lt;packages&gt;
        &lt;package name="package-fpB"/&gt;
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the rest of the configs unchanged the effective <code>layer1</code> spec will become</p>
</div>
<div class="listingblock">
<div class="title">Effective <code>layer1</code> spec</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layerA"&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="p2" value="fpB"/&gt;
        &lt;param name="p3" value="fpC"/&gt;
    &lt;/feature&gt;
    &lt;packages&gt;
        &lt;package name="package-fpA"/&gt;
        &lt;package name="package-fpB"/&gt;
        &lt;package name="package-fpC"/&gt;
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of <code>fpC</code> which doesn&#8217;t declare any dependency on neither <code>fpA</code> nor <code>fpB</code>, using <code>include</code> and/or <code>exclude</code> in its <code>layer1</code> spec won&#8217;t make any sense because other <code>layer1</code> specs are not 'visible' from <code>fpC</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_including_layers_into_configuration_models"><a class="anchor" href="#_including_layers_into_configuration_models"></a><a class="link" href="#_including_layers_into_configuration_models">8.3.4. Including layers into configuration models</a></h4>
<div class="paragraph">
<p>Layers are included into configuration defined using <code>config</code> element under element <code>layers</code>, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="model1" name="name1"&gt;
    &lt;layers&gt;
        &lt;include name="layer1"/&gt;
        &lt;include name="layer2"/&gt;
    &lt;/layers&gt;
    &lt;!-- the rest of the configuration --&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s suppose the configuration above belongs to a feature-pack <code>prod1</code>. And <code>prod1</code> also predefined another layer - <code>layer3</code>, which is not included into the default configuration <code>model1:name1</code>. Here is how <code>layer3</code> can be added to the final configuration by a user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
    &lt;config xmlns="urn:jboss:galleon:config:1.0" model="model1" name="name1"&gt;
        &lt;layers&gt;
            &lt;include name="layer3"/&gt;
        &lt;/layers&gt;
        &lt;!-- the rest of the configuration --&gt;
    &lt;/config&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting <code>model1:name1</code> configuration now will include <code>layer1</code>, <code>layer2</code> and <code>layer3</code> and they will be included into the configuration in exactly that order.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The statement above is valid only if the mentioned layers don&#8217;t depend on each other and/or other layers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_excluding_layers_from_configuration_models"><a class="anchor" href="#_excluding_layers_from_configuration_models"></a><a class="link" href="#_excluding_layers_from_configuration_models">8.3.5. Excluding layers from configuration models</a></h4>
<div class="paragraph">
<p>Layers that have been included into the configuration can later be excluded from it. The example above demonstrated how to include a layer into the configuration, here is an example of how a layer can be excluded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
    &lt;config xmlns="urn:jboss:galleon:config:1.0" model="model1" name="name1"&gt;
        &lt;layers&gt;
            &lt;exclude name="layer2"/&gt;
            &lt;include name="layer3"/&gt;
        &lt;/layers&gt;
        &lt;!-- the rest of the configuration --&gt;
    &lt;/config&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming feature-pack <code>prod1</code> included <code>layer1</code> and <code>layer2</code> into its <code>model1:name1</code> configuration (as in the previous example), the resulting <code>model1:name1</code> configuration will include only <code>layer1</code> and <code>layer3</code> (and their dependencies if any).</p>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_inheritance_of_layers"><a class="anchor" href="#_disabling_inheritance_of_layers"></a><a class="link" href="#_disabling_inheritance_of_layers">8.3.6. Disabling inheritance of layers</a></h4>
<div class="paragraph">
<p>If at some point it is necessary to reset the configuration in terms of layers it consists of and possibly re-define the configuration explicitly, it can be done like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
    &lt;config xmlns="urn:jboss:galleon:config:1.0" model="model1" name="name1"&gt;
        &lt;layers inherit="false"&gt;
            &lt;include name="layer3"/&gt;
        &lt;/layers&gt;
        &lt;!-- the rest of the configuration --&gt;
    &lt;/config&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>inherit="false"</code> attribute indicates to the provisioning mechanism to not inherit any layers for the configuration from any of the feature-packs included up to that point. The resulting <code>model1:name1</code> configuration will include only <code>layer3</code> (plus its dependencies) even if <code>prod1</code> included more layers into <code>model1:name1</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adjusting_layer_configuration"><a class="anchor" href="#_adjusting_layer_configuration"></a><a class="link" href="#_adjusting_layer_configuration">8.3.7. Adjusting layer configuration</a></h4>
<div class="paragraph">
<p>Once layers have been included into the configuration, the set of features, as well as packages, they brought in can be manipulated, i.e. configuration of some or all of those features can be modified or completely excluded.</p>
</div>
<div class="paragraph">
<p>Here is an example. Let&#8217;s suppose <code>prod1</code> feature-pack defines <code>layer1</code> as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;layer-spec xmlns="urn:jboss:galleon:layer-spec:1.0" name="layer1"&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="1"/&gt;
    &lt;/feature&gt;
    &lt;feature spec="specA"&gt;
        &lt;param name="id" value="2"/&gt;
    &lt;/feature&gt;
    &lt;feature spec="specB"&gt;
        &lt;param name="id" value="1"/&gt;
    &lt;/feature&gt;
    &lt;feature spec="specB"&gt;
        &lt;param name="id" value="2"/&gt;
    &lt;/feature&gt;
    &lt;packages&gt;
        &lt;package name="package1"/&gt;
        &lt;package name="package2" optional="true"/&gt;
        &lt;package name="package3"/&gt;
    &lt;/packages&gt;
&lt;/layer-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The user wants to include this layer into its installation but also adjust its configuration. It could look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
        &lt;packages&gt;
            &lt;exclude name="package2"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/packages&gt;
    &lt;/feature-pack&gt;
    &lt;config xmlns="urn:jboss:galleon:config:1.0" model="model1" name="name1"&gt;
        &lt;layers&gt;
            &lt;include name="layer1"/&gt;
        &lt;/layers&gt;
        &lt;exclude feature-id="specA:id=2"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;exclude spec="specB"/&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;feature spec="specB"&gt;
            &lt;param name="id" value="3"/&gt;
        &lt;/feature&gt;
    &lt;/config&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>package2</code> <code>layer1</code> depends on is excluded from the installation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>specA:id=2</code> inherited from <code>layer1</code> is excluded from the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All the features of <code>specB</code> inherited from <code>layer1</code> are excluded from the configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resulting installation will consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>model1:name1</code> configuration including features:</p>
<div class="ulist">
<ul>
<li>
<p><code>specA:id=1</code></p>
</li>
<li>
<p><code>specB:id=3</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>package1</code> plus its dependencies, if any;</p>
</li>
<li>
<p><code>package3</code> plus its dependencies, if any.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_merging_configurations_with_layers"><a class="anchor" href="#_merging_configurations_with_layers"></a><a class="link" href="#_merging_configurations_with_layers">8.3.8. Merging configurations with layers</a></h4>
<div class="paragraph">
<p>Layers are merged into configuration at the point where they are included into it with <code>include</code> element. It is important to keep that in mind.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following example. Suppose <code>prod1</code> feature-pack defines this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="model1" name="name1"&gt;
    &lt;layers&gt;
        &lt;include name="layer1"/&gt;
        &lt;include name="layer2"/&gt;
    &lt;/layers&gt;
    &lt;!-- the rest of the configuration --&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>prod2</code> feature-pack depends on <code>prod1</code> and defines this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="model1" name="name1"&gt;
    &lt;layers&gt;
        &lt;include name="layer2"/&gt;
        &lt;include name="layer3"/&gt;
    &lt;/layers&gt;
    &lt;!-- the rest of the configuration --&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>prod2</code> is installed, <code>layer2</code> will be included into <code>model1:name1</code> twice. Which may or may not create a confusion. First of all, in the given example, all the features added to <code>model1:name</code> in <code>prod1</code> are inherited by <code>model1:name1</code> in <code>prod2</code>, meaning <code>model1:name1</code> in <code>prod2</code> does not start empty. <code>layer1</code> and <code>layer2</code> have already been added to <code>model1:name1</code> in <code>prod1</code>. Including <code>layer2</code> into <code>model1:name1</code> in <code>prod2</code> does not make sense any more unless <code>model1:name1</code> in <code>prod1</code> has excluded and/or modified some feature configurations inherited from <code>layer2</code> and in <code>prod2</code> we want the original version of <code>layer2</code> configuration.</p>
</div>
<div class="paragraph">
<p>Whether including the same layer more than once into the same configuration creates a problem or not depends on the case. It&#8217;s important to keep in mind that every include means another merge of the layer.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If the content of the layer has not been adjusted in the configuration, the subsequent merge of the same layer will not result in any visible difference <strong>unless the layer includes features that have no identity</strong>. If a layer includes features that have no identity, there will be as many copies of those features in the configuration as the number of times the layer has been included into the configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While the example above can easily be adjusted in case the inclusion of <code>layer2</code> actually is redundant by simply removing it from the list of layers in <code>prod2</code>, there could be situations where it&#8217;s more difficult to avoid multiple inclusions of the same layer. For example building up the example above, let&#8217;s assume that every one of <code>layer1</code>, <code>layer2</code> and <code>layer3</code> depends on layer called <code>base</code>.</p>
</div>
<div class="paragraph">
<p>In that case, <code>base</code> will be included once into <code>model1:name1</code> in <code>prod1</code> (despite the fact that both <code>layer1</code> and <code>layer2</code> depend on <code>base</code>, the provisioning mechanism will recognize that <code>base</code> is a common dependency of those layers and include it only once into <code>model1:name1</code> in <code>prod1</code>). But later, processing <code>model1:name</code> in <code>prod2</code>, it will include <code>base</code> again as a dependency of <code>layer3</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
THIS CAN CHANGE. The mechanism can recognize that <code>base</code> has already been included and avoid including it again. The only possible issue is that if <code>layer3</code> really expects the original <code>base</code> configuration and the already included <code>base</code> has been somehow modified in between.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioned_installation_configuration"><a class="anchor" href="#_provisioned_installation_configuration"></a><a class="link" href="#_provisioned_installation_configuration">9. Provisioned installation configuration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configuration_model_attributes"><a class="anchor" href="#_configuration_model_attributes"></a><a class="link" href="#_configuration_model_attributes">9.1. Configuration model attributes</a></h3>
<div class="paragraph">
<p>Every configuration must be associated with at least one of the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> - name of the configuration;</p>
</li>
<li>
<p><code>model</code> - name of the configuration model.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>name</code> and <code>model</code> attributes serve as the identity of the configuration. They are essential when customizing and merging configurations.</p>
</div>
<div class="paragraph">
<p>If a configuration is associated only with a name (and no model) then only the name will be used as the identity of the configuration.</p>
</div>
<div class="paragraph">
<p>If a configuration is associated with a name and a model then the combination of the name and the model will be used as the identity of the configuration.</p>
</div>
<div class="paragraph">
<p>Feature-pack may include predefined configurations in its <code>configs</code> directory whose structure can be described as</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">configs/
|- model1/
| |- name1/
| |  `- config.xml
| | ...
| |- nameN/
| |  `- config.xml
| `- model.xml
| ...
|- modelM/
| |- name1/
| |  `- config.xml
| | ...
| |- nameN/
| |  `- config.xml
| `- model.xml
|- name1/
|  `-config.xml
| ...
`- nameN/
   `-config.xml</pre>
</div>
</div>
<div class="paragraph">
<p>If a configuration is associated with a name but not a model then its definition will be located in <code>configs/<em>config_name</em>/config.xml</code> and start with the following root element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="config_name"&gt;
    &lt;!-- skipped content --&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a configuration is associated only with a model then its definition will located in <code>configs/<em>config_model</em>/model.xml</code> and start with the following root element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="config_model"&gt;
    &lt;!-- skipped content --&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a configuration is associated with both model and a name its definition will be located in <code>configs/<em>model_name</em>/<em>config_name</em>/config.xml</code> and start with the following root element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="model_name" name="config_name"&gt;
    &lt;!-- skipped content --&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Predefined configuration models can be referenced from <code>feature-pack.xml</code> file and customized (manipulated) in the provisioning configuration of the installation (which is also an XML file) using <code>config</code> elements. Every <code>config</code> element will include the corresponding <code>name</code> and possibly <code>model</code> attributes to specify the identity of the configuration it is targeting.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Every <code>config</code> element in <code>feature-pack.xml</code> or installation provisioning configuration triggers installation of the configuration it is targeting.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That means, when a feature-pack is installed, by default all the configurations referenced from its <code>feature-pack.xml</code> are installed. Users may explicitly specify though which configurations should the final distribution include and customize those and/or provide their own custom configurations in the provisioning configuration of the installation.</p>
</div>
<div class="paragraph">
<p>Here is an example of <code>feature-pack.xml</code> with <code>config</code> elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0"&gt;

  &lt;config name="config1"&gt;
    &lt;!-- named configuration --&gt;
  &lt;/config&gt;

  &lt;config model="model1" name="config1"&gt;
    &lt;!-- named configuration of model1 --&gt;
  &lt;/config&gt;

&lt;/feature-pack&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_excluding_default_configs_from_the_installation"><a class="anchor" href="#_excluding_default_configs_from_the_installation"></a><a class="link" href="#_excluding_default_configs_from_the_installation">9.2. Excluding default configs from the installation</a></h3>
<div class="paragraph">
<p>The simplest way to exclude configs from the installation is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:1.0"&gt;
    &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;

        &lt;default-configs inherit="false"/&gt;

    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>inherit="false"</code> attribute indicates that none of the configs should be included into the distribution by default. If the attribute is not present, its value is assumed to be <code>true</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>feature-pack</code> element in the example above could as well appear under <code>dependecies</code> element of <code>feature-pack.xml</code>. Meaning the XML type of these elements are equivalent - they both describe a customized feature-pack. The examples below will be showing only <code>feature-pack</code> element.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above excludes all the configs, if the goal however is to exclude onyl a specific one, it can be done by providing the identity of the config using <code>exclude</code> element. For example, if a configuration was associated with a name but not any model then it would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
    &lt;default-configs&gt;
        &lt;exclude name="config1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And if the configuration was associated with a name and a model, both of them will have to be specified, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
    &lt;default-configs&gt;
        &lt;exclude name="config1" model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case there are multiple named configs that are associated with the same model, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:1.0"
                location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;

  &lt;config model="model1" name="config1"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;
  &lt;config model="model1" name="config2"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;

  &lt;config model="model2" name="config1"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;
  &lt;config model="model2" name="config2"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;

&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="excl-configs-by-model"></a>They can be excluded altogether by specifying the model name, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:1.0"&gt;
    &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
        &lt;default-configs&gt;
            &lt;exclude model="model1"/&gt;
        &lt;/default-configs&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This installation will include configs <code>model2:config1</code> and <code>model2:config2</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_picking_default_configs_into_the_installation"><a class="anchor" href="#_picking_default_configs_into_the_installation"></a><a class="link" href="#_picking_default_configs_into_the_installation">9.3. Picking default configs into the installation</a></h3>
<div class="paragraph">
<p>There are two scenarios when including a configuration could be necessary:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>when the configuration was excluded with <code>&lt;exclude model="<em>model_name</em>"/&gt;</code>;</p>
</li>
<li>
<p>when inhertance of the default configurations was disabled with <code>&lt;default-configs inherit="false"&gt;</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first one of course assumes that the configuration is associated with both name and model. It could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
    &lt;default-configs&gt;
        &lt;exclude model="model1"/&gt;
        &lt;include name="config1" model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above excludes all the <code>model1</code> configurations except <code>config1</code>.</p>
</div>
<div class="paragraph">
<p><a id="disable-def-configs"></a>Here is an example for the second scenario</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
    &lt;default-configs inherit="false"&gt;
        &lt;include name="config1"/&gt;
        &lt;include name="config1" model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above picks only <code>config1</code> and <code>model1:config1</code> from all the default configurations to be included into the distribution.</p>
</div>
<div class="paragraph">
<p>It is also possible to include configurations of a specific model, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
    &lt;default-configs inherit="false"&gt;
        &lt;include model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, all the default configurations of <code>model1</code> will be included into the distribution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_model_merges"><a class="anchor" href="#_configuration_model_merges"></a><a class="link" href="#_configuration_model_merges">9.4. Configuration model merges</a></h3>
<div class="paragraph">
<p>Configuration model merging is a way to integrate various products in the same installation. Lets suppose we want to add new product to an existing installation. Besides adding its filesystem content to the installation, normally, the configuration files of the existing installation will have to be adjusted to include the configuration of the product to be added.</p>
</div>
<div class="paragraph">
<p>In the provisioning terms, this scenarios can be described as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>there is a feature-pack (or a few) of the main installation (defining its FS content as well as the configurations);</p>
</li>
<li>
<p>there is the other product&#8217;s feature-pack defining its filesystem content and its default configuration that should be added to the main installation as part of its integration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How exactly the configuration of the new product is integrated into the existing installation will depend on every specific case but there are a few basic ways it can happen:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the product comes with its own standalone configuration which will not affect the existing installation configuration in any way;</p>
</li>
<li>
<p>the product configuration will have to be added to the existing configuration of the installation;</p>
</li>
<li>
<p>a combination of the two above: the standalone configuration and a piece of the configuration that needs to be added to the existing configuration of the installation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first one is simple: we just need to create two separate configurations: one for the main installation and one for the product we integrate.</p>
</div>
<div class="paragraph">
<p>In the second case, we need to actually merge the configurations from the existing installation and the feature-pack which represents the new product into a single confguration.</p>
</div>
<div class="paragraph">
<p>The third one effectively means that we&#8217;ve got multiple configuration models some of which should be merged and some should remain standalone. The tricky part is to identify which one is which. This is where the configuration <code>name</code> and <code>model</code> attributes are useful.</p>
</div>
<div class="paragraph">
<p>The provisioned installation may contain only one configuration model of a specific identity (which is the product of <code>config</code> <code>name</code> and <code>model</code> attribute values).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the provisioning mechanism analysing the installation being provisioned discovers multiple configuration models with the same identity, <strong>it does not throw an error but merges the configuration models into a single one</strong> (which may still result in an error, of course, if the resulting model contains unsatisfied requirements).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_named_name_only_configurations"><a class="anchor" href="#_named_name_only_configurations"></a><a class="link" href="#_named_name_only_configurations">9.4.1. Named (name-only) configurations</a></h4>
<div class="paragraph">
<p>The simplest way to provide an identity for a configuration is to give it a name. E.g.</p>
</div>
<div class="listingblock">
<div class="title">fp1: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config name="config1"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp1: configs/config1/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="config1"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp1"/&gt;
    &lt;param name="b" value="fp1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="1"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if another feature-pack provides a configuration with the same name, e.g.</p>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config name="config1"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: configs/config1/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="config1"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="b" value="fp2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature3"&gt;
    &lt;param name="id" value="1"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we include both of these feature-packs into the same installation</p>
</div>
<div class="listingblock">
<div class="title">Installation provisioning configuration</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:1.0"&gt;
  &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
  &lt;feature-pack location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provisioned <code>config1</code> will be the result of merging <code>config1</code> from <code>fp2</code> into <code>config1</code> from <code>fp1</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Which config overwrites which (assuming they contain common parts) depends on the order in which the feature-packs are listed under <code>installation</code> element.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is the content of the provisioned <code>config1</code>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe)1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe)1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2@maven(org.jboss.universe:community-universe)1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2@maven(org.jboss.universe:community-universe)1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The features of <code>feature1</code> spec are not merged although they appear to have the same ID. The reason is that <code>fp2</code> does not declare the dependency on <code>fp1</code> and its feature specs are not available in <code>fp2</code> configurations. So this example assumes that both <code>fp1</code> and <code>fp2</code> include feature spec <code>feature1</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is how <code>feature-pack.xml</code> of <code>fp2</code> had to be written so that <code>feature1</code> spec could be re-used in <code>fp2</code> configuration:</p>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe)1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe)1#1.0.0.Final"/&gt;
  &lt;/dependencies&gt;
  &lt;config name="config1"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this feature-pack configuration the resulting <code>config1</code> will include the following features:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe)1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe)1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2@maven(org.jboss.universe:community-universe)1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_named_model_configurations"><a class="anchor" href="#_named_model_configurations"></a><a class="link" href="#_named_model_configurations">9.4.2. Named model configurations</a></h4>
<div class="paragraph">
<p>There are a couple of reasons for adding <code>model</code> attribute to the configuration identity. One of them is to define the scope for values of attribute <code>name</code>. In this sense, a <code>model</code> could be thought of as a namespace. E.g.</p>
</div>
<div class="listingblock">
<div class="title">fp1: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config name="main" model="modelA"/&gt;
  &lt;config name="main" model="modelB"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelA/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp1-modelA"/&gt;
     &lt;param name="b" value="fp1-modelA"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelB/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelB"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp1-modelB"/&gt;
    &lt;param name="b" value="fp1-modelB"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"/&gt;
  &lt;config name="main" model="modelB"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelA/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="b" value="fp2-modelA"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelB/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelB"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="b" value="fp2-modelB"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installing these two feature-packs (<code>fp2</code> following <code>fp1</code>) will result in the following two configurations:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. modelA:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 4. modelB:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_model_only_configurations"><a class="anchor" href="#_model_only_configurations"></a><a class="link" href="#_model_only_configurations">9.4.3. Model-only configurations</a></h4>
<div class="paragraph">
<p>Model-only configurations are associated only with a model by means of <code>model</code> attribute of <code>config</code> element but are not associated with any name specific name.</p>
</div>
<div class="paragraph">
<p>The idea behind the model-only configurations is to be able to define the base for a configuration of a specific model that every final configuration of that model should include. Model-only configurations are always added into the configuration before the named configurations, i.e. named configurations will be added on top of the model-only ones and will overwrite them.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
At the end, a provisioned installation will only contain the named configurations but not the model-only ones. Model-only configurations are always merged into the named configurations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A model-only configuration is merged into <strong>all</strong> the named configurations of the installation associated with the same model as the model-only configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s look at an example. Suppose we have two feature-packs: <code>fp1</code> and <code>fp2</code>.</p>
</div>
<div class="paragraph">
<p><code>fp1</code> is defined as</p>
</div>
<div class="listingblock">
<div class="title">fp1: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config name="main" model="modelB"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And includes the following configurations</p>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelA/model.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp1-modelA"/&gt;
    &lt;param name="b" value="fp1-modelA"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelB/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelB"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="b" value="fp1-modelB"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fp2</code> is defined as</p>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"/&gt;
  &lt;config name="test" model="modelA"/&gt;
  &lt;config name="test" model="modelB"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And includes the following configurations</p>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelA/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="b" value="fp2-modelA"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelA/test/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="test" model="modelA"&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp2-modelA"/&gt;
    &lt;param name="b" value="fp2-modelA"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelB/model.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="modelB"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp2-modelB"/&gt;
    &lt;param name="b" value="fp2-modelB"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelB/test/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="test" model="modelB"&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp2-modelB"/&gt;
    &lt;param name="b" value="fp2-modelB"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installing these two feature-packs will result in the following configurations:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 5. modelA:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 6. modelA:test</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 7. modelB:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelB</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 8. modelB:test</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_excluding_model_only_configurations_with_exclude_element"><a class="anchor" href="#_excluding_model_only_configurations_with_exclude_element"></a><a class="link" href="#_excluding_model_only_configurations_with_exclude_element">Excluding model-only configurations with exclude element</a></h5>
<div class="paragraph">
<p>Normally, model-only configurations are not supposed to be explicitly excluded. If a user excludes all the named configs of a specific model, the model-only configs of that model will simply be ignored by the provisioning mechanism.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Configuration model designers are encouraged to model configurations in a way that model-only configurations represent an essential part of any configuration of that model and its runtime dependencies and don&#8217;t need to be excluded explicitly by users or should be excluded in exceptional cases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In a previous chapter it was described how the default configurations could be excluded from the provisioned installation by <a href="#excl-configs-by-model">specifying their model name</a>. Here is the relevant part of the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:1.0"&gt;
    &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
        &lt;default-configs&gt;
            &lt;exclude model="model1"/&gt;
        &lt;/default-configs&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>exclude</code> element above <strong>does not</strong> affect the model-only configurations. It affects <strong>only the named</strong> configurations associated with the specified model.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine we have the following feature-pack <code>fp1</code></p>
</div>
<div class="listingblock">
<div class="title">fp1: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config name="main" model="modelA"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>with the following configurations</p>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelA/model.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp1-modelA"/&gt;
    &lt;param name="b" value="fp1-modelA"/&gt;
    &lt;param name="c" value="fp1-modelA"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelA/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="b" value="fp1-modelA-main"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And feature-pack <code>fp2</code></p>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:1.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the following configuration</p>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelA/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="c" value="fp2-modelA-main"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we install these feature-packs the resulting configuration will contain</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 9. modelA:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA-main</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If we exclude <code>modelA</code> like it was shown in the previous example <strong>in the declaration of the dependency</strong> on <code>fp1</code>, i.e.</p>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
      &lt;default-configs&gt;
        &lt;exclude model="modelA"/&gt;
      &lt;/default-configs&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we install <code>fp2</code> now, the provisioned configuration will contain</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 10. modelA:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The model-only configuration from <code>fp1</code> is still effective because <code>fp1</code> is installed as a dependency of <code>fp2</code> and its <code>modelA</code> configuration is considered being essential for any named configuration of the model. In case it still has to be excluded from the provisioned configuration it can be done by adding <code>named-only-models="false"</code> attribute to <code>exclude</code> element, e.g.</p>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
      &lt;default-configs&gt;
        &lt;exclude model="modelA" named-only-models="false"/&gt;
      &lt;/default-configs&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>exclude</code> element above affects both named and model-only configurations of <code>modelA</code> from feature-pack <code>fp1</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>named-only-models</code> attribute is optional and if abscent its value is assumed to be <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The provisioned configuration of <code>fp2</code> will now contain</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 11. modelA:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_disabling_inheritance_of_model_only_configurations"><a class="anchor" href="#_disabling_inheritance_of_model_only_configurations"></a><a class="link" href="#_disabling_inheritance_of_model_only_configurations">Disabling inheritance of model-only configurations</a></h5>
<div class="paragraph">
<p>In an earlier chapter it was shown <a href="#disable-def-configs">how the default configurations of a feature-pack could be suppressed</a>. Let&#8217;s now include a model-only configuration in the example.</p>
</div>
<div class="listingblock">
<div class="title">fp1: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config name="main" model="modelA"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelA/model.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="a" value="fp1-modelA"/&gt;
    &lt;param name="b" value="fp1-modelA"/&gt;
    &lt;param name="c" value="fp1-modelA"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp1: configs/modelA/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="b" value="fp1-modelA-main"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
      &lt;default-configs inherit="false"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the default configurations from <code>fp1</code> are going to be ignored</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">fp2: configs/modelA/main/config.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config xmlns="urn:jboss:galleon:config:1.0" name="main" model="modelA"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="1"/&gt;
    &lt;param name="c" value="fp2-modelA-main"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>inherit="false"</code> attribute of <code>default-configs</code> element we indicated that the default configurations of <code>fp1</code> should not be included into the distribution provisioned from <code>fp2</code>. But it does not affect the model-only configs. So the model-only <code>modelA</code> configuration will still be effective in <code>fp2</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>inherit-unnamed-models</code> attributes of <code>default-configs</code> element controls whether the model-only configs are inherited or not. The attribute is optional and if not present, its value is assumed to be <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example that disables the inheritance of all the named and model-only configurations:</p>
</div>
<div class="listingblock">
<div class="title">fp2: feature-pack.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
      &lt;default-configs inherit="false" inherit-unnamed-models="false"/&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"/&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The installation provisioned from <code>fp2</code> will include the following configuration</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 12. modelA:main</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_content_of_config_element"><a class="anchor" href="#_content_of_config_element"></a><a class="link" href="#_content_of_config_element">9.5. Content of <code>config</code> element</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although this chapter is describing <code>config</code> element as a child of <code>feature-pack</code> element, the same applies to the root <code>config</code> element from <code>config.xml</code> and <code>model.xml</code> files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>config</code> element is basically an extended version of <a href="#_feature_groups"><code>feature-group</code> element</a>. Meaning that everything that is allowed in the body of <code>feature-group</code> (which is <code>feature</code>, <code>feature-group</code> and <code>origin</code> elements for explicit dependency origins) is allowed in <code>config</code> element.</p>
</div>
<div class="paragraph">
<p>Besides that <code>config</code> element supports already mentioned in an earlier chapter the <a href="#_configuration_model_attributes">config attributes</a> and <code>props</code> element.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a <code>config</code> element appears in a <code>feature-pack.xml</code> file or as a child of <code>installation</code> element in the provisioning configuration of the installation, it represents all the configurations with the matching identity from all the feature-packs dependency hierarchy up to the current point merged into one configuration model.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>E.g. if feature-pack <code>fp1</code> depends on feature-pack <code>fp2</code> which includes configuration model <code>m1</code> named <code>n1</code>. Element <code>config</code> with attributes <code>model="m1" name="n1"</code> added to <code>fp1</code> will represent the corresponding configuration from <code>fp2</code> (unless the configuration inheritance was explicitly disabled in <code>fp1</code>), i.e. the content of configuration <strong>m1:n1</strong> from <code>fp2</code> may be manipulated in <code>config</code> element in <code>fp1</code> by excluding certain features or overwriting their parameters.</p>
</div>
<div class="paragraph">
<p>The same applies to <code>config</code> elements under <code>installation</code> element. If <code>installation</code> includes feature-packs <code>fp3</code> and <code>fp4</code>, both of which include configs <code>m1:n1</code>, <code>config</code> element with attributes <code>model="m1" name="n1"</code> added under the <code>installation</code> element will represent the result of merging configs <code>m1:n1</code> from feature-packs <code>fp3</code> and <code>fp4</code>.</p>
</div>
<div class="sect3">
<h4 id="_configuration_properties"><a class="anchor" href="#_configuration_properties"></a><a class="link" href="#_configuration_properties">9.5.1. Configuration properties</a></h4>
<div class="paragraph">
<p><code>props</code> element allows to attach various properties to the configuration that can be meaningful to the provisioning plugins processing the configuration. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;props&gt;
      &lt;prop name="save-to-file" value="model-a.xml"/&gt;
      &lt;prop name="other" value="thing"/&gt;
    &lt;/props&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_overwriting_configuration_properties_during_inclusion"><a class="anchor" href="#_overwriting_configuration_properties_during_inclusion"></a><a class="link" href="#_overwriting_configuration_properties_during_inclusion">9.5.2. Overwriting configuration properties during inclusion</a></h4>
<div class="paragraph">
<p>When a default configuration is included, its properties can be overwritten, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:1.0"&gt;
    &lt;feature-pack location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
        &lt;default-configs&gt;
            &lt;include name="main" model="modelA"&gt;
              &lt;props&gt;
                &lt;prop name="save-to-file" value="main-model-a.xml"/&gt;
              &lt;/props&gt;
            &lt;/include&gt;
        &lt;/default-configs&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration will include the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>save-to-file=main-model-a.xml;</p>
</li>
<li>
<p>other=thing.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_overwriting_configuration_properties_during_merging"><a class="anchor" href="#_overwriting_configuration_properties_during_merging"></a><a class="link" href="#_overwriting_configuration_properties_during_merging">9.5.3. Overwriting configuration properties during merging</a></h4>
<div class="paragraph">
<p>When the <a href="#_configuration_model_merges">configurations are merged</a>, their properties are also merged. The configuration that is included later into the installation overwrites the properties of the configuration which was added earlier. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config model="modelA"&gt;
    &lt;props&gt;
      &lt;prop name="save-to-file" value="model-a.xml"/&gt;
      &lt;prop name="other" value="thing"/&gt;
    &lt;/props&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;props&gt;
      &lt;prop name="save-to-file" value="main-model-a.xml"/&gt;
    &lt;/props&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp2-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration <code>modelA:main</code> will contain the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>save-to-file=main-model-a.xml;</p>
</li>
<li>
<p>other=thing.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_package_dependencies"><a class="anchor" href="#_configuration_package_dependencies"></a><a class="link" href="#_configuration_package_dependencies">9.6. Configuration package dependencies</a></h3>
<div class="paragraph">
<p><code>config</code> elements may include feature-pack package dependencies. So that when a configuration is included into the installation, the relevant packages required by the configuration are automatically included as well. Package dependencies are configured using the same elements described in <a href="#_feature_package_dependencies">the feature-package dependencies</a>. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
              location="fp1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
  &lt;config model="modelA"&gt;
    &lt;packages&gt;
     &lt;package name="p1"/&gt;
     &lt;package name="p2" optional="true"/&gt;
    &lt;/packages&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now every configuration of <code>modelA</code> will depend on and bring into the installation the specified packages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_dependencies"><a class="anchor" href="#_configuration_dependencies"></a><a class="link" href="#_configuration_dependencies">9.7. Configuration dependencies</a></h3>
<div class="paragraph">
<p>When all the configuration models have been resolved by the provisioning mechanism, the plugins attached to the installed feature-packs are invoked to generate the final configuration files. The plugins will see the resolved configurations as a list. Certain configuration models though may depend on other configuration models being generated first. To eliminate the trouble of ordering the configurations according to their dependencies in the plugins, configuration dependencies can be expressed in <code>config</code> elements. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;config model="host"&gt;
        &lt;config-deps&gt;
            &lt;config-dep id="domain-dep" model="domain"/&gt;
        &lt;/config-deps&gt;
    &lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above all the configurations of model <code>host</code> will appear in the resolved config list after all the configurations of model <code>domain</code>. <code>config-dep</code> <code>id</code> is used to identify the configuration dependencies when the configuration models are merged.</p>
</div>
<div class="paragraph">
<p>The example above illustrates a dependency on a configuration model. But <code>config-dep</code> may also include <code>name</code> attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_arranging_features_in_configurations"><a class="anchor" href="#_arranging_features_in_configurations"></a><a class="link" href="#_arranging_features_in_configurations">9.8. Arranging features in configurations</a></h3>
<div class="paragraph">
<p>Resolved configuration models are meant to be further processed by the provisioning plugins that actually generate the final configuration files. A resolved configuration is basically a set of features and properties. Plugins simply iterate through the features in the resolved configuration and generate the corresponding configuration fragments for the installation.</p>
</div>
<div class="paragraph">
<p>The order in which features appear in the resolved configuration may be significant. By default the order of the features in the resolved configuration reflects the order in which the features were added to the configuration, i.e. the order in which the features appeared in the <code>config</code> element. Although, in case there are dependencies between features, the mechanism will re-order the features according to their dependencies, i.e. if feature <code>F1</code> depends on feature <code>F2</code>, even if <code>F1</code> was added to the configuration before <code>F2</code>, in the resolved configuration <code>F2</code> will appear before <code>F1</code>.</p>
</div>
<div class="sect3">
<h4 id="_feature_branches"><a class="anchor" href="#_feature_branches"></a><a class="link" href="#_feature_branches">9.8.1. Feature branches</a></h4>
<div class="paragraph">
<p>Features in the resolved configuration are actually organized into branches. In the simplest case, there is only one branch for all the features of the configuration.</p>
</div>
<div class="paragraph">
<p>There are cases though, when a certain set of features has to be handled in a different way than the rest of the features in the same configuration. E.g. there could be a few features that form a circular dependency. The mechanism automatically detects those and notifies the plugins in case they need to handle them in a special way. Other examples of branches will be described below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_batches"><a class="anchor" href="#_batches"></a><a class="link" href="#_batches">9.8.2. Batches</a></h4>
<div class="paragraph">
<p>Batch is a branch features of which have to be handled atomically. E.g. if processing a feature by a plugin changes a certain state of the model during generation of the final configuration then to avoid a potentionally temporary inconsistent state, batches indicate to the plugins that a specific set of features has to be processed together as a unit and as a single configuration change.</p>
</div>
<div class="paragraph">
<p>One example could be features that form circular dependencies. Handling them one by one may result in referential integrity (or some other kind of) constraint violation during the final configuration generation.</p>
</div>
<div class="paragraph">
<p>By default, branches are not flagged as batches. This can be configured though with property <code>config.branch-is-batch</code>. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;config model="standalone"&gt;
        &lt;props&gt;
            &lt;prop name="config.branch-is-batch" value="true"/&gt;
        &lt;/props&gt;
        &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The fragment above makes all the branches of all the <code>standalone</code> configuration models in the installation batches by default.</p>
</div>
<div class="paragraph">
<p>Batch flag can further be enabled or disabled for a specific branch with feature spec annotations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="core-service.management"&gt;
    &lt;annotation name="feature-branch"&gt;
        &lt;elem name="id" value="core-service.management"/&gt;
        &lt;elem name="batch" value="true"/&gt;
    &lt;/annotation&gt;
        &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This marks branch <code>core-service.management</code> as batch.</p>
</div>
</div>
<div class="sect3">
<h4 id="_branch_per_feature_spec"><a class="anchor" href="#_branch_per_feature_spec"></a><a class="link" href="#_branch_per_feature_spec">9.8.3. Branch per feature spec</a></h4>
<div class="paragraph">
<p>In some cases it might be useful to arrange features in the resolved configuration by their specs. Some plugins may find it more optimal to process, e.g., all the features of <code>Spec1</code> first then all the features of <code>Spec2</code>, etc. The mechanism can be instructed to do that by including property <code>config.branch-per-spec</code> in <code>config</code> element, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;config model="standalone"&gt;
        &lt;props&gt;
            &lt;prop name="config.branch-per-spec" value="true"/&gt;
        &lt;/props&gt;
        &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the resulting branches of the configuration will be ordered according to the feature dependencies. E.g. if features of <code>Spec1</code> reference features of <code>Spec2</code>, the branch of features <code>Spec2</code> will appear in the configuration before the branch of features <code>Spec1</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above is arranging all the features in the configuration by specs. In some cases though it would be useful to group only features of specific specs together and leave the rest of the features as they are. This can be configured by adding the following feature spec annotation</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="core-service.management"&gt;
    &lt;annotation name="feature-branch"&gt;
        &lt;elem name="spec" value="true"/&gt;
    &lt;/annotation&gt;
        &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_isolating_circular_dependencies"><a class="anchor" href="#_isolating_circular_dependencies"></a><a class="link" href="#_isolating_circular_dependencies">9.8.4. Isolating circular dependencies</a></h4>
<div class="paragraph">
<p>The mechanism may identify circular dependencies between features in a configuration and create a separate branch for them. Here is how to enable this</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;config model="standalone"&gt;
        &lt;props&gt;
            &lt;prop name="config.isolate-circular-deps" value="true"/&gt;
        &lt;/props&gt;
        &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parent_children_branch"><a class="anchor" href="#_parent_children_branch"></a><a class="link" href="#_parent_children_branch">9.8.5. Parent-children branch</a></h4>
<div class="paragraph">
<p>Often features in configurations form parent-children relationships. Some plugins may find it useful to receive features arranged as parent-children branches. This can be configured per feature spec. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="SpecP"&gt;
    &lt;annotation name="feature-branch"&gt;
        &lt;elem name="parent-children"/&gt;
    &lt;/annotation&gt;
    &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Which means every feature of spec <code>SpecP</code> will start a branch containing all the features that are children (direct or transitive) of the <code>SpecP</code> feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="_branches_with_explicit_ids"><a class="anchor" href="#_branches_with_explicit_ids"></a><a class="link" href="#_branches_with_explicit_ids">9.8.6. Branches with explicit IDs</a></h4>
<div class="paragraph">
<p>When a branch is created, the mechanism assigns an ID to the branch. A user may instruct the mechanism to group features of certain specs on a branch with a given ID. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="Spec1"&gt;
    &lt;annotation name="feature-branch"&gt;
        &lt;elem name="id" value="Branch1"/&gt;
    &lt;/annotation&gt;
    &lt;!-- the rest is skipped --&gt;
&lt;/feature-spec&gt;

&lt;feature-spec xmlns="urn:jboss:galleon:feature-spec:1.0" name="Spec2"&gt;
    &lt;annotation name="feature-branch"&gt;
        &lt;elem name="id" value="Branch1"/&gt;
    &lt;/annotation&gt;
    &lt;!-- the rest is skipped --&gt;
&lt;/feature-spec&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above features of <code>Spec1</code> and <code>Spec2</code> will be collected on the same branch <code>Branch1</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_merging_independent_branches"><a class="anchor" href="#_merging_independent_branches"></a><a class="link" href="#_merging_independent_branches">9.8.7. Merging independent branches</a></h4>
<div class="paragraph">
<p>After a configuration has been resolved, it may appear that some branches share certain common characteristics. E.g. most probably some features in the configuration will depend other features. Which makes the corresponding feature branches depend on other feature branches. There could be a few branches though that don&#8217;t depend on other branches (although there could be branches that depend on them). To reduce the total number of branches per configuration, independent branches could be merged into a single independent branch. This can be configured by adding the following property to the <code>config</code> element</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;config model="standalone"&gt;
        &lt;props&gt;
            &lt;prop name="config.merge-independent-branches" value="true"/&gt;
        &lt;/props&gt;
        &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_merging_branches_with_the_same_dependencies"><a class="anchor" href="#_merging_branches_with_the_same_dependencies"></a><a class="link" href="#_merging_branches_with_the_same_dependencies">9.8.8. Merging branches with the same dependencies</a></h4>
<div class="paragraph">
<p>While the previous option merges only the independent branches, this one identifies branches with the same dependencies on other branches and merges them into a single branch. It can be enabled by adding the following property</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;config model="standalone"&gt;
        &lt;props&gt;
            &lt;prop name="config.config.merge-same-deps-branches" value="true"/&gt;
        &lt;/props&gt;
        &lt;!-- the rest is skipped --&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_patches"><a class="anchor" href="#_patches"></a><a class="link" href="#_patches">10. Patches</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The provisioning mechanism also supports feature-pack patching. Once a feature-pack has been released, the producer of the feature-pack may release patches for it. A patch could overwrite certain content of the feature-pack it applies to (i.e. certain packages or resources) and/or overwrite or re-define a part of the configuration.</p>
</div>
<div class="paragraph">
<p>A patch itself is also a feature-pack. The only thing that differentiates it from a usual feature-pack is element <code>patch</code> in its <code>feature-pack.xml</code>. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:jboss:galleon:feature-pack:2.0"
    location="producer1@maven(org.jboss.universe:community-universe):1#1.0.0.Patch1.Final"&gt;

    &lt;patch for="prod1@maven(org.jboss.galleon.universe.test:test-universe):1#1.0.0.Final"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>

    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>indicates that the feature-pack is a patch which applies to the feature-pack specified as the value of <code>for</code> attribute</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is not currently any restriction on the patch feature-pack versioning. <code>1.0.0.Patch1.Final</code> above is just a random example.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Patches can only be applied to a specific version of the feature-pack. An attempt to apply a patch to an installation that does not include the feature-pack version the patch was built for will result in a failure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As any other feature-pack, a patch can be installed and uninstalled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is possible to apply multiple patches to the same feature-pack in the installation.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_what_can_be_patched"><a class="anchor" href="#_what_can_be_patched"></a><a class="link" href="#_what_can_be_patched">10.1. What can be patched</a></h3>
<div class="paragraph">
<p>Patch basically provides a new version of certain content and/or redefines some configuration from the feature-pack it targets. Here is what can be patched:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>packages (including their content and definitions);</p>
</li>
<li>
<p>feature specs (by providing updated feature specs);</p>
</li>
<li>
<p>feature groups (by providing updated feature groups);</p>
</li>
<li>
<p>layers;</p>
</li>
<li>
<p>configs;</p>
</li>
<li>
<p>various feature-pack resources;</p>
</li>
<li>
<p>provisioning plugins (by including new versions of the plugins).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Patches may also include content that is not present in the feature-pack that apply to (i.e. new packages, feature specs, groups, resources, plugins).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_patches_for_the_same_feature_pack"><a class="anchor" href="#_multiple_patches_for_the_same_feature_pack"></a><a class="link" href="#_multiple_patches_for_the_same_feature_pack">10.2. Multiple patches for the same feature-pack</a></h3>
<div class="paragraph">
<p>As it was mentioned earlier, it is possible to apply multiple patches for the same feature-pack. In case patches don&#8217;t overlap in terms of what they patch, the order in which they are applied is not significant. If patches do overlap, the order in which they are applied most probably becomes significant. Because the patch that is applied last will overwrite patches that were applied before it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Like any other feature-pack, patches may declare dependencies on other patches. That could be one of the ways to control the order in which the patches will be applied.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_applying_patches"><a class="anchor" href="#_applying_patches"></a><a class="link" href="#_applying_patches">10.3. Applying patches</a></h3>
<div class="paragraph">
<p><code>feature-pack</code> element may include element <code>patches</code> which lists patches that should be installed for the feature-pack. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
        &lt;patches&gt;
            &lt;patch id="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Patch1.Final"/&gt;
            &lt;patch id="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Patch2.Final"/&gt;
        &lt;/patches&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_patching_transitive_dependencies"><a class="anchor" href="#_patching_transitive_dependencies"></a><a class="link" href="#_patching_transitive_dependencies">10.3.1. Patching transitive dependencies</a></h4>
<div class="paragraph">
<p>It is also possible to apply patches to transitive dependencies. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;transitive&gt;
        &lt;feature-pack location="prod2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"&gt;
            &lt;patches&gt;
                &lt;patch id="prod2@maven(org.jboss.universe:community-universe):1#1.0.0.Patch1.Final"/&gt;
                &lt;patch id="prod2@maven(org.jboss.universe:community-universe):1#1.0.0.Patch2.Final"/&gt;
            &lt;/patches&gt;
        &lt;/feature-pack&gt;
    &lt;/transitive&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_user_managed_content"><a class="anchor" href="#_handling_user_managed_content"></a><a class="link" href="#_handling_user_managed_content">11. Handling user-managed content</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once an installation has been built, a user or a process (on behalf of the user) may apply certain changes to the content of the installation such as add, edit or remove files and/or directories.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Since these kind of changes are not performed by the provisioning mechanism, it is the responsibility of the user to apply them in a safe manner and not break the installation by introducing some sort of unsatisfied dependencies or violating integrity constraints.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since these kind of changes are usually going to be applied after the installation has been built they don&#8217;t interfere with the provisioning process. That is until the next (provisioning state) update.</p>
</div>
<div class="paragraph">
<p>When a user requests a version update or install/uninstall a patch or a feature-pack, or an undo for the installation that contains user-managed content or changes, the provisioning mechanism detects what exactly has changed since the last provisioned state.</p>
</div>
<div class="paragraph">
<p>If no user changes have been detected, the updated version of the installation will replace the current one. However, if the provisioning mechanism did detect certain changes to the last provisioned state (in the form of added/remove files and/or directories or editted files), those changes will be respected and re-applied to the updated installation state, i.e.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>files and/or directories added to the previous installation state will be added to the updated installation state;</p>
</li>
<li>
<p>files and/or directories removed from the previous installation state will be removed from the updated installation state;</p>
</li>
<li>
<p>files editted in the previous installation state will be copied over to the updated installation state.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The provisioning mechanism <strong>DOES NOT</strong> perform 3-way merges on files that have changed in the updated installation state since the last provisioned state and that have also been modified by the user.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_application_of_user_changes_to_the_updated_installation_state"><a class="anchor" href="#_application_of_user_changes_to_the_updated_installation_state"></a><a class="link" href="#_application_of_user_changes_to_the_updated_installation_state">11.1. Application of user changes to the updated installation state</a></h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. User-added file</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target in the updated state</th>
<th class="tableblock halign-left valign-top">Change applied to the updated state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not found</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The user-added file is copied to the updated state</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Found and matches the file added by the user</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>None</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Found and is different from the file added by the user</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>A copy of the file from the updated state is created with suffix <strong>.glnew</strong></p>
</li>
<li>
<p>The user-added file is copied to the updated state (replacing the existing one)</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. User-modified file</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target in the updated state</th>
<th class="tableblock halign-left valign-top">Change applied to the updated state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not found</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The user-modified file is copied to the updated state and a warning is logged saying that the (equivalent of the) file modified in the previous state is not found in the updated state</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Found and matches the resulting file modified by the user</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>None</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Found and is different from the resulting file modified by the user</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>A copy of the file from the updated state is created with suffix <strong>.glnew</strong></p>
</li>
<li>
<p>The user-modified file is copied to the updated state (replacing the existing one)</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. User-removed file or directory</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target in the updated state</th>
<th class="tableblock halign-left valign-top">Change applied to the updated state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not found</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>None</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Found</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The target is removed from the updated installation</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. User-created directory</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target in the updated state</th>
<th class="tableblock halign-left valign-top">Change applied to the updated state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not found</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The corresponding directory is created in the updated state</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Found</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>None</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioning_options"><a class="anchor" href="#_provisioning_options"></a><a class="link" href="#_provisioning_options">12. Provisioning options</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every provisioning action (such as <code>provision</code>, <code>install</code>, <code>uninstall</code>, etc) may accept provisioning options. Provisioning options may control various things, e.g. enable debug mode in one of the product-specific provisioning plugins, activate a certain provisioning mode, etc.</p>
</div>
<div class="sect2">
<h3 id="_persistent_and_non_persistent_options"><a class="anchor" href="#_persistent_and_non_persistent_options"></a><a class="link" href="#_persistent_and_non_persistent_options">12.1. Persistent and non-persistent options</a></h3>
<div class="paragraph">
<p>Provisioning options can be persistent and non-persistent.</p>
</div>
<div class="paragraph">
<p><strong>Persistent options</strong> are persisted in the provisioning configuration file when the provisioning process has succesfully finished. E.g. if <code>prod1</code> is installed with <code>option1</code>, the provisioned configuration will look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
    &lt;options&gt;
        &lt;option name="option1" value="true"/&gt;
    &lt;/options&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if the user installs <code>prod2</code>, <code>option1</code> will still be effective during re-provisioning and the config will change to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:jboss:galleon:provisioning:2.0"&gt;
    &lt;feature-pack location="prod1@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
    &lt;feature-pack location="prod2@maven(org.jboss.universe:community-universe):1#1.0.0.Final"/&gt;
    &lt;options&gt;
        &lt;option name="option1" value="true"/&gt;
    &lt;/options&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Option values are not necessarily <code>true</code> or <code>false</code>, they may have various values. The only restriction is they <strong>must</strong> have some value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Non-persistent</strong> options, on the other hand, are not automatically stored in the provisioning configuration. They are used only for the provisioning action they were specified for.</p>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_and_product_specific_options"><a class="anchor" href="#_built_in_and_product_specific_options"></a><a class="link" href="#_built_in_and_product_specific_options">12.2. Built-in and product-specific options</a></h3>
<div class="paragraph">
<p>Provisioning options can be provided by the core provisioning mechanism itself and the product-specific provisioning plugins.</p>
</div>
<div class="sect3">
<h4 id="_built_in_provisioning_options"><a class="anchor" href="#_built_in_provisioning_options"></a><a class="link" href="#_built_in_provisioning_options">12.2.1. Built-in provisioning options</a></h4>
<div class="paragraph">
<p>There is only one built-in provisioning option (provided by the core mechanism) at the moment.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Provisioning option: optional-packages</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_feature_pack_original_effective_package_set">Optional package dependencies inclusion policy</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>all</code>, <code>none</code>, <code>passive</code>, <code>passive+</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_product_provisioning_options"><a class="anchor" href="#_product_provisioning_options"></a><a class="link" href="#_product_provisioning_options">12.2.2. Product provisioning options</a></h4>
<div class="paragraph">
<p>Product-specific provisioning options are exposed by the product-specific provisioning plugins attached to the feature-packs.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_plugin"><a class="anchor" href="#_maven_plugin"></a><a class="link" href="#_maven_plugin">13. Maven plugin</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Maven plugin allows to install a specific feature-pack into a new location or an existing installation or provision an installation the consists of multiple feature-packs.</p>
</div>
<div class="paragraph">
<p>The coordinates of the Maven plugin are</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.galleon&lt;/groupId&gt;
    &lt;artifactId&gt;galleon-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;4.0.0.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 18. Goals</caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_install_feature_pack">install-feature-pack</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installs a feature-pack into an empty directory or into an existing installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_provision">provision</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisions an installation that consists of one or more feature-packs at a specified location</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_install_feature_pack"><a class="anchor" href="#_install_feature_pack"></a><a class="link" href="#_install_feature_pack">13.1. install-feature-pack</a></h3>
<div class="sect3">
<h4 id="_galleoninstall_feature_pack"><a class="anchor" href="#_galleoninstall_feature_pack"></a><a class="link" href="#_galleoninstall_feature_pack">13.1.1. galleon:install-feature-pack</a></h4>
<div class="paragraph">
<p><strong>Full name:</strong>
org.jboss.galleon:galleon-maven-plugin:4.0.0.Final:install-feature-pack</p>
</div>
</div>
<div class="sect3">
<h4 id="_description"><a class="anchor" href="#_description"></a><a class="link" href="#_description">13.1.2. Description</a></h4>
<div class="paragraph">
<p>This maven plugin installs a feature-pack into an empty directory
or a directory that already contains an installation, in which case
the product the feature-pack represents will be integrated into an
existing installation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_attributes"><a class="anchor" href="#_attributes"></a><a class="link" href="#_attributes">13.1.3. Attributes</a></h4>
<div class="ulist">
<ul>
<li>
<p>Requires a Maven project to be executed.</p>
</li>
<li>
<p>Requires dependency resolution of artifacts in scope: <code>compile+runtime</code>.</p>
</li>
<li>
<p>Binds by default to the <a href="http://maven.apache.org/ref/current/maven-core/lifecycles.html">lifecycle phase</a>: <code>process-test-resources</code>.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<caption class="title">Table 19. Required Parameters</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#installDir">[installDir]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target installation directory.<br>
<strong>Alias is</strong>: <code>install-dir</code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content stretch">
<caption class="title">Table 20. Optional Parameters</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#customConfig">[customConfig]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a file containing <code>config</code> that should be installed.<br>
<strong>Alias is</strong>: <code>custom-config</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#excludedPackages">[excludedPackages]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explicitly excluded packages from the installation.<br>
<strong>Alias is</strong>: <code>excluded-packages</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#featurePack">[featurePack]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ArtifactItem</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy Galleon 1.x feature-pack artifact coordinates as (groupId -
artifactId - version) if not specified the feature-pack must be a
transitive dependency of a feature-pack with the version specified.
NOTE: either this parameter or 'location' must be configured.<br>
<strong>Alias is</strong>: <code>feature-pack</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#includedConfigs">[includedConfigs]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default feature-pack configs that should be included.<br>
<strong>Alias is</strong>: <code>included-configs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#includedPackages">[includedPackages]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explicitly included packages to install.<br>
<strong>Alias is</strong>: <code>included-packages</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#inheritConfigs">[inheritConfigs]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to inherit the default feature-pack configs.<br>
<strong>Default value is</strong>: <code>true</code>.<br>
<strong>Alias is</strong>: <code>inherit-configs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#inheritPackages">[inheritPackages]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to install the default package set.<br>
<strong>Default value is</strong>: <code>true</code>.<br>
<strong>Alias is</strong>: <code>inherit-packages</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#location">[location]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Galleon2 feature-pack location NOTE: either this parameter or
'feature-pack' must be configured.<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#pluginOptions">[pluginOptions]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary plugin options recognized by the plugins attached to the
feature-pack being installed.<br>
<strong>Alias is</strong>: <code>plugin-options</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#recordState">[recordState]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to record provisioned state in .galleon directory.<br>
<strong>Default value is</strong>: <code>true</code>.<br>
<strong>Alias is</strong>: <code>record-state</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameter_details"><a class="anchor" href="#_parameter_details"></a><a class="link" href="#_parameter_details">13.1.4. Parameter Details</a></h4>
<div class="paragraph">
<p><a id="customConfig"></a> <strong>customConfig</strong><br>
Path to a file containing <code>config</code> that should be installed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.io.File</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>custom-config</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="excludedPackages"></a> <strong>excludedPackages</strong><br>
Explicitly excluded packages from the installation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.List</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>excluded-packages</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="featurePack"></a> <strong>featurePack</strong><br>
Legacy Galleon 1.x feature-pack artifact coordinates as (groupId -
artifactId - version) if not specified the feature-pack must be a
transitive dependency of a feature-pack with the version specified.
NOTE: either this parameter or 'location' must be configured.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>org.jboss.galleon.maven.plugin.util.ArtifactItem</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>feature-pack</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="includedConfigs"></a> <strong>includedConfigs</strong><br>
Default feature-pack configs that should be included.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.List</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>included-configs</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="includedPackages"></a> <strong>includedPackages</strong><br>
Explicitly included packages to install.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.List</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>included-packages</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="inheritConfigs"></a> <strong>inheritConfigs</strong><br>
Whether to inherit the default feature-pack configs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>boolean</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Default</strong>: <code>true</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>inherit-configs</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="inheritPackages"></a> <strong>inheritPackages</strong><br>
Whether to install the default package set.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>boolean</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Default</strong>: <code>true</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>inherit-packages</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="installDir"></a> <strong>installDir</strong><br>
The target installation directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.io.File</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>Yes</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>install-dir</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="location"></a> <strong>location</strong><br>
Galleon2 feature-pack location NOTE: either this parameter or
'feature-pack' must be configured.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.lang.String</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="pluginOptions"></a> <strong>pluginOptions</strong><br>
Arbitrary plugin options recognized by the plugins attached to the
feature-pack being installed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.Map</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>plugin-options</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="recordState"></a> <strong>recordState</strong><br>
Whether to record provisioned state in .galleon directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>boolean</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Default</strong>: <code>true</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>record-state</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_provision"><a class="anchor" href="#_provision"></a><a class="link" href="#_provision">13.2. provision</a></h3>
<div class="sect3">
<h4 id="_galleonprovision"><a class="anchor" href="#_galleonprovision"></a><a class="link" href="#_galleonprovision">13.2.1. galleon:provision</a></h4>
<div class="paragraph">
<p><strong>Full name:</strong>
org.jboss.galleon:galleon-maven-plugin:4.0.0.Final:provision</p>
</div>
</div>
<div class="sect3">
<h4 id="_description_2"><a class="anchor" href="#_description_2"></a><a class="link" href="#_description_2">13.2.2. Description</a></h4>
<div class="paragraph">
<p>This maven plugin provisions an installation that consists of one
or more feature-packs. If the target installation directory already
contains an installation, the existing installation will be fully
replaced with the newly provisioned one.
&lt;p&gt;In other words, the configuration provided for this goal fully
describes the state of the final installation.&lt;/p&gt;</p>
</div>
</div>
<div class="sect3">
<h4 id="_attributes_2"><a class="anchor" href="#_attributes_2"></a><a class="link" href="#_attributes_2">13.2.3. Attributes</a></h4>
<div class="ulist">
<ul>
<li>
<p>Requires a Maven project to be executed.</p>
</li>
<li>
<p>Requires dependency resolution of artifacts in scope: <code>compile+runtime</code>.</p>
</li>
<li>
<p>Binds by default to the <a href="http://maven.apache.org/ref/current/maven-core/lifecycles.html">lifecycle phase</a>: <code>process-test-resources</code>.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<caption class="title">Table 21. Required Parameters</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#featurePacks">[featurePacks]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of feature-pack configurations to install.<br>
<strong>Alias is</strong>: <code>feature-packs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#installDir">[installDir]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target installation directory.<br>
<strong>Alias is</strong>: <code>install-dir</code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content stretch">
<caption class="title">Table 22. Optional Parameters</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#configs">[configs]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of custom configurations to install.<br>
<strong>Alias is</strong>: <code>configurations</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#customConfig">[customConfig]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a file containing <code>config</code> that should be installed.<br>
<strong>Alias is</strong>: <code>custom-config</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#logTime">[logTime]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to log provisioning time at the end<br>
<strong>Default value is</strong>: <code>false</code>.<br>
<strong>Alias is</strong>: <code>log-time</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#offline">[offline]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use offline mode when the plugin resolves an artifact.
In offline mode the plugin will only use the local Maven repository
for an artifact resolution.<br>
<strong>Default value is</strong>: <code>false</code>.<br>
<strong>Alias is</strong>: <code>offline</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#pluginOptions">[pluginOptions]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary plugin options.<br>
<strong>Alias is</strong>: <code>plugin-options</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#recordState">[recordState]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to record provisioned state in .galleon directory.<br>
<strong>Default value is</strong>: <code>true</code>.<br>
<strong>Alias is</strong>: <code>record-state</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#resolveLocals">[resolveLocals]</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of artifacts and paths pointing to feature-pack archives
that should be resolved locally without involving the
universe-based feature-pack resolver at provisioning time.<br>
<strong>Alias is</strong>: <code>resolve-locals</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameter_details_2"><a class="anchor" href="#_parameter_details_2"></a><a class="link" href="#_parameter_details_2">13.2.4. Parameter Details</a></h4>
<div class="paragraph">
<p><a id="configs"></a> <strong>configs</strong><br>
A list of custom configurations to install.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.List</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>configurations</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="customConfig"></a> <strong>customConfig</strong><br>
Path to a file containing <code>config</code> that should be installed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.io.File</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>custom-config</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="featurePacks"></a> <strong>featurePacks</strong><br>
A list of feature-pack configurations to install.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.List</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>Yes</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>feature-packs</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="installDir"></a> <strong>installDir</strong><br>
The target installation directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.io.File</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>Yes</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>install-dir</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="logTime"></a> <strong>logTime</strong><br>
Whether to log provisioning time at the end</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>boolean</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Default</strong>: <code>false</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>log-time</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="offline"></a> <strong>offline</strong><br>
Whether to use offline mode when the plugin resolves an artifact.
In offline mode the plugin will only use the local Maven repository
for an artifact resolution.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>boolean</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Default</strong>: <code>false</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>offline</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="pluginOptions"></a> <strong>pluginOptions</strong><br>
Arbitrary plugin options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.Map</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>plugin-options</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="recordState"></a> <strong>recordState</strong><br>
Whether to record provisioned state in .galleon directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>boolean</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Default</strong>: <code>true</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>record-state</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="resolveLocals"></a> <strong>resolveLocals</strong><br>
A list of artifacts and paths pointing to feature-pack archives
that should be resolved locally without involving the
universe-based feature-pack resolver at provisioning time.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>: <code>java.util.List</code></p>
</li>
<li>
<p><strong>Required</strong>: <code>No</code></p>
</li>
<li>
<p><strong>Alias</strong>: <code>resolve-locals</code></p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<caption class="title">Table 23. Feature-pack parameters</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature-pack Maven artifact groupId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature-pack Maven artifactId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature-pack artifact version (if not specified the feature-pack must be a transitive dependency of a feature-pack with the version specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inherit-configs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to inherit the default feature-pack configs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">included-configs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default feature-pack configs that should be included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excluded-configs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default feature-pack configs that should be excluded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inherit-packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to inherit the default feature-pack packages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">included-packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default feature-pack packages that should be included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excluded-packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default feature-pack packages that should be excluded.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.jboss.galleon&lt;/groupId&gt;
    &lt;artifactId&gt;galleon-maven-plugins&lt;/artifactId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;provision&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;install-dir&gt;${project.build.directory}/${project.build.finalName}&lt;/install-dir&gt;
                &lt;feature-packs&gt;
                    &lt;feature-pack&gt;
                        &lt;groupId&gt;org.wildfly.core&lt;/groupId&gt;
                        &lt;artifactId&gt;wildfly-core-galleon-pack&lt;/artifactId&gt;
                        &lt;inherit-configs&gt;false&lt;/inherit-configs&gt;
                        &lt;excluded-packages&gt;
                            &lt;name&gt;product.conf&lt;/name&gt;
                            &lt;name&gt;docs.schema&lt;/name&gt;
                        &lt;/excluded-packages&gt;
                    &lt;/feature-pack&gt;
                    &lt;feature-pack&gt;
                        &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
                        &lt;artifactId&gt;wildfly-servlet-galleon-pack&lt;/artifactId&gt;
                        &lt;version&gt;${project.version}&lt;/version&gt;
                            &lt;excluded-packages&gt;
                            &lt;name&gt;product.conf&lt;/name&gt;
                            &lt;name&gt;docs.schema&lt;/name&gt;
                        &lt;/excluded-packages&gt;
                    &lt;/feature-pack&gt;
                &lt;/feature-packs&gt;
                &lt;plugin-options&gt;
                    &lt;jboss-maven-dist/&gt;
                &lt;/plugin-options&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_galleon_cli_tool"><a class="anchor" href="#_galleon_cli_tool"></a><a class="link" href="#_galleon_cli_tool">14. Galleon CLI tool</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This command line tool (<em>bin/galleon.[sh|bat]</em>) allows you to provision/manage any products/installations that comply with galleon feature-packs.
Although being a generic tool, a builtin support is offered for products available from maven jboss community universe (eg: wildfly).<br>
Possible actions that you can operate from the tool: install, uninstall, check for updates, patch, update, undo last provisioning command.</p>
</div>
<div class="paragraph">
<p>Launching the tool without any argument starts an interactive shell. Type <em>exit</em> to exit the tool.<br>
Launching the tool with a command as argument will execute the command and exit, eg: <em>galleon.sh install wildfly-core:current --dir=myinstallation</em><br>
Launching the tool with <em>--file=&lt;path to script file&gt;</em> will execute the set of commands and exit.<br>
Launching the tool with <em>--help</em> will display the descriptions of all available options and commands.</p>
</div>
<div class="sect2">
<h3 id="_feature_pack"><a class="anchor" href="#_feature_pack"></a><a class="link" href="#_feature_pack">14.1. Feature-pack</a></h3>
<div class="paragraph">
<p>A key concept in galleon system is the notion of feature-pack. A feature-pack is a content container. It can be a full product (eg: wildfly)
or part of a product (eg: a wildfly subsystem packaged as a feature-pack). With the tool you are going to install/uninstall/update/&#8230;&#8203; feature-packs.<br>
NB: A galleon installation can be composed of 1 or more feature-packs.</p>
</div>
<div class="paragraph">
<p>A feature-pack can be a file on your local file system or located inside a universe (a product catalog).</p>
</div>
<div class="paragraph">
<p>The tool helps you identify the feature-pack that you can use for the task you want to achieve. In order to take benefit of the full capabilities
offered by the tool, one needs to understand how products are identified inside a universe.</p>
</div>
</div>
<div class="sect2">
<h3 id="_universe_feature_pack_location_fpl"><a class="anchor" href="#_universe_feature_pack_location_fpl"></a><a class="link" href="#_universe_feature_pack_location_fpl">14.2. Universe feature-pack location (FPL)</a></h3>
<div class="paragraph">
<p>A feature-pack location (FPL) is the way to identify a product inside a universe without actually expressing any build numbers.
A lot to commands require that you provide FPL.</p>
</div>
<div class="paragraph">
<p>The main (non exhaustive) FPL syntax is: <em>&lt;product&gt;[@universe]:[version]/[qualifier]</em><br>
Some examples of FPL to identify wildfly products:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>wildfly:current</em> =&#8658; Final (released) wildfly product current version</p>
</li>
<li>
<p><em>wildfly:current/alpha</em> =&#8658; The latest release of wildfly product current version that is at least of alpha quality.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The things to notice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Universe (from where the product comes from) is optional for products located in jboss maven community universe.</p>
</li>
<li>
<p>No actual version nor build (eg: 1.0.0-Alpha1-SNAPHOT) is provided. The syntax of FPL is abstract it allows you to express a level of expected quality without
hard-coding any version number.</p>
</li>
<li>
<p>Pointed by an FPL is an actual feature-pack artifact (a zipped file) that the tool will download/install,&#8230;&#8203;</p>
</li>
<li>
<p>A completer helps you compose FPL when the command you are calling expect one (eg: install).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if one installs wildfly product using the following command:</p>
</div>
<div class="paragraph">
<p><em>install wildfly:current/alpha --dir=myInstallation</em></p>
</div>
<div class="paragraph">
<p>Then, later, when checking for updates or upgrading <em>myInstallation</em> directory,
the latest build that is at least of quality alpha will be used to update.
If a final release is available then it will be installed when upgrading.</p>
</div>
<div class="paragraph">
<p>NB: Products being unique inside an installation, some commands (eg: <em>state update</em>)
only require the product part (<em>&lt;product&gt;[@universe]</em>) of an FPL. For example:</p>
</div>
<div class="paragraph">
<p><em>update --feature-packs=wildfly</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_universe_feature_pack_id_fpid"><a class="anchor" href="#_universe_feature_pack_id_fpid"></a><a class="link" href="#_universe_feature_pack_id_fpid">14.3. Universe feature-pack id (FPID)</a></h3>
<div class="paragraph">
<p>A feature-pack id (FPID) is the way to identify a product inside a universe by expressing a build number.
This is the syntax to use when you want to deal with specific builds of a product.</p>
</div>
<div class="paragraph">
<p>The FPID syntax is: <em>&lt;product&gt;[@universe]:[version]#[buildID]</em><br>
Some examples of FPID to identify wildfly products:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>wildfly:current#1.0.0-Final</em></p>
</li>
<li>
<p><em>wildfly:current#1.0.0-Alpha1</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The things to notice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Universe (from where the poduct comes from) is optional for products located in jboss maven community universe.</p>
</li>
<li>
<p>Pointed by an FPID is an actual feature-pack artifact (a zipped file)</p>
</li>
<li>
<p>A completer helps you compose your FPID when the command you are calling expect one (eg: install).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, to retrieve the informations of alpha1 build:</p>
</div>
<div class="paragraph">
<p><em>feature-pack get-info wildfly:current#1.0.0-Alpha1</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_listing_latest_available_feature_packs"><a class="anchor" href="#_listing_latest_available_feature_packs"></a><a class="link" href="#_listing_latest_available_feature_packs">14.4. Listing latest available feature-packs</a></h3>
<div class="paragraph">
<p><em>[/]$ list-feature-packs [--all-frequencies] [--universe=&lt;universe id&gt;]</em><br></p>
</div>
<div class="paragraph">
<p>This command lists all the final feature packs present in all the installed universes.<br>
The command looks in the current directory and its parent hierarchy for a possible installation
in which some universes would have been added. By default the builtin universe is used.<br>
If <em>--all-frequencies</em> option is set, then the latest build of all frequencies are displayed.<br>
If <em>--universe</em> option is set, the command lists the feature packs of this universe.<br></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The information displayed by this command can be re-used when installing, updating features-packs.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_searching_for_feature_packs"><a class="anchor" href="#_searching_for_feature_packs"></a><a class="link" href="#_searching_for_feature_packs">14.5. Searching for feature-packs</a></h3>
<div class="paragraph">
<p><em>[/]$ find &lt;pattern&gt; [--universe=&lt;universe id&gt;] [--resolved-only]</em><br></p>
</div>
<div class="paragraph">
<p>This command searches for all the feature pack builds present in all the installed
universes that match the provided pattern.<br>
The command looks in the current directory and its parent hierarchy for a possible installation
in which some universes would have been added. By default the builtin universe is used.<br>
If <em>--universe</em> option is set, the command searches for feature packs inside this universe.<br>
If <em>--resolved-only</em> option is set, the command only searches for feature packs installed in local repositories.<br></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The information displayed by this command can be re-used when installing, updating features-packs.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_installing_a_feature_pack"><a class="anchor" href="#_installing_a_feature_pack"></a><a class="link" href="#_installing_a_feature_pack">14.6. Installing a feature-pack</a></h3>
<div class="paragraph">
<p><em>install &lt;[FPL|FPID] | [--file=&lt;path to fp zip file&gt;]&gt; [--dir=&lt;installation dir&gt;] [--verbose] [feature-pack specific options]</em></p>
</div>
<div class="paragraph">
<p>This creates a directory containing the installed feature-pack content (binaries, configs).<br></p>
</div>
<div class="paragraph">
<p>NB: Using completion, when an installation directory has been identified, the options that
are specific to the feature-pack to install are proposed. When installing for the first time
a feature-pack this can take some time (a matter of few seconds up to minutes
if the feature-pack needs to be downloaded from a remote location).</p>
</div>
<div class="paragraph">
<p>You can retrieve the set of feature-pack specific options without relying on completion, to do so call:<br>
<em>feature-pack get-info &lt;[FPL|FPID] | [--file=&lt;path to fp zip file&gt;]&gt; --type=options</em><br>
You can then use the listed options (if any) to customize your install command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_a_subset_of_feature_pack_configurations"><a class="anchor" href="#_installing_a_subset_of_feature_pack_configurations"></a><a class="link" href="#_installing_a_subset_of_feature_pack_configurations">14.7. Installing a subset of feature-pack configurations</a></h3>
<div class="paragraph">
<p>When installing a feature-pack, all its default configurations are installed.
Use the <em>--default-configs=&lt;comma separated list of config_model/config_name&gt;</em> option
to specify the subset of configurations to install.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_feature_pack_layers"><a class="anchor" href="#_installing_feature_pack_layers"></a><a class="link" href="#_installing_feature_pack_layers">14.8. Installing feature-pack layers</a></h3>
<div class="paragraph">
<p>The <em>install</em> command can be used to install a subset of feature-pack features. Such subset are called layers.
When installing layers, a custom configuration is generated.</p>
</div>
<div class="paragraph">
<p><em>install &lt;[FPL|FPID] | [--file=&lt;path to fp zip file&gt;]&gt; [--dir=&lt;installation dir&gt;] [--layers=&lt;comma separated list of layers&gt;]
[--config=&lt;layers_model/configuration_name&gt;]</em></p>
</div>
<div class="paragraph">
<p>If no model name is provided, the CLI tries to identify the default model contained in the feature-pack.
If no configuration name is provided, the &lt;layers_model&gt;.xml is used as the generated configuration file name.</p>
</div>
<div class="paragraph">
<p>You can retrieve the set of feature-pack defined layers without relying on completion, to do so call:<br>
<em>feature-pack get-info &lt;[FPL|FPID] | [--file=&lt;path to fp zip file&gt;]&gt; --type=layers</em><br>
You can then use the listed layers (if any) to customize your install command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_un_installing_a_feature_pack"><a class="anchor" href="#_un_installing_a_feature_pack"></a><a class="link" href="#_un_installing_a_feature_pack">14.9. Un-installing a feature-pack</a></h3>
<div class="paragraph">
<p><em>uninstall [FPID] [--dir=&lt;installation dir&gt;] [--verbose] [feature-pack specific options]</em></p>
</div>
<div class="paragraph">
<p>This will remove the content installed by the feature-pack identified by the FPID. Some feature-pack specific options
can be provided, they will be used when re-provisioning the remaining (if any) feature-packs.</p>
</div>
<div class="paragraph">
<p>NB: Completer proposes the FPID you can un-install from the installation (products and patches). Completion
of feature-pack specific options are handled the same way as in the install command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_un_doing_the_last_provisioning_command"><a class="anchor" href="#_un_doing_the_last_provisioning_command"></a><a class="link" href="#_un_doing_the_last_provisioning_command">14.10. Un-doing the last provisioning command</a></h3>
<div class="paragraph">
<p><em>undo [--dir=&lt;installation dir&gt;] [--verbose]</em></p>
</div>
<div class="paragraph">
<p>This will revert the installation to the previous installed state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_patching_an_installation"><a class="anchor" href="#_patching_an_installation"></a><a class="link" href="#_patching_an_installation">14.11. Patching an installation</a></h3>
<div class="paragraph">
<p>Use the <em>install</em> command to patch an existing installation.</p>
</div>
<div class="paragraph">
<p><em>install &lt;[FPL|FPID] | [--file=&lt;path to patch zip file&gt;]&gt; [--dir=&lt;installation dir&gt;] [--verbose] [feature-pack specific options]</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_un_installing_a_patch"><a class="anchor" href="#_un_installing_a_patch"></a><a class="link" href="#_un_installing_a_patch">14.12. Un-installing a patch</a></h3>
<div class="paragraph">
<p>Use the <em>uninstall</em> command to remove a given patch or use <em>state undo</em> if the last provisioning command has been a patch installation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_checking_for_updates"><a class="anchor" href="#_checking_for_updates"></a><a class="link" href="#_checking_for_updates">14.13. Checking for updates</a></h3>
<div class="paragraph">
<p><em>check-updates [--dir=&lt;installation dir&gt;] [--include-all-dependencies] [--feature-packs=&lt;list of feature-pack producers&gt;]</em></p>
</div>
<div class="paragraph">
<p>If no products are provided, all installed products are checked for updates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_updating_an_installation"><a class="anchor" href="#_updating_an_installation"></a><a class="link" href="#_updating_an_installation">14.14. Updating an installation</a></h3>
<div class="paragraph">
<p>The <em>update</em> command allows to update an installation to the latest available versions of installed feature-packs.</p>
</div>
<div class="paragraph">
<p><em>update [--dir=&lt;installation dir&gt;] [--include-all-dependencies] [--yes] [--feature-packs=&lt;list of feature-pack producers or locations&gt;] [feature-pack specific options]</em></p>
</div>
<div class="paragraph">
<p>Display the list of available updates/patches then update.
If <em>--yes</em> is provided, the command will proceed without asking for confirmation.</p>
</div>
<div class="paragraph">
<p>NB: If the option <em>--feature-packs</em> contains feature-pack locations with versions, then these versions are used to update the feature-packs.</p>
</div>
<div class="paragraph">
<p>NB: Using completion, when an installation directory has been identified, the options that
are specific to the installed feature-pack(s) are proposed. When updating an installation for the first time
this can take some time (a matter of few seconds up to minutes if the feature-pack
needs to be downloaded from a remote location).</p>
</div>
<div class="paragraph">
<p>You can retrieve the set of feature-pack specific options without relying on completion, to do so call:<br>
<em>installation get-info [--dir=&lt;installation dir&gt;] --type=options</em><br>
You can then use the listed options (if any) to customize your update command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_retrieving_changes_applied_to_an_installation"><a class="anchor" href="#_retrieving_changes_applied_to_an_installation"></a><a class="link" href="#_retrieving_changes_applied_to_an_installation">14.15. Retrieving changes applied to an installation</a></h3>
<div class="paragraph">
<p>In order to visualize files you have added, removed or modified, use the command <em>get-changes [--dir=&lt;installation&gt;]</em>.<br>
In the CLI output added files are prefixed by '+', removed ones by '-' and modified ones by 'C' (for conflict).</p>
</div>
</div>
<div class="sect2">
<h3 id="_persisting_changes_applied_to_an_installation"><a class="anchor" href="#_persisting_changes_applied_to_an_installation"></a><a class="link" href="#_persisting_changes_applied_to_an_installation">14.16. Persisting changes applied to an installation</a></h3>
<div class="paragraph">
<p>Installed feature-packs optionally support persistence of changes into the provisioning configuration. As an example,
wildfly feature-packs persist configuration changes into the provisioning config.</p>
</div>
<div class="paragraph">
<p>Use the command <em>persist-changes [--dir=&lt;installation&gt;]</em> to persist the changes.<br></p>
</div>
<div class="paragraph">
<p>NB: If the installed feature-packs don&#8217;t support the ability to merge changes
into the provisioning configuration, this operation has no side effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="_observing_an_installation"><a class="anchor" href="#_observing_an_installation"></a><a class="link" href="#_observing_an_installation">14.17. Observing an installation</a></h3>
<div class="paragraph">
<p><em>[my-dir]$ installation get-info [--dir=installation] --type=[all|configs|dependencies|layers|optional-packages|options|patches|universes]</em></p>
</div>
<div class="paragraph">
<p>Display the set of installed feature-packs FPID. In addition can display configurations, dependencies layers and patches.<br>
NB: If some patches are applied, the applied patches information is displayed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_observing_a_feature_pack"><a class="anchor" href="#_observing_a_feature_pack"></a><a class="link" href="#_observing_a_feature_pack">14.18. Observing a feature-pack</a></h3>
<div class="paragraph">
<p><em>[my-dir]$ feature-pack get-info &lt;[FPL|FPID] | [--file=&lt;path to fp zip file&gt;]&gt; --type=[all|configs|dependencies|layers|optional-packages|options]</em></p>
</div>
<div class="paragraph">
<p>Display the FPID of a feature-pack. In addition can display dependencies, configurations,
layers and options usable when installing/provisioning/upgrading.</p>
</div>
</div>
<div class="sect2">
<h3 id="_optional_packages"><a class="anchor" href="#_optional_packages"></a><a class="link" href="#_optional_packages">14.19. Optional packages</a></h3>
<div class="paragraph">
<p>When getting information on an installation or a feature-pack, using <em>--type=optional-packages</em> option, you can retrieve the list of
optional packages. At installation time the set of optional packages installed is controlled by the option <em>--optional-packages=&lt;all|none|passive|passive+&gt;</em>.</p>
</div>
<div class="paragraph">
<p>There are 2 kind of optional packages. <em>passive</em> ones, that are installed only if all their dependencies are installed and <em>optional</em>
ones that have no requirements on their dependencies. Generally passive optional packages shouldn&#8217;t be excluded from an installation. They
are needed for the package to properly operate when the other packages on which it depends are provisioned. Optional packages that are not passive
can be excluded if not needed (according to the execution context).</p>
</div>
<div class="paragraph">
<p>When installing a complete feature-pack or installing a default configuration, the default value for <em>--optional-packages</em> is
<em>all</em> (all optional and passive packages are installed).</p>
</div>
<div class="paragraph">
<p>When installing layers with the install commands the default value for <em>--optional-packages</em> is
<em>passive+</em> (all optional and passive packages that have all their dependencies installed are installed).</p>
</div>
<div class="paragraph">
<p>You can override these default values by using the <em>--optional-packages</em> option.
Use <em>none</em> value to not install any optional nor passive packages, <em>passive</em> value to only install passive packages that have all their dependencies installed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_managing_the_local_cache_of_feature_packs"><a class="anchor" href="#_managing_the_local_cache_of_feature_packs"></a><a class="link" href="#_managing_the_local_cache_of_feature_packs">14.20. Managing the local cache of feature-packs</a></h3>
<div class="paragraph">
<p>When a feature-pack is internally resolved (at install time, to expose information,
to retrieve plugin options, &#8230;&#8203;). The feature-pack is added to a local cache.
This cache is re-used to speed-up future resolutions. The CLI cleanup un-used feature-pack from the cache
that are older than one month.</p>
</div>
<div class="paragraph">
<p>You can import (and optionally install in the universe for later resolution) a feature-pack zip file in the cache.</p>
</div>
<div class="paragraph">
<p><em>[my-dir]$ feature-pack import &lt;path to fp zip file&gt; [--install-in-universe=&lt;true|false&gt;]</em></p>
</div>
<div class="paragraph">
<p>You can clear the cache fully (NB: this will have a performance impact for future resolution).</p>
</div>
<div class="paragraph">
<p><em>[my-dir]$ feature-pack clear-cache</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_an_installation_to_xml"><a class="anchor" href="#_exporting_an_installation_to_xml"></a><a class="link" href="#_exporting_an_installation_to_xml">14.21. Exporting an installation to xml</a></h3>
<div class="paragraph">
<p><em>[my-dir]$ installation export &lt;new generated xml file&gt; --dir=&lt;installation&gt;</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_an_installation_from_xml"><a class="anchor" href="#_provisioning_an_installation_from_xml"></a><a class="link" href="#_provisioning_an_installation_from_xml">14.22. Provisioning an installation from xml</a></h3>
<div class="paragraph">
<p><em>[my-dir]$ provision &lt;xml file&gt; --dir=&lt;target installation directory&gt; [feature-pack specific options]</em></p>
</div>
<div class="paragraph">
<p>NB: Using completion, when an installation directory has been identified, the options that
are specific to the feature-pack(s) located in the XML configuration file are proposed.
When provisioning an installation for the first time this can take some time
(a matter of few seconds up to minutes if the feature-pack needs to be downloaded from a remote location).</p>
</div>
</div>
<div class="sect2">
<h3 id="_managing_the_history_of_an_installation"><a class="anchor" href="#_managing_the_history_of_an_installation"></a><a class="link" href="#_managing_the_history_of_an_installation">14.23. Managing the history of an installation</a></h3>
<div class="paragraph">
<p>By default the history keeps the state of the last 100 provisioning operations. This should be enough to cover
simple undo of provisioned state. Nevertheless you can increase/decrease this
value by using the following command:<br></p>
</div>
<div class="paragraph">
<p><em>installation set-history-limit &lt;history size limit&gt; [--dir=&lt;installation dir&gt;]</em></p>
</div>
<div class="paragraph">
<p>To retrieve the history size limit do:</p>
</div>
<div class="paragraph">
<p><em>installation get-history-limit [--dir=&lt;installation dir&gt;]</em><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_managing_installation_universes"><a class="anchor" href="#_managing_installation_universes"></a><a class="link" href="#_managing_installation_universes">14.24. Managing installation universes</a></h3>
<div class="paragraph">
<p>A universe can be added/removed to/from an existing installation.<br></p>
</div>
<div class="paragraph">
<p>Add a named or default (without using the --name option) universe to an installation.<br>
<em>[/]$ installation add-universe [--dir=&lt;installation dir&gt;] [--name=&lt;universe name&gt;] --factory=&lt;universe factory&gt; --location=&lt;universe location&gt;</em></p>
</div>
<div class="paragraph">
<p>Remove a named or default (without using the --name option) universe from an installation.<br>
<em>[/]$ installation remove-universe [--dir=&lt;installation dir&gt;] [--name=&lt;universe name&gt;]</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_directory_option"><a class="anchor" href="#_directory_option"></a><a class="link" href="#_directory_option">14.25. Directory option</a></h3>
<div class="paragraph">
<p>Some commands (eg: install, get-info, check-updates, &#8230;&#8203;) allow you to optionally provide a target directory thanks to the <em>--dir=&lt;path&gt;</em> option.
If no directory is provided, the command will lookup for an existing installation in the
current directory (that you can change with the <em>cd</em> command) and its parent directories hierarchy.
If no installation exists, the command will abort.</p>
</div>
<div class="paragraph">
<p>There are some exceptions to this installation lookup. <em>install and provision</em> commands expect the current directory
to be empty or to be the root of an installation. <em>uninstall, undo and update</em> commands expect
the current directory to be the root of an installation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exploring_an_installation_or_a_feature_pack"><a class="anchor" href="#_exploring_an_installation_or_a_feature_pack"></a><a class="link" href="#_exploring_an_installation_or_a_feature_pack">14.26. Exploring an installation or a feature-pack.</a></h3>
<div class="paragraph">
<p>The tool allows you to switch to a state edit mode in which you can observe and
edit a provisioning state in memory (without actually impacting the installation files).</p>
</div>
<div class="paragraph">
<p>To explore an installation:<br>
<em>[my-dir]$ state edit [&lt;installation dir&gt;]</em><br>
<em>[!edit!my-dir!/]$</em><br>
After this point, the tool switched to edit mode with a set of new commands available.<br></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Type <em>help</em> to list the set of available commands in this mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To explore a feature-pack:<br>
<em>[my-dir]$ state new</em><br>
<em>[!edit!/]$ add-dependency &lt;[FPL|FPID] --default-configs-inherit --packages-inherit</em><br></p>
</div>
<div class="paragraph">
<p>Once exploring, prompt, ls, cd and pwd commands are bound to the feature-pack (or installation) exposed file-system.<br>
Use <em>leave-state</em> to switch the tool back to its nominal mode.</p>
</div>
<div class="paragraph">
<p><em>[!edit!/]$ ls<br>
configs<br>
dependencies<br>
feature-specs<br>
packages<br>
[!edit!/]$ leave-state<br>
[my-dir]$</em><br></p>
</div>
<div class="paragraph">
<p>The fs is composed of:<br>
/configs/final/&lt;model&gt;/&lt;name&gt;/&lt;features&gt;<br>
/feature-specs/&lt;origin&gt;/&lt;feature-specs&gt;<br>
/packages/&lt;origin&gt;/&lt;packages&gt;<br>
Features and feature-specs are organized as a file system with containment.<br></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use ‘ls’ to visualize any item. Use ‘cd’ to navigate to a given node.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_searching_the_current_state"><a class="anchor" href="#_searching_the_current_state"></a><a class="link" href="#_searching_the_current_state">14.27. Searching the current state</a></h3>
<div class="paragraph">
<p>When in edit mode, one can search for packages and features.</p>
</div>
<div class="paragraph">
<p><em>[!edit!/]$ search [--query=&lt;some text&gt; | --package=&lt;package name&gt;]</em></p>
</div>
<div class="paragraph">
<p>When searching with <em>--query</em> all packages and features are looked-up for a match. If packages are matched, the features
that depend directly or indirectly on these packages will be shown in the result.</p>
</div>
<div class="paragraph">
<p>When searching with <em>--package</em>, the package completer can be used. The features that depend directly or
indirectly on this package will be shown in the result.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_new_state_or_editing_an_existing_state_from_an_installation_or_provisioning_xml_file"><a class="anchor" href="#_creating_a_new_state_or_editing_an_existing_state_from_an_installation_or_provisioning_xml_file"></a><a class="link" href="#_creating_a_new_state_or_editing_an_existing_state_from_an_installation_or_provisioning_xml_file">14.28. Creating a new state (or editing an existing state from an installation or provisioning XML file)</a></h3>
<div class="paragraph">
<p>This allow to start from an empty installation or re-use an installation and iteratively add/suppress content.<br></p>
</div>
<div class="paragraph">
<p><em>[my-dir]$ state new  | state edit &lt;path to installation dir | path to provisioning XML file&gt;<br>
[!edit!/]$ ls<br>
configs<br>
dependencies<br>
feature-specs<br>
packages</em></p>
</div>
<div class="paragraph">
<p>NB: Each action as the effect to build a runtime with the current state. The filesystem reflects the current state.</p>
</div>
<div class="paragraph">
<p>NB: Each action applied to a state in edition can be undone: <em>undo</em>.</p>
</div>
<div class="paragraph">
<p>NB: Use <em>leave-state</em> to leave the edit mode.</p>
</div>
<div class="paragraph">
<p>NB: The set of completer exposed commands is dynamic and is adjusted according to the current state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_or_provisioning_the_current_state"><a class="anchor" href="#_exporting_or_provisioning_the_current_state"></a><a class="link" href="#_exporting_or_provisioning_the_current_state">14.29. Exporting or provisioning the current state</a></h3>
<div class="paragraph">
<p>In edit mode, one can export the provisioning XML file or directly provision from the current state:</p>
</div>
<div class="paragraph">
<p><em>[!edit!/]$ export [&lt;path to generated xml file&gt;]</em><br>
<em>[!edit!/]$ provision &lt;dir of new installation&gt;</em></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use <em>export</em> to validate that what you get in the XML is in sync with the expose state.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Exporting a state without any XML target file will display the XML content in the CLI console.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The command 'get-info' can be used to get high level information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_feature_pack"><a class="anchor" href="#_adding_a_feature_pack"></a><a class="link" href="#_adding_a_feature_pack">14.30. Adding a feature-pack</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ add-dependency &lt;FPL|FPID&gt; [--default-configs-inherit] [--packages-inherit]</em><br></p>
</div>
<div class="paragraph">
<p>By default nothing is inherited. Once at least one feature-pack has been added, configurations or packages can be handled.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_a_feature_pack"><a class="anchor" href="#_removing_a_feature_pack"></a><a class="link" href="#_removing_a_feature_pack">14.31. Removing a feature-pack</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-dependency &lt;FPL|FPID&gt;</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_including_a_default_configuration"><a class="anchor" href="#_including_a_default_configuration"></a><a class="link" href="#_including_a_default_configuration">14.32. Including a default configuration</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ include-config &lt;model&gt;/&lt;name&gt; [--origin=&lt;fp origin&gt;]</em></p>
</div>
<div class="paragraph">
<p>Origin is optional, by default will be included from all fp that expose it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_an_included_default_configuration"><a class="anchor" href="#_removing_an_included_default_configuration"></a><a class="link" href="#_removing_an_included_default_configuration">14.33. Removing an included default configuration</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-included-config &lt;model&gt;/&lt;name&gt; [--origin=&lt;fp origin&gt;]</em></p>
</div>
<div class="paragraph">
<p>The completer only proposes the set of configurations that have been previously included.
Origin is optional, by default will be remove from all fp that include it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_excluding_a_default_configuration"><a class="anchor" href="#_excluding_a_default_configuration"></a><a class="link" href="#_excluding_a_default_configuration">14.34. Excluding a default configuration</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ exclude-config &lt;model&gt;/&lt;name&gt; [--origin=&lt;fp origin&gt;]</em></p>
</div>
<div class="paragraph">
<p>Origin is optional, by default will be excluded from all feature-packs that expose it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_an_excluded_default_configuration"><a class="anchor" href="#_removing_an_excluded_default_configuration"></a><a class="link" href="#_removing_an_excluded_default_configuration">14.35. Removing an excluded default configuration</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-excluded-config &lt;model&gt;/&lt;name&gt; [--origin=&lt;fp origin&gt;]</em></p>
</div>
<div class="paragraph">
<p>The completer only proposes the set of configurations that have been previously excluded.
Origin is optional, by default will be removed from all feature-packs that exclude it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_including_layers_into_a_configuration"><a class="anchor" href="#_including_layers_into_a_configuration"></a><a class="link" href="#_including_layers_into_a_configuration">14.36. Including layers into a configuration</a></h3>
<div class="paragraph">
<p>NB: Prior to be able to include layers into a configuration you need an included default or locally defined configuration.
To define a new configuration call <em>define-config --model=&lt;config model&gt; --name=&lt;config name&gt;</em></p>
</div>
<div class="paragraph">
<p><em>[!edit!/]$ include-layers &lt;config model/config name&gt; --layers=&lt;comma separated list of layers&gt;</em></p>
</div>
<div class="paragraph">
<p>NB: The completers for both configuration and layers propose you with the existing configurations and layers not already included.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_included_layers_from_a_configuration"><a class="anchor" href="#_removing_included_layers_from_a_configuration"></a><a class="link" href="#_removing_included_layers_from_a_configuration">14.37. Removing included layers from a configuration</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-included-layers &lt;config model/config name&gt; --layers=&lt;comma separated list of included layers&gt;</em></p>
</div>
<div class="paragraph">
<p>NB: You can only remove layers that have been explicitly included in your local configuration. Layers included in a default configuration
can be excluded but their inclusion can&#8217;t be removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_excluding_layers_from_a_configuration"><a class="anchor" href="#_excluding_layers_from_a_configuration"></a><a class="link" href="#_excluding_layers_from_a_configuration">14.38. Excluding layers from a configuration</a></h3>
<div class="paragraph">
<p>NB: Prior to be able to exclude layers from a configuration you need an included default or locally defined configuration that contain layers.</p>
</div>
<div class="paragraph">
<p><em>[!edit!/]$ exclude-layers &lt;config model/config name&gt; --layers=&lt;comma separated list of layers&gt;</em></p>
</div>
<div class="paragraph">
<p>NB: The completers for both configuration and layers propose you with the existing configurations and included layers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_excluded_layers_from_a_configuration"><a class="anchor" href="#_removing_excluded_layers_from_a_configuration"></a><a class="link" href="#_removing_excluded_layers_from_a_configuration">14.39. Removing excluded layers from a configuration</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-excluded-layers &lt;config model/config name&gt; --layers=&lt;comma separated list of excluded layers&gt;</em></p>
</div>
<div class="paragraph">
<p>NB: You can only remove layers that have been explicitly excluded in your local configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reseting_a_configuration"><a class="anchor" href="#_reseting_a_configuration"></a><a class="link" href="#_reseting_a_configuration">14.40. Reseting a configuration</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ reset-config &lt;model&gt;/&lt;name&gt;</em></p>
</div>
<div class="paragraph">
<p>The custom content of this configuration is removed.</p>
</div>
<div class="paragraph">
<p>NB: This has no effect on included/excluded configurations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_including_a_default_package"><a class="anchor" href="#_including_a_default_package"></a><a class="link" href="#_including_a_default_package">14.41. Including a default package</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ include-package &lt;fp origin&gt;/&lt;package name&gt;</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_an_included_default_package"><a class="anchor" href="#_removing_an_included_default_package"></a><a class="link" href="#_removing_an_included_default_package">14.42. Removing an included default package</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-included-package &lt;package name&gt; [--origin=&lt;fp origin&gt;]</em></p>
</div>
<div class="paragraph">
<p>The completer only proposes the set of packages that have been previously included.
The origin is optional, the package will be removed from all feature-packs that exclude it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_excluding_a_default_package"><a class="anchor" href="#_excluding_a_default_package"></a><a class="link" href="#_excluding_a_default_package">14.43. Excluding a default package</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ exclude-package &lt;fp origin&gt;/&lt;package name&gt;</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_an_excluded_default_package"><a class="anchor" href="#_removing_an_excluded_default_package"></a><a class="link" href="#_removing_an_excluded_default_package">14.44. Removing an excluded default package</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-excluded-package &lt;package name&gt; [--origin=&lt;fp origin&gt;]</em></p>
</div>
<div class="paragraph">
<p>The completer only proposes the set of packages that have been previously excluded.
The origin is optional, the package will be removed from all feature-packs that exclude it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_new_feature"><a class="anchor" href="#_adding_a_new_feature"></a><a class="link" href="#_adding_a_new_feature">14.45. Adding a new feature</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ add-feature &lt;config model/name&gt; &lt;path to feature-spec&gt;  &lt;dynamic set of feature param=&lt;value&gt;&gt;</em></p>
</div>
<div class="paragraph">
<p>For example:<br>
<em>add-feature standalone/standalone.xml org.wildfly.core:wildfly-core-galleon-pack/interface --interface=toto --inet-address=127.0.0.1</em></p>
</div>
<div class="paragraph">
<p>NB: All parameters are exposed as command option.</p>
</div>
<div class="paragraph">
<p>NB: All parameters that are not nillable and have no default values are required. The command being aborted if there are missing required parameters.</p>
</div>
<div class="paragraph">
<p>NB: If the parameter is not present, its default value is injected when creating the feature.</p>
</div>
<div class="paragraph">
<p>NB: The current location (thanks to cd) is not yet taken into account when completing/adding the feature. That is a TODO.</p>
</div>
<div class="paragraph">
<p>NB: A feature with the same feature-id can’t exist. A single feature with the given feature-id per config.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_a_feature"><a class="anchor" href="#_removing_a_feature"></a><a class="link" href="#_removing_a_feature">14.46. Removing a feature</a></h3>
<div class="paragraph">
<p><em>[!edit!/]$ remove-feature &lt;full path to feature inside a configuration&gt;</em></p>
</div>
<div class="paragraph">
<p>For example:<br>
<em>remove-feature standalone/standalone.xml/interface/toto</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_managing_universes"><a class="anchor" href="#_managing_universes"></a><a class="link" href="#_managing_universes">14.47. Managing universes</a></h3>
<div class="paragraph">
<p>A universe can be added/removed to/from a state.<br></p>
</div>
<div class="paragraph">
<p>Add a named or default (without using the --name option) universe to the state.<br>
<em>[!edit!/]$ add-universe [--name=&lt;universe name&gt;] --factory=&lt;universe factory&gt; --location=&lt;universe location&gt;</em></p>
</div>
<div class="paragraph">
<p>Remove a named or default (without using the --name option) universe from the state.<br>
<em>[!edit!/]$ remove-universe [--name=&lt;universe name&gt;]</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cli_tool_maven_configuration"><a class="anchor" href="#_cli_tool_maven_configuration"></a><a class="link" href="#_cli_tool_maven_configuration">15. CLI tool Maven configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default the following maven repositories are used to retrieve FP.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><a href="http://repository.jboss.org/nexus/content/groups/public/" class="bare">http://repository.jboss.org/nexus/content/groups/public/</a></em></p>
</li>
<li>
<p><em><a href="http://repo1.maven.org/maven2/" class="bare">http://repo1.maven.org/maven2/</a></em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The cli allows you to
change the path to the local repository and add/remove remote maven repositories.</p>
</div>
<div class="sect2">
<h3 id="_relying_on_maven_settings"><a class="anchor" href="#_relying_on_maven_settings"></a><a class="link" href="#_relying_on_maven_settings">15.1. Relying on maven settings</a></h3>
<div class="paragraph">
<p>In order to makes the cli to use a maven settings file call: <em>maven set-settings-file &lt;path to settings xml file&gt;</em>
In order to remove the reference to the settings file call: <em>maven reset-settings-file</em><br></p>
</div>
<div class="paragraph">
<p>NB: Advanced mirroring (eg: <em>external:*</em>) is not supported.<br>
NB: Any other cli maven configuration items will be overridden when a settings xml file is set.<br>
NB: If no local repository is set in settings file, the local repository (default or configured) is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_new_remote_repositories"><a class="anchor" href="#_adding_new_remote_repositories"></a><a class="link" href="#_adding_new_remote_repositories">15.2. Adding new remote repositories</a></h3>
<div class="paragraph">
<p>Use the following command to add new remote repositories:<br>
<em>maven add-repository --name=myrepo --url=http://foorepo [--release-update-policy=&lt;policy&gt;]
[--snapshot-update-policy=&lt;policy&gt;] [--type=&lt;type&gt;] [--enable-release=[true|false] [--enable-snapshot=[true|false]</em><br></p>
</div>
<div class="paragraph">
<p>NB: The type, release update policy, snapshot update policy and enable/disable of snapshot/release are optional and have default values.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_repository_policies"><a class="anchor" href="#_default_repository_policies"></a><a class="link" href="#_default_repository_policies">15.3. Default Repository policies</a></h3>
<div class="paragraph">
<p>Daily update for releases, never update for snapshots.<br>
Warn if checksum differs.</p>
</div>
<div class="paragraph">
<p>Snapshots are not resolved from remote repositories.<br>
Releases are resolved from remote repositories.</p>
</div>
<div class="paragraph">
<p>Update polices can be changed by calling:<br>
<em>maven set-release-update-policy [&lt;always|daily|interval:|never&gt;]</em><br>
<em>maven set-snapshot-update-policy [&lt;always|daily|interval:|never&gt;]</em></p>
</div>
<div class="paragraph">
<p>Activation of snapshot/release resolution can be changed by calling:<br>
<em>maven enable-snapshot [&lt;true|false&gt;]</em><br>
<em>maven enable-release [&lt;true|false&gt;]</em></p>
</div>
<div class="paragraph">
<p>NB: A reset command can be called for any of these changes to set the value back to its default value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_maven_configuration"><a class="anchor" href="#_advanced_maven_configuration"></a><a class="link" href="#_advanced_maven_configuration">15.4. Advanced maven configuration</a></h3>
<div class="paragraph">
<p>Proxy, authentication and mirroring are only supported when setting a maven xml settings file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_local_repository"><a class="anchor" href="#_local_repository"></a><a class="link" href="#_local_repository">15.5. Local repository</a></h3>
<div class="paragraph">
<p>By default the local maven repository is located in <em>&lt;user.home&gt;/.m2/repository</em>.
You can change this directory by using the command: <em>maven set-local-repository &lt;path to your local repository directory&gt;</em><br>
In order to reset to the default local maven repository call: <em>maven reset-local-repository</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_offline_mode"><a class="anchor" href="#_offline_mode"></a><a class="link" href="#_offline_mode">15.6. Offline mode</a></h3>
<div class="paragraph">
<p>By default maven is in online mode. In order to switch to offline use the command <em>maven enable-offline &lt;true|false&gt;</em><br>
In order to reset to the default mode call: <em>maven reset-offline</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_display_maven_configuration"><a class="anchor" href="#_display_maven_configuration"></a><a class="link" href="#_display_maven_configuration">15.7. Display maven configuration</a></h3>
<div class="paragraph">
<p>Call command: <em>maven get-info</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_impact_on_universe"><a class="anchor" href="#_impact_on_universe"></a><a class="link" href="#_impact_on_universe">15.8. Impact on Universe</a></h3>
<div class="paragraph">
<p>Any change made to the maven configuration makes the CLI to re-resolve universe(s).
This means that stream resolution stays in sync with maven configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolving_feature_packs"><a class="anchor" href="#_resolving_feature_packs"></a><a class="link" href="#_resolving_feature_packs">15.9. Resolving feature-packs</a></h3>
<div class="paragraph">
<p>When remote repositories are set, feature-packs are automatically downloaded at install time.
You can download feature-pack explicitly to the local repository by using the
command: <em>maven resolve-feature-pack &lt;feature-pack location&gt; [--verbose]</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_maven_tracing"><a class="anchor" href="#_maven_tracing"></a><a class="link" href="#_maven_tracing">15.10. Maven tracing</a></h3>
<div class="paragraph">
<p>When enabling "verbose" at installation and provisioning time, any artifact retrieved
from a remote repository is advertised in the console. This also
applies when fetching explicitly feature-packs.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.0.0.Final<br>
Last updated 2018-11-21 18:52:25 +0100
</div>
</div>
</body>
</html>